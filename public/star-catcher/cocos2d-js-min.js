!function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return r(i?i:t)},l,l.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){cc._LogInfos={ActionManager:{addAction:"cc.ActionManager.addAction(): action must be non-null",removeAction:"cocos2d: removeAction: Target not found",removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",getActionByTag_2:"cocos2d : getActionByTag(tag = %s): Action not found"},configuration:{dumpInfo:"cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from ccConfig.js)",loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",loadConfigFile_2:"Please load the resource first : %s"},Director:{resume:"cocos2d: Director: Error in gettimeofday",setProjection:"cocos2d: Director: unrecognized projection",popToSceneStackLevel:"cocos2d: Director: unrecognized projection",popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",popScene:"running scene should not null",pushScene:"the scene should not null"},Array:{verifyType:"element type is wrong!"},deprecated:'"%s" is deprecated, please use "%s" instead.',Scheduler:{scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null"},Node:{getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",getRotation:"RotationX != RotationY. Don't know which one to return",getScale:"ScaleX != ScaleY. Don't know which one to return",addChild:"An Node can't be added as a child of itself.",addChild_2:"child already added. It can't be added again",addChild_3:"child must be non-null",removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",removeChildByTag:"argument tag is an invalid tag",removeChildByTag_2:"cocos2d: removeChildByTag(tag = %s): child not found!",removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",reumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",_arrayMakeObjectsPerformSelector:"Unknown callback function",reorderChild:"child must be non-null",runAction:"cc.Node.runAction(): action must be non-null",schedule:"callback function must be non-null",schedule_2:"interval must be positive",initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture."},AtlasNode:{_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",_initWithTileFile:"",_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture."},_checkEventListenerAvailable:{keyboard:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",touchOneByOne:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",touchAllAtOnce:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",acceleration:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil"},EventListener:{create:"Invalid parameter."},__getListenerID:"Don't call this method if the event is for touch.",LayerMultiplex:{initWithLayers:"parameters should not be ending with null in Javascript",switchTo:"Invalid index in MultiplexLayer switchTo message",switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",addLayer:"cc.Layer.addLayer(): layer should be non-null"},view:{setDesignResolutionSize:"Resolution not valid",setDesignResolutionSize_2:"should set resolutionPolicy"},inputManager:{handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s"},swap:"cc.swap is being modified from original macro, please check usage",checkGLErrorDebug:"WebGL error %s",animationCache:{_addAnimationsWithDictionary:"cocos2d: cc.AnimationCache: No animations were found in provided dictionary.",_addAnimationsWithDictionary_2:"cc.AnimationCache. Invalid animation format",addAnimations:"cc.AnimationCache.addAnimations(): File could not be found",_parseVersion1:"cocos2d: cc.AnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",_parseVersion1_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",_parseVersion1_3:"cocos2d: cc.AnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",_parseVersion1_4:"cocos2d: cc.AnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",_parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",_parseVersion2_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",addAnimations_2:"cc.AnimationCache.addAnimations(): Invalid texture file name"},Sprite:{reorderChild:"cc.Sprite.reorderChild(): this child is not in children list",ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",_updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",initWithSpriteFrameName1:" is null, please check.",initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",reorderChild_2:"cc.Sprite.reorderChild(): child should be non-null",addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",addChild_3:"cc.Sprite.addChild(): child should be non-null",setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",setSpriteFrame:"Invalid spriteFrameName",setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null"},SpriteBatchNode:{addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",reorderChild_2:"cc.SpriteBatchNode.addChild(): child should be non-null",updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",addChild_2:"cc.Sprite.addChild(): child should be non-null",setSpriteFrame:"Invalid spriteFrameName",setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null"},spriteFrameCache:{_getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",_checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",_getFrameConfig_2:"Please load the resource first : %s",addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",addSpriteFrames_3:"Argument must be non-nil"},TextureAtlas:{initWithFile:"cocos2d: Could not open file: %s",insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex"},textureCache:{addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",addPVRImage:"addPVRImage does not support on HTML5",addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",dumpCachedTextureInfo:"cocos2d: '%s' id=%s %s x %s",dumpCachedTextureInfo_2:"cocos2d: '%s' id= HTMLCanvasElement %s x %s",dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",addUIImage_2:"cc.Texture.addUIImage(): image should be non-null"},Texture2D:{initWithETCFile:"initWithETCFile does not support on HTML5",initWithPVRFile:"initWithPVRFile does not support on HTML5",initWithPVRTCData:"initWithPVRTCData does not support on HTML5",addImage:"cc.Texture.addImage(): path should be non-null",initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",initWithString:"initWithString isn't supported on cocos2d-html5",initWithETCFile_2:"initWithETCFile does not support on HTML5",initWithPVRFile_2:"initWithPVRFile does not support on HTML5",initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",_initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",addImage_2:"cc.Texture.addImage(): path should be non-null",initWithData:"NSInternalInconsistencyException"},MissingFile:"Missing file: %s",radiansToDegress:"cc.radiansToDegress() should be called cc.radiansToDegrees()",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager:{addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",removeListeners:"Invalid listener type!",setPriority:"Can't set fixed priority with scene graph based listener.",addListener_2:"Invalid parameters.",addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",addListener_4:"The listener has been registered, please don't register it again.",_forceAddEventListener:"Invalid scene graph priority!",_updateListeners:"If program goes here, there should be event in dispatch.",_updateListeners_2:"_inDispatch should be 1 here."}},cc._logToWebPage=function(t){if(cc._canvas){var e=cc._logList,i=document;if(!e){var n=i.createElement("Div"),r=n.style;n.setAttribute("id","logInfoDiv"),cc._canvas.parentNode.appendChild(n),n.setAttribute("width","200"),n.setAttribute("height",cc._canvas.height),r.zIndex="99999",r.position="absolute",r.top="0",r.left="0",e=cc._logList=i.createElement("textarea");var s=e.style;e.setAttribute("rows","20"),e.setAttribute("cols","30"),e.setAttribute("disabled",!0),n.appendChild(e),s.backgroundColor="transparent",s.borderBottom="1px solid #cccccc",s.borderRightWidth="0px",s.borderLeftWidth="0px",s.borderTopWidth="0px",s.borderTopStyle="none",s.borderRightStyle="none",s.borderLeftStyle="none",s.padding="0px",s.margin=0}e.value=e.value+t+"\r\n",e.scrollTop=e.scrollHeight}},cc._formatString=function(t){if(!cc.js.isObject(t))return t;try{return JSON.stringify(t)}catch(e){return""}},cc.DebugMode=cc.Enum({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6}),cc._initDebugSetting=function(t){if(t!==cc.DebugMode.NONE){var e;t>cc.DebugMode.ERROR?(e=cc._logToWebPage.bind(cc),cc.error=function(){e("ERROR :  "+cc.formatStr.apply(cc,arguments))},cc.assert=function(t,i){"use strict";if(!t&&i){for(var n=2;n<arguments.length;n++)i=i.replace(/(%s)|(%d)/,cc._formatString(arguments[n]));e("Assert: "+i)}},t!==cc.DebugMode.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){e("WARN :  "+cc.formatStr.apply(cc,arguments))}),t===cc.DebugMode.INFO_FOR_WEB_PAGE&&(cc.log=cc.info=function(){e(cc.formatStr.apply(cc,arguments))})):console&&console.log.apply&&(cc.error=console.error.bind?console.error.bind(console):function(){return console.error.apply(console,arguments)},cc.assert=function(t,e){if(!t&&e){for(var i=2;i<arguments.length;i++)e=e.replace(/(%s)|(%d)/,cc._formatString(arguments[i]));throw new Error(e)}},t!==cc.DebugMode.ERROR&&(cc.warn=function(){return console.warn.apply(console,arguments)}),t===cc.DebugMode.INFO&&(cc.log=function(){return console.log.apply(console,arguments)},cc.info=function(){(console.info||console.log).apply(console,arguments)})),cc._throw=function(t){cc.error(t.stack||t)}}}},{}],2:[function(t,e,n){(function(n,r,s,o,a){var n=n||{};n._loadingImage="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAANACwAAAAAEAAQAAAEO5DJSau9OOvNex0IMnDIsiCkiW6g6BmKYlBFkhSUEgQKlQCARG6nEBwOgl+QApMdCIRD7YZ5RjlGpCUCACH5BAUAAA0ALAAAAgAOAA4AAAQ6kLGB0JA4M7QW0hrngRllkYyhKAYqKUGguAws0ypLS8JxCLQDgXAIDg+FRKIA6v0SAECCBpXSkstMBAAh+QQFAAANACwAAAAACgAQAAAEOJDJORAac6K1kDSKYmydpASBUl0mqmRfaGTCcQgwcxDEke+9XO2WkxQSiUIuAQAkls0n7JgsWq8RACH5BAUAAA0ALAAAAAAOAA4AAAQ6kMlplDIzTxWC0oxwHALnDQgySAdBHNWFLAvCukc215JIZihVIZEogDIJACBxnCSXTcmwGK1ar1hrBAAh+QQFAAANACwAAAAAEAAKAAAEN5DJKc4RM+tDyNFTkSQF5xmKYmQJACTVpQSBwrpJNteZSGYoFWjIGCAQA2IGsVgglBOmEyoxIiMAIfkEBQAADQAsAgAAAA4ADgAABDmQSVZSKjPPBEDSGucJxyGA1XUQxAFma/tOpDlnhqIYN6MEAUXvF+zldrMBAjHoIRYLhBMqvSmZkggAIfkEBQAADQAsBgAAAAoAEAAABDeQyUmrnSWlYhMASfeFVbZdjHAcgnUQxOHCcqWylKEohqUEAYVkgEAMfkEJYrFA6HhKJsJCNFoiACH5BAUAAA0ALAIAAgAOAA4AAAQ3kMlJq704611SKloCAEk4lln3DQgyUMJxCBKyLAh1EMRR3wiDQmHY9SQslyIQUMRmlmVTIyRaIgA7",n._fpsImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcAgcQLxxUBNp/AAAQZ0lEQVR42u2be3QVVZbGv1N17829eRLyIKAEOiISEtPhJTJAYuyBDmhWjAEx4iAGBhxA4wABbVAMWUAeykMCM+HRTcBRWkNH2l5moS0LCCrQTkYeQWBQSCAIgYRXEpKbW/XNH5zS4noR7faPEeu31l0h4dSpvc+t/Z199jkFWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY/H9D/MR9qfKnLj/00U71aqfJn9+HCkCR/Wk36ddsgyJ/1wF4fkDfqqm9/gPsUeTnVr6a2xlQfnxdI7zs0W7irzD17Ytb2WT7EeNv/r4ox1O3Quf2QP2pgt9utwfout4FQE8AVBSlnaRmfvAURQkg2RlAbwB9AThlW5L0GaiKojhJhgOIBqDa7XaPrusdPtr5kQwF0BVAAoBIABRCKDd5aFUhRDAAw57eAOwAhKIoupft3zoqhB1AqLwuHIBut9uFt02qqvqRDJR2dAEQJj/BAOjn56dqmma+xiaECAEQAWAggLsB6A6HQ2iaZggBhBAqgEAAnQB0kzaEmT4hAITT6VQ8Ho/HJAKKECJQtr8LwD1y/A1/vcdfEUIEyfZ9AcQbYvZ942Px88L2UwlJR0dH0EMPPbRj5syZPUeNGrXR7Xb/641xIwJ1XY9NSUlZm52dfW+XLl1w8uRJzJ8//+OGhoYJqqqe1TSt1Wsm9NN1PSIqKmr12rVrR5WUlHy1bdu2AQCumWc3IYRD1/UwVVXnFRQUTIuNjUVzczN2797dWFJSkq8oymZd15sAGAEnFEUJ1nX9nzIzM1dnZmZGh4SE4OTJk5g5c+Zf29vbp9pstrMej6fVOyhIhgAYU1hY+B+hoaGoqKg4XVlZea+XTULTNFdCQsLGiRMnPuR2u3UhBOV9eeDAAWXTpk095DUe6WsoyRE5OTlr0tLSAux2O/bs2cO5c+e+pijKUpIXSHaQVAGkvPLKK++6XK4OksJLCFlXV2cvKSlJBFAjhU+x2WwhHo9nUHp6+urMzMy7wsLCUF9fjxdffPHjxsbGiTab7WuPx9NiEutOuq4PyMjI+M+srKyYqKgoHD58GDNmzNjq8XhyVFU9b/q+LH7hBAEYu3PnTlZVVRFAGgCX6f/tAHoOHDjwa0p27txp/JO9e/f+QM7cipw9nfL3kQBKt2zZQpJ87rnn6mQmoHilw2EACs+cOUOSrK+vZ1NTE0nyo48+IoBpxswoBcMJ4Ndjx471kOTFixe5d+9ekqTH42H//v13A4jyzpAURfEH0H/OnDnthu1z5sw558MmFUCPWbNmnaMP3nrrLZoyDmP8Hl68eDFJ8siRI9/Yc+zYMQKYKdtAztrTrl27xptRXV1NAKMAOAyBBBA/Y8aMdpLs6Ojgxx9//E37+++//29yvFXppwvAwMcee8xjtDHsuXLlCqOjo//ia3wsfpkoALqFhoZuIckJEyackimm3dQmEMDUmpoakmRISMhhAHOHDx/eQJIbN24kgKEyMAHAFRMTs2XXrl1saWkhSZ0kp0+ffhrAr3wEW/S8efOukORLL72kA1gKYMPWrVtJkk899dRJAHeYrgsEsIQkjx8/TgDvAPjd448/3kaSb7zxBmUa7vC6z53BwcFbSHL9+vU6Sc6aNes8gF5ewWAH0PfVV18lSQL4DMBGIcQ6AKtcLleBFC2jXtFt8ODBe0iyoqKCAJYByC8qKmJDQwOzsrK+MAmqo1OnTveHhoa+GRkZ+XZkZOSWiIiIvzgcjk9mzpypkWRmZuZpmbYbGV4AgPnNzc1sa2sjgN0A5iQmJtaSZHl5OQHcb/K3s81mW0uSTU1NBFAFYFbfvn1Pk+Tbb79NAA8IIVzW42/hByA+Pz/fLR/2ZXIda05NI/z9/TeR5J49ewhgqlxTrtI0jY2NjQQw3zTLuWJiYjaUlJToS5Ys6fjkk080kwDEeAmADcA9GzZsIElGRUW9CyAWwLApU6Y0kOSKFSsog9QICGdERMTGsrIyZmVlEcC9AB4IDw/fTpLbtm0jgN94CUAnAJmVlZVcs2aNZ/LkyRdJcvbs2b4EwAkgZfPmzTxw4AABFAN4BkC6vFeUSewcAO5duXIlSTIhIaEawGMAxgKYAmAGgCS73e5vrKVk/yGythANYEhCQsIhkly+fDkBpKqqGmL6DgIALDKN/3yZpVWQZGVlJQE8aPI3KiMjo5okV61aRQAjAPQBMPfIkSN0u90EUCBtsPiFEwpgbn19PdetW2fM5N4zQ9ekpKQqkty0aRMBpMjiWM6JEydIkoqirJUFJ6iq6pAPVy8A6cZMehMBUACEuVyuFwG8HBwcPEIWx367ZMkSjSQXLVrUJouTRorrkAHdA8BdQogsAOsKCwtJkmPGjDkvMw2bDDo/ADEjRoz4XylyFbm5uY0mAbjLyyZ/AOOrq6tZVlbWsWDBgo69e/eyoqKCgwcPPg4gSQaoIRbp27dvN7KF+tLSUr28vJwFBQXtMpvpYRIM7+wrAkDeqVOnePbsWQIoNKfzpiXPg8uXLydJJicnNwF4f+nSpW6STEtLq5fjYwhk1wkTJtSQ5Ouvv04AqTKj+N2xY8dIkgEBAW/Ie1v8wncRegwZMmQvSfbr12+3Ua33WqPfOWbMmP0kWVpaSgCDZAqcfejQIWNZsEGKgvnh9gfQb9myZd8nAEJVVZtMkUNk8CcNHTq0liR1XWdYWNhmH1mJIme80OnTp18x1rp5eXkEsNJms92Fb7e/IgEsvHz5Mp999tkmAI/l5uZeMC0B7vEqqAYAyL106RJJsra2lpWVld+sucePH38ZQG+5NncBeOrgwYMkqbe3t/Po0aOsra011wAWyl0H7x0JJ4DE+fPnu0kyPT29DsDdUrBuyNKEEAkAdpw/f/6GeoEM8GUmfwEgPCIiopwkGxsbabPZPgOw6L777vvm4p49e26VGYjFLxUhhD+ApLKyMp44ccIoVnXybgbgzkcfffRzklyzZg0BDJYCMMmoCwQFBXkLgLGWvvcWAgBToSsKwNPTp09vMR7UuLi4rwH0lgU8c/Db5ezbeeTIkRWzZ8++aMxu+fn5BPCADBwHgP4LFy701NXVEUAJgAnPP/98kyxMNgHo53A4zH77BQQETMvPz7+Um5vbBuAlAFMSExPPmdbVL0qh8Acw8fDhw5SCchVAEYAVb775JknyhRdeaJYztHfxMwLAaqNwCGC2FArv8x0hAHKNLGPKlCme5OTk/Zs3bzb7O0wKiiG8KXl5ed8IxenTp0mSR48e1UmyW7duWywBuD2xyQcgFECgoih+8H1gyJgZV5Lkyy+/3CbTRIePtl2HDBmyw1QBHyGDdXZdXR1JUghRKkXBjOMHCoBdpr0L3nvvPZLkF198wejo6O0A4lVVDTb74HQ6AwD8Wq7Jh8rgGgDgQ13XjVR8qaxJuADMbmlpYXl5uV5UVNRWUFDgfv/993Vj/ZydnU1c37eHXML4S3viAcQqitJD2l104cIFY8lTKsXSBWBMVVWVcd9yed2A1NTUQ6Zl00CvLMMOoHdubm6zFIlWOf5+PsY/Kj09vdrU11QAwwGsv3jxIk21m2DZr10I0RXAuAcffPBgaWkpV69eTYfDcdiwUxY0w6xw+flX8L1xApjevXv3lREREaW6rofB93aPDUDQpEmTMgHgtddeqwBwEd/utZvpqK6uPgEAcXFxkA94NwB9unfvjrNnz4LklwDcf08iIqv66Zs2bXrl4YcfxooVKxAbG7uqrq5uAYA2TdOEqqpGYIi2tjbl6aeffu/YsWPv5uTk7JaC1wHg4Pnz542MwoVvTx+21dbWYvjw4WLixIl+2dnZ9lGjRgmSTE1NRUpKCkwFTGiaxtTU1OXTpk3707Bhw/6g67pDipnT4biuj7qut+Lbk3Vf1tTUXI9qu91Pjq1QFEUBgJaWFgBo8yGOQ8eNGxcAAOvXr/8QwBUfYygAKL169eoCABcuXACAWtn2hOGv0+kMNO1KiPDw8F4A4rZv3/7R1KlTR0+bNu1ht9u9r1+/fqitrQXJgwDarRC6/QjPzs4+QJIffPCB9/aQmSAA43ft2mW0e1QGoi8CAPyLsZccExNTC2BlRkbGRdOyYJCP2csBIN6UAZzCd7cBbQCijYp/dXU1ExMTz6SmptaMHj36f9LS0vYlJCRsl6mxIWSdu3fv/g5J7t+/nwC2AShMTk6+SJKff/45AWRLYbD7+fndAeDf5BJnLoCCyZMnt5JkdnZ2C4B/F0KEm1Pu+Pj4rST55ZdfEsBWAK+mpaVdMo3raDn7KwDuSEpK+m+S3LBhAwG8DuCtHTt2UBbpjgC408vvcFVV15HkuXPnjMp+p5uMf0RcXNyHJNnQ0EBVVfcCWBQXF3fG+Jv0yxABPwB5LS0tRmFxN4BlTzzxxGWSXLx4sS5F3GGFy+1Hp5SUlJq6ujoWFxdTpsZ2H+0iIyMj/0iSWVlZX5mr5jfJFroPGzasxlhTnjp1iiTZ3NxMl8tlrCd9pfa9SkpKSJI5OTmnZOageLUZZqxvfVFWVkZcPwdgNwnSCKPqb17jkmR8fPzfZMDZ5CRsFBmNI7h95s2b1yhT7/MAYmStwCx4vy0uLqa3v5qmEcCfvSr1QQAeXb16NY3Cm3HQ55133iGAp+SxZTNhKSkpfzUddkrFjYevzAQCeGjp0qXfsYckY2NjTwD4leGDLCL2HTdunNtoY+zWSHFcIHdsFCtcfuZ1vO9Eqs3m7/F47sb1k2qX/f3997W2tl7BjWfpBYDOzzzzzIVJkyZh0KBBCwEsB3AJvl9AETabLcDj8dwRFRW1ctasWb8JCgpSzp07d62wsPC/Wltb8xRFadR1/ZqPXYbgAQMGbI2Pjw/+6quv9ldVVT0r01ezuPRJSUn5Y9euXXVd11WzDaqq6kePHm3+7LPPRgO4KlNuxWazhXo8nuTk5OSXMjIyEl0uFxoaGtqKior+dPXq1VdUVT0jj7r68ieoT58+vx8yZMjdx48fP1JVVTVF9m20VW02WyfZf97YsWPjXS4X6urqWvPy8jYCWCyEuEDS8FdVFKWzruv//OSTTy5OTk7uqWkaPv3007qysrJ8RVH+LI8ym8/rB3Tu3HnRI488knLo0KG2ffv2ZQI4C98vP6mqqoZqmpaclpa2cOTIkX39/f3R0NDQUVxc/G5TU9PLqqrWa5rWLH1QVFUN0TStX1JSUvH48eP7BwYG4uDBg1cKCgpeBbBe2u+2Qug2EwD5N5sMPuNtMe8XP4TT6Qxoa2sbIGeXvUKIK7d4IISiKC5d1wPljOfA9bPwzYqiXNV13dd6Uqiq6qdpml2mpe02m63d4/G4vcTF5fF47LJf71nJA6BZVVW3pmntuPHlmAD5wk6Q9NnbHp9vHaqq6tA0zU/64PZhk1FfCZB9G/23ALiqKEqzD39tpvbGUqoFwFUhRLP3yzpCCDtJpxyXDulfG27+pqRR3DXsUWVd4Yq0x/taVQjhIhksC8L+ABpM9ljBf5sKwI8pIBr75L5E4vvu+UNeG/a+hv+AL7yFH8qPtOfHjtOP6V/Bja8D6z/B2Nys/1u9Xv33tLf4GfF/LC4GCJwByWIAAAAASUVORK5CYII=",n._loaderImage="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAlAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM4MDBEMDY2QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM4MDBEMDY1QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU2RTk0OEM4OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU2RTk0OEM5OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQADQkJCQoJDQoKDRMMCwwTFhENDREWGhUVFhUVGhkUFhUVFhQZGR0fIB8dGScnKionJzk4ODg5QEBAQEBAQEBAQAEODAwOEA4RDw8RFA4RDhQVERISERUfFRUXFRUfKB0ZGRkZHSgjJiAgICYjLCwoKCwsNzc1NzdAQEBAQEBAQEBA/8AAEQgAyACgAwEiAAIRAQMRAf/EALAAAAEFAQEAAAAAAAAAAAAAAAQAAgMFBgcBAQEAAwEBAAAAAAAAAAAAAAAAAQMEAgUQAAIBAgIEBwoLBgQGAwAAAAECAwAEEQUhMRIGQVFxsTITFGGBwdEiQlKSMzWRoeFicqKyI1NzFYJjJDQWB9KjVCbxwkNkJWXik3QRAAIBAgMFBQcDBQEAAAAAAAABAhEDIRIEMUFRcTJhwVIUBZGhsSJyEzOB0ULhYpIjUxX/2gAMAwEAAhEDEQA/AMJSpUqAVKlXuFAeUq9wpUB5XuFe4V6ooDzZHDox0CnGMinzwl7Z8NajaHeoO3vmTBZBtp9YUIqTEV5ROxHKnWRnaU8VRMhFBUjpV7hSoSeUq9pUB5Sr2lhQHlKvcK8oBV7hSFSRrtaKAZs07YNPM1pG2xJIAw1jSeandry/8X4m8VCKkWwaWwam7Xl/4v1W8VLtmX/i/VbxUoKkWwakSM407tmX/i/VbxUmzGwjQsjdY41IARie/U0IbZO0kNtCXnOCkEBeFu4KI3Bs7DNb27ya+jDx3kJeEnpJJEcQVbWDsk17u5urd591ucZkWhym2Vnd9RkCDEpFxDRpbw0bunu5mlp2De2FMLYXOD2wB2xbOeraUcYGJ72mlSUiqzzdzMd3Z3mixltA2yzcK/NlHM1DQyRXce1HocdNOEfJXZ88y9ZojOqhiBszIRiHQ8Y4cK5TvHuzLljHNMqxNoDjLFraHHnjPxcNCGVbxEUzYNTx5jZSxhpW6qTzlwJ+DCvO2Zf+L9VvFSgqyHYNLYNTdssPxfibxUu15f8Ai/VPiqCakOwa82DU/a8v/F+JvFTDdWPBL8R8VKCvYRYV5UzoMAy6QdIIqI0B4KJtxiRQwou16QoGUkntH5Tz0RbZbmF2hktraSVBo2lUkY8tDye0flPPXTslVUyiyVRsjqUOA4yMT8dW2ram2m6UVTNq9S7EIyUVJydMTn/6DnP+im9Wl+g5z/opvVrpteEhQWY4AaSTwAVf5WPiZh/9S5/zj7zltzlmYWkfWXNvJDGTgGcYDHirR7i7mSbwXParsFMrgb7w6jKw/wCmnc9I14kF3vpvCljbMyWMOJL4aEiB8qU/ObUK7HYWVrl1pFZWiCOCBQqKOLjPGTrNZZqKbUXVHq2nNwTuJRk1VpbgXN8s7Rk5ym0UQQzhIG2NAjhxHWbI+gCBVjBBFbwxwQqEiiUJGg1BVGAFe7dV28WYLYZFmF2Th1UD7JGjymGyn1iK5OyzIBGB1HgrLZhamzumQAGJwSqnSCh1q3GOCodxt4cxurdcpzuN4cyhiWaF5Bg09udUmnWw1H/jV9nFuJ7Quo+8h8peThFA+047vduyMtk7fYqTl07YFdfUufMPzT5p71UdtlmYXaGS2t3mQHAsgxANdadYJopLe4QS2867EsZ4QfCNYrCFbjdDPmgkYyWFxgVf04ifJf6ScNdRUW1XBb6FU5TjF5EpSSrGu/s5lN+g5z/opvVpfoOc/wCim9WtdHnatvObJXDW7xLGhB8nrPaY9/HCr+tEdPCVaSeDoYLnqF63lzW4/PFSW3ecxbI84VSzWUwUaSdg0DXXK5nvAipnd6qgKvWnQO7pri9ZUEmm3Vl2j1kr8pRlFRyquBNZjGxQ/S56Y1S2fu9OVueon11Szahoou06QoQUXadIVCD2FJJ7R+U89dMydv8Axdn+TH9muZye0flPPXQstlK5Tbka1gUjlC1q0vVLkeb6r+O3Tx9xcY1nt8c0NrZCyiOE1108NYjGv1joo7Js1jzKyScYLIvkzL6LDwHXVJksH9Sb49dKNq0tj1jA6uriOCL+02FWX7iVtZX1/AzaHTyeoauKn2MX9W79zebiZCuR5MjSrhfXuEtwTrUeZH+yNfdrRNcxI6IzhXlJEak6WIGJ2Rw4ChWnChndtlVBLMdQA0k1gbXNMzzDfDLs6mjaPKppJbWwJ1bOwwxw43OnHh71YT3DpfWUJmFlb5jHHDdeXBHIsrRea5TSqvxqG04cNN62vetoCS4tre5mgnkGE9q+3DKOkuI2WX6LDQRRHWDh1UCtwj7QRg2wdl8Djgw1qe7XvW0BQ3kfZ7mSLgU+T9E6RVbnuVrnWVSWqj+Lt8ZbRuHEdKPkYVcZ2MJY5fSGyeVar45+rkWQHAqccalPE5km1htWK5nK4Wnt5FuUBUwOMG4nGkA/BXUrW4S6torlOjMgcd/xVn7rLo7zKs0uEjCNeSvdwoBhgsZxX1l2j36k3Lu+uyprdj5Vs5A+i/lD48a0aaVJOPi7jB6lbzWozpjB48pf1NDXNN4vfl7+Z4BXS65pvF78vfzPAK71XTHmZ/S/yT+jvJ7L3fHytz1E+upbL+Qj5W56jfXWRnsIYKLtekKEFGWvSFQgyjk9o/Keet3YthlMP/5x9msJJ7R+U89biyb/AMXEv7gD6tadL1T+kwepRrC39ZkLDMbiwMvUHRPG0bjlGg8ore/23sxBldxfMPLupNhT8yL/AORNZbdzJ484scytxgLqJY5LZj6Q2sV5G1Vud1mjjyG0ij0NEGSZToKyhjtqw4waztuiXA3qKTbSxltfGhbZlE95ZtZqxVbgiOZhrER9ph3Svk9+pJILZ4Y4DGBFCUMKjRsGPobPFhUfW0NJmljE2xJcIrcI2vFUEln1lRXd6lrazXT9GCNpD+yNqoI7mOVduNw6nzlOIoPOUa6yye1XXcbMR5GdQ3xY0BSbj31/FcTQZirJ+q431q7anbHCTZ72Bw7lbPrKBMcBWNNgbMBBh+bsjBdni0VJ1lARZs6yWiupxCuMDy6KpS2IwOo6DTr3Mre3e5tZZVUM4ZBjqOOJoWO4jkXajcOOMHGgDISvWIrdAkKR80+TzVl908bPPL3LzxOuHdifxVfiTAg92qI/w+/8gGgSyN/mR7XPVlp0lF/3L3mbVKtu5Hjbk/8AHE2Fc03i9+Xv5ngFdKNc13i9+Xv5ngFaNV0x5nn+l/kn9HeEWXu+PlbnqJ9dS2Xu9OVueon11kZ7CGCjLXpCgxRlr0hUIPYUcntH5Tz1s8vb+Bt1/dqPirGSe0flPPWusG/g4Py15q06XqlyMWvVYQ+ruI9xJOqzO9hOto/sP8tbGOFIrmWeM7IuMDMnAXXQJOUjQeOsJk0nY96ip0CYunrjaHx1t+srPJUbXBm2LrFPikwTOb+T+VhbZxGMrDXp83x1QSy2tucJpUjPETp+Cn5/ftaRvKvtp3Kx48HG3erHMzOxZiWZtLMdJNQSbbL71Vk6yynViOkqnEEfOWtPbXi3EQkGg6mXiNckjeSJxJGxR10qw0GtxuxmvbImD4CZMFlA4fRfv0BqesqqzTMZNMEDbIHtHH2QeCiZJSqMQdOGiue53mz3czQwsRbIcNHnkec3c4qAMuriz68gTIToxwOOnlp0MjxMJYW741Gs3RVldtbygE/dMcHX/moDaxTiWNZB53B3arb8/wC+4SOF4sf/AKxU9kcBsfOGHfoUHtG/RbzY5Die5HHhXdvavqiZ9Q8Jdlq4/gbKua7xe/L38zwCuhpf2Uk/Zo50kmwJKIdogDjw1VzzeL35e/meAVp1LTgqY4nn+mRauzqmqwrjzCLL3fHytz1E+upLL+Qj5W56jfXWRnroYKLtekKEFF2vSFQg9hSSe0flPPWosm/hIfoLzVl5PaPynnrRWb/w0X0F5q06XqlyM2sVYx5gmbFre/t71NY2T+0h8VbSO5SWNJUOKSAMp7jDGspmMPaLRlXS6eWve1/FRO7WYdbZm1Y/eW/R7qHxHRXGojlm3ulid6aVbaW+OALvgCLq2Hm9WxHKWqjhj6xsK1e8dm15l4niG1LZkswGsxtrPeOmsvayBJA1VItlWjptLuTdPMo7LtjRDq9naK4+WF9IrUW7BaHOljGqVHB7w2hzVoZt87d8vaNYSLl02CcRsDEbJbj71Uu7UBkvJ7/D7q2QoDxySaAO8MTXdxRVMpRp5XZOWdF/ms7R5XdyKfKWJsO/5PhrG5XlNxmEywW6bTnTxAAcJNbGSMXkM1pjgbiNo1PziPJ+Os7u7m/6ReM00ZOgxSpqYYHT3wRXMKN4ll9zUG4bQfNshu8sZVuEA2hirA4qe/VOwwrVbzbww5mI44UKRRYkbWG0S3JWctbd7u5WFfOOLHiUdJqmaipfLsIsObhWe001lMkMVvJNjhghIALMcBxCs7fxXQmkupx1bXDswGPlaTidVaEyKNXkoo4eBV+Sq7L7Vs9zcBgeyQ4GQ/MB1crmoim2orezqcowTuSeEY48jQ7oZX2PLzdyLhNd6RjrEY6I7+uspvH78vfzPAK6UAAAFGAGgAcArmu8Xvy9/M8ArTfio24RW5nnaG67uou3H/KPuqT2X8hHytz1G+upLL3enK3PUb66ys9RDBRdr0hQgou06QqEGUkntH5Tz1e238vF9BeaqKT2j8p56vbb+Xi+gvNWjTdUuRn1XTHmTh8KrJTJlt8t1CPIY44cGnpJVjTJYkmjaN9Ib4u7V923njTethRauZJV3PaW1rfLIiXEDYg6R4VYc9CXW7thfOZbKdbGZtLW8uPVY/u3GrkNUkM9zlcxUjbhfWOA90cRq4gv4LhdqN+VToNYWmnRm9NNVWNTyHc6VWBv8wt4YeHqm6xyPmroq1Z7WGFLSxTq7WLSuPSdjrkfumq5yHXDUeA92oO2SKpVumNAaoJLMXH3myp0rpJ4uKhc3tbDM5BMri1zAj79j7KTiY8TcdBpcsith0286o+sPCagEX9Pzg4zXUCp6QYse8oouCG3tk6m1BYv05W6T+IdyolxbHDAAa2OgDlNCz3ryN2WxBd5PJMg1t81eId2ukqnLlTBbfcuY+9uJLiRcvtPvHdsHK+cfRHcHDWsyawjyy0WBcDI3lTP6TeIcFV+S5OmXx9bJg1048o8Cj0V8Jq2DVu09nL80up7OxHi+oal3P8AXB/IsZS8T/YOV65zvCcc7vfzPAK3ivWCz445zeH954BXOr6I8yfSfyz+jvCLP3fHytz1G+upLP3fHytz1E+usbPaQ0UXadIUIKLtekKhB7Ckk9o/Keer22/l4/oLzVRSe0flPPV7b/y8X0F5q0abqlyM+q6Y8yQsBTDMor1o8aiaE1pbluMqS3sbLLHIhSRQyngqukhaJ9uBjo+H5aOa3ao2t34qouRlLajTalGP8v0IY8ylXQ+PKPFU/bYXOLPge6CKia0LaxTOxHu1Q7cuBd9yPEJ7TbjXKO8CajbMIF6CNIeNvJHjqIWJ7tSpYkalqVblwIdyG+RGXur0hXYJFxal+Dhq5y3slkv3Y2pD0pTr+QUClpJRUdo9XW4OLrTHtM16cZLLWkeC7y4jvlNEpcRtw1Ux27Ci448NZrTFy3nn3IQWxlgGrDZ3pza7/M8ArZo+ArF5171uvp+CqdV0R5l/psUrs2vB3hdl7vTlbnqJ9dS2Xu+PlbnqJ9dY2eshooq16QoQUXa9IVCD2FLJ7RuU89WNtmUSQqkgYMgw0accKrpPaPynnrZWG4Vi+VWmY5tnMWXG+XrIYnA0rhj0mdcTgdNdwnKDqjmduM1SRR/qlr8/4KX6pa8T/BVzDuLZXudRZblmbxXcPUNPc3KqCIwrbOzgrHEnHjoyD+3eSXkht7DeKG4umDGOJVUklfouThXfmbnZ7Cvy1vt9pmv1W1+d8FL9VteJvgq5yrcOGfLmzHN80iyyETPbptAEFo2ZG8pmUa1OFNn3Ky6W/sbDKM5hv5bx2WTZA+7RF2y52WOPJTzE+z2Dy1vt9pT/AKpacTerS/U7Tib1a04/t7kDXPY03jhN0W6sQ7K7W3q2dnrMccaDy/8At80kuZfqWYxWNtlcvUPPhiGYhWDeUy7IwYU8xPs9g8tb7faUn6pacTerTxm9oOBvVq3v9z927aynuId44LiWKNnjhAXF2UYhRg516qpsryjLr21665zFLSTaK9U2GOA87SwqY37knRU+BzOzags0s1Oyr+BKM6sxwP6tSDPLMen6vy0rvdm3Sxlu7K/S7WDDrFUDUTxgnTU826eXW7KlxmqQuwDBXUKcD+1Xee/wXuKX5XDGWLapSVcOyhEM/seJ/V+WnjeGx4pPV+Wkm6kKZlFay3Jlt7iFpYZY8ASVK6DjtDDA0f8A0Tl340/1f8Ndx8xJVWXB0KbktFFpNzdVXAC/qOwA0CQni2flrO3Vwbm5lnI2TKxbDirX/wBE5d+NcfV/wVR7xZPa5U9utvI8nWhmbbw0YEAYYAVxfhfy5rlKR4Fulu6X7mW1mzT8S4Yis/5CPlbnqJ9dSWfu9OVueon11mZvQ2i7XpChKKtekKhBlNJ7R+U89bDfGTb3a3ZX0Lcj6kdY+T2j8p560288m1kWQr6MJ+ylSAr+2cnV5renjs3H1loX+3j9XvbbtxLN9lqW4UnV5jdnjtXHxihtyZNjeSBu5J9k1BJe7xy7W5CJ/wCzuD/mTVTf2+fq97LJuLrPsNRueS7W6aJ/38x+vLVXuY+xvHaNxbf2GoCezf8A36j/APsSf8w1sLnqczTefJluYoLm5uo5F61sBshItP1cNFYe1f8A3ir/APfE/wCZUe9bB94r5jwuPsrQFhmG4l/Z2M17HdW90tuu3IkTHaCjWdIw0VVZdks9/C06yJFEp2dp+E1bbqybGTZ8vpQD7L1XRv8A7blT96Oda7tpNuuNE37Cq9KSisjyuUoxrStKllHbLlWTXsMs8chuSuwEPDqwoLe5y+YRE/gLzmqRekvKKtd4327yM/ulHxmrHJStySWVRyrjxKI2XC/CTlnlPPKTpTdFbP0L1bgrf5Lp0G3dPhQHwV0S1lzBsns3sESR8Crh9WAJGjSOKuU3E+zdZQ3oJh8IArdZXFDmOTpHa3i2+YrI2KtKy4ricBsBuHHgFXSo440+Wa2qqxjvM9uMoy+WvzWpLCWWWE28HxL6e43ojgkeSCBY1Ri5BGIUDT51cl3vm276BBqSEH4WbxV0tlkyXJcxTMb+OW6uY9mGHrCzDQwwAbTp2uKuTZ9N1uYsfRRR8WPhrm419mSSjRyiqxVK7y23B/ftuTm2oSdJyzNVw3BFn7vTlbnqF9dS2fu9OVueon11lZuQ2iLdsGFD05H2dNQGV0ntG5Tz1dWm9N1b2kVq8EVwsI2UaQaQOKhmitZGLOmk68DhSFvY+gfWNSAg7z3Qvo7yKCKIohiaNR5LKxx8qpxvjcqS0VpbxvwOAcRQPZ7D0G9Y0uz2HoH1jUCpLY7zXlpbm3eKO5QuzjrBqZji3x17PvNcyT288VvDBJbMWUovS2hslW7mFQ9nsPQPrGl2ew9A+saCod/WNxtbYsrfb17WBxx5ddD2281xC88klvDcSXEnWuzrqOGGC9zRUPZ7D0G9Y0uzWHoH1jQVCLreq6ntZbaO3it1mGy7RjTs1X2mYy20ZiCq8ZOODcdEdmsPQb1jS7PYegfWNdJuLqnQiSUlRqpFLmryxtH1Ma7Qw2gNNPOdSt0oI27p007s9h6B9Y0uz2HoH1jXX3Z+I4+1b8IJdX89xLHKQFMXQUahpxoiPN5P+onfU+A0/s9h6DesaXZ7D0D6xpG7OLbUtu0StW5JJx2bBsmbtiSiEk+cxoCWWSaVpZOk2vDVo0VYdnsPQb1jSNvZcCH1jSd2c+p1XAmFqEOmOPEfaH+BQd1ueo211IzrgFUYKNAAqI1WztCpUqVCRUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoD/9k=";

var n=n||{};n._tmp=n._tmp||{},n._LogInfos=n._LogInfos||{};var c=window;c.gl,c.WebGLRenderingContext,c.DeviceOrientationEvent,c.DeviceMotionEvent,c.AudioContext,c.AudioContext||c.webkitAudioContext,c.mozAudioContext,c=Object.prototype,c._super,c.ctor,c=null,n.ORIENTATION_PORTRAIT=0,n.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1,n.ORIENTATION_LANDSCAPE_LEFT=2,n.ORIENTATION_LANDSCAPE_RIGHT=3,n._drawingUtil=null,n._renderContext=null,n._supportRender=!1,n._canvas=null,n.container=null,n._gameDiv=null,n.isEditor="undefined"!=typeof Editor,n.each=function(t,e,i){if(t)if(t instanceof Array){for(var n=0,r=t.length;r>n;n++)if(e.call(i,t[n],n)===!1)return}else for(var s in t)if(e.call(i,t[s],s)===!1)return},n.isCrossOrigin=function(t){if(!t)return n.log("invalid URL"),!1;var e=t.indexOf("://");if(-1===e)return!1;var i=t.indexOf("/",e+3),r=-1===i?t:t.substring(0,i);return r!==location.origin},n.formatStr=function(){var t=arguments,e=t.length;if(1>e)return"";var i=t[0],n=!0;"object"==typeof i&&(n=!1);for(var r=1;e>r;++r){var s=t[r];if(n)for(;;){var o=null;if("number"==typeof s&&(o=i.match(/(%d)|(%s)/))){i=i.replace(/(%d)|(%s)/,s);break}o=i.match(/%s/),o?i=i.replace(/%s/,s):i+="    "+s;break}else i+="    "+s}return i},t("../cocos2d/core/utils"),t("../cocos2d/core/platform/CCLoader"),t("../cocos2d/core/platform/CCSys"),t("../cocos2d/core/CCGame"),function(){function t(t){var e=n.game.CONFIG_KEY,i=parseInt(t[e.renderMode])||0,r=[n.sys.OS_ANDROID],s=[];(isNaN(i)||i>2||0>i)&&(t[e.renderMode]=0),n._renderType=n.game.RENDER_TYPE_CANVAS,n._supportRender=!0,(2===i||0===i&&-1===r.indexOf(n.sys.os)&&-1===s.indexOf(n.sys.browserType))&&(n.sys.capabilities.opengl?(n._renderType=n.game.RENDER_TYPE_WEBGL,n._supportRender=!0):n._supportRender=!1),(1===i||0===i&&!n._supportRender)&&(n.sys.capabilities.canvas?(n._renderType=n.game.RENDER_TYPE_CANVAS,n._supportRender=!0):n._supportRender=!1)}function e(t,i,r){if(o[i])return null;r=r||"";var s=[],a=t[i];if(!a)throw new Error("can not find module ["+i+"]");for(var c=n.path,h=0,l=a.length;l>h;h++){var d=a[h];if(!o[d]){var u=c.extname(d);if(u)".js"===u.toLowerCase()&&s.push(c.join(r,d));else{var _=e(t,d,r);_&&(s=s.concat(_))}o[d]=1}}return s}function i(t){n._initDebugSetting(t[n.game.CONFIG_KEY.debugMode]),n._engineLoaded=!0,n.log(n.ENGINE_VERSION),c&&c()}function r(t){var r=n.game.CONFIG_KEY,s=t[r.engineDir],o=n.loader;if(n._Class)i(t);else{var a=n.path.join(s,"moduleConfig.json");o.loadJson(a,function(r,o){if(r)throw new Error(r);var a=t.modules||[],c=o.module,h=[];n.sys.capabilities.opengl&&a.indexOf("base4webgl")<0?a.splice(0,0,"base4webgl"):a.indexOf("core")<0&&a.splice(0,0,"core");for(var l=0,d=a.length;d>l;l++){var u=e(c,a[l],s);u&&(h=h.concat(u))}n.loader.loadJsWithImg(h,function(e){if(e)throw e;i(t)})})}}function s(){window.removeEventListener("load",s,!1),r(n.game.config)}var o={},a=!1,c=null;n._engineLoaded=!1,n.initEngine=function(e,i){if(a){var o=c;return void(c=function(){o&&o(),i&&i()})}c=i,!n.game.config&&e?n.game.config=e:n.game.config||n.game._loadConfig(),e=n.game.config,t(e),document.body?r(e):window.addEventListener("load",s,!1),a=!0}}();var n=n||{};switch(n._tmp=n._tmp||{},n.associateWithNative=function(t,e){},n.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},n.FMT_JPG=0,n.FMT_PNG=1,n.FMT_TIFF=2,n.FMT_RAWDATA=3,n.FMT_WEBP=4,n.FMT_UNKNOWN=5,n.getImageFormatByData=function(t){return t.length>8&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?n.FMT_PNG:t.length>2&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?n.FMT_TIFF:n.FMT_UNKNOWN},n.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new i,t.prototype.constructor=t},n.base=function(t,e,i){var n=arguments.callee.caller;if(n.superClass_)return ret=n.superClass_.constructor.apply(t,Array.prototype.slice.call(arguments,1)),ret;for(var r=Array.prototype.slice.call(arguments,2),s=!1,o=t.constructor;o;o=o.superClass_&&o.superClass_.constructor)if(o.prototype[e]===n)s=!0;else if(s)return o.prototype[e].apply(t,r);if(t[e]===n)return t.constructor.prototype[e].apply(t,r);throw Error("cc.base called from a method of one name to a method of a different name")},n.SAXParser=n._Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)),e}}),n.PlistParser=n.SAXParser.extend({parse:function(t){var e=this._parseXML(t),i=e.documentElement;if("plist"!==i.tagName)return n.warn("Not a plist file!"),{};for(var r=null,s=0,o=i.childNodes.length;o>s&&(r=i.childNodes[s],1!==r.nodeType);s++);return e=null,this._parseNode(r)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],i=0,n=t.childNodes.length;n>i;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},_parseDict:function(t){for(var e={},i=null,n=0,r=t.childNodes.length;r>n;n++){var s=t.childNodes[n];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:e[i]=this._parseNode(s))}return e}}),n.saxParser=new n.SAXParser,n.plistParser=new n.PlistParser,n._txtLoader={load:function(t,e,i,r){n.loader.loadTxt(t,r)}},n.loader.register(["txt","xml","vsh","fsh","atlas"],n._txtLoader),n._jsonLoader={load:function(t,e,i,r){n.loader.loadJson(t,r)}},n.loader.register(["json","ExportJson"],n._jsonLoader),n._jsLoader={load:function(t,e,i,r){n.loader.loadJs(t,r)}},n.loader.register(["js"],n._jsLoader),n._imgLoader={load:function(t,e,i,r){n.loader.cache[e]=n.loader.loadImg(t,function(t,i){return t?r(t):(n.textureCache.handleLoadedTexture(e),void r(null,i))})}},n.loader.register(["png","jpg","bmp","jpeg","gif","ico","tiff","webp"],n._imgLoader),n._serverImgLoader={load:function(t,e,i,r){n.loader.cache[e]=n.loader.loadImg(i.src,function(t,i){return t?r(t):(n.textureCache.handleLoadedTexture(e),void r(null,i))})}},n.loader.register(["serverImg"],n._serverImgLoader),n._plistLoader={load:function(t,e,i,r){n.loader.loadTxt(t,function(t,e){return t?r(t):void r(null,n.plistParser.parse(e))})}},n.loader.register(["plist"],n._plistLoader),n._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(t,e,i){var r=document,s=n.path,o=this.TYPE,a=document.createElement("style");a.type="text/css",r.body.appendChild(a);var c="";if(c+=isNaN(t-0)?"@font-face { font-family:"+t+"; src:":"@font-face { font-family:'"+t+"'; src:",e instanceof Array)for(var h=0,l=e.length;l>h;h++){var d=e[h];i=s.extname(d).toLowerCase(),c+="url('"+e[h]+"') format('"+o[i]+"')",c+=h===l-1?";":","}else i=i.toLowerCase(),c+="url('"+e+"') format('"+o[i]+"');";a.textContent+=c+"}";var u=document.createElement("div"),_=u.style;_.fontFamily=t,u.innerHTML=".",_.position="absolute",_.left="-100px",_.top="-100px",r.body.appendChild(u)},load:function(t,e,i,r){var s=this,o=i.type,a=i.name,c=i.srcs;n.js.isString(i)?(o=n.path.extname(i),a=n.path.basename(i,o),s._loadFont(a,i,o)):s._loadFont(a,c),document.fonts?document.fonts.load("1em "+a).then(function(){r(null,!0)},function(t){r(t)}):r(null,!0)}},n.loader.register(["font","eot","ttf","woff","svg","ttc"],n._fontLoader),n._binaryLoader={load:function(t,e,i,r){n.loader.loadBinary(t,r)}},n._csbLoader={load:function(t,e,i,r){n.loader.loadCsb(t,r)}},n.loader.register(["csb"],n._csbLoader),window.CocosEngine=n.ENGINE_VERSION="Cocos2d-JS v3.9 Beta",n.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0,n.DIRECTOR_STATS_POSITION=n.p(0,0),n.DIRECTOR_FPS_INTERVAL=.5,n.COCOSNODE_RENDER_SUBPIXEL=1,n.SPRITEBATCHNODE_RENDER_SUBPIXEL=1,n.AUTO_PREMULTIPLIED_ALPHA_FOR_PNG=0,n.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=0,n.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0,n.TEXTURE_ATLAS_USE_VAO=0,n.TEXTURE_NPOT_SUPPORT=0,n.RETINA_DISPLAY_SUPPORT=1,n.RETINA_DISPLAY_FILENAME_SUFFIX="-hd",n.USE_LA88_LABELS=1,n.SPRITE_DEBUG_DRAW=0,n.SPRITEBATCHNODE_DEBUG_DRAW=0,n.LABELBMFONT_DEBUG_DRAW=0,n.LABELATLAS_DEBUG_DRAW=0,n.IS_RETINA_DISPLAY_SUPPORTED=1,n.DEFAULT_ENGINE=n.ENGINE_VERSION+"-canvas",n.ENABLE_STACKABLE_ACTIONS=1,n.ENABLE_GL_STATE_CACHE=1,n.$=function(t){var e=this===n?document:this,i=t instanceof HTMLElement?t:e.querySelector(t);return i&&(i.find=i.find||n.$,i.hasClass=i.hasClass||function(t){return this.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},i.addClass=i.addClass||function(t){return this.hasClass(t)||(this.className&&(this.className+=" "),this.className+=t),this},i.removeClass=i.removeClass||function(t){return this.hasClass(t)&&(this.className=this.className.replace(t,"")),this},i.remove=i.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},i.appendTo=i.appendTo||function(t){return t.appendChild(this),this},i.prependTo=i.prependTo||function(t){return t.childNodes[0]?t.insertBefore(this,t.childNodes[0]):t.appendChild(this),this},i.transforms=i.transforms||function(){return this.style[n.$.trans]=n.$.translate(this.position)+n.$.rotate(this.rotation)+n.$.scale(this.scale)+n.$.skew(this.skew),this},i.position=i.position||{x:0,y:0},i.rotation=i.rotation||0,i.scale=i.scale||{x:1,y:1},i.skew=i.skew||{x:0,y:0},i.translates=function(t,e){return this.position.x=t,this.position.y=e,this.transforms(),this},i.rotate=function(t){return this.rotation=t,this.transforms(),this},i.resize=function(t,e){return this.scale.x=t,this.scale.y=e,this.transforms(),this},i.setSkew=function(t,e){return this.skew.x=t,this.skew.y=e,this.transforms(),this}),i},n.sys.browserType){case n.sys.BROWSER_TYPE_FIREFOX:n.$.pfx="Moz",n.$.hd=!0;break;case n.sys.BROWSER_TYPE_CHROME:case n.sys.BROWSER_TYPE_SAFARI:n.$.pfx="webkit",n.$.hd=!0;break;case n.sys.BROWSER_TYPE_OPERA:n.$.pfx="O",n.$.hd=!1;break;case n.sys.BROWSER_TYPE_IE:n.$.pfx="ms",n.$.hd=!1;break;default:n.$.pfx="webkit",n.$.hd=!0}switch(n.$.trans=n.$.pfx+"Transform",n.$.translate=n.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "},n.$.rotate=n.$.hd?function(t){return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "},n.$.scale=function(t){return"scale("+t.x+", "+t.y+") "},n.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"},n.$new=function(t){return n.$(document.createElement(t))},n.$.findpos=function(t){var e=0,i=0;do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:i}},n.Touches=[],n.TouchesIntergerDict={},n.DENSITYDPI_DEVICE="device-dpi",n.DENSITYDPI_HIGH="high-dpi",n.DENSITYDPI_MEDIUM="medium-dpi",n.DENSITYDPI_LOW="low-dpi",n.__BrowserGetter={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width","user-scalable":"no"},adaptationType:n.sys.browserType},window.navigator.userAgent.indexOf("OS 8_1_")>-1&&(n.__BrowserGetter.adaptationType=n.sys.BROWSER_TYPE_MIUI),n.sys.os===n.sys.OS_IOS&&(n.__BrowserGetter.adaptationType=n.sys.BROWSER_TYPE_SAFARI),n.__BrowserGetter.adaptationType){case n.sys.BROWSER_TYPE_SAFARI:n.__BrowserGetter.meta["minimal-ui"]="true",n.__BrowserGetter.availWidth=function(t){return t.clientWidth},n.__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case n.sys.BROWSER_TYPE_CHROME:n.__BrowserGetter.__defineGetter__("target-densitydpi",function(){return n.view._targetDensityDPI});case n.sys.BROWSER_TYPE_SOUGOU:case n.sys.BROWSER_TYPE_UC:n.__BrowserGetter.availWidth=function(t){return t.clientWidth},n.__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case n.sys.BROWSER_TYPE_MIUI:n.__BrowserGetter.init=function(t){if(!t.__resizeWithBrowserSize){var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}}}n.EGLView=n._Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!0,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_indexBitsUsed:0,_maxTouches:5,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_captured:!1,_wnd:null,_hDC:null,_hRC:null,_supportTouch:!1,_contentTranslateLeftTop:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var t=this,e=(document,n.ContainerStrategy),i=n.ContentStrategy;n.__BrowserGetter.init(this),t._frameSize=n.size(0,0),t._initFrameSize();var r=n.game.canvas.width,s=n.game.canvas.height;t._designResolutionSize=n.size(r,s),t._originalDesignResolutionSize=n.size(r,s),t._viewPortRect=n.rect(0,0,r,s),t._visibleRect=n.rect(0,0,r,s),t._contentTranslateLeftTop={left:0,top:0},t._viewName="Cocos2dHTML5";var o=n.sys;t.enableRetina(o.os===o.OS_IOS||o.os===o.OS_OSX),n.visibleRect&&n.visibleRect.init(t._visibleRect),t._rpExactFit=new n.ResolutionPolicy(e.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new n.ResolutionPolicy(e.PROPORTION_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new n.ResolutionPolicy(e.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new n.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new n.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_WIDTH),t._hDC=n.game.canvas,t._hRC=n._renderContext,t._targetDensityDPI=n.DENSITYDPI_HIGH},_resizeEvent:function(){var t;t=this.setDesignResolutionSize?this:n.view;var e=t._frameSize.width,i=t._frameSize.height;if(t._initFrameSize(),t._frameSize.width!==e||t._frameSize.height!==i){var r=t._originalDesignResolutionSize.width,s=t._originalDesignResolutionSize.height;r>0&&t.setDesignResolutionSize(r,s,t._resolutionPolicy),n.eventManager.dispatchCustomEvent("canvas-resize"),t._resizeCallback&&t._resizeCallback.call()}},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._resizeEvent)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._resizeEvent))},setResizeCallback:function(t){(n.js.isFunction(t)||null==t)&&(this._resizeCallback=t)},_initFrameSize:function(){var t=this._frameSize;t.width=n.__BrowserGetter.availWidth(n.game.frame),t.height=n.__BrowserGetter.availHeight(n.game.frame)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;t>0&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var n,r,s,o=document.getElementsByName("viewport"),a=o?o[0]:null;n=a?a.content:"",i=i||document.createElement("meta"),i.id="cocosMetaElement",i.name="viewport",i.content="";for(r in t)-1==n.indexOf(r)?n+=","+r+"="+t[r]:e&&(s=new RegExp(r+"s*=s*[^,]+"),n.replace(s,r+"="+t[r]));/^,/.test(n)&&(n=n.substr(1)),i.content=n,a&&(a.content=n),document.head.appendChild(i)},_adjustViewportMeta:function(){this._isAdjustViewPort&&this._setViewportMeta(n.__BrowserGetter.meta,!1)},_setScaleXYForRenderTexture:function(){var t=n.contentScaleFactor();this._scaleX=t,this._scaleY=t},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=t?!0:!1},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(t){this._autoFullScreen=t?!0:!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return null!==this._hDC&&null!==this._hRC},setFrameZoomFactor:function(t){this._frameZoomFactor=t,this.centerWindow(),n.director.setProjection(n.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(t){},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},setCanvasSize:function(t,e){var i=n.game.canvas,r=n.game.container;i.width=t*this._devicePixelRatio,i.height=e*this._devicePixelRatio,i.style.width=t+"px",i.style.height=e+"px",r.style.width=t+"px",r.style.height=e+"px",this._resizeEvent()},getCanvasSize:function(){return n.size(n.game.canvas.width,n.game.canvas.height)},getFrameSize:function(){return n.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,n.game.frame.style.width=t+"px",n.game.frame.style.height=e+"px",this._resizeEvent(),n.director.setProjection(n.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return n.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return n.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return n.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return n.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e=this;if(t instanceof n.ResolutionPolicy)e._resolutionPolicy=t;else{var i=n.ResolutionPolicy;t===i.EXACT_FIT&&(e._resolutionPolicy=e._rpExactFit),t===i.SHOW_ALL&&(e._resolutionPolicy=e._rpShowAll),t===i.NO_BORDER&&(e._resolutionPolicy=e._rpNoBorder),t===i.FIXED_HEIGHT&&(e._resolutionPolicy=e._rpFixedHeight),t===i.FIXED_WIDTH&&(e._resolutionPolicy=e._rpFixedWidth)}},setDesignResolutionSize:function(t,e,i){if(!(t>0||e>0))return void n.log(n._LogInfos.view.setDesignResolutionSize);this.setResolutionPolicy(i);var r=this._resolutionPolicy;if(!r)return void n.log(n._LogInfos.view.setDesignResolutionSize_2);r.preApply(this),n.sys.isMobile&&this._adjustViewportMeta(),this._initFrameSize(),this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var s=r.apply(this,this._designResolutionSize);if(s.scale&&2===s.scale.length&&(this._scaleX=s.scale[0],this._scaleY=s.scale[1]),s.viewport){var o=this._viewPortRect,a=this._visibleRect,c=s.viewport;o.x=c.x,o.y=c.y,o.width=c.width,o.height=c.height,a.x=-o.x/this._scaleX,a.y=-o.y/this._scaleY,a.width=n.game.canvas.width/this._scaleX,a.height=n.game.canvas.height/this._scaleY,n._renderContext.setOffset&&n._renderContext.setOffset(o.x,-o.y)}var h=n.director;h._winSizeInPoints.width=this._designResolutionSize.width,h._winSizeInPoints.height=this._designResolutionSize.height,r.postApply(this),n.winSize.width=h._winSizeInPoints.width,n.winSize.height=h._winSizeInPoints.height,n._renderType===n.game.RENDER_TYPE_WEBGL&&h.setGLDefaultValues(),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,n.DOM&&n.DOM._resetEGLViewDiv(),n.visibleRect&&n.visibleRect.init(this._visibleRect)},getDesignResolutionSize:function(){return n.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t,"user-scalable":"no"},!0),document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},setViewPortInPoints:function(t,e,i,r){var s=this._frameZoomFactor,o=this._scaleX,a=this._scaleY;n._renderContext.viewport(t*o*s+this._viewPortRect.x*s,e*a*s+this._viewPortRect.y*s,i*o*s,r*a*s)},setScissorInPoints:function(t,e,i,r){var s=this._frameZoomFactor,o=this._scaleX,a=this._scaleY;n._renderContext.scissor(t*o*s+this._viewPortRect.x*s,e*a*s+this._viewPortRect.y*s,i*o*s,r*a*s)},isScissorEnabled:function(){var t=n._renderContext;return t.isEnabled(t.SCISSOR_TEST)},getScissorRect:function(){var t=n._renderContext,e=this._scaleX,i=this._scaleY,r=t.getParameter(t.SCISSOR_BOX);return n.rect((r[0]-this._viewPortRect.x)/e,(r[1]-this._viewPortRect.y)/i,r[2]/e,r[3]/i)},setViewName:function(t){null!=t&&t.length>0&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){return{x:this._devicePixelRatio*(t-i.left),y:this._devicePixelRatio*(i.top+i.height-e)}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect,n=this;t.x=(n._devicePixelRatio*(t.x-e.left)-i.x)/n._scaleX,t.y=(n._devicePixelRatio*(e.top+e.height-t.y)-i.y)/n._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n,r=this._viewPortRect,s=this._scaleX,o=this._scaleY,a=0;a<t.length;a++)e=t[a],i=e._point,n=e._prevPoint,e._setPoint((i.x-r.x)/s,(i.y-r.y)/o),e._setPrevPoint((n.x-r.x)/s,(n.y-r.y)/o)}}),n.EGLView._getInstance=function(){return this._instance||(this._instance=this._instance||new n.EGLView,this._instance.initialize()),this._instance},n.ContainerStrategy=n._Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var r=n.game.frame;n.view._autoFullScreen&&n.sys.isMobile&&r===document.documentElement&&n.screen.autoFullScreen(r);var s=n.game.canvas,o=n.game.container;o.style.width=s.style.width=e+"px",o.style.height=s.style.height=i+"px";var a=t._devicePixelRatio=1;t.isRetinaEnabled()&&(a=t._devicePixelRatio=window.devicePixelRatio||1),s.width=e*a,s.height=i*a,n._renderContext.resetCache&&n._renderContext.resetCache();var c,h=document.body;h&&(c=h.style)&&(c.paddingTop=c.paddingTop||"0px",c.paddingRight=c.paddingRight||"0px",c.paddingBottom=c.paddingBottom||"0px",c.paddingLeft=c.paddingLeft||"0px",c.borderTop=c.borderTop||"0px",c.borderRight=c.borderRight||"0px",c.borderBottom=c.borderBottom||"0px",c.borderLeft=c.borderLeft||"0px",c.marginTop=c.marginTop||"0px",c.marginRight=c.marginRight||"0px",c.marginBottom=c.marginBottom||"0px",c.marginLeft=c.marginLeft||"0px")},_fixContainer:function(){document.body.insertBefore(n.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var e=n.container.style;e.position="fixed",e.left=e.top="0px",document.body.scrollTop=0}}),n.ContentStrategy=n._Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,r,s,o){Math.abs(t-i)<2&&(i=t),Math.abs(e-r)<2&&(r=e);var a=n.rect(Math.round((t-i)/2),Math.round((e-r)/2),i,r);return n._renderType===n.game.RENDER_TYPE_CANVAS,this._result.scale=[s,o],this._result.viewport=a,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),function(){var t=n.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,t._frameSize.width,t._frameSize.height)}}),e=n.ContainerStrategy.extend({apply:function(t,e){var i,r,s=t._frameSize.width,o=t._frameSize.height,a=n.container.style,c=e.width,h=e.height,l=s/c,d=o/h;d>l?(i=s,r=h*l):(i=c*d,r=o);var u=Math.round((s-i)/2),_=Math.round((o-r)/2);i=s-2*u,r=o-2*_,this._setupContainer(t,i,r),a.marginLeft=u+"px",a.marginRight=u+"px",a.marginTop=_+"px",a.marginBottom=_+"px"}}),i=(t.extend({preApply:function(t){this._super(t),n.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),e.extend({preApply:function(t){this._super(t),n.game.frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),n.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,n.game.canvas.width,n.game.canvas.height)}}));n.ContainerStrategy.EQUAL_TO_FRAME=new t,n.ContainerStrategy.PROPORTION_TO_FRAME=new e,n.ContainerStrategy.ORIGINAL_CONTAINER=new i;var r=n.ContentStrategy.extend({apply:function(t,e){var i=n.game.canvas.width,r=n.game.canvas.height,s=i/e.width,o=r/e.height;return this._buildResult(i,r,i,r,s,o)}}),s=n.ContentStrategy.extend({apply:function(t,e){var i,r,s=n.game.canvas.width,o=n.game.canvas.height,a=e.width,c=e.height,h=s/a,l=o/c,d=0;return l>h?(d=h,i=s,r=c*d):(d=l,i=a*d,r=o),this._buildResult(s,o,i,r,d,d)}}),o=n.ContentStrategy.extend({apply:function(t,e){var i,r,s,o=n.game.canvas.width,a=n.game.canvas.height,c=e.width,h=e.height,l=o/c,d=a/h;return d>l?(i=d,r=c*i,s=a):(i=l,r=o,s=h*i),this._buildResult(o,a,r,s,i,i)}}),a=n.ContentStrategy.extend({apply:function(t,e){var i=n.game.canvas.width,r=n.game.canvas.height,s=e.height,o=r/s,a=i,c=r;return this._buildResult(i,r,a,c,o,o)},postApply:function(t){n.director._winSizeInPoints=t.getVisibleSize()}}),c=n.ContentStrategy.extend({apply:function(t,e){var i=n.game.canvas.width,r=n.game.canvas.height,s=e.width,o=i/s,a=i,c=r;return this._buildResult(i,r,a,c,o,o)},postApply:function(t){n.director._winSizeInPoints=t.getVisibleSize()}});n.ContentStrategy.EXACT_FIT=new r,n.ContentStrategy.SHOW_ALL=new s,n.ContentStrategy.NO_BORDER=new o,n.ContentStrategy.FIXED_HEIGHT=new a,n.ContentStrategy.FIXED_WIDTH=new c}(),n.ResolutionPolicy=n._Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof n.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof n.ContentStrategy&&(this._contentStrategy=t)}}),n.js.get(n.ResolutionPolicy.prototype,"canvasSize",function(){return n.v2(n.game.canvas.width,n.game.canvas.height)}),n.ResolutionPolicy.EXACT_FIT=0,n.ResolutionPolicy.NO_BORDER=1,n.ResolutionPolicy.SHOW_ALL=2,n.ResolutionPolicy.FIXED_HEIGHT=3,n.ResolutionPolicy.FIXED_WIDTH=4,n.ResolutionPolicy.UNKNOWN=5,n.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i,n=this._fnMap;for(t=0,l=n.length;t<l;t++)if(e=n[t],e&&e[1]in document){for(t=0,i=e.length;i>t;t++)this._fn[n[0][t]]=e[t];break}this._supportsFullScreen="undefined"!=typeof this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return this._supportsFullScreen?void 0===document[this._fn.fullscreenElement]||null===document[this._fn.fullscreenElement]?!1:!0:!1},requestFullScreen:function(t,e){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var i=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(i,this._preOnFullScreenChange),this._preOnFullScreenChange=e,document.addEventListener(i,e,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return this._supportsFullScreen?document[this._fn.exitFullscreen]():!0},autoFullScreen:function(t,e){function i(){s.requestFullScreen(t,e),r.removeEventListener(s._touchEvent,i)}t=t||document.body;var r=n._canvas||t,s=this;this.requestFullScreen(t,e),r.addEventListener(this._touchEvent,i)}},n.screen.init(),n.visibleRect={topLeft:n.p(0,0),topRight:n.p(0,0),top:n.p(0,0),bottomLeft:n.p(0,0),bottomRight:n.p(0,0),bottom:n.p(0,0),center:n.p(0,0),left:n.p(0,0),right:n.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,r=t.y,s=r+i,o=n+e;this.topLeft.x=n,this.topLeft.y=s,this.topRight.x=o,this.topRight.y=s,this.top.x=n+e/2,this.top.y=s,this.bottomLeft.x=n,this.bottomLeft.y=r,this.bottomRight.x=o,this.bottomRight.y=r,this.bottom.x=n+e/2,this.bottom.y=r,this.center.x=n+e/2,this.center.y=r+i/2,this.left.x=n,this.left.y=r+i/2,this.right.x=o,this.right.y=r+i/2}},n.POINT_EPSILON=parseFloat("1.192092896e-07F"),n.pNeg=function(t){return n.p(-t.x,-t.y)},n.pAdd=function(t,e){return n.p(t.x+e.x,t.y+e.y)},n.pSub=function(t,e){return n.p(t.x-e.x,t.y-e.y)},n.pMult=function(t,e){return n.p(t.x*e,t.y*e)},n.pMidpoint=function(t,e){return n.pMult(n.pAdd(t,e),.5)},n.pDot=function(t,e){return t.x*e.x+t.y*e.y},n.pCross=function(t,e){return t.x*e.y-t.y*e.x},n.pPerp=function(t){return n.p(-t.y,t.x)},n.pRPerp=function(t){return n.p(t.y,-t.x)},n.pProject=function(t,e){return n.pMult(e,n.pDot(t,e)/n.pDot(e,e))},n.pRotate=function(t,e){return n.p(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)},n.pUnrotate=function(t,e){return n.p(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},n.pLengthSQ=function(t){return n.pDot(t,t)},n.pDistanceSQ=function(t,e){return n.pLengthSQ(n.pSub(t,e))},n.pLength=function(t){return Math.sqrt(n.pLengthSQ(t))},n.pDistance=function(t,e){return n.pLength(n.pSub(t,e))},n.pNormalize=function(t){var e=n.pLength(t);return 0===e?n.p(t):n.pMult(t,1/e)},n.pForAngle=function(t){return n.p(Math.cos(t),Math.sin(t))},n.pToAngle=function(t){return Math.atan2(t.y,t.x)},n.clampf=function(t,e,i){if(e>i){var n=e;e=i,i=n}return e>t?e:i>t?t:i},n.clamp01=function(t){return 0>t?0:1>t?t:1},n.pClamp=function(t,e,i){return n.p(n.clampf(t.x,e.x,i.x),n.clampf(t.y,e.y,i.y))},n.pFromSize=function(t){return n.p(t.width,t.height)},n.pCompOp=function(t,e){return n.p(e(t.x),e(t.y))},n.pLerp=function(t,e,i){return n.pAdd(n.pMult(t,1-i),n.pMult(e,i))},n.pFuzzyEqual=function(t,e,i){return t.x-i<=e.x&&e.x<=t.x+i&&t.y-i<=e.y&&e.y<=t.y+i?!0:!1},n.pCompMult=function(t,e){return n.p(t.x*e.x,t.y*e.y)},n.pAngleSigned=function(t,e){var i=n.pNormalize(t),r=n.pNormalize(e),s=Math.atan2(i.x*r.y-i.y*r.x,n.pDot(i,r));return Math.abs(s)<n.POINT_EPSILON?0:s},n.pAngle=function(t,e){var i=Math.acos(n.pDot(n.pNormalize(t),n.pNormalize(e)));return Math.abs(i)<n.POINT_EPSILON?0:i;

},n.pRotateByAngle=function(t,e,i){var r=n.pSub(t,e),s=Math.cos(i),o=Math.sin(i),a=r.x;return r.x=a*s-r.y*o+e.x,r.y=a*o+r.y*s+e.y,r},n.pLineIntersect=function(t,e,i,n,r){if(t.x===e.x&&t.y===e.y||i.x===n.x&&i.y===n.y)return!1;var s=e.x-t.x,o=e.y-t.y,a=n.x-i.x,c=n.y-i.y,h=t.x-i.x,l=t.y-i.y,d=c*s-a*o;return r.x=a*l-c*h,r.y=s*l-o*h,0===d?0===r.x||0===r.y?!0:!1:(r.x=r.x/d,r.y=r.y/d,!0)},n.pSegmentIntersect=function(t,e,i,r){var s=n.p(0,0);return n.pLineIntersect(t,e,i,r,s)&&s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1?!0:!1},n.pIntersectPoint=function(t,e,i,r){var s=n.p(0,0);if(n.pLineIntersect(t,e,i,r,s)){var o=n.p(0,0);return o.x=t.x+s.x*(e.x-t.x),o.y=t.y+s.x*(e.y-t.y),o}return n.p(0,0)},n.pSameAs=function(t,e){return null!=t&&null!=e?t.x===e.x&&t.y===e.y:!1},n.pZeroIn=function(t){t.x=0,t.y=0},n.pIn=function(t,e){t.x=e.x,t.y=e.y},n.pMultIn=function(t,e){t.x*=e,t.y*=e},n.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y},n.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y},n.pNormalizeIn=function(t){n.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))},n.vertexLineToPolygon=function(t,e,i,r,s){if(s+=r,!(1>=s)){e*=.5;for(var o,a=s-1,c=r;s>c;c++){o=2*c;var h,l=n.p(t[2*c],t[2*c+1]);if(0===c)h=n.pPerp(n.pNormalize(n.pSub(l,n.p(t[2*(c+1)],t[2*(c+1)+1]))));else if(c===a)h=n.pPerp(n.pNormalize(n.pSub(n.p(t[2*(c-1)],t[2*(c-1)+1]),l)));else{var d=n.p(t[2*(c-1)],t[2*(c-1)+1]),u=n.p(t[2*(c+1)],t[2*(c+1)+1]),_=n.pNormalize(n.pSub(u,l)),f=n.pNormalize(n.pSub(d,l)),p=Math.acos(n.pDot(_,f));h=p<n.degreesToRadians(70)?n.pPerp(n.pNormalize(n.pMidpoint(_,f))):p<n.degreesToRadians(170)?n.pNormalize(n.pMidpoint(_,f)):n.pPerp(n.pNormalize(n.pSub(u,d)))}h=n.pMult(h,e),i[2*o]=l.x+h.x,i[2*o+1]=l.y+h.y,i[2*(o+1)]=l.x-h.x,i[2*(o+1)+1]=l.y-h.y}for(r=0===r?0:r-1,c=r;a>c;c++){o=2*c;var g=o+2,m=n.vertex2(i[2*o],i[2*o+1]),y=n.vertex2(i[2*(o+1)],i[2*(o+1)+1]),v=n.vertex2(i[2*g],i[2*g]),T=n.vertex2(i[2*(g+1)],i[2*(g+1)+1]),C=!n.vertexLineIntersect(m.x,m.y,T.x,T.y,y.x,y.y,v.x,v.y);C.isSuccess||(C.value<0||C.value>1)&&(C.isSuccess=!0),C.isSuccess&&(i[2*g]=T.x,i[2*g+1]=T.y,i[2*(g+1)]=v.x,i[2*(g+1)+1]=v.y)}}},n.vertexLineIntersect=function(t,e,i,n,r,s,o,a){var c,h,l,d;if(t===i&&e===n||r===o&&s===a)return{isSuccess:!1,value:0};if(i-=t,n-=e,r-=t,s-=e,o-=t,a-=e,c=Math.sqrt(i*i+n*n),h=i/c,l=n/c,d=r*h+s*l,s=s*h-r*l,r=d,d=o*h+a*l,a=a*h-o*l,o=d,s===a)return{isSuccess:!1,value:0};var u=(o+(r-o)*a/(a-s))/c;return{isSuccess:!0,value:u}},n.vertexListIsClockwise=function(t){for(var e=0,i=t.length;i>e;e++){var r=t[e],s=t[(e+1)%i],o=t[(e+2)%i];if(n.pCross(n.pSub(s,r),n.pSub(o,s))>0)return!1}return!0},n.CGAffineToGL=function(t,e){e[2]=e[3]=e[6]=e[7]=e[8]=e[9]=e[11]=e[14]=0,e[10]=e[15]=1,e[0]=t.a,e[4]=t.c,e[12]=t.tx,e[1]=t.b,e[5]=t.d,e[13]=t.ty},n.GLToCGAffine=function(t,e){e.a=t[0],e.c=t[4],e.tx=t[12],e.b=t[1],e.d=t[5],e.ty=t[13]},n.Touch=n._Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(t,e,i){this.setTouchInfo(i,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return n.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){return n.log("getId is deprecated. Please use getID instead."),this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=n.p(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=n.p(this._point),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?n.p(t.x,t.y):n.p(t||0,e||0)}});var h=n.js,d=n.Event;n.Event.TOUCH="touch",n.Event.MOUSE="mouse",n.Event.FOCUS="focus",n.Event.KEYBOARD="keyboard",n.Event.ACCELERATION="acceleration";var u=function(t,e){n.Event.call(this,n.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0};h.extend(u,n.Event),h.mixin(u.prototype,{setScrollData:function(t,e){this._scrollX=t,this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(t,e){this._x=t,this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:n.view._designResolutionSize.height-this._y}},_setPrevCursor:function(t,e){this._prevX=t,this._prevY=e},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(t){this._button=t},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}}),u.NONE=0,u.DOWN=1,u.UP=2,u.MOVE=3,u.SCROLL=4,u.BUTTON_LEFT=0,u.BUTTON_RIGHT=2,u.BUTTON_MIDDLE=1,u.BUTTON_4=3,u.BUTTON_5=4,u.BUTTON_6=5,u.BUTTON_7=6,u.BUTTON_8=7,EventTouch=function(t,e){n.Event.call(this,n.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.currentTouch=null},h.extend(EventTouch,n.Event),h.mixin(EventTouch.prototype,{getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(t){this._eventCode=t},_setTouches:function(t){this._touches=t}}),EventTouch.MAX_TOUCHES=5,EventTouch.BEGAN=0,EventTouch.MOVED=1,EventTouch.ENDED=2,EventTouch.CANCELED=3,EventFocus=function(t,e,i){n.Event.call(this,n.Event.FOCUS,i),this._widgetGetFocus=t,this._widgetLoseFocus=e},h.extend(EventFocus,n.Event),EventAcceleration=function(t,e){n.Event.call(this,d.ACCELERATION,e),this._acc=t},h.extend(EventAcceleration,n.Event),EventKeyboard=function(t,e,i){n.Event.call(this,d.KEYBOARD,i),this._keyCode=t,this._isPressed=e},h.extend(EventKeyboard,n.Event),n.Event.EventMouse=u,n.Event.EventTouch=EventTouch,n.Event.EventFocus=EventFocus,n.Event.EventAcceleration=EventAcceleration,n.Event.EventKeyboard=EventKeyboard,e.exports=d,n.EventListener=n._Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_target:null,_paused:!0,_isEnabled:!0,ctor:function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||""},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){n.Node&&t instanceof n.Node?(this._target=t,this._node=t._sgNode):n.Component&&t instanceof n.Component?(this._target=t,this._node=t.node._sgNode):(this._target=t,this._node=t)},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),n.EventListener.UNKNOWN=0,n.EventListener.TOUCH_ONE_BY_ONE=1,n.EventListener.TOUCH_ALL_AT_ONCE=2,n.EventListener.KEYBOARD=3,n.EventListener.MOUSE=4,n.EventListener.ACCELERATION=5,n.EventListener.ACCELERATION=6,n.EventListener.CUSTOM=8,n.EventListener.FOCUS=7,n._EventListenerCustom=n.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e;var i=this,r=function(t){null!==i._onCustomEvent&&i._onCustomEvent(t)};n.EventListener.prototype.ctor.call(this,n.EventListener.CUSTOM,t,r)},checkAvailable:function(){return n.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new n._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),n._EventListenerCustom.create=function(t,e){return new n._EventListenerCustom(t,e)},n._EventListenerMouse=n.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var t=this,e=function(e){var i=n.Event.EventMouse;switch(e._eventType){case i.DOWN:t.onMouseDown&&t.onMouseDown(e);break;case i.UP:t.onMouseUp&&t.onMouseUp(e);break;case i.MOVE:t.onMouseMove&&t.onMouseMove(e);break;case i.SCROLL:t.onMouseScroll&&t.onMouseScroll(e)}};n.EventListener.prototype.ctor.call(this,n.EventListener.MOUSE,n._EventListenerMouse.LISTENER_ID,e)},clone:function(){var t=new n._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),n._EventListenerMouse.LISTENER_ID="__cc_mouse",n._EventListenerMouse.create=function(){return new n._EventListenerMouse},n._EventListenerTouchOneByOne=n.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){n.EventListener.prototype.ctor.call(this,n.EventListener.TOUCH_ONE_BY_ONE,n._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new n._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return this.onTouchBegan?!0:(n.log(n._LogInfos._checkEventListenerAvailable.touchOneByOne),!1)}}),n._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",n._EventListenerTouchOneByOne.create=function(){return new n._EventListenerTouchOneByOne},n._EventListenerTouchAllAtOnce=n.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){n.EventListener.prototype.ctor.call(this,n.EventListener.TOUCH_ALL_AT_ONCE,n._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new n._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null===this.onTouchesBegan&&null===this.onTouchesMoved&&null===this.onTouchesEnded&&null===this.onTouchesCancelled?(n.log(n._LogInfos._checkEventListenerAvailable.touchAllAtOnce),!1):!0}}),n._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",n._EventListenerTouchAllAtOnce.create=function(){return new n._EventListenerTouchAllAtOnce},n.EventListener.create=function(t){n.assert(t&&t.event,n._LogInfos.EventListener.create);var e=t.event;delete t.event;var i=null;e===n.EventListener.TOUCH_ONE_BY_ONE?i=new n._EventListenerTouchOneByOne:e===n.EventListener.TOUCH_ALL_AT_ONCE?i=new n._EventListenerTouchAllAtOnce:e===n.EventListener.MOUSE?i=new n._EventListenerMouse:e===n.EventListener.CUSTOM?(i=new n._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):e===n.EventListener.KEYBOARD?i=new n._EventListenerKeyboard:e===n.EventListener.ACCELERATION?(i=new n._EventListenerAcceleration(t.callback),delete t.callback):e===n.EventListener.FOCUS&&(i=new n._EventListenerFocus);for(var r in t)i[r]=t[r];return i},n._EventListenerFocus=n.EventListener.extend({clone:function(){var t=new n._EventListenerFocus;return t.onFocusChanged=this.onFocusChanged,t},checkAvailable:function(){return this.onFocusChanged?!0:(n.log("Invalid EventListenerFocus!"),!1)},onFocusChanged:null,ctor:function(){var t=function(t){this.onFocusChanged&&this.onFocusChanged(t._widgetLoseFocus,t._widgetGetFocus)};n.EventListener.prototype.ctor.call(this,n.EventListener.FOCUS,n._EventListenerFocus.LISTENER_ID,t)}}),n._EventListenerFocus.LISTENER_ID="__cc_focus_event",n._EventListenerAcceleration=n.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t;var e=this,i=function(t){e._onAccelerationEvent(t._acc,t)};n.EventListener.prototype.ctor.call(this,n.EventListener.ACCELERATION,n._EventListenerAcceleration.LISTENER_ID,i)},checkAvailable:function(){return n.assert(this._onAccelerationEvent,n._LogInfos._checkEventListenerAvailable.acceleration),!0},clone:function(){return new n._EventListenerAcceleration(this._onAccelerationEvent)}}),n._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",n._EventListenerAcceleration.create=function(t){return new n._EventListenerAcceleration(t)},n._EventListenerKeyboard=n.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var t=this,e=function(e){e._isPressed?t.onKeyPressed&&t.onKeyPressed(e._keyCode,e):t.onKeyReleased&&t.onKeyReleased(e._keyCode,e)};n.EventListener.prototype.ctor.call(this,n.EventListener.KEYBOARD,n._EventListenerKeyboard.LISTENER_ID,e)},clone:function(){var t=new n._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null===this.onKeyPressed&&null===this.onKeyReleased?(n.log(n._LogInfos._checkEventListenerAvailable.keyboard),!1):!0}}),n._EventListenerKeyboard.LISTENER_ID="__cc_keyboard",n._EventListenerKeyboard.create=function(){return new n._EventListenerKeyboard},n._EventListenerVector=n._Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),n.__getListenerID=function(t){var e=n.Event,i=t.getType();return i===e.ACCELERATION?n._EventListenerAcceleration.LISTENER_ID:i===e.KEYBOARD?n._EventListenerKeyboard.LISTENER_ID:i===e.MOUSE?n._EventListenerMouse.LISTENER_ID:i===e.FOCUS?n._EventListenerFocus.LISTENER_ID:(i===e.TOUCH&&n.log(n._LogInfos._getListenerID),i)},n.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[n.game.EVENT_HIDE,n.game.EVENT_SHOW],_setDirtyForNode:function(t){null!=this._nodeListenersMap[t.__instanceId]&&this._dirtyNodes.push(t);for(var e=t.getChildren(),i=0,n=e.length;n>i;i++)this._setDirtyForNode(e[i])},pauseTarget:function(t,e){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;n>i;i++)r[i]._setPaused(!0);if(e===!0){var s=t.getChildren();for(i=0,n=s.length;n>i;i++)this.pauseTarget(s[i],!0)}},resumeTarget:function(t,e){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;n>i;i++)r[i]._setPaused(!1);if(this._setDirtyForNode(t),e===!0){var s=t.getChildren();for(i=0,n=s.length;n>i;i++)this.resumeTarget(s[i],!0)}},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];if(i||(i=new n._EventListenerVector,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var r=t._getSceneGraphPriority();null===r&&n.log(n._LogInfos.EventManager._forceAddEventListener),this._associateNodeAndEventListener(r,t),r.isRunning()&&this.resumeTarget(r)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,e,i=this._dirtyNodes,n=this._nodeListenersMap,r=0,s=i.length;s>r;r++)if(t=n[i[r].__instanceId])for(var o=0,a=t.length;a>o;o++)e=t[o],e&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,i=0;i<t.length;)e=t[i],e._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch?n.js.array.remove(t,e):++i},_removeListenersForListenerID:function(t){var e,i=this._listenersMap[t];if(i){var r=i.getFixedPriorityListeners(),s=i.getSceneGraphPriorityListeners();this._removeAllListenersInVector(s),this._removeAllListenersInVector(r),delete this._priorityDirtyFlagMap[t],this._inDispatch||(i.clear(),delete this._listenersMap[t])}var o,a=this._toAddedListeners;for(e=0;e<a.length;)o=a[e],o&&o._getListenerID()===t?n.js.array.remove(a,o):++e},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;if(i[t]&&(e=i[t]),e!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY)){var r=n.director.getRunningScene();r?this._sortListenersOfSceneGraphPriority(t,r):i[t]=this.DIRTY_SCENE_GRAPH_PRIORITY}},_sortListenersOfSceneGraphPriority:function(t,e){var i=this._getListeners(t);if(i){var n=i.getSceneGraphPriorityListeners();n&&0!==n.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),i.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=n.eventManager._nodePriorityMap,r=t._getSceneGraphPriority(),s=e._getSceneGraphPriority();return e&&s&&i[s.__instanceId]?t&&r&&i[r.__instanceId]?i[e._getSceneGraphPriority().__instanceId]-i[t._getSceneGraphPriority().__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners();if(i&&0!==i.length){i.sort(this._sortListenersOfFixedPriorityAsc);for(var n=0,r=i.length;r>n&&!(i[n]._getFixedPriority()>=0);)++n;e.gt0Index=n}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e=this._listenersMap[t];if(e){var i,r,s=e.getFixedPriorityListeners(),o=e.getSceneGraphPriorityListeners();if(o)for(i=0;i<o.length;)r=o[i],r._isRegistered()?++i:n.js.array.remove(o,r);if(s)for(i=0;i<s.length;)r=s[i],r._isRegistered()?++i:n.js.array.remove(s,r);o&&0===o.length&&e.clearSceneGraphListeners(),s&&0===s.length&&e.clearFixedListeners()}},_updateListeners:function(t){var e=this._inDispatch;if(n.assert(e>0,n._LogInfos.EventManager._updateListeners),!(e>1)){t.getType()===n.Event.TOUCH?(this._onUpdateListeners(n._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(n._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(n.__getListenerID(t)),n.assert(1===e,n._LogInfos.EventManager._updateListeners_2);var i=this._listenersMap,r=this._priorityDirtyFlagMap;for(var s in i)i[s].empty()&&(delete r[s],delete i[s]);var o=this._toAddedListeners;if(0!==o.length){for(var a=0,c=o.length;c>a;a++)this._forceAddEventListener(o[a]);this._toAddedListeners.length=0}}},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var i=e.event,r=i.currentTouch;i.currentTarget=t._node;var s,o=!1,a=i.getEventCode(),c=n.Event.EventTouch;return a===c.BEGAN?t.onTouchBegan&&(o=t.onTouchBegan(r,i),o&&t._registered&&t._claimedTouches.push(r)):t._claimedTouches.length>0&&-1!==(s=t._claimedTouches.indexOf(r))&&(o=!0,a===c.MOVED&&t.onTouchMoved?t.onTouchMoved(r,i):a===c.ENDED?(t.onTouchEnded&&t.onTouchEnded(r,i),t._registered&&t._claimedTouches.splice(s,1)):a===c.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(r,i),t._registered&&t._claimedTouches.splice(s,1))),i.isStopped()?(n.eventManager._updateListeners(i),!0):o&&t._registered&&t.swallowTouches?(e.needsMutableSet&&e.touches.splice(r,1),!0):!1},_dispatchTouchEvent:function(t){this._sortEventListeners(n._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(n._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(n._EventListenerTouchOneByOne.LISTENER_ID),i=this._getListeners(n._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==e||null!==i){var r=t.getTouches(),s=n.js.array.copy(r),o={event:t,needsMutableSet:e&&i,touches:s,selTouch:null};if(e)for(var a=0;a<r.length;a++)if(t.currentTouch=r[a],this._dispatchEventToListeners(e,this._onTouchEventCallback,o),t.isStopped())return;i&&s.length>0&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:s}),t.isStopped())||this._updateListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=n.Event.EventTouch,r=e.event,s=e.touches,o=r.getEventCode();return r.currentTarget=t._node,o===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(s,r):o===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(s,r):o===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(s,r):o===i.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(s,r),r.isStopped()?(n.eventManager._updateListeners(r),!0):!1},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i||(i=[],this._nodeListenersMap[t.__instanceId]=i),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i&&(n.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,e,i){var n,r,s=!1,o=t.getFixedPriorityListeners(),a=t.getSceneGraphPriorityListeners(),c=0;if(o&&0!==o.length)for(;c<t.gt0Index;++c)if(r=o[c],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(a&&!s)for(n=0;n<a.length;n++)if(r=a[n],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(o&&!s)for(;c<o.length;++c)if(r=o[c],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;i[t]=null==i[t]?e:e|i[t]},_visitTarget:function(t,e){var i=t.getChildren(),n=0,r=i.length,s=this._globalZOrderNodeMap,o=this._nodeListenersMap;if(r>0){for(var a;r>n&&(a=i[n],a&&a.getLocalZOrder()<0);n++)this._visitTarget(a,!1);for(null!=o[t.__instanceId]&&(s[t.getGlobalZOrder()]||(s[t.getGlobalZOrder()]=[]),s[t.getGlobalZOrder()].push(t.__instanceId));r>n;n++)a=i[n],a&&this._visitTarget(a,!1)}else null!=o[t.__instanceId]&&(s[t.getGlobalZOrder()]||(s[t.getGlobalZOrder()]=[]),s[t.getGlobalZOrder()].push(t.__instanceId));if(e){var c=[];for(var h in s)c.push(h);c.sort(this._sortNumberAsc);var l,d,u=c.length,_=this._nodePriorityMap;for(n=0;u>n;n++)for(l=s[c[n]],d=0;d<l.length;d++)_[l[d]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},addListener:function(t,e){if(n.assert(t&&e,n._LogInfos.EventManager.addListener_2),t instanceof n.EventListener){if(t._isRegistered())return void n.log(n._LogInfos.EventManager.addListener_4)}else n.assert(!n.js.isNumber(e),n._LogInfos.EventManager.addListener_3),t=n.EventListener.create(t);if(t.checkAvailable()){if(n.js.isNumber(e)){if(0===e)return void n.log(n._LogInfos.EventManager.addListener);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}},addCustomListener:function(t,e){var i=new n._EventListenerCustom(t,e);return this.addListener(i,1),i},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(var r in i){var s=i[r],o=s.getFixedPriorityListeners(),a=s.getSceneGraphPriorityListeners();if(e=this._removeListenerInVector(a,t),e?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(o,t),e&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)),s.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[r]),e)break}if(!e)for(var c=this._toAddedListeners,h=0,l=c.length;l>h;h++){var d=c[h];if(d===t){n.js.array.remove(c,d),d._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=0,r=t.length;r>i;i++){var s=t[i];if(s._onCustomEvent===e||s._onEvent===e)return s._setRegistered(!1),null!=s._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(s._getSceneGraphPriority(),s),s._setSceneGraphPriority(null)),0===this._inDispatch&&n.js.array.remove(t,s),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=0,r=t.length;r>i;i++){var s=t[i];if(s===e)return s._setRegistered(!1),null!=s._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(s._getSceneGraphPriority(),s),s._setSceneGraphPriority(null)),0===this._inDispatch&&n.js.array.remove(t,s),!0}return!1},removeListeners:function(t,e){var i=this;if(t instanceof _ccsg.Node){delete i._nodePriorityMap[t.__instanceId],n.js.array.remove(i._dirtyNodes,t);var r,s=i._nodeListenersMap[t.__instanceId];if(s){var o=n.js.array.copy(s);for(r=0;r<o.length;r++)i.removeListener(o[r]);o.length=0}var a=i._toAddedListeners;for(r=0;r<a.length;){var c=a[r];c._getSceneGraphPriority()===t?(c._setSceneGraphPriority(null),c._setRegistered(!1),a.splice(r,1)):++r}if(e===!0){var h,l=t.getChildren();for(r=0,h=l.length;h>r;r++)i.removeListeners(l[r],!0)}}else t===n.EventListener.TOUCH_ONE_BY_ONE?i._removeListenersForListenerID(n._EventListenerTouchOneByOne.LISTENER_ID):t===n.EventListener.TOUCH_ALL_AT_ONCE?i._removeListenersForListenerID(n._EventListenerTouchAllAtOnce.LISTENER_ID):t===n.EventListener.MOUSE?i._removeListenersForListenerID(n._EventListenerMouse.LISTENER_ID):t===n.EventListener.ACCELERATION?i._removeListenersForListenerID(n._EventListenerAcceleration.LISTENER_ID):t===n.EventListener.KEYBOARD?i._removeListenersForListenerID(n._EventListenerKeyboard.LISTENER_ID):n.log(n._LogInfos.EventManager.removeListeners)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)-1===e.indexOf(i)&&this._removeListenersForListenerID(i)},setPriority:function(t,e){if(null!=t){var i=this._listenersMap;for(var r in i){var s=i[r],o=s.getFixedPriorityListeners();if(o){var a=o.indexOf(t);if(-1!==a)return null!=t._getSceneGraphPriority()&&n.log(n._LogInfos.EventManager.setPriority),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");if(t.getType()===n.Event.TOUCH)return this._dispatchTouchEvent(t),void this._inDispatch--;var e=n.__getListenerID(t);this._sortEventListeners(e);var i=this._listenersMap[e];null!=i&&this._dispatchEventToListeners(i,this._onListenerCallback,t),this._updateListeners(t),this._inDispatch--}},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var i=new n.Event.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)}},n.rendererCanvas={childrenOrderDirty:!0,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:n.color(),_clearFillStyle:"rgb(0, 0, 0)",getRenderCmd:function(t){return t._createRenderCmd()},rendering:function(t){var e,i,r=this._renderCmds,s=n.view.getScaleX(),o=n.view.getScaleY(),a=t||n._renderContext;for(a.computeRealOffsetY(),e=0,i=r.length;i>e;e++)r[e].rendering(a,s,o)},_renderingToCacheCanvas:function(t,e,i,r){t||n.log("The context of RenderTexture is invalid."),i=n.js.isUndefined(i)?1:i,r=n.js.isUndefined(r)?1:r,e=e||this._currentID;var s,o,a=this._cacheToCanvasCmds[e];for(t.computeRealOffsetY(),s=0,o=a.length;o>s;s++)a[s].rendering(t,i,r);a.length=0;var c=this._cacheInstanceIds;delete this._cacheToCanvasCmds[e],n.js.array.remove(c,e),0===c.length?this._isCacheToCanvasOn=!1:this._currentID=c[c.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;i>e;e++)0!==t[e]._dirtyFlag&&t[e].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){var t=n._canvas,e=n._renderContext,i=e.getContext();i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,t.width,t.height),(0!==this._clearColor.r||0!==this._clearColor.g||0!==this._clearColor.b)&&(e.setFillStyle(this._clearFillStyle),e.setGlobalAlpha(this._clearColor.a),i.fillRect(0,0,t.width,t.height))},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1},pushRenderCommand:function(t){if(t._needDraw)if(this._isCacheToCanvasOn){var e=this._currentID,i=this._cacheToCanvasCmds,n=i[e];-1===n.indexOf(t)&&n.push(t)}else-1===this._renderCmds.indexOf(t)&&this._renderCmds.push(t)}},function(){n.CanvasContextWrapper=function(t){this._context=t,this._saveCount=0,this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var t=n.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(t,e){this._offsetX=t,this._offsetY=e,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(t,e){this._scaleX=t,this._scaleY=e},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._saveCount--},t.setGlobalAlpha=function(t){this._saveCount>0?this._context.globalAlpha=t:this._currentAlpha!==t&&(this._currentAlpha=t,this._context.globalAlpha=t)},t.setCompositeOperation=function(t){this._saveCount>0?this._context.globalCompositeOperation=t:this._currentCompositeOperation!==t&&(this._currentCompositeOperation=t,this._context.globalCompositeOperation=t)},t.setFillStyle=function(t){this._saveCount>0?this._context.fillStyle=t:this._currentFillStyle!==t&&(this._currentFillStyle=t,this._context.fillStyle=t)},t.setStrokeStyle=function(t){this._saveCount>0?this._context.strokeStyle=t:this._currentStrokeStyle!==t&&(this._currentStrokeStyle=t,this._context.strokeStyle=t)},t.setTransform=function(t,e,i){this._armatureMode>0?(this.restore(),this.save(),this._context.transform(t.a,-t.b,-t.c,t.d,t.tx*e,-(t.ty*i))):this._context.setTransform(t.a,-t.b,-t.c,t.d,this._offsetX+t.tx*e,this._realOffsetY-t.ty*i)},t._switchToArmatureMode=function(t,e,i,n){t?(this._armatureMode++,this._context.setTransform(e.a,e.c,e.b,e.d,this._offsetX+e.tx*i,this._realOffsetY-e.ty*n),
this.save()):(this._armatureMode--,this.restore())}}(),n.rendererWebGL={childrenOrderDirty:!0,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:n.color(),getRenderCmd:function(t){return t._createRenderCmd()},rendering:function(t){var e,i,r=this._renderCmds,s=t||n._renderContext;for(e=0,i=r.length;i>e;e++)r[e].rendering(s)},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,t=t||0,this._cacheToBufferCmds[t]=[],this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_renderingToBuffer:function(t){t=t||this._currentID;var e,i,r=this._cacheToBufferCmds[t],s=n._renderContext,o=this._cacheInstanceIds;for(e=0,i=r.length;i>e;e++)r[e].rendering(s);r.length=0,delete this._cacheToBufferCmds[t],n.js.array.remove(o,t),0===o.length?this._isCacheToBufferOn=!1:this._currentID=o[o.length-1]},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;i>e;e++)t[e].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=n._renderContext;t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var e=n._renderContext;t?(e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},pushRenderCommand:function(t){if(t._needDraw)if(this._isCacheToBufferOn){var e=this._currentID,i=this._cacheToBufferCmds,n=i[e];-1===n.indexOf(t)&&n.push(t)}else-1===this._renderCmds.indexOf(t)&&this._renderCmds.push(t)}},n._tmp.PrototypeCCNode=function(){var t=_ccsg.Node.prototype;n.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),n.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),t.width,n.defineGetterSetter(t,"width",t._getWidth,t._setWidth),t.height,n.defineGetterSetter(t,"height",t._getHeight,t._setHeight),t.anchorX,n.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),t.anchorY,n.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),t.skewX,n.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),t.skewY,n.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),t.zIndex,n.defineGetterSetter(t,"zIndex",t.getLocalZOrder,t.setLocalZOrder),t.vertexZ,n.defineGetterSetter(t,"vertexZ",t.getVertexZ,t.setVertexZ),t.rotation,n.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),t.rotationX,n.defineGetterSetter(t,"rotationX",t.getRotationX,t.setRotationX),t.rotationY,n.defineGetterSetter(t,"rotationY",t.getRotationY,t.setRotationY),t.scale,n.defineGetterSetter(t,"scale",t.getScale,t.setScale),t.scaleX,n.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),t.scaleY,n.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),t.children,n.defineGetterSetter(t,"children",t.getChildren),t.childrenCount,n.defineGetterSetter(t,"childrenCount",t.getChildrenCount),t.parent,n.defineGetterSetter(t,"parent",t.getParent,t.setParent),t.visible,n.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),t.running,n.defineGetterSetter(t,"running",t.isRunning),t.ignoreAnchor,n.defineGetterSetter(t,"ignoreAnchor",t.isIgnoreAnchorPointForPosition,t.ignoreAnchorPointForPosition),t.tag,t.userData,t.userObject,t.arrivalOrder,t.actionManager,n.defineGetterSetter(t,"actionManager",t.getActionManager,t.setActionManager),t.scheduler,n.defineGetterSetter(t,"scheduler",t.getScheduler,t.setScheduler),t.shaderProgram,n.defineGetterSetter(t,"shaderProgram",t.getShaderProgram,t.setShaderProgram),t.opacity,n.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),t.opacityModifyRGB,n.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB),t.cascadeOpacity,n.defineGetterSetter(t,"cascadeOpacity",t.isCascadeOpacityEnabled,t.setCascadeOpacityEnabled),t.color,n.defineGetterSetter(t,"color",t.getColor,t.setColor),t.cascadeColor,n.defineGetterSetter(t,"cascadeColor",t.isCascadeColorEnabled,t.setCascadeColorEnabled)},n.NODE_TAG_INVALID=-1,n.s_globalOrderOfArrival=1,_ccsg.Node=n.Class({name:"ccsg.Node",properties:{_localZOrder:0,_globalZOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:n.p(0,0),_skewX:0,_skewY:0,_children:[],_visible:!0,_anchorPoint:n.p(0,0),_contentSize:n.size(0,0),_parent:null,_ignoreAnchorPointForPosition:!1,tag:n.NODE_TAG_INVALID,_showNode:!1,_name:"",_realOpacity:255,_realColor:n.Color.WHITE,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1},ctor:function(){arguments[0];this.__instanceId=n.ClassManager.getNewInstanceId(),this._running=!1,this._reorderChildDirty=!1,this._shaderProgram=null,this.arrivalOrder=0,this._additionalTransformDirty=!1,this._isTransitionFinished=!1;var t=n.director;this._actionManager=t.getActionManager(),this._scheduler=t.getScheduler(),this._additionalTransform=n.affineTransformMakeIdentity(),this._initRendererCmd()},init:function(){return!0},_arrayMakeObjectsPerformSelector:function(t,e){if(t&&0!==t.length){var i,r,s=t.length,o=_ccsg.Node._stateCallbackType;switch(e){case o.onEnter:for(i=0;s>i;i++)r=t[i],r&&r.onEnter();break;case o.onExit:for(i=0;s>i;i++)r=t[i],r&&r.onExit();break;case o.onEnterTransitionDidFinish:for(i=0;s>i;i++)r=t[i],r&&r.onEnterTransitionDidFinish();break;case o.cleanup:for(i=0;s>i;i++)r=t[i],r&&r.cleanup();break;case o.updateTransform:for(i=0;s>i;i++)r=t[i],r&&r.updateTransform();break;case o.onExitTransitionDidStart:for(i=0;s>i;i++)r=t[i],r&&r.onExitTransitionDidStart();break;case o.sortAllChildren:for(i=0;s>i;i++)r=t[i],r&&r.sortAllChildren();break;default:n.assert(0,n._LogInfos.Node._arrayMakeObjectsPerformSelector)}}},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){this._localZOrder=t,this._parent&&this._parent.reorderChild(this,t),n.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return n.log(n._LogInfos.Node.getZOrder),this.getLocalZOrder()},setZOrder:function(t){n.log(n._LogInfos.Node.setZOrder),this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,n.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&n.log(n._LogInfos.Node.getRotation),this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&n.log(n._LogInfos.Node.getScale),this._scaleX},setScale:function(t,e){this._scaleX=t,this._scaleY=e||0===e?e:t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var i=this._position;if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPosition:function(){return n.p(this._position)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),n.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return n.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return n.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(t){this.arrivalOrder=t},getActionManager:function(){return this._actionManager||(this._actionManager=n.director.getActionManager()),this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this.stopAllActions(),this._actionManager=t)},getScheduler:function(){return this._scheduler||(this._scheduler=n.director.getScheduler()),this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return n.log(n._LogInfos.Node.boundingBox),this.getBoundingBox()},getBoundingBox:function(){var t=n.rect(0,0,this._contentSize.width,this._contentSize.height);return n._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),n.eventManager.removeListeners(this),this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.cleanup)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return n.log("Invalid name"),null;for(var e=this._children,i=0,r=e.length;r>i;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var r,s=!1;n.js.isUndefined(i)?(i=void 0,r=t._name):n.js.isString(i)?(r=i,i=void 0):n.js.isNumber(i)&&(s=!0,r=""),n.assert(t,n._LogInfos.Node.addChild_3),n.assert(null===t._parent,"child already added. It can't be added again"),this._addChildHelper(t,e,i,r,s)},_addChildHelper:function(t,e,i,r,s){this._children||(this._children=[]),this._insertChild(t,e),s?t.setTag(i):t.setName(r),t.setParent(this),t.setOrderOfArrival(n.s_globalOrderOfArrival++),this._running&&(t.onEnter(),this._isTransitionFinished&&t.onEnterTransitionDidFinish()),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeFromParentAndCleanup:function(t){n.log(n._LogInfos.Node.removeFromParentAndCleanup),this.removeFromParent(t)},removeChild:function(t,e){0!==this._children.length&&(void 0===e&&(e=!0),this._children.indexOf(t)>-1&&this._detachChild(t,e),n.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,e){t===n.NODE_TAG_INVALID&&n.log(n._LogInfos.Node.removeChildByTag);var i=this.getChildByTag(t);i?this.removeChild(i,e):n.log(n._LogInfos.Node.removeChildByTag_2,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var e=this._children;if(null!==e){void 0===t&&(t=!0);for(var i=0;i<e.length;i++){var r=e[i];r&&(this._running&&(r.onExitTransitionDidStart(),r.onExit()),t&&r.cleanup(),r.parent=null,r._renderCmd.detachFromParent())}this._children.length=0,n.renderer.childrenOrderDirty=!0}},_detachChild:function(t,e){this._running&&(t.onExitTransitionDidStart(),t.onExit()),e&&t.cleanup(),t.parent=null,t._renderCmd.detachFromParent(),n.js.array.remove(this._children,t)},_insertChild:function(t,e){n.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},reorderChild:function(t,e){n.assert(t,n._LogInfos.Node.reorderChild),n.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.arrivalOrder=n.s_globalOrderOfArrival,n.s_globalOrderOfArrival++,t._setLocalZOrder(e)},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;r>t;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._reorderChildDirty=!1}},draw:function(t){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onEnter),this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0,this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pause(),this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onExit)},runAction:function(t){return n.assert(t,n._LogInfos.Node.runAction),this.actionManager.addAction(t,this,!this._running),t},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(t){this.actionManager.removeAction(t)},stopActionByTag:function(t){return t===n.ACTION_TAG_INVALID?void n.log(n._LogInfos.Node.stopActionByTag):void this.actionManager.removeActionByTag(t,this)},getActionByTag:function(t){return t===n.ACTION_TAG_INVALID?(n.log(n._LogInfos.Node.getActionByTag),null):this.actionManager.getActionByTag(t,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,e,i,r,s){var o=arguments.length;"function"==typeof t?1===o?(e=0,i=n.REPEAT_FOREVER,r=0,s=this.__instanceId):2===o?"number"==typeof e?(i=n.REPEAT_FOREVER,r=0,s=this.__instanceId):(s=e,e=0,i=n.REPEAT_FOREVER,r=0):3===o?("string"==typeof i?(s=i,i=n.REPEAT_FOREVER):s=this.__instanceId,r=0):4===o&&(s=this.__instanceId):1===o?(e=0,i=n.REPEAT_FOREVER,r=0):2===o&&(i=n.REPEAT_FOREVER,r=0),n.assert(t,n._LogInfos.Node.schedule),n.assert(e>=0,n._LogInfos.Node.schedule_2),e=e||0,i=null==i?n.REPEAT_FOREVER:i,r=r||0,this.scheduler.schedule(t,this,e,i,r,!this._running,s)},scheduleOnce:function(t,e,i){void 0===i&&(i=this.__instanceId),this.schedule(t,0,0,e,i)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){n.log(n._LogInfos.Node.resumeSchedulerAndActions),this.resume()},resume:function(){this.scheduler.resumeTarget(this),this.actionManager&&this.actionManager.resumeTarget(this),n.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){n.log(n._LogInfos.Node.pauseSchedulerAndActions),this.pause()},pause:function(){this.scheduler.pauseTarget(this),this.actionManager&&this.actionManager.pauseTarget(this),n.eventManager.pauseTarget(this)},setAdditionalTransform:function(t){return void 0===t?this._additionalTransformDirty=!1:(this._additionalTransform=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),void(this._additionalTransformDirty=!0))},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),e=this._parent;null!==e;e=e.parent)t=n.affineTransformConcat(t,e.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return n.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return n.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||n.p(0,0),n.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return n.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||n.p(0,0);var e=n.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(e)},_convertToWindowSpace:function(t){var e=this.convertToWorldSpace(t);return n.director.convertToUI(e)},convertTouchToNodeSpace:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},convertTouchToNodeSpaceAR:function(t){var e=n.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(e)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},visit:function(t){this._renderCmd.visit(t)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var e=this._renderCmd.getNodeToParentTransform();if(t){for(var i={a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx,ty:e.ty},r=this._parent;null!=r&&r!=t;r=r.getParent())n.affineTransformConcatIn(i,r.getNodeToParentTransform());return i}return e},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=n.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.getNodeToWorldTransform();if(t=n.rectApplyAffineTransform(t,e),!this._children)return t;for(var i=this._children,r=0;r<i.length;r++){var s=i[r];if(s&&s._visible){var o=s._getBoundingBoxToCurrentNode(e);o&&(t=n.rectUnion(t,o))}}return t},_getBoundingBoxToCurrentNode:function(t){var e=n.rect(0,0,this._contentSize.width,this._contentSize.height),i=void 0===t?this.getNodeToParentTransform():n.affineTransformConcat(this.getNodeToParentTransform(),t);if(e=n.rectApplyAffineTransform(e,i),!this._children)return e;for(var r=this._children,s=0;s<r.length;s++){var o=r[s];if(o&&o._visible){var a=o._getBoundingBoxToCurrentNode(i);a&&(e=n.rectUnion(e,a))}}return e},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return n.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_initRendererCmd:function(){this._renderCmd=n.renderer.getRenderCmd(this)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new _ccsg.Node.CanvasRenderCmd(this):new _ccsg.Node.WebGLRenderCmd(this)}}),_ccsg.Node.extend=function(t){return n._Class.extend.call(_ccsg.Node,t)},_ccsg.Node.prototype.ctor=_ccsg.Node,_ccsg.Node.create=function(){return new _ccsg.Node},_ccsg.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7},n.assert(n.js.isFunction(n._tmp.PrototypeCCNode),n._LogInfos.MissingFile,"BaseNodesPropertyDefine.js"),n._tmp.PrototypeCCNode(),delete n._tmp.PrototypeCCNode,n.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e,this.rendering=function(t,e,i){this._callback&&this._callback.call(this._target,t,e,i)}},_ccsg.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,all:255},_ccsg.Node.RenderCmd=function(t){this._dirtyFlag=1,n.renderer.pushDirtyNode(this),this._node=t,this._needDraw=!1,this._anchorPointInPoints=new n.Vec2(0,0),this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._displayedOpacity=255,this._displayedColor=n.color(255,255,255,255),this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._curLevel=-1},_ccsg.Node.RenderCmd.prototype={constructor:_ccsg.Node.RenderCmd,getAnchorPointInPoints:function(){return n.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return n.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty&&(this._inverse=n.affineTransformInvert(this.getNodeToParentTransform())),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x,t.y=e.height*i.y,this.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(t){0===this._dirtyFlag&&0!==t&&n.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},_updateDisplayColor:function(t){var e,i,r,s,o=this._node,a=this._displayedColor,c=o._realColor;if(this._cascadeColorEnabledDirty&&!o._cascadeColorEnabled){a.r=c.r,a.g=c.g,a.b=c.b;var h=new n.Color(255,255,255,255);for(r=o._children,e=0,i=r.length;i>e;e++)s=r[e],s&&s._renderCmd&&s._renderCmd._updateDisplayColor(h);this._cascadeColorEnabledDirty=!1}else{if(void 0===t){var l=o._parent;t=l&&l._cascadeColorEnabled?l.getDisplayedColor():n.Color.WHITE}if(a.r=0|c.r*t.r/255,a.g=0|c.g*t.g/255,a.b=0|c.b*t.b/255,o._cascadeColorEnabled)for(r=o._children,e=0,i=r.length;i>e;e++)s=r[e],s&&s._renderCmd&&(s._renderCmd._updateDisplayColor(a),s._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(t){var e,i,n,r,s=this._node;if(this._cascadeOpacityEnabledDirty&&!s._cascadeOpacityEnabled){for(this._displayedOpacity=s._realOpacity,n=s._children,e=0,i=n.length;i>e;e++)r=n[e],r&&r._renderCmd&&r._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t){var o=s._parent;t=255,o&&o._cascadeOpacityEnabled&&(t=o.getDisplayedOpacity())}if(this._displayedOpacity=s._realOpacity*t/255,s._cascadeOpacityEnabled)for(n=s._children,e=0,i=n.length;i>e;e++)r=n[e],r&&r._renderCmd&&(r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_syncDisplayColor:function(t){var e=this._node,i=this._displayedColor,r=e._realColor;if(void 0===t){var s=e._parent;t=s&&s._cascadeColorEnabled?s.getDisplayedColor():n.Color.WHITE}i.r=0|r.r*t.r/255,i.g=0|r.g*t.g/255,i.b=0|r.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(void 0===t){var i=e._parent;t=255,i&&i._cascadeOpacityEnabled&&(t=i.getDisplayedOpacity())}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;i&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),(i||n)&&this._updateColor(),e&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty^this._dirtyFlag)},getNodeToParentTransform:function(){var t=this._node;if(this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty){var e=this._transform;e.tx=t._position.x,e.ty=t._position.y;var i=1,r=0,s=0,o=1;if(t._rotationX){var a=.017453292519943295*t._rotationX;s=Math.sin(a),o=Math.cos(a)}if(t._rotationY){var c=.017453292519943295*t._rotationY;i=Math.cos(c),r=-Math.sin(c)}e.a=i,e.b=r,e.c=s,e.d=o;var h=t._scaleX,l=t._scaleY,d=this._anchorPointInPoints.x,u=this._anchorPointInPoints.y,_=1e-6>h&&h>-1e-6?1e-6:h,f=1e-6>l&&l>-1e-6?1e-6:l;if((1!==h||1!==l)&&(i=e.a*=_,r=e.b*=_,s=e.c*=f,o=e.d*=f),t._skewX||t._skewY){var p=Math.tan(-t._skewX*Math.PI/180),g=Math.tan(-t._skewY*Math.PI/180);p===1/0&&(p=99999999),g===1/0&&(g=99999999);var m=u*p,y=d*g;e.a=i-s*g,e.b=r-o*g,e.c=s-i*p,e.d=o-r*p,e.tx+=i*m+s*y,e.ty+=r*m+o*y}e.tx-=i*d+s*u,e.ty-=r*d+o*u,t._ignoreAnchorPointForPosition&&(e.tx+=d,e.ty+=u),t._additionalTransformDirty&&(this._transform=n.affineTransformConcat(e,t._additionalTransform))}return this._transform},_syncStatus:function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var r=i&e.colorDirty,s=i&e.opacityDirty,o=i&e.transformDirty;this._dirtyFlag=i,r&&this._syncDisplayColor(),s&&this._syncDisplayOpacity(),r&&this._updateColor(),o&&this.transform(t,!0)},visitChildren:function(){var t,e,i=this._node,r=i._children,s=r.length;if(s>0){for(i.sortAllChildren(),t=0;s>t&&(e=r[t],e._localZOrder<0);t++)e._renderCmd.visit(this);for(n.renderer.pushRenderCommand(this);s>t;t++)r[t]._renderCmd.visit(this)}else n.renderer.pushRenderCommand(this);this._dirtyFlag=0}},function(){_ccsg.Node.CanvasRenderCmd=function(t){_ccsg.Node.RenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1};var t=_ccsg.Node.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);t.constructor=_ccsg.Node.CanvasRenderCmd,t.transform=function(t,e){var i=this.getNodeToParentTransform(),n=this._worldTransform;if(this._cacheDirty=!0,t){var r=t._worldTransform;n.a=i.a*r.a+i.b*r.c,n.b=i.a*r.b+i.b*r.d,n.c=i.c*r.a+i.d*r.c,n.d=i.c*r.b+i.d*r.d,n.tx=r.a*i.tx+r.c*i.ty+r.tx,n.ty=r.d*i.ty+r.ty+r.b*i.tx}else n.a=i.a,n.b=i.b,n.c=i.c,n.d=i.d,n.tx=i.tx,n.ty=i.ty;if(e){var s=this._node._children;if(!s||0===s.length)return;var o,a;for(o=0,a=s.length;a>o;o++)s[o]._renderCmd.transform(this,e)}},t.visit=function(t){var e=this._node;e._visible&&(t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1),this._syncStatus(t),this.visitChildren())},t.setDirtyFlag=function(t,e){_ccsg.Node.RenderCmd.prototype.setDirtyFlag.call(this,t,e),this._setCacheDirty(e),this._cachedParent&&this._cachedParent.setDirtyFlag(t,!0)},t._setCacheDirty=function(){if(this._cacheDirty===!1){this._cacheDirty=!0;var t=this._cachedParent;t&&t!==this&&t._setNodeDirtyForCache&&t._setNodeDirtyForCache()}},t._setCachedParent=function(t){if(this._cachedParent!==t){this._cachedParent=t;for(var e=this._node._children,i=0,n=e.length;n>i;i++)e[i]._renderCmd._setCachedParent(t)}},t.detachFromParent=function(){this._cachedParent=null;for(var t,e=this._node._children,i=0,n=e.length;n>i;i++)t=e[i],t&&t._renderCmd&&t._renderCmd.detachFromParent()},t.setShaderProgram=function(t){},t.getShaderProgram=function(){return null},_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){return t?t.src===n.SRC_ALPHA&&t.dst===n.ONE||t.src===n.ONE&&t.dst===n.ONE?"lighter":t.src===n.ZERO&&t.dst===n.SRC_ALPHA?"destination-in":t.src===n.ZERO&&t.dst===n.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}}(),function(){_ccsg.Node.WebGLRenderCmd=function(t){_ccsg.Node.RenderCmd.call(this,t);var e=new n.math.Matrix4,i=e.mat;i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[14]=0,i[10]=i[15]=1,this._transform4x4=e,this._stackMatrix=new n.math.Matrix4,this._shaderProgram=null,this._camera=null};var t=_ccsg.Node.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);t.constructor=_ccsg.Node.WebGLRenderCmd,t._updateColor=function(){},t.visit=function(t){var e=this._node;if(e._visible){t=t||this.getParentRenderCmd(),e._parent&&e._parent._renderCmd&&(this._curLevel=e._parent._renderCmd._curLevel+1);var i=n.current_stack;i.stack.push(i.top),this._syncStatus(t),i.top=this._stackMatrix,this.visitChildren(),i.top=i.stack.pop()}},t.transform=function(t,e){var i=this._transform4x4,r=this._stackMatrix,s=this._node;t=t||this.getParentRenderCmd();var o=t?t._stackMatrix:n.current_stack.top,a=this.getNodeToParentTransform();this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty^this._dirtyFlag;var c=i.mat;if(c[0]=a.a,c[4]=a.c,c[12]=a.tx,c[1]=a.b,c[5]=a.d,c[13]=a.ty,c[14]=s._vertexZ,n.kmMat4Multiply(r,o,i),e&&s._children&&0!==s._children.length){var h,l,d=s._children;for(h=0,l=d.length;l>h;h++)d[h]._renderCmd.transform(this,e)}},t.setShaderProgram=function(t){
this._shaderProgram=t},t.getShaderProgram=function(){return this._shaderProgram}}(),n.ProtectedNode=_ccsg.Node.extend({_protectedChildren:null,_reorderProtectedChildDirty:!1,_insertProtectedChild:function(t,e){this._reorderProtectedChildDirty=!0,this._protectedChildren.push(t),t._setLocalZOrder(e)},ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._protectedChildren=[]},addProtectedChild:function(t,e,i){n.assert(null!=t,"child must be non-nil"),n.assert(!t.parent,"child already added. It can't be added again"),e=e||t.getLocalZOrder(),i&&t.setTag(i),this._insertProtectedChild(t,e),t.setParent(this),t.setOrderOfArrival(n.s_globalOrderOfArrival),this._running&&(t.onEnter(),this._isTransitionFinished&&t.onEnterTransitionDidFinish()),this._cascadeColorEnabled&&this._renderCmd.setCascadeColorEnabledDirty(),this._cascadeOpacityEnabled&&this._renderCmd.setCascadeOpacityEnabledDirty()},getProtectedChildByTag:function(t){n.assert(t!==n.NODE_TAG_INVALID,"Invalid tag");for(var e=this._protectedChildren,i=0,r=e.length;r>i;i++)if(e.getTag()===t)return e[i];return null},removeProtectedChild:function(t,e){null==e&&(e=!0);var i=this._protectedChildren;if(0!==i.length){var n=i.indexOf(t);n>-1&&(this._running&&(t.onExitTransitionDidStart(),t.onExit()),e&&t.cleanup(),t.setParent(null),i.splice(n,1))}},removeProtectedChildByTag:function(t,e){n.assert(t!==n.NODE_TAG_INVALID,"Invalid tag"),null==e&&(e=!0);var i=this.getProtectedChildByTag(t);null==i?n.log("cocos2d: removeChildByTag(tag = %d): child not found!",t):this.removeProtectedChild(i,e)},removeAllProtectedChildren:function(){this.removeAllProtectedChildrenWithCleanup(!0)},removeAllProtectedChildrenWithCleanup:function(t){null==t&&(t=!0);for(var e=this._protectedChildren,i=0,n=e.length;n>i;i++){var r=e[i];this._running&&(r.onExitTransitionDidStart(),r.onExit()),t&&r.cleanup(),r.setParent(null)}e.length=0},reorderProtectedChild:function(t,e){n.assert(null!=t,"Child must be non-nil"),this._reorderProtectedChildDirty=!0,t.setOrderOfArrival(n.s_globalOrderOfArrival++),t._setLocalZOrder(e)},sortAllProtectedChildren:function(){if(this._reorderProtectedChildDirty){var t,e,i,n=this._protectedChildren,r=n.length;for(t=1;r>t;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._reorderProtectedChildDirty=!1}},_changePosition:function(){},cleanup:function(){_ccsg.Node.prototype.cleanup.call(this);for(var t=this._protectedChildren,e=0,i=t.length;i>e;e++)t[e].cleanup()},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this);for(var t=this._protectedChildren,e=0,i=t.length;i>e;e++)t[e].onEnter()},onEnterTransitionDidFinish:function(){_ccsg.Node.prototype.onEnterTransitionDidFinish.call(this);for(var t=this._protectedChildren,e=0,i=t.length;i>e;e++)t[e].onEnterTransitionDidFinish()},onExit:function(){_ccsg.Node.prototype.onExit.call(this);for(var t=this._protectedChildren,e=0,i=t.length;i>e;e++)t[e].onExit()},onExitTransitionDidStart:function(){_ccsg.Node.prototype.onExitTransitionDidStart.call(this);for(var t=this._protectedChildren,e=0,i=t.length;i>e;e++)t[e].onExitTransitionDidStart()},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.ProtectedNode.CanvasRenderCmd(this):new n.ProtectedNode.WebGLRenderCmd(this)}}),n.ProtectedNode.create=function(){return new n.ProtectedNode},function(){n.ProtectedNode.RenderCmd={_updateDisplayColor:function(t){var e,i,r,s,o=this._node,a=this._displayedColor,c=o._realColor;if(this._cascadeColorEnabledDirty&&!o._cascadeColorEnabled){a.r=c.r,a.g=c.g,a.b=c.b;var h=new n.Color(255,255,255,255);for(r=o._children,e=0,i=r.length;i>e;e++)s=r[e],s&&s._renderCmd&&s._renderCmd._updateDisplayColor(h);this._cascadeColorEnabledDirty=!1}else{if(void 0===t){var l=o._parent;t=l&&l._cascadeColorEnabled?l.getDisplayedColor():n.Color.WHITE}if(a.r=0|c.r*t.r/255,a.g=0|c.g*t.g/255,a.b=0|c.b*t.b/255,o._cascadeColorEnabled)for(r=o._children,e=0,i=r.length;i>e;e++)s=r[e],s&&s._renderCmd&&(s._renderCmd._updateDisplayColor(a),s._renderCmd._updateColor());for(r=o._protectedChildren,e=0,i=r.length;i>e;e++)s=r[e],s&&s._renderCmd&&(s._renderCmd._updateDisplayColor(a),s._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(t){var e,i,n,r,s=this._node;if(this._cascadeOpacityEnabledDirty&&!s._cascadeOpacityEnabled){for(this._displayedOpacity=s._realOpacity,n=s._children,e=0,i=n.length;i>e;e++)r=n[e],r&&r._renderCmd&&r._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t){var o=s._parent;t=255,o&&o._cascadeOpacityEnabled&&(t=o.getDisplayedOpacity())}if(this._displayedOpacity=s._realOpacity*t/255,s._cascadeOpacityEnabled)for(n=s._children,e=0,i=n.length;i>e;e++)r=n[e],r&&r._renderCmd&&(r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor());for(n=s._protectedChildren,e=0,i=n.length;i>e;e++)r=n[e],r&&r._renderCmd&&(r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_changeProtectedChild:function(t){var e=t._renderCmd,i=e._dirtyFlag,n=_ccsg.Node._dirtyFlags;this._dirtyFlag&n.colorDirty&&(i|=n.colorDirty),this._dirtyFlag&n.opacityDirty&&(i|=n.opacityDirty);var r=i&n.colorDirty,s=i&n.opacityDirty;r&&e._updateDisplayColor(this._displayedColor),s&&e._updateDisplayOpacity(this._displayedOpacity),(r||s)&&e._updateColor()}},n.ProtectedNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1};var t=n.ProtectedNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.js.mixin(t,n.ProtectedNode.RenderCmd),t.constructor=n.ProtectedNode.CanvasRenderCmd,t.visit=function(t){var e=this._node;if(e._visible){var i,r,s,o=e._children,a=e._children,c=e._protectedChildren,h=a.length,l=c.length;this._syncStatus(t),e.sortAllChildren(),e.sortAllProtectedChildren();var d;for(i=0;h>i&&(s=o[i],s._localZOrder<0);i++)s.visit(this);for(r=0;l>r&&(d=c[r],d&&d._localZOrder<0);r++)this._changeProtectedChild(d),d.visit(this);for(n.renderer.pushRenderCommand(this);h>i;i++)o[i]&&o[i].visit(this);for(;l>r;r++)d=c[r],d&&(this._changeProtectedChild(d),d.visit(this));this._dirtyFlag=0,this._cacheDirty=!1}},t.transform=function(t,e){var i=this._node;i._changePosition&&i._changePosition();var n=i.getNodeToParentTransform(),r=this._worldTransform;if(t){var s=t._worldTransform;r.a=n.a*s.a+n.b*s.c,r.b=n.a*s.b+n.b*s.d,r.c=n.c*s.a+n.d*s.c,r.d=n.c*s.b+n.d*s.d,r.tx=s.a*n.tx+s.c*n.ty+s.tx,r.ty=s.d*n.ty+s.ty+s.b*n.tx}else r.a=n.a,r.b=n.b,r.c=n.c,r.d=n.d,r.tx=n.tx,r.ty=n.ty;var o,a,c=i._children;if(e&&c&&0!==c.length)for(o=0,a=c.length;a>o;o++)c[o]._renderCmd.transform(this,e);if(c=i._protectedChildren,e&&c&&0!==c.length)for(o=0,a=c.length;a>o;o++)c[o]._renderCmd.transform(this,e)}}(),function(){if(_ccsg.Node.WebGLRenderCmd){n.ProtectedNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t)};var t=n.ProtectedNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.js.mixin(t,n.ProtectedNode.RenderCmd),t.constructor=n.ProtectedNode.WebGLRenderCmd,t.visit=function(t){var e=this._node;if(e._visible){var i,r,s=n.current_stack;s.stack.push(s.top),this._syncStatus(t),s.top=this._stackMatrix;var o=e.grid;o&&o._active&&o.beforeDraw();var a=e._children,c=e._protectedChildren,h=a.length,l=c.length;e.sortAllChildren(),e.sortAllProtectedChildren();var d;for(i=0;h>i&&(a[i]&&a[i]._localZOrder<0);i++)a[i].visit(this);for(r=0;l>r&&(d=c[r],d&&d._localZOrder<0);r++)this._changeProtectedChild(d),d.visit(this);for(n.renderer.pushRenderCommand(this);h>i;i++)a[i]&&a[i].visit(this);for(;l>r;r++)d=c[r],d&&(this._changeProtectedChild(d),d.visit(this));o&&o._active&&o.afterDraw(e),this._dirtyFlag=0,s.top=s.stack.pop()}},t.transform=function(t,e){var i=this._node,r=this._transform4x4,s=this._stackMatrix,o=t?t._stackMatrix:n.current_stack.top,a=i.getNodeToParentTransform();i._changePosition&&i._changePosition();var c=r.mat;c[0]=a.a,c[4]=a.c,c[12]=a.tx,c[1]=a.b,c[5]=a.d,c[13]=a.ty,c[14]=i._vertexZ,n.kmMat4Multiply(s,o,r);var h,l,d=i._children;if(e&&d&&0!==d.length)for(h=0,l=d.length;l>h;h++)d[h]._renderCmd.transform(this,e);if(d=i._protectedChildren,e&&d&&0!==d.length)for(h=0,l=d.length;l>h;h++)d[h]._renderCmd.transform(this,e)}}}(),_=t("../cocos2d/core/event/event-target"),n.AtlasNode=_ccsg.Node.extend({textureAtlas:null,quadsToDraw:0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_opacityModifyRGB:!1,_blendFunc:null,_ignoreContentScaleFactor:!1,_className:"AtlasNode",_texture:null,_textureForCanvas:null,ctor:function(t,e,i,r){_ccsg.Node.prototype.ctor.call(this),_.call(this),this._blendFunc={src:n.BLEND_SRC,dst:n.BLEND_DST},this._ignoreContentScaleFactor=!1,void 0!==r&&this.initWithTileFile(t,e,i,r)},_createRenderCmd:function(){this._renderCmd=n._renderType===n.game.RENDER_TYPE_CANVAS?new n.AtlasNode.CanvasRenderCmd(this):new n.AtlasNode.WebGLRenderCmd(this)},updateAtlasValues:function(){n.log(n._LogInfos.AtlasNode.updateAtlasValues)},getColor:function(){return this._opacityModifyRGB?this._renderCmd._colorUnmodified:_ccsg.Node.prototype.getColor.call(this)},setOpacityModifyRGB:function(t){var e=this.color;this._opacityModifyRGB=t,this.setColor(e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){this._blendFunc=void 0===e?t:{src:t,dst:e}},setTextureAtlas:function(t){this.textureAtlas=t},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},setQuadsToDraw:function(t){this.quadsToDraw=t},initWithTileFile:function(t,e,i,r){if(!t)throw new Error("cc.AtlasNode.initWithTileFile(): title should not be null");var s=n.textureCache.addImage(t);return this.initWithTexture(s,e,i,r)},initWithTexture:function(t,e,i,n){return this._renderCmd.initWithTexture(t,e,i,n)},setColor:function(t){this._renderCmd.setColor(t)},setOpacity:function(t){this._renderCmd.setOpacity(t)},getTexture:function(){return this._texture},setTexture:function(t){this._texture=t},_setIgnoreContentScaleFactor:function(t){this._ignoreContentScaleFactor=t}});var c=n.AtlasNode.prototype;n.defineGetterSetter(c,"opacity",c.getOpacity,c.setOpacity),n.defineGetterSetter(c,"color",c.getColor,c.setColor),c.texture,n.defineGetterSetter(c,"texture",c.getTexture,c.setTexture),c.textureAtlas,c.quadsToDraw,n.js.addon(c,_.prototype),n.AtlasNode.create=function(t,e,i,r){return new n.AtlasNode(t,e,i,r)},function(){n.AtlasNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1,this._colorUnmodified=n.Color.WHITE,this._textureToRender=null};var t=n.AtlasNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.AtlasNode.CanvasRenderCmd,t.initWithTexture=function(t,e,i,r){var s=this._node;return s._itemWidth=e,s._itemHeight=i,s._opacityModifyRGB=!0,s._texture=t,s._texture?(this._textureToRender=t,this._calculateMaxItems(),s.quadsToDraw=r,!0):(n.log(n._LogInfos.AtlasNode._initWithTexture),!1)},t.setColor=function(t){var e=this._node,i=e._realColor;(i.r!==t.r||i.g!==t.g||i.b!==t.b)&&(this._colorUnmodified=t,this._changeTextureColor())},t._changeTextureColor=function(){var t=this._node,e=t._texture,i=this._colorUnmodified,r=e.getHtmlElementObj(),s=n.rect(0,0,r.width,r.height);e===this._textureToRender?this._textureToRender=e._generateColorTexture(i.r,i.g,i.b,s):e._generateColorTexture(i.r,i.g,i.b,s,this._textureToRender.getHtmlElementObj())},t.setOpacity=function(t){var e=this._node;_ccsg.Node.prototype.setOpacity.call(e,t)},t._calculateMaxItems=function(){var t=this._node,e=t._texture,i=e.getContentSize();t._itemsPerColumn=0|i.height/t._itemHeight,t._itemsPerRow=0|i.width/t._itemWidth}}(),function(){n.AtlasNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._textureAtlas=null,this._colorUnmodified=n.Color.WHITE,this._colorF32Array=null,this._uniformColor=null,this._shaderProgram=n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURE_UCOLOR),this._uniformColor=n._renderContext.getUniformLocation(this._shaderProgram.getProgram(),"u_color")};var t=n.AtlasNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.AtlasNode.WebGLRenderCmd,t._updateBlendFunc=function(){var t=this._node;this._textureAtlas.texture.hasPremultipliedAlpha()||(t._blendFunc.src=n.SRC_ALPHA,t._blendFunc.dst=n.ONE_MINUS_SRC_ALPHA)},t._updateOpacityModifyRGB=function(){this._node._opacityModifyRGB=this._textureAtlas.texture.hasPremultipliedAlpha()},t.rendering=function(t){var e=t||n._renderContext,i=this._node;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),n.glBlendFunc(i._blendFunc.src,i._blendFunc.dst),this._uniformColor&&this._colorF32Array&&(e.uniform4fv(this._uniformColor,this._colorF32Array),this._textureAtlas.drawNumberOfQuads(i.quadsToDraw,0))},t.initWithTexture=function(t,e,i,r){var s=this._node;s._itemWidth=e,s._itemHeight=i,this._colorUnmodified=n.Color.WHITE,s._opacityModifyRGB=!0,s._blendFunc.src=n.BLEND_SRC,s._blendFunc.dst=n.BLEND_DST;var o=s._realColor;return this._colorF32Array=new Float32Array([o.r/255,o.g/255,o.b/255,s._realOpacity/255]),this._textureAtlas=new n.TextureAtlas,this._textureAtlas.initWithTexture(t,r),this._textureAtlas?(this._updateBlendFunc(),this._updateOpacityModifyRGB(),this._calculateMaxItems(),s.quadsToDraw=r,!0):(n.log(n._LogInfos.AtlasNode._initWithTexture),!1)},t.setColor=function(t){var e=n.color(t.r,t.g,t.b),i=this._node;this._colorUnmodified=t;var r=this._displayedOpacity;i._opacityModifyRGB&&(e.r=e.r*r/255,e.g=e.g*r/255,e.b=e.b*r/255),_ccsg.Node.prototype.setColor.call(i,e)},t.setOpacity=function(t){var e=this._node;_ccsg.Node.prototype.setOpacity.call(e,t),e._opacityModifyRGB&&(e.color=this._colorUnmodified)},t._updateColor=function(){var t=this._displayedColor;this._colorF32Array=new Float32Array([t.r/255,t.g/255,t.b/255,this._displayedOpacity/255])},t.getTexture=function(){return this._textureAtlas.texture},t.setTexture=function(t){this._textureAtlas.texture=t,this._updateBlendFunc(),this._updateOpacityModifyRGB()},t._calculateMaxItems=function(){var t=this._node,e=this._textureAtlas.texture,i=e.getContentSize();t._ignoreContentScaleFactor&&(i=e.getContentSizeInPixels()),t._itemsPerColumn=0|i.height/t._itemHeight,t._itemsPerRow=0|i.width/t._itemWidth}}(),_ccsg.Scene=_ccsg.Node.extend({_className:"Scene",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(n.director.getWinSize())}}),_ccsg.Scene.create=function(){return new _ccsg.Scene},n.LoaderScene=_ccsg.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",_onProjectionChange:null,cb:null,target:null,init:function(){var t=this,e=160,i=200,r=t._bgLayer=new n.LayerColor(n.color(32,32,32,255));t.addChild(r,0);var s=24,o=-i/2+100;n._loaderImage&&(n.loader.loadImg(n._loaderImage,{isCrossOrigin:!1},function(r,s){e=s.width,i=s.height,t._initStage(s,n.visibleRect.center)}),s=14,o=-i/2-10);var a=t._label=new n.LabelTTF("Loading... 0%","Arial",s);return a.setPosition(n.pAdd(n.visibleRect.center,n.p(0,o))),a.setColor(n.color(180,180,180)),r.addChild(this._label,10),!0},_initStage:function(t,e){var i=this,r=i._texture2d=new n.Texture2D;r.initWithElement(t),r.handleLoadedTexture();var s=i._logo=new n.Sprite(r);s.setScale(n.contentScaleFactor()),s.x=e.x,s.y=e.y,i._bgLayer.addChild(s,10)},onEnter:function(){var t=this;_ccsg.Node.prototype.onEnter.call(t),t.schedule(t._startLoading,.3),this._onProjectionChange=function(){t._updateTransform()},n.director.on(n.Director.EVENT_PROJECTION_CHANGED,this._onProjectionChange)},onExit:function(){n.director.off(n.Director.EVENT_PROJECTION_CHANGED,this._onProjectionChange),_ccsg.Node.prototype.onExit.call(this);var t="Loading... 0%";this._label.setString(t)},initWithResources:function(t,e,i){n.js.isString(t)&&(t=[t]),this.resources=t||[],this.cb=e,this.target=i},_startLoading:function(){var t=this;t.unschedule(t._startLoading);var e=t.resources;n.loader.load(e,function(e,i,n){var r=n/i*100|0;r=Math.min(r,100),t._label.setString("Loading... "+r+"%")},function(){t.cb&&t.cb.call(t.target)})},_updateTransform:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._bgLayer._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._label._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._logo._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)}}),n.LoaderScene.preload=function(t,e,i){var r=n;return r.loaderScene||(r.loaderScene=new n.LoaderScene,r.loaderScene.init()),r.loaderScene.initWithResources(t,e,i),n.director.runScene(r.loaderScene),r.loaderScene},n.Layer=_ccsg.Node.extend({_className:"Layer",ctor:function(){var t=_ccsg.Node.prototype;t.ctor.call(this),this._ignoreAnchorPointForPosition=!0,t.setAnchorPoint.call(this,.5,.5),t.setContentSize.call(this,n.winSize)},init:function(){var t=this;return t._ignoreAnchorPointForPosition=!0,t.setAnchorPoint(.5,.5),t.setContentSize(n.winSize),t._cascadeColorEnabled=!1,t._cascadeOpacityEnabled=!1,!0},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},addChild:function(t,e,i){_ccsg.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._bakeForAddChild(t)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.Layer.CanvasRenderCmd(this):new n.Layer.WebGLRenderCmd(this)}}),n.Layer.create=function(){return new n.Layer},n.LayerColor=n.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(t,e){this.width=t,this.height=e},changeWidth:function(t){this.width=t},changeHeight:function(t){this.height=t},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},ctor:function(t,e,i){n.Layer.prototype.ctor.call(this),this._blendFunc=new n.BlendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.LayerColor.prototype.init.call(this,t,e,i)},init:function(t,e,i){n._renderType!==n.game.RENDER_TYPE_CANVAS&&(this.shaderProgram=n.shaderCache.programForKey(n.SHADER_POSITION_COLOR));var r=n.director.getWinSize();t=t||n.color(0,0,0,255),e=void 0===e?r.width:e,i=void 0===i?r.height:i;var s=this._realColor;return s.r=t.r,s.g=t.g,s.b=t.b,this._realOpacity=t.a,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty),n.LayerColor.prototype.setContentSize.call(this,e,i),!0},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},_setWidth:function(t){_ccsg.Node.prototype._setWidth.call(this,t),this._renderCmd._updateSquareVerticesWidth(t)},_setHeight:function(t){_ccsg.Node.prototype._setHeight.call(this,t),this._renderCmd._updateSquareVerticesHeight(t)},setContentSize:function(t,e){n.Layer.prototype.setContentSize.call(this,t,e),this._renderCmd._updateSquareVertices(t,e)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.LayerColor.CanvasRenderCmd(this):new n.LayerColor.WebGLRenderCmd(this)}}),n.LayerColor.create=function(t,e,i){return new n.LayerColor(t,e,i)},function(){var t=n.LayerColor.prototype;n.defineGetterSetter(t,"width",t._getWidth,t._setWidth),n.defineGetterSetter(t,"height",t._getHeight,t._setHeight)}(),n.LayerGradient=n.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(t,e,i,r){n.LayerColor.prototype.ctor.call(this),this._endColor=n.color(0,0,0,255),this._alongVector=n.p(0,-1),this._startOpacity=255,this._endOpacity=255,r&&r instanceof Array?(this._colorStops=r,r.splice(0,0,{p:0,color:t||n.Color.BLACK}),r.push({p:1,color:e||n.Color.BLACK})):this._colorStops=[{p:0,color:t||n.Color.BLACK},{p:1,color:e||n.Color.BLACK}],n.LayerGradient.prototype.init.call(this,t,e,i,r)},init:function(t,e,i,r){t=t||n.color(0,0,0,255),e=e||n.color(0,0,0,255),i=i||n.p(0,-1);var s=this,o=s._endColor;return s._startOpacity=t.a,o.r=e.r,o.g=e.g,o.b=e.b,s._endOpacity=e.a,s._alongVector=i,s._compressedInterpolation=!0,n.LayerColor.prototype.init.call(s,n.color(t.r,t.g,t.b,255)),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty|_ccsg.Node._dirtyFlags.gradientDirty),!0},setContentSize:function(t,e){n.LayerColor.prototype.setContentSize.call(this,t,e),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},_setWidth:function(t){n.LayerColor.prototype._setWidth.call(this,t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},_setHeight:function(t){n.LayerColor.prototype._setHeight.call(this,t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return n.color(this._realColor)},setStartColor:function(t){this.color=t;var e=this._colorStops;if(e&&e.length>0){var i=e[0].color;i.r=t.r,i.g=t.g,i.b=t.b}},setEndColor:function(t){var e=this._endColor;e.r=t.r,e.g=t.g,e.b=t.b;var i=this._colorStops;if(i&&i.length>0){var n=i[i.length-1].color;n.r=t.r,n.g=t.g,n.b=t.b}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},getEndColor:function(){return n.color(this._endColor)},setStartOpacity:function(t){this._startOpacity=t;var e=this._colorStops;e&&e.length>0&&(e[0].color.a=t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(t){this._endOpacity=t;var e=this._colorStops;e&&e.length>0&&(e[e.length-1].color.a=t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getVector:function(){return n.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(t){this._compressedInterpolation=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(t){this._colorStops=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty|_ccsg.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.LayerGradient.CanvasRenderCmd(this):new n.LayerGradient.WebGLRenderCmd(this)}}),n.LayerGradient.create=function(t,e,i,r){return new n.LayerGradient(t,e,i,r)},function(){var t=n.LayerGradient.prototype;t.startColor,n.defineGetterSetter(t,"startColor",t.getStartColor,t.setStartColor),t.endColor,n.defineGetterSetter(t,"endColor",t.getEndColor,t.setEndColor),t.startOpacity,n.defineGetterSetter(t,"startOpacity",t.getStartOpacity,t.setStartOpacity),t.endOpacity,n.defineGetterSetter(t,"endOpacity",t.getEndOpacity,t.setEndOpacity),t.vector,n.defineGetterSetter(t,"vector",t.getVector,t.setVector),t.colorStops,n.defineGetterSetter(t,"colorStops",t.getColorStops,t.setColorStops)}(),n.LayerMultiplex=n.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(t){n.Layer.prototype.ctor.call(this),t instanceof Array?n.LayerMultiplex.prototype.initWithLayers.call(this,t):n.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(t){return t.length>0&&null==t[t.length-1]&&n.log(n._LogInfos.LayerMultiplex.initWithLayers),this._layers=t,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(t){return t>=this._layers.length?void n.log(n._LogInfos.LayerMultiplex.switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=t,void this.addChild(this._layers[t]))},switchToAndReleaseMe:function(t){return t>=this._layers.length?void n.log(n._LogInfos.LayerMultiplex.switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=t,void this.addChild(this._layers[t]))},addLayer:function(t){return t?void this._layers.push(t):void n.log(n._LogInfos.LayerMultiplex.addLayer)}}),n.LayerMultiplex.create=function(){return new n.LayerMultiplex(Array.prototype.slice.call(arguments))},function(){n.Layer.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._isBaked=!1,this._bakeSprite=null,this._updateCache=2};var t=n.Layer.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.Layer.CanvasRenderCmd,t._setCacheDirty=function(t){if(t&&0===this._updateCache&&(this._updateCache=2),this._cacheDirty===!1){this._cacheDirty=!0;var e=this._cachedParent;e&&e!==this&&e._setNodeDirtyForCache&&e._setNodeDirtyForCache()}},t.transform=function(t,e){{var i=this._worldTransform,n=i.a,r=i.b,s=i.c,o=i.d;i.tx,i.ty}_ccsg.Node.CanvasRenderCmd.prototype.transform.call(this,t,e),i.a===n&&i.b===r&&i.c===s&&i.d===o||0!==this._updateCache||(this._updateCache=2)},t.bake=function(){if(!this._isBaked){this._needDraw=!0,n.renderer.childrenOrderDirty=!0,this._isBaked=this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var t=this._node._children,e=0,i=t.length;i>e;e++)t[e]._renderCmd._setCachedParent(this);this._bakeSprite||(this._bakeSprite=new n.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}},t.unbake=function(){if(this._isBaked){n.renderer.childrenOrderDirty=!0,this._needDraw=!1,this._isBaked=!1,this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var t=this._node._children,e=0,i=t.length;i>e;e++)t[e]._renderCmd._setCachedParent(null)}},t.isBaked=function(){return this._isBaked},t.rendering=function(){if(this._cacheDirty){var t=this._node,e=t._children,i=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var r=this._getBoundingBoxForBake();r.width=0|r.width+.5,r.height=0|r.height+.5;var s=i.getCacheContext(),o=s.getContext();if(i.setPosition(r.x,r.y),this._updateCache>0){i.resetCanvasSize(r.width,r.height),s.setOffset(0-r.x,o.canvas.height-r.height+r.y),t.sortAllChildren(),n.renderer._turnToCacheMode(this.__instanceId);for(var a=0,c=e.length;c>a;a++)e[a].visit(this);n.renderer._renderingToCacheCanvas(s,this.__instanceId),i.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(t){if(!this._isBaked)return void _ccsg.Node.CanvasRenderCmd.prototype.visit.call(this,t);var e=this._node,i=e._children,r=i.length;e._visible&&0!==r&&(this._syncStatus(t),n.renderer.pushRenderCommand(this),this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._bakeSprite.visit(this),this._dirtyFlag=0)},t._bakeForAddChild=function(t){t._parent===this._node&&this._isBaked&&t._renderCmd._setCachedParent(this)},t._getBoundingBoxForBake=function(){var t=null,e=this._node;if(!e._children||0===e._children.length)return n.rect(0,0,10,10);for(var i=e.getNodeToWorldTransform(),r=e._children,s=0,o=r.length;o>s;s++){var a=r[s];if(a&&a._visible)if(t){var c=a._getBoundingBoxToCurrentNode(i);c&&(t=n.rectUnion(t,c))}else t=a._getBoundingBoxToCurrentNode(i)}return t}}(),function(){n.LayerColor.CanvasRenderCmd=function(t){n.Layer.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._blendFuncStr="source-over",this._bakeRenderCmd=new n.CustomRenderCmd(this,this._bakeRendering)};var t=n.LayerColor.CanvasRenderCmd.prototype=Object.create(n.Layer.CanvasRenderCmd.prototype);t.constructor=n.LayerColor.CanvasRenderCmd,t.unbake=function(){n.Layer.CanvasRenderCmd.prototype.unbake.call(this),this._needDraw=!0},t.rendering=function(t,e,i){var r=t||n._renderContext,s=r.getContext(),o=this._node,a=this._displayedColor,c=this._displayedOpacity/255,h=o._contentSize.width,l=o._contentSize.height;0!==c&&(r.setCompositeOperation(this._blendFuncStr),r.setGlobalAlpha(c),r.setFillStyle("rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+", 1)"),r.setTransform(this._worldTransform,e,i),s.fillRect(0,0,h*e,-l*i),n.g_NumberOfDraws++)},t.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._updateSquareVertices=t._updateSquareVerticesWidth=t._updateSquareVerticesHeight=function(){},t._bakeRendering=function(){if(this._cacheDirty){var t,e=this._node,i=this._bakeSprite,r=e._children,s=r.length;this.transform(this.getParentRenderCmd(),!0);var o=this._getBoundingBoxForBake();o.width=0|o.width+.5,o.height=0|o.height+.5;var a=i.getCacheContext(),c=a.getContext();if(i.setPosition(o.x,o.y),this._updateCache>0){c.fillStyle=a._currentFillStyle,i.resetCanvasSize(o.width,o.height),a.setOffset(0-o.x,c.canvas.height-o.height+o.y);var h;if(n.renderer._turnToCacheMode(this.__instanceId),s>0){for(e.sortAllChildren(),t=0;s>t&&(h=r[t],h._localZOrder<0);t++)h._renderCmd.visit(this);for(n.renderer.pushRenderCommand(this);s>t;t++)r[t]._renderCmd.visit(this)}else n.renderer.pushRenderCommand(this);n.renderer._renderingToCacheCanvas(a,this.__instanceId),i.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(t){if(!this._isBaked)return void _ccsg.Node.CanvasRenderCmd.prototype.visit.call(this);var e=this._node;e._visible&&(this._syncStatus(t),n.renderer.pushRenderCommand(this._bakeRenderCmd),this._bakeSprite._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._bakeSprite.visit(this),this._dirtyFlag=0)},t._getBoundingBoxForBake=function(){var t=this._node,e=n.rect(0,0,t._contentSize.width,t._contentSize.height),i=t.getNodeToWorldTransform();if(e=n.rectApplyAffineTransform(e,t.getNodeToWorldTransform()),!t._children||0===t._children.length)return e;for(var r=t._children,s=0;s<r.length;s++){var o=r[s];if(o&&o._visible){var a=o._getBoundingBoxToCurrentNode(i);e=n.rectUnion(e,a)}}return e}}(),function(){n.LayerGradient.RenderCmd={updateStatus:function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;i&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),(i||n||e&t.gradientDirty)&&this._updateColor(),e&t.transformDirty&&this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=0}}}(),function(){n.LayerGradient.CanvasRenderCmd=function(t){n.LayerColor.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._startPoint=n.p(0,0),this._endPoint=n.p(0,0),this._startStopStr=null,this._endStopStr=null};var t=n.LayerGradient.CanvasRenderCmd.prototype=Object.create(n.LayerColor.CanvasRenderCmd.prototype);n.js.mixin(t,n.LayerGradient.RenderCmd),t.constructor=n.LayerGradient.CanvasRenderCmd,t.rendering=function(t,e,i){var r=t||n._renderContext,s=r.getContext(),o=this._node,a=this._displayedOpacity/255;if(0!==a){var c=o._contentSize.width,h=o._contentSize.height;r.setCompositeOperation(this._blendFuncStr),r.setGlobalAlpha(a);var l=s.createLinearGradient(this._startPoint.x*e,this._startPoint.y*i,this._endPoint.x*e,this._endPoint.y*i);if(o._colorStops)for(var d=0;d<o._colorStops.length;d++){var u=o._colorStops[d];l.addColorStop(u.p,this._colorStopsStr[d])}else l.addColorStop(0,this._startStopStr),l.addColorStop(1,this._endStopStr);r.setFillStyle(l),r.setTransform(this._worldTransform,e,i),s.fillRect(0,0,c*e,-h*i),n.g_NumberOfDraws++}},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var r=i&e.colorDirty,s=i&e.opacityDirty;this._dirtyFlag=i,r&&this._syncDisplayColor(),s&&this._syncDisplayOpacity(),i&e.transformDirty&&this.transform(t),(r||s||i&e.gradientDirty)&&this._updateColor()},t._updateColor=function(){
var t=this._node,e=t._contentSize,i=.5*e.width,r=.5*e.height;this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.gradientDirty^this._dirtyFlag;var s=n.pAngleSigned(n.p(0,-1),t._alongVector),o=n.pRotateByAngle(n.p(0,-1),n.p(0,0),s),a=Math.min(Math.abs(1/o.x),Math.abs(1/o.y));this._startPoint.x=i*-o.x*a+i,this._startPoint.y=r*o.y*a-r,this._endPoint.x=i*o.x*a+i,this._endPoint.y=r*-o.y*a-r;var c=this._displayedColor,h=t._endColor,l=t._startOpacity/255,d=t._endOpacity/255;if(this._startStopStr="rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+l.toFixed(4)+")",this._endStopStr="rgba("+Math.round(h.r)+","+Math.round(h.g)+","+Math.round(h.b)+","+d.toFixed(4)+")",t._colorStops){this._startOpacity=0,this._endOpacity=0,this._colorStopsStr=[];for(var u=0;u<t._colorStops.length;u++){var _=t._colorStops[u].color,f=null==_.a?1:_.a/255;this._colorStopsStr.push("rgba("+Math.round(_.r)+","+Math.round(_.g)+","+Math.round(_.b)+","+f.toFixed(4)+")")}}}}(),function(){n.Layer.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t)};var t=n.Layer.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.Layer.WebGLRenderCmd,t.bake=function(){},t.unbake=function(){},t._bakeForAddChild=function(){}}(),function(){n.LayerColor.WebGLRenderCmd=function(t){n.Layer.WebGLRenderCmd.call(this,t),this._needDraw=!0;var e=this;e._squareVerticesAB=new ArrayBuffer(32),e._squareColorsAB=new ArrayBuffer(16);var i=e._squareVerticesAB,r=e._squareColorsAB,s=n.Vertex2F.BYTES_PER_ELEMENT,o=n.WebGLColor.BYTES_PER_ELEMENT;e._squareVertices=[new n.Vertex2F(0,0,i,0),new n.Vertex2F(0,0,i,s),new n.Vertex2F(0,0,i,2*s),new n.Vertex2F(0,0,i,3*s)],e._squareColors=[new n.WebGLColor(0,0,0,255,r,0),new n.WebGLColor(0,0,0,255,r,o),new n.WebGLColor(0,0,0,255,r,2*o),new n.WebGLColor(0,0,0,255,r,3*o)],e._verticesFloat32Buffer=n._renderContext.createBuffer(),e._colorsUint8Buffer=n._renderContext.createBuffer()};var t=n.LayerColor.WebGLRenderCmd.prototype=Object.create(n.Layer.WebGLRenderCmd.prototype);t.constructor=n.LayerColor.WebGLRenderCmd,t.rendering=function(t){var e=t||n._renderContext,i=this._node;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION|n.VERTEX_ATTRIB_FLAG_COLOR),n.glBlendFunc(i._blendFunc.src,i._blendFunc.dst),e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer),e.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer),e.vertexAttribPointer(n.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,this._squareVertices.length)},t._updateSquareVertices=function(t,e){var i=this._squareVertices;void 0===e?(i[1].x=t.width,i[2].y=t.height,i[3].x=t.width,i[3].y=t.height):(i[1].x=t,i[2].y=e,i[3].x=t,i[3].y=e),this._bindLayerVerticesBufferData()},t._updateSquareVerticesWidth=function(t){var e=this._squareVertices;e[1].x=t,e[3].x=t,this._bindLayerVerticesBufferData()},t._updateSquareVerticesHeight=function(t){var e=this._squareVertices;e[2].y=t,e[3].y=t,this._bindLayerVerticesBufferData()},t._updateColor=function(){for(var t=this._displayedColor,e=this._displayedOpacity,i=this._squareColors,n=0;4>n;n++)i[n].r=t.r,i[n].g=t.g,i[n].b=t.b,i[n].a=e;this._bindLayerColorsBufferData()},t._bindLayerVerticesBufferData=function(){var t=n._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareVerticesAB,t.STATIC_DRAW)},t._bindLayerColorsBufferData=function(){var t=n._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareColorsAB,t.STATIC_DRAW)},t.updateBlendFunc=function(t){}}(),function(){n.LayerGradient.WebGLRenderCmd=function(t){n.LayerColor.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._clipRect=new n.Rect,this._clippingRectDirty=!1};var t=n.LayerGradient.WebGLRenderCmd.prototype=Object.create(n.LayerColor.WebGLRenderCmd.prototype);n.js.mixin(t,n.LayerGradient.RenderCmd),t.constructor=n.LayerGradient.WebGLRenderCmd,t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var r=i&e.colorDirty,s=i&e.opacityDirty;this._dirtyFlag=i,r&&this._syncDisplayColor(),s&&this._syncDisplayOpacity(),this.transform(t),(r||s||i&e.gradientDirty)&&this._updateColor()},t._updateColor=function(){this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.gradientDirty^this._dirtyFlag;var t=this._node,e=t._colorStops;if(e&&!(e.length<2)){this._clippingRectDirty=!0;var i,r=e.length,s=2*r,o=t._contentSize;this._squareVerticesAB=new ArrayBuffer(8*s),this._squareColorsAB=new ArrayBuffer(4*s);var a=this._squareVertices,c=this._squareColors;a.length=0,c.length=0;var h=this._squareVerticesAB,l=this._squareColorsAB,d=n.Vertex2F.BYTES_PER_ELEMENT,u=n.WebGLColor.BYTES_PER_ELEMENT;for(i=0;s>i;i++)a.push(new n.Vertex2F(0,0,h,d*i)),c.push(new n.WebGLColor(0,0,0,255,l,u*i));var _=Math.PI+n.pAngleSigned(n.p(0,-1),t._alongVector),f=n.p(o.width/2,o.height/2),p=Math.round(n.radiansToDegrees(_)),g=n.affineTransformMake(1,0,0,1,f.x,f.y);g=n.affineTransformRotate(g,_);var m,y;90>p?(m=n.p(-f.x,f.y),y=n.p(f.x,f.y)):180>p?(m=n.p(f.x,f.y),y=n.p(f.x,-f.y)):270>p?(m=n.p(f.x,-f.y),y=n.p(-f.x,-f.y)):(m=n.p(-f.x,-f.y),y=n.p(-f.x,f.y));var v=Math.sin(_),T=Math.cos(_),C=Math.abs((m.x*T-m.y*v)/f.x),S=Math.abs((y.x*v+y.y*T)/f.y);for(g=n.affineTransformScale(g,C,S),i=0;r>i;i++){var E=e[i],b=E.p*o.height,x=n.pointApplyAffineTransform(-f.x,b-f.y,g);a[2*i].x=x.x,a[2*i].y=x.y;var A=n.pointApplyAffineTransform(o.width-f.x,b-f.y,g);a[2*i+1].x=A.x,a[2*i+1].y=A.y}var R=this._displayedOpacity/255;for(i=0;r>i;i++){var I=e[i].color,P=c[2*i],L=c[2*i+1];P.r=I.r,P.g=I.g,P.b=I.b,P.a=I.a*R,L.r=I.r,L.g=I.g,L.b=I.b,L.a=I.a*R}this._bindLayerVerticesBufferData(),this._bindLayerColorsBufferData()}},t.rendering=function(t){var e=t||n._renderContext,i=this._node,r=this._getClippingRect();e.enable(e.SCISSOR_TEST),n.view.setScissorInPoints(r.x,r.y,r.width,r.height),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION|n.VERTEX_ATTRIB_FLAG_COLOR),n.glBlendFunc(i._blendFunc.src,i._blendFunc.dst),e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer),e.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer),e.vertexAttribPointer(n.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,this._squareVertices.length),e.disable(e.SCISSOR_TEST)},t._getClippingRect=function(){if(this._clippingRectDirty){var t=this._node,e=n.rect(0,0,t._contentSize.width,t._contentSize.height),i=t.getNodeToWorldTransform();this._clipRect=n._rectApplyAffineTransformIn(e,i)}return this._clipRect}}(),n._tmp.PrototypeSprite=function(){var t=n.Sprite.prototype;n.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB,t.setOpacityModifyRGB),n.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),n.defineGetterSetter(t,"color",t.getColor,t.setColor),t.dirty,t.flippedX,n.defineGetterSetter(t,"flippedX",t.isFlippedX,t.setFlippedX),t.flippedY,n.defineGetterSetter(t,"flippedY",t.isFlippedY,t.setFlippedY),t.offsetX,n.defineGetterSetter(t,"offsetX",t._getOffsetX),t.offsetY,n.defineGetterSetter(t,"offsetY",t._getOffsetY),t.atlasIndex,t.texture,n.defineGetterSetter(t,"texture",t.getTexture,t.setTexture),t.textureRectRotated,n.defineGetterSetter(t,"textureRectRotated",t.isTextureRectRotated),t.textureAtlas,t.batchNode,n.defineGetterSetter(t,"batchNode",t.getBatchNode,t.setBatchNode),t.quad,n.defineGetterSetter(t,"quad",t.getQuad)};var _=t("../cocos2d/core/event/event-target");n.Sprite=_ccsg.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,e,i){var r=this;_ccsg.Node.prototype.ctor.call(r),_.call(r),r._shouldBeHidden=!1,r._offsetPosition=n.p(0,0),r._unflippedOffsetPositionFromCenter=n.p(0,0),r._blendFunc={src:n.BLEND_SRC,dst:n.BLEND_DST},r._rect=n.rect(0,0,0,0),r._softInit(t,e,i)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return n.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t},getOffsetPosition:function(){return n.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){n.assert(t,n._LogInfos.Sprite.initWithSpriteFrame),t.textureLoaded()||(this._textureLoaded=!1,t.once("load",this._renderCmd._spriteFrameLoadedCallback,this._renderCmd));var e=n._renderType===n.game.RENDER_TYPE_CANVAS?!1:t._rotated,i=this.initWithTexture(t.getTexture(),t.getRect(),e);return this.setSpriteFrame(t),i},initWithSpriteFrameName:function(t){n.assert(t,n._LogInfos.Sprite.initWithSpriteFrameName);var e=n.spriteFrameCache.getSpriteFrame(t);return n.assert(e,t+n._LogInfos.Sprite.initWithSpriteFrameName1),this.initWithSpriteFrame(e)},useBatchNode:function(t){this.textureAtlas=t.getTextureAtlas(),this._batchNode=t},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;r>t;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i.arrivalOrder<n[e].arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._batchNode&&this._arrayMakeObjectsPerformSelector(n,_ccsg.Node._stateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},reorderChild:function(t,e){return n.assert(t,n._LogInfos.Sprite.reorderChild_2),-1===this._children.indexOf(t)?void n.log(n._LogInfos.Sprite.reorderChild):void(e!==t.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),_ccsg.Node.prototype.reorderChild.call(this,t,e)))},removeChild:function(t,e){this._batchNode&&this._batchNode.removeSpriteFromAtlas(t),_ccsg.Node.prototype.removeChild.call(this,t,e)},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.setDirtyRecursively(!0)},removeAllChildren:function(t){var e=this._children,i=this._batchNode;if(i&&null!=e)for(var n=0,r=e.length;r>n;n++)i.removeSpriteFromAtlas(e[n]);_ccsg.Node.prototype.removeAllChildren.call(this,t),this._hasChildren=!1},ignoreAnchorPointForPosition:function(t){return this._batchNode?void n.log(n._LogInfos.Sprite.ignoreAnchorPointForPosition):void _ccsg.Node.prototype.ignoreAnchorPointForPosition.call(this,t)},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,e){n.assert(t,n._LogInfos.Sprite.setDisplayFrameWithAnimationName_3);var i=n.animationCache.getAnimation(t);if(!i)return void n.log(n._LogInfos.Sprite.setDisplayFrameWithAnimationName);var r=i.getFrames()[e];return r?void this.setSpriteFrame(r.getSpriteFrame()):void n.log(n._LogInfos.Sprite.setDisplayFrameWithAnimationName_2)},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var t=this._parent;t&&t!==this._batchNode;)t._setReorderChildDirtyRecursively(),t=t.parent}},getTexture:function(){return this._texture},_softInit:function(t,e,i){if(void 0===t)n.Sprite.prototype.init.call(this);else if(n.js.isString(t))if("#"===t[0]){var r=t.substr(1,t.length-1),s=n.spriteFrameCache.getSpriteFrame(r);s?this.initWithSpriteFrame(s):n.log("%s does not exist",t)}else n.Sprite.prototype.init.call(this,t,e);else if("object"==typeof t)if(t instanceof n.Texture2D)this.initWithTexture(t,e,i);else if(t instanceof n.SpriteFrame)this.initWithSpriteFrame(t);else if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var o=new n.Texture2D;o.initWithElement(t),o.handleLoadedTexture(),this.initWithTexture(o)}},getQuad:function(){return this._renderCmd.getQuad()},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},init:function(){var t=this;return arguments.length>0?t.initWithFile(arguments[0],arguments[1]):(_ccsg.Node.prototype.init.call(t),t.dirty=t._recursiveDirty=!1,t._blendFunc.src=n.BLEND_SRC,t._blendFunc.dst=n.BLEND_DST,t.texture=null,t._flippedX=t._flippedY=!1,t.anchorX=.5,t.anchorY=.5,t._offsetPosition.x=0,t._offsetPosition.y=0,t._hasChildren=!1,this._renderCmd._init(),t.setTextureRect(n.rect(0,0,0,0),!1,n.size(0,0)),!0)},initWithFile:function(t,e){n.assert(t,n._LogInfos.Sprite.initWithFile);var i=n.textureCache.getTextureForKey(t);if(i){if(!e){var r=i.getContentSize();e=n.rect(0,0,r.width,r.height)}return this.initWithTexture(i,e)}return i=n.textureCache.addImage(t),this.initWithTexture(i,e||n.rect(0,0,i._contentSize.width,i._contentSize.height))},initWithTexture:function(t,e,i,r){var s=this;if(n.assert(0!==arguments.length,n._LogInfos.SpriteBatchNode.initWithTexture),i=i||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,e,i,r),!_ccsg.Node.prototype.init.call(s))return!1;s._batchNode=null,s._recursiveDirty=!1,s.dirty=!1,s._opacityModifyRGB=!0,s._blendFunc.src=n.BLEND_SRC,s._blendFunc.dst=n.BLEND_DST,s._flippedX=s._flippedY=!1,s.setAnchorPoint(.5,.5),s._offsetPosition.x=0,s._offsetPosition.y=0,s._hasChildren=!1,this._renderCmd._init();var o=t.isLoaded();return s._textureLoaded=o,o?(e||(e=n.rect(0,0,t.width,t.height)),this._renderCmd._checkTextureBoundary(t,e,i),s.setTexture(t),s.setTextureRect(e,i),s.setBatchNode(null),this.emit("load"),!0):(s._rectRotated=i,e&&(s._rect.x=e.x,s._rect.y=e.y,s._rect.width=e.width,s._rect.height=e.height),s.texture&&s.texture.off("load",s._renderCmd._textureLoadedCallback,s._renderCmd),t.once("load",s._renderCmd._textureLoadedCallback,s._renderCmd),s.setTexture(t),!0)},setTextureRect:function(t,e,i,n){var r=this;r._rectRotated=e||!1,r.setContentSize(i||t),r.setVertexRect(t),r._renderCmd._setTextureCoords(t,n);var s=r._unflippedOffsetPositionFromCenter.x,o=r._unflippedOffsetPositionFromCenter.y;r._flippedX&&(s=-s),r._flippedY&&(o=-o);var a=r._rect;r._offsetPosition.x=s+(r._contentSize.width-a.width)/2,r._offsetPosition.y=o+(r._contentSize.height-a.height)/2,r._batchNode?r.dirty=!0:this._renderCmd._resetForBatchNode()},updateTransform:function(){this._renderCmd.updateTransform()},addChild:function(t,e,i){n.assert(t,n._LogInfos.SpriteBatchNode.addChild_2),null==e&&(e=t._localZOrder),null==i&&(i=t.tag),this._renderCmd._setBatchNodeForAddChild(t)&&(_ccsg.Node.prototype.addChild.call(this,t,e,i),this._hasChildren=!0)},setSpriteFrame:function(t){var e=this;n.js.isString(t)&&(t=n.spriteFrameCache.getSpriteFrame(t),n.assert(t,n._LogInfos.Sprite.setSpriteFrame)),this.setNodeDirty(!0);var i=t.getOffset();e._unflippedOffsetPositionFromCenter.x=i.x,e._unflippedOffsetPositionFromCenter.y=i.y;var r=t.getTexture(),s=t.textureLoaded();s?(r!==e._texture&&e.setTexture(r),e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())):(r!==e._texture&&e.setTexture(r),e._textureLoaded=!1,t.once("load",function(t){var i=t.currentTarget;e._textureLoaded=!0,e.setTextureRect(i.getRect(),i.isRotated(),i.getOriginalSize()),e.emit("load"),e.setColor(e.color)},e)),this._renderCmd._updateForSetSpriteFrame(r)},setDisplayFrame:function(t){n.log(n._LogInfos.Sprite.setDisplayFrame),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new n.SpriteFrame(this._texture,n.rectPointsToPixels(this._rect),this._rectRotated,n.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),n.sizePointsToPixels(this._contentSize))},setBatchNode:function(t){var e=this;e._batchNode=t,e._batchNode?(e._transformToBatch=n.affineTransformIdentity(),e.textureAtlas=e._batchNode.getTextureAtlas()):(e.atlasIndex=n.Sprite.INDEX_NOT_INITIALIZED,e.textureAtlas=null,e._recursiveDirty=!1,e.dirty=!1,this._renderCmd._resetForBatchNode())},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var e=n.js.isString(t);e&&(t=n.textureCache.addImage(t)),t._textureLoaded?(this._setTexture(t,e),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")):(this._renderCmd._setTexture(t),t.once("load",function(i){this._setTexture(t,e),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")},this))},_setTexture:function(t,e){this._renderCmd._setTexture(t),e&&this._changeRectWithTexture(t)},_changeRectWithTexture:function(t){var e=t._contentSize,i=n.rect(0,0,e.width,e.height);this.setTextureRect(i)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.Sprite.CanvasRenderCmd(this):new n.Sprite.WebGLRenderCmd(this)}}),n.Sprite.create=function(t,e,i){return new n.Sprite(t,e,i)},n.Sprite.createWithTexture=n.Sprite.create,n.Sprite.createWithSpriteFrameName=n.Sprite.create,n.Sprite.createWithSpriteFrame=n.Sprite.create,n.Sprite.INDEX_NOT_INITIALIZED=-1,n.js.addon(n.Sprite.prototype,_.prototype),n.assert(n.js.isFunction(n._tmp.PrototypeSprite),n._LogInfos.MissingFile,"SpritesPropertyDefine.js"),n._tmp.PrototypeSprite(),delete n._tmp.PrototypeSprite,function(){n.Sprite.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._textureToRender=null};var t=n.Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.Sprite.CanvasRenderCmd,t._init=function(){},t.setDirtyRecursively=function(t){},t._resetForBatchNode=function(){},t._setTexture=function(t){var e=this._node;e._texture!==t&&(e._textureLoaded=t?t._textureLoaded:!1,e._texture=t,this._updateColor())},t._setColorDirty=function(){this.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty)},t.isFrameDisplayed=function(t){var e=this._node;return t.getTexture()!==e._texture?!1:n.rectEqualToRect(t.getRect(),e._rect)},t.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._setBatchNodeForAddChild=function(t){return!0},t._handleTextureForRotatedTexture=function(t,e,i,r){if(i&&t.isLoaded()){var s=t.getHtmlElementObj();s=n.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(s,e,r);var o=new n.Texture2D;o.initWithElement(s),o.handleLoadedTexture(),t=o,e.x=e.y=0,this._node._rect=n.rect(0,0,e.width,e.height)}return t},t._checkTextureBoundary=function(t,e,i){if(t&&t.url){var r=e.x+e.width,s=e.y+e.height;r>t.width&&n.error(n._LogInfos.RectWidth,t.url),s>t.height&&n.error(n._LogInfos.RectHeight,t.url)}},t.rendering=function(t,e,i){var r=this._node,s=this._textureCoord,o=this._displayedOpacity/255,a=this._textureToRender||r._texture;if((!a||0!==s.width&&0!==s.height&&a._textureLoaded)&&0!==o){var c,h=t||n._renderContext,l=h.getContext(),d=r._offsetPosition.x,u=r._rect.height,_=r._rect.width,f=-r._offsetPosition.y-u;h.setTransform(this._worldTransform,e,i),h.setCompositeOperation(this._blendFuncStr),h.setGlobalAlpha(o),(r._flippedX||r._flippedY)&&h.save(),r._flippedX&&(d=-d-_,l.scale(-1,1)),r._flippedY&&(f=r._offsetPosition.y,l.scale(1,-1));var p,g,m,y,v,T,C,S;if(this._colorized?(p=0,g=0):(p=s.renderX,g=s.renderY),m=s.width,y=s.height,v=d*e,T=f*i,C=_*e,S=u*i,a)c=a._htmlElementObj,""!==a._pattern?(h.setFillStyle(l.createPattern(c,a._pattern)),l.fillRect(v,T,C,S)):l.drawImage(c,p,g,m,y,v,T,C,S);else{var E=r._contentSize;if(s.validRect){var b=this._displayedColor;h.setFillStyle("rgba("+b.r+","+b.g+","+b.b+",1)"),l.fillRect(v,T,E.width*e,E.height*i)}}(r._flippedX||r._flippedY)&&h.restore(),n.g_NumberOfDraws++}},t._updateColor=function(){var t=this._node,e=t._texture,i=this._textureCoord,n=this._displayedColor;e&&(255!==n.r||255!==n.g||255!==n.b?(this._textureToRender=e._generateColorTexture(n.r,n.g,n.b,i),this._colorized=!0):e&&(this._textureToRender=e,this._colorized=!1))},t.getQuad=function(){return null},t._updateForSetSpriteFrame=function(t,e){if(this._colorized=!1,this._textureCoord.renderX=this._textureCoord.x,this._textureCoord.renderY=this._textureCoord.y,e=e||t._textureLoaded){var i=this._node.getColor();(255!==i.r||255!==i.g||255!==i.b)&&this._updateColor()}},t.updateTransform=function(){var t=this,e=this._node;if(e.dirty){var i=e._parent;!e._visible||i&&i!==e._batchNode&&i._shouldBeHidden?e._shouldBeHidden=!0:(e._shouldBeHidden=!1,e._transformToBatch=i&&i!==e._batchNode?n.affineTransformConcat(t.getNodeToParentTransform(),i._transformToBatch):t.getNodeToParentTransform()),e._recursiveDirty=!1,e.dirty=!1}e._hasChildren&&e._arrayMakeObjectsPerformSelector(e._children,_ccsg.Node._stateCallbackType.updateTransform)},t._updateDisplayColor=function(t){_ccsg.Node.CanvasRenderCmd.prototype._updateDisplayColor.call(this,t)},t._spriteFrameLoadedCallback=function(t){var e=this._node,i=t.currentTarget;e.setTextureRect(i.getRect(),i.isRotated(),i.getOriginalSize()),this._updateColor(),e.emit("load")},t._textureLoadedCallback=function(t){var e=this._node,i=t.currentTarget;if(!e._textureLoaded){e._textureLoaded=!0;var r=(e._texture,e._rect);r?n._rectEqualToZero(r)&&(r.width=i.width,r.height=i.height):r=n.rect(0,0,i.width,i.height),e.texture=i,e.setTextureRect(r,e._rectRotated);var s=this._displayedColor;(255!==s.r||255!==s.g||255!==s.b)&&this._updateColor(),e.setBatchNode(e._batchNode),e.emit("load")}},t._setTextureCoords=function(t,e){void 0===e&&(e=!0);var i=this._textureCoord,r=e?n.contentScaleFactor():1;i.renderX=i.x=0|t.x*r,i.renderY=i.y=0|t.y*r,i.width=0|t.width*r,i.height=0|t.height*r,i.validRect=!(0===i.width||0===i.height||i.x<0||i.y<0)},n.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,e,i){if(!t)return null;if(!e)return t;i=null==i?!0:i;var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),r.rotate(i?-1.5707963267948966:1.5707963267948966),r.drawImage(t,e.x,e.y,e.height,e.width,-e.height/2,-e.width/2,e.height,e.width),n}}(),function(){n.Sprite.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._quad=new n.V3F_C4B_T2F_Quad,this._quadWebBuffer=n._renderContext.createBuffer(),this._quadDirty=!0,this._dirty=!1,this._recursiveDirty=!1};var t=n.Sprite.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.Sprite.WebGLRenderCmd,t.updateBlendFunc=function(t){},t.setDirtyFlag=function(t){_ccsg.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},t.setDirtyRecursively=function(t){this._recursiveDirty=t,this._dirty=t;for(var e,i=this._node._children,r=i?i.length:0,s=0;r>s;s++)e=i[s],e instanceof n.Sprite&&e._renderCmd.setDirtyRecursively(t)},t._setBatchNodeForAddChild=function(t){var e=this._node;if(e._batchNode){if(!(t instanceof n.Sprite))return n.log(n._LogInfos.Sprite.addChild),!1;t.texture._webTextureObj!==e.textureAtlas.texture._webTextureObj&&n.log(n._LogInfos.Sprite_addChild_2),e._batchNode.appendChild(t),e._reorderChildDirty||e._setReorderChildDirtyRecursively()}return!0},t._handleTextureForRotatedTexture=function(t){return t},t.isFrameDisplayed=function(t){var e=this._node;return n.rectEqualToRect(t.getRect(),e._rect)&&t.getTexture().getName()===e._texture.getName()&&n.pointEqualToPoint(t.getOffset(),e._unflippedOffsetPositionFromCenter)},t._init=function(){var t={r:255,g:255,b:255,a:255},e=this._quad;e.bl.colors=t,e.br.colors=t,e.tl.colors=t,e.tr.colors=t,this._quadDirty=!0},t._resetForBatchNode=function(){var t=this._node,e=t._offsetPosition.x,i=t._offsetPosition.y,n=e+t._rect.width,r=i+t._rect.height,s=this._quad;s.bl.vertices={x:e,y:i,z:0},s.br.vertices={x:n,y:i,z:0},s.tl.vertices={x:e,y:r,z:0},s.tr.vertices={x:n,y:r,z:0},this._quadDirty=!0},t.getQuad=function(){return this._quad},t._updateForSetSpriteFrame=function(){},t._spriteFrameLoadedCallback=function(t){var e=t.currentTarget;this._node.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),this._node.emit("load")},t._textureLoadedCallback=function(t){var e=this._node,i=t.currentTarget;if(!e._textureLoaded){e._textureLoaded=!0;var r=e._rect;r?n._rectEqualToZero(r)&&(r.width=i.width,r.height=i.height):r=n.rect(0,0,i.width,i.height),e.texture=i,e.setTextureRect(r,e._rectRotated),e.setBatchNode(e._batchNode),this._quadDirty=!0,e.emit("load")}},t._setTextureCoords=function(t,e){void 0===e&&(e=!0),e&&(t=n.rectPointsToPixels(t));var i=this._node,r=i._batchNode?i.textureAtlas.texture:i._texture;if(r){var s,o,a,c,h,l=r.pixelWidth,d=r.pixelHeight,u=this._quad;i._rectRotated?(n.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(s=(2*t.x+1)/(2*l),o=s+(2*t.height-2)/(2*l),a=(2*t.y+1)/(2*d),c=a+(2*t.width-2)/(2*d)):(s=t.x/l,o=(t.x+t.height)/l,a=t.y/d,c=(t.y+t.width)/d),i._flippedX&&(h=a,a=c,c=h),i._flippedY&&(h=s,s=o,o=h),u.bl.texCoords.u=s,u.bl.texCoords.v=a,u.br.texCoords.u=s,u.br.texCoords.v=c,u.tl.texCoords.u=o,u.tl.texCoords.v=a,u.tr.texCoords.u=o,u.tr.texCoords.v=c):(n.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(s=(2*t.x+1)/(2*l),o=s+(2*t.width-2)/(2*l),a=(2*t.y+1)/(2*d),c=a+(2*t.height-2)/(2*d)):(s=t.x/l,o=(t.x+t.width)/l,a=t.y/d,c=(t.y+t.height)/d),i._flippedX&&(h=s,s=o,o=h),i._flippedY&&(h=a,a=c,c=h),u.bl.texCoords.u=s,u.bl.texCoords.v=c,u.br.texCoords.u=o,u.br.texCoords.v=c,u.tl.texCoords.u=s,u.tl.texCoords.v=a,u.tr.texCoords.u=o,u.tr.texCoords.v=a),this._quadDirty=!0}},t.transform=function(t,e){_ccsg.Node.WebGLRenderCmd.prototype.transform.call(this,t,e),this._dirty=!0},t._setColorDirty=function(){},t._updateColor=function(){var t=this._node,e=this._displayedColor,i=e.r,r=e.g,s=e.b,o=e.a=this._displayedOpacity;t._opacityModifyRGB&&(e.r*=o/255,e.g*=o/255,e.b*=o/255);var a=this._quad;a.bl.colors=e,a.br.colors=e,a.tl.colors=e,a.tr.colors=e,e.r=i,e.g=r,e.b=s,t._batchNode&&(t.atlasIndex!==n.Sprite.INDEX_NOT_INITIALIZED?t.textureAtlas.updateQuad(a,t.atlasIndex):this._dirty=!0),this._quadDirty=!0},t._updateBlendFunc=function(){if(this._batchNode)return void n.log(n._LogInfos.Sprite__updateBlendFunc);var t=this._node;t._texture&&t._texture.hasPremultipliedAlpha()?(t._blendFunc.src=n.BLEND_SRC,t._blendFunc.dst=n.BLEND_DST,t.opacityModifyRGB=!0):(t._blendFunc.src=n.SRC_ALPHA,t._blendFunc.dst=n.ONE_MINUS_SRC_ALPHA,t.opacityModifyRGB=!1)},t._setTexture=function(t){var e=this._node;if(e._batchNode){if(e._batchNode.texture!==t)return void n.log(n._LogInfos.Sprite_setTexture)}else e._texture!==t&&(e._textureLoaded=t?t._textureLoaded:!1,e._texture=t,this._updateBlendFunc());this._shaderProgram=n.shaderCache.programForKey(t?n.SHADER_POSITION_TEXTURECOLOR:n.SHADER_POSITION_COLOR)},t.updateTransform=function(){var t=this,e=this._node;if(this._dirty){var i=t._quad,r=e._parent;if(!e._visible||r&&r!==e._batchNode&&r._shouldBeHidden)i.br.vertices=i.tl.vertices=i.tr.vertices=i.bl.vertices={x:0,y:0,z:0},e._shouldBeHidden=!0;else{e._shouldBeHidden=!1,0!==this._dirtyFlag&&(this.updateStatus(),this._dirtyFlag=0),e._transformToBatch=r&&r!==e._batchNode?n.affineTransformConcat(t.getNodeToParentTransform(),r._transformToBatch):t.getNodeToParentTransform();var s=e._transformToBatch,o=e._rect,a=e._offsetPosition.x,c=e._offsetPosition.y,h=a+o.width,l=c+o.height,d=s.tx,u=s.ty,_=s.a,f=s.b,p=s.d,g=-s.c,m=a*_-c*g+d,y=a*f+c*p+u,v=h*_-c*g+d,T=h*f+c*p+u,C=h*_-l*g+d,S=h*f+l*p+u,E=a*_-l*g+d,b=a*f+l*p+u,x=e._vertexZ;n.SPRITEBATCHNODE_RENDER_SUBPIXEL||(m=0|m,y=0|y,v=0|v,T=0|T,C=0|C,S=0|S,E=0|E,b=0|b),i.bl.vertices={x:m,y:y,z:x},i.br.vertices={x:v,y:T,z:x},i.tl.vertices={x:E,y:b,z:x},i.tr.vertices={x:C,y:S,z:x}}e.textureAtlas.updateQuad(i,e.atlasIndex),e._recursiveDirty=!1,this._dirty=!1}e._hasChildren&&e._arrayMakeObjectsPerformSelector(e._children,_ccsg.Node._stateCallbackType.updateTransform)},t._checkTextureBoundary=function(t,e,i){if(t&&t.url){var r,s;i?(r=e.x+e.height,s=e.y+e.width):(r=e.x+e.width,s=e.y+e.height),r>t.width&&n.error(n._LogInfos.RectWidth,t.url),s>t.height&&n.error(n._LogInfos.RectHeight,t.url)}},t.rendering=function(t){var e=this._node,i=e._texture;if((!i||i._textureLoaded)&&0!==this._displayedOpacity){var r=t||n._renderContext;if(i?i._textureLoaded&&(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),n.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),n.glBindTexture2DN(0,i),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),r.bindBuffer(r.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(r.bufferData(r.ARRAY_BUFFER,this._quad.arrayBuffer,r.DYNAMIC_DRAW),this._quadDirty=!1),r.vertexAttribPointer(0,3,r.FLOAT,!1,24,0),r.vertexAttribPointer(1,4,r.UNSIGNED_BYTE,!0,24,12),r.vertexAttribPointer(2,2,r.FLOAT,!1,24,16),r.drawArrays(r.TRIANGLE_STRIP,0,4)):(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),n.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),n.glBindTexture2D(null),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION|n.VERTEX_ATTRIB_FLAG_COLOR),r.bindBuffer(r.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(r.bufferData(r.ARRAY_BUFFER,this._quad.arrayBuffer,r.STATIC_DRAW),this._quadDirty=!1),r.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,3,r.FLOAT,!1,24,0),r.vertexAttribPointer(n.VERTEX_ATTRIB_COLOR,4,r.UNSIGNED_BYTE,!0,24,12),r.drawArrays(r.TRIANGLE_STRIP,0,4)),n.g_NumberOfDraws++,0!==n.SPRITE_DEBUG_DRAW||e._showNode){if(n.kmGLMatrixMode(n.KM_GL_MODELVIEW),n.current_stack.stack.push(n.current_stack.top),n.current_stack.top=this._stackMatrix,1===n.SPRITE_DEBUG_DRAW||e._showNode){var s=this._quad,o=[n.p(s.tl.vertices.x,s.tl.vertices.y),n.p(s.bl.vertices.x,s.bl.vertices.y),n.p(s.br.vertices.x,s.br.vertices.y),n.p(s.tr.vertices.x,s.tr.vertices.y)];n._drawingUtil.drawPoly(o,4,!0)}else if(2===n.SPRITE_DEBUG_DRAW){var a=e.getTextureRect(),c=e.getOffsetPosition(),h=[n.p(c.x,c.y),n.p(c.x+a.width,c.y),n.p(c.x+a.width,c.y+a.height),n.p(c.x,c.y+a.height)];n._drawingUtil.drawPoly(h,4,!0)}n.current_stack.top=n.current_stack.stack.pop()}}}}(),n.BakeSprite=n.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){n.Sprite.prototype.ctor.call(this);var t=document.createElement("canvas");t.width=t.height=10,this._cacheCanvas=t,this._cacheContext=new n.CanvasContextWrapper(t.getContext("2d"));var e=new n.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),this.setTexture(e)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(t,e){var i=this._cacheCanvas,r=this._cacheContext,s=r._context.strokeStyle,o=r._context.fillStyle;void 0===e&&(e=t.height,t=t.width),i.width=t,i.height=e,s!==r._context.strokeStyle&&(r._context.strokeStyle=s),
o!==r._context.fillStyle&&(r._context.fillStyle=o),this.getTexture().handleLoadedTexture(),this.setTextureRect(n.rect(0,0,t,e),!1,null,!1)}}),n.AnimationFrame=n._Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(t,e,i){this._spriteFrame=t||null,this._delayPerUnit=e||0,this._userInfo=i||null},clone:function(){var t=new n.AnimationFrame;return t.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),t},copyWithZone:function(t){return n.clone(this)},copy:function(t){var e=new n.AnimationFrame;return e.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),e},initWithSpriteFrame:function(t,e,i){return this._spriteFrame=t,this._delayPerUnit=e,this._userInfo=i,!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(t){this._spriteFrame=t},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(t){this._delayPerUnit=t},getUserInfo:function(){return this._userInfo},setUserInfo:function(t){this._userInfo=t}}),n.AnimationFrame.create=function(t,e,i){return new n.AnimationFrame(t,e,i)},n.Animation=n._Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(t,e,i){if(this._frames=[],void 0===t)this.initWithSpriteFrames(null,0);else{var r=t[0];r&&(r instanceof n.SpriteFrame?this.initWithSpriteFrames(t,e,i):r instanceof n.AnimationFrame&&this.initWithAnimationFrames(t,e,i))}},getFrames:function(){return this._frames},setFrames:function(t){this._frames=t},addSpriteFrame:function(t){var e=new n.AnimationFrame;e.initWithSpriteFrame(t,1,null),this._frames.push(e),this._totalDelayUnits++},addSpriteFrameWithFile:function(t){var e=n.textureCache.addImage(t),i=n.rect(0,0,0,0);i.width=e.width,i.height=e.height;var r=new n.SpriteFrame(e,i);this.addSpriteFrame(r)},addSpriteFrameWithTexture:function(t,e){var i=new n.SpriteFrame(t,e);this.addSpriteFrame(i)},initWithAnimationFrames:function(t,e,i){n.js.array.verifyType(t,n.AnimationFrame),this._delayPerUnit=e,this._loops=void 0===i?1:i,this._totalDelayUnits=0;var r=this._frames;r.length=0;for(var s=0;s<t.length;s++){var o=t[s];r.push(o),this._totalDelayUnits+=o.getDelayUnits()}return!0},clone:function(){var t=new n.Animation;return t.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),t.setRestoreOriginalFrame(this._restoreOriginalFrame),t},copyWithZone:function(t){var e=new n.Animation;return e.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),e.setRestoreOriginalFrame(this._restoreOriginalFrame),e},_copyFrames:function(){for(var t=[],e=0;e<this._frames.length;e++)t.push(this._frames[e].clone());return t},copy:function(t){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(t){this._loops=t},setRestoreOriginalFrame:function(t){this._restoreOriginalFrame=t},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(t){this._delayPerUnit=t},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(t,e,i){n.js.array.verifyType(t,n.SpriteFrame),this._loops=void 0===i?1:i,this._delayPerUnit=e||0,this._totalDelayUnits=0;var r=this._frames;if(r.length=0,t){for(var s=0;s<t.length;s++){var o=t[s],a=new n.AnimationFrame;a.initWithSpriteFrame(o,1,null),r.push(a)}this._totalDelayUnits+=t.length}return!0},retain:function(){},release:function(){}}),n.Animation.create=function(t,e,i){return new n.Animation(t,e,i)},n.Animation.createWithAnimationFrames=n.Animation.create,n.animationCache={_animations:{},addAnimation:function(t,e){this._animations[e]=t},removeAnimation:function(t){t&&this._animations[t]&&delete this._animations[t]},getAnimation:function(t){return this._animations[t]?this._animations[t]:null},_addAnimationsWithDictionary:function(t,e){var i=t.animations;if(!i)return void n.log(n._LogInfos.animationCache._addAnimationsWithDictionary);var r=1,s=t.properties;if(s){r=null!=s.format?parseInt(s.format):r;for(var o=s.spritesheets,a=n.spriteFrameCache,c=n.path,h=0;h<o.length;h++)a.addSpriteFrames(c.changeBasename(e,o[h]))}switch(r){case 1:this._parseVersion1(i);break;case 2:this._parseVersion2(i);break;default:n.log(n._LogInfos.animationCache._addAnimationsWithDictionary_2)}},addAnimations:function(t){n.assert(t,n._LogInfos.animationCache.addAnimations_2);var e=n.loader.getRes(t);return e?void this._addAnimationsWithDictionary(e,t):void n.log(n._LogInfos.animationCache.addAnimations)},_parseVersion1:function(t){var e=n.spriteFrameCache;for(var i in t){var r=t[i],s=r.frames,o=parseFloat(r.delay)||0,a=null;if(s){for(var c=[],h=0;h<s.length;h++){var l=e.getSpriteFrame(s[h]);if(l){var d=new n.AnimationFrame;d.initWithSpriteFrame(l,1,null),c.push(d)}else n.log(n._LogInfos.animationCache._parseVersion1_2,i,s[h])}0!==c.length?(c.length!==s.length&&n.log(n._LogInfos.animationCache._parseVersion1_4,i),a=new n.Animation(c,o,1),n.animationCache.addAnimation(a,i)):n.log(n._LogInfos.animationCache._parseVersion1_3,i)}else n.log(n._LogInfos.animationCache._parseVersion1,i)}},_parseVersion2:function(t){var e=n.spriteFrameCache;for(var i in t){var r=t[i],s=r.loop,o=parseInt(r.loops),a=s?n.REPEAT_FOREVER:isNaN(o)?1:o,c=r.restoreOriginalFrame&&1==r.restoreOriginalFrame?!0:!1,h=r.frames;if(h){for(var l=[],d=0;d<h.length;d++){var u=h[d],_=u.spriteframe,f=e.getSpriteFrame(_);if(f){var p=parseFloat(u.delayUnits)||0,g=u.notification,m=new n.AnimationFrame;m.initWithSpriteFrame(f,p,g),l.push(m)}else n.log(n._LogInfos.animationCache._parseVersion2_2,i,_)}var y=parseFloat(r.delayPerUnit)||0,v=new n.Animation;v.initWithAnimationFrames(l,y,a),v.setRestoreOriginalFrame(c),n.animationCache.addAnimation(v,i)}else n.log(n._LogInfos.animationCache._parseVersion2,i)}},_clear:function(){this._animations={}}},t("../cocos2d/core/sprites/CCSpriteFrame"),n.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(t){var e=this._CCNS_REG2.exec(t);return e?n.rect(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])):n.rect(0,0,0,0)},_pointFromString:function(t){var e=this._CCNS_REG1.exec(t);return e?n.p(parseFloat(e[1]),parseFloat(e[2])):n.p(0,0)},_sizeFromString:function(t){var e=this._CCNS_REG1.exec(t);return e?n.size(parseFloat(e[1]),parseFloat(e[2])):n.size(0,0)},_getFrameConfig:function(t){var e=n.loader.getRes(t);return n.assert(e,n._LogInfos.spriteFrameCache._getFrameConfig_2,t),n.loader.release(t),e._inited?(this._frameConfigCache[t]=e,e):(this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t])},_getFrameConfigByJsonObject:function(t,e){return n.assert(e,n._LogInfos.spriteFrameCache._getFrameConfig_2,t),this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t]},_parseFrameConfig:function(t){var e=t.frames,i=t.metadata||t.meta,r={},s={},o=0;if(i){var a=i.format;o=a.length<=1?parseInt(a):a,s.image=i.textureFileName||i.textureFileName||i.image}for(var c in e){var h=e[c];if(h){var l={};if(0==o){l.rect=n.rect(h.x,h.y,h.width,h.height),l.rotated=!1,l.offset=n.p(h.offsetX,h.offsetY);var d=h.originalWidth,u=h.originalHeight;d&&u||n.log(n._LogInfos.spriteFrameCache._getFrameConfig),d=Math.abs(d),u=Math.abs(u),l.size=n.size(d,u)}else if(1==o||2==o)l.rect=this._rectFromString(h.frame),l.rotated=h.rotated||!1,l.offset=this._pointFromString(h.offset),l.size=this._sizeFromString(h.sourceSize);else if(3==o){var _=this._sizeFromString(h.spriteSize),f=this._rectFromString(h.textureRect);_&&(f=n.rect(f.x,f.y,_.width,_.height)),l.rect=f,l.rotated=h.textureRotated||!1,l.offset=this._pointFromString(h.spriteOffset),l.size=this._sizeFromString(h.spriteSourceSize),l.aliases=h.aliases}else{var p=h.frame,g=h.sourceSize;c=h.filename||c,l.rect=n.rect(p.x,p.y,p.w,p.h),l.rotated=h.rotated||!1,l.offset=n.p(0,0),l.size=n.size(g.w,g.h)}r[c]=l}}return{_inited:!0,frames:r,meta:s}},_addSpriteFramesByObject:function(t,e,i){if(n.assert(t,n._LogInfos.spriteFrameCache.addSpriteFrames_2),e&&e.frames){var r=this._frameConfigCache[t]||this._getFrameConfigByJsonObject(t,e);this._createSpriteFrames(t,r,i)}},_createSpriteFrames:function(t,e,i){var r=e.frames,s=e.meta;if(i)i instanceof n.Texture2D||(n.js.isString(i)?i=n.textureCache.addImage(i):n.assert(0,n._LogInfos.spriteFrameCache.addSpriteFrames_3));else{var o=n.path.changeBasename(t,s.image||".png");i=n.textureCache.addImage(o)}var a=this._spriteFramesAliases,c=this._spriteFrames;for(var h in r){var l=r[h],d=c[h];if(!d){d=new n.SpriteFrame(i,l.rect,l.rotated,l.offset,l.size);var u=l.aliases;if(u)for(var _=0,f=u.length;f>_;_++){var p=u[_];a[p]&&n.log(n._LogInfos.spriteFrameCache.addSpriteFrames,p),a[p]=h}if(n._renderType===n.game.RENDER_TYPE_CANVAS&&d.isRotated()){var g=d.getTexture();if(g.isLoaded()){var m=d.getTexture().getHtmlElementObj();m=n.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(m,d.getRectInPixels());var y=new n.Texture2D;y.initWithElement(m),y.handleLoadedTexture(),d.setTexture(y);var v=d._rect;d.setRect(n.rect(0,0,v.width,v.height))}}c[h]=d}}},addSpriteFrames:function(t,e){n.assert(t,n._LogInfos.spriteFrameCache.addSpriteFrames_2);var i=this._frameConfigCache[t]||n.loader.getRes(t);if(i&&i.frames){var r=this._frameConfigCache[t]||this._getFrameConfig(t);this._createSpriteFrames(t,r,e)}},_checkConflict:function(t){var e=t.frames;for(var i in e)this._spriteFrames[i]&&n.log(n._LogInfos.spriteFrameCache._checkConflict,i)},addSpriteFrame:function(t,e){this._spriteFrames[e]=t},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={}},removeSpriteFrameByName:function(t){t&&(this._spriteFramesAliases[t]&&delete this._spriteFramesAliases[t],this._spriteFrames[t]&&delete this._spriteFrames[t])},removeSpriteFramesFromFile:function(t){var e=this,i=e._spriteFrames,n=e._spriteFramesAliases,r=e._frameConfigCache[t];if(r){var s=r.frames;for(var o in s)if(i[o]){delete i[o];for(var a in n)n[a]===o&&delete n[a]}}},removeSpriteFramesFromTexture:function(t){var e=this,i=e._spriteFrames,n=e._spriteFramesAliases;for(var r in i){var s=i[r];if(s&&s.getTexture()===t){delete i[r];for(var o in n)n[o]===r&&delete n[o]}}},getSpriteFrame:function(t){var e=this,i=e._spriteFrames[t];if(!i){var n=e._spriteFramesAliases[t];n&&(i=e._spriteFrames[n.toString()],i||delete e._spriteFramesAliases[t])}return i},_clear:function(){this._spriteFrames={},this._spriteFramesAliases={},this._frameConfigCache={}}},n.SpriteBatchNode=_ccsg.Node.extend({_blendFunc:null,_descendants:null,_className:"SpriteBatchNode",ctor:function(t,e){_ccsg.Node.prototype.ctor.call(this),this._descendants=[],this._blendFunc=new n.BlendFunc(n.BLEND_SRC,n.BLEND_DST);var i;e=e||n.SpriteBatchNode.DEFAULT_CAPACITY,n.js.isString(t)?(i=n.textureCache.getTextureForKey(t),i||(i=n.textureCache.addImage(t))):t instanceof n.Texture2D&&(i=t),i&&this.initWithTexture(i,e)},addSpriteWithoutQuad:function(t,e,i){if(n.assert(t,n._LogInfos.SpriteBatchNode.addSpriteWithoutQuad_2),!(t instanceof n.Sprite))return n.log(n._LogInfos.SpriteBatchNode.addSpriteWithoutQuad),null;t.atlasIndex=e;var r,s=0,o=this._descendants;if(o&&o.length>0)for(s=0,r=o.length;r>s;s++){var a=o[s];if(a&&a.atlasIndex>=e)break}return o.splice(s,0,t),_ccsg.Node.prototype.addChild.call(this,t,e,i),this.reorderBatch(!1),this},getTextureAtlas:function(){return this._renderCmd.getTextureAtlas()},setTextureAtlas:function(t){this._renderCmd.getTextureAtlas(t)},getDescendants:function(){return this._descendants},initWithFile:function(t,e){var i=n.textureCache.getTextureForKey(t);return i||(i=n.textureCache.addImage(t)),this.initWithTexture(i,e)},_setNodeDirtyForCache:function(){this._renderCmd&&this._renderCmd._setNodeDirtyForCache&&this._renderCmd._setNodeDirtyForCache()},init:function(t,e){var i=n.textureCache.getTextureForKey(t);return i||(i=n.textureCache.addImage(t)),this.initWithTexture(i,e)},increaseAtlasCapacity:function(){this._renderCmd.increaseAtlasCapacity()},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},rebuildIndexInOrder:function(t,e){var i=t.children;if(i&&i.length>0)for(var n=0;n<i.length;n++){var r=i[n];r&&r.zIndex<0&&(e=this.rebuildIndexInOrder(r,e))}if(!t===this&&(t.atlasIndex=e,e++),i&&i.length>0)for(n=0;n<i.length;n++)r=i[n],r&&r.zIndex>=0&&(e=this.rebuildIndexInOrder(r,e));return e},highestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.highestAtlasIndexInChild(e[e.length-1]):t.atlasIndex},lowestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.lowestAtlasIndexInChild(e[e.length-1]):t.atlasIndex},atlasIndexForChild:function(t,e){var i=t.parent,r=i.children,s=r.indexOf(t),o=i===this,a=null;return s>0&&s<n.UINT_MAX&&(a=r[s-1]),o?0===s?0:this.highestAtlasIndexInChild(a)+1:0===s?0>e?i.atlasIndex:i.atlasIndex+1:a.zIndex<0&&0>e||a.zIndex>=0&&e>=0?this.highestAtlasIndexInChild(a)+1:i.atlasIndex+1},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,e){this._blendFunc=void 0===e?t:{src:t,dst:e}},getBlendFunc:function(){return new n.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},reorderChild:function(t,e){return n.assert(t,n._LogInfos.SpriteBatchNode.reorderChild_2),-1===this._children.indexOf(t)?void n.log(n._LogInfos.SpriteBatchNode.reorderChild):void(e!==t.zIndex&&_ccsg.Node.prototype.reorderChild.call(this,t,e))},removeChild:function(t,e){if(null!=t){if(-1===this._children.indexOf(t))return void n.log(n._LogInfos.SpriteBatchNode.removeChild);this.removeSpriteFromAtlas(t),_ccsg.Node.prototype.removeChild.call(this,t,e)}},updateQuadFromSprite:function(t,e){return n.assert(t,n._LogInfos.SpriteBatchNode.updateQuadFromSprite_2),t instanceof n.Sprite?(this._renderCmd.checkAtlasCapacity(),t.batchNode=this,t.atlasIndex=e,t.dirty=!0,void t.updateTransform()):void n.log(n._LogInfos.SpriteBatchNode.updateQuadFromSprite)},insertQuadFromSprite:function(t,e){return n.assert(t,n._LogInfos.SpriteBatchNode.insertQuadFromSprite_2),t instanceof n.Sprite?(this._renderCmd.insertQuad(t,e),t.batchNode=this,t.atlasIndex=e,t.dirty=!0,t.updateTransform(),void this._renderCmd.cutting(t,e)):void n.log(n._LogInfos.SpriteBatchNode.insertQuadFromSprite)},initWithTexture:function(t,e){return this._children.length=0,this._descendants.length=0,e=e||n.SpriteBatchNode.DEFAULT_CAPACITY,this._renderCmd.initWithTexture(t,e),!0},insertChild:function(t,e){t.batchNode=this,t.atlasIndex=e,t.dirty=!0,this._renderCmd.insertQuad(t,e),this._descendants.splice(e,0,t);var i=e+1,n=this._descendants;if(n&&n.length>0)for(;i<n.length;i++)n[i].atlasIndex++;var r,s,o=t.children;if(o)for(i=0,s=o.length||0;s>i;i++)if(r=o[i]){var a=this.atlasIndexForChild(r,r.zIndex);this.insertChild(r,a)}},appendChild:function(t){this._reorderChildDirty=!0,t.batchNode=this,t.dirty=!0,this._descendants.push(t);var e=this._descendants.length-1;t.atlasIndex=e,this._renderCmd.insertQuad(t,e);for(var i=t.children,n=0,r=i.length||0;r>n;n++)this.appendChild(i[n])},removeSpriteFromAtlas:function(t){this._renderCmd.removeQuadAtIndex(t.atlasIndex),t.batchNode=null;var e=this._descendants,i=e.indexOf(t);if(-1!==i){e.splice(i,1);for(var n=e.length;n>i;++i){var r=e[i];r.atlasIndex--}}var s=t.children;if(s)for(var o=0,a=s.length||0;a>o;o++)s[o]&&this.removeSpriteFromAtlas(s[o])},getTexture:function(){return this._renderCmd.getTexture()},setTexture:function(t){this._renderCmd.setTexture(t)},addChild:function(t,e,i){n.assert(null!=t,n._LogInfos.SpriteBatchNode.addChild_3),this._renderCmd.isValidChild(t)&&(e=null==e?t.zIndex:e,i=null==i?t.tag:i,_ccsg.Node.prototype.addChild.call(this,t,e,i),this.appendChild(t))},removeAllChildren:function(t){var e=this._descendants;if(e&&e.length>0)for(var i=0,n=e.length;n>i;i++)e[i]&&(e[i].batchNode=null);_ccsg.Node.prototype.removeAllChildren.call(this,t),this._descendants.length=0,this._renderCmd.removeAllQuads()},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i=this._children,n=0,r=i.length;for(t=1;r>t;t++){var s=i[t];for(n=t-1,e=i[n];n>=0&&(s._localZOrder<e._localZOrder||s._localZOrder===e._localZOrder&&s.arrivalOrder<e.arrivalOrder);)i[n+1]=e,n-=1,e=i[n];i[n+1]=s}i.length>0&&(this._arrayMakeObjectsPerformSelector(i,_ccsg.Node._stateCallbackType.sortAllChildren),this._renderCmd.updateChildrenAtlasIndex(i)),this._reorderChildDirty=!1}},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.SpriteBatchNode.CanvasRenderCmd(this):new n.SpriteBatchNode.WebGLRenderCmd(this)}});var c=n.SpriteBatchNode.prototype;n.defineGetterSetter(c,"texture",c.getTexture,c.setTexture),n.defineGetterSetter(c,"textureAtlas",c.getTextureAtlas,c.setTextureAtlas),c.descendants,n.defineGetterSetter(c,"descendants",c.getDescendants),n.SpriteBatchNode.DEFAULT_CAPACITY=29,n.SpriteBatchNode.create=function(t,e){return new n.SpriteBatchNode(t,e)},n.SpriteBatchNode.createWithTexture=n.SpriteBatchNode.create,function(){n.SpriteBatchNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._texture=null,this._textureToRender=null};var t=n.SpriteBatchNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.SpriteBatchNode.CanvasRenderCmd,t.checkAtlasCapacity=function(){},t.isValidChild=function(t){return t instanceof n.Sprite?!0:(n.log(n._LogInfos.Sprite.addChild_4),!1)},t.initWithTexture=function(t,e){this._textureToRender=this._texture=t},t.insertQuad=function(t,e){},t.increaseAtlasCapacity=function(){},t.removeQuadAtIndex=function(){},t.removeAllQuads=function(){},t.getTexture=function(){return this._texture},t.setTexture=function(t){this._texture=t;for(var e=this._node._children,i=0;i<e.length;i++)e[i].setTexture(t)},t.updateChildrenAtlasIndex=function(t){this._node._descendants.length=0;for(var e=0,i=t.length;i>e;e++)this._updateAtlasIndex(t[e])},t._updateAtlasIndex=function(t){var e,i=this._node._descendants,n=t.children,r=n.length;for(e=0;r>e&&n[e]._localZOrder<0;e++)i.push(n[e]);for(i.push(t);r>e;e++)i.push(n[e])},t.getTextureAtlas=function(){},t.setTextureAtlas=function(t){},t.cutting=function(t,e){var i=this._node;i._children.splice(e,0,t)}}(),function(){n.SpriteBatchNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._textureAtlas=null};var t=n.SpriteBatchNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.SpriteBatchNode.WebGLRenderCmd,t.isValidChild=function(t){return t instanceof n.Sprite?t.texture!=this.getTexture()?(n.log(n._LogInfos.Sprite.addChild_5),!1):!0:(n.log(n._LogInfos.Sprite.addChild_4),!1)},t.rendering=function(){var t=this._node;0!==this._textureAtlas.totalQuads&&(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),t._arrayMakeObjectsPerformSelector(t._children,_ccsg.Node._stateCallbackType.updateTransform),n.glBlendFunc(t._blendFunc.src,t._blendFunc.dst),this._textureAtlas.drawQuads())},t.visit=function(t){var e=this._node;if(e._visible){e._parent&&e._parent._renderCmd&&(this._curLevel=e._parent._renderCmd._curLevel+1);var i=n.current_stack;i.stack.push(i.top),this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty||this.transform(t),this.updateStatus(t),i.top=this._stackMatrix,e.sortAllChildren(),n.renderer.pushRenderCommand(this),this._dirtyFlag=0,i.top=i.stack.pop()}},t.checkAtlasCapacity=function(t){for(var e=this._textureAtlas;t>=e.capacity||e.capacity===e.totalQuads;)this.increaseAtlasCapacity()},t.increaseAtlasCapacity=function(){var t=this._textureAtlas.capacity,e=Math.floor(4*(t+1)/3);n.log(n._LogInfos.SpriteBatchNode.increaseAtlasCapacity,t,e),this._textureAtlas.resizeCapacity(e)||n.log(n._LogInfos.SpriteBatchNode.increaseAtlasCapacity_2)},t.initWithTexture=function(t,e){this._textureAtlas=new n.TextureAtlas,this._textureAtlas.initWithTexture(t,e),this._updateBlendFunc(),this._shaderProgram=n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURECOLOR)},t.insertQuad=function(t,e){var i=this._textureAtlas;i.totalQuads>=i.capacity&&this.increaseAtlasCapacity(),i.insertQuad(t.quad,e)},t.removeQuadAtIndex=function(t){this._textureAtlas.removeQuadAtIndex(t)},t.getTexture=function(){return this._textureAtlas.texture},t.setTexture=function(t){this._textureAtlas.setTexture(t),t&&this._updateBlendFunc()},t.removeAllQuads=function(){this._textureAtlas.removeAllQuads()},t._swap=function(t,e){var i=this._node._descendants,r=this._textureAtlas,s=r.quads,o=i[t],a=n.V3F_C4B_T2F_QuadCopy(s[t]);i[e].atlasIndex=t,i[t]=i[e],r.updateQuad(s[e],t),i[e]=o,r.updateQuad(a,e)},t._updateAtlasIndex=function(t,e){var i=0,n=t.children;n&&(i=n.length);var r=0;if(0===i)r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e&&this._swap(r,e),e++;else{var s=!0;n[0].zIndex>=0&&(r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e&&this._swap(r,e),e++,s=!1);for(var o=0;o<n.length;o++){var a=n[o];s&&a.zIndex>=0&&(r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e&&this._swap(r,e),e++,s=!1),e=this._updateAtlasIndex(a,e)}s&&(r=t.atlasIndex,t.atlasIndex=e,t.arrivalOrder=0,r!==e&&this._swap(r,e),e++)}return e},t.updateChildrenAtlasIndex=function(t){for(var e=0,i=0;i<t.length;i++)e=this._updateAtlasIndex(t[i],e)},t._updateBlendFunc=function(){if(!this._textureAtlas.texture.hasPremultipliedAlpha()){var t=this._node._blendFunc;t.src=n.SRC_ALPHA,t.dst=n.ONE_MINUS_SRC_ALPHA}},t.getTextureAtlas=function(){return this._textureAtlas},t.setTextureAtlas=function(t){t!==this._textureAtlas&&(this._textureAtlas=t)},t.cutting=function(){}}(),n.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=n.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=n.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return this._GlExtensions.indexOf(t)>-1},getValue:function(t,e){this._inited||this._init();var i=this._valueDict;return i[t]?i[t]:e},setValue:function(t,e){this._valueDict[t]=e},dumpInfo:function(){0===n.ENABLE_GL_STATE_CACHE&&(n.log(""),n.log(n._LogInfos.configuration.dumpInfo),n.log(""))},gatherGPUInfo:function(){if(n._renderType!==n.game.RENDER_TYPE_CANVAS){this._inited||this._init();var t=n._renderContext,e=this._valueDict;e["gl.vendor"]=t.getParameter(t.VENDOR),e["gl.renderer"]=t.getParameter(t.RENDERER),e["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var i=t.getSupportedExtensions(),r=0;r<i.length;r++)this._GlExtensions+=i[r]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),e["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,e["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),e["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),e["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),e["gl.supports_vertex_array_object"]=this._supportsShareableVAO,n.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var e=n.loader.getRes(t);if(!e)throw new Error("Please load the resource first : "+t);n.assert(e,n._LogInfos.configuration.loadConfigFile_2,t);var i=e.data;if(!i)return void n.log(n._LogInfos.configuration.loadConfigFile,t);for(var r in i)this._valueDict[r]=i[r]}},n.Camera=n._Class.extend({_eyeX:null,_eyeY:null,_eyeZ:null,_centerX:null,_centerY:null,_centerZ:null,_upX:null,_upY:null,_upZ:null,_dirty:!1,_lookupMatrix:null,ctor:function(){this._lookupMatrix=new n.math.Matrix4,this.restore()},description:function(){return"<CCCamera | center =("+this._centerX+","+this._centerY+","+this._centerZ+")>"},setDirty:function(t){this._dirty=t},isDirty:function(){return this._dirty},restore:function(){this._eyeX=this._eyeY=0,this._eyeZ=n.Camera.getZEye(),this._centerX=this._centerY=this._centerZ=0,this._upX=0,this._upY=1,this._upZ=0,this._lookupMatrix.identity(),this._dirty=!1},locate:function(){if(this._dirty){var t=new n.math.Vec3(this._eyeX,this._eyeY,this._eyeZ),e=new n.math.Vec3(this._centerX,this._centerY,this._centerZ),i=new n.math.Vec3(this._upX,this._upY,this._upZ);this._lookupMatrix.lookAt(t,e,i),this._dirty=!1}n.kmGLMultMatrix(this._lookupMatrix)},_locateForRenderer:function(t){if(this._dirty){var e=new n.math.Vec3(this._eyeX,this._eyeY,this._eyeZ),i=new n.math.Vec3(this._centerX,this._centerY,this._centerZ),r=new n.math.Vec3(this._upX,this._upY,this._upZ);this._lookupMatrix.lookAt(e,i,r),this._dirty=!1}t.multiply(this._lookupMatrix)},setEyeXYZ:function(t,e,i){this.setEye(t,e,i)},setEye:function(t,e,i){this._eyeX=t,this._eyeY=e,this._eyeZ=i,this._dirty=!0},setCenterXYZ:function(t,e,i){this.setCenter(t,e,i)},setCenter:function(t,e,i){this._centerX=t,this._centerY=e,this._centerZ=i,this._dirty=!0},setUpXYZ:function(t,e,i){this.setUp(t,e,i)},setUp:function(t,e,i){this._upX=t,this._upY=e,this._upZ=i,this._dirty=!0},getEyeXYZ:function(t,e,i){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getEye:function(){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getCenterXYZ:function(t,e,i){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getCenter:function(){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getUpXYZ:function(t,e,i){return{x:this._upX,y:this._upY,z:this._upZ}},getUp:function(){return{x:this._upX,y:this._upY,z:this._upZ}},_DISALLOW_COPY_AND_ASSIGN:function(t){}}),n.Camera.getZEye=function(){return n.FLT_EPSILON},n.PRIORITY_NON_SYSTEM=n.PRIORITY_SYSTEM+1,n.ListEntry=function(t,e,i,n,r,s,o){this.prev=t,this.next=e,this.callback=i,this.target=n,this.priority=r,this.paused=s,this.markedForDeletion=o},n.ListEntry.prototype.trigger=function(t){this.callback.call(this.target,t)},n.HashUpdateEntry=function(t,e,i,n,r){this.list=t,this.entry=e,this.target=i,this.callback=n,this.hh=r},n.HashTimerEntry=n.hashSelectorEntry=function(t,e,i,n,r,s,o){var a=this;a.timers=t,a.target=e,a.timerIndex=i,a.currentTimer=n,a.currentTimerSalvaged=r,a.paused=s,a.hh=o},n.Timer=n._Class.extend({_scheduler:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,_interval:0,getInterval:function(){return this._interval},setInterval:function(t){this._interval=t},setupTimerWithInterval:function(t,e,i){this._elapsed=-1,this._interval=t,this._delay=i,this._useDelay=this._delay>0,this._repeat=e,this._runForever=this._repeat===n.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0},update:function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}}),n.TimerTargetSelector=n.Timer.extend({_target:null,_selector:null,ctor:function(){this._target=null,this._selector=null},initWithSelector:function(t,e,i,n,r,s){return this._scheduler=t,this._target=i,this._selector=e,this.setupTimerWithInterval(n,r,s),!0},getSelector:function(){return this._selector},trigger:function(){this._target&&this._selector&&this._target.call(this._selector,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}}),n.TimerTargetCallback=n.Timer.extend({_target:null,_callback:null,_key:null,ctor:function(){this._target=null,this._callback=null},initWithCallback:function(t,e,i,n,r,s,o){return this._scheduler=t,this._target=i,this._callback=e,this._key=n,this.setupTimerWithInterval(r,s,o),!0},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){this._callback&&this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,this._target)}});var f=function(t){return t.uuid||t.__instanceId};n.Scheduler=n._Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_schedulePerFrame:function(t,e,i,r){var s=this._hashForUpdates[f(e)];if(s&&s.entry){if(s.entry.priority===i)return s.entry.markedForDeletion=!1,void(s.entry.paused=r);if(this._updateHashLocked)return n.log("warning: you CANNOT change update priority in scheduled function"),s.entry.markedForDeletion=!1,void(s.entry.paused=r);this.unscheduleUpdate(e)}0===i?this._appendIn(this._updates0List,t,e,r):0>i?this._priorityIn(this._updatesNegList,t,e,i,r):this._priorityIn(this._updatesPosList,t,e,i,r)},_removeHashElement:function(t){delete this._hashForTimers[f(t.target)],n.js.array.remove(this._arrayForTimers,t),t.Timer=null,t.target=null,t=null},_removeUpdateFromHash:function(t){var e=this,i=e._hashForUpdates[f(t.target)];i&&(n.js.array.remove(i.list,i.entry),delete e._hashForUpdates[f(i.target)],i.entry=null,i.target=null)},_priorityIn:function(t,e,i,r,s){var o=this,a=new n.ListEntry(null,null,e,i,r,s,!1);if(t){for(var c=t.length-1,h=0;c>=h;h++)if(r<t[h].priority){c=h;break}t.splice(h,0,a)}else t=[],t.push(a);return o._hashForUpdates[f(i)]=new n.HashUpdateEntry(t,a,i,null),t},_appendIn:function(t,e,i,r){var s=this,o=new n.ListEntry(null,null,e,i,0,r,!1);t.push(o),s._hashForUpdates[f(i)]=new n.HashUpdateEntry(t,o,i,null,null)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale);var e,i,n,r;for(e=0,i=this._updatesNegList,n=i.length;n>e;e++)r=i[e],r.paused||r.markedForDeletion||r.trigger(t);for(e=0,i=this._updates0List,n=i.length;n>e;e++)r=i[e],r.paused||r.markedForDeletion||r.trigger(t);for(e=0,i=this._updatesPosList,n=i.length;n>e;e++)r=i[e],r.paused||r.markedForDeletion||r.trigger(t);var s,o=this._arrayForTimers;for(e=0;e<o.length;e++){if(s=o[e],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],
s.currentTimerSalvaged=!1,s.currentTimer.update(t),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&this._removeHashElement(this._currentTarget)}for(e=0,i=this._updatesNegList;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updates0List;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updatesPosList;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,n,r,s){this.schedule(e,t,i,n,r,s,f(t)+"")},schedule:function(t,e,i,r,s,o,a){var c=!1;if("function"!=typeof t){var h=t;c=!0}c===!1?(4===arguments.length||5===arguments.length)&&(a=s,o=r,s=0,r=n.REPEAT_FOREVER):4===arguments.length&&(o=r,r=n.REPEAT_FOREVER,s=0),void 0===a&&(a=e.__instanceId+""),n.assert(e,n._LogInfos.Scheduler_scheduleCallbackForTarget_3);var l=f(e),d=this._hashForTimers[l];d?n.assert(d.paused===o,""):(d=new n.HashTimerEntry(null,e,0,null,null,o,null),this._arrayForTimers.push(d),this._hashForTimers[l]=d);var u,_;if(null==d.timers)d.timers=[];else if(c===!1){for(_=0;_<d.timers.length;_++)if(u=d.timers[_],t===u._callback)return n.log(n._LogInfos.Scheduler.scheduleCallbackForTarget,u.getInterval().toFixed(4),i.toFixed(4)),void(u._interval=i)}else for(_=0;_<d.timers.length;++_)if(u=d.timers[_],u&&h===u.getSelector())return n.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",u.getInterval(),i),void u.setInterval(i);c===!1?(u=new n.TimerTargetCallback,u.initWithCallback(this,t,e,a,i,r,s),d.timers.push(u)):(u=new n.TimerTargetSelector,u.initWithSelector(this,h,e,i,r,s),d.timers.push(u))},scheduleUpdate:function(t,e,i,n){n=n||t.update,this._schedulePerFrame(n,t,e,i)},_getUnscheduleMark:function(t,e){switch(typeof t){case"number":case"string":return t===e.getKey();case"function":return t===e._callback;default:return t===e.getSelector()}},unschedule:function(t,e){if(e&&t){var i=this,n=i._hashForTimers[f(e)];if(n)for(var r=n.timers,s=0,o=r.length;o>s;s++){var a=r[s];if(this._getUnscheduleMark(t,a))return a!==n.currentTimer||n.currentTimerSalvaged||(n.currentTimerSalvaged=!0),r.splice(s,1),n.timerIndex>=s&&n.timerIndex--,void(0===r.length&&(i._currentTarget===n?i._currentTargetSalvaged=!0:i._removeHashElement(n)))}}},unscheduleUpdate:function(t){if(null!=t){var e=this._hashForUpdates[f(t)];e&&(this._updateHashLocked?e.entry.markedForDeletion=!0:this._removeUpdateFromHash(e.entry))}},unscheduleAllForTarget:function(t){if(null!=t){var e=this._hashForTimers[f(t)];e&&(e.timers.indexOf(e.currentTimer)>-1&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0),e.timers.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e)),this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(n.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--)i=n[e],this.unscheduleAllForTarget(i.target);var r,s=0;if(0>t)for(e=0;e<this._updatesNegList.length;)s=this._updatesNegList.length,r=this._updatesNegList[e],r&&r.priority>=t&&this.unscheduleUpdate(r.target),s==this._updatesNegList.length&&e++;if(0>=t)for(e=0;e<this._updates0List.length;)s=this._updates0List.length,r=this._updates0List[e],r&&this.unscheduleUpdate(r.target),s==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)s=this._updatesPosList.length,r=this._updatesPosList[e],r&&r.priority>=t&&this.unscheduleUpdate(r.target),s==this._updatesPosList.length&&e++},isScheduled:function(t,e){n.assert(t,"Argument key must not be empty"),n.assert(e,"Argument target must be non-nullptr");var i=this._hashForUpdates[f(e)];if(!i)return!1;if(null==i.timers)return!1;for(var r=i.timers,s=0;s<r.length;++s){var o=r[s];if(t===o.getKey())return!0}return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(n.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,i,n,r=[],s=this,o=s._arrayForTimers;for(i=0,n=o.length;n>i;i++)e=o[i],e&&(e.paused=!0,r.push(e.target));var a;if(0>t)for(i=0;i<this._updatesNegList.length;i++)a=this._updatesNegList[i],a&&a.priority>=t&&(a.paused=!0,r.push(a.target));if(0>=t)for(i=0;i<this._updates0List.length;i++)a=this._updates0List[i],a&&(a.paused=!0,r.push(a.target));for(i=0;i<this._updatesPosList.length;i++)a=this._updatesPosList[i],a&&a.priority>=t&&(a.paused=!0,r.push(a.target));return r},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){n.assert(t,n._LogInfos.Scheduler.pauseTarget);var e=this,i=f(t),r=e._hashForTimers[i];r&&(r.paused=!0);var s=e._hashForUpdates[i];s&&(s.entry.paused=!0)},resumeTarget:function(t){n.assert(t,n._LogInfos.Scheduler.resumeTarget);var e=this,i=f(t),r=e._hashForTimers[i];r&&(r.paused=!1);var s=e._hashForUpdates[i];s&&(s.entry.paused=!1)},isTargetPaused:function(t){n.assert(t,n._LogInfos.Scheduler.isTargetPaused);var e=f(t),i=this._hashForTimers[e];if(i)return i.paused;var r=this._hashForUpdates[e];return r?r.entry.paused:!1},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unschedule(f(t)+"",t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(n.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),n.Scheduler.PRIORITY_SYSTEM=-2147483648,n.PI2=2*Math.PI,n.DrawingPrimitiveCanvas=n._Class.extend({_cacheArray:[],_renderContext:null,ctor:function(t){this._renderContext=t},drawPoint:function(t,e){e||(e=1);var i=n.view.getScaleX(),r=n.view.getScaleY(),s=n.p(t.x*i,t.y*r),o=this._renderContext.getContext();o.beginPath(),o.arc(s.x,-s.y,e*i,0,2*Math.PI,!1),o.closePath(),o.fill()},drawPoints:function(t,e,i){if(null!=t){i||(i=1);var r=this._renderContext.getContext(),s=n.view.getScaleX(),o=n.view.getScaleY();r.beginPath();for(var a=0,c=t.length;c>a;a++)r.arc(t[a].x*s,-t[a].y*o,i*s,0,2*Math.PI,!1);r.closePath(),r.fill()}},drawLine:function(t,e){var i=this._renderContext.getContext(),r=n.view.getScaleX(),s=n.view.getScaleY();i.beginPath(),i.moveTo(t.x*r,-t.y*s),i.lineTo(e.x*r,-e.y*s),i.closePath(),i.stroke()},drawRect:function(t,e){this.drawLine(n.p(t.x,t.y),n.p(e.x,t.y)),this.drawLine(n.p(e.x,t.y),n.p(e.x,e.y)),this.drawLine(n.p(e.x,e.y),n.p(t.x,e.y)),this.drawLine(n.p(t.x,e.y),n.p(t.x,t.y))},drawSolidRect:function(t,e,i){var r=[t,n.p(e.x,t.y),e,n.p(t.x,e.y)];this.drawSolidPoly(r,4,i)},drawPoly:function(t,e,i,r){if(r=r||!1,null!=t){if(t.length<3)throw new Error("Polygon's point must greater than 2");var s=t[0],o=this._renderContext.getContext(),a=n.view.getScaleX(),c=n.view.getScaleY();o.beginPath(),o.moveTo(s.x*a,-s.y*c);for(var h=1,l=t.length;l>h;h++)o.lineTo(t[h].x*a,-t[h].y*c);i&&o.closePath(),r?o.fill():o.stroke()}},drawSolidPoly:function(t,e,i){this.setDrawColor(i.r,i.g,i.b,i.a),this.drawPoly(t,e,!0,!0)},drawCircle:function(t,e,i,r,s){s=s||!1;var o=this._renderContext.getContext(),a=n.view.getScaleX(),c=n.view.getScaleY();o.beginPath();var h=i-2*Math.PI;o.arc(0|t.x*a,0|-(t.y*c),e*a,-i,-h,!1),s&&o.lineTo(0|t.x*a,0|-(t.y*c)),o.stroke()},drawQuadBezier:function(t,e,i,r){var s=this._cacheArray;s.length=0;for(var o=0,a=0;r>a;a++){var c=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,h=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y;s.push(n.p(c,h)),o+=1/r}s.push(n.p(i.x,i.y)),this.drawPoly(s,r+1,!1,!1)},drawCubicBezier:function(t,e,i,r,s){var o=this._cacheArray;o.length=0;for(var a=0,c=0;s>c;c++){var h=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*r.x,l=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*r.y;o.push(n.p(h,l)),a+=1/s}o.push(n.p(r.x,r.y)),this.drawPoly(o,s+1,!1,!1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){n._renderContext.setStrokeStyle("rgba(255,255,255,1)");var r=this._cacheArray;r.length=0;for(var s,o,a=1/t.length,c=0;i+1>c;c++){var h=c/i;1===h?(s=t.length-1,o=1):(s=0|h/a,o=(h-a*s)/a);var l=n.CardinalSplineAt(n.getControlPointAt(t,s-1),n.getControlPointAt(t,s-0),n.getControlPointAt(t,s+1),n.getControlPointAt(t,s+2),e,o);r.push(l)}this.drawPoly(r,i+1,!1,!1)},drawImage:function(t,e,i,n,r){var s=arguments.length,o=this._renderContext.getContext();switch(s){case 2:var a=t.height;o.drawImage(t,e.x,-(e.y+a));break;case 3:o.drawImage(t,e.x,-(e.y+i.height),i.width,i.height);break;case 5:o.drawImage(t,e.x,e.y,i.width,i.height,n.x,-(n.y+r.height),r.width,r.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(t,e,i){var r=t||this._renderContext,s=r.getContext();e*=n.view.getScaleX();var o="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b);r.setFillStyle(o+",1)");var a=e/10;s.beginPath(),s.moveTo(-e,e),s.lineTo(0,a),s.lineTo(e,e),s.lineTo(a,0),s.lineTo(e,-e),s.lineTo(0,-a),s.lineTo(-e,-e),s.lineTo(-a,0),s.lineTo(-e,e),s.closePath(),s.fill();var c=s.createRadialGradient(0,0,a,0,0,e);c.addColorStop(0,o+", 1)"),c.addColorStop(.3,o+", 0.8)"),c.addColorStop(1,o+", 0.0)"),r.setFillStyle(c),s.beginPath();var h=0,l=n.PI2;s.arc(0,0,e-a,h,l,!1),s.closePath(),s.fill()},drawColorBall:function(t,e,i){var r=t||this._renderContext,s=r.getContext();e*=n.view.getScaleX();var o="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b),a=e/10,c=s.createRadialGradient(0,0,a,0,0,e);c.addColorStop(0,o+", 1)"),c.addColorStop(.3,o+", 0.8)"),c.addColorStop(.6,o+", 0.4)"),c.addColorStop(1,o+", 0.0)"),r.setFillStyle(c),s.beginPath();var h=0,l=n.PI2;s.arc(0,0,e,h,l,!1),s.closePath(),s.fill()},fillText:function(t,e,i){this._renderContext.getContext().fillText(t,e,-i)},setDrawColor:function(t,e,i,n){this._renderContext.setFillStyle("rgba("+t+","+e+","+i+","+n/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+e+","+i+","+n/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*n.view.getScaleX()}}),n.DrawingPrimitiveWebGL=n._Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:-1,_colorArray:null,_pointSizeLocation:-1,_pointSize:-1,ctor:function(t){if(null==t&&(t=n._renderContext),!t instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var t=this;t._initialized||(t._shader=n.shaderCache.programForKey(n.SHADER_POSITION_UCOLOR),t._colorLocation=t._renderContext.getUniformLocation(t._shader.getProgram(),"u_color"),t._pointSizeLocation=t._renderContext.getUniformLocation(t._shader.getProgram(),"u_pointSize"),t._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var e=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION),e.uniform4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([t.x,t.y]),e.STATIC_DRAW),e.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1),e.deleteBuffer(i),n.incrementGLDraws(1)},drawPoints:function(t,e){if(t&&0!==t.length){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION),i.uniform4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var r=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray(t),i.STATIC_DRAW),i.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.POINTS,0,t.length),i.deleteBuffer(r),n.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var e=new Float32Array(2*t.length),i=0;i<t.length;i++)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},drawLine:function(t,e){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION),i.uniform4fv(this._colorLocation,this._colorArray);var r=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray([t,e]),i.STATIC_DRAW),i.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,2),i.deleteBuffer(r),n.incrementGLDraws(1)},drawRect:function(t,e){this.drawLine(n.p(t.x,t.y),n.p(e.x,t.y)),this.drawLine(n.p(e.x,t.y),n.p(e.x,e.y)),this.drawLine(n.p(e.x,e.y),n.p(t.x,e.y)),this.drawLine(n.p(t.x,e.y),n.p(t.x,t.y))},drawSolidRect:function(t,e,i){var r=[t,n.p(e.x,t.y),e,n.p(t.x,e.y)];this.drawSolidPoly(r,4,i)},drawPoly:function(t,e,i){this.lazy_init();var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION),r.uniform4fv(this._colorLocation,this._colorArray);var s=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(t),r.STATIC_DRAW),r.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),i?r.drawArrays(r.LINE_LOOP,0,t.length):r.drawArrays(r.LINE_STRIP,0,t.length),r.deleteBuffer(s),n.incrementGLDraws(1)},drawSolidPoly:function(t,e,i){this.lazy_init(),i&&this.setDrawColor(i.r,i.g,i.b,i.a);var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION),r.uniform4fv(this._colorLocation,this._colorArray);var s=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(t),r.STATIC_DRAW),r.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLE_FAN,0,t.length),r.deleteBuffer(s),n.incrementGLDraws(1)},drawCircle:function(t,e,i,r,s){this.lazy_init();var o=1;s&&o++;var a=2*Math.PI/r,c=new Float32Array(2*(r+2));if(c){for(var h=0;r>=h;h++){var l=h*a,d=e*Math.cos(l+i)+t.x,u=e*Math.sin(l+i)+t.y;c[2*h]=d,c[2*h+1]=u}c[2*(r+1)]=t.x,c[2*(r+1)+1]=t.y;var _=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION),_.uniform4fv(this._colorLocation,this._colorArray);var f=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,f),_.bufferData(_.ARRAY_BUFFER,c,_.STATIC_DRAW),_.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,_.FLOAT,!1,0,0),_.drawArrays(_.LINE_STRIP,0,r+o),_.deleteBuffer(f),n.incrementGLDraws(1)}},drawQuadBezier:function(t,e,i,r){this.lazy_init();for(var s=new Float32Array(2*(r+1)),o=0,a=0;r>a;a++)s[2*a]=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,s[2*a+1]=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y,o+=1/r;s[2*r]=i.x,s[2*r+1]=i.y;var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION),c.uniform4fv(this._colorLocation,this._colorArray);var h=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,h),c.bufferData(c.ARRAY_BUFFER,s,c.STATIC_DRAW),c.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.LINE_STRIP,0,r+1),c.deleteBuffer(h),n.incrementGLDraws(1)},drawCubicBezier:function(t,e,i,r,s){this.lazy_init();for(var o=new Float32Array(2*(s+1)),a=0,c=0;s>c;c++)o[2*c]=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*r.x,o[2*c+1]=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*r.y,a+=1/s;o[2*s]=r.x,o[2*s+1]=r.y;var h=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION),h.uniform4fv(this._colorLocation,this._colorArray);var l=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,l),h.bufferData(h.ARRAY_BUFFER,o,h.STATIC_DRAW),h.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0),h.drawArrays(h.LINE_STRIP,0,s+1),h.deleteBuffer(l),n.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){this.lazy_init();for(var r,s,o=new Float32Array(2*(i+1)),a=1/t.length,c=0;i+1>c;c++){var h=c/i;1===h?(r=t.length-1,s=1):(r=0|h/a,s=(h-a*r)/a);var l=n.cardinalSplineAt(n.getControlPointAt(t,r-1),n.getControlPointAt(t,r),n.getControlPointAt(t,r+1),n.getControlPointAt(t,r+2),e,s);o[2*c]=l.x,o[2*c+1]=l.y}var d=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POSITION),d.uniform4fv(this._colorLocation,this._colorArray);var u=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,u),d.bufferData(d.ARRAY_BUFFER,o,d.STATIC_DRAW),d.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,0),d.drawArrays(d.LINE_STRIP,0,i+1),d.deleteBuffer(u),n.incrementGLDraws(1)},setDrawColor:function(t,e,i,n){this._colorArray[0]=t/255,this._colorArray[1]=e/255,this._colorArray[2]=i/255,this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t*n.contentScaleFactor()},setLineWidth:function(t){this._renderContext.lineWidth&&this._renderContext.lineWidth(t)}}),n._tmp.PrototypeLabelTTF=function(){var t=n.LabelTTF.prototype;n.defineGetterSetter(t,"color",t.getColor,t.setColor),n.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),t.string,n.defineGetterSetter(t,"string",t.getString,t.setString),t.textAlign,n.defineGetterSetter(t,"textAlign",t.getHorizontalAlignment,t.setHorizontalAlignment),t.verticalAlign,n.defineGetterSetter(t,"verticalAlign",t.getVerticalAlignment,t.setVerticalAlignment),t.fontSize,n.defineGetterSetter(t,"fontSize",t.getFontSize,t.setFontSize),t.fontName,n.defineGetterSetter(t,"fontName",t.getFontName,t.setFontName),t.font,n.defineGetterSetter(t,"font",t._getFont,t._setFont),t.boundingSize,t.boundingWidth,n.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t._setBoundingWidth),t.boundingHeight,n.defineGetterSetter(t,"boundingHeight",t._getBoundingHeight,t._setBoundingHeight),t.fillStyle,n.defineGetterSetter(t,"fillStyle",t._getFillStyle,t.setFontFillColor),t.strokeStyle,n.defineGetterSetter(t,"strokeStyle",t._getStrokeStyle,t._setStrokeStyle),t.lineWidth,n.defineGetterSetter(t,"lineWidth",t._getLineWidth,t._setLineWidth),t.shadowOffset,t.shadowOffsetX,n.defineGetterSetter(t,"shadowOffsetX",t._getShadowOffsetX,t._setShadowOffsetX),t.shadowOffsetY,n.defineGetterSetter(t,"shadowOffsetY",t._getShadowOffsetY,t._setShadowOffsetY),t.shadowOpacity,n.defineGetterSetter(t,"shadowOpacity",t._getShadowOpacity,t._setShadowOpacity),t.shadowBlur,n.defineGetterSetter(t,"shadowBlur",t._getShadowBlur,t._setShadowBlur)},n.LabelTTF=n.Sprite.extend({_dimensions:null,_hAlignment:n.TextAlignment.CENTER,_vAlignment:n.VerticalTextAlignment.TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_onCacheCanvasMode:!0,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",_lineHeight:"normal",initWithString:function(t,e,i,r,s,o){var a;return a=t?t+"":"",i=i||16,r=r||n.size(0,0),s=s||n.TextAlignment.LEFT,o=o||n.VerticalTextAlignment.TOP,this._opacityModifyRGB=!1,this._dimensions=n.size(r.width,r.height),this._fontName=e||"Arial",this._hAlignment=s,this._vAlignment=o,this._fontSize=i,this._renderCmd._setFontStyle(this._fontName,i,this._fontStyle,this._fontWeight),this.string=a,this._renderCmd._setColorsString(),this._renderCmd._updateTexture(),this._setUpdateTextureDirty(),!0},_setUpdateTextureDirty:function(){this._needUpdateTexture=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.textDirty)},ctor:function(t,e,i,r,s,o){n.Sprite.prototype.ctor.call(this),this._dimensions=n.size(0,0),this._hAlignment=n.TextAlignment.LEFT,this._vAlignment=n.VerticalTextAlignment.TOP,this._opacityModifyRGB=!1,this._fontName="Arial",this._shadowEnabled=!1,this._shadowOffset=n.p(0,0),this._shadowOpacity=0,this._shadowBlur=0,this._strokeEnabled=!1,this._strokeColor=n.color(255,255,255,255),this._strokeSize=0,this._textFillColor=n.color(255,255,255,255),this._strokeShadowOffsetX=0,this._strokeShadowOffsetY=0,this._needUpdateTexture=!1,this._lineWidths=[],this._renderCmd._setColorsString(),this._textureLoaded=!0,e&&e instanceof n.FontDefinition?this.initWithStringAndTextDefinition(t,e):n.LabelTTF.prototype.initWithString.call(this,t,e,i,r,s,o)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},getLineHeight:function(){return!this._lineHeight||this._lineHeight.charAt?this._renderCmd._getFontClientHeight():this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(t){this._lineHeight=t},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return n.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithStringAndTextDefinition:function(t,e){return this._updateWithTextDefinition(e,!1),this.string=t,!0},setTextDefinition:function(t){t&&this._updateWithTextDefinition(t,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(t,e,i,n){null!=t.r&&null!=t.g&&null!=t.b&&null!=t.a?this._enableShadow(t,e,i):this._enableShadowNoneColor(t,e,i,n)},_enableShadowNoneColor:function(t,e,i,n){i=i||.5,!1===this._shadowEnabled&&(this._shadowEnabled=!0);var r=this._shadowOffset;(r&&r.x!==t||r._y!==e)&&(r.x=t,r.y=e),this._shadowOpacity!==i&&(this._shadowOpacity=i),this._renderCmd._setColorsString(),this._shadowBlur!==n&&(this._shadowBlur=n),this._setUpdateTextureDirty()},_enableShadow:function(t,e,i){this._shadowColor||(this._shadowColor=n.color(255,255,255,128)),this._shadowColor.r=t.r,this._shadowColor.g=t.g,this._shadowColor.b=t.b;var r,s,o,a;r=e.width||e.x||0,s=e.height||e.y||0,o=null!=t.a?t.a/255:.5,a=i,this._enableShadowNoneColor(r,s,o,a)},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset.x!==t&&(this._shadowOffset.x=t,this._setUpdateTextureDirty())},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset._y!==t&&(this._shadowOffset._y=t,this._setUpdateTextureDirty())},_getShadowOffset:function(){return n.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),(this._shadowOffset.x!==t.x||this._shadowOffset.y!==t.y)&&(this._shadowOffset.x=t.x,this._shadowOffset.y=t.y,this._setUpdateTextureDirty())},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOpacity!==t&&(this._shadowOpacity=t,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowBlur!==t&&(this._shadowBlur=t,this._setUpdateTextureDirty())},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._setUpdateTextureDirty())},enableStroke:function(t,e){this._strokeEnabled===!1&&(this._strokeEnabled=!0);var i=this._strokeColor;(i.r!==t.r||i.g!==t.g||i.b!==t.b)&&(i.r=t.r,i.g=t.g,i.b=t.b,this._renderCmd._setColorsString()),this._strokeSize!==e&&(this._strokeSize=e||0),this._setUpdateTextureDirty()},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(t){this._strokeEnabled===!1&&(this._strokeEnabled=!0);var e=this._strokeColor;(e.r!==t.r||e.g!==t.g||e.b!==t.b)&&(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(t){this._strokeEnabled===!1&&(this._strokeEnabled=!0),this._strokeSize!==t&&(this._strokeSize=t||0,this._setUpdateTextureDirty())},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,this._setUpdateTextureDirty())},setFontFillColor:function(t){var e=this._textFillColor;(e.r!==t.r||e.g!==t.g||e.b!==t.b)&&(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._needUpdateTexture=!0)},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(t,e){t.fontDimensions?(this._dimensions.width=t.boundingWidth,this._dimensions.height=t.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0),this._hAlignment=t.textAlign,this._vAlignment=t.verticalAlign,this._fontName=t.fontName,this._fontSize=t.fontSize||12,this._lineHeight=t.lineHeight?t.lineHeight:this._fontSize,this._renderCmd._setFontStyle(t),t.shadowEnabled&&this.enableShadow(t.shadowOffsetX,t.shadowOffsetY,t.shadowOpacity,t.shadowBlur),t.strokeEnabled&&this.enableStroke(t.strokeStyle,t.lineWidth),this.setFontFillColor(t.fillStyle),e&&this._renderCmd._updateTexture();var i=_ccsg.Node._dirtyFlags;this._renderCmd.setDirtyFlag(i.colorDirty|i.opacityDirty|i.textDirty)},_prepareTextDefinition:function(t){var e=new n.FontDefinition;if(t?(e.fontSize=this._fontSize,e.boundingWidth=n.contentScaleFactor()*this._dimensions.width,e.boundingHeight=n.contentScaleFactor()*this._dimensions.height):(e.fontSize=this._fontSize,e.boundingWidth=this._dimensions.width,e.boundingHeight=this._dimensions.height),e.fontName=this._fontName,e.textAlign=this._hAlignment,e.verticalAlign=this._vAlignment,this._strokeEnabled){e.strokeEnabled=!0;var i=this._strokeColor;e.strokeStyle=n.color(i.r,i.g,i.b),e.lineWidth=this._strokeSize}else e.strokeEnabled=!1;this._shadowEnabled?(e.shadowEnabled=!0,e.shadowBlur=this._shadowBlur,e.shadowOpacity=this._shadowOpacity,e.shadowOffsetX=(t?n.contentScaleFactor():1)*this._shadowOffset.x,e.shadowOffsetY=(t?n.contentScaleFactor():1)*this._shadowOffset.y):e._shadowEnabled=!1;var r=this._textFillColor;return e.fillStyle=n.color(r.r,r.g,r.b),e},setString:function(t){t=String(t),this._originalText!==t&&(this._originalText=t+"",this._updateString(),this._setUpdateTextureDirty(),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty))},_updateString:function(){this._string&&""!==this._string||this._string===this._originalText||(n.renderer.childrenOrderDirty=!0),this._string=this._originalText},setHorizontalAlignment:function(t){t!==this._hAlignment&&(this._hAlignment=t,this._setUpdateTextureDirty())},setVerticalAlignment:function(t){t!==this._vAlignment&&(this._vAlignment=t,this._setUpdateTextureDirty())},setDimensions:function(t,e){var i;void 0===e?(i=t.width,e=t.height):i=t,(i!==this._dimensions.width||e!==this._dimensions.height)&&(this._dimensions.width=i,this._dimensions.height=e,this._updateString(),this._setUpdateTextureDirty())},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(t){t!==this._dimensions.width&&(this._dimensions.width=t,this._updateString(),this._setUpdateTextureDirty())},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(t){t!==this._dimensions.height&&(this._dimensions.height=t,this._updateString(),this._setUpdateTextureDirty())},setFontSize:function(t){this._fontSize!==t&&(this._fontSize=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},setFontName:function(t){this._fontName&&this._fontName!==t&&(this._fontName=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(t){var e=n.LabelTTF._fontStyleRE.exec(t);e&&(this._fontSize=parseInt(e[1]),this._fontName=e[2],this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},getContentSize:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),n.Sprite.prototype.getContentSize.call(this)},_getWidth:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),n.Sprite.prototype._getWidth.call(this)},_getHeight:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),n.Sprite.prototype._getHeight.call(this)},setTextureRect:function(t,e,i){n.Sprite.prototype.setTextureRect.call(this,t,e,i,!1)},setDrawMode:function(t){this._onCacheCanvasMode=t},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_WEBGL?new n.LabelTTF.WebGLRenderCmd(this):this._onCacheCanvasMode?new n.LabelTTF.CacheCanvasRenderCmd(this):new n.LabelTTF.CanvasRenderCmd(this)},_setFontStyle:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(t){this._fontWeight!==t&&(this._fontWeight=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontWeight:function(){return this._fontWeight}}),n.assert(n.js.isFunction(n._tmp.PrototypeLabelTTF),n._LogInfos.MissingFile,"LabelTTFPropertyDefine.js"),n._tmp.PrototypeLabelTTF(),delete n._tmp.PrototypeLabelTTF,n.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/,n.LabelTTF.create=function(t,e,i,r,s,o){return new n.LabelTTF(t,e,i,r,s,o)},n.LabelTTF.createWithFontDefinition=n.LabelTTF.create,n.LabelTTF._SHADER_PROGRAM=n.USE_LA88_LABELS?n.SHADER_POSITION_TEXTURECOLOR:n.SHADER_POSITION_TEXTUREA8COLOR,n.LabelTTF.__labelHeightDiv=document.createElement("div"),n.LabelTTF.__labelHeightDiv.style.fontFamily="Arial",n.LabelTTF.__labelHeightDiv.style.position="absolute",n.LabelTTF.__labelHeightDiv.style.left="-100px",n.LabelTTF.__labelHeightDiv.style.top="-100px",n.LabelTTF.__labelHeightDiv.style.lineHeight="normal",document.body?document.body.appendChild(n.LabelTTF.__labelHeightDiv):window.addEventListener("load",function(){window.removeEventListener("load",arguments.callee,!1),document.body.appendChild(n.LabelTTF.__labelHeightDiv)},!1),n.LabelTTF.__getFontHeightByDiv=function(t,e){if(t instanceof n.FontDefinition){var i=t,r=n.LabelTTF.__fontHeightCache[i._getCanvasFontStr()];if(r>0)return r;var s=n.LabelTTF.__labelHeightDiv;return s.innerHTML="ajghl~!",s.style.fontFamily=i.fontName,s.style.fontSize=i.fontSize+"px",s.style.fontStyle=i.fontStyle,s.style.fontWeight=i.fontWeight,r=s.clientHeight,n.LabelTTF.__fontHeightCache[i._getCanvasFontStr()]=r,s.innerHTML="",r}var r=n.LabelTTF.__fontHeightCache[t+"."+e];if(r>0)return r;var s=n.LabelTTF.__labelHeightDiv;return s.innerHTML="ajghl~!",s.style.fontFamily=t,s.style.fontSize=e+"px",r=s.clientHeight,n.LabelTTF.__fontHeightCache[t+"."+e]=r,s.innerHTML="",r},n.LabelTTF.__fontHeightCache={},n.LabelTTF._textAlign=["left","center","right"],n.LabelTTF._textBaseline=["top","middle","bottom"],n.LabelTTF.wrapInspection=!0,n.LabelTTF._wordRex=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+|\S)/,n.LabelTTF._symbolRex=/^[!,.:;}\]%\?>、‘“》？。，！]/,n.LabelTTF._lastWordRex=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+|\S)$/,n.LabelTTF._lastEnglish=/[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+$/,n.LabelTTF._firsrEnglish=/^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]/,function(){n.LabelTTF.RenderCmd=function(){this._fontClientHeight=18,this._fontStyleStr="",this._shadowColorStr="rgba(128, 128, 128, 0.5)",this._strokeColorStr="",this._fillColorStr="rgba(255,255,255,1)",
this._labelCanvas=null,this._labelContext=null,this._lineWidths=[],this._strings=[],this._isMultiLine=!1,this._status=[],this._renderingIndex=0};var t=n.LabelTTF.RenderCmd.prototype;t.constructor=n.LabelTTF.RenderCmd,t._setFontStyle=function(t,e,i,r){t instanceof n.FontDefinition?(this._fontStyleStr=t._getCanvasFontStr(),this._fontClientHeight=n.LabelTTF.__getFontHeightByDiv(t)):(this._fontStyleStr=i+" "+r+" "+e+"px '"+t+"'",this._fontClientHeight=n.LabelTTF.__getFontHeightByDiv(t,e))},t._getFontStyle=function(){return this._fontStyleStr},t._getFontClientHeight=function(){return this._fontClientHeight},t._updateColor=function(){this._setColorsString(),this._updateTexture()},t._setColorsString=function(){var t=this._displayedColor,e=this._node,i=e._shadowColor||this._displayedColor,n=e._strokeColor,r=e._textFillColor,s=t.r/255,o=t.g/255,a=t.b/255;this._shadowColorStr="rgba("+(0|s*i.r)+","+(0|o*i.g)+","+(0|a*i.b)+","+e._shadowOpacity+")",this._fillColorStr="rgba("+(0|s*r.r)+","+(0|o*r.g)+","+(0|a*r.b)+", 1)",this._strokeColorStr="rgba("+(0|s*n.r)+","+(0|o*n.g)+","+(0|a*n.b)+", 1)"},t._updateTTF=function(){var t,e,i=this._node,r=i._dimensions.width,s=this._lineWidths;if(s.length=0,this._isMultiLine=!1,this._measureConfig(),0!==r)for(this._strings=i._string.split("\n"),t=0;t<this._strings.length;t++)this._checkWarp(this._strings,t,r);else for(this._strings=i._string.split("\n"),t=0,e=this._strings.length;e>t;t++)s.push(this._measure(this._strings[t]));this._strings.length>1&&(this._isMultiLine=!0);var o,a=0,c=0;if(i._strokeEnabled&&(a=c=2*i._strokeSize),i._shadowEnabled){var h=i._shadowOffset;a+=2*Math.abs(h.x),c+=2*Math.abs(h.y)}o=0===r?this._isMultiLine?n.size(Math.ceil(Math.max.apply(Math,s)+a),Math.ceil(this._fontClientHeight*this._strings.length+c)):n.size(Math.ceil(this._measure(i._string)+a),Math.ceil(this._fontClientHeight+c)):0===i._dimensions.height?this._isMultiLine?n.size(Math.ceil(r+a),Math.ceil(i.getLineHeight()*this._strings.length+c)):n.size(Math.ceil(r+a),Math.ceil(i.getLineHeight()+c)):n.size(Math.ceil(r+a),Math.ceil(i._dimensions.height+c)),"normal"!==i._getFontStyle()&&(o.width=Math.ceil(o.width+.3*i._fontSize)),i.setContentSize(o),i._strokeShadowOffsetX=a,i._strokeShadowOffsetY=c;var l=i._anchorPoint;this._anchorPointInPoints.x=.5*a+(o.width-a)*l.x,this._anchorPointInPoints.y=.5*c+(o.height-c)*l.y},t._saveStatus=function(){var t=this._node,e=t._strokeShadowOffsetX,i=t._strokeShadowOffsetY,r=t._contentSize.height-i,s=t._vAlignment,o=t._hAlignment,a=.5*e,c=r+.5*i,h=0,l=0,d=[],u=t._contentSize.width-e,_=t.getLineHeight(),f=(_-this._fontClientHeight)/2;if(h+=o===n.TextAlignment.RIGHT?u:o===n.TextAlignment.CENTER?u/2:0,this._isMultiLine){var p=this._strings.length;s===n.VerticalTextAlignment.BOTTOM?l=_-2*f+r-_*p:s===n.VerticalTextAlignment.CENTER&&(l=(_-2*f)/2+(r-_*p)/2);for(var g=0;p>g;g++){var m=-r+(_*g+f)+l;d.push(m)}}else s===n.VerticalTextAlignment.BOTTOM||(l-=s===n.VerticalTextAlignment.TOP?r:.5*r),d.push(l);var y={contextTransform:n.v2f(a,c),xOffset:h,OffsetYArray:d};this._status.push(y)},t._drawTTFInCanvas=function(t){if(t){var e=this._status.pop();t.setTransform(1,0,0,1,e.contextTransform.x,e.contextTransform.y);var i=e.xOffset,n=e.OffsetYArray;this.drawLabels(t,i,n)}},t._checkWarp=function(t,e,i){var r=t[e],s=this._measure(r);if(s>i&&r.length>1){for(var o,a=r.length*(i/s)|0,c=r.substr(a),h=s-this._measure(c),l=0,d=0;h>i&&d++<100;)a*=i/h,a=0|a,c=r.substr(a),h=s-this._measure(c);for(d=0;i>h&&d++<100;){if(c){var u=n.LabelTTF._wordRex.exec(c);l=u?u[0].length:1,o=c}a+=l,c=r.substr(a),h=s-this._measure(c)}a-=l,0===a&&(a=1,o=o.substr(1));var _,f=r.substr(0,a);n.LabelTTF.wrapInspection&&n.LabelTTF._symbolRex.test(o||c)&&(_=n.LabelTTF._lastWordRex.exec(f),a-=_?_[0].length:0,o=r.substr(a),f=r.substr(0,a)),n.LabelTTF._firsrEnglish.test(o)&&(_=n.LabelTTF._lastEnglish.exec(f),_&&f!==_[0]&&(a-=_[0].length,o=r.substr(a),f=r.substr(0,a))),t[e]=o||c,t.splice(e,0,f)}},t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;i&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),i||n?this._updateColor():e&t.textDirty&&this._updateTexture(),this._dirtyFlag&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty^this._dirtyFlag)},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var r=i&e.colorDirty,s=i&e.opacityDirty;this._dirtyFlag=i,r&&this._syncDisplayColor(),s&&this._syncDisplayOpacity(),r||s?this._updateColor():i&e.textDirty&&this._updateTexture(),i&e.transformDirty&&this.transform(t)},t.drawLabels=function(t,e,i){var r=this._node;if(r._shadowEnabled){var s=r._shadowOffset;t.shadowColor=this._shadowColorStr,t.shadowOffsetX=s.x,t.shadowOffsetY=-s.y,t.shadowBlur=r._shadowBlur}var o=r._hAlignment,a=r._vAlignment,c=r._strokeSize;t.font!==this._fontStyleStr&&(t.font=this._fontStyleStr),t.fillStyle=this._fillColorStr;var h=r._strokeEnabled;h&&(t.lineWidth=2*c,t.strokeStyle=this._strokeColorStr),t.textBaseline=n.LabelTTF._textBaseline[a],t.textAlign=n.LabelTTF._textAlign[o];for(var l=this._strings.length,d=0;l>d;d++){var u=this._strings[d];h&&t.strokeText(u,e,i[d]),t.fillText(u,e,i[d])}n.g_NumberOfDraws++}}(),function(){n.LabelTTF.CacheRenderCmd=function(t){n.LabelTTF.RenderCmd.call(this,t);var e=this._labelCanvas=document.createElement("canvas");e.width=1,e.height=1,this._labelContext=e.getContext("2d")},n.LabelTTF.CacheRenderCmd.prototype=Object.create(n.LabelTTF.RenderCmd.prototype),n.js.mixin(n.LabelTTF.CacheRenderCmd.prototype,n.LabelTTF.RenderCmd.prototype);var t=n.LabelTTF.CacheRenderCmd.prototype;t.constructor=n.LabelTTF.CacheRenderCmd,t._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty^this._dirtyFlag;var t=this._node,e=t._contentSize;this._updateTTF();var i=e.width,r=e.height,s=this._labelContext,o=this._labelCanvas;if(!t._texture){var a=new n.Texture2D;a.initWithElement(this._labelCanvas),t.setTexture(a)}if(0===t._string.length)return o.width=1,o.height=e.height||1,t._texture&&t._texture.handleLoadedTexture(),t.setTextureRect(n.rect(0,0,1,e.height)),!0;s.font=this._fontStyleStr;var c=o.width===i&&o.height===r;return o.width=i,o.height=r,c&&s.clearRect(0,0,i,r),this._saveStatus(),this._drawTTFInCanvas(s),t._texture&&t._texture.handleLoadedTexture(),t.setTextureRect(n.rect(0,0,i,r)),!0},t._measureConfig=function(){this._labelContext.font=this._fontStyleStr},t._measure=function(t){return this._labelContext.measureText(t).width}}(),function(){n.LabelTTF.CacheCanvasRenderCmd=function(t){n.Sprite.CanvasRenderCmd.call(this,t),n.LabelTTF.CacheRenderCmd.call(this)};var t=n.LabelTTF.CacheCanvasRenderCmd.prototype=Object.create(n.Sprite.CanvasRenderCmd.prototype);n.js.mixin(t,n.LabelTTF.CacheRenderCmd.prototype),t.constructor=n.LabelTTF.CacheCanvasRenderCmd}(),function(){n.LabelTTF.CanvasRenderCmd=function(t){n.Sprite.CanvasRenderCmd.call(this,t),n.LabelTTF.RenderCmd.call(this)},n.LabelTTF.CanvasRenderCmd.prototype=Object.create(n.Sprite.CanvasRenderCmd.prototype),n.js.mixin(n.LabelTTF.CanvasRenderCmd.prototype,n.LabelTTF.RenderCmd.prototype);var t=n.LabelTTF.CanvasRenderCmd.prototype;t.constructor=n.LabelTTF.CanvasRenderCmd,t._measureConfig=function(){},t._measure=function(t){var e=n._renderContext.getContext();return e.font=this._fontStyleStr,e.measureText(t).width},t._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty^this._dirtyFlag;var t=this._node,e=t._contentSize;this._updateTTF();var i=e.width,r=e.height;return 0===t._string.length?(t.setTextureRect(n.rect(0,0,1,e.height)),!0):(this._saveStatus(),t.setTextureRect(n.rect(0,0,i,r)),!0)},t.rendering=function(t){var e=n.view.getScaleX(),i=n.view.getScaleY(),r=t||n._renderContext,s=r.getContext();if(s){var o=this._node;if(r.computeRealOffsetY(),!(this._status.length<=0)){var a=this._renderingIndex>=this._status.length?this._renderingIndex-this._status.length:this._renderingIndex,c=this._status[a];this._renderingIndex=a+1;var h=o._rect.height,l=o._offsetPosition.x,d=-o._offsetPosition.y-h,u=this._displayedOpacity/255;r.setTransform(this._worldTransform,e,i),r.setCompositeOperation(this._blendFuncStr),r.setGlobalAlpha(u),r.save(),o._flippedX&&(l=-l-o._rect.width,s.scale(-1,1)),o._flippedY&&(d=o._offsetPosition.y,s.scale(1,-1));for(var _=c.xOffset+c.contextTransform.x+l*e,f=[],p=this._strings.length,g=0;p>g;g++)f.push(c.OffsetYArray[g]+c.contextTransform.y+d*i);this.drawLabels(s,_,f),r.restore()}}}}(),function(){n.LabelTTF.WebGLRenderCmd=function(t){n.Sprite.WebGLRenderCmd.call(this,t),n.LabelTTF.CacheRenderCmd.call(this),this.setShaderProgram(n.shaderCache.programForKey(n.LabelTTF._SHADER_PROGRAM))};var t=n.LabelTTF.WebGLRenderCmd.prototype=Object.create(n.Sprite.WebGLRenderCmd.prototype);n.js.mixin(t,n.LabelTTF.CacheRenderCmd.prototype),t.constructor=n.LabelTTF.WebGLRenderCmd,t._updateColor=function(){this._updateTexture(),n.Sprite.WebGLRenderCmd.prototype._updateColor.call(this)}}(),n.HashElement=n._Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.currentActionSalvaged=!1,this.paused=!1,this.hh=null}}),n.ActionManager=n._Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null,this._currentTargetSalvaged=!1},addAction:function(t,e,i){if(!t)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!e)throw new Error("cc.ActionManager.addAction(): action must be non-null");var r=this._hashTargets[e.__instanceId];r||(r=new n.HashElement,r.paused=i,r.target=e,this._hashTargets[e.__instanceId]=r,this._arrayTargets.push(r)),this._actionAllocWithHashElement(r),r.actions.push(t),t.startWithTarget(e)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this.removeAllActionsFromTarget(i.target,!0)}},removeAllActionsFromTarget:function(t,e){if(null!=t){var i=this._hashTargets[t.__instanceId];i&&(-1===i.actions.indexOf(i.currentAction)||i.currentActionSalvaged||(i.currentActionSalvaged=!0),i.actions.length=0,this._currentTarget!==i||e?this._deleteHashElement(i):this._currentTargetSalvaged=!0)}},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets[e.__instanceId];if(i){for(var r=0;r<i.actions.length;r++)if(i.actions[r]===t){i.actions.splice(r,1);break}}else n.log(n._LogInfos.ActionManager.removeAction)}},removeActionByTag:function(t,e){t===n.ACTION_TAG_INVALID&&n.log(n._LogInfos.ActionManager.addAction),n.assert(e,n._LogInfos.ActionManager.addAction);var i=this._hashTargets[e.__instanceId];if(i)for(var r=i.actions.length,s=0;r>s;++s){var o=i.actions[s];if(o&&o.getTag()===t&&o.getOriginalTarget()===e){this._removeActionAtIndex(s,i);break}}},getActionByTag:function(t,e){t===n.ACTION_TAG_INVALID&&n.log(n._LogInfos.ActionManager.getActionByTag);var i=this._hashTargets[e.__instanceId];if(i){if(null!=i.actions)for(var r=0;r<i.actions.length;++r){var s=i.actions[r];if(s&&s.getTag()===t)return s}n.log(n._LogInfos.ActionManager.getActionByTag_2,t)}return null},numberOfRunningActionsInTarget:function(t){var e=this._hashTargets[t.__instanceId];return e&&e.actions?e.actions.length:0},pauseTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!0)},resumeTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},purgeSharedManager:function(){n.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){var i=e.actions[t];i!==e.currentAction||e.currentActionSalvaged||(e.currentActionSalvaged=!0),e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&(this._currentTarget===e?this._currentTargetSalvaged=!0:this._deleteHashElement(e))},_deleteHashElement:function(t){var e=!1;return t&&(this._hashTargets[t.target.__instanceId]&&(delete this._hashTargets[t.target.__instanceId],n.js.array.remove(this._arrayTargets,t),e=!0),t.actions=null,t.target=null),e},_actionAllocWithHashElement:function(t){null==t.actions&&(t.actions=[])},update:function(t){for(var e,i=this._arrayTargets,n=0;n<i.length;n++){if(this._currentTarget=i[n],e=this._currentTarget,!e.paused)for(e.actionIndex=0;e.actionIndex<(e.actions?e.actions.length:0);e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentActionSalvaged=!1,e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentActionSalvaged)e.currentAction=null;else if(e.currentAction.isDone()){e.currentAction.stop();var r=e.currentAction;e.currentAction=null,this.removeAction(r)}e.currentAction=null}this._currentTargetSalvaged&&0===e.actions.length&&this._deleteHashElement(e)&&n--}}}),n.math=n.math||{},n.math.EPSILON=1/64,n.math.square=function(t){return t*t},n.math.almostEqual=function(t,e){return t+n.math.EPSILON>e&&t-n.math.EPSILON<e},function(t){t.math.Vec2=function(t,e){void 0===e?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)};var e=t.math.Vec2.prototype;e.fill=function(t,e){this.x=t,this.y=e},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},t.math.Vec2.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},e.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.dot=function(t){return this.x*t.x+this.y*t.y},t.math.Vec2.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},e.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},e.transform=function(t){var e=this.x,i=this.y;return this.x=e*t.mat[0]+i*t.mat[3]+t.mat[6],this.y=e*t.mat[1]+i*t.mat[4]+t.mat[7],this},t.math.Vec2.scale=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},e.scale=function(t){return this.x*=t,this.y*=t,this},e.equals=function(e){return this.x<e.x+t.math.EPSILON&&this.x>e.x-t.math.EPSILON&&this.y<e.y+t.math.EPSILON&&this.y>e.y-t.math.EPSILON}}(n),function(t){t.kmVec3=t.math.Vec3=function(t,e,i){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)},t.math.vec3=function(e,i,n){return new t.math.Vec3(e,i,n)};var e=t.math.Vec3.prototype;e.fill=function(t,e,i){return t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),this},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},e.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},e.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},e.transform=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8]+r[12],this.y=e*r[1]+i*r[5]+n*r[9]+r[13],this.z=e*r[2]+i*r[6]+n*r[10]+r[14],this},e.transformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8],this.y=e*r[1]+i*r[5]+n*r[9],this.z=e*r[2]+i*r[6]+n*r[10],this},e.transformCoord=function(e){var i=new t.math.Vec4(this.x,this.y,this.z,1);return i.transform(e),this.x=i.x/i.w,this.y=i.y/i.w,this.z=i.z/i.w,this},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.equals=function(e){var i=t.math.EPSILON;return this.x<e.x+i&&this.x>e.x-i&&this.y<e.y+i&&this.y>e.y-i&&this.z<e.z+i&&this.z>e.z-i},e.inverseTransform=function(e){var i=e.mat,n=new t.math.Vec3(this.x-i[12],this.y-i[13],this.z-i[14]);return this.x=n.x*i[0]+n.y*i[1]+n.z*i[2],this.y=n.x*i[4]+n.y*i[5]+n.z*i[6],this.z=n.x*i[8]+n.y*i[9]+n.z*i[10],this},e.inverseTransformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[1]+n*r[2],this.y=e*r[4]+i*r[5]+n*r[6],this.z=e*r[8]+i*r[9]+n*r[10],this},e.assignFrom=function(t){return t?(this.x=t.x,this.y=t.y,this.z=t.z,this):this},t.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},e.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}}(n),function(t){t.math.Vec4=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)},t.kmVec4=t.math.Vec4;var e=t.math.Vec4.prototype;e.fill=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t,this.y=e,this.z=i,this.w=n)},e.add=function(t){return t?(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this):this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w)},e.lerp=function(t,e){return this},e.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},e.transform=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,s=t.mat;return this.x=e*s[0]+i*s[4]+n*s[8]+r*s[12],this.y=e*s[1]+i*s[5]+n*s[9]+r*s[13],this.z=e*s[2]+i*s[6]+n*s[10]+r*s[14],this.w=e*s[3]+i*s[7]+n*s[11]+r*s[15],this},t.math.Vec4.transformArray=function(e,i){for(var n=[],r=0;r<e.length;r++){var s=new t.math.Vec4(e[r]);s.transform(i),n.push(s)}return n},e.equals=function(e){var i=t.math.EPSILON;return this.x<e.x+i&&this.x>e.x-i&&this.y<e.y+i&&this.y>e.y-i&&this.z<e.z+i&&this.z>e.z-i&&this.w<e.w+i&&this.w>e.w-i},e.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}}(n),function(t){function e(e,i,n){var r=new t.math.Vec2(i);r.subtract(e),n.x=-r.y,n.y=r.x,n.normalize()}t.math.Ray2=function(e,i){this.start=e||new t.math.Vec2,this.dir=i||new t.math.Vec2},t.math.Ray2.prototype.fill=function(t,e,i,n){this.start.x=t,this.start.y=e,this.dir.x=i,this.dir.y=n},t.math.Ray2.prototype.intersectLineSegment=function(e,i,n){var r,s,o,a=this.start.x,c=this.start.y,h=this.start.x+this.dir.x,l=this.start.y+this.dir.y,d=e.x,u=e.y,_=i.x,f=i.y,p=(f-u)*(h-a)-(_-d)*(l-c);return p>-t.math.EPSILON&&p<t.math.EPSILON?!1:(r=((_-d)*(c-u)-(f-u)*(a-d))/p,s=a+r*(h-a),o=c+r*(l-c),s<Math.min(e.x,i.x)-t.math.EPSILON||s>Math.max(e.x,i.x)+t.math.EPSILON||o<Math.min(e.y,i.y)-t.math.EPSILON||o>Math.max(e.y,i.y)+t.math.EPSILON?!1:s<Math.min(a,h)-t.math.EPSILON||s>Math.max(a,h)+t.math.EPSILON||o<Math.min(c,l)-t.math.EPSILON||o>Math.max(c,l)+t.math.EPSILON?!1:(n.x=s,n.y=o,!0))},t.math.Ray2.prototype.intersectTriangle=function(i,n,r,s,o){var a,c=new t.math.Vec2,h=new t.math.Vec2,l=new t.math.Vec2,d=1e4,u=!1;return this.intersectLineSegment(i,n,c)&&(u=!0,a=c.subtract(this.start).length(),d>a&&(h.x=c.x,h.y=c.y,d=a,e(i,n,l))),this.intersectLineSegment(n,r,c)&&(u=!0,a=c.subtract(this.start).length(),d>a&&(h.x=c.x,h.y=c.y,d=a,e(n,r,l))),this.intersectLineSegment(r,i,c)&&(u=!0,a=c.subtract(this.start).length(),d>a&&(h.x=c.x,h.y=c.y,d=a,e(r,i,l))),u&&(s.x=h.x,s.y=h.y,o&&(o.x=l.x,o.y=l.y)),u}}(n),window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array,function(t){t.math.Matrix3=function(t){this.mat=new Float32Array(t&&t.mat?t.mat:9)},t.kmMat3=t.math.Matrix3;var e=t.math.Matrix3.prototype;e.fill=function(t){var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},e.adjugate=function(){var t=this.mat,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],h=t[8];return t[0]=s*h-o*c,t[1]=n*c-i*h,t[2]=i*o-n*s,t[3]=o*a-r*h,t[4]=e*h-n*a,t[5]=n*r-e*o,t[6]=r*c-s*a,t[8]=e*s-i*r,this},e.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,this};var i=new t.math.Matrix3;e.inverse=function(t){if(0===t)return this;i.assignFrom(this);var e=1/t;return this.adjugate(),this.multiplyScalar(e),this},e.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]},e.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[5],s=t[6],o=t[7];return t[1]=n,t[2]=s,t[3]=e,t[5]=o,t[6]=i,t[7]=r,this},e.determinant=function(){var t=this.mat,e=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7];return e-=t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8]},e.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],d=e[8],u=i[0],_=i[1],f=i[2],p=i[3],g=i[4],m=i[5],y=i[6],v=i[7],T=i[8];return e[0]=n*u+o*_+h*f,e[1]=r*u+a*_+l*f,e[2]=s*u+c*_+d*f,e[3]=s*u+c*_+d*f,e[4]=r*p+a*g+l*m,e[5]=s*p+c*g+d*m,e[6]=n*y+o*v+h*T,e[7]=r*y+a*v+l*T,e[8]=s*y+c*v+d*T,this},e.multiplyScalar=function(t){var e=this.mat;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},t.math.Matrix3.rotationAxisAngle=function(e,i){var n=Math.cos(i),r=Math.sin(i),s=new t.math.Matrix3,o=s.mat;return o[0]=n+e.x*e.x*(1-n),o[1]=e.z*r+e.y*e.x*(1-n),o[2]=-e.y*r+e.z*e.x*(1-n),o[3]=-e.z*r+e.x*e.y*(1-n),o[4]=n+e.y*e.y*(1-n),o[5]=e.x*r+e.z*e.y*(1-n),o[6]=e.y*r+e.x*e.z*(1-n),o[7]=-e.x*r+e.y*e.z*(1-n),o[8]=n+e.z*e.z*(1-n),s},e.assignFrom=function(e){if(this===e)return t.log("cc.math.Matrix3.assign(): current matrix equals matIn"),this;var i=this.mat,n=e.mat;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this},e.equals=function(e){if(this===e)return!0;for(var i=t.math.EPSILON,n=this.mat,r=e.mat,s=0;9>s;++s)if(!(n[s]+i>r[s]&&n[s]-i<r[s]))return!1;return!0},t.math.Matrix3.createByRotationX=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=Math.cos(e),n[5]=Math.sin(e),n[6]=0,n[7]=-Math.sin(e),n[8]=Math.cos(e),i},t.math.Matrix3.createByRotationY=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=0,n[2]=-Math.sin(e),n[3]=0,n[4]=1,n[5]=0,n[6]=Math.sin(e),n[7]=0,n[8]=Math.cos(e),i},t.math.Matrix3.createByRotationZ=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=-Math.sin(e),n[2]=0,n[3]=Math.sin(e),n[4]=Math.cos(e),n[5]=0,n[6]=0,n[7]=0,n[8]=1,i},t.math.Matrix3.createByRotation=function(e){var i=new t.math.Matrix3,n=i.mat;return n[0]=Math.cos(e),n[1]=Math.sin(e),n[2]=0,n[3]=-Math.sin(e),n[4]=Math.cos(e),n[5]=0,n[6]=0,n[7]=0,n[8]=1,i},t.math.Matrix3.createByScale=function(e,i){var n=new t.math.Matrix3;return n.identity(),n.mat[0]=e,n.mat[4]=i,n},t.math.Matrix3.createByTranslation=function(e,i){var n=new t.math.Matrix3;return n.identity(),n.mat[6]=e,n.mat[7]=i,n},t.math.Matrix3.createByQuaternion=function(e){if(!e)return null;var i=new t.math.Matrix3,n=i.mat;return n[0]=1-2*(e.y*e.y+e.z*e.z),n[1]=2*(e.x*e.y-e.w*e.z),n[2]=2*(e.x*e.z+e.w*e.y),n[3]=2*(e.x*e.y+e.w*e.z),n[4]=1-2*(e.x*e.x+e.z*e.z),n[5]=2*(e.y*e.z-e.w*e.x),n[6]=2*(e.x*e.z-e.w*e.y),n[7]=2*(e.y*e.z+e.w*e.x),n[8]=1-2*(e.x*e.x+e.y*e.y),i},e.rotationToAxisAngle=function(){return t.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}}(n),function(t){t.math.Matrix4=function(t){this.mat=new Float32Array(t&&t.mat?t.mat:16)},t.kmMat4=t.math.Matrix4;var e=t.math.Matrix4.prototype;e.fill=function(t){for(var e=this.mat,i=0;16>i;i++)e[i]=t[i];return this},t.kmMat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},e.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},e.get=function(t,e){return this.mat[t+4*e]},e.set=function(t,e,i){this.mat[t+4*e]=i},e.swap=function(t,e,i,n){var r=this.mat,s=r[t+4*e];r[t+4*e]=r[i+4*n],r[i+4*n]=s},t.math.Matrix4._gaussj=function(t,e){var i,n,r,s,o,a,c,h,l,d=0,u=0,_=4,f=4,p=[0,0,0,0],g=[0,0,0,0],m=[0,0,0,0];for(i=0;_>i;i++){for(c=0,n=0;_>n;n++)if(1!==m[n])for(r=0;_>r;r++)0===m[r]&&(a=Math.abs(t.get(n,r)),a>=c&&(c=a,u=n,d=r));if(++m[d],u!==d){for(s=0;_>s;s++)t.swap(u,s,d,s);for(s=0;f>s;s++)e.swap(u,s,d,s)}if(g[i]=u,p[i]=d,0===t.get(d,d))return!1;for(l=1/t.get(d,d),t.set(d,d,1),s=0;_>s;s++)t.set(d,s,t.get(d,s)*l);for(s=0;f>s;s++)e.set(d,s,e.get(d,s)*l);for(o=0;_>o;o++)if(o!==d){for(h=t.get(o,d),t.set(o,d,0),s=0;_>s;s++)t.set(o,s,t.get(o,s)-t.get(d,s)*h);for(s=0;f>s;s++)e.set(o,s,t.get(o,s)-e.get(d,s)*h)}}for(s=_-1;s>=0;s--)if(g[s]!==p[s])for(r=0;_>r;r++)t.swap(r,g[s],r,p[s]);return!0};var i=(new t.math.Matrix4).identity();t.kmMat4Inverse=function(e,n){var r=new t.math.Matrix4(n),s=new t.math.Matrix4(i);return t.math.Matrix4._gaussj(r,s)===!1?null:(e.assignFrom(r),e)},e.inverse=function(){var e=new t.math.Matrix4(this),n=new t.math.Matrix4(i);return t.math.Matrix4._gaussj(e,n)===!1?null:e},e.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},e.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[4],s=t[6],o=t[7],a=t[8],c=t[9],h=t[11],l=t[12],d=t[13],u=t[14];return t[1]=r,t[2]=a,t[3]=l,t[4]=e,t[6]=c,t[7]=d,t[8]=i,t[9]=s,t[11]=u,t[12]=n,t[13]=o,t[14]=h,this},t.kmMat4Multiply=function(t,e,i){var n=t.mat,r=e.mat,s=i.mat,o=r[0],a=r[1],c=r[2],h=r[3],l=r[4],d=r[5],u=r[6],_=r[7],f=r[8],p=r[9],g=r[10],m=r[11],y=r[12],v=r[13],T=r[14],C=r[15],S=s[0],E=s[1],b=s[2],x=s[3],A=s[4],R=s[5],I=s[6],P=s[7],L=s[8],w=s[9],O=s[10],F=s[11],N=s[12],D=s[13],B=s[14],M=s[15];return n[0]=S*o+E*l+b*f+x*y,n[1]=S*a+E*d+b*p+x*v,n[2]=S*c+E*u+b*g+x*T,n[3]=S*h+E*_+b*m+x*C,n[4]=A*o+R*l+I*f+P*y,n[5]=A*a+R*d+I*p+P*v,n[6]=A*c+R*u+I*g+P*T,n[7]=A*h+R*_+I*m+P*C,n[8]=L*o+w*l+O*f+F*y,n[9]=L*a+w*d+O*p+F*v,n[10]=L*c+w*u+O*g+F*T,n[11]=L*h+w*_+O*m+F*C,n[12]=N*o+D*l+B*f+M*y,n[13]=N*a+D*d+B*p+M*v,n[14]=N*c+D*u+B*g+M*T,n[15]=N*h+D*_+B*m+M*C,t},e.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],d=e[8],u=e[9],_=e[10],f=e[11],p=e[12],g=e[13],m=e[14],y=e[15],v=i[0],T=i[1],C=i[2],S=i[3],E=i[4],b=i[5],x=i[6],A=i[7],R=i[8],I=i[9],P=i[10],L=i[11],w=i[12],O=i[13],F=i[14],N=i[15];return e[0]=v*n+T*a+C*d+S*p,e[1]=v*r+T*c+C*u+S*g,e[2]=v*s+T*h+C*_+S*m,e[3]=v*o+T*l+C*f+S*y,e[4]=E*n+b*a+x*d+A*p,e[5]=E*r+b*c+x*u+A*g,e[6]=E*s+b*h+x*_+A*m,e[7]=E*o+b*l+x*f+A*y,e[8]=R*n+I*a+P*d+L*p,e[9]=R*r+I*c+P*u+L*g,e[10]=R*s+I*h+P*_+L*m,e[11]=R*o+I*l+P*f+L*y,e[12]=w*n+O*a+F*d+N*p,e[13]=w*r+O*c+F*u+N*g,e[14]=w*s+O*h+F*_+N*m,e[15]=w*o+O*l+F*f+N*y,this},t.getMat4MultiplyValue=function(t,e){var i=t.mat,n=e.mat,r=new Float32Array(16);return r[0]=i[0]*n[0]+i[4]*n[1]+i[8]*n[2]+i[12]*n[3],r[1]=i[1]*n[0]+i[5]*n[1]+i[9]*n[2]+i[13]*n[3],r[2]=i[2]*n[0]+i[6]*n[1]+i[10]*n[2]+i[14]*n[3],r[3]=i[3]*n[0]+i[7]*n[1]+i[11]*n[2]+i[15]*n[3],r[4]=i[0]*n[4]+i[4]*n[5]+i[8]*n[6]+i[12]*n[7],r[5]=i[1]*n[4]+i[5]*n[5]+i[9]*n[6]+i[13]*n[7],r[6]=i[2]*n[4]+i[6]*n[5]+i[10]*n[6]+i[14]*n[7],r[7]=i[3]*n[4]+i[7]*n[5]+i[11]*n[6]+i[15]*n[7],r[8]=i[0]*n[8]+i[4]*n[9]+i[8]*n[10]+i[12]*n[11],r[9]=i[1]*n[8]+i[5]*n[9]+i[9]*n[10]+i[13]*n[11],r[10]=i[2]*n[8]+i[6]*n[9]+i[10]*n[10]+i[14]*n[11],r[11]=i[3]*n[8]+i[7]*n[9]+i[11]*n[10]+i[15]*n[11],r[12]=i[0]*n[12]+i[4]*n[13]+i[8]*n[14]+i[12]*n[15],r[13]=i[1]*n[12]+i[5]*n[13]+i[9]*n[14]+i[13]*n[15],r[14]=i[2]*n[12]+i[6]*n[13]+i[10]*n[14]+i[14]*n[15],r[15]=i[3]*n[12]+i[7]*n[13]+i[11]*n[14]+i[15]*n[15],r},t.kmMat4Assign=function(e,i){if(e===i)return t.log("cc.kmMat4Assign(): pOut equals pIn"),e;var n=e.mat,r=i.mat;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],e},e.assignFrom=function(e){if(this===e)return t.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix"),this;var i=this.mat,n=e.mat;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},e.equals=function(e){if(this===e)return t.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object."),!0;for(var i=this.mat,n=e.mat,r=t.math.EPSILON,s=0;16>s;s++)if(!(i[s]+r>n[s]&&i[s]-r<n[s]))return!1;return!0},t.math.Matrix4.createByRotationX=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=1,n[3]=n[2]=n[1]=0,n[4]=0,n[5]=Math.cos(e),n[6]=Math.sin(e),n[7]=0,n[8]=0,n[9]=-Math.sin(e),n[10]=Math.cos(e),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationY=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=Math.cos(e),n[1]=0,n[2]=-Math.sin(e),n[3]=0,n[7]=n[6]=n[4]=0,n[5]=1,n[8]=Math.sin(e),n[9]=0,n[10]=Math.cos(e),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationZ=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=Math.cos(e),n[1]=Math.sin(e),n[3]=n[2]=0,n[4]=-Math.sin(e),n[5]=Math.cos(e),n[7]=n[6]=0,n[11]=n[9]=n[8]=0,n[10]=1,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByPitchYawRoll=function(e,i,n,r){r=r||new t.math.Matrix4;var s=Math.cos(e),o=Math.sin(e),a=Math.cos(i),c=Math.sin(i),h=Math.cos(n),l=Math.sin(n),d=o*c,u=s*c,_=r.mat;return _[0]=a*h,_[4]=a*l,_[8]=-c,_[1]=d*h-s*l,_[5]=d*l+s*h,_[9]=o*a,_[2]=u*h+o*l,_[6]=u*l-o*h,_[10]=s*a,_[3]=_[7]=_[11]=0,_[15]=1,r},t.math.Matrix4.createByQuaternion=function(e,i){i=i||new t.math.Matrix4;var n=i.mat;return n[0]=1-2*(e.y*e.y+e.z*e.z),n[1]=2*(e.x*e.y+e.z*e.w),n[2]=2*(e.x*e.z-e.y*e.w),n[3]=0,n[4]=2*(e.x*e.y-e.z*e.w),n[5]=1-2*(e.x*e.x+e.z*e.z),n[6]=2*(e.z*e.y+e.x*e.w),n[7]=0,n[8]=2*(e.x*e.z+e.y*e.w),n[9]=2*(e.y*e.z-e.x*e.w),n[10]=1-2*(e.x*e.x+e.y*e.y),n[11]=0,n[14]=n[13]=n[12]=0,n[15]=1,i},t.math.Matrix4.createByRotationTranslation=function(e,i,n){n=n||new t.math.Matrix4;var r=n.mat,s=e.mat;return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=0,r[4]=s[3],r[5]=s[4],r[6]=s[5],r[7]=0,r[8]=s[6],r[9]=s[7],r[10]=s[8],r[11]=0,r[12]=i.x,r[13]=i.y,r[14]=i.z,r[15]=1,n},t.math.Matrix4.createByScale=function(e,i,n,r){r=r||new t.math.Matrix4;var s=r.mat;return s[0]=e,s[5]=i,s[10]=n,s[15]=1,s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[11]=s[12]=s[13]=s[14]=0,r},t.kmMat4Translation=function(t,e,i,n){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=i,t.mat[14]=n,t},t.math.Matrix4.createByTranslation=function(e,i,n,r){return r=r||new t.math.Matrix4,r.identity(),r.mat[12]=e,r.mat[13]=i,r.mat[14]=n,r},e.getUpVec3=function(){var e=this.mat,i=new t.math.Vec3(e[4],e[5],e[6]);return i.normalize()},e.getRightVec3=function(){var e=this.mat,i=new t.math.Vec3(e[0],e[1],e[2]);return i.normalize()},e.getForwardVec3=function(){var e=this.mat,i=new t.math.Vec3(e[8],e[9],e[10]);return i.normalize()},t.kmMat4PerspectiveProjection=function(e,i,n,r,s){var o=t.degreesToRadians(i/2),a=s-r,c=Math.sin(o);if(0===a||0===c||0===n)return null;var h=Math.cos(o)/c;return e.identity(),e.mat[0]=h/n,e.mat[5]=h,e.mat[10]=-(s+r)/a,e.mat[11]=-1,e.mat[14]=-2*r*s/a,e.mat[15]=0,e},t.math.Matrix4.createPerspectiveProjection=function(e,i,n,r){var s=t.degreesToRadians(e/2),o=r-n,a=Math.sin(s);

if(0===o||0===a||0===i)return null;var c=Math.cos(s)/a,h=new t.math.Matrix4,l=h.mat;return h.identity(),l[0]=c/i,l[5]=c,l[10]=-(r+n)/o,l[11]=-1,l[14]=-2*n*r/o,l[15]=0,h},t.kmMat4OrthographicProjection=function(t,e,i,n,r,s,o){return t.identity(),t.mat[0]=2/(i-e),t.mat[5]=2/(r-n),t.mat[10]=-2/(o-s),t.mat[12]=-((i+e)/(i-e)),t.mat[13]=-((r+n)/(r-n)),t.mat[14]=-((o+s)/(o-s)),t},t.math.Matrix4.createOrthographicProjection=function(e,i,n,r,s,o){var a=new t.math.Matrix4,c=a.mat;return a.identity(),c[0]=2/(i-e),c[5]=2/(r-n),c[10]=-2/(o-s),c[12]=-((i+e)/(i-e)),c[13]=-((r+n)/(r-n)),c[14]=-((o+s)/(o-s)),a},t.kmMat4LookAt=function(e,i,n,r){var s=new t.math.Vec3(n),o=new t.math.Vec3(r);s.subtract(i),s.normalize(),o.normalize();var a=new t.math.Vec3(s);a.cross(o),a.normalize();var c=new t.math.Vec3(a);c.cross(s),a.normalize(),e.identity(),e.mat[0]=a.x,e.mat[4]=a.y,e.mat[8]=a.z,e.mat[1]=c.x,e.mat[5]=c.y,e.mat[9]=c.z,e.mat[2]=-s.x,e.mat[6]=-s.y,e.mat[10]=-s.z;var h=t.math.Matrix4.createByTranslation(-i.x,-i.y,-i.z);return e.multiply(h),e};var n=new t.math.Matrix4;e.lookAt=function(e,i,r){var s=new t.math.Vec3(i),o=new t.math.Vec3(r),a=this.mat;s.subtract(e),s.normalize(),o.normalize();var c=new t.math.Vec3(s);c.cross(o),c.normalize();var h=new t.math.Vec3(c);return h.cross(s),c.normalize(),this.identity(),a[0]=c.x,a[4]=c.y,a[8]=c.z,a[1]=h.x,a[5]=h.y,a[9]=h.z,a[2]=-s.x,a[6]=-s.y,a[10]=-s.z,n=t.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z,n),this.multiply(n),this},t.kmMat4RotationAxisAngle=function(e,i,n){var r=Math.cos(n),s=Math.sin(n),o=new t.math.Vec3(i);return o.normalize(),e.mat[0]=r+o.x*o.x*(1-r),e.mat[1]=o.z*s+o.y*o.x*(1-r),e.mat[2]=-o.y*s+o.z*o.x*(1-r),e.mat[3]=0,e.mat[4]=-o.z*s+o.x*o.y*(1-r),e.mat[5]=r+o.y*o.y*(1-r),e.mat[6]=o.x*s+o.z*o.y*(1-r),e.mat[7]=0,e.mat[8]=o.y*s+o.x*o.z*(1-r),e.mat[9]=-o.x*s+o.y*o.z*(1-r),e.mat[10]=r+o.z*o.z*(1-r),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},t.math.Matrix4.createByAxisAndAngle=function(e,i,n){n=n||new t.math.Matrix4;var r=this.mat,s=Math.cos(i),o=Math.sin(i),a=new t.math.Vec3(e);return a.normalize(),r[0]=s+a.x*a.x*(1-s),r[1]=a.z*o+a.y*a.x*(1-s),r[2]=-a.y*o+a.z*a.x*(1-s),r[3]=0,r[4]=-a.z*o+a.x*a.y*(1-s),r[5]=s+a.y*a.y*(1-s),r[6]=a.x*o+a.z*a.y*(1-s),r[7]=0,r[8]=a.y*o+a.x*a.z*(1-s),r[9]=-a.x*o+a.y*a.z*(1-s),r[10]=s+a.z*a.z*(1-s),r[11]=0,r[12]=r[13]=r[14]=0,r[15]=1,n},e.extractRotation=function(){var e=new t.math.Matrix3,i=this.mat,n=e.mat;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[4],n[4]=i[5],n[5]=i[6],n[6]=i[8],n[7]=i[9],n[8]=i[10],e},e.extractPlane=function(e){var i=new t.math.Plane,n=this.mat;switch(e){case t.math.Plane.RIGHT:i.a=n[3]-n[0],i.b=n[7]-n[4],i.c=n[11]-n[8],i.d=n[15]-n[12];break;case t.math.Plane.LEFT:i.a=n[3]+n[0],i.b=n[7]+n[4],i.c=n[11]+n[8],i.d=n[15]+n[12];break;case t.math.Plane.BOTTOM:i.a=n[3]+n[1],i.b=n[7]+n[5],i.c=n[11]+n[9],i.d=n[15]+n[13];break;case t.math.Plane.TOP:i.a=n[3]-n[1],i.b=n[7]-n[5],i.c=n[11]-n[9],i.d=n[15]-n[13];break;case t.math.Plane.FAR:i.a=n[3]-n[2],i.b=n[7]-n[6],i.c=n[11]-n[10],i.d=n[15]-n[14];break;case t.math.Plane.NEAR:i.a=n[3]+n[2],i.b=n[7]+n[6],i.c=n[11]+n[10],i.d=n[15]+n[14];break;default:t.log("cc.math.Matrix4.extractPlane: Invalid plane index")}var r=Math.sqrt(i.a*i.a+i.b*i.b+i.c*i.c);return i.a/=r,i.b/=r,i.c/=r,i.d/=r,i},e.toAxisAndAngle=function(){var e=this.extractRotation(),i=t.math.Quaternion.rotationMatrix(e);return i.toAxisAndAngle()}}(n),function(t){t.math.Plane=function(t,e,i,n){t&&void 0===e?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d):(this.a=t||0,this.b=e||0,this.c=i||0,this.d=n||0)},t.kmPlane=t.math.Plane;var e=t.math.Plane.prototype;t.math.Plane.LEFT=0,t.math.Plane.RIGHT=1,t.math.Plane.BOTTOM=2,t.math.Plane.TOP=3,t.math.Plane.NEAR=4,t.math.Plane.FAR=5,t.math.Plane.POINT_INFRONT_OF_PLANE=0,t.math.Plane.POINT_BEHIND_PLANE=1,t.math.Plane.POINT_ON_PLANE=2,e.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w},e.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},e.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z},t.math.Plane.fromPointNormal=function(e,i){return new t.math.Plane(i.x,i.y,i.z,-i.dot(e))},t.math.Plane.fromPoints=function(e,i,n){var r=new t.math.Vec3(i),s=new t.math.Vec3(n),o=new t.math.Plane;return r.subtract(e),s.subtract(e),r.cross(s),r.normalize(),o.a=r.x,o.b=r.y,o.c=r.z,o.d=r.scale(-1).dot(e),o},e.normalize=function(){var e=new t.math.Vec3(this.a,this.b,this.c),i=1/e.length();return e.normalize(),this.a=e.x,this.b=e.y,this.c=e.z,this.d=this.d*i,this},e.classifyPoint=function(e){var i=this.a*e.x+this.b*e.y+this.c*e.z+this.d;return i>.001?t.math.Plane.POINT_INFRONT_OF_PLANE:-.001>i?t.math.Plane.POINT_BEHIND_PLANE:t.math.Plane.POINT_ON_PLANE}}(n),function(t){t.math.Quaternion=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)},t.kmQuaternion=t.math.Quaternion;var e=t.math.Quaternion.prototype;e.conjugate=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this},e.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},e.exponential=function(){return this},e.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},e.inverse=function(){var e=this.length();return Math.abs(e)>t.math.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0,this):(this.conjugate(this).scale(1/e),this)},e.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w},e.length=function(){return Math.sqrt(this.lengthSq())},e.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return this.w=r*t.w-e*t.x-i*t.y-n*t.z,this.x=r*t.x+e*t.w+i*t.z-n*t.y,this.y=r*t.y+i*t.w+n*t.x-e*t.z,this.z=r*t.z+n*t.w+e*t.y-i*t.x,this},e.normalize=function(){var e=this.length();if(Math.abs(e)<=t.math.EPSILON)throw new Error("current quaternion is an invalid value");return this.scale(1/e),this},e.rotationAxis=function(t,e){var i=.5*e,n=Math.sin(i);return this.w=Math.cos(i),this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this},t.math.Quaternion.rotationMatrix=function(e){if(!e)return null;var i,n,r,s,o=[],a=e.mat,c=0;o[0]=a[0],o[1]=a[3],o[2]=a[6],o[4]=a[1],o[5]=a[4],o[6]=a[7],o[8]=a[2],o[9]=a[5],o[10]=a[8],o[15]=1;var h=o[0],l=h[0]+h[5]+h[10]+1;return l>t.math.EPSILON?(c=2*Math.sqrt(l),i=(h[9]-h[6])/c,n=(h[2]-h[8])/c,r=(h[4]-h[1])/c,s=.25*c):h[0]>h[5]&&h[0]>h[10]?(c=2*Math.sqrt(1+h[0]-h[5]-h[10]),i=.25*c,n=(h[4]+h[1])/c,r=(h[2]+h[8])/c,s=(h[9]-h[6])/c):h[5]>h[10]?(c=2*Math.sqrt(1+h[5]-h[0]-h[10]),i=(h[4]+h[1])/c,n=.25*c,r=(h[9]+h[6])/c,s=(h[2]-h[8])/c):(c=2*Math.sqrt(1+h[10]-h[0]-h[5]),i=(h[2]+h[8])/c,n=(h[9]+h[6])/c,r=.25*c,s=(h[4]-h[1])/c),new t.math.Quaternion(i,n,r,s)},t.math.Quaternion.rotationYawPitchRoll=function(e,i,n){var r,s,o,a,c,h,l,d,u,_,f;r=t.degreesToRadians(i)/2,s=t.degreesToRadians(e)/2,o=t.degreesToRadians(n)/2,a=Math.cos(r),c=Math.cos(s),h=Math.cos(o),l=Math.sin(r),d=Math.sin(s),u=Math.sin(o),_=c*h,f=d*u;var p=new t.math.Quaternion;return p.w=a*_+l*f,p.x=l*_-a*f,p.y=a*d*h+l*c*u,p.z=a*c*u-l*d*h,p.normalize(),p},e.slerp=function(e,i){if(this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w)return this;var n=this.dot(e),r=Math.acos(n),s=Math.sqrt(1-t.math.square(n)),o=Math.sin(i*r)/s,a=Math.sin((1-i)*r)/s,c=new t.math.Quaternion(e);return this.scale(a),c.scale(o),this.add(c),this},e.toAxisAndAngle=function(){var e,i,n,r=new t.math.Vec3;return e=Math.acos(this.w),i=Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)),i>-t.math.EPSILON&&i<t.math.EPSILON||i<2*Math.PI+t.math.EPSILON&&i>2*Math.PI-t.math.EPSILON?(n=0,r.x=0,r.y=0,r.z=1):(n=2*e,r.x=this.x/i,r.y=this.y/i,r.z=this.z/i,r.normalize()),{axis:r,angle:n}},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.math.Quaternion.rotationBetweenVec3=function(e,i,n){var r=new t.math.Vec3(e),s=new t.math.Vec3(i);r.normalize(),s.normalize();var o=r.dot(s),a=new t.math.Quaternion;if(o>=1)return a.identity(),a;if(1e-6-1>o)if(Math.abs(n.lengthSq())<t.math.EPSILON)a.rotationAxis(n,Math.PI);else{var c=new t.math.Vec3(1,0,0);c.cross(e),Math.abs(c.lengthSq())<t.math.EPSILON&&(c.fill(0,1,0),c.cross(e)),c.normalize(),a.rotationAxis(c,Math.PI)}else{var h=Math.sqrt(2*(1+o)),l=1/h;r.cross(s),a.x=r.x*l,a.y=r.y*l,a.z=r.z*l,a.w=.5*h,a.normalize()}return a},e.multiplyVec3=function(e){var i=this.x,n=this.y,r=this.z,s=new t.math.Vec3(e),o=new t.math.Vec3(i,n,r),a=new t.math.Vec3(i,n,r);return o.cross(e),a.cross(o),o.scale(2*q.w),a.scale(2),s.add(o),s.add(a),s}}(n),n.math.AABB=function(t,e){this.min=t||new n.math.Vec3,this.max=e||new n.math.Vec3},n.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},n.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z},n.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)},n.math.AABB.assign=function(t,e){return t.min.assignFrom(e.min),t.max.assignFrom(e.max),t},function(t){t.math.Matrix4Stack=function(t,e){this.top=t,this.stack=e||[]},t.km_mat4_stack=t.math.Matrix4Stack;var e=t.math.Matrix4Stack.prototype;e.initialize=function(){this.stack.length=0,this.top=null},t.km_mat4_stack_push=function(e,i){e.stack.push(e.top),e.top=new t.math.Matrix4(i)},t.km_mat4_stack_pop=function(t,e){t.top=t.stack.pop()},t.km_mat4_stack_release=function(t){t.stack=null,t.top=null},e.push=function(e){e=e||this.top,this.stack.push(this.top),this.top=new t.math.Matrix4(e)},e.pop=function(){this.top=this.stack.pop()},e.release=function(){this.stack=null,this.top=null,this._matrixPool=null},e._getFromPool=function(e){var i=this._matrixPool;if(0===i.length)return new t.math.Matrix4(e);var n=i.pop();return n.assignFrom(e),n},e._putInPool=function(t){this._matrixPool.push(t)}}(n),function(t){t.KM_GL_MODELVIEW=5888,t.KM_GL_PROJECTION=5889,t.KM_GL_TEXTURE=5890,t.modelview_matrix_stack=new t.math.Matrix4Stack,t.projection_matrix_stack=new t.math.Matrix4Stack,t.texture_matrix_stack=new t.math.Matrix4Stack,t.current_stack=null;var e=!1;t.lazyInitialize=function(){if(!e){var i=new t.math.Matrix4;t.modelview_matrix_stack.initialize(),t.projection_matrix_stack.initialize(),t.texture_matrix_stack.initialize(),t.current_stack=t.modelview_matrix_stack,t.initialized=!0,i.identity(),t.modelview_matrix_stack.push(i),t.projection_matrix_stack.push(i),t.texture_matrix_stack.push(i)}},t.lazyInitialize(),t.kmGLFreeAll=function(){t.modelview_matrix_stack.release(),t.modelview_matrix_stack=null,t.projection_matrix_stack.release(),t.projection_matrix_stack=null,t.texture_matrix_stack.release(),t.texture_matrix_stack=null,t.initialized=!1,t.current_stack=null},t.kmGLPushMatrix=function(){t.current_stack.push(t.current_stack.top)},t.kmGLPushMatrixWitMat4=function(e){t.current_stack.stack.push(t.current_stack.top),e.assignFrom(t.current_stack.top),t.current_stack.top=e},t.kmGLPopMatrix=function(){t.current_stack.top=t.current_stack.stack.pop()},t.kmGLMatrixMode=function(e){switch(e){case t.KM_GL_MODELVIEW:t.current_stack=t.modelview_matrix_stack;break;case t.KM_GL_PROJECTION:t.current_stack=t.projection_matrix_stack;break;case t.KM_GL_TEXTURE:t.current_stack=t.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},t.kmGLLoadIdentity=function(){t.current_stack.top.identity()},t.kmGLLoadMatrix=function(e){t.current_stack.top.assignFrom(e)},t.kmGLMultMatrix=function(e){t.current_stack.top.multiply(e)};var i=new t.math.Matrix4;t.kmGLTranslatef=function(e,n,r){var s=t.math.Matrix4.createByTranslation(e,n,r,i);t.current_stack.top.multiply(s)};var n=new t.math.Vec3;t.kmGLRotatef=function(e,r,s,o){n.fill(r,s,o);var a=t.math.Matrix4.createByAxisAndAngle(n,t.degreesToRadians(e),i);t.current_stack.top.multiply(a)},t.kmGLScalef=function(e,n,r){var s=t.math.Matrix4.createByScale(e,n,r,i);t.current_stack.top.multiply(s)},t.kmGLGetMatrix=function(e,i){switch(e){case t.KM_GL_MODELVIEW:i.assignFrom(t.modelview_matrix_stack.top);break;case t.KM_GL_PROJECTION:i.assignFrom(t.projection_matrix_stack.top);break;case t.KM_GL_TEXTURE:i.assignFrom(t.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}}(n),n.SHADER_POSITION_UCOLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()                              \n{ \n    gl_FragColor = v_fragmentColor;      \n}\n",n.SHADER_POSITION_UCOLOR_VERT="attribute vec4 a_position;\nuniform    vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor; \nvoid main(void)   \n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize = u_pointSize;          \n    v_fragmentColor = u_color;           \n}",n.SHADER_POSITION_COLOR_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvoid main() \n{ \n     gl_FragColor = v_fragmentColor; \n} ",n.SHADER_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;             \n}",n.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG="// #extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()	\n{ \n// #if defined GL_OES_standard_derivatives	\n// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n// #else	\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord)); \n// #endif \n}",n.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT="attribute mediump vec4 a_position; \nattribute mediump vec2 a_texcoord; \nattribute mediump vec4 a_color;	\nvarying mediump vec4 v_color; \nvarying mediump vec2 v_texcoord;	\nvoid main() \n{ \n     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n     v_texcoord = a_texcoord; \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n}",n.SHADER_POSITION_TEXTURE_FRAG="precision lowp float;   \nvarying vec2 v_texCoord;  \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n}",n.SHADER_POSITION_TEXTURE_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;               \n}",n.SHADER_POSITION_TEXTURE_UCOLOR_FRAG="precision lowp float;  \nuniform vec4 u_color; \nvarying vec2 v_texCoord; \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}",n.SHADER_POSITION_TEXTURE_UCOLOR_VERT="attribute vec4 a_position;\nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;                 \n}",n.SHADER_POSITION_TEXTURE_A8COLOR_FRAG="precision lowp float;  \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    ); \n}",n.SHADER_POSITION_TEXTURE_A8COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",n.SHADER_POSITION_TEXTURE_COLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n}",n.SHADER_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",n.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG="precision lowp float;   \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord;   \nuniform float CC_alpha_value; \nvoid main() \n{  \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);  \n    if ( texColor.a <= CC_alpha_value )          \n        discard; \n    gl_FragColor = texColor * v_fragmentColor;  \n}",n.SHADEREX_SWITCHMASK_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform sampler2D u_texture;  \nuniform sampler2D   u_mask;   \nvoid main()  \n{  \n    vec4 texColor   = texture2D(u_texture, v_texCoord);  \n    vec4 maskColor  = texture2D(u_mask, v_texCoord); \n    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    = v_fragmentColor * finalColor; \n}",n.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_MAX:8,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case this.TYPE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.SHADER_POSITION_TEXTURE_COLOR_VERT,n.SHADER_POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(n.SHADER_POSITION_TEXTURE_COLOR_VERT,n.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_COLOR:t.initWithVertexShaderByteArray(n.SHADER_POSITION_COLOR_VERT,n.SHADER_POSITION_COLOR_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR);break;case this.TYPE_POSITION_TEXTURE:t.initWithVertexShaderByteArray(n.SHADER_POSITION_TEXTURE_VERT,n.SHADER_POSITION_TEXTURE_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(n.SHADER_POSITION_TEXTURE_UCOLOR_VERT,n.SHADER_POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_A8COLOR:t.initWithVertexShaderByteArray(n.SHADER_POSITION_TEXTURE_A8COLOR_VERT,n.SHADER_POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_UCOLOR:t.initWithVertexShaderByteArray(n.SHADER_POSITION_UCOLOR_VERT,n.SHADER_POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",n.VERTEX_ATTRIB_POSITION);break;case this.TYPE_POSITION_LENGTH_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,n.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR);break;default:return void n.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type")}t.link(),t.updateUniforms()},loadDefaultShaders:function(){var t=new n.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),this._programs[n.SHADER_POSITION_TEXTURECOLOR]=t,this._programs.ShaderPositionTextureColor=t,t=new n.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[n.SHADER_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderPositionTextureColorAlphaTest=t,t=new n.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),this._programs[n.SHADER_POSITION_COLOR]=t,this._programs.ShaderPositionColor=t,t=new n.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),this._programs[n.SHADER_POSITION_TEXTURE]=t,this._programs.ShaderPositionTexture=t,t=new n.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),this._programs[n.SHADER_POSITION_TEXTURE_UCOLOR]=t,this._programs.ShaderPositionTextureUColor=t,t=new n.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),this._programs[n.SHADER_POSITION_TEXTUREA8COLOR]=t,this._programs.ShaderPositionTextureA8Color=t,t=new n.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR),this._programs[n.SHADER_POSITION_UCOLOR]=t,this._programs.ShaderPositionUColor=t,t=new n.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_LENGTH_TEXTURECOLOR),this._programs[n.SHADER_POSITION_LENGTHTEXTURECOLOR]=t,this._programs.ShaderPositionLengthTextureColor=t},reloadDefaultShaders:function(){var t=this.programForKey(n.SHADER_POSITION_TEXTURECOLOR);t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),t=this.programForKey(n.SHADER_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(n.SHADER_POSITION_COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),t=this.programForKey(n.SHADER_POSITION_TEXTURE),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),t=this.programForKey(n.SHADER_POSITION_TEXTURE_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),t=this.programForKey(n.SHADER_POSITION_TEXTUREA8COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),t=this.programForKey(n.SHADER_POSITION_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR)},programForKey:function(t){return this._programs[t]},getProgram:function(t){return this._programs[t]},addProgram:function(t,e){this._programs[e]=t}},n.HashUniformEntry=function(t,e,i){this.value=t,this.location=e,this.hh=i||{}},n.GLProgram=n._Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(t,e,i){if(null==t)return!1;for(var r=!0,s=null,o=0;o<this._hashForUniforms.length;o++)this._hashForUniforms[o].location==t&&(s=this._hashForUniforms[o]);return s?s.value==e?r=!1:s.value=e:(s=new n.HashUniformEntry,s.location=t,s.value=e,this._hashForUniforms.push(s)),r},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){if(!i||!t)return!1;var r=n.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n";i=r+"uniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \nuniform sampler2D CC_Texture0;   \n//CC INCLUDES END                \n"+i,this._glContext.shaderSource(t,i),this._glContext.compileShader(t);var s=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS);return s||(n.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(t)),n.log(e===this._glContext.VERTEX_SHADER?"cocos2d: \n"+this.vertexShaderLog():"cocos2d: \n"+this.fragmentShaderLog())),s===!0},ctor:function(t,e,i){this._uniforms=[],this._hashForUniforms=[],this._glContext=i||n._renderContext,t&&e&&this.init(t,e)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var i=this._glContext;return this._programObj=i.createProgram(),this._vertShader=null,this._fragShader=null,t&&(this._vertShader=i.createShader(i.VERTEX_SHADER),this._compileShader(this._vertShader,i.VERTEX_SHADER,t)||n.log("cocos2d: ERROR: Failed to compile vertex shader")),e&&(this._fragShader=i.createShader(i.FRAGMENT_SHADER),this._compileShader(this._fragShader,i.FRAGMENT_SHADER,e)||n.log("cocos2d: ERROR: Failed to compile fragment shader")),this._vertShader&&i.attachShader(this._programObj,this._vertShader),n.checkGLErrorDebug(),this._fragShader&&i.attachShader(this._programObj,this._fragShader),this._hashForUniforms.length=0,n.checkGLErrorDebug(),!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=n.loader.getRes(t);if(!i)throw new Error("Please load the resource firset : "+t);var r=n.loader.getRes(e);if(!r)throw new Error("Please load the resource firset : "+e);return this.initWithVertexShaderByteArray(i,r)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){if(!this._programObj)return n.log("cc.GLProgram.link(): Cannot link invalid program"),!1;if(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null,n.game.config[n.game.CONFIG_KEY.debugMode]){var t=this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS);if(!t)return n.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),n.glDeleteProgram(this._programObj),this._programObj=null,!1}return!0},use:function(){n.glUseProgram(this._programObj)},updateUniforms:function(){this._uniforms[n.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_PMATRIX_S),this._uniforms[n.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_MVMATRIX_S),this._uniforms[n.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_MVPMATRIX_S),this._uniforms[n.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_TIME_S),this._uniforms[n.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_SINTIME_S),this._uniforms[n.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_COSTIME_S),this._usesTime=null!=this._uniforms[n.UNIFORM_TIME]||null!=this._uniforms[n.UNIFORM_SINTIME]||null!=this._uniforms[n.UNIFORM_COSTIME],this._uniforms[n.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_RANDOM01_S),this._uniforms[n.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[n.UNIFORM_SAMPLER],0)},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");return this._glContext.getUniformLocation(this._programObj,t)},getUniformMVPMatrix:function(){return this._uniforms[n.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[n.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(t,e){var i=this._updateUniformLocation(t,e);i&&this._glContext.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){var n=[e,i],r=this._updateUniformLocation(t,n);r&&this._glContext.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,n){var r=[e,i,n],s=this._updateUniformLocation(t,r);s&&this._glContext.uniform3i(t,e,i,n)},setUniformLocationWith4i:function(t,e,i,n,r){var s=[e,i,n,r],o=this._updateUniformLocation(t,s);o&&this._glContext.uniform4i(t,e,i,n,r)},setUniformLocationWith2iv:function(t,e,i){var n=this._updateUniformLocation(t,e);n&&this._glContext.uniform2iv(t,e)},setUniformLocationWith3iv:function(t,e,i){var n=this._updateUniformLocation(t,e);n&&this._glContext.uniform3iv(t,e)},setUniformLocationWith4iv:function(t,e,i){var n=this._updateUniformLocation(t,e);n&&this._glContext.uniform4iv(t,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(arguments[0],arguments[1])},setUniformLocationWith1f:function(t,e){var i=this._updateUniformLocation(t,e);i&&this._glContext.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){var n=[e,i],r=this._updateUniformLocation(t,n);r&&this._glContext.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,n){var r=[e,i,n],s=this._updateUniformLocation(t,r);s&&this._glContext.uniform3f(t,e,i,n)},setUniformLocationWith4f:function(t,e,i,n,r){var s=[e,i,n,r],o=this._updateUniformLocation(t,s);o&&this._glContext.uniform4f(t,e,i,n,r)},setUniformLocationWith2fv:function(t,e,i){var n=this._updateUniformLocation(t,e);n&&this._glContext.uniform2fv(t,e)},setUniformLocationWith3fv:function(t,e,i){var n=this._updateUniformLocation(t,e);n&&this._glContext.uniform3fv(t,e)},setUniformLocationWith4fv:function(t,e,i){var n=this._updateUniformLocation(t,e);n&&this._glContext.uniform4fv(t,e)},setUniformLocationWithMatrix4fv:function(t,e,i){var n=this._updateUniformLocation(t,e);n&&this._glContext.uniformMatrix4fv(t,!1,e)},setUniformLocationF32:function(){if(!(arguments.length<2))switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},setUniformsForBuiltins:function(){var t=new n.math.Matrix4,e=new n.math.Matrix4,i=new n.math.Matrix4;if(n.kmGLGetMatrix(n.KM_GL_PROJECTION,t),n.kmGLGetMatrix(n.KM_GL_MODELVIEW,e),n.kmMat4Multiply(i,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var r=n.director,s=r.getTotalFrames()*r.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_TIME],s/10,s,2*s,4*s),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_SINTIME],s/8,s/4,s/2,Math.sin(s)),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_COSTIME],s/8,s/4,s/2,Math.cos(s))}-1!==this._uniforms[n.UNIFORM_RANDOM01]&&this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(t&&t._renderCmd){var e=new n.math.Matrix4,i=new n.math.Matrix4;if(n.kmGLGetMatrix(n.KM_GL_PROJECTION,e),n.kmMat4Multiply(i,e,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var r=n.director,s=r.getTotalFrames()*r.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_TIME],s/10,s,2*s,4*s),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_SINTIME],s/8,s/4,s/2,Math.sin(s)),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_COSTIME],s/8,s/4,s/2,Math.cos(s))}-1!==this._uniforms[n.UNIFORM_RANDOM01]&&this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random());

}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],!1,n.getMat4MultiplyValue(n.projection_matrix_stack.top,n.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){n.kmMat4Multiply(t,n.projection_matrix_stack.top,n.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],!1,n.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,n.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,n.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var t=0;t<this._hashForUniforms.length;t++)this._hashForUniforms[t].value=null,this._hashForUniforms[t]=null;this._hashForUniforms.length=0},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),n.GLProgram.create=function(t,e){return new n.GLProgram(t,e)},n.GLProgram._highpSupported=null,n.GLProgram._isHighpSupported=function(){if(null==n.GLProgram._highpSupported){var t=n._renderContext,e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);n.GLProgram._highpSupported=0!==e.precision}return n.GLProgram._highpSupported},n.setProgram=function(t,e){t.shaderProgram=e;var i=t.children;if(i)for(var r=0;r<i.length;r++)n.setProgram(i[r],e)},n._currentProjectionMatrix=-1,n._vertexAttribPosition=!1,n._vertexAttribColor=!1,n._vertexAttribTexCoords=!1,n.ENABLE_GL_STATE_CACHE&&(n.MAX_ACTIVETEXTURE=16,n._currentShaderProgram=-1,n._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],n._blendingSource=-1,n._blendingDest=-1,n._GLServerState=0,n.TEXTURE_ATLAS_USE_VAO&&(n._uVAO=0)),n.glInvalidateStateCache=function(){if(n.kmGLFreeAll(),n._currentProjectionMatrix=-1,n._vertexAttribPosition=!1,n._vertexAttribColor=!1,n._vertexAttribTexCoords=!1,n.ENABLE_GL_STATE_CACHE){n._currentShaderProgram=-1;for(var t=0;t<n.MAX_ACTIVETEXTURE;t++)n._currentBoundTexture[t]=-1;n._blendingSource=-1,n._blendingDest=-1,n._GLServerState=0}},n.glUseProgram=function(t){t!==n._currentShaderProgram&&(n._currentShaderProgram=t,n._renderContext.useProgram(t))},n.ENABLE_GL_STATE_CACHE||(n.glUseProgram=function(t){n._renderContext.useProgram(t)}),n.glDeleteProgram=function(t){n.ENABLE_GL_STATE_CACHE&&t===n._currentShaderProgram&&(n._currentShaderProgram=-1),gl.deleteProgram(t)},n.glBlendFunc=function(t,e){(t!==n._blendingSource||e!==n._blendingDest)&&(n._blendingSource=t,n._blendingDest=e,n.setBlending(t,e))},n.setBlending=function(t,e){var i=n._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),n._renderContext.blendFunc(t,e))},n.glBlendFuncForParticle=function(t,e){if(t!==n._blendingSource||e!==n._blendingDest){n._blendingSource=t,n._blendingDest=e;var i=n._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,e,t,e))}},n.ENABLE_GL_STATE_CACHE||(n.glBlendFunc=n.setBlending),n.glBlendResetToCache=function(){var t=n._renderContext;t.blendEquation(t.FUNC_ADD),n.ENABLE_GL_STATE_CACHE?n.setBlending(n._blendingSource,n._blendingDest):n.setBlending(t.BLEND_SRC,t.BLEND_DST)},n.setProjectionMatrixDirty=function(){n._currentProjectionMatrix=-1},n.glEnableVertexAttribs=function(t){var e=n._renderContext,i=t&n.VERTEX_ATTRIB_FLAG_POSITION;i!==n._vertexAttribPosition&&(i?e.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION):e.disableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),n._vertexAttribPosition=i);var r=t&n.VERTEX_ATTRIB_FLAG_COLOR;r!==n._vertexAttribColor&&(r?e.enableVertexAttribArray(n.VERTEX_ATTRIB_COLOR):e.disableVertexAttribArray(n.VERTEX_ATTRIB_COLOR),n._vertexAttribColor=r);var s=t&n.VERTEX_ATTRIB_FLAG_TEX_COORDS;s!==n._vertexAttribTexCoords&&(s?e.enableVertexAttribArray(n.VERTEX_ATTRIB_TEX_COORDS):e.disableVertexAttribArray(n.VERTEX_ATTRIB_TEX_COORDS),n._vertexAttribTexCoords=s)},n.glBindTexture2D=function(t){n.glBindTexture2DN(0,t)},n.glBindTexture2DN=function(t,e){if(n._currentBoundTexture[t]!==e){n._currentBoundTexture[t]=e;var i=n._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)}},n.ENABLE_GL_STATE_CACHE||(n.glBindTexture2DN=function(t,e){var i=n._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)}),n.glDeleteTexture=function(t){n.glDeleteTextureN(0,t)},n.glDeleteTextureN=function(t,e){n.ENABLE_GL_STATE_CACHE&&e===n._currentBoundTexture[t]&&(n._currentBoundTexture[t]=-1),n._renderContext.deleteTexture(e)},n.glBindVAO=function(t){n.TEXTURE_ATLAS_USE_VAO&&n.ENABLE_GL_STATE_CACHE&&n._uVAO!==t&&(n._uVAO=t)},n.glEnable=function(t){n.ENABLE_GL_STATE_CACHE},n.IMAGE_FORMAT_JPEG=0,n.IMAGE_FORMAT_PNG=1,n.IMAGE_FORMAT_RAWDATA=9,n.NextPOT=function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t+1},n.RenderTexture=_ccsg.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,e,i,r){_ccsg.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._pixelFormat=n.Texture2D.PIXEL_FORMAT_RGBA8888,this._clearColor=new n.Color(0,0,0,255),void 0!==t&&void 0!==e&&(i=i||n.Texture2D.PIXEL_FORMAT_RGBA8888,r=r||0,this.initWithWidthAndHeight(t,e,i,r)),this.setAnchorPoint(0,0)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.RenderTexture.CanvasRenderCmd(this):new n.RenderTexture.WebGLRenderCmd(this)},cleanup:function(){_ccsg.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,e,i){this._renderCmd.setVirtualViewport(t,e,i)},initWithWidthAndHeight:function(t,e,i,n){return this._renderCmd.initWithWidthAndHeight(t,e,i,n)},begin:function(){n.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(t,e,i,r,s,o){var a=n._renderContext;s=s||a.COLOR_BUFFER_BIT,o=o||a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT,this._beginWithClear(t,e,i,r,s,o,a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,e,i,n,r,s,o){this.begin(),this._renderCmd._beginWithClear(t,e,i,n,r,s,o)},end:function(){this._renderCmd.end()},clear:function(t,e,i,n){this.beginWithClear(t,e,i,n),this.end()},clearRect:function(t,e,i,n){this._renderCmd.clearRect(t,e,i,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var e=this._clearColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(t,e){n.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(t){return n.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(t){},listenToForeground:function(t){}});var c=n.RenderTexture.prototype;c.clearColorVal,n.defineGetterSetter(c,"clearColorVal",c.getClearColor,c.setClearColor),n.RenderTexture.create=function(t,e,i,r){return new n.RenderTexture(t,e,i,r)},function(){n.RenderTexture.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=document.createElement("canvas"),this._cacheContext=new n.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var t=n.RenderTexture.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.RenderTexture.CanvasRenderCmd,t.cleanup=function(){this._cacheContext=null,this._cacheCanvas=null},t.clearStencil=function(t){},t.setVirtualViewport=function(t,e,i){},t.updateClearColor=function(t){this._clearColorStr="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")"},t.initWithWidthAndHeight=function(t,e,i,r){var s=this._node,o=this._cacheCanvas,a=n.contentScaleFactor();o.width=0|t*a,o.height=0|e*a;var c=new n.Texture2D;c.initWithElement(o),c.handleLoadedTexture();var h=s.sprite=new n.Sprite(c);return h.setBlendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),s.autoDraw=!1,s.addChild(h),!0},t.begin=function(){},t._beginWithClear=function(t,e,i,n,r,s,o){t=t||0,e=e||0,i=i||0,n=isNaN(n)?255:n;var a=this._cacheContext.getContext(),c=this._cacheCanvas;a.setTransform(1,0,0,1,0,0),this._cacheContext.setFillStyle("rgba("+(0|t)+","+(0|e)+","+(0|i)+","+n/255+")"),a.clearRect(0,0,c.width,c.height),a.fillRect(0,0,c.width,c.height)},t.end=function(){var t=this._node,e=n.contentScaleFactor();n.renderer._renderingToCacheCanvas(this._cacheContext,t.__instanceId,e,e)},t.clearRect=function(t,e,i,n){this._cacheContext.clearRect(t,e,i,-n)},t.clearDepth=function(t){n.log("clearDepth isn't supported on Cocos2d-Html5")},t.visit=function(t){var e=this._node;this._syncStatus(t),e.sprite.visit(this),this._dirtyFlag=0}}(),function(){n.RenderTexture.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._fBO=null,this._oldFBO=null,this._textureCopy=null,this._depthRenderBuffer=null,this._rtTextureRect=new n.Rect,this._fullRect=new n.Rect,this._fullViewport=new n.Rect};var t=n.RenderTexture.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.RenderTexture.WebGLRenderCmd,t.setVirtualViewport=function(t,e,i){this._rtTextureRect.x=t.x,this._rtTextureRect.y=t.y,this._fullRect=e,this._fullViewport=i},t.rendering=function(t){var e=t||n._renderContext,i=this._node;if(i.autoDraw){i.begin();var r=i.clearFlags;if(r){var s=[0,0,0,0],o=0,a=0;r&e.COLOR_BUFFER_BIT&&(s=e.getParameter(e.COLOR_CLEAR_VALUE),e.clearColor(i._clearColor.r/255,i._clearColor.g/255,i._clearColor.b/255,i._clearColor.a/255)),r&e.DEPTH_BUFFER_BIT&&(o=e.getParameter(e.DEPTH_CLEAR_VALUE),e.clearDepth(i.clearDepthVal)),r&e.STENCIL_BUFFER_BIT&&(a=e.getParameter(e.STENCIL_CLEAR_VALUE),e.clearStencil(i.clearStencilVal)),e.clear(r),r&e.COLOR_BUFFER_BIT&&e.clearColor(s[0],s[1],s[2],s[3]),r&e.DEPTH_BUFFER_BIT&&e.clearDepth(o),r&e.STENCIL_BUFFER_BIT&&e.clearStencil(a)}i.sortAllChildren();for(var c=i._children,h=0;h<c.length;h++){var l=c[h];l!==i.sprite&&l._renderCmd.visit(i.sprite._renderCmd)}i.end()}},t.clearStencil=function(t){var e=n._renderContext,i=e.getParameter(e.STENCIL_CLEAR_VALUE);e.clearStencil(t),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(i)},t.cleanup=function(){this._node;this._textureCopy=null;var t=n._renderContext;t.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer)},t.updateClearColor=function(t){},t.initWithWidthAndHeight=function(t,e,i,r){var s=this._node;i===n.Texture2D.PIXEL_FORMAT_A8&&n.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var o=n._renderContext,a=n.contentScaleFactor();this._fullRect=new n.Rect(0,0,t,e),this._fullViewport=new n.Rect(0,0,t,e),t=0|t*a,e=0|e*a,this._oldFBO=o.getParameter(o.FRAMEBUFFER_BINDING);var c,h;n.configuration.supportsNPOT()?(c=t,h=e):(c=n.NextPOT(t),h=n.NextPOT(e));for(var l=c*h*4,d=new Uint8Array(l),u=0;c*h*4>u;u++)d[u]=0;this._pixelFormat=i;var _=s._texture=new n.Texture2D;if(!s._texture)return!1;_.initWithData(d,s._pixelFormat,c,h,n.size(t,e));var f=o.getParameter(o.RENDERBUFFER_BINDING);if(n.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new n.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(d,s._pixelFormat,c,h,n.size(t,e))}this._fBO=o.createFramebuffer(),o.bindFramebuffer(o.FRAMEBUFFER,this._fBO),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,_._webTextureObj,0),0!==r&&(this._depthRenderBuffer=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,this._depthRenderBuffer),o.renderbufferStorage(o.RENDERBUFFER,r,c,h),r===o.DEPTH_STENCIL?o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer):r===o.STENCIL_INDEX||r===o.STENCIL_INDEX8?o.framebufferRenderbuffer(o.FRAMEBUFFER,o.STENCIL_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer):r===o.DEPTH_COMPONENT16&&o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer)),o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&n.log("Could not attach texture to the framebuffer"),_.setAliasTexParameters();var p=s.sprite=new n.Sprite(_);return p.scaleY=-1,p.setBlendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.bindRenderbuffer(o.RENDERBUFFER,f),o.bindFramebuffer(o.FRAMEBUFFER,this._oldFBO),s.autoDraw=!1,s.addChild(p),!0},t.begin=function(){var t=this._node;n.kmGLMatrixMode(n.KM_GL_PROJECTION),n.kmGLPushMatrix(),n.kmGLMatrixMode(n.KM_GL_MODELVIEW),n.kmGLPushMatrix();var e=n._renderContext,i=n.director;i.setProjection(i.getProjection());var r=t._texture.getContentSizeInPixels(),s=n.director.getWinSizeInPixels(),o=s.width/r.width,a=s.height/r.height,c=n.math.Matrix4.createOrthographicProjection(-1/o,1/o,-1/a,1/a,-1,1);n.kmGLMultMatrix(c);var h=new n.Rect(0,0,0,0);h.width=this._fullViewport.width,h.height=this._fullViewport.height;var l=h.width/this._fullRect.width,d=h.height/this._fullRect.height;h.x=(this._fullRect.x-this._rtTextureRect.x)*l,h.y=(this._fullRect.y-this._rtTextureRect.y)*d,e.viewport(h.x,h.y,h.width,h.height),this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this._fBO),n.configuration.checkForGLExtension("GL_QCOM")&&(e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._textureCopy._webTextureObj,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._texture._webTextureObj,0))},t._beginWithClear=function(t,e,i,r,s,o,a){t/=255,e/=255,i/=255,r/=255;var c=n._renderContext,h=[0,0,0,0],l=0,d=0;a&c.COLOR_BUFFER_BIT&&(h=c.getParameter(c.COLOR_CLEAR_VALUE),c.clearColor(t,e,i,r)),a&c.DEPTH_BUFFER_BIT&&(l=c.getParameter(c.DEPTH_CLEAR_VALUE),c.clearDepth(s)),a&c.STENCIL_BUFFER_BIT&&(d=c.getParameter(c.STENCIL_CLEAR_VALUE),c.clearStencil(o)),c.clear(a),a&c.COLOR_BUFFER_BIT&&c.clearColor(h[0],h[1],h[2],h[3]),a&c.DEPTH_BUFFER_BIT&&c.clearDepth(l),a&c.STENCIL_BUFFER_BIT&&c.clearStencil(d)},t.end=function(){var t=this._node;n.renderer._renderingToBuffer(t.__instanceId);var e=n._renderContext,i=n.director;e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO),i.setViewport(),n.kmGLMatrixMode(n.KM_GL_PROJECTION),n.kmGLPopMatrix(),n.kmGLMatrixMode(n.KM_GL_MODELVIEW),n.kmGLPopMatrix()},t.clearRect=function(t,e,i,n){},t.clearDepth=function(t){var e=this._node;e.begin();var i=n._renderContext,r=i.getParameter(i.DEPTH_CLEAR_VALUE);i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT),i.clearDepth(r),e.end()},t.visit=function(t){var e=this._node;e._visible&&(n.kmGLPushMatrix(),this._syncStatus(t),n.renderer.pushRenderCommand(this),e.sprite.visit(this),this._dirtyFlag=0,n.kmGLPopMatrix())}}();var _=t("../cocos2d/core/event/event-target");n.FontLetterDefinition=function(){this._u=0,this._v=0,this._width=0,this._height=0,this._offsetX=0,this._offsetY=0,this._textureID=0,this._validDefinition=!1,this._xAdvance=0},n.FontAtlas=function(t){this._lineHeight=t.commonHeight,this._fontSize=t.fontSize,this._letterDefinitions={},this._fntConfig=t},n.FontAtlas.prototype={constructor:n.FontAtlas,setFontSize:function(t){this._fontSize=t},getOriginalFontSize:function(){return this._fntConfig.fontSize},addLetterDefinitions:function(t,e){this._letterDefinitions[t]=e},cloneLetterDefinition:function(){var t={};for(var e in this._letterDefinitions){var i=new n.FontLetterDefinition;n.js.mixin(i,this._letterDefinitions[e]),t[e]=i}return t},assignLetterDefinitions:function(t){for(var e in this._letterDefinitions){var i=t[e],r=this._letterDefinitions[e];n.js.mixin(r,i)}},scaleFontLetterDefinition:function(t){for(var e in this._letterDefinitions){var i=this._letterDefinitions[e];i._width*=t,i._height*=t,i._offsetX*=t,i._offsetY*=t,i._xAdvance*=t}},getLetterDefinitionForChar:function(t){var e,i=this._letterDefinitions.hasOwnProperty(t.charCodeAt(0));return e=i?this._letterDefinitions[t.charCodeAt(0)]:null}},n.LetterInfo=function(){this._char="",this._valid=!0,this._positionX=0,this._positionY=0,this._atlasIndex=0,this._lineIndex=0},n.Label=_ccsg.Node.extend({_hAlign:n.TextAlignment.LEFT,_vAlign:n.VerticalTextAlignment.TOP,_string:"",_fontSize:40,_overFlow:0,_isWrapText:!0,_spacingX:0,_blendFunc:null,_isUseSystemFont:!0,_labelSkinDirty:!0,_labelType:0,_fontHandle:"",_lineSpacing:0,_maxLineWidth:0,_labelDimensions:n.size(0,0),_labelWidth:0,_labelHeight:0,_lineHeight:40,_className:"Label",ctor:function(t,e,i){_.call(this),e=e||"",this._fontHandle=e,i=i||0,this._labelType=i,t=t||"",this._string=t,_ccsg.Node.prototype.ctor.call(this),this.setAnchorPoint(n.p(.5,.5)),this.setContentSize(n.size(128,128)),this._blendFunc=n.BlendFunc._alphaNonPremultiplied(),1===i?this._initBMFontWithString(this._string,this._fontHandle):(this.setFontFileOrFamily(e),this.setString(this._string))},_resetBMFont:function(){this._imageOffset=n.p(0,0),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._fontAtlas=null,this._config=null,this._numberOfLines=0,this._lettersInfo=[],this._linesWidth=[],this._linesOffsetX=[],this._bmFontSize=0,this._textDesiredHeight=0,this._letterOffsetY=0,this._tailoredTopY=0,this._tailoredBottomY=0,this._config=null,this._fontAtlas=null,this._bmfontScale=1,this._additionalKerning=0,this._horizontalKernings=[],this._lineBreakWithoutSpaces=!1,this._reusedRect=n.rect(0,0,0,0),this._textureLoaded=!1,this._spriteBatchNode&&(this.removeChild(this._spriteBatchNode),this._spriteBatchNode=null)},isSystemFontUsed:function(){return this._isUseSystemFont},setSystemFontUsed:function(t){this._isUseSystemFont!==t&&(t&&this.setFontFileOrFamily("Arial"),this._isUseSystemFont=t)},setHorizontalAlign:function(t){this._hAlign!==t&&(this._hAlign=t,this._notifyLabelSkinDirty())},getHorizontalAlign:function(){return this._hAlign},setVerticalAlign:function(t){this._vAlign!==t&&(this._vAlign=t,this._notifyLabelSkinDirty())},getVerticalAlign:function(){return this._vAlign},setString:function(t){this._string!==t&&(this._string=t,this._notifyLabelSkinDirty())},getString:function(){return this._string},getStringLength:function(){return this._string.length},enableWrapText:function(t){this._isWrapText!==t&&this._overFlow!==n.Label.Overflow.RESIZE&&(this._isWrapText=t,this._rescaleWithOriginalFontSize(),this._notifyLabelSkinDirty())},isWrapTextEnabled:function(){return this._isWrapText},getFontName:function(){return this._fontHandle},setFontSize:function(t){this._fontSize=t,this._bmFontSize=t,this._notifyLabelSkinDirty()},getFontSize:function(){return this._fontSize},setOverflow:function(t){this._overFlow!==t&&(this._overFlow=t,this._overFlow===n.Label.Overflow.RESIZE&&(this._setDimensions(this._labelDimensions.width,0),this._isWrapText=!0),this._rescaleWithOriginalFontSize(),this._notifyLabelSkinDirty())},getOverflow:function(){return this._overFlow},setSpacingX:function(t){this._spacingX!==t&&(this._spacingX=t)},setLineHeight:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._notifyLabelSkinDirty())},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces!==t&&(this._lineBreakWithoutSpaces=t,this._notifyLabelSkinDirty())},getSpacingX:function(){return this._spacingX},getLineHeight:function(){return this._lineHeight},setFontFileOrFamily:function(t){t=t||"Arial";var e=n.path.extname(t);return this._resetBMFont(),null===e?(this._fontHandle=t,this._labelType=n.Label.Type.TTF,this._notifyLabelSkinDirty(),void(this._isUseSystemFont=!0)):(t=n.path.join(n.loader.resPath,t),this._isUseSystemFont=!1,void(".ttf"===e?(this._labelType=n.Label.Type.TTF,this._fontHandle=this._loadTTFFont(t)):".fnt"===e&&(this._labelType=n.Label.Type.BMFont,this._initBMFontWithString(this._string,t))))},_loadTTFFont:function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i,n=t.lastIndexOf("/");i=-1===n?t.substring(0,e)+"_LABEL":t.substring(n+1,e)+"_LABEL";var r=this;if(FontFace){var s=new FontFace(i,"url('"+t+"')");s.load().then(function(t){document.fonts.add(t),r._notifyLabelSkinDirty()})}else{var o=document,a=document.createElement("style");a.type="text/css",o.body.appendChild(a);var c="";c+=isNaN(i-0)?"@font-face { font-family:"+i+"; src:":"@font-face { font-family:'"+i+"'; src:",c+="url('"+t+"');",a.textContent=c+"}";var h=document.createElement("div"),l=h.style;l.fontFamily=i,h.innerHTML=".",l.position="absolute",l.left="-100px",l.top="-100px",o.body.appendChild(h),r.scheduleOnce(r._notifyLabelSkinDirty,2)}return i},setContentSize:function(t,e){var i=this._contentSize.width,r=this._contentSize.height;if(this._labelType===n.Label.Type.TTF){if(_ccsg.Node.prototype.setContentSize.call(this,t,e),i===this._contentSize.width&&r===this._contentSize.height)return;var s=t.width||t,o=t.height||e;this._labelWidth=s,this._labelHeight=o,this._labelDimensions.width=s,this._labelDimensions.height=o,this._maxLineWidth=s,this._notifyLabelSkinDirty()}else if(this._labelType===n.Label.Type.BMFont)if(e){if(i===t&&r===e)return;this._setDimensions(t,e)}else{if(i===t.width&&r===t.height)return;this._setDimensions(t.width,t.height)}},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e)},getBlendFunc:function(){return new n.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_notifyLabelSkinDirty:function(){this._labelSkinDirty=!0},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_WEBGL?new n.Label.WebGLRenderCmd(this):new n.Label.CanvasRenderCmd(this)},getContentSize:function(t){return t&&this._labelType===n.Label.Type.BMFont&&this._labelSkinDirty&&this._updateContent(),_ccsg.Node.prototype.getContentSize.call(this)}}),n.BMFontHelper={_alignText:function(){var t=!0;do{if(!this._spriteBatchNode)return!0;if(this._textDesiredHeight=0,this._linesWidth=[],this._maxLineWidth>0&&!this._lineBreakWithoutSpaces?this._multilineTextWrapByWord():this._multilineTextWrapByChar(),this._computeAlignmentOffset(),this._overFlow===n.Label.Overflow.SHRINK){var e=this.getFontSize();e>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp.bind(this))}if(!this._updateQuads()){t=!1,this._overFlow===n.Label.Overflow.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp.bind(this));break}}while(0);return t},_isHorizontalClamped:function(t,e){var i=this._linesWidth[e],n=t>this._contentSize.width||0>t;return this._isWrapText?i>this._contentSize.width&&n:n},_updateQuads:function(){var t=!0;this._spriteBatchNode.removeAllChildren();for(var e=!1,i=0;i<this._string.length;++i)if(this._lettersInfo[i]._valid){var r=this._fontAtlas._letterDefinitions[this._lettersInfo[i]._char];this._reusedRect.height=r._height,this._reusedRect.width=r._width,this._reusedRect.x=r._u,this._reusedRect.y=r._v;var s=this._lettersInfo[i]._positionY+this._letterOffsetY;if(this._labelHeight>0){if(s>this._tailoredTopY){var o=s-this._tailoredTopY;this._reusedRect.y+=o,this._reusedRect.height-=o,s-=o}s-r._height*this._bmfontScale<this._tailoredBottomY&&(this._reusedRect.height=s<this._tailoredBottomY?0:s-this._tailoredBottomY)}var a=this._lettersInfo[i]._lineIndex,c=this._lettersInfo[i]._positionX+r._width/2*this._bmfontScale+this._linesOffsetX[a];if(this._labelWidth>0&&this._isHorizontalClamped(c,a))if(this._overFlow===n.Label.Overflow.CLAMP)this._reusedRect.width=0;else if(this._overFlow===n.Label.Overflow.SHRINK){if(this._contentSize.width>r._width){e=!0,t=!1;break}this._reusedRect.width=0}if(this._reusedRect.height>0&&this._reusedRect.width>0){var h=this.getChildByTag(i),l=this._spriteBatchNode._renderCmd._texture||this._spriteBatchNode.textureAtlas.texture;h||(h=new n.Sprite,h.initWithTexture(l),h.setAnchorPoint(n.p(0,1))),h.setTextureRect(this._reusedRect,!1,this._reusedRect.size);var d=this._lettersInfo[i]._positionX+this._linesOffsetX[this._lettersInfo[i]._lineIndex];h.setPosition(d,s);var u=this._spriteBatchNode.getChildrenCount();this._lettersInfo[i]._atlasIndex=u,this._updateLetterSpriteScale(h),this._spriteBatchNode.addChild(h)}}return t},_updateLetterSpriteScale:function(t){this._labelType===n.Label.Type.BMFont&&this._fontSize>0&&t.setScale(this._bmfontScale)},_recordPlaceholderInfo:function(t,e){if(t>=this._lettersInfo.length){var i=new n.LetterInfo;this._lettersInfo.push(i)}this._lettersInfo[t]._char=e,this._lettersInfo[t]._valid=!1},_recordLetterInfo:function(t,e,i,r){if(i>=this._lettersInfo.length){var s=new n.LetterInfo;this._lettersInfo.push(s)}e=e.charCodeAt(0),this._lettersInfo[i]._lineIndex=r,this._lettersInfo[i]._char=e,this._lettersInfo[i]._valid=this._fontAtlas._letterDefinitions[e]._validDefinition,this._lettersInfo[i]._positionX=t.x,this._lettersInfo[i]._positionY=t.y},_setDimensions:function(t,e){this._overFlow===n.Label.Overflow.RESIZE&&(e=0),(e!==this._labelHeight||t!==this._labelWidth)&&(this._labelWidth=t,this._labelHeight=e,this._labelDimensions.width=t,this._labelDimensions.height=e,this._maxLineWidth=t,this._overFlow===n.Label.Overflow.SHRINK&&this._bmFontSize>0&&this._restoreFontSize(),this._notifyLabelSkinDirty())},_restoreFontSize:function(){this._labelType===n.Label.Type.BMFont&&(this._fontSize=this._bmFontSize)},_multilineTextWrap:function(t){var e=this.getStringLength(),i=0,r=0,s=0,o=0,a=0,c=n.contentScaleFactor(),h=this._lineSpacing*c,l=0,d=0,u=null,_=n.p(0,0);this._updateBMFontScale();for(var f=0;e>f;){var p=this._string.charAt(f);if("\n"!==p){for(var g=t(this._string,f,e),m=l,y=d,v=a,T=r,C=!1,S=0;g>S;++S){var E=f+S;if(p=this._string.charAt(E),"\r"!==p)if(u=this._fontAtlas.getLetterDefinitionForChar(p)){var b=(T+u._offsetX*this._bmfontScale)/c;if(this._isWrapText&&this._maxLineWidth>0&&r>0&&b+u._width*this._bmfontScale>this._maxLineWidth&&!this._isspace_unicode(p)){this._linesWidth.push(a),a=0,i++,r=0,s-=this._lineHeight*this._bmfontScale+h,C=!0;break}_.x=b,_.y=(s-u._offsetY*this._bmfontScale)/c,this._recordLetterInfo(_,p,E,i),E+1<this._horizontalKernings.length&&e-1>E&&(T+=this._horizontalKernings[E+1]),T+=u._xAdvance*this._bmfontScale+this._additionalKerning,v=_.x+u._width*this._bmfontScale,m<_.y&&(m=_.y),y>_.y-u._height*this._bmfontScale&&(y=_.y-u._height*this._bmfontScale)}else this._recordPlaceholderInfo(E,p),console.log("Can't find letter definition in font file for letter:"+p);else this._recordPlaceholderInfo(E,p)}C||(r=T,a=v,m>l&&(l=m),d>y&&(d=y),a>o&&(o=a),f+=g)}else this._linesWidth.push(a),a=0,i++,r=0,s-=this._lineHeight*this._bmfontScale+h,this._recordPlaceholderInfo(f,p),f++}this._linesWidth.push(a),this._numberOfLines=i+1,this._textDesiredHeight=this._numberOfLines*this._lineHeight*this._bmfontScale/c,this._numberOfLines>1&&(this._textDesiredHeight+=(this._numberOfLines-1)*this._lineSpacing);var x=n.size(this._labelWidth,this._labelHeight);return this._labelWidth<=0&&(x.width=o),this._labelHeight<=0&&(x.height=this._textDesiredHeight),_ccsg.Node.prototype.setContentSize.call(this,x),this._tailoredTopY=x.height,this._tailoredBottomY=0,l>0&&(this._tailoredTopY=x.height+l),d<-this._textDesiredHeight&&(this._tailoredBottomY=this._textDesiredHeight+d),!0},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen.bind(this))},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen.bind(this))},_isVerticalClamp:function(){return this._textDesiredHeight>this._contentSize.height?!0:!1},_isHorizontalClamp:function(){for(var t=!1,e=0;e<this.getStringLength();++e)if(this._lettersInfo[e]._valid){var i=this._fontAtlas._letterDefinitions[this._lettersInfo[e]._char],n=this._lettersInfo[e]._positionX+i._width/2*this._bmfontScale,r=this._lettersInfo[e]._lineIndex;if(this._labelWidth>0)if(this._isWrapText){var s=this._linesWidth[r];if(s>this._contentSize.width&&(n>this._contentSize.width||0>n)){t=!0;break}}else if(n>this._contentSize.width){t=!0;break}}return t},_shrinkLabelToContentSize:function(t){for(var e=this.getFontSize(),i=0,n=this._fontAtlas.cloneLetterDefinition(),r=this._lineHeight,s=!0;t();){++i;var o=e-i;if(s=!1,0>=o)break;var a=o/e;this._fontAtlas.assignLetterDefinitions(n),this._fontAtlas.scaleFontLetterDefinition(a),this._lineHeight=r*a,this._maxLineWidth>0&&!this._lineBreakWithoutSpaces?this._multilineTextWrapByWord():this._multilineTextWrapByChar(),this._computeAlignmentOffset()}this._lineHeight=r,this._fontAtlas.assignLetterDefinitions(n),s||e-i>=0&&this._scaleFontSizeDown(e-i)},_scaleFontSizeDown:function(t){var e=!0;this._labelType===n.Label.Type.BMFont&&(t||(t=.1,e=!1),this._fontSize=t),e&&this._updateContent()},_updateContent:function(){var t=!0;this._fontAtlas&&(this._computeHorizontalKerningForText(this._string),t=this._alignText()),t&&(this._labelSkinDirty=!1)},_computeAlignmentOffset:function(){switch(this._linesOffsetX=[],this._hAlign){case n.TextAlignment.LEFT:for(var t=0;t<this._numberOfLines;++t)this._linesOffsetX.push(0);break;case n.TextAlignment.CENTER:this._linesWidth.forEach(function(t){this._linesOffsetX.push((this._contentSize.width-t)/2)}.bind(this));break;case n.TextAlignment.RIGHT:this._linesWidth.forEach(function(t){this._linesOffsetX.push(this._contentSize.width-t)}.bind(this))}switch(this._vAlign){case n.VerticalTextAlignment.TOP:this._letterOffsetY=this._contentSize.height;break;case n.VerticalTextAlignment.CENTER:this._letterOffsetY=(this._contentSize.height+this._textDesiredHeight)/2;break;case n.VerticalTextAlignment.BOTTOM:this._letterOffsetY=this._textDesiredHeight}},_getFirstCharLen:function(t,e,i){return 1},_isCJK_unicode:function(t){var e=/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,i=/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,n=/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/;return e.test(t)||i.test(t)||n.test(t)},_isspace_unicode:function(t){return t=t.charCodeAt(0),t>=9&&13>=t||32===t||133===t||160===t||5760===t||t>=8192&&8202>=t||8232===t||8233===t||8239===t||8287===t||12288===t},_getFirstWordLen:function(t,e,i){var n=t.charAt(e);if(this._isCJK_unicode(n)||"\n"===n||this._isspace_unicode(n))return 1;for(var r=1,s=e+1;i>s&&(n=t.charAt(s),"\n"!==n&&!this._isspace_unicode(n)&&!this._isCJK_unicode(n));++s)r++;return r},_updateBMFontScale:function(){if(this._labelType===n.Label.Type.BMFont){var t=this._fontAtlas._fontSize;this._bmfontScale=this._fontSize*n.contentScaleFactor()/t}else this._bmfontScale=1},_initBMFontWithString:function(t,e){var i=this;return i._config?(n.log("cc.Label._initBMFontWithString(): re-init is no longer supported"),!1):(this._string=t,void this._setBMFontFile(e))},_createSpriteBatchNode:function(t){
this._spriteBatchNode=new n.SpriteBatchNode(t,this._string.length),this._spriteBatchNode.setCascadeColorEnabled(!0),this._spriteBatchNode.setCascadeOpacityEnabled(!0),this.addChild(this._spriteBatchNode),this._updateContent(),this.setColor(this.color)},_createFontChars:function(){if(this._config){this._fontAtlas=new n.FontAtlas(this._config),this._lineHeight||(this._lineHeight=this._fontAtlas._lineHeight);var t=this._config,e=t.fontDefDictionary;for(var i in e){var r=new n.FontLetterDefinition,s=e[i].rect;n.rectPointsToPixels(s),r._offsetX=e[i].xOffset,r._offsetY=e[i].yOffset,r._width=s.width,r._height=s.height,r._u=s.x+this._imageOffset.x,r._v=s.y+this._imageOffset.y,r._textureID=0,r._validDefinition=!0,r._xAdvance=e[i].xAdvance,this._fontAtlas.addLetterDefinitions(i,r)}}},_rescaleWithOriginalFontSize:function(){var t=this.getFontSize();this._bmFontSize-t>=1&&this._overFlow===n.Label.Overflow.SHRINK&&this._scaleFontSizeDown(this._bmFontSize)},_computeHorizontalKerningForText:function(t){for(var e=this.getStringLength(),i=this._config.kerningDict,n=-1,r=0;e>r;++r){var s=this._string.charCodeAt(r),o=i[n<<16|65535&s]||0;this._horizontalKernings[r]=e-1>r?o:0,n=s}},_setBMFontFile:function(t){if(t){this._fontHandle=t;var e=this;if(this._labelType===n.Label.Type.BMFont){this._resetBMFont();var i;n.loader.load(this._fontHandle,function(t,r){t&&n.log("cc.Label._initBMFontWithString(): Impossible to create font. Please check file"),e._config=r[0],e._createFontChars(),i=n.textureCache.addImage(e._config.atlasName);var s=i.isLoaded();e._textureLoaded=s,s?e._createSpriteBatchNode(i):i.once("load",function(t){var e=this;e._spriteBatchNode||e._createSpriteBatchNode(i),e._textureLoaded=!0,e.emit("load")},e)})}}}};var c=n.Label.prototype;n.js.addon(c,_.prototype),n.js.mixin(c,n.BMFontHelper),n.Label.Type=n.Enum({TTF:0,BMFont:1}),n.Label.Overflow=n.Enum({CLAMP:0,SHRINK:1,RESIZE:2}),n.LabelAtlas=n.AtlasNode.extend({_string:null,_mapStartChar:null,_textureLoaded:!1,_className:"LabelAtlas",ctor:function(t,e,i,r,s){n.AtlasNode.prototype.ctor.call(this),this._renderCmd.setCascade(),e&&n.LabelAtlas.prototype.initWithString.call(this,t,e,i,r,s)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_WEBGL?new n.LabelAtlas.WebGLRenderCmd(this):new n.LabelAtlas.CanvasRenderCmd(this)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},initWithString:function(t,e,i,r,s){var o,a,c,h,l=t+"";if(void 0===i){var d=n.loader.getRes(e);if(1!==parseInt(d.version,10))return n.log("cc.LabelAtlas.initWithString(): Unsupported version. Upgrade cocos2d version"),!1;o=n.path.changeBasename(e,d.textureFilename);var u=n.contentScaleFactor();a=parseInt(d.itemWidth,10)/u,c=parseInt(d.itemHeight,10)/u,h=String.fromCharCode(parseInt(d.firstChar,10))}else o=e,a=i||0,c=r||0,h=s||" ";var _=null;_=o instanceof n.Texture2D?o:n.textureCache.addImage(o);var f=_.isLoaded();return this._textureLoaded=f,f||(this._string=l,_.once("load",function(t){this.initWithTexture(_,a,c,l.length),this.string=this._string,this.setColor(this._renderCmd._displayedColor),this.emit("load")},this)),this.initWithTexture(_,a,c,l.length)?(this._mapStartChar=h,this.string=l,!0):!1},setColor:function(t){n.AtlasNode.prototype.setColor.call(this,t),this._renderCmd.updateAtlasValues()},getString:function(){return this._string},addChild:function(t,e,i){this._renderCmd._addChild(t),_ccsg.Node.prototype.addChild.call(this,t,e,i)},updateAtlasValues:function(){this._renderCmd.updateAtlasValues()},setString:function(t){t=String(t);var e=t.length;this._string=t,this.setContentSize(e*this._itemWidth,this._itemHeight),this._renderCmd.setString(t),this._renderCmd.updateAtlasValues(),this.quadsToDraw=e}}),function(){var t=n.LabelAtlas.prototype;n.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),n.defineGetterSetter(t,"color",t.getColor,t.setColor),t.string,n.defineGetterSetter(t,"string",t.getString,t.setString)}(),n.LabelAtlas.create=function(t,e,i,r,s){return new n.LabelAtlas(t,e,i,r,s)},function(){n.LabelAtlas.CanvasRenderCmd=function(t){n.AtlasNode.CanvasRenderCmd.call(this,t),this._needDraw=!1};var t=n.LabelAtlas.CanvasRenderCmd.prototype=Object.create(n.AtlasNode.CanvasRenderCmd.prototype);t.constructor=n.LabelAtlas.CanvasRenderCmd,t.setCascade=function(){var t=this._node;t._cascadeOpacityEnabled=!0,t._cascadeColorEnabled=!1},t.updateAtlasValues=function(){for(var t=this._node,e=t._string||"",i=e.length,r=this._textureToRender,s=t._itemWidth,o=t._itemHeight,a=0,c=-1;i>a;a++){var h=e.charCodeAt(a)-t._mapStartChar.charCodeAt(0),l=parseInt(h%t._itemsPerRow,10),d=parseInt(h/t._itemsPerRow,10);if(!(0>l||0>d)){var u=n.rect(l*s,d*o,s,o),_=r._contentSize;if(!(u.x<0||u.y<0||u.x+u.width>_.width||u.y+u.height>_.height)){c++;var f=e.charCodeAt(a),p=t.getChildByTag(a);p?32===f?(p.init(),p.setTextureRect(n.rect(0,0,10,10),!1,n.size(0,0))):(p.initWithTexture(r,u),p.visible=!0):(p=new n.Sprite,32===f?(p.init(),p.setTextureRect(n.rect(0,0,10,10),!1,n.size(0,0))):p.initWithTexture(r,u),_ccsg.Node.prototype.addChild.call(t,p,0,a)),p.setPosition(c*s+s/2,o/2)}}}this.updateContentSize(a,c+1)},t.updateContentSize=function(t,e){var i=this._node,n=i._contentSize;t!==e&&t*i._itemWidth===n.width&&i._itemHeight===n.height&&i.setContentSize(e*i._itemWidth,i._itemHeight)},t.setString=function(t){var e=this._node;if(e._children)for(var i=e._children,n=i.length,r=0;n>r;r++){var s=i[r];s&&!s._lateChild&&(s.visible=!1)}},t._addChild=function(){child._lateChild=!0}}(),function(){n.LabelAtlas.WebGLRenderCmd=function(t){n.AtlasNode.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=n.LabelAtlas.WebGLRenderCmd.prototype=Object.create(n.AtlasNode.WebGLRenderCmd.prototype);t.constructor=n.LabelAtlas.WebGLRenderCmd,t.setCascade=function(){var t=this._node;t._cascadeOpacityEnabled=!0,t._cascadeColorEnabled=!0},t.rendering=function(t){if(n.AtlasNode.WebGLRenderCmd.prototype.rendering.call(this,t),n.LABELATLAS_DEBUG_DRAW){var e=this._node,i=e.getContentSize(),r=e.getBoundingBoxToWorld(),s=r.x,o=r.y;i.width=r.width,i.height=r.height;var a=[n.p(s,o),n.p(s+i.width,o),n.p(i.width+s,i.height+o),n.p(s,o+i.height)];n._drawingUtil.drawPoly(a,4,!0)}},t.updateAtlasValues=function(){var t=this._node,e=t._string,i=e.length,r=this._textureAtlas,s=r.texture,o=s.getPixelWidth(),a=s.getPixelHeight(),c=t._itemWidth,h=t._itemHeight;t._ignoreContentScaleFactor||(c=t._itemWidth*n.contentScaleFactor(),h=t._itemHeight*n.contentScaleFactor()),i>r.getCapacity()&&n.log("cc.LabelAtlas._updateAtlasValues(): Invalid String length");for(var l=r.quads,d=this._displayedColor,u={r:d.r,g:d.g,b:d.b,a:t._displayedOpacity},_=t._itemWidth,f=t._itemHeight,p=0,g=-1;i>p;p++){var m=e.charCodeAt(p)-t._mapStartChar.charCodeAt(0),y=m%t._itemsPerRow,v=0|m/t._itemsPerRow;if(!(0>y||0>v||y*_+_>o||v*f+f>a)){g++;var T,C,S,E;n.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(T=(2*y*c+1)/(2*o),C=T+(2*c-2)/(2*o),S=(2*v*h+1)/(2*a),E=S+(2*h-2)/(2*a)):(T=y*c/o,C=T+c/o,S=v*h/a,E=S+h/a);var b=l[p],x=b.tl,A=b.tr,R=b.bl,I=b.br;x.texCoords.u=T,x.texCoords.v=S,A.texCoords.u=C,A.texCoords.v=S,R.texCoords.u=T,R.texCoords.v=E,I.texCoords.u=C,I.texCoords.v=E,R.vertices.x=g*_,R.vertices.y=0,R.vertices.z=0,I.vertices.x=g*_+_,I.vertices.y=0,I.vertices.z=0,x.vertices.x=g*_,x.vertices.y=t._itemHeight,x.vertices.z=0,A.vertices.x=g*_+_,A.vertices.y=t._itemHeight,A.vertices.z=0,x.colors=u,A.colors=u,R.colors=u,I.colors=u}}if(this.updateContentSize(p,g+1),i>0){r.dirty=!0;var P=r.totalQuads;i>P&&r.increaseTotalQuadsWith(i-P)}},t.updateContentSize=function(t,e){var i=this._node,n=i._contentSize;t!==e&&t*i._itemWidth===n.width&&i._itemHeight===n.height&&i.setContentSize(e*i._itemWidth,i._itemHeight)},t.setString=function(t){var e=t.length;e>this._textureAtlas.totalQuads&&this._textureAtlas.resizeCapacity(e)},t._addChild=function(){}}(),_=t("../cocos2d/core/event/event-target"),n.LABEL_AUTOMATIC_WIDTH=-1,n.LabelBMFont=n.SpriteBatchNode.extend({_opacityModifyRGB:!1,_string:"",_config:null,_fntFile:"",_initialString:"",_alignment:n.TextAlignment.CENTER,_width:-1,_lineBreakWithoutSpaces:!1,_imageOffset:null,_reusedChar:null,_textureLoaded:!1,_className:"LabelBMFont",_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_WEBGL?new n.LabelBMFont.WebGLRenderCmd(this):new n.LabelBMFont.CanvasRenderCmd(this)},_setString:function(t,e){e?this._initialString=t:this._string=t;var i=this._children;if(i)for(var n=0;n<i.length;n++){var r=i[n];r&&r.setVisible(!1)}this._textureLoaded&&(this.createFontChars(),e&&this.updateLabel())},ctor:function(t,e,i,r,s){n.SpriteBatchNode.prototype.ctor.call(this),_.call(this),this._imageOffset=n.p(0,0),this._reusedChar=[],this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this.initWithString(t,e,i,r,s)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t;var e=this._children;if(e)for(var i=0;i<e.length;i++){var n=e[i];n&&(n.opacityModifyRGB=this._opacityModifyRGB)}},_changeTextureColor:function(){this._renderCmd._changeTextureColor()},init:function(){return this.initWithString(null,null,null,null,null)},initWithString:function(t,e,i,r,s){{var o=this,a=t||"";this._renderCmd}o._config&&n.log("cc.LabelBMFont.initWithString(): re-init is no longer supported");var c;if(e){var h=n.loader.getRes(e);if(!h)return n.log("cc.LabelBMFont.initWithString(): Impossible to create font. Please check file"),!1;o._config=h,o._fntFile=e,c=n.textureCache.addImage(h.atlasName);var l=c.isLoaded();o._textureLoaded=l,l||c.once("load",function(t){var e=this;e._textureLoaded=!0,e.initWithTexture(c,e._initialString.length),e.setString(e._initialString,!0),e.emit("load")},o)}else{c=new n.Texture2D;var d=new Image;c.initWithElement(d),o._textureLoaded=!1}return o.initWithTexture(c,a.length)?(o._alignment=r||n.TextAlignment.LEFT,o._imageOffset=s||n.p(0,0),o._width=null==i?-1:i,o._realOpacity=255,o._realColor=n.color(255,255,255,255),o._contentSize.width=0,o._contentSize.height=0,o.setAnchorPoint(.5,.5),this._renderCmd._initBatchTexture(),o.setString(a,!0),!0):!1},createFontChars:function(){var t=this,e=this._renderCmd,i=e._texture||t.textureAtlas.texture,r=0,s=n.size(0,0),o=0,a=1,c=t._string,h=c?c.length:0;if(0!==h){var l,d=t._config,u=d.kerningDict,_=d.commonHeight,f=d.fontDefDictionary;for(l=0;h-1>l;l++)10===c.charCodeAt(l)&&a++;var p=_*a,g=-(_-_*a),m=-1;for(l=0;h>l;l++){var y=c.charCodeAt(l);if(0!==y)if(10!==y){var v=u[m<<16|65535&y]||0,T=f[y];T||(n.log("cocos2d: LabelBMFont: character not found "+c[l]),T={rect:{x:0,y:0,width:0,height:0},xOffset:0,yOffset:0,xAdvance:0});var C=n.rect(T.rect.x,T.rect.y,T.rect.width,T.rect.height);C=n.rectPixelsToPoints(C),C.x+=t._imageOffset.x,C.y+=t._imageOffset.y;var S=t.getChildByTag(l);S?this._renderCmd._updateCharTexture(S,C,y):(S=new n.Sprite,S.initWithTexture(i,C,!1),S._newTextureWhenChangeColor=!0,this.addChild(S,0,l)),S.opacityModifyRGB=this._opacityModifyRGB,this._renderCmd._updateCharColorAndOpacity(S);var E=d.commonHeight-T.yOffset,b=n.p(r+T.xOffset+.5*T.rect.width+v,g+E-.5*C.height*n.contentScaleFactor());S.setPosition(n.pointPixelsToPoints(b)),r+=T.xAdvance+v,m=y,r>o&&(o=r)}else r=0,g-=d.commonHeight}s.width=T&&T.xAdvance<T.rect.width?o-T.xAdvance+T.rect.width:o,s.height=p,t.setContentSize(n.sizePixelsToPoints(s))}},updateString:function(t){var e=this,i=e._children;if(i)for(var n=0,r=i.length;r>n;n++){var s=i[n];s&&(s.visible=!1)}e._config&&e.createFontChars(),t||e.updateLabel()},getString:function(){return this._initialString},setString:function(t,e){t=String(t),null==e&&(e=!0),null!=t&&n.js.isString(t)||(t+=""),this._initialString=t,this._setString(t,e)},_setStringForSetter:function(t){this.setString(t,!1)},setCString:function(t){this.setString(t,!0)},_getCharsWidth:function(t,e){if(0>=e)return 0;var i=this.getChildByTag(t),n=this.getChildByTag(t+e);return this._getLetterPosXLeft(n)-this._getLetterPosXLeft(i)},_checkWarp:function(t,e,i,r){for(var s=this,o=t[e],a=0,c=0;e>c;c++)a+=t[c].length;a=a+e-r;var h=s._getCharsWidth(a,t[e].length-1);if(h>i&&o.length>1){for(var l,d=o.length*(i/h)|0,u=o.substr(d),_=h-this._getCharsWidth(a+d,u.length-1),f=0,p=0;_>i&&p++<100;)d*=i/_,d=0|d,u=o.substr(d),_=h-this._getCharsWidth(a+d,u.length-1);for(p=0;i>_&&p++<100;){if(u){var g=n.LabelTTF._wordRex.exec(u);f=g?g[0].length:1,l=u}s._lineBreakWithoutSpaces&&(f=0),d+=f,u=o.substr(d),_=h-this._getCharsWidth(a+d,u.length-1)}d-=f,0===d&&(d=1,l=l.substr(1));var m,y=o.substr(0,d);n.LabelTTF.wrapInspection&&n.LabelTTF._symbolRex.test(l||u)&&(m=n.LabelTTF._lastWordRex.exec(y),f=m?m[0].length:0,s._lineBreakWithoutSpaces&&(f=0),d-=f,l=o.substr(d),y=o.substr(0,d)),n.LabelTTF._firsrEnglish.test(l)&&(m=n.LabelTTF._lastEnglish.exec(y),m&&y!==m[0]&&(f=m[0].length,s._lineBreakWithoutSpaces&&(f=0),d-=f,l=o.substr(d),y=o.substr(0,d))),t[e]=l||u,t.splice(e,0,y)}},updateLabel:function(){var t=this;t.string=t._initialString;var e,i,r;if(t._width>0){var s=t.string.split("\n"),o="",a=0,c=0;for(e=0;e<s.length;e++)c=s.length,this._checkWarp(s,e,t._width*this._scaleX,a),c<s.length&&a++,e>0&&(o+="\n"),o+=s[e];o+=String.fromCharCode(0),t._setString(o,!1)}if(t._alignment!==n.TextAlignment.LEFT){e=0;for(var h=0,l=t._string.length,d=[],u=0;l>u;u++)if(10!==t._string[u].charCodeAt(0)&&0!==t._string[u].charCodeAt(0))d.push(t._string[e]);else{var _=0,f=d.length;if(0===f){h++;continue}var p=e+f-1+h;if(0>p)continue;var g=t.getChildByTag(p);if(null==g)continue;_=g.getPositionX()+g._getWidth()/2;var m=0;switch(t._alignment){case n.TextAlignment.CENTER:m=t.width/2-_/2;break;case n.TextAlignment.RIGHT:m=t.width-_}if(0!==m)for(i=0;f>i;i++)p=e+i+h,0>p||(r=t.getChildByTag(p),r&&(r.x+=m));e+=f,h++,d.length=0}}},setAlignment:function(t){this._alignment=t,this.updateLabel()},_getAlignment:function(){return this._alignment},setBoundingWidth:function(t){this._width=t,this.updateLabel()},_getBoundingWidth:function(){return this._width},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces=t,this.updateLabel()},setScale:function(t,e){_ccsg.Node.prototype.setScale.call(this,t,e),this.updateLabel()},setScaleX:function(t){_ccsg.Node.prototype.setScaleX.call(this,t),this.updateLabel()},setScaleY:function(t){_ccsg.Node.prototype.setScaleY.call(this,t),this.updateLabel()},setFntFile:function(t){var e=this;if(null!=t&&t!==e._fntFile){var i=n.loader.getRes(t);if(!i)return void n.log("cc.LabelBMFont.setFntFile() : Impossible to create font. Please check file");e._fntFile=t,e._config=i;var r=n.textureCache.addImage(i.atlasName),s=r.isLoaded();e._textureLoaded=s,e.texture=r,s?e.createFontChars():r.once("load",function(t){var e=this;e._textureLoaded=!0,e.texture=r,e.createFontChars(),e._changeTextureColor(),e.updateLabel(),e.emit("load")},e)}},getFntFile:function(){return this._fntFile},setTexture:function(t){this._renderCmd.setTexture(t)},setAnchorPoint:function(t,e){_ccsg.Node.prototype.setAnchorPoint.call(this,t,e),this.updateLabel()},_setAnchorX:function(t){_ccsg.Node.prototype._setAnchorX.call(this,t),this.updateLabel()},_setAnchorY:function(t){_ccsg.Node.prototype._setAnchorY.call(this,t),this.updateLabel()},_atlasNameFromFntFile:function(t){},_kerningAmountForFirst:function(t,e){var i=0,n=t<<16|65535&e;if(this._configuration.kerningDictionary){var r=this._configuration.kerningDictionary[n.toString()];r&&(i=r.amount)}return i},_getLetterPosXLeft:function(t){return t.getPositionX()*this._scaleX-t._getWidth()*this._scaleX*t._getAnchorX()},_getLetterPosXRight:function(t){return t.getPositionX()*this._scaleX+t._getWidth()*this._scaleX*t._getAnchorX()},_isspace_unicode:function(t){return t=t.charCodeAt(0),t>=9&&13>=t||32===t||133===t||160===t||5760===t||t>=8192&&8202>=t||8232===t||8233===t||8239===t||8287===t||12288===t},_utf8_trim_ws:function(t){var e=t.length;if(!(0>=e)){var i=e-1;if(this._isspace_unicode(t[i])){for(var n=i-1;n>=0&&this._isspace_unicode(t[n]);--n)i=n;this._utf8_trim_from(t,i)}}},_utf8_trim_from:function(t,e){var i=t.length;e>=i||0>e||t.splice(e,i)}}),function(){var t=n.LabelBMFont.prototype;n.js.addon(t,_.prototype),t.string,n.defineGetterSetter(t,"string",t.getString,t._setStringForSetter),t.boundingWidth,n.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t.setBoundingWidth),t.textAlign,n.defineGetterSetter(t,"textAlign",t._getAlignment,t.setAlignment)}(),n.LabelBMFont.create=function(t,e,i,r,s){return new n.LabelBMFont(t,e,i,r,s)},n._fntLoader={INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/,_parseStrToObj:function(t){var e=t.match(this.ITEM_EXP),i={};if(e)for(var n=0,r=e.length;r>n;n++){var s=e[n],o=s.indexOf("="),a=s.substring(0,o),c=s.substring(o+1);c.match(this.INT_EXP)?c=parseInt(c):'"'===c[0]&&(c=c.substring(1,c.length-1)),i[a]=c}return i},parseFnt:function(t,e){var i=this,r={},s=i._parseStrToObj(t.match(i.INFO_EXP)[0]),o=s.padding.split(","),a=({left:parseInt(o[0]),top:parseInt(o[1]),right:parseInt(o[2]),bottom:parseInt(o[3])},i._parseStrToObj(t.match(i.COMMON_EXP)[0]));if(r.commonHeight=a.lineHeight,r.fontSize=s.size,n._renderType===n.game.RENDER_TYPE_WEBGL){var c=n.configuration.getMaxTextureSize();(a.scaleW>c.width||a.scaleH>c.height)&&n.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}1!==a.pages&&n.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page");var h=i._parseStrToObj(t.match(i.PAGE_EXP)[0]);0!==h.id&&n.log("cc.LabelBMFont._parseImageFileName() : file could not be found"),r.atlasName=n.path.changeBasename(e,h.file);for(var l=t.match(i.CHAR_EXP),d=r.fontDefDictionary={},u=0,_=l.length;_>u;u++){var f=i._parseStrToObj(l[u]),p=f.id;d[p]={rect:{x:f.x,y:f.y,width:f.width,height:f.height},xOffset:f.xoffset,yOffset:f.yoffset,xAdvance:f.xadvance}}var g=r.kerningDict={},m=t.match(i.KERNING_EXP);if(m)for(var u=0,_=m.length;_>u;u++){var y=i._parseStrToObj(m[u]);g[y.first<<16|65535&y.second]=y.amount}return r},load:function(t,e,i,r){var s=this;n.loader.loadTxt(t,function(t,i){return t?r(t):void r(null,s.parseFnt(i,e))})}},n.loader.register(["fnt"],n._fntLoader),function(){n.LabelBMFont.CanvasRenderCmd=function(t){n.SpriteBatchNode.CanvasRenderCmd.call(this,t),this._needDraw=!0};var t=n.LabelBMFont.CanvasRenderCmd.prototype=Object.create(n.SpriteBatchNode.CanvasRenderCmd.prototype);t.constructor=n.LabelBMFont.CanvasRenderCmd,t.rendering=function(){},t._updateCharTexture=function(t,e,i){32===i?t.setTextureRect(e,!1,n.size(0,0)):(t.setTextureRect(e,!1),t.visible=!0)},t._updateCharColorAndOpacity=function(t){t._displayedColor=this._displayedColor,t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty),t._displayedOpacity=this._displayedOpacity,t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},t.setTexture=function(t){for(var e=this._node,i=e._children,n=this._displayedColor,r=0;r<i.length;r++){var s=i[r],o=s._renderCmd,a=o._displayedColor;(this._texture===o._texture||a.r===n.r&&a.g===n.g&&a.b===n.b)&&(s.texture=t)}this._texture=t},t._changeTextureColor=function(){var t=this._node,e=this._textureToRender,i=e.getContentSize(),r=t._texture,s=r.getHtmlElementObj(),o=this._displayedColor,a=n.rect(0,0,s.width,s.height);if(e&&i.width>0){if(!s)return;this._textureToRender=r._generateColorTexture(o.r,o.g,o.b,a)}},t._updateChildrenDisplayedOpacity=function(t){_ccsg.Node.prototype.updateDisplayedOpacity.call(t,this._displayedOpacity)},t._updateChildrenDisplayedColor=function(t){_ccsg.Node.prototype.updateDisplayedColor.call(t,this._displayedColor)},t._initBatchTexture=function(){}}(),function(){n.LabelBMFont.WebGLRenderCmd=function(t){n.SpriteBatchNode.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=n.LabelBMFont.WebGLRenderCmd.prototype=Object.create(n.SpriteBatchNode.WebGLRenderCmd.prototype);t.constructor=n.LabelBMFont.WebGLRenderCmd,t._updateCharTexture=function(t,e,i){t.setTextureRect(e,!1),t.visible=!0},t._changeTextureColor=function(){},t._updateChildrenDisplayedOpacity=function(t){t.updateDisplayedOpacity(this._displayedOpacity)},t._updateChildrenDisplayedColor=function(t){t.updateDisplayedColor(this._displayedColor)},t._initBatchTexture=function(){var t=this._node,e=t.textureAtlas.texture;t._opacityModifyRGB=e.hasPremultipliedAlpha();var i=t._reusedChar=new n.Sprite;i.initWithTexture(e,n.rect(0,0,0,0),!1),i.batchNode=t},t.rendering=function(t){n.SpriteBatchNode.WebGLRenderCmd.prototype.rendering.call(this,t);var e=this._node;if(n.LABELBMFONT_DEBUG_DRAW){var i=e.getContentSize(),r=n.p(0|-this._anchorPointInPoints.x,0|-this._anchorPointInPoints.y),s=[n.p(r.x,r.y),n.p(r.x+i.width,r.y),n.p(r.x+i.width,r.y+i.height),n.p(r.x,r.y+i.height)];n._drawingUtil.setDrawColor(0,255,0,255),n._drawingUtil.drawPoly(s,4,!0)}},t._updateCharColorAndOpacity=function(){}}(),function(){n.Label.TTFLabelBaker=function(){};var t=n.Label.TTFLabelBaker.prototype=Object.create(Object.prototype);t._getLineHeight=function(){var t=this._node.getLineHeight();return t=0===t?this._drawFontsize:t*this._drawFontsize/this._node._fontSize,0|t},t._prepareQuad=function(){var t=this._quad,e=n.color(255,255,255,this._displayedOpacity),i=this._node._contentSize.width,r=this._node._contentSize.height;t._bl.colors=e,t._br.colors=e,t._tl.colors=e,t._tr.colors=e,t._bl.vertices=new n.Vertex3F(0,0,0),t._br.vertices=new n.Vertex3F(i,0,0),t._tl.vertices=new n.Vertex3F(0,r,0),t._tr.vertices=new n.Vertex3F(i,r,0),t._bl.texCoords=new n.Tex2F(0,1),t._br.texCoords=new n.Tex2F(1,1),t._tl.texCoords=new n.Tex2F(0,0),t._tr.texCoords=new n.Tex2F(1,0),this._quadDirty=!0},t._fragmentText=function(t,e,i){var n=t.split(" "),r=[],s="";if(i.measureText(t).width<e)return[t];for(;n.length>0;){for(;i.measureText(n[0]).width>=e&&n[0].length>1;){var o=n[0];n[0]=o.slice(0,-1),n.length>1?n[1]=o.slice(-1)+n[1]:n.push(o.slice(-1))}i.measureText(s+n[0]).width<e?s+=n.shift()+" ":0===s.length&&1===n[0].length?r.push(n.shift()):(r.push(s.slice(0,-1)),s=""),0===n.length&&s.length>0&&r.push(s)}return r},t._updateDisplayOpacity=function(t){_ccsg.Node.RenderCmd.prototype._updateDisplayOpacity.call(this,t);var e=n.color(255,255,255,this._displayedOpacity),i=this._quad;i._bl.colors=e,i._br.colors=e,i._tl.colors=e,i._tr.colors=e,this._quadDirty=!0},t._updateDisplayColor=function(t){_ccsg.Node.RenderCmd.prototype._updateDisplayColor.call(this,t);var e=this._node;e._labelSkinDirty=!0},t._bakeLabel=function(){var t=this._node;this._drawFontsize=t._fontSize;var e=this._labelContext,i=t._contentSize.width,r=t._contentSize.height;0>=i&&(i=1),0>=r&&(r=1);var s=t._string.split("\n"),o=[];this._drawFontsize=t._fontSize;var a=this._drawFontsize.toString()+"px ",c=0===t._fontHandle.length?"serif":t._fontHandle;a+=c,this._labelContext.font=a;for(var h=0;h<s.length;++h){var l=e.measureText(s[h]);o.push(l.width)}if(n.Label.Overflow.CLAMP==t._overFlow)if(t._isWrapText){this._splitedStrings=[];for(var h=0;h<s.length;++h)this._splitedStrings=this._splitedStrings.concat(this._fragmentText(s[h],i,e))}else this._splitedStrings=s;else if(n.Label.Overflow.RESIZE==t._overFlow)if(t._isWrapText){this._splitedStrings=[];for(var h=0;h<s.length;++h)this._splitedStrings=this._splitedStrings.concat(this._fragmentText(s[h],i,e));r=this._splitedStrings.length*this._getLineHeight(),t.setContentSize(n.size(i,r))}else this._splitedStrings=s,r=this._splitedStrings.length*this._getLineHeight(),t.setContentSize(n.size(i,r));else if(this._splitedStrings=s,t._isWrapText){for(var d=0,h=0;h<s.length;++h)d+=(o[h]/i+1|0)*i;var u=i*(r/this._getLineHeight()|0)/d;this._drawFontsize=this._drawFontsize*Math.min(Math.sqrt(u),1)|0,a=this._drawFontsize.toString()+"px "+c,this._labelContext.font=a,this._splitedStrings=[];for(var h=0;h<s.length;++h)this._splitedStrings=this._splitedStrings.concat(this._fragmentText(s[h],i,e))}else{for(var _=0,f=s.length*this._getLineHeight(),h=0;h<s.length;++h)_<o[h]&&(_=o[h]);var p=i/_,g=r/f;this._drawFontsize=this._drawFontsize*Math.min(1,p,g)|0,a=this._drawFontsize.toString()+"px "+c,this._splitedStrings=s}this._labelCanvas.width=i,this._labelCanvas.height=r,this._labelContext.clearRect(0,0,this._labelCanvas.width,this._labelCanvas.height);var m=this._displayedColor;this._labelContext.fillStyle="rgb("+m.r+","+m.g+","+m.b+")";var y,v,T,C,S=this._getLineHeight(),E=this._splitedStrings.length;n.TextAlignment.RIGHT===t._hAlign?(T="right",y=i):n.TextAlignment.CENTER===t._hAlign?(T="center",y=i/2):(T="left",y=0),this._labelContext.textAlign=T,n.VerticalTextAlignment.TOP===t._vAlign?(C="top",v=0):n.VerticalTextAlignment.CENTER===t._vAlign?(C="middle",v=r/2-S*(E-1)/2):(C="bottom",v=r-S*(E-1)),this._labelContext.textBaseline=C,this._labelContext.font=a;for(var h=0;h<this._splitedStrings.length;++h)this._labelContext.fillText(this._splitedStrings[h],y,v+h*S);this._labelTexture._textureLoaded=!1,this._labelTexture.handleLoadedTexture()},t._rebuildLabelSkin=function(){var t=this._node;t._labelSkinDirty&&(t._labelType===n.Label.Type.TTF?(this._bakeLabel(),this._prepareQuad()):t._updateContent(),this._node._labelSkinDirty=!1)}}(),function(){n.Label.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._labelTexture=new n.Texture2D,this._labelCanvas=document.createElement("canvas"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._labelContext=this._labelCanvas.getContext("2d"),this._labelTexture.initWithElement(this._labelCanvas),this._quad=new n.V3F_C4B_T2F_Quad,this._quadDirty=!0,this._splitedStrings=null,this._drawFontsize=0};var t=n.Label.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.js.mixin(t,n.Label.TTFLabelBaker.prototype),t.constructor=n.Label.CanvasRenderCmd,t.rendering=function(t,e,i){this._rebuildLabelSkin();var r=this._node;if(r._labelType===n.Label.Type.TTF){var s=this._displayedOpacity,o=s/255;if(0===s)return;var a=t||n._renderContext,c=a.getContext();if(a.setTransform(this._worldTransform,e,i),a.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(r._blendFunc)),a.setGlobalAlpha(o),this._labelTexture){var h,l,d,u,_,f,p,g,m=this._quad;_=m._bl.vertices.x,f=m._bl.vertices.y,p=m._tr.vertices.x-m._bl.vertices.x,g=m._tr.vertices.y-m._bl.vertices.y,f=-f-g;var y=this._labelTexture.getPixelWidth(),v=this._labelTexture.getPixelHeight();h=m._bl.texCoords.u*y,l=m._bl.texCoords.v*v,d=(m._tr.texCoords.u-m._bl.texCoords.u)*y,u=(m._tr.texCoords.v-m._bl.texCoords.v)*v,_*=e,f*=i,p*=e,g*=i;var T=this._labelTexture._htmlElementObj;""!==this._labelTexture._pattern?(a.setFillStyle(c.createPattern(T,this._labelTexture._pattern)),c.fillRect(_,f,p,g)):c.drawImage(T,h,l,d,u,_,f,p,g)}n.g_NumberOfDraws=n.g_NumberOfDraws+1}}}(),function(){n.Label.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._labelTexture=new n.Texture2D,this._quadWebBuffer=n._renderContext.createBuffer(),this._shaderProgram=n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURECOLOR),this._quad=new n.V3F_C4B_T2F_Quad,this._labelCanvas=document.createElement("canvas"),this._labelTexture.initWithElement(this._labelCanvas),this._labelContext=this._labelCanvas.getContext("2d"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._quadDirty=!0,this._splitedStrings=null,this._drawFontsize=0};var t=n.Label.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.js.mixin(t,n.Label.TTFLabelBaker.prototype),t.constructor=n.Label.WebGLRenderCmd,t.rendering=function(t){var e=this._node;if(this._rebuildLabelSkin(),e._labelType===n.Label.Type.TTF){var i=t||n._renderContext;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),n.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),n.glBindTexture2DN(0,this._labelTexture),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),i.bindBuffer(i.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(i.bufferData(i.ARRAY_BUFFER,this._quad.arrayBuffer,i.DYNAMIC_DRAW),this._quadDirty=!1),i.vertexAttribPointer(0,3,i.FLOAT,!1,24,0),i.vertexAttribPointer(1,4,i.UNSIGNED_BYTE,!0,24,12),i.vertexAttribPointer(2,2,i.FLOAT,!1,24,16),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}}(),n.v2fzero=function(){return{x:0,y:0}},n.v2f=function(t,e){return{x:t,y:e}},n.v2fadd=function(t,e){return n.v2f(t.x+e.x,t.y+e.y)},n.v2fsub=function(t,e){return n.v2f(t.x-e.x,t.y-e.y)},n.v2fmult=function(t,e){return n.v2f(t.x*e,t.y*e)},n.v2fperp=function(t){return n.v2f(-t.y,t.x)},n.v2fneg=function(t){return n.v2f(-t.x,-t.y)},n.v2fdot=function(t,e){return t.x*e.x+t.y*e.y},n.v2fforangle=function(t){return n.v2f(Math.cos(t),Math.sin(t))},n.v2fnormalize=function(t){var e=n.pNormalize(n.p(t.x,t.y));return n.v2f(e.x,e.y)},n.__v2f=function(t){return n.v2f(t.x,t.y)},n.__t=function(t){return{u:t.x,v:t.y}},n.DrawNode=_ccsg.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=null==t.a?255:t.a},getDrawColor:function(){return n.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),n.DrawNode.create=function(){return new n.DrawNode},n.DrawNode.TYPE_DOT=0,n.DrawNode.TYPE_SEGMENT=1,n.DrawNode.TYPE_POLY=2,n.game.once(n.game.EVENT_RENDERER_INITED,function(){n._renderType===n.game.RENDER_TYPE_CANVAS?(n._DrawNodeElement=function(t,e,i,n,r,s,o,a,c){var h=this;h.type=t,h.verts=e||null,h.fillColor=i||null,h.lineWidth=n||0,h.lineColor=r||null,h.lineCap=s||"butt",h.isClosePolygon=o||!1,h.isFill=a||!1,h.isStroke=c||!1},n.js.mixin(n.DrawNode.prototype,{_className:"DrawNodeCanvas",ctor:function(){_ccsg.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=n.color(255,255,255,255),t._blendFunc=this._blendFunc=new n.BlendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.init()},drawRect:function(t,e,i,r,s){r=null==r?this._lineWidth:r,s=s||this.getDrawColor(),null==s.a&&(s.a=255);var o=[t,n.p(e.x,t.y),e,n.p(t.x,e.y)],a=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);a.verts=o,a.lineWidth=r,a.lineColor=s,a.isClosePolygon=!0,a.isStroke=!0,a.lineCap="butt",a.fillColor=i,i&&(null==i.a&&(i.a=255),a.isFill=!0),this._buffer.push(a)},drawCircle:function(t,e,i,r,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);for(var c=2*Math.PI/r,h=[],l=0;r>=l;l++){var d=l*c,u=e*Math.cos(d+i)+t.x,_=e*Math.sin(d+i)+t.y;h.push(n.p(u,_))}s&&h.push(n.p(t.x,t.y));var f=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);f.verts=h,f.lineWidth=o,f.lineColor=a,f.isClosePolygon=!0,f.isStroke=!0,this._buffer.push(f)},drawQuadBezier:function(t,e,i,r,s,o){s=s||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var a=[],c=0,h=0;r>h;h++){var l=Math.pow(1-c,2)*t.x+2*(1-c)*c*e.x+c*c*i.x,d=Math.pow(1-c,2)*t.y+2*(1-c)*c*e.y+c*c*i.y;a.push(n.p(l,d)),c+=1/r}a.push(n.p(i.x,i.y));var u=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);u.verts=a,u.lineWidth=s,u.lineColor=o,u.isStroke=!0,u.lineCap="round",this._buffer.push(u)},drawCubicBezier:function(t,e,i,r,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);for(var c=[],h=0,l=0;s>l;l++){var d=Math.pow(1-h,3)*t.x+3*Math.pow(1-h,2)*h*e.x+3*(1-h)*h*h*i.x+h*h*h*r.x,u=Math.pow(1-h,3)*t.y+3*Math.pow(1-h,2)*h*e.y+3*(1-h)*h*h*i.y+h*h*h*r.y;c.push(n.p(d,u)),h+=1/s}c.push(n.p(r.x,r.y));var _=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);_.verts=c,_.lineWidth=o,_.lineColor=a,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,r,s){r=r||this._lineWidth,s=s||this.getDrawColor(),null==s.a&&(s.a=255);for(var o,a,c=[],h=1/t.length,l=0;i+1>l;l++){
var d=l/i;1===d?(o=t.length-1,a=1):(o=0|d/h,a=(d-h*o)/h);var u=n.cardinalSplineAt(n.getControlPointAt(t,o-1),n.getControlPointAt(t,o-0),n.getControlPointAt(t,o+1),n.getControlPointAt(t,o+2),e,a);c.push(u)}var _=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);_.verts=c,_.lineWidth=r,_.lineColor=s,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},drawDot:function(t,e,i){i=i||this.getDrawColor(),null==i.a&&(i.a=255);var r=new n._DrawNodeElement(n.DrawNode.TYPE_DOT);r.verts=[t],r.lineWidth=e,r.fillColor=i,this._buffer.push(r)},drawDots:function(t,e,i){if(t&&0!=t.length){i=i||this.getDrawColor(),null==i.a&&(i.a=255);for(var n=0,r=t.length;r>n;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,e,i,r){i=i||this._lineWidth,r=r||this.getDrawColor(),null==r.a&&(r.a=255);var s=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);s.verts=[t,e],s.lineWidth=2*i,s.lineColor=r,s.isStroke=!0,s.lineCap="round",this._buffer.push(s)},drawPoly_:function(t,e,i,r){i=null==i?this._lineWidth:i,r=r||this.getDrawColor(),null==r.a&&(r.a=255);var s=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);s.verts=t,s.fillColor=e,s.lineWidth=i,s.lineColor=r,s.isClosePolygon=!0,s.isStroke=!0,s.lineCap="round",e&&(s.isFill=!0),this._buffer.push(s)},drawPoly:function(t,e,i,r){for(var s=[],o=0;o<t.length;o++)s.push(n.p(t[o].x,t[o].y));return this.drawPoly_(s,e,i,r)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new n.DrawNode.CanvasRenderCmd(this)}})):n._renderType===n.game.RENDER_TYPE_WEBGL&&n.js.mixin(n.DrawNode.prototype,{_bufferCapacity:0,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_dirty:!1,_className:"DrawNodeWebGL",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new n.BlendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this._drawColor=new n.WebGLColor(255,255,255,255),this.init()},init:function(){return _ccsg.Node.prototype.init.call(this)?(this.shaderProgram=n.shaderCache.programForKey(n.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=n._renderContext.createBuffer(),this._dirty=!0,!0):!1},drawRect:function(t,e,i,r,s){r=null==r?this._lineWidth:r,s=s||this.getDrawColor(),null==s.a&&(s.a=255);var o=[t,n.p(e.x,t.y),e,n.p(t.x,e.y)];null==i?this._drawSegments(o,r,s,!0):this.drawPoly(o,i,r,s)},drawCircle:function(t,e,i,r,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);var c,h,l=2*Math.PI/r,d=[];for(c=0;r>=c;c++){var u=c*l,_=e*Math.cos(u+i)+t.x,f=e*Math.sin(u+i)+t.y;d.push(n.p(_,f))}for(s&&d.push(n.p(t.x,t.y)),o*=.5,c=0,h=d.length;h-1>c;c++)this.drawSegment(d[c],d[c+1],o,a)},drawQuadBezier:function(t,e,i,r,s,o){s=s||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var a=[],c=0,h=0;r>h;h++){var l=Math.pow(1-c,2)*t.x+2*(1-c)*c*e.x+c*c*i.x,d=Math.pow(1-c,2)*t.y+2*(1-c)*c*e.y+c*c*i.y;a.push(n.p(l,d)),c+=1/r}a.push(n.p(i.x,i.y)),this._drawSegments(a,s,o,!1)},drawCubicBezier:function(t,e,i,r,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);for(var c=[],h=0,l=0;s>l;l++){var d=Math.pow(1-h,3)*t.x+3*Math.pow(1-h,2)*h*e.x+3*(1-h)*h*h*i.x+h*h*h*r.x,u=Math.pow(1-h,3)*t.y+3*Math.pow(1-h,2)*h*e.y+3*(1-h)*h*h*i.y+h*h*h*r.y;c.push(n.p(d,u)),h+=1/s}c.push(n.p(r.x,r.y)),this._drawSegments(c,o,a,!1)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,r,s){r=r||this._lineWidth,s=s||this.getDrawColor(),null==s.a&&(s.a=255);for(var o,a,c=[],h=1/t.length,l=0;i+1>l;l++){var d=l/i;1===d?(o=t.length-1,a=1):(o=0|d/h,a=(d-h*o)/h);var u=n.cardinalSplineAt(n.getControlPointAt(t,o-1),n.getControlPointAt(t,o-0),n.getControlPointAt(t,o+1),n.getControlPointAt(t,o+2),e,a);c.push(u)}r*=.5;for(var _=0,f=c.length;f-1>_;_++)this.drawSegment(c[_],c[_+1],r,s)},_render:function(){var t=n._renderContext;n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW),this._dirty=!1);var e=n.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(n.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,e,8),t.vertexAttribPointer(n.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,e,12),t.drawArrays(t.TRIANGLES,0,3*this._buffer.length),n.incrementGLDraws(1)},_ensureCapacity:function(t){var e=this,i=e._buffer;if(i.length+t>e._bufferCapacity){var r=n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(e._bufferCapacity+=Math.max(e._bufferCapacity,t),null==i||0===i.length)e._buffer=[],e._trianglesArrayBuffer=new ArrayBuffer(r*e._bufferCapacity),e._trianglesReader=new Uint8Array(e._trianglesArrayBuffer);else{for(var s=[],o=new ArrayBuffer(r*e._bufferCapacity),a=0;a<i.length;a++)s[a]=new n.V2F_C4B_T2F_Triangle(i[a].a,i[a].b,i[a].c,o,a*r);e._trianglesReader=new Uint8Array(o),e._trianglesArrayBuffer=o,e._buffer=s}}},drawDot:function(t,e,i){i=i||this.getDrawColor(),null==i.a&&(i.a=255);var r={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},s={vertices:{x:t.x-e,y:t.y-e},colors:r,texCoords:{u:-1,v:-1}},o={vertices:{x:t.x-e,y:t.y+e},colors:r,texCoords:{u:-1,v:1}},a={vertices:{x:t.x+e,y:t.y+e},colors:r,texCoords:{u:1,v:1}},c={vertices:{x:t.x+e,y:t.y-e},colors:r,texCoords:{u:1,v:-1}};this._ensureCapacity(6),this._buffer.push(new n.V2F_C4B_T2F_Triangle(s,o,a,this._trianglesArrayBuffer,this._buffer.length*n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new n.V2F_C4B_T2F_Triangle(s,a,c,this._trianglesArrayBuffer,this._buffer.length*n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},drawDots:function(t,e,i){if(t&&0!==t.length){i=i||this.getDrawColor(),null==i.a&&(i.a=255);for(var n=0,r=t.length;r>n;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,e,i,r){r=r||this.getDrawColor(),null==r.a&&(r.a=255),i=i||.5*this._lineWidth;var s=18;this._ensureCapacity(s);var o={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},a=n.__v2f(t),c=n.__v2f(e),h=n.v2fnormalize(n.v2fperp(n.v2fsub(c,a))),l=n.v2fperp(h),d=n.v2fmult(h,i),u=n.v2fmult(l,i),_=n.v2fsub(c,n.v2fadd(d,u)),f=n.v2fadd(c,n.v2fsub(d,u)),p=n.v2fsub(c,d),g=n.v2fadd(c,d),m=n.v2fsub(a,d),y=n.v2fadd(a,d),v=n.v2fsub(a,n.v2fsub(d,u)),T=n.v2fadd(a,n.v2fadd(d,u)),C=n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,S=this._trianglesArrayBuffer,E=this._buffer;E.push(new n.V2F_C4B_T2F_Triangle({vertices:_,colors:o,texCoords:n.__t(n.v2fneg(n.v2fadd(h,l)))},{vertices:f,colors:o,texCoords:n.__t(n.v2fsub(h,l))},{vertices:p,colors:o,texCoords:n.__t(n.v2fneg(h))},S,E.length*C)),E.push(new n.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:n.__t(h)},{vertices:f,colors:o,texCoords:n.__t(n.v2fsub(h,l))},{vertices:p,colors:o,texCoords:n.__t(n.v2fneg(h))},S,E.length*C)),E.push(new n.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:n.__t(h)},{vertices:m,colors:o,texCoords:n.__t(n.v2fneg(h))},{vertices:p,colors:o,texCoords:n.__t(n.v2fneg(h))},S,E.length*C)),E.push(new n.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:n.__t(h)},{vertices:m,colors:o,texCoords:n.__t(n.v2fneg(h))},{vertices:y,colors:o,texCoords:n.__t(h)},S,E.length*C)),E.push(new n.V2F_C4B_T2F_Triangle({vertices:v,colors:o,texCoords:n.__t(n.v2fsub(l,h))},{vertices:m,colors:o,texCoords:n.__t(n.v2fneg(h))},{vertices:y,colors:o,texCoords:n.__t(h)},S,E.length*C)),E.push(new n.V2F_C4B_T2F_Triangle({vertices:v,colors:o,texCoords:n.__t(n.v2fsub(l,h))},{vertices:T,colors:o,texCoords:n.__t(n.v2fadd(h,l))},{vertices:y,colors:o,texCoords:n.__t(h)},S,E.length*C)),this._dirty=!0},drawPoly:function(t,e,i,r){if(null==e)return void this._drawSegments(t,i,r,!0);null==e.a&&(e.a=255),null==r.a&&(r.a=255),i=null==i?this._lineWidth:i,i*=.5;var s,o,a,c,h={r:0|e.r,g:0|e.g,b:0|e.b,a:0|e.a},l={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},d=[],u=t.length;for(s=0;u>s;s++){o=n.__v2f(t[(s-1+u)%u]),a=n.__v2f(t[s]),c=n.__v2f(t[(s+1)%u]);var _=n.v2fnormalize(n.v2fperp(n.v2fsub(a,o))),f=n.v2fnormalize(n.v2fperp(n.v2fsub(c,a))),p=n.v2fmult(n.v2fadd(_,f),1/(n.v2fdot(_,f)+1));d[s]={offset:p,n:f}}var g=i>0,m=3*u-2,y=3*m;this._ensureCapacity(y);var v=n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,T=this._trianglesArrayBuffer,C=this._buffer,S=0==g?.5:0;for(s=0;u-2>s;s++)o=n.v2fsub(n.__v2f(t[0]),n.v2fmult(d[0].offset,S)),a=n.v2fsub(n.__v2f(t[s+1]),n.v2fmult(d[s+1].offset,S)),c=n.v2fsub(n.__v2f(t[s+2]),n.v2fmult(d[s+2].offset,S)),C.push(new n.V2F_C4B_T2F_Triangle({vertices:o,colors:h,texCoords:n.__t(n.v2fzero())},{vertices:a,colors:h,texCoords:n.__t(n.v2fzero())},{vertices:c,colors:h,texCoords:n.__t(n.v2fzero())},T,C.length*v));for(s=0;u>s;s++){var E=(s+1)%u;o=n.__v2f(t[s]),a=n.__v2f(t[E]);var b=d[s].n,x=d[s].offset,A=d[E].offset,R=g?n.v2fsub(o,n.v2fmult(x,i)):n.v2fsub(o,n.v2fmult(x,.5)),I=g?n.v2fsub(a,n.v2fmult(A,i)):n.v2fsub(a,n.v2fmult(A,.5)),P=g?n.v2fadd(o,n.v2fmult(x,i)):n.v2fadd(o,n.v2fmult(x,.5)),L=g?n.v2fadd(a,n.v2fmult(A,i)):n.v2fadd(a,n.v2fmult(A,.5));g?(C.push(new n.V2F_C4B_T2F_Triangle({vertices:R,colors:l,texCoords:n.__t(n.v2fneg(b))},{vertices:I,colors:l,texCoords:n.__t(n.v2fneg(b))},{vertices:L,colors:l,texCoords:n.__t(b)},T,C.length*v)),C.push(new n.V2F_C4B_T2F_Triangle({vertices:R,colors:l,texCoords:n.__t(n.v2fneg(b))},{vertices:P,colors:l,texCoords:n.__t(b)},{vertices:L,colors:l,texCoords:n.__t(b)},T,C.length*v))):(C.push(new n.V2F_C4B_T2F_Triangle({vertices:R,colors:h,texCoords:n.__t(n.v2fzero())},{vertices:I,colors:h,texCoords:n.__t(n.v2fzero())},{vertices:L,colors:h,texCoords:n.__t(b)},T,C.length*v)),C.push(new n.V2F_C4B_T2F_Triangle({vertices:R,colors:h,texCoords:n.__t(n.v2fzero())},{vertices:P,colors:h,texCoords:n.__t(b)},{vertices:L,colors:h,texCoords:n.__t(b)},T,C.length*v)))}d=null,this._dirty=!0},_drawSegments:function(t,e,i,r){if(e=null==e?this._lineWidth:e,i=i||this._drawColor,null==i.a&&(i.a=255),e*=.5,!(0>=e)){var s,o,a,c,h={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},l=[],d=t.length;for(s=0;d>s;s++){o=n.__v2f(t[(s-1+d)%d]),a=n.__v2f(t[s]),c=n.__v2f(t[(s+1)%d]);var u=n.v2fnormalize(n.v2fperp(n.v2fsub(a,o))),_=n.v2fnormalize(n.v2fperp(n.v2fsub(c,a))),f=n.v2fmult(n.v2fadd(u,_),1/(n.v2fdot(u,_)+1));l[s]={offset:f,n:_}}var p=3*d-2,g=3*p;this._ensureCapacity(g);var m=n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,y=this._trianglesArrayBuffer,v=this._buffer,T=r?d:d-1;for(s=0;T>s;s++){var C=(s+1)%d;o=n.__v2f(t[s]),a=n.__v2f(t[C]);var S=l[s].n,E=l[s].offset,b=l[C].offset,x=n.v2fsub(o,n.v2fmult(E,e)),A=n.v2fsub(a,n.v2fmult(b,e)),R=n.v2fadd(o,n.v2fmult(E,e)),I=n.v2fadd(a,n.v2fmult(b,e));v.push(new n.V2F_C4B_T2F_Triangle({vertices:x,colors:h,texCoords:n.__t(n.v2fneg(S))},{vertices:A,colors:h,texCoords:n.__t(n.v2fneg(S))},{vertices:I,colors:h,texCoords:n.__t(S)},y,v.length*m)),v.push(new n.V2F_C4B_T2F_Triangle({vertices:x,colors:h,texCoords:n.__t(n.v2fneg(S))},{vertices:R,colors:h,texCoords:n.__t(S)},{vertices:I,colors:h,texCoords:n.__t(S)},y,v.length*m))}l=null,this._dirty=!0}},clear:function(){this._buffer.length=0,this._dirty=!0},_createRenderCmd:function(){return new n.DrawNode.WebGLRenderCmd(this)}})}),function(){n.DrawNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._buffer=null,this._drawColor=null,this._blendFunc=null},n.DrawNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype),n.DrawNode.CanvasRenderCmd.prototype.constructor=n.DrawNode.CanvasRenderCmd,n.js.mixin(n.DrawNode.CanvasRenderCmd.prototype,{rendering:function(t,e,i){var r=t||n._renderContext,s=(r.getContext(),this._node),o=s._displayedOpacity/255;if(0!==o){r.setTransform(this._worldTransform,e,i),r.setGlobalAlpha(o),this._blendFunc&&this._blendFunc.src===n.SRC_ALPHA&&this._blendFunc.dst===n.ONE&&r.setCompositeOperation("lighter");for(var a=this._buffer,c=0,h=a.length;h>c;c++){var l=a[c];switch(l.type){case n.DrawNode.TYPE_DOT:this._drawDot(r,l,e,i);break;case n.DrawNode.TYPE_SEGMENT:this._drawSegment(r,l,e,i);break;case n.DrawNode.TYPE_POLY:this._drawPoly(r,l,e,i)}}}},_drawDot:function(t,e,i,n){var r=e.fillColor,s=e.verts[0],o=e.lineWidth,a=t.getContext();t.setFillStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),a.beginPath(),a.arc(s.x*i,-s.y*n,o*i,0,2*Math.PI,!1),a.closePath(),a.fill()},_drawSegment:function(t,e,i,n){var r=e.lineColor,s=e.verts[0],o=e.verts[1],a=e.lineWidth,c=e.lineCap,h=t.getContext();t.setStrokeStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),h.lineWidth=a*i,h.beginPath(),h.lineCap=c,h.moveTo(s.x*i,-s.y*n),h.lineTo(o.x*i,-o.y*n),h.stroke()},_drawPoly:function(t,e,i,n){var r=e.verts,s=e.lineCap;if(null!=r){var o=e.fillColor,a=e.lineWidth,c=e.lineColor,h=e.isClosePolygon,l=e.isFill,d=e.isStroke,u=t.getContext(),_=r[0];u.lineCap=s,o&&t.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+","+o.a/255+")"),a&&(u.lineWidth=a*i),c&&t.setStrokeStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")"),u.beginPath(),u.moveTo(_.x*i,-_.y*n);for(var f=1,p=r.length;p>f;f++)u.lineTo(r[f].x*i,-r[f].y*n);h&&u.closePath(),l&&u.fill(),d&&u.stroke()}}})}(),function(){n.DrawNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0},n.DrawNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),n.DrawNode.WebGLRenderCmd.prototype.constructor=n.DrawNode.WebGLRenderCmd,n.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;n.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),e._render()}}(),n.stencilBits=-1,n.ClippingNode=_ccsg.Node.extend({alphaThreshold:0,inverted:!1,_stencil:null,_className:"ClippingNode",ctor:function(t){t=t||null,_ccsg.Node.prototype.ctor.call(this),this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},init:function(t){return this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits(),!0},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this),this._stencil.onEnter()},onEnterTransitionDidFinish:function(){_ccsg.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart(),_ccsg.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit(),_ccsg.Node.prototype.onExit.call(this)},getAlphaThreshold:function(){return this.alphaThreshold},setAlphaThreshold:function(t){this.alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&this._renderCmd.setStencil(t)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.ClippingNode.CanvasRenderCmd(this):new n.ClippingNode.WebGLRenderCmd(this)}});var c=n.ClippingNode.prototype;n.defineGetterSetter(c,"stencil",c.getStencil,c.setStencil),c.stencil,n.ClippingNode.create=function(t){return new n.ClippingNode(t)},function(){n.ClippingNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1,this._godhelpme=!1,this._clipElemType=!1,this._rendererSaveCmd=new n.CustomRenderCmd(this,this._saveCmdCallback),this._rendererClipCmd=new n.CustomRenderCmd(this,this._clipCmdCallback),this._rendererRestoreCmd=new n.CustomRenderCmd(this,this._restoreCmdCallback)};var t=n.ClippingNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.ClippingNode.CanvasRenderCmd,t.initStencilBits=function(){},t.setStencil=function(t){if(null!=t)if(this._node._stencil=t,t instanceof n.DrawNode){if(t._buffer)for(var e=0;e<t._buffer.length;e++)t._buffer[e].isFill=!1,t._buffer[e].isStroke=!1;t._renderCmd.rendering=function(e,i,r){i=i||n.view.getScaleX(),r=r||n.view.getScaleY();var s=e||n._renderContext,o=s.getContext(),a=this._transform;o.transform(a.a,a.b,a.c,a.d,a.tx*i,-a.ty*r);for(var c=0;c<t._buffer.length;c++){var h=t._buffer[c].verts,l=h[0];o.moveTo(l.x*i,-l.y*r);for(var d=h.length-1;d>0;d--)o.lineTo(h[d].x*i,-h[d].y*r)}}}else t._parent=this._node},t._saveCmdCallback=function(t,e,i){var r=t||n._renderContext,s=r.getContext();if(this._clipElemType){var o=n.ClippingNode.CanvasRenderCmd._getSharedCache(),a=s.canvas;o.width=a.width,o.height=a.height;var c=o.getContext("2d");c.drawImage(a,0,0)}else r.save(),s.beginPath(),r.setTransform(this._worldTransform,e,i),this._node.inverted&&(s.rect(0,0,s.canvas.width,-s.canvas.height),s.clip())},t._setStencilCompositionOperation=function(t){if(t){var e=this._node;if(t._renderCmd&&t._renderCmd._blendFuncStr&&(t._renderCmd._blendFuncStr=e.inverted?"destination-out":"destination-in"),t._children)for(var i=t._children,n=0,r=i.length;r>n;n++)this._setStencilCompositionOperation(i[n])}},t._clipCmdCallback=function(t){var e=this._node,i=t||n._renderContext,r=i.getContext();this._clipElemType?this._setStencilCompositionOperation(e._stencil):r.clip()},t._restoreCmdCallback=function(t){var e=n.ClippingNode.CanvasRenderCmd._getSharedCache(),i=t||n._renderContext,r=i.getContext();this._clipElemType?(r.save(),r.setTransform(1,0,0,1,0,0),r.globalCompositeOperation="destination-over",r.drawImage(e,0,0),r.restore(),this._dirtyFlag=0):i.restore()},t.transform=function(t,e){_ccsg.Node.CanvasRenderCmd.prototype.transform.call(this,t,e);var i=this._node;i._stencil&&i._stencil._renderCmd&&i._stencil._renderCmd.transform(this,e)},t._cangodhelpme=function(t){return(t===!0||t===!1)&&(n.ClippingNode.CanvasRenderCmd.prototype._godhelpme=t),n.ClippingNode.CanvasRenderCmd.prototype._godhelpme},t.visit=function(t){var e=this._node;if(e._visible){t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1);var i=this;if(this._clipElemType=!(!this._cangodhelpme()&&e._stencil instanceof n.DrawNode),!e._stencil||!e._stencil.visible)return void(this.inverted&&_ccsg.Node.CanvasRenderCmd.prototype.visit.call(this,t));if(this._syncStatus(t),n.renderer.pushRenderCommand(this._rendererSaveCmd),this._clipElemType?_ccsg.Node.CanvasRenderCmd.prototype.visit.call(this,t):e._stencil.visit(this),n.renderer.pushRenderCommand(this._rendererClipCmd),this._clipElemType)e._stencil.visit(i);else{var r,s=e._children;this._cangodhelpme(!0);var o=s.length;if(o>0)for(e.sortAllChildren(),r=0;o>r;r++)s[r]._renderCmd.visit(this);this._cangodhelpme(!1)}n.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}},n.ClippingNode.CanvasRenderCmd._sharedCache=null,n.ClippingNode.CanvasRenderCmd._getSharedCache=function(){return n.ClippingNode.CanvasRenderCmd._sharedCache||(n.ClippingNode.CanvasRenderCmd._sharedCache=document.createElement("canvas"))}}(),function(){n.ClippingNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!1,this._beforeVisitCmd=new n.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new n.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new n.CustomRenderCmd(this,this._onAfterVisit),this._currentStencilFunc=null,this._currentStencilRef=null,this._currentStencilValueMask=null,this._currentStencilFail=null,this._currentStencilPassDepthFail=null,this._currentStencilPassDepthPass=null,this._currentStencilWriteMask=null,this._currentStencilEnabled=null,this._currentDepthWriteMask=null,this._mask_layer_le=null};var t=n.ClippingNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.ClippingNode.WebGLRenderCmd,n.ClippingNode.WebGLRenderCmd._init_once=null,n.ClippingNode.WebGLRenderCmd._visit_once=null,n.ClippingNode.WebGLRenderCmd._layer=-1,t.initStencilBits=function(){n.ClippingNode.WebGLRenderCmd._init_once=!0,n.ClippingNode.WebGLRenderCmd._init_once&&(n.stencilBits=n._renderContext.getParameter(n._renderContext.STENCIL_BITS),n.stencilBits<=0&&n.log("Stencil buffer is not enabled."),n.ClippingNode.WebGLRenderCmd._init_once=!1)},t.transform=function(t,e){var i=this._node;_ccsg.Node.WebGLRenderCmd.prototype.transform.call(this,t,e),i._stencil&&i._stencil._renderCmd.transform(this,e)},t.visit=function(t){var e=this._node;if(e._visible){if(e._parent&&e._parent._renderCmd&&(this._curLevel=e._parent._renderCmd._curLevel+1),n.stencilBits<1)return void _ccsg.Node.WebGLRenderCmd.prototype.visit.call(this,t);if(!e._stencil||!e._stencil.visible)return void(e.inverted&&_ccsg.Node.WebGLRenderCmd.prototype.visit.call(this,t));if(n.ClippingNode.WebGLRenderCmd._layer+1===n.stencilBits)return n.ClippingNode.WebGLRenderCmd._visit_once=!0,n.ClippingNode.WebGLRenderCmd._visit_once&&(n.log("Nesting more than "+n.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),n.ClippingNode.WebGLRenderCmd._visit_once=!1),void _ccsg.Node.WebGLRenderCmd.prototype.visit.call(this,t);n.renderer.pushRenderCommand(this._beforeVisitCmd);var i=n.current_stack;i.stack.push(i.top),this._syncStatus(t),i.top=this._stackMatrix,e._stencil._renderCmd.visit(this),n.renderer.pushRenderCommand(this._afterDrawStencilCmd);var r=e._children;if(r&&r.length>0){var s=r.length;e.sortAllChildren();for(var o=0;s>o;o++)r[o]._renderCmd.visit(this)}n.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0,i.top=i.stack.pop()}},t.setStencil=function(t){var e=this._node;e._stencil&&(e._stencil._parent=null),e._stencil=t,e._stencil&&(e._stencil._parent=e)},t._drawFullScreenQuadClearStencil=function(){var t=n.projection_matrix_stack;t.push(),t.top.identity();var e=n.modelview_matrix_stack;e.push(),e.top.identity(),n._drawingUtil.drawSolidRect(n.p(-1,-1),n.p(1,1),n.color(255,255,255,255)),t.pop(),e.pop()},t._onBeforeVisit=function(t){var e=t||n._renderContext,i=this._node;n.ClippingNode.WebGLRenderCmd._layer++;var r=1<<n.ClippingNode.WebGLRenderCmd._layer,s=r-1;if(this._mask_layer_le=r|s,this._currentStencilEnabled=e.isEnabled(e.STENCIL_TEST),this._currentStencilWriteMask=e.getParameter(e.STENCIL_WRITEMASK),this._currentStencilFunc=e.getParameter(e.STENCIL_FUNC),this._currentStencilRef=e.getParameter(e.STENCIL_REF),this._currentStencilValueMask=e.getParameter(e.STENCIL_VALUE_MASK),this._currentStencilFail=e.getParameter(e.STENCIL_FAIL),this._currentStencilPassDepthFail=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),this._currentStencilPassDepthPass=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),e.enable(e.STENCIL_TEST),e.stencilMask(r),this._currentDepthWriteMask=e.getParameter(e.DEPTH_WRITEMASK),e.depthMask(!1),e.stencilFunc(e.NEVER,r,r),e.stencilOp(i.inverted?e.REPLACE:e.ZERO,e.KEEP,e.KEEP),this._drawFullScreenQuadClearStencil(),e.stencilFunc(e.NEVER,r,r),e.stencilOp(i.inverted?e.ZERO:e.REPLACE,e.KEEP,e.KEEP),i.alphaThreshold<1){var o=n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURECOLORALPHATEST),a=e.getUniformLocation(o.getProgram(),n.UNIFORM_ALPHA_TEST_VALUE_S);n.glUseProgram(o.getProgram()),o.setUniformLocationWith1f(a,i.alphaThreshold),n.setProgram(i._stencil,o)}},t._onAfterDrawStencil=function(t){var e=t||n._renderContext;e.depthMask(this._currentDepthWriteMask),e.stencilFunc(e.EQUAL,this._mask_layer_le,this._mask_layer_le),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t._onAfterVisit=function(t){var e=t||n._renderContext;e.stencilFunc(this._currentStencilFunc,this._currentStencilRef,this._currentStencilValueMask),e.stencilOp(this._currentStencilFail,this._currentStencilPassDepthFail,this._currentStencilPassDepthPass),e.stencilMask(this._currentStencilWriteMask),this._currentStencilEnabled||e.disable(e.STENCIL_TEST),n.ClippingNode.WebGLRenderCmd._layer--}}(),n.ACTION_TAG_INVALID=-1,n.Action=n._Class.extend({originalTarget:null,target:null,tag:n.ACTION_TAG_INVALID,ctor:function(){this.originalTarget=null,this.target=null,this.tag=n.ACTION_TAG_INVALID},copy:function(){return n.log("copy is deprecated. Please use clone instead."),this.clone()},clone:function(){var t=new n.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(t){n.log("[Action step]. override me")},update:function(t){n.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),n.action=function(){return new n.Action},n.Action.create=n.action,n.FiniteTimeAction=n.Action.extend({_duration:0,ctor:function(){n.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return n.log("cocos2d: FiniteTimeAction#reverse: Implement me"),null},clone:function(){return new n.FiniteTimeAction}}),n.Speed=n.Action.extend({_speed:0,_innerAction:null,ctor:function(t,e){n.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){if(!t)throw new Error("cc.Speed.initWithAction(): action must be non nil");return this._innerAction=t,this._speed=e,!0},clone:function(){var t=new n.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){n.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),n.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new n.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),n.speed=function(t,e){return new n.Speed(t,e)},n.Speed.create=n.speed,n.Follow=n.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,e){n.Action.prototype.ctor.call(this),this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=n.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new n.Follow,e=this._worldRect,i=new n.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,i),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)throw new Error("cc.Follow.initWithAction(): followedNode must be non nil");var i=this;e=e||n.rect(0,0,0,0),i._followedNode=t,i._worldRect=e,i._boundarySet=!n._rectEqualToZero(e),i._boundaryFullyCovered=!1;var r=n.director.getWinSize();return i._fullScreenSize=n.p(r.width,r.height),i._halfScreenSize=n.pMult(i._fullScreenSize,.5),i._boundarySet&&(i.leftBoundary=-(e.x+e.width-i._fullScreenSize.x),i.rightBoundary=-e.x,i.topBoundary=-e.y,i.bottomBoundary=-(e.y+e.height-i._fullScreenSize.y),i.rightBoundary<i.leftBoundary&&(i.rightBoundary=i.leftBoundary=(i.leftBoundary+i.rightBoundary)/2),i.topBoundary<i.bottomBoundary&&(i.topBoundary=i.bottomBoundary=(i.topBoundary+i.bottomBoundary)/2),i.topBoundary===i.bottomBoundary&&i.leftBoundary===i.rightBoundary&&(i._boundaryFullyCovered=!0)),!0},step:function(t){var e=this._followedNode.x,i=this._followedNode.y;if(e=this._halfScreenSize.x-e,i=this._halfScreenSize.y-i,this.target._renderCmd._dirtyFlag=0,this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(n.clampf(e,this.leftBoundary,this.rightBoundary),n.clampf(i,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(e,i)},isDone:function(){return!this._followedNode.running},stop:function(){this.target=null,n.Action.prototype.stop.call(this)}}),n.follow=function(t,e){return new n.Follow(t,e)},n.Follow.create=n.follow,n.ActionInterval=n.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(t){this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this.MAX_VALUE=2,this._repeatMethod=!1,this._speedMethod=!1,n.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?n.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new n.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||0===e.length)return t;for(var i=0,n=e.length;n>i;i++)t=e[i].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=1>e?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){n.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return n.log("cc.IntervalAction: reverse not implemented."),null},setAmplitudeRate:function(t){n.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){return n.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass."),0},speed:function(t){return 0>=t?(n.log("The speed parameter error"),this):(this._speedMethod=!0,this._speed*=t,this)},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||1>t?(n.log("The repeat parameter error"),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),n.actionInterval=function(t){return new n.ActionInterval(t)},n.ActionInterval.create=n.actionInterval,n.Sequence=n.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(t){n.ActionInterval.prototype.ctor.call(this),this._actions=[];var e=t instanceof Array?t:arguments,i=e.length-1;if(i>=0&&null==e[i]&&n.log("parameters should not be ending with null in Javascript"),i>=0){for(var r,s=e[0],o=1;i>o;o++)e[o]&&(r=s,s=n.Sequence._actionOneTwo(r,e[o]));this.initWithTwoActions(s,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");var i=t._duration+e._duration;return this.initWithDuration(i),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new n.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop(),n.Action.prototype.stop.call(this)},update:function(t){var e,i,n=0,r=this._split,s=this._actions,o=this._last;t=this._computeEaseTime(t),r>t?(e=0!==r?t/r:1,0===n&&1===o&&(s[1].update(0),s[1].stop())):(n=1,e=1===r?1:(t-r)/(1-r),-1===o&&(s[0].startWithTarget(this.target),s[0].update(1),s[0].stop()),o||(s[0].update(1),
s[0].stop())),i=s[n],o===n&&i.isDone()||(o!==n&&i.startWithTarget(this.target),e*=i._timesForRepeat,i.update(e>1?e%1:e),this._last=n)},reverse:function(){var t=n.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),n.sequence=function(t){var e=t instanceof Array?t:arguments;e.length>0&&null==e[e.length-1]&&n.log("parameters should not be ending with null in Javascript");for(var i,r,s,o;e&&e.length>0;)for(r=Array.prototype.shift.call(e),o=r._timesForRepeat||1,r._repeatMethod=!1,r._timesForRepeat=1,s=0,i||(i=r,s=1),s;o>s;s++)i=n.Sequence._actionOneTwo(i,r);return i},n.Sequence.create=n.sequence,n.Sequence._actionOneTwo=function(t,e){var i=new n.Sequence;return i.initWithTwoActions(t,e),i},n.Repeat=n.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(t,e){n.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){var i=t._duration*e;return this.initWithDuration(i)?(this._times=e,this._innerAction=t,t instanceof n.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0):!1},clone:function(){var t=new n.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,n.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),n.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/i,this._nextDt=r;t>=1&&this._total<n&&this._total++,this._actionInstant||(this._total===n?(e.update(1),e.stop()):e.update(t-(r-e._duration/i)))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new n.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),n.repeat=function(t,e){return new n.Repeat(t,e)},n.Repeat.create=n.repeat,n.RepeatForever=n.ActionInterval.extend({_innerAction:null,ctor:function(t){n.ActionInterval.prototype.ctor.call(this),this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.RepeatForever.initWithAction(): action must be non null");return this._innerAction=t,!0},clone:function(){var t=new n.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new n.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),n.repeatForever=function(t){return new n.RepeatForever(t)},n.RepeatForever.create=n.repeatForever,n.Spawn=n.ActionInterval.extend({_one:null,_two:null,ctor:function(t){n.ActionInterval.prototype.ctor.call(this),this._one=null,this._two=null;var e=t instanceof Array?t:arguments,i=e.length-1;if(i>=0&&null==e[i]&&n.log("parameters should not be ending with null in Javascript"),i>=0){for(var r,s=e[0],o=1;i>o;o++)e[o]&&(r=s,s=n.Spawn._actionOneTwo(r,e[o]));this.initWithTwoActions(s,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var i=!1,r=t._duration,s=e._duration;return this.initWithDuration(Math.max(r,s))&&(this._one=t,this._two=e,r>s?this._two=n.Sequence._actionOneTwo(e,n.delayTime(r-s)):s>r&&(this._one=n.Sequence._actionOneTwo(t,n.delayTime(s-r))),i=!0),i},clone:function(){var t=new n.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),n.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=n.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),n.spawn=function(t){var e=t instanceof Array?t:arguments;e.length>0&&null==e[e.length-1]&&n.log("parameters should not be ending with null in Javascript");for(var i=e[0],r=1;r<e.length;r++)null!=e[r]&&(i=n.Spawn._actionOneTwo(i,e[r]));return i},n.Spawn.create=n.spawn,n.Spawn._actionOneTwo=function(t,e){var i=new n.Spawn;return i.initWithTwoActions(t,e),i},n.RotateTo=n.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,e,i){n.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._dstAngleX=e||0,this._dstAngleY=i||this._dstAngleX,!0):!1},clone:function(){var t=new n.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.rotationX%360,i=this._dstAngleX-e;i>180&&(i-=360),-180>i&&(i+=360),this._startAngleX=e,this._diffAngleX=i,this._startAngleY=t.rotationY%360;var r=this._dstAngleY-this._startAngleY;r>180&&(r-=360),-180>r&&(r+=360),this._diffAngleY=r},reverse:function(){n.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*t,this.target.rotationY=this._startAngleY+this._diffAngleY*t)}}),n.rotateTo=function(t,e,i){return new n.RotateTo(t,e,i)},n.RotateTo.create=n.rotateTo,n.RotateBy=n.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,e,i){n.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._angleX=e||0,this._angleY=i||this._angleX,!0):!1},clone:function(){var t=new n.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angleX,this._angleY),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngleX=t.rotationX,this._startAngleY=t.rotationY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._angleX*t,this.target.rotationY=this._startAngleY+this._angleY*t)},reverse:function(){var t=new n.RotateBy(this._duration,-this._angleX,-this._angleY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),n.rotateBy=function(t,e,i){return new n.RotateBy(t,e,i)},n.RotateBy.create=n.rotateBy,n.MoveBy=n.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,e,i){n.ActionInterval.prototype.ctor.call(this),this._positionDelta=n.p(0,0),this._startPosition=n.p(0,0),this._previousPosition=n.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0):!1},clone:function(){var t=new n.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._positionDelta.x*t,i=this._positionDelta.y*t,r=this._startPosition;if(n.ENABLE_STACKABLE_ACTIONS){var s=this.target.getPositionX(),o=this.target.getPositionY(),a=this._previousPosition;r.x=r.x+s-a.x,r.y=r.y+o-a.y,e+=r.x,i+=r.y,a.x=e,a.y=i,this.target.setPosition(e,i)}else this.target.setPosition(r.x+e,r.y+i)}},reverse:function(){var t=new n.MoveBy(this._duration,n.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),n.moveBy=function(t,e,i){return new n.MoveBy(t,e,i)},n.MoveBy.create=n.moveBy,n.MoveTo=n.MoveBy.extend({_endPosition:null,ctor:function(t,e,i){n.MoveBy.prototype.ctor.call(this),this._endPosition=n.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return n.MoveBy.prototype.initWithDuration.call(this,t,e,i)?(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0):!1},clone:function(){var t=new n.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){n.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.getPositionX(),this._positionDelta.y=this._endPosition.y-t.getPositionY()}}),n.moveTo=function(t,e,i){return new n.MoveTo(t,e,i)},n.MoveTo.create=n.moveTo,n.SkewTo=n.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){n.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var r=!1;return n.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,r=!0),r},clone:function(){var t=new n.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),n.skewTo=function(t,e,i){return new n.SkewTo(t,e,i)},n.SkewTo.create=n.skewTo,n.SkewBy=n.SkewTo.extend({ctor:function(t,e,i){n.SkewTo.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var r=!1;return n.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,r=!0),r},clone:function(){var t=new n.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){n.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new n.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),n.skewBy=function(t,e,i){return new n.SkewBy(t,e,i)},n.SkewBy.create=n.skewBy,n.JumpBy=n.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,e,i,r,s){n.ActionInterval.prototype.ctor.call(this),this._startPosition=n.p(0,0),this._previousPosition=n.p(0,0),this._delta=n.p(0,0),void 0!==r&&this.initWithDuration(t,e,i,r,s)},initWithDuration:function(t,e,i,r,s){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(void 0===s&&(s=r,r=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=r,this._jumps=s,!0):!1},clone:function(){var t=new n.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=t*this._jumps%1,i=4*this._height*e*(1-e);i+=this._delta.y*t;var r=this._delta.x*t,s=this._startPosition;if(n.ENABLE_STACKABLE_ACTIONS){var o=this.target.getPositionX(),a=this.target.getPositionY(),c=this._previousPosition;s.x=s.x+o-c.x,s.y=s.y+a-c.y,r+=s.x,i+=s.y,c.x=r,c.y=i,this.target.setPosition(r,i)}else this.target.setPosition(s.x+r,s.y+i)}},reverse:function(){var t=new n.JumpBy(this._duration,n.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),n.jumpBy=function(t,e,i,r,s){return new n.JumpBy(t,e,i,r,s)},n.JumpBy.create=n.jumpBy,n.JumpTo=n.JumpBy.extend({_endPosition:null,ctor:function(t,e,i,r,s){n.JumpBy.prototype.ctor.call(this),this._endPosition=n.p(0,0),void 0!==r&&this.initWithDuration(t,e,i,r,s)},initWithDuration:function(t,e,i,r,s){return n.JumpBy.prototype.initWithDuration.call(this,t,e,i,r,s)?(void 0===s&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0):!1},startWithTarget:function(t){n.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new n.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),n.jumpTo=function(t,e,i,r,s){return new n.JumpTo(t,e,i,r,s)},n.JumpTo.create=n.jumpTo,n.bezierAt=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},n.BezierBy=n.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,e){n.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=n.p(0,0),this._previousPosition=n.p(0,0),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._config=e,!0):!1},clone:function(){var t=new n.BezierBy;this._cloneDecoration(t);for(var e=[],i=0;i<this._config.length;i++){var r=this._config[i];e.push(n.p(r.x,r.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._config,i=0,r=e[0].x,s=e[1].x,o=e[2].x,a=0,c=e[0].y,h=e[1].y,l=e[2].y,d=n.bezierAt(i,r,s,o,t),u=n.bezierAt(a,c,h,l,t),_=this._startPosition;if(n.ENABLE_STACKABLE_ACTIONS){var f=this.target.getPositionX(),p=this.target.getPositionY(),g=this._previousPosition;_.x=_.x+f-g.x,_.y=_.y+p-g.y,d+=_.x,u+=_.y,g.x=d,g.y=u,this.target.setPosition(d,u)}else this.target.setPosition(_.x+d,_.y+u)}},reverse:function(){var t=this._config,e=[n.pAdd(t[1],n.pNeg(t[2])),n.pAdd(t[0],n.pNeg(t[2])),n.pNeg(t[2])],i=new n.BezierBy(this._duration,e);return this._cloneDecoration(i),this._reverseEaseList(i),i}}),n.bezierBy=function(t,e){return new n.BezierBy(t,e)},n.BezierBy.create=n.bezierBy,n.BezierTo=n.BezierBy.extend({_toConfig:null,ctor:function(t,e){n.BezierBy.prototype.ctor.call(this),this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._toConfig=e,!0):!1},clone:function(){var t=new n.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){n.BezierBy.prototype.startWithTarget.call(this,t);var e=this._startPosition,i=this._toConfig,r=this._config;r[0]=n.pSub(i[0],e),r[1]=n.pSub(i[1],e),r[2]=n.pSub(i[2],e)}}),n.bezierTo=function(t,e){return new n.BezierTo(t,e)},n.BezierTo.create=n.bezierTo,n.ScaleTo=n.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){n.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0):!1},clone:function(){var t=new n.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}}),n.scaleTo=function(t,e,i){return new n.ScaleTo(t,e,i)},n.ScaleTo.create=n.scaleTo,n.ScaleBy=n.ScaleTo.extend({startWithTarget:function(t){n.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new n.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new n.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),n.scaleBy=function(t,e,i){return new n.ScaleBy(t,e,i)},n.ScaleBy.create=n.scaleBy,n.Blink=n.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(t,e){n.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._times=e,!0):!1},clone:function(){var t=new n.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){if(t=this._computeEaseTime(t),this.target&&!this.isDone()){var e=1/this._times,i=t%e;this.target.visible=i>e/2}},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.visible},stop:function(){this.target.visible=this._originalState,n.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new n.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),n.blink=function(t,e){return new n.Blink(t,e)},n.Blink.create=n.blink,n.FadeTo=n.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,e){n.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._toOpacity=e,!0):!1},clone:function(){var t=new n.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),n.fadeTo=function(t,e){return new n.FadeTo(t,e)},n.FadeTo.create=n.fadeTo,n.FadeIn=n.FadeTo.extend({_reverseAction:null,ctor:function(t){n.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,255)},reverse:function(){var t=new n.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new n.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),n.FadeTo.prototype.startWithTarget.call(this,t)}}),n.fadeIn=function(t){return new n.FadeIn(t)},n.FadeIn.create=n.fadeIn,n.FadeOut=n.FadeTo.extend({ctor:function(t){n.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,0)},reverse:function(){var t=new n.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new n.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),n.fadeOut=function(t){return new n.FadeOut(t)},n.FadeOut.create=n.fadeOut,n.TintTo=n.ActionInterval.extend({_to:null,_from:null,ctor:function(t,e,i,r){n.ActionInterval.prototype.ctor.call(this),this._to=n.color(0,0,0),this._from=n.color(0,0,0),void 0!==r&&this.initWithDuration(t,e,i,r)},initWithDuration:function(t,e,i,r){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._to=n.color(e,i,r),!0):!1},clone:function(){var t=new n.TintTo;this._cloneDecoration(t);var e=this._to;return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&this.target.setColor(n.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),n.tintTo=function(t,e,i,r){return new n.TintTo(t,e,i,r)},n.TintTo.create=n.tintTo,n.TintBy=n.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,e,i,r){n.ActionInterval.prototype.ctor.call(this),void 0!==r&&this.initWithDuration(t,e,i,r)},initWithDuration:function(t,e,i,r){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._deltaR=e,this._deltaG=i,this._deltaB=r,!0):!1},clone:function(){var t=new n.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.color;this._fromR=e.r,this._fromG=e.g,this._fromB=e.b},update:function(t){t=this._computeEaseTime(t),this.target.color=n.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new n.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),n.tintBy=function(t,e,i,r){return new n.TintBy(t,e,i,r)},n.TintBy.create=n.tintBy,n.DelayTime=n.ActionInterval.extend({update:function(t){},reverse:function(){var t=new n.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new n.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),n.delayTime=function(t){return new n.DelayTime(t)},n.DelayTime.create=n.delayTime,n.ReverseTime=n.ActionInterval.extend({_other:null,ctor:function(t){n.ActionInterval.prototype.ctor.call(this),this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ReverseTime.initWithAction(): action must be non null");if(t===this._other)throw new Error("cc.ReverseTime.initWithAction(): the action was already passed in.");return n.ActionInterval.prototype.initWithDuration.call(this,t._duration)?(this._other=t,!0):!1},clone:function(){var t=new n.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),n.Action.prototype.stop.call(this)}}),n.reverseTime=function(t){return new n.ReverseTime(t)},n.ReverseTime.create=n.reverseTime,n.Animate=n.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(t){n.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(t){if(!t)throw new Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var e=t.getDuration();if(this.initWithDuration(e*t.getLoops())){this._nextFrame=0,this.setAnimation(t),this._origFrame=null,this._executedLoops=0;var i=this._splitTimes;i.length=0;var r=0,s=e/t.getTotalDelayUnits(),o=t.getFrames();n.js.array.verifyType(o,n.AnimationFrame);for(var a=0;a<o.length;a++){var c=o[a],h=r*s/e;r+=c.getDelayUnits(),i.push(h)}return!0}return!1},clone:function(){var t=new n.Animate;return this._cloneDecoration(t),t.initWithAnimation(this._animation.clone()),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._animation.getRestoreOriginalFrame()&&(this._origFrame=t.displayFrame()),this._nextFrame=0,this._executedLoops=0},update:function(t){if(t=this._computeEaseTime(t),1>t){t*=this._animation.getLoops();var e=0|t;e>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),t%=1}for(var i=this._animation.getFrames(),n=i.length,r=this._splitTimes,s=this._nextFrame;n>s&&r[s]<=t;s++)_currFrameIndex=s,this.target.setSpriteFrame(i[_currFrameIndex].getSpriteFrame()),this._nextFrame=s+1},reverse:function(){var t=this._animation,e=t.getFrames(),i=[];if(n.js.array.verifyType(e,n.AnimationFrame),e.length>0)for(var r=e.length-1;r>=0;r--){var s=e[r];if(!s)break;i.push(s.clone())}var o=new n.Animation(i,t.getDelayPerUnit(),t.getLoops());o.setRestoreOriginalFrame(t.getRestoreOriginalFrame());var a=new n.Animate(o);return this._cloneDecoration(a),this._reverseEaseList(a),a},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame),n.Action.prototype.stop.call(this)}}),n.animate=function(t){return new n.Animate(t)},n.Animate.create=n.animate,n.TargetedAction=n.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,e){n.ActionInterval.prototype.ctor.call(this),e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return this.initWithDuration(e._duration)?(this._forcedTarget=t,this._action=e,!0):!1},clone:function(){var t=new n.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),n.targetedAction=function(t,e){return new n.TargetedAction(t,e)},n.TargetedAction.create=n.targetedAction,n.ActionInstant=n.FiniteTimeAction.extend({isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new n.ActionInstant}}),n.Show=n.ActionInstant.extend({update:function(t){this.target.visible=!0},reverse:function(){return new n.Hide},clone:function(){return new n.Show}}),n.show=function(){return new n.Show},n.Show.create=n.show,n.Hide=n.ActionInstant.extend({update:function(t){this.target.visible=!1},reverse:function(){return new n.Show},clone:function(){return new n.Hide}}),n.hide=function(){return new n.Hide},n.Hide.create=n.hide,n.ToggleVisibility=n.ActionInstant.extend({update:function(t){this.target.visible=!this.target.visible},reverse:function(){return new n.ToggleVisibility},clone:function(){return new n.ToggleVisibility}}),n.toggleVisibility=function(){return new n.ToggleVisibility},n.ToggleVisibility.create=n.toggleVisibility,n.RemoveSelf=n.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(t){n.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new n.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new n.RemoveSelf(this._isNeedCleanUp)}}),n.removeSelf=function(t){return new n.RemoveSelf(t)},n.RemoveSelf.create=n.removeSelf,n.FlipX=n.ActionInstant.extend({_flippedX:!1,ctor:function(t){n.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.flippedX=this._flippedX},reverse:function(){return new n.FlipX(!this._flippedX)},clone:function(){var t=new n.FlipX;return t.initWithFlipX(this._flippedX),t}}),n.flipX=function(t){return new n.FlipX(t)},n.FlipX.create=n.flipX,n.FlipY=n.ActionInstant.extend({_flippedY:!1,ctor:function(t){n.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.flippedY=this._flippedY},reverse:function(){return new n.FlipY(!this._flippedY)},clone:function(){var t=new n.FlipY;return t.initWithFlipY(this._flippedY),t}}),n.flipY=function(t){return new n.FlipY(t)},n.FlipY.create=n.flipY,n.Place=n.ActionInstant.extend({_x:0,_y:0,ctor:function(t,e){n.FiniteTimeAction.prototype.ctor.call(this),this._x=0,this._y=0,void 0!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new n.Place;return t.initWithPosition(this._x,this._y),t}}),n.place=function(t,e){return new n.Place(t,e)},n.Place.create=n.place,n.CallFunc=n.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(t,e,i){n.FiniteTimeAction.prototype.ctor.call(this),this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),i&&(this._data=i),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new n.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),n.callFunc=function(t,e,i){return new n.CallFunc(t,e,i)},n.CallFunc.create=n.callFunc,n.ActionEase=n.ActionInterval.extend({_inner:null,ctor:function(t){n.ActionInterval.prototype.ctor.call(this),t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ActionEase.initWithAction(): action must be non nil");return this.initWithDuration(t.getDuration())?(this._inner=t,!0):!1},clone:function(){var t=new n.ActionEase;return t.initWithAction(this._inner.clone()),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),n.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new n.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}}),n.actionEase=function(t){return new n.ActionEase(t)},n.ActionEase.create=n.actionEase,n.EaseRateAction=n.ActionEase.extend({_rate:0,ctor:function(t,e){n.ActionEase.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,e){return n.ActionEase.prototype.initWithAction.call(this,t)?(this._rate=e,!0):!1},clone:function(){var t=new n.EaseRateAction;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new n.EaseRateAction(this._inner.reverse(),1/this._rate)}}),n.easeRateAction=function(t,e){
return new n.EaseRateAction(t,e)},n.EaseRateAction.create=n.easeRateAction,n.EaseIn=n.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new n.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new n.EaseIn;return t.initWithAction(this._inner.clone(),this._rate),t}}),n.EaseIn.create=function(t,e){return new n.EaseIn(t,e)},n.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return n.easeIn(1/this._rate)}}},n.EaseOut=n.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new n.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new n.EaseOut;return t.initWithAction(this._inner.clone(),this._rate),t}}),n.EaseOut.create=function(t,e){return new n.EaseOut(t,e)},n.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return n.easeOut(1/this._rate)}}},n.EaseInOut=n.EaseRateAction.extend({update:function(t){t*=2,this._inner.update(1>t?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate))},clone:function(){var t=new n.EaseInOut;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new n.EaseInOut(this._inner.reverse(),this._rate)}}),n.EaseInOut.create=function(t,e){return new n.EaseInOut(t,e)},n.easeInOut=function(t){return{_rate:t,easing:function(t){return t*=2,1>t?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return n.easeInOut(this._rate)}}},n.EaseExponentialIn=n.ActionEase.extend({update:function(t){this._inner.update(0===t?0:Math.pow(2,10*(t-1)))},reverse:function(){return new n.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new n.EaseExponentialIn;return t.initWithAction(this._inner.clone()),t}}),n.EaseExponentialIn.create=function(t){return new n.EaseExponentialIn(t)},n._easeExponentialInObj={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return n._easeExponentialOutObj}},n.easeExponentialIn=function(){return n._easeExponentialInObj},n.EaseExponentialOut=n.ActionEase.extend({update:function(t){this._inner.update(1===t?1:-Math.pow(2,-10*t)+1)},reverse:function(){return new n.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new n.EaseExponentialOut;return t.initWithAction(this._inner.clone()),t}}),n.EaseExponentialOut.create=function(t){return new n.EaseExponentialOut(t)},n._easeExponentialOutObj={easing:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},reverse:function(){return n._easeExponentialInObj}},n.easeExponentialOut=function(){return n._easeExponentialOutObj},n.EaseExponentialInOut=n.ActionEase.extend({update:function(t){1!==t&&0!==t&&(t*=2,t=1>t?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)),this._inner.update(t)},reverse:function(){return new n.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new n.EaseExponentialInOut;return t.initWithAction(this._inner.clone()),t}}),n.EaseExponentialInOut.create=function(t){return new n.EaseExponentialInOut(t)},n._easeExponentialInOutObj={easing:function(t){return 1!==t&&0!==t?(t*=2,1>t?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)):t},reverse:function(){return n._easeExponentialInOutObj}},n.easeExponentialInOut=function(){return n._easeExponentialInOutObj},n.EaseSineIn=n.ActionEase.extend({update:function(t){t=0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1,this._inner.update(t)},reverse:function(){return new n.EaseSineOut(this._inner.reverse())},clone:function(){var t=new n.EaseSineIn;return t.initWithAction(this._inner.clone()),t}}),n.EaseSineIn.create=function(t){return new n.EaseSineIn(t)},n._easeSineInObj={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return n._easeSineOutObj}},n.easeSineIn=function(){return n._easeSineInObj},n.EaseSineOut=n.ActionEase.extend({update:function(t){t=0===t||1===t?t:Math.sin(t*Math.PI/2),this._inner.update(t)},reverse:function(){return new n.EaseSineIn(this._inner.reverse())},clone:function(){var t=new n.EaseSineOut;return t.initWithAction(this._inner.clone()),t}}),n.EaseSineOut.create=function(t){return new n.EaseSineOut(t)},n._easeSineOutObj={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return n._easeSineInObj}},n.easeSineOut=function(){return n._easeSineOutObj},n.EaseSineInOut=n.ActionEase.extend({update:function(t){t=0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1),this._inner.update(t)},clone:function(){var t=new n.EaseSineInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseSineInOut(this._inner.reverse())}}),n.EaseSineInOut.create=function(t){return new n.EaseSineInOut(t)},n._easeSineInOutObj={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return n._easeSineInOutObj}},n.easeSineInOut=function(){return n._easeSineInOutObj},n.EaseElastic=n.ActionEase.extend({_period:.3,ctor:function(t,e){n.ActionEase.prototype.ctor.call(this),t&&this.initWithAction(t,e)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,e){return n.ActionEase.prototype.initWithAction.call(this,t),this._period=null==e?.3:e,!0},reverse:function(){return n.log("cc.EaseElastic.reverse(): it should be overridden in subclass."),null},clone:function(){var t=new n.EaseElastic;return t.initWithAction(this._inner.clone(),this._period),t}}),n.EaseElastic.create=function(t,e){return new n.EaseElastic(t,e)},n.EaseElasticIn=n.EaseElastic.extend({update:function(t){var e=0;if(0===t||1===t)e=t;else{var i=this._period/4;t-=1,e=-Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/this._period)}this._inner.update(e)},reverse:function(){return new n.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new n.EaseElasticIn;return t.initWithAction(this._inner.clone(),this._period),t}}),n.EaseElasticIn.create=function(t,e){return new n.EaseElasticIn(t,e)},n._easeElasticInObj={easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return n._easeElasticOutObj}},n.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return n.easeElasticOut(this._period)}}:n._easeElasticInObj},n.EaseElasticOut=n.EaseElastic.extend({update:function(t){var e=0;if(0===t||1===t)e=t;else{var i=this._period/4;e=Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/this._period)+1}this._inner.update(e)},reverse:function(){return new n.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new n.EaseElasticOut;return t.initWithAction(this._inner.clone(),this._period),t}}),n.EaseElasticOut.create=function(t,e){return new n.EaseElasticOut(t,e)},n._easeElasticOutObj={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return n._easeElasticInObj}},n.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return n.easeElasticIn(this._period)}}:n._easeElasticOutObj},n.EaseElasticInOut=n.EaseElastic.extend({update:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{t=2*t,i||(i=this._period=.3*1.5);var n=i/4;t-=1,e=0>t?-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}this._inner.update(e)},reverse:function(){return new n.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new n.EaseElasticInOut;return t.initWithAction(this._inner.clone(),this._period),t}}),n.EaseElasticInOut.create=function(t,e){return new n.EaseElasticInOut(t,e)},n.easeElasticInOut=function(t){return t=t||.3,{_period:t,easing:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{t=2*t,i||(i=this._period=.3*1.5);var n=i/4;t-=1,e=0>t?-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}return e},reverse:function(){return n.easeElasticInOut(this._period)}}},n.EaseBounce=n.ActionEase.extend({bounceTime:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?(t-=1.5/2.75,7.5625*t*t+.75):2.5/2.75>t?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)},clone:function(){var t=new n.EaseBounce;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseBounce(this._inner.reverse())}}),n.EaseBounce.create=function(t){return new n.EaseBounce(t)},n.EaseBounceIn=n.EaseBounce.extend({update:function(t){var e=1-this.bounceTime(1-t);this._inner.update(e)},reverse:function(){return new n.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new n.EaseBounceIn;return t.initWithAction(this._inner.clone()),t}}),n.EaseBounceIn.create=function(t){return new n.EaseBounceIn(t)},n._bounceTime=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?(t-=1.5/2.75,7.5625*t*t+.75):2.5/2.75>t?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)},n._easeBounceInObj={easing:function(t){return 1-n._bounceTime(1-t)},reverse:function(){return n._easeBounceOutObj}},n.easeBounceIn=function(){return n._easeBounceInObj},n.EaseBounceOut=n.EaseBounce.extend({update:function(t){var e=this.bounceTime(t);this._inner.update(e)},reverse:function(){return new n.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new n.EaseBounceOut;return t.initWithAction(this._inner.clone()),t}}),n.EaseBounceOut.create=function(t){return new n.EaseBounceOut(t)},n._easeBounceOutObj={easing:function(t){return n._bounceTime(t)},reverse:function(){return n._easeBounceInObj}},n.easeBounceOut=function(){return n._easeBounceOutObj},n.EaseBounceInOut=n.EaseBounce.extend({update:function(t){var e=0;.5>t?(t=2*t,e=.5*(1-this.bounceTime(1-t))):e=.5*this.bounceTime(2*t-1)+.5,this._inner.update(e)},clone:function(){var t=new n.EaseBounceInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseBounceInOut(this._inner.reverse())}}),n.EaseBounceInOut.create=function(t){return new n.EaseBounceInOut(t)},n._easeBounceInOutObj={easing:function(t){var e;return.5>t?(t=2*t,e=.5*(1-n._bounceTime(1-t))):e=.5*n._bounceTime(2*t-1)+.5,e},reverse:function(){return n._easeBounceInOutObj}},n.easeBounceInOut=function(){return n._easeBounceInOutObj},n.EaseBackIn=n.ActionEase.extend({update:function(t){var e=1.70158;t=0===t||1===t?t:t*t*((e+1)*t-e),this._inner.update(t)},reverse:function(){return new n.EaseBackOut(this._inner.reverse())},clone:function(){var t=new n.EaseBackIn;return t.initWithAction(this._inner.clone()),t}}),n.EaseBackIn.create=function(t){return new n.EaseBackIn(t)},n._easeBackInObj={easing:function(t){var e=1.70158;return 0===t||1===t?t:t*t*((e+1)*t-e)},reverse:function(){return n._easeBackOutObj}},n.easeBackIn=function(){return n._easeBackInObj},n.EaseBackOut=n.ActionEase.extend({update:function(t){var e=1.70158;t-=1,this._inner.update(t*t*((e+1)*t+e)+1)},reverse:function(){return new n.EaseBackIn(this._inner.reverse())},clone:function(){var t=new n.EaseBackOut;return t.initWithAction(this._inner.clone()),t}}),n.EaseBackOut.create=function(t){return new n.EaseBackOut(t)},n._easeBackOutObj={easing:function(t){var e=1.70158;return t-=1,t*t*((e+1)*t+e)+1},reverse:function(){return n._easeBackInObj}},n.easeBackOut=function(){return n._easeBackOutObj},n.EaseBackInOut=n.ActionEase.extend({update:function(t){var e=2.5949095;t=2*t,1>t?this._inner.update(t*t*((e+1)*t-e)/2):(t-=2,this._inner.update(t*t*((e+1)*t+e)/2+1))},clone:function(){var t=new n.EaseBackInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseBackInOut(this._inner.reverse())}}),n.EaseBackInOut.create=function(t){return new n.EaseBackInOut(t)},n._easeBackInOutObj={easing:function(t){var e=2.5949095;return t=2*t,1>t?t*t*((e+1)*t-e)/2:(t-=2,t*t*((e+1)*t+e)/2+1)},reverse:function(){return n._easeBackInOutObj}},n.easeBackInOut=function(){return n._easeBackInOutObj},n.EaseBezierAction=n.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){n.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},update:function(t){var e=this._updateTime(this._p0,this._p1,this._p2,this._p3,t);this._inner.update(e)},clone:function(){var t=new n.EaseBezierAction;return t.initWithAction(this._inner.clone()),t.setBezierParamer(this._p0,this._p1,this._p2,this._p3),t},reverse:function(){var t=new n.EaseBezierAction(this._inner.reverse());return t.setBezierParamer(this._p3,this._p2,this._p1,this._p0),t},setBezierParamer:function(t,e,i,n){this._p0=t||0,this._p1=e||0,this._p2=i||0,this._p3=n||0}}),n.EaseBezierAction.create=function(t){return new n.EaseBezierAction(t)},n.easeBezierAction=function(t,e,i,r){return{easing:function(s){return n.EaseBezierAction.prototype._updateTime(t,e,i,r,s)},reverse:function(){return n.easeBezierAction(r,i,e,t)}}},n.EaseQuadraticActionIn=n.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseQuadraticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseQuadraticActionIn(this._inner.reverse())}}),n.EaseQuadraticActionIn.create=function(t){return new n.EaseQuadraticActionIn(t)},n._easeQuadraticActionIn={easing:n.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return n._easeQuadraticActionIn}},n.easeQuadraticActionIn=function(){return n._easeQuadraticActionIn},n.EaseQuadraticActionOut=n.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseQuadraticActionOut;return t.initWithAction(),t},reverse:function(){return new n.EaseQuadraticActionOut(this._inner.reverse())}}),n.EaseQuadraticActionOut.create=function(t){return new n.EaseQuadraticActionOut(t)},n._easeQuadraticActionOut={easing:n.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return n._easeQuadraticActionOut}},n.easeQuadraticActionOut=function(){return n._easeQuadraticActionOut},n.EaseQuadraticActionInOut=n.ActionEase.extend({_updateTime:function(t){var e=t;return t*=2,1>t?e=t*t*.5:(--t,e=-.5*(t*(t-2)-1)),e},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseQuadraticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseQuadraticActionInOut(this._inner.reverse())}}),n.EaseQuadraticActionInOut.create=function(t){return new n.EaseQuadraticActionInOut(t)},n._easeQuadraticActionInOut={easing:n.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return n._easeQuadraticActionInOut}},n.easeQuadraticActionInOut=function(){return n._easeQuadraticActionInOut},n.EaseQuarticActionIn=n.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseQuarticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseQuarticActionIn(this._inner.reverse())}}),n.EaseQuarticActionIn.create=function(t){return new n.EaseQuarticActionIn(t)},n._easeQuarticActionIn={easing:n.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return n._easeQuarticActionIn}},n.easeQuarticActionIn=function(){return n._easeQuarticActionIn},n.EaseQuarticActionOut=n.ActionEase.extend({_updateTime:function(t){return t-=1,-(t*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseQuarticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseQuarticActionOut(this._inner.reverse())}}),n.EaseQuarticActionOut.create=function(t){return new n.EaseQuarticActionOut(t)},n._easeQuarticActionOut={easing:n.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return n._easeQuarticActionOut}},n.easeQuarticActionOut=function(){return n._easeQuarticActionOut},n.EaseQuarticActionInOut=n.ActionEase.extend({_updateTime:function(t){return t=2*t,1>t?.5*t*t*t*t:(t-=2,-.5*(t*t*t*t-2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseQuarticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseQuarticActionInOut(this._inner.reverse())}}),n.EaseQuarticActionInOut.create=function(t){return new n.EaseQuarticActionInOut(t)},n._easeQuarticActionInOut={easing:n.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return n._easeQuarticActionInOut}},n.easeQuarticActionInOut=function(){return n._easeQuarticActionInOut},n.EaseQuinticActionIn=n.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseQuinticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseQuinticActionIn(this._inner.reverse())}}),n.EaseQuinticActionIn.create=function(t){return new n.EaseQuinticActionIn(t)},n._easeQuinticActionIn={easing:n.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return n._easeQuinticActionIn}},n.easeQuinticActionIn=function(){return n._easeQuinticActionIn},n.EaseQuinticActionOut=n.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseQuinticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseQuinticActionOut(this._inner.reverse())}}),n.EaseQuinticActionOut.create=function(t){return new n.EaseQuinticActionOut(t)},n._easeQuinticActionOut={easing:n.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return n._easeQuinticActionOut}},n.easeQuinticActionOut=function(){return n._easeQuinticActionOut},n.EaseQuinticActionInOut=n.ActionEase.extend({_updateTime:function(t){return t=2*t,1>t?.5*t*t*t*t*t:(t-=2,.5*(t*t*t*t*t+2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseQuinticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseQuinticActionInOut(this._inner.reverse())}}),n.EaseQuinticActionInOut.create=function(t){return new n.EaseQuinticActionInOut(t)},n._easeQuinticActionInOut={easing:n.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return n._easeQuinticActionInOut}},n.easeQuinticActionInOut=function(){return n._easeQuinticActionInOut},n.EaseCircleActionIn=n.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseCircleActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseCircleActionIn(this._inner.reverse())}}),n.EaseCircleActionIn.create=function(t){return new n.EaseCircleActionIn(t)},n._easeCircleActionIn={easing:n.EaseCircleActionIn.prototype._updateTime,reverse:function(){return n._easeCircleActionIn}},n.easeCircleActionIn=function(){return n._easeCircleActionIn},n.EaseCircleActionOut=n.ActionEase.extend({_updateTime:function(t){return t-=1,Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseCircleActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseCircleActionOut(this._inner.reverse())}}),n.EaseCircleActionOut.create=function(t){return new n.EaseCircleActionOut(t)},n._easeCircleActionOut={easing:n.EaseCircleActionOut.prototype._updateTime,reverse:function(){return n._easeCircleActionOut}},n.easeCircleActionOut=function(){return n._easeCircleActionOut},n.EaseCircleActionInOut=n.ActionEase.extend({_updateTime:function(t){return t=2*t,1>t?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseCircleActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseCircleActionInOut(this._inner.reverse())}}),n.EaseCircleActionInOut.create=function(t){return new n.EaseCircleActionInOut(t)},n._easeCircleActionInOut={easing:n.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return n._easeCircleActionInOut}},n.easeCircleActionInOut=function(){return n._easeCircleActionInOut},n.EaseCubicActionIn=n.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseCubicActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseCubicActionIn(this._inner.reverse())}}),n.EaseCubicActionIn.create=function(t){return new n.EaseCubicActionIn(t)},n._easeCubicActionIn={easing:n.EaseCubicActionIn.prototype._updateTime,reverse:function(){return n._easeCubicActionIn}},n.easeCubicActionIn=function(){return n._easeCubicActionIn},n.EaseCubicActionOut=n.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseCubicActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseCubicActionOut(this._inner.reverse())}}),n.EaseCubicActionOut.create=function(t){return new n.EaseCubicActionOut(t)},n._easeCubicActionOut={easing:n.EaseCubicActionOut.prototype._updateTime,reverse:function(){return n._easeCubicActionOut}},n.easeCubicActionOut=function(){return n._easeCubicActionOut},n.EaseCubicActionInOut=n.ActionEase.extend({_updateTime:function(t){return t=2*t,1>t?.5*t*t*t:(t-=2,.5*(t*t*t+2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new n.EaseCubicActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new n.EaseCubicActionInOut(this._inner.reverse())}}),n.EaseCubicActionInOut.create=function(t){return new n.EaseCubicActionInOut(t)},n._easeCubicActionInOut={easing:n.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return n._easeCubicActionInOut}},n.easeCubicActionInOut=function(){return n._easeCubicActionInOut},n.cardinalSplineAt=function(t,e,i,r,s,o){var a=o*o,c=a*o,h=(1-s)/2,l=h*(-c+2*a-o),d=h*(-c+a)+(2*c-3*a+1),u=h*(c-2*a+o)+(-2*c+3*a),_=h*(c-a),f=t.x*l+e.x*d+i.x*u+r.x*_,p=t.y*l+e.y*d+i.y*u+r.y*_;return n.p(f,p)},n.reverseControlPoints=function(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(n.p(t[i].x,t[i].y));return e},n.cloneControlPoints=function(t){for(var e=[],i=0;i<t.length;i++)e.push(n.p(t[i].x,t[i].y));return e},n.copyControlPoints=n.cloneControlPoints,n.getControlPointAt=function(t,e){var i=Math.min(t.length-1,Math.max(e,0));return t[i]},n.reverseControlPointsInline=function(t){for(var e=t.length,i=0|e/2,n=0;i>n;++n){var r=t[n];t[n]=t[e-n-1],t[e-n-1]=r}},n.CardinalSplineTo=n.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(t,e,i){n.ActionInterval.prototype.ctor.call(this),this._points=[],void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(!e||0===e.length)throw new Error("Invalid configuration. It must at least have one control point");return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this.setPoints(e),this._tension=i,!0):!1},clone:function(){var t=new n.CardinalSplineTo;return t.initWithDuration(this._duration,n.copyControlPoints(this._points),this._tension),t},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=n.p(this.target.getPositionX(),this.target.getPositionY()),this._accumulatedDiff=n.p(0,0)},update:function(t){t=this._computeEaseTime(t);var e,i,r=this._points;if(1===t)e=r.length-1,i=1;else{var s=this._deltaT;e=0|t/s,i=(t-s*e)/s}var o=n.cardinalSplineAt(n.getControlPointAt(r,e-1),n.getControlPointAt(r,e-0),n.getControlPointAt(r,e+1),n.getControlPointAt(r,e+2),this._tension,i);if(n.ENABLE_STACKABLE_ACTIONS){var a,c;if(a=this.target.getPositionX()-this._previousPosition.x,c=this.target.getPositionY()-this._previousPosition.y,0!==a||0!==c){var h=this._accumulatedDiff;a=h.x+a,c=h.y+c,h.x=a,h.y=c,o.x+=a,o.y+=c}}this.updatePosition(o)},reverse:function(){var t=n.reverseControlPoints(this._points);return n.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}}),n.cardinalSplineTo=function(t,e,i){return new n.CardinalSplineTo(t,e,i)},n.CardinalSplineTo.create=n.cardinalSplineTo,n.CardinalSplineBy=n.CardinalSplineTo.extend({_startPosition:null,ctor:function(t,e,i){n.CardinalSplineTo.prototype.ctor.call(this),this._startPosition=n.p(0,0),void 0!==i&&this.initWithDuration(t,e,i)},startWithTarget:function(t){n.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.getPositionX(),this._startPosition.y=t.getPositionY()},reverse:function(){for(var t,e=this._points.slice(),i=e[0],r=1;r<e.length;++r)t=e[r],e[r]=n.pSub(t,i),i=t;var s=n.reverseControlPoints(e);i=s[s.length-1],s.pop(),i.x=-i.x,i.y=-i.y,s.unshift(i);for(var r=1;r<s.length;++r)t=s[r],t.x=-t.x,t.y=-t.y,t.x+=i.x,t.y+=i.y,s[r]=t,i=t;return n.cardinalSplineBy(this._duration,s,this._tension)},updatePosition:function(t){var e=this._startPosition,i=t.x+e.x,n=t.y+e.y;this._previousPosition.x=i,this._previousPosition.y=n,this.target.setPosition(i,n)},clone:function(){var t=new n.CardinalSplineBy;return t.initWithDuration(this._duration,n.copyControlPoints(this._points),this._tension),t}}),n.cardinalSplineBy=function(t,e,i){return new n.CardinalSplineBy(t,e,i)},n.CardinalSplineBy.create=n.cardinalSplineBy,n.CatmullRomTo=n.CardinalSplineTo.extend({ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return n.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new n.CatmullRomTo;return t.initWithDuration(this._duration,n.copyControlPoints(this._points)),t}}),n.catmullRomTo=function(t,e){return new n.CatmullRomTo(t,e)},n.CatmullRomTo.create=n.catmullRomTo,n.CatmullRomBy=n.CardinalSplineBy.extend({ctor:function(t,e){n.CardinalSplineBy.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return n.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new n.CatmullRomBy;return t.initWithDuration(this._duration,n.copyControlPoints(this._points)),t}}),n.catmullRomBy=function(t,e){return new n.CatmullRomBy(t,e)},n.CatmullRomBy.create=n.catmullRomBy,n.ActionTweenDelegate=n._Class.extend({updateTweenAction:function(t,e){}}),n.ActionTween=n.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(t,e,i,r){n.ActionInterval.prototype.ctor.call(this),this.key="",void 0!==r&&this.initWithDuration(t,e,i,r)},initWithDuration:function(t,e,i,r){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this.key=e,this.to=r,this.from=i,!0):!1},startWithTarget:function(t){if(!t||!t.updateTweenAction)throw new Error("cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function");n.ActionInterval.prototype.startWithTarget.call(this,t),this.delta=this.to-this.from},update:function(t){this.target.updateTweenAction(this.to-this.delta*(1-t),this.key)},reverse:function(){return new n.ActionTween(this.duration,this.key,this.to,this.from)},clone:function(){var t=new n.ActionTween;return t.initWithDuration(this._duration,this.key,this.from,this.to),t}}),n.actionTween=function(t,e,i,r){return new n.ActionTween(t,e,i,r)},n.ActionTween.create=n.actionTween,n.ProgressTimer=_ccsg.Node.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,_className:"ProgressTimer",ctor:function(t){_ccsg.Node.prototype.ctor.call(this),this._type=n.ProgressTimer.Type.RADIAL,this._percentage=0,this._midPoint=n.p(0,0),this._barChangeRate=n.p(0,0),this._reverseDirection=!1,this._sprite=null,t&&this.initWithSprite(t)},getMidpoint:function(){return n.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(t){this._midPoint=n.pClamp(t,n.p(0,0),n.p(1,1))},getBarChangeRate:function(){return n.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(t){this._barChangeRate=n.pClamp(t,n.p(0,0),n.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(t){this._percentage!==t&&(this._percentage=n.clampf(t,0,100),this._renderCmd._updateProgress())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},setColor:function(t){this._sprite.color=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},setOpacity:function(t){this._sprite.opacity=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.releaseData())},setSprite:function(t){this._sprite!==t&&(this._sprite=t,t?this.setContentSize(t.width,t.height):this.setContentSize(0,0),this._renderCmd.releaseData())},setType:function(t){t!==this._type&&(this._type=t,this._renderCmd.releaseData())},setReverseDirection:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.releaseData())},initWithSprite:function(t){return this.percentage=0,this.setAnchorPoint(.5,.5),this._type=n.ProgressTimer.Type.RADIAL,this._reverseDirection=!1,this.midPoint=n.p(.5,.5),this.barChangeRate=n.p(1,1),this.setSprite(t),this._renderCmd.initCmd(),!0},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.ProgressTimer.CanvasRenderCmd(this):new n.ProgressTimer.WebGLRenderCmd(this)}});var c=n.ProgressTimer.prototype;c.midPoint,n.defineGetterSetter(c,"midPoint",c.getMidpoint,c.setMidpoint),c.barChangeRate,n.defineGetterSetter(c,"barChangeRate",c.getBarChangeRate,c.setBarChangeRate),c.type,n.defineGetterSetter(c,"type",c.getType,c.setType),c.percentage,n.defineGetterSetter(c,"percentage",c.getPercentage,c.setPercentage),c.sprite,n.defineGetterSetter(c,"sprite",c.getSprite,c.setSprite),c.reverseDir,n.defineGetterSetter(c,"reverseDir",c.isReverseDirection,c.setReverseDirection),n.ProgressTimer.create=function(t){return new n.ProgressTimer(t)},n.ProgressTimer.TEXTURE_COORDS_COUNT=4,n.ProgressTimer.TEXTURE_COORDS=75,n.ProgressTimer.Type=n.Enum({RADIAL:0,BAR:1}),function(){n.ProgressTimer.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._PI180=Math.PI/180,this._barRect=n.rect(0,0,0,0),this._origin=n.p(0,0),this._radius=0,this._startAngle=270,this._endAngle=270,this._counterClockWise=!1};var t=n.ProgressTimer.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.ProgressTimer.CanvasRenderCmd,t.rendering=function(t,e,i){var r=t||n._renderContext,s=r.getContext(),o=this._node,a=o._sprite,c=a._renderCmd._textureCoord,h=a._renderCmd._displayedOpacity/255;if(0!==c.width&&0!==c.height&&a._texture&&c.validRect&&0!==h){r.setTransform(this._worldTransform,e,i),r.setCompositeOperation(a._blendFuncStr),r.setGlobalAlpha(h);var l=a._rect,d=a._offsetPosition,u=d.x,_=-d.y-l.height,f=l.width,p=l.height;if(r.save(),a._flippedX&&(u=-u-f,s.scale(-1,1)),a._flippedY&&(_=d.y,s.scale(1,-1)),o._type===n.ProgressTimer.Type.BAR){var g=this._barRect;s.beginPath(),s.rect(g.x*e,g.y*i,g.width*e,g.height*i),s.clip(),s.closePath()}else if(o._type===n.ProgressTimer.Type.RADIAL){var m=this._origin.x*e,y=this._origin.y*i;s.beginPath(),s.arc(m,y,this._radius*i,this._PI180*this._startAngle,this._PI180*this._endAngle,this._counterClockWise),
s.lineTo(m,y),s.clip(),s.closePath()}var v=a._texture.getHtmlElementObj();a._renderCmd._colorized?s.drawImage(v,0,0,c.width,c.height,u*e,_*i,f*e,p*i):s.drawImage(v,c.renderX,c.renderY,c.width,c.height,u*e,_*i,f*e,p*i),r.restore(),n.g_NumberOfDraws++}},t.releaseData=function(){},t.initCmd=function(){},t._updateProgress=function(){var t=this._node,e=t._sprite,i=e.width,r=e.height,s=t._midPoint;if(t._type===n.ProgressTimer.Type.RADIAL){this._radius=Math.round(Math.sqrt(i*i+r*r));var o,a,c=!1,h=this._origin;h.x=i*s.x,h.y=-r*s.y,t._reverseDirection?(a=270,o=270-3.6*t._percentage):(o=-90,a=-90+3.6*t._percentage),e._flippedX&&(h.x-=2*i*t._midPoint.x,o=-o,a=-a,o-=180,a-=180,c=!c),e._flippedY&&(h.y+=2*r*t._midPoint.y,c=!c,o=-o,a=-a),this._startAngle=o,this._endAngle=a,this._counterClockWise=c}else{var l=t._barChangeRate,d=t._percentage/100,u=this._barRect,_=n.size(i*(1-l.x),r*(1-l.y)),f=n.size((i-_.width)*d,(r-_.height)*d),p=n.size(_.width+f.width,_.height+f.height),g=n.p(i*s.x,r*s.y),m=g.x-p.width/2;s.x>.5&&p.width/2>=i-g.x&&(m=i-p.width);var y=g.y-p.height/2;s.y>.5&&p.height/2>=r-g.y&&(y=r-p.height),u.x=0;var v=1;e._flippedX&&(u.x-=p.width,v=-1),m>0&&(u.x+=m*v),u.y=0;var T=1;e._flippedY&&(u.y+=p.height,T=-1),y>0&&(u.y-=y*T),u.width=p.width,u.height=-p.height}},t._updateColor=function(){},t._syncStatus=function(t){var e=this._node;if(e._sprite){var i=_ccsg.Node._dirtyFlags,n=this._dirtyFlag,r=t?t._node:null;r&&r._cascadeColorEnabled&&t._dirtyFlag&i.colorDirty&&(n|=i.colorDirty),r&&r._cascadeOpacityEnabled&&t._dirtyFlag&i.opacityDirty&&(n|=i.opacityDirty),t&&t._dirtyFlag&i.transformDirty&&(n|=i.transformDirty),this._dirtyFlag=n;var s=e._sprite._renderCmd,o=s._dirtyFlag,a=o&i.colorDirty,c=o&i.opacityDirty;a&&s._syncDisplayColor(),c&&s._syncDisplayOpacity(),(a||c)&&s._updateColor(),n&i.transformDirty&&this.transform(t)}},t.updateStatus=function(){var t=this._node;if(t._sprite){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t._sprite._renderCmd,r=n._dirtyFlag,s=r&e.colorDirty,o=r&e.opacityDirty;s&&n._updateDisplayColor(),o&&n._updateDisplayOpacity(),(s||o)&&n._updateColor(),i&e.transformDirty&&this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=0}}}(),function(){n.ProgressTimer.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._vertexWebGLBuffer=n._renderContext.createBuffer(),this._vertexDataCount=0,this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataDirty=!1};var t=n.ProgressTimer.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.ProgressTimer.WebGLRenderCmd,t.rendering=function(t){var e=this._node,i=t||n._renderContext;if(this._vertexData&&e._sprite){this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);var r=e._sprite._blendFunc;n.glBlendFunc(r.src,r.dst),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),n.glBindTexture2D(e._sprite.texture),i.bindBuffer(i.ARRAY_BUFFER,this._vertexWebGLBuffer),this._vertexDataDirty&&(i.bufferData(i.ARRAY_BUFFER,this._vertexArrayBuffer,i.DYNAMIC_DRAW),this._vertexDataDirty=!1);var s=n.V2F_C4B_T2F.BYTES_PER_ELEMENT;i.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,s,0),i.vertexAttribPointer(n.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,s,8),i.vertexAttribPointer(n.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,!1,s,12),e._type===n.ProgressTimer.Type.RADIAL?i.drawArrays(i.TRIANGLE_FAN,0,this._vertexDataCount):e._type===n.ProgressTimer.Type.BAR&&(e._reverseDirection?(i.drawArrays(i.TRIANGLE_STRIP,0,this._vertexDataCount/2),i.drawArrays(i.TRIANGLE_STRIP,4,this._vertexDataCount/2),n.g_NumberOfDraws++):i.drawArrays(i.TRIANGLE_STRIP,0,this._vertexDataCount)),n.g_NumberOfDraws++}},t._syncStatus=function(t){var e=this._node;if(e._sprite){var i=_ccsg.Node._dirtyFlags,n=this._dirtyFlag,r=t?t._node:null;r&&r._cascadeColorEnabled&&t._dirtyFlag&i.colorDirty&&(n|=i.colorDirty),r&&r._cascadeOpacityEnabled&&t._dirtyFlag&i.opacityDirty&&(n|=i.opacityDirty),t&&t._dirtyFlag&i.transformDirty&&(n|=i.transformDirty),this._dirtyFlag=n;var s=e._sprite._renderCmd,o=s._dirtyFlag,a=o&i.colorDirty,c=o&i.opacityDirty;a&&s._syncDisplayColor(),c&&s._syncDisplayOpacity(),(a||c)&&(s._updateColor(),this._updateColor()),this.transform(t),s._dirtyFlag=0}},t.updateStatus=function(){var t=this._node;if(t._sprite){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t._sprite._renderCmd,r=n._dirtyFlag,s=r&e.colorDirty,o=r&e.opacityDirty;s&&(n._updateDisplayColor(),this._dirtyFlag=this._dirtyFlag&e.colorDirty^this._dirtyFlag),o&&(n._updateDisplayOpacity(),this._dirtyFlag=this._dirtyFlag&e.opacityDirty^this._dirtyFlag),(s||o)&&(n._updateColor(),this._updateColor()),i&e.transformDirty&&this.transform(this.getParentRenderCmd(),!0)}},t.releaseData=function(){this._vertexData&&(this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataCount=0)},t.initCmd=function(){this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataCount=0,this._shaderProgram=n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURECOLOR)},t._updateProgress=function(){var t=this._node,e=t._type;e===n.ProgressTimer.Type.RADIAL?this._updateRadial():e===n.ProgressTimer.Type.BAR&&this._updateBar(),this._vertexDataDirty=!0},t._updateBar=function(){var t=this._node;if(t._sprite){var e,i=t._percentage/100,r=t._barChangeRate,s=n.pMult(n.p(1-r.x+i*r.x,1-r.y+i*r.y),.5),o=n.pSub(t._midPoint,s),a=n.pAdd(t._midPoint,s);o.x<0&&(a.x+=-o.x,o.x=0),a.x>1&&(o.x-=a.x-1,a.x=1),o.y<0&&(a.y+=-o.y,o.y=0),a.y>1&&(o.y-=a.y-1,a.y=1);var c;if(this._reverseDirection){if(!this._vertexData){this._vertexDataCount=8;var h=n.V2F_C4B_T2F.BYTES_PER_ELEMENT,l=8;this._vertexArrayBuffer=new ArrayBuffer(l*h);var d=[];for(e=0;l>e;e++)d[e]=new n.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*h);d[0].texCoords=this._textureCoordFromAlphaPoint(n.p(0,1)),d[0].vertices=this._vertexFromAlphaPoint(n.p(0,1)),d[1].texCoords=this._textureCoordFromAlphaPoint(n.p(0,0)),d[1].vertices=this._vertexFromAlphaPoint(n.p(0,0)),d[6].texCoords=this._textureCoordFromAlphaPoint(n.p(1,1)),d[6].vertices=this._vertexFromAlphaPoint(n.p(1,1)),d[7].texCoords=this._textureCoordFromAlphaPoint(n.p(1,0)),d[7].vertices=this._vertexFromAlphaPoint(n.p(1,0)),this._vertexData=d}c=this._vertexData,c[2].texCoords=this._textureCoordFromAlphaPoint(n.p(o.x,a.y)),c[2].vertices=this._vertexFromAlphaPoint(n.p(o.x,a.y)),c[3].texCoords=this._textureCoordFromAlphaPoint(n.p(o.x,o.y)),c[3].vertices=this._vertexFromAlphaPoint(n.p(o.x,o.y)),c[4].texCoords=this._textureCoordFromAlphaPoint(n.p(a.x,a.y)),c[4].vertices=this._vertexFromAlphaPoint(n.p(a.x,a.y)),c[5].texCoords=this._textureCoordFromAlphaPoint(n.p(a.x,o.y)),c[5].vertices=this._vertexFromAlphaPoint(n.p(a.x,o.y))}else{if(!this._vertexData){this._vertexDataCount=4;var u=n.V2F_C4B_T2F.BYTES_PER_ELEMENT,_=4;for(this._vertexArrayBuffer=new ArrayBuffer(_*u),this._vertexData=[],e=0;_>e;e++)this._vertexData[e]=new n.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*u)}c=this._vertexData,c[0].texCoords=this._textureCoordFromAlphaPoint(n.p(o.x,a.y)),c[0].vertices=this._vertexFromAlphaPoint(n.p(o.x,a.y)),c[1].texCoords=this._textureCoordFromAlphaPoint(n.p(o.x,o.y)),c[1].vertices=this._vertexFromAlphaPoint(n.p(o.x,o.y)),c[2].texCoords=this._textureCoordFromAlphaPoint(n.p(a.x,a.y)),c[2].vertices=this._vertexFromAlphaPoint(n.p(a.x,a.y)),c[3].texCoords=this._textureCoordFromAlphaPoint(n.p(a.x,o.y)),c[3].vertices=this._vertexFromAlphaPoint(n.p(a.x,o.y))}this._updateColor()}},t._updateRadial=function(){var t=this._node;if(t._sprite){var e,i,r=t._midPoint,s=t._percentage/100,o=2*n.PI*(t._reverseDirection?s:1-s),a=n.p(r.x,1),c=n.pRotateByAngle(a,r,o),h=0;if(0===s)i=a,h=0;else if(1===s)i=a,h=4;else{var l=n.FLT_MAX,d=n.ProgressTimer.TEXTURE_COORDS_COUNT;for(e=0;d>=e;++e){var u=(e+(d-1))%d,_=this._boundaryTexCoord(e%d),f=this._boundaryTexCoord(u);0===e?f=n.pLerp(_,f,1-r.x):4===e&&(_=n.pLerp(_,f,1-r.x));var p=n.p(0,0);if(n.pLineIntersect(_,f,r,c,p)){if(!(0!==e&&4!==e||0<=p.x&&p.x<=1))continue;p.y>=0&&p.y<l&&(l=p.y,h=e)}}i=n.pAdd(r,n.pMult(n.pSub(c,r),l))}var g=!0;if(this._vertexDataCount!==h+3&&(g=!1,this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataCount=0),!this._vertexData){this._vertexDataCount=h+3;var m=this._vertexDataCount,y=n.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(m*y);var v=[];for(e=0;m>e;e++)v[e]=new n.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*y);if(this._vertexData=v,!this._vertexData)return void n.log("cc.ProgressTimer._updateRadial() : Not enough memory")}this._updateColor();var T=this._vertexData;if(!g)for(T[0].texCoords=this._textureCoordFromAlphaPoint(r),T[0].vertices=this._vertexFromAlphaPoint(r),T[1].texCoords=this._textureCoordFromAlphaPoint(a),T[1].vertices=this._vertexFromAlphaPoint(a),e=0;h>e;e++){var C=this._boundaryTexCoord(e);T[e+2].texCoords=this._textureCoordFromAlphaPoint(C),T[e+2].vertices=this._vertexFromAlphaPoint(C)}T[this._vertexDataCount-1].texCoords=this._textureCoordFromAlphaPoint(i),T[this._vertexDataCount-1].vertices=this._vertexFromAlphaPoint(i)}},t._boundaryTexCoord=function(t){if(t<n.ProgressTimer.TEXTURE_COORDS_COUNT){var e=n.ProgressTimer.TEXTURE_COORDS;return this._node._reverseDirection?n.p(e>>7-(t<<1)&1,e>>7-((t<<1)+1)&1):n.p(e>>(t<<1)+1&1,e>>(t<<1)&1)}return n.p(0,0)},t._textureCoordFromAlphaPoint=function(t){var e=this._node._sprite;if(!e)return{u:0,v:0};var i=e.quad,r=n.p(i.bl.texCoords.u,i.bl.texCoords.v),s=n.p(i.tr.texCoords.u,i.tr.texCoords.v);if(e.textureRectRotated){var o=t.x;t.x=t.y,t.y=o}return{u:r.x*(1-t.x)+s.x*t.x,v:r.y*(1-t.y)+s.y*t.y}},t._vertexFromAlphaPoint=function(t){var e=this._node._sprite;if(!e)return{x:0,y:0};var i=e.quad,r=n.p(i.bl.vertices.x,i.bl.vertices.y),s=n.p(i.tr.vertices.x,i.tr.vertices.y);return{x:r.x*(1-t.x)+s.x*t.x,y:r.y*(1-t.y)+s.y*t.y}},t._updateColor=function(){var t=this._node;if(t._sprite&&this._vertexData){for(var e=t._sprite.quad.tl.colors,i=this._vertexData,n=0,r=this._vertexDataCount;r>n;++n)i[n].colors=e;this._vertexDataDirty=!0}}}(),n.ProgressTo=n.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e){n.ActionInterval.prototype.ctor.call(this),this._to=0,this._from=0,void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._to=e,!0):!1},clone:function(){var t=new n.ProgressTo;return t.initWithDuration(this._duration,this._to),t},reverse:function(){return n.log("cc.ProgressTo.reverse(): reverse hasn't been supported."),null},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t),this._from=t.percentage},update:function(t){this.target instanceof n.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}}),n.progressTo=function(t,e){return new n.ProgressTo(t,e)},n.ProgressTo.create=n.progressTo,n.ProgressFromTo=n.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e,i){n.ActionInterval.prototype.ctor.call(this),this._to=0,this._from=0,void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return n.ActionInterval.prototype.initWithDuration.call(this,t)?(this._to=i,this._from=e,!0):!1},clone:function(){var t=new n.ProgressFromTo;return t.initWithDuration(this._duration,this._from,this._to),t},reverse:function(){return n.progressFromTo(this._duration,this._to,this._from)},startWithTarget:function(t){n.ActionInterval.prototype.startWithTarget.call(this,t)},update:function(t){this.target instanceof n.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}}),n.progressFromTo=function(t,e,i){return new n.ProgressFromTo(t,e,i)},n.ProgressFromTo.create=n.progressFromTo,n.Codec={name:"Jacob__Codec"},n.unzip=function(){return n.Codec.GZip.gunzip.apply(n.Codec.GZip,arguments)},n.unzipBase64=function(){var t=n.Codec.Base64.decode.apply(n.Codec.Base64,arguments);return n.Codec.GZip.gunzip.apply(n.Codec.GZip,[t])},n.unzipBase64AsArray=function(t,e){e=e||1;var i,n,r,s=this.unzipBase64(t),o=[];for(i=0,r=s.length/e;r>i;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=s.charCodeAt(i*e+n)<<8*n;return o},n.unzipAsArray=function(t,e){e=e||1;var i,n,r,s=this.unzip(t),o=[];for(i=0,r=s.length/e;r>i;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=s.charCodeAt(i*e+n)<<8*n;return o},n.StringToArray=function(t){var e,i=t.split(","),n=[];for(e=0;e<i.length;e++)n.push(parseInt(i[e]));return n},n.Codec.Base64={name:"Jacob__Codec__Base64"},n.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n.Codec.Base64.decode=function(t){var e,i,n,r,s,o,a,c=[],h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)r=this._keyStr.indexOf(t.charAt(h++)),s=this._keyStr.indexOf(t.charAt(h++)),o=this._keyStr.indexOf(t.charAt(h++)),a=this._keyStr.indexOf(t.charAt(h++)),e=r<<2|s>>4,i=(15&s)<<4|o>>2,n=(3&o)<<6|a,c.push(String.fromCharCode(e)),64!==o&&c.push(String.fromCharCode(i)),64!==a&&c.push(String.fromCharCode(n));return c=c.join("")},n.Codec.Base64.decodeAsArray=function(t,e){var i,n,r,s=this.decode(t),o=[];for(i=0,r=s.length/e;r>i;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=s.charCodeAt(i*e+n)<<8*n;return o},n.uint8ArrayToUint32Array=function(t){if(t.length%4!==0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],n=0;e>n;n++){var r=4*n;i[n]=t[r]+256*t[r+1]+65536*t[r+2]+t[r+3]*(1<<24)}return i},n.Codec.GZip=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(n.Codec.GZip.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0},n.Codec.GZip.gunzip=function(t){t.constructor===Array||t.constructor===String;var e=new n.Codec.GZip(t);return e.gunzip()[0][0]},n.Codec.GZip.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},n.Codec.GZip.LITERALS=288,n.Codec.GZip.NAMEMAX=256,n.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],n.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],n.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],n.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],n.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],n.Codec.GZip.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},n.Codec.GZip.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},n.Codec.GZip.prototype.byteAlign=function(){this.bb=1},n.Codec.GZip.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},n.Codec.GZip.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return t&&(e=n.Codec.GZip.bitReverse[e]>>8-t),e},n.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0},n.Codec.GZip.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},n.Codec.GZip.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},n.Codec.GZip.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,t=this.IsPat(),t>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if(t=this.IsPat(),t>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},n.Codec.GZip.prototype.CreateTree=function(t,e,i,n){var r;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,r=0;17>r;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0},n.Codec.GZip.prototype.DecodeValue=function(t){for(var e,i,n,r=0,s=t[r];;)if(n=this.readBit()){if(!(32768&s.b1))return s.b1;for(s=s.jump,e=t.length,i=0;e>i;i++)if(t[i]===s){r=i;break}}else{if(!(32768&s.b0))return s.b0;r++,s=t[r]}return-1},n.Codec.GZip.prototype.DeflateLoop=function(){var t,e,i,r,s;do if(t=this.readBit(),i=this.readBits(2),0===i){var o,a;for(this.byteAlign(),o=this.readByte(),o|=this.readByte()<<8,a=this.readByte(),a|=this.readByte()<<8,65535&(o^~a)&&document.write("BlockLen checksum mismatch\n");o--;)e=this.readByte(),this.addBuffer(e)}else if(1===i)for(var c;;)if(c=n.Codec.GZip.bitReverse[this.readBits(7)]>>1,c>23?(c=c<<1|this.readBit(),c>199?(c-=128,c=c<<1|this.readBit()):(c-=48,c>143&&(c+=136))):c+=256,256>c)this.addBuffer(c);else{if(256===c)break;var s,h;for(c-=257,s=this.readBits(n.Codec.GZip.cplext[c])+n.Codec.GZip.cplens[c],c=n.Codec.GZip.bitReverse[this.readBits(5)]>>3,n.Codec.GZip.cpdext[c]>8?(h=this.readBits(8),h|=this.readBits(n.Codec.GZip.cpdext[c]-8)<<8):h=this.readBits(n.Codec.GZip.cpdext[c]),h+=n.Codec.GZip.cpdist[c],c=0;s>c;c++){var e=this.buf32k[this.bIdx-h&32767];this.addBuffer(e)}}else if(2===i){var c,l,d,u,_,f=new Array(320);for(d=257+this.readBits(5),u=1+this.readBits(5),_=4+this.readBits(4),c=0;19>c;c++)f[c]=0;for(c=0;_>c;c++)f[n.Codec.GZip.border[c]]=this.readBits(3);for(s=this.distanceTree.length,r=0;s>r;r++)this.distanceTree[r]=new n.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,f,0))return this.flushBuffer(),1;l=d+u,r=0;for(var p=-1;l>r;)if(p++,c=this.DecodeValue(this.distanceTree),16>c)f[r++]=c;else if(16===c){var g;if(c=3+this.readBits(2),r+c>l)return this.flushBuffer(),1;for(g=r?f[r-1]:0;c--;)f[r++]=g}else{if(c=17===c?3+this.readBits(3):11+this.readBits(7),r+c>l)return this.flushBuffer(),1;for(;c--;)f[r++]=0}for(s=this.literalTree.length,r=0;s>r;r++)this.literalTree[r]=new n.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,d,f,0))return this.flushBuffer(),1;for(s=this.literalTree.length,r=0;s>r;r++)this.distanceTree[r]=new n.Codec.GZip.HufNode;var m=new Array;for(r=d;r<f.length;r++)m[r-d]=f[r];if(this.CreateTree(this.distanceTree,u,m,0))return this.flushBuffer(),1;for(;;)if(c=this.DecodeValue(this.literalTree),c>=256){var s,h;if(c-=256,0===c)break;for(c--,s=this.readBits(n.Codec.GZip.cplext[c])+n.Codec.GZip.cplens[c],c=this.DecodeValue(this.distanceTree),n.Codec.GZip.cpdext[c]>8?(h=this.readBits(8),h|=this.readBits(n.Codec.GZip.cpdext[c]-8)<<8):h=this.readBits(n.Codec.GZip.cpdext[c]),h+=n.Codec.GZip.cpdist[c];s--;){var e=this.buf32k[this.bIdx-h&32767];this.addBuffer(e)}}else this.addBuffer(c)}while(!t);return this.flushBuffer(),this.byteAlign(),0},n.Codec.GZip.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},n.Codec.GZip.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte();var i=this.readByte();i|=this.readByte()<<8,i|=this.readByte()<<16,i|=this.readByte()<<24;var r=this.readByte();r|=this.readByte()<<8,r|=this.readByte()<<16,r|=this.readByte()<<24;var s=this.readByte();s|=this.readByte()<<8;var o=this.readByte();for(o|=this.readByte()<<8,c=0,this.nameBuf=[];s--;){var a=this.readByte();"/"===a|":"===a?c=0:c<n.Codec.GZip.NAMEMAX-1&&(this.nameBuf[c++]=String.fromCharCode(a))}this.fileout||(this.fileout=this.nameBuf);for(var c=0;o>c;)a=this.readByte(),c++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},n.Codec.GZip.prototype.skipdir=function(){var t,e,i,r,s,o=[];if(8&this.gpflags&&(o[0]=this.readByte(),o[1]=this.readByte(),o[2]=this.readByte(),o[3]=this.readByte(),t=this.readByte(),t|=this.readByte()<<8,t|=this.readByte()<<16,t|=this.readByte()<<24,e=this.readByte(),e|=this.readByte()<<8,e|=this.readByte()<<16,e|=this.readByte()<<24),this.modeZIP&&this.nextFile(),o[0]=this.readByte(),8!==o[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),i=this.readByte(),4&this.gpflags)for(o[0]=this.readByte(),o[2]=this.readByte(),this.len=o[0]+256*o[1],r=0;r<this.len;r++)this.readByte();if(8&this.gpflags)for(r=0,this.nameBuf=[];s=this.readByte();)("7"===s||":"===s)&&(r=0),r<n.Codec.GZip.NAMEMAX-1&&(this.nameBuf[r++]=s);if(16&this.gpflags)for(;s=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),e=this.readByte(),e|=this.readByte()<<8,e|=this.readByte()<<16,e|=this.readByte()<<24,this.modeZIP&&this.nextFile()},function(){"use strict";function t(t){throw t}function e(t,e){var i=t.split("."),n=T;!(i[0]in n)&&n.execScript&&n.execScript("var "+i[0]);for(var r;i.length&&(r=i.shift());)i.length||e===y?n=n[r]?n[r]:n[r]={}:n[r]=e}function i(t){if("string"==typeof t){var e,i,n=t.split("");for(e=0,i=n.length;i>e;e++)n[e]=(255&n[e].charCodeAt(0))>>>0;t=n}for(var r,s=1,o=0,a=t.length,c=0;a>0;){r=a>1024?1024:a,a-=r;do s+=t[c++],o+=s;while(--r);s%=65521,o%=65521}return(o<<16|s)>>>0}function n(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(C?Uint8Array:Array)?e:new(C?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function r(t){this.buffer=new(C?Uint16Array:Array)(2*t),this.length=0}function s(t){var e,i,n,r,s,o,a,c,h,l=t.length,d=0,u=Number.POSITIVE_INFINITY;for(c=0;l>c;++c)t[c]>d&&(d=t[c]),t[c]<u&&(u=t[c]);for(e=1<<d,i=new(C?Uint32Array:Array)(e),n=1,r=0,s=2;d>=n;){for(c=0;l>c;++c)if(t[c]===n){for(o=0,a=r,h=0;n>h;++h)o=o<<1|1&a,a>>=1;for(h=o;e>h;h+=s)i[h]=n<<16|c;++r}++n,r<<=1,s<<=1}return[i,d,u]}function o(t,e){this.h=L,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=C&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(C?Uint8Array:Array)(32768))}function a(t,e){this.length=t,this.G=e}function c(){var e=F;switch(v){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}function h(e,i){function n(e,i){var n,r=e.G,s=[],o=0;n=B[e.length],s[o++]=65535&n,s[o++]=n>>16&255,s[o++]=n>>24;var a;switch(v){case 1===r:a=[0,r-1,0];break;case 2===r:a=[1,r-2,0];break;case 3===r:a=[2,r-3,0];break;case 4===r:a=[3,r-4,0];break;case 6>=r:a=[4,r-5,1];break;case 8>=r:a=[5,r-7,1];break;case 12>=r:a=[6,r-9,2];break;case 16>=r:a=[7,r-13,2];break;case 24>=r:a=[8,r-17,3];break;case 32>=r:a=[9,r-25,3];break;case 48>=r:a=[10,r-33,4];break;case 64>=r:a=[11,r-49,4];break;case 96>=r:a=[12,r-65,5];break;case 128>=r:a=[13,r-97,5];break;case 192>=r:a=[14,r-129,6];break;case 256>=r:a=[15,r-193,6];break;case 384>=r:a=[16,r-257,7];break;case 512>=r:a=[17,r-385,7];break;case 768>=r:a=[18,r-513,8];break;case 1024>=r:a=[19,r-769,8];break;case 1536>=r:a=[20,r-1025,9];break;case 2048>=r:a=[21,r-1537,9];break;case 3072>=r:a=[22,r-2049,10];break;case 4096>=r:a=[23,r-3073,10];break;case 6144>=r:a=[24,r-4097,11];break;case 8192>=r:a=[25,r-6145,11];break;case 12288>=r:a=[26,r-8193,12];break;case 16384>=r:a=[27,r-12289,12];break;case 24576>=r:a=[28,r-16385,13];break;case 32768>=r:a=[29,r-24577,13];break;default:t("invalid distance")}n=a,s[o++]=n[0],s[o++]=n[1],s[o++]=n[2];var c,h;for(c=0,h=s.length;h>c;++c)p[g++]=s[c];T[s[0]]++,S[s[3]]++,m=e.length+i-1,u=null}var r,s,o,c,h,l,d,u,_,f={},p=C?new Uint16Array(2*i.length):[],g=0,m=0,T=new(C?Uint32Array:Array)(286),S=new(C?Uint32Array:Array)(30),E=e.w;if(!C){for(o=0;285>=o;)T[o++]=0;for(o=0;29>=o;)S[o++]=0}for(T[256]=1,r=0,s=i.length;s>r;++r){for(o=h=0,c=3;c>o&&r+o!==s;++o)h=h<<8|i[r+o];if(f[h]===y&&(f[h]=[]),l=f[h],!(0<m--)){for(;0<l.length&&32768<r-l[0];)l.shift();if(r+3>=s){for(u&&n(u,-1),o=0,c=s-r;c>o;++o)_=i[r+o],p[g++]=_,++T[_];break}if(0<l.length){var b=y,x=y,A=0,R=y,I=y,P=y,L=y,w=i.length,I=0,L=l.length;t:for(;L>I;I++){if(b=l[L-I-1],R=3,A>3){for(P=A;P>3;P--)if(i[b+P-1]!==i[r+P-1])continue t;R=A}for(;258>R&&w>r+R&&i[b+R]===i[r+R];)++R;if(R>A&&(x=b,A=R),258===R)break}d=new a(A,r-x),u?u.length<d.length?(_=i[r-1],p[g++]=_,++T[_],n(d,0)):n(u,-1):d.length<E?u=d:n(d,0)}else u?n(u,-1):(_=i[r],p[g++]=_,++T[_])}l.push(r)}return p[g++]=256,T[256]++,e.L=T,e.K=S,C?p.subarray(0,g):p}function l(t,e){function i(t){var e=E[t][b[t]];e===m?(i(t+1),i(t+1)):--T[e],++b[t]}var n,s,o,a,c,h=t.length,l=new r(572),d=new(C?Uint8Array:Array)(h);if(!C)for(a=0;h>a;a++)d[a]=0;for(a=0;h>a;++a)0<t[a]&&l.push(a,t[a]);if(n=Array(l.length/2),s=new(C?Uint32Array:Array)(l.length/2),1===n.length)return d[l.pop().index]=1,d;for(a=0,c=l.length/2;c>a;++a)n[a]=l.pop(),s[a]=n[a].value;var u,_,f,p,g,m=s.length,y=new(C?Uint16Array:Array)(e),v=new(C?Uint8Array:Array)(e),T=new(C?Uint8Array:Array)(m),S=Array(e),E=Array(e),b=Array(e),x=(1<<e)-m,A=1<<e-1;for(y[e-1]=m,_=0;e>_;++_)A>x?v[_]=0:(v[_]=1,x-=A),x<<=1,y[e-2-_]=(y[e-1-_]/2|0)+m;for(y[0]=v[0],S[0]=Array(y[0]),E[0]=Array(y[0]),_=1;e>_;++_)y[_]>2*y[_-1]+v[_]&&(y[_]=2*y[_-1]+v[_]),S[_]=Array(y[_]),E[_]=Array(y[_]);for(u=0;m>u;++u)T[u]=e;for(f=0;f<y[e-1];++f)S[e-1][f]=s[f],E[e-1][f]=f;for(u=0;e>u;++u)b[u]=0;for(1===v[e-1]&&(--T[0],++b[e-1]),_=e-2;_>=0;--_){for(p=u=0,g=b[_+1],f=0;f<y[_];f++)p=S[_+1][g]+S[_+1][g+1],p>s[u]?(S[_][f]=p,E[_][f]=m,g+=2):(S[_][f]=s[u],E[_][f]=u,++u);b[_]=0,1===v[_]&&i(_)}for(o=T,a=0,c=n.length;c>a;++a)d[n[a].index]=o[a];return d}function d(e){var i,n,r,s,o=new(C?Uint16Array:Array)(e.length),a=[],c=[],h=0;for(i=0,n=e.length;n>i;i++)a[e[i]]=(0|a[e[i]])+1;for(i=1,n=16;n>=i;i++)c[i]=h,h+=0|a[i],h>1<<i&&t("overcommitted"),h<<=1;for(65536>h&&t("undercommitted"),i=0,n=e.length;n>i;i++)for(h=c[e[i]],c[e[i]]+=1,r=o[i]=0,s=e[i];s>r;r++)o[i]=o[i]<<1|1&h,h>>>=1;return o}function u(t,e){this.input=t,this.a=new(C?Uint8Array:Array)(32768),this.h=M.j;var i,n={};!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType);for(i in e)n[i]=e[i];n.outputBuffer=this.a,this.z=new o(this.input,n)}function _(e,i){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=C?new Uint8Array(e):e,this.s=!1,this.m=z,this.B=!1,(i||!(i={}))&&(i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize)),this.m){case W:this.b=32768,this.a=new(C?Uint8Array:Array)(32768+this.l+258);break;case z:this.b=0,this.a=new(C?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}function f(e,i){for(var n,r=e.g,s=e.e,o=e.input,a=e.c;i>s;)n=o[a++],n===y&&t(Error("input buffer is broken")),r|=n<<s,s+=8;return n=r&(1<<i)-1,e.g=r>>>i,e.e=s-i,e.c=a,n}function p(e,i){for(var n,r,s,o=e.g,a=e.e,c=e.input,h=e.c,l=i[0],d=i[1];d>a;)n=c[h++],n===y&&t(Error("input buffer is broken")),o|=n<<a,a+=8;return r=l[o&(1<<d)-1],s=r>>>16,e.g=o>>s,e.e=a-s,e.c=h,65535&r}function g(t){function e(t,e,i){var n,r,s,o;for(o=0;t>o;)switch(n=p(this,e)){case 16:for(s=3+f(this,2);s--;)i[o++]=r;break;case 17:for(s=3+f(this,3);s--;)i[o++]=0;r=0;break;case 18:for(s=11+f(this,7);s--;)i[o++]=0;r=0;break;default:r=i[o++]=n}return i}var i,n,r,o,a=f(t,5)+257,c=f(t,5)+1,h=f(t,4)+4,l=new(C?Uint8Array:Array)(X.length);for(o=0;h>o;++o)l[X[o]]=f(t,3);i=s(l),n=new(C?Uint8Array:Array)(a),r=new(C?Uint8Array:Array)(c),t.o(s(e.call(t,a,i,n)),s(e.call(t,c,i,r)))}function m(e,i){var n,r;switch(this.input=e,this.c=0,(i||!(i={}))&&(i.index&&(this.c=i.index),i.verify&&(this.M=i.verify)),n=e[this.c++],r=e[this.c++],15&n){case gt:this.method=gt;break;default:t(Error("unsupported compression method"))}0!==((n<<8)+r)%31&&t(Error("invalid fcheck flag:"+((n<<8)+r)%31)),32&r&&t(Error("fdict flag is not supported")),this.A=new _(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}var y=void 0,v=!0,T=this,C="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;n.prototype.f=function(){var t,e=this.buffer,i=e.length,n=new(C?Uint8Array:Array)(i<<1);if(C)n.set(e);else for(t=0;i>t;++t)n[t]=e[t];return this.buffer=n},n.prototype.d=function(t,e,i){var n,r=this.buffer,s=this.index,o=this.i,a=r[s];if(i&&e>1&&(t=e>8?(R[255&t]<<24|R[t>>>8&255]<<16|R[t>>>16&255]<<8|R[t>>>24&255])>>32-e:R[t]>>8-e),8>e+o)a=a<<e|t,o+=e;else for(n=0;e>n;++n)a=a<<1|t>>e-n-1&1,8===++o&&(o=0,r[s++]=R[a],a=0,s===r.length&&(r=this.f()));r[s]=a,this.buffer=r,this.i=o,this.index=s},n.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=R[e[i]],i++),C?t=e.subarray(0,i):(e.length=i,t=e),t};var S,E=new(C?Uint8Array:Array)(256);for(S=0;256>S;++S){for(var b=S,x=b,A=7,b=b>>>1;b;b>>>=1)x<<=1,x|=1&b,--A;E[S]=(x<<A&255)>>>0}var R=E,I=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];

C&&new Uint32Array(I),r.prototype.getParent=function(t){return 2*((t-2)/4|0)},r.prototype.push=function(t,e){var i,n,r,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;i>0&&(n=this.getParent(i),s[i]>s[n]);)r=s[i],s[i]=s[n],s[n]=r,r=s[i+1],s[i+1]=s[n+1],s[n+1]=r,i=n;return this.length},r.prototype.pop=function(){var t,e,i,n,r,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],r=0;(n=2*r+2,!(n>=this.length))&&(n+2<this.length&&s[n+2]>s[n]&&(n+=2),s[n]>s[r]);)i=s[r],s[r]=s[n],s[n]=i,i=s[r+1],s[r+1]=s[n+1],s[n+1]=i,r=n;return{index:t,value:e,length:this.length}};var P,L=2,w={NONE:0,r:1,j:L,N:3},O=[];for(P=0;288>P;P++)switch(v){case 143>=P:O.push([P+48,8]);break;case 255>=P:O.push([P-144+400,9]);break;case 279>=P:O.push([P-256+0,7]);break;case 287>=P:O.push([P-280+192,8]);break;default:t("invalid literal: "+P)}o.prototype.n=function(){var e,i,r,s,o=this.input;switch(this.h){case 0:for(r=0,s=o.length;s>r;){i=C?o.subarray(r,r+65535):o.slice(r,r+65535),r+=i.length;var a=i,c=r===s,u=y,_=y,f=y,p=y,g=y,m=this.a,T=this.b;if(C){for(m=new Uint8Array(this.a.buffer);m.length<=T+a.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}if(u=c?1:0,m[T++]=0|u,_=a.length,f=~_+65536&65535,m[T++]=255&_,m[T++]=_>>>8&255,m[T++]=255&f,m[T++]=f>>>8&255,C)m.set(a,T),T+=a.length,m=m.subarray(0,T);else{for(p=0,g=a.length;g>p;++p)m[T++]=a[p];m.length=T}this.b=T,this.a=m}break;case 1:var S=new n(new Uint8Array(this.a.buffer),this.b);S.d(1,1,v),S.d(1,2,v);var E,b,x,A=h(this,o);for(E=0,b=A.length;b>E;E++)if(x=A[E],n.prototype.d.apply(S,O[x]),x>256)S.d(A[++E],A[++E],v),S.d(A[++E],5),S.d(A[++E],A[++E],v);else if(256===x)break;this.a=S.finish(),this.b=this.a.length;break;case L:var R,I,P,w,F,N,D,B,M,W,z,V,k,G,U,X=new n(new Uint8Array(this.a),this.b),Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=Array(19);for(R=L,X.d(1,1,v),X.d(R,2,v),I=h(this,o),N=l(this.L,15),D=d(N),B=l(this.K,7),M=d(B),P=286;P>257&&0===N[P-1];P--);for(w=30;w>1&&0===B[w-1];w--);var j,Q,Z,q,K,J,$=P,tt=w,et=new(C?Uint32Array:Array)($+tt),it=new(C?Uint32Array:Array)(316),nt=new(C?Uint8Array:Array)(19);for(j=Q=0;$>j;j++)et[Q++]=N[j];for(j=0;tt>j;j++)et[Q++]=B[j];if(!C)for(j=0,q=nt.length;q>j;++j)nt[j]=0;for(j=K=0,q=et.length;q>j;j+=Q){for(Q=1;q>j+Q&&et[j+Q]===et[j];++Q);if(Z=Q,0===et[j])if(3>Z)for(;0<Z--;)it[K++]=0,nt[0]++;else for(;Z>0;)J=138>Z?Z:138,J>Z-3&&Z>J&&(J=Z-3),10>=J?(it[K++]=17,it[K++]=J-3,nt[17]++):(it[K++]=18,it[K++]=J-11,nt[18]++),Z-=J;else if(it[K++]=et[j],nt[et[j]]++,Z--,3>Z)for(;0<Z--;)it[K++]=et[j],nt[et[j]]++;else for(;Z>0;)J=6>Z?Z:6,J>Z-3&&Z>J&&(J=Z-3),it[K++]=16,it[K++]=J-3,nt[16]++,Z-=J}for(e=C?it.subarray(0,K):it.slice(0,K),W=l(nt,7),G=0;19>G;G++)H[G]=W[Y[G]];for(F=19;F>4&&0===H[F-1];F--);for(z=d(W),X.d(P-257,5,v),X.d(w-1,5,v),X.d(F-4,4,v),G=0;F>G;G++)X.d(H[G],3,v);for(G=0,U=e.length;U>G;G++)if(V=e[G],X.d(z[V],W[V],v),V>=16){switch(G++,V){case 16:k=2;break;case 17:k=3;break;case 18:k=7;break;default:t("invalid code: "+V)}X.d(e[G],k,v)}var rt,st,ot,at,ct,ht,lt,dt,ut=[D,N],_t=[M,B];for(ct=ut[0],ht=ut[1],lt=_t[0],dt=_t[1],rt=0,st=I.length;st>rt;++rt)if(ot=I[rt],X.d(ct[ot],ht[ot],v),ot>256)X.d(I[++rt],I[++rt],v),at=I[++rt],X.d(lt[at],dt[at],v),X.d(I[++rt],I[++rt],v);else if(256===ot)break;this.a=X.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var F,N,D=[];for(F=3;258>=F;F++)N=c(),D[F]=N[2]<<24|N[1]<<16|N[0];var B=C?new Uint32Array(D):D,M=w;u.prototype.n=function(){var e,n,r,s,o,a,c,h=0;switch(c=this.a,e=gt){case gt:n=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(r=n<<4|e,c[h++]=r,e){case gt:switch(this.h){case M.NONE:o=0;break;case M.r:o=1;break;case M.j:o=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return s=o<<6|0,c[h++]=s|31-(256*r+s)%31,a=i(this.input),this.z.b=h,c=this.z.n(),h=c.length,C&&(c=new Uint8Array(c.buffer),c.length<=h+4&&(this.a=new Uint8Array(c.length+4),this.a.set(c),c=this.a),c=c.subarray(0,h+4)),c[h++]=a>>24&255,c[h++]=a>>16&255,c[h++]=a>>8&255,c[h++]=255&a,c},e("Zlib.Deflate",u),e("Zlib.Deflate.compress",function(t,e){return new u(t,e).n()}),e("Zlib.Deflate.CompressionType",M),e("Zlib.Deflate.CompressionType.NONE",M.NONE),e("Zlib.Deflate.CompressionType.FIXED",M.r),e("Zlib.Deflate.CompressionType.DYNAMIC",M.j);var W=0,z=1,V={D:W,C:z};_.prototype.p=function(){for(;!this.s;){var e=f(this,3);switch(1&e&&(this.s=v),e>>>=1){case 0:var i=this.input,n=this.c,r=this.a,s=this.b,o=y,a=y,c=y,h=r.length,l=y;switch(this.e=this.g=0,o=i[n++],o===y&&t(Error("invalid uncompressed block header: LEN (first byte)")),a=o,o=i[n++],o===y&&t(Error("invalid uncompressed block header: LEN (second byte)")),a|=o<<8,o=i[n++],o===y&&t(Error("invalid uncompressed block header: NLEN (first byte)")),c=o,o=i[n++],o===y&&t(Error("invalid uncompressed block header: NLEN (second byte)")),c|=o<<8,a===~c&&t(Error("invalid uncompressed block header: length verify")),n+a>i.length&&t(Error("input buffer is broken")),this.m){case W:for(;s+a>r.length;){if(l=h-s,a-=l,C)r.set(i.subarray(n,n+l),s),s+=l,n+=l;else for(;l--;)r[s++]=i[n++];this.b=s,r=this.f(),s=this.b}break;case z:for(;s+a>r.length;)r=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(C)r.set(i.subarray(n,n+a),s),s+=a,n+=a;else for(;a--;)r[s++]=i[n++];this.c=n,this.b=s,this.a=r;break;case 1:this.o(it,rt);break;case 2:g(this);break;default:t(Error("unknown BTYPE: "+e))}}return this.t()};var k,G,U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=C?new Uint16Array(U):U,Y=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],H=C?new Uint16Array(Y):Y,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],Q=C?new Uint8Array(j):j,Z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],q=C?new Uint16Array(Z):Z,K=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=C?new Uint8Array(K):K,$=new(C?Uint8Array:Array)(288);for(k=0,G=$.length;G>k;++k)$[k]=143>=k?8:255>=k?9:279>=k?7:8;var tt,et,it=s($),nt=new(C?Uint8Array:Array)(30);for(tt=0,et=nt.length;et>tt;++tt)nt[tt]=5;var rt=s(nt);_.prototype.o=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,s,o,a,c=i.length-258;256!==(r=p(this,t));)if(256>r)n>=c&&(this.b=n,i=this.f(),n=this.b),i[n++]=r;else for(s=r-257,a=H[s],0<Q[s]&&(a+=f(this,Q[s])),r=p(this,e),o=q[r],0<J[r]&&(o+=f(this,J[r])),n>=c&&(this.b=n,i=this.f(),n=this.b);a--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},_.prototype.I=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,s,o,a,c=i.length;256!==(r=p(this,t));)if(256>r)n>=c&&(i=this.f(),c=i.length),i[n++]=r;else for(s=r-257,a=H[s],0<Q[s]&&(a+=f(this,Q[s])),r=p(this,e),o=q[r],0<J[r]&&(o+=f(this,J[r])),n+a>c&&(i=this.f(),c=i.length);a--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},_.prototype.f=function(){var t,e,i=new(C?Uint8Array:Array)(this.b-32768),n=this.b-32768,r=this.a;if(C)i.set(r.subarray(32768,i.length));else for(t=0,e=i.length;e>t;++t)i[t]=r[t+32768];if(this.k.push(i),this.q+=i.length,C)r.set(r.subarray(n,n+32768));else for(t=0;32768>t;++t)r[t]=r[n+t];return this.b=32768,r},_.prototype.J=function(t){var e,i,n,r,s=this.input.length/this.c+1|0,o=this.input,a=this.a;return t&&("number"==typeof t.v&&(s=t.v),"number"==typeof t.F&&(s+=t.F)),2>s?(i=(o.length-this.c)/this.u[2],r=258*(i/2)|0,n=r<a.length?a.length+r:a.length<<1):n=a.length*s,C?(e=new Uint8Array(n),e.set(a)):e=a,this.a=e},_.prototype.t=function(){var t,e,i,n,r,s=0,o=this.a,a=this.k,c=new(C?Uint8Array:Array)(this.q+(this.b-32768));if(0===a.length)return C?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=a.length;i>e;++e)for(t=a[e],n=0,r=t.length;r>n;++n)c[s++]=t[n];for(e=32768,i=this.b;i>e;++e)c[s++]=o[e];return this.k=[],this.buffer=c},_.prototype.H=function(){var t,e=this.b;return C?this.B?(t=new Uint8Array(e),t.set(this.a.subarray(0,e))):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},m.prototype.p=function(){var e,n,r=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(n=(r[this.c++]<<24|r[this.c++]<<16|r[this.c++]<<8|r[this.c++])>>>0,n!==i(e)&&t(Error("invalid adler-32 checksum"))),e},e("Zlib.Inflate",m),e("Zlib.Inflate.BufferType",V),V.ADAPTIVE=V.C,V.BLOCK=V.D,e("Zlib.Inflate.prototype.decompress",m.prototype.p);var st=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];C&&new Uint16Array(st);var ot=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];C&&new Uint16Array(ot);var at=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];C&&new Uint8Array(at);var ct=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];C&&new Uint16Array(ct);var ht=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];C&&new Uint8Array(ht);var lt,dt,ut=new(C?Uint8Array:Array)(288);for(lt=0,dt=ut.length;dt>lt;++lt)ut[lt]=143>=lt?8:255>=lt?9:279>=lt?7:8;s(ut);var _t,ft,pt=new(C?Uint8Array:Array)(30);for(_t=0,ft=pt.length;ft>_t;++_t)pt[_t]=5;s(pt);var gt=8}.call(this);var c=window;c=c.Zlib=c.Zlib,c.Deflate=c.Deflate,c.Deflate.compress=c.Deflate.compress,c.Inflate=c.Inflate,c.Inflate.BufferType=c.Inflate.BufferType,c.Inflate.prototype.decompress=c.Inflate.prototype.decompress,n.PNGReader=n._Class.extend({ctor:function(t){var e,i,n,r,s,o,a,c,h,l,d,u,_,f;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},s=null;;){switch(e=this.readUInt32(),h=function(){var t,e;for(e=[],o=t=0;4>t;o=++t)e.push(String.fromCharCode(this.data[this.pos++]));return e}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":s&&this.animation.frames.push(s),this.pos+=4,s={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},r=this.readUInt16(),n=this.readUInt16()||100,s.delay=1e3*r/n,s.disposeOp=this.data[this.pos++],s.blendOp=this.data[this.pos++],s.data=[];break;case"IDAT":case"fdAT":for("fdAT"===h&&(this.pos+=4,e-=4),t=(null!=s?s.data:void 0)||this.imgData,o=u=0;e>=0?e>u:u>e;o=e>=0?++u:--u)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),l=255-this.transparency.indexed.length,l>0)for(o=_=0;l>=0?l>_:_>l;o=l>=0?++_:--_)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":d=this.read(e),a=d.indexOf(0),c=String.fromCharCode.apply(String,d.slice(0,a)),this.text[c]=String.fromCharCode.apply(String,d.slice(a+1));break;case"IEND":return s&&this.animation.frames.push(s),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(f=this.colorType)||6===f,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(t){var e,i,n;for(n=[],e=i=0;t>=0?t>i:i>t;e=t>=0?++i:--i)n.push(this.data[this.pos++]);return n},readUInt32:function(){var t,e,i,n;return t=this.data[this.pos++]<<24,e=this.data[this.pos++]<<16,i=this.data[this.pos++]<<8,n=this.data[this.pos++],t|e|i|n},readUInt16:function(){var t,e;return t=this.data[this.pos++]<<8,e=this.data[this.pos++],t|e},decodePixels:function(t){var e,i,n,r,s,o,a,c,h,l,d,u,_,f,p,g,m,y,v,T,C,S,E;if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);var b=new Zlib.Inflate(t,{index:0,verify:!1});for(t=b.decompress(),u=this.pixelBitlength/8,g=u*this.width,_=new Uint8Array(g*this.height),o=t.length,p=0,f=0,i=0;o>f;){switch(t[f++]){case 0:for(r=v=0;g>v;r=v+=1)_[i++]=t[f++];break;case 1:for(r=T=0;g>T;r=T+=1)e=t[f++],s=u>r?0:_[i-u],_[i++]=(e+s)%256;break;case 2:for(r=C=0;g>C;r=C+=1)e=t[f++],n=(r-r%u)/u,m=p&&_[(p-1)*g+n*u+r%u],_[i++]=(m+e)%256;break;case 3:for(r=S=0;g>S;r=S+=1)e=t[f++],n=(r-r%u)/u,s=u>r?0:_[i-u],m=p&&_[(p-1)*g+n*u+r%u],_[i++]=(e+Math.floor((s+m)/2))%256;break;case 4:for(r=E=0;g>E;r=E+=1)e=t[f++],n=(r-r%u)/u,s=u>r?0:_[i-u],0===p?m=y=0:(m=_[(p-1)*g+n*u+r%u],y=n&&_[(p-1)*g+(n-1)*u+r%u]),a=s+m-y,c=Math.abs(a-s),l=Math.abs(a-m),d=Math.abs(a-y),h=l>=c&&d>=c?s:d>=l?m:y,_[i++]=(e+h)%256;break;default:throw new Error("Invalid filter algorithm: "+t[f-1])}p++}return _},copyToImageData:function(t,e){var i,n,r,s,o,a,c,h,l,d,u;if(n=this.colors,l=null,i=this.hasAlphaChannel,this.palette.length&&(l=null!=(u=this._decodedPalette)?u:this._decodedPalette=this.decodePalette(),n=4,i=!0),r=t.data||t,h=r.length,o=l||e,s=a=0,1===n)for(;h>s;)c=l?4*e[s/4]:a,d=o[c++],r[s++]=d,r[s++]=d,r[s++]=d,r[s++]=i?o[c++]:255,a=c;else for(;h>s;)c=l?4*e[s/4]:a,r[s++]=o[c++],r[s++]=o[c++],r[s++]=o[c++],r[s++]=i?o[c++]:255,a=c},decodePalette:function(){var t,e,i,n,r,s,o,a,c;for(i=this.palette,s=this.transparency.indexed||[],r=new Uint8Array((s.length||0)+i.length),n=0,t=0,e=o=0,a=i.length;a>o;e=o+=3)r[n++]=i[e],r[n++]=i[e+1],r[n++]=i[e+2],r[n++]=null!=(c=s[t++])?c:255;return r},render:function(t){var e,i;return t.width=this.width,t.height=this.height,e=t.getContext("2d"),i=e.createImageData(this.width,this.height),this.copyToImageData(i,this.decodePixels()),e.putImageData(i,0,0)}}),n.tiffReader={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(18761===t)this.littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError("Invalid byte order value.");this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(t){var e=this.fieldTypeNames;return t in e?e[t]:null},getFieldTagName:function(t){var e=this.fieldTagNames;return t in e?e[t]:(console.log("Unknown Field Tag:",t),"Tag"+t)},getFieldTypeLength:function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:null},getFieldValues:function(t,e,i,r){var s=[],o=this.getFieldTypeLength(e),a=o*i;if(4>=a)s.push(this.littleEndian===!1?r>>>8*(4-o):r);else for(var c=0;i>c;c++){var h=o*c;o>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(s.push(this.getUint32(r+h)),s.push(this.getUint32(r+h+4))):n.log("Can't handle this field type or size"):s.push(this.getBytes(o,r+h))}return"ASCII"===e&&s.forEach(function(t,e,i){i[e]=String.fromCharCode(t)}),s},getBytes:function(t,e){if(0>=t)n.log("No bytes requested");else{if(1>=t)return this.getUint8(e);if(2>=t)return this.getUint16(e);if(3>=t)return this.getUint32(e)>>>8;if(4>=t)return this.getUint32(e);n.log("Too many bytes requested")}},getBits:function(t,e,i){i=i||0;var n,r,s=Math.floor(i/8),o=e+s,a=i+t,c=32-t;return 0>=a?console.log("No bits requested"):8>=a?(n=24+i,r=this.getUint8(o)):16>=a?(n=16+i,r=this.getUint16(o)):32>=a?(n=i,r=this.getUint32(o)):console.log("Too many bits requested"),{bits:r<<n>>>c,byteOffset:o+Math.floor(a/8),bitOffset:a%8}},parseFileDirectory:function(t){for(var e=this.getUint16(t),i=[],n=t+2,r=0;e>r;n+=12,r++){var s=this.getUint16(n),o=this.getUint16(n+2),a=this.getUint32(n+4),c=this.getUint32(n+8),h=this.getFieldTagName(s),l=this.getFieldTypeName(o),d=this.getFieldValues(h,l,a,c);i[h]={type:l,values:d}}this._fileDirectories.push(i);var u=this.getUint32(n);0!==u&&this.parseFileDirectory(u)},clampColorSample:function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},parseTIFF:function(t,e){if(e=e||document.createElement("canvas"),this._tiffData=t,this.canvas=e,this.checkLittleEndian(),this.hasTowel()){var i=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(i);var r=this._fileDirectories[0],s=r.ImageWidth.values[0],o=r.ImageLength.values[0];this.canvas.width=s,this.canvas.height=o;var a=[],c=r.Compression?r.Compression.values[0]:1,h=r.SamplesPerPixel.values[0],l=[],d=0,u=!1;if(r.BitsPerSample.values.forEach(function(t,e,i){l[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8===0&&(l[e].hasBytesPerSample=!0,l[e].bytesPerSample=t/8),d+=t},this),d%8===0){u=!0;var _=d/8}var f=r.StripOffsets.values,p=f.length;if(r.StripByteCounts)var g=r.StripByteCounts.values;else{if(n.log("Missing StripByteCounts!"),1!==p)throw Error("Cannot recover from missing StripByteCounts");var g=[Math.ceil(s*o*d/8)]}for(var m=0;p>m;m++){var y=f[m];a[m]=[];for(var v=g[m],T=0,C=0,S=1,E=!0,b=[],x=0,A=0,R=0;v>T;T+=S)switch(c){case 1:for(var I=0,b=[];h>I;I++){if(!l[I].hasBytesPerSample){var P=this.getBits(l[I].bitsPerSample,y+T,C);throw b.push(P.bits),T=P.byteOffset-y,C=P.bitOffset,RangeError("Cannot handle sub-byte bits per sample")}var L=l[I].bytesPerSample*I;b.push(this.getBytes(l[I].bytesPerSample,y+T+L))}if(a[m].push(b),!u)throw S=0,RangeError("Cannot handle sub-byte bits per pixel");S=_;break;case 2:break;case 3:break;case 4:break;case 5:break;case 6:break;case 7:break;case 32773:if(E){E=!1;var w=1,O=1,F=this.getInt8(y+T);F>=0&&127>=F?w=F+1:F>=-127&&-1>=F?O=-F+1:E=!0}else{for(var N=this.getUint8(y+T),I=0;O>I;I++){if(!l[A].hasBytesPerSample)throw RangeError("Cannot handle sub-byte bits per sample");R=R<<8*x|N,x++,x===l[A].bytesPerSample&&(b.push(R),R=x=0,A++),A===h&&(a[m].push(b),b=[],A=0)}w--,0===w&&(E=!0)}S=1}}if(e.getContext){var D=this.canvas.getContext("2d");D.fillStyle="rgba(255, 255, 255, 0)";var B=r.RowsPerStrip?r.RowsPerStrip.values[0]:o,M=a.length,W=o%B,z=0===W?B:W,V=B,k=0,G=r.PhotometricInterpretation.values[0],U=[],X=0;if(r.ExtraSamples&&(U=r.ExtraSamples.values,X=U.length),r.ColorMap)var Y=r.ColorMap.values,H=Math.pow(2,l[0].bitsPerSample);for(var m=0;M>m;m++){m+1===M&&(V=z);for(var j=a[m].length,Q=k*m,Z=0,q=0;j>q;Z++)for(var K=0;s>K;K++,q++){var J=a[m][q],$=0,tt=0,et=0,it=1;if(X>0)for(var nt=0;X>nt;nt++)if(1===U[nt]||2===U[nt]){it=J[3+nt]/256;break}switch(G){case 0:if(l[0].hasBytesPerSample)var rt=Math.pow(16,2*l[0].bytesPerSample);J.forEach(function(t,e,i){i[e]=rt-t});case 1:$=tt=et=this.clampColorSample(J[0],l[0].bitsPerSample);break;case 2:$=this.clampColorSample(J[0],l[0].bitsPerSample),tt=this.clampColorSample(J[1],l[1].bitsPerSample),et=this.clampColorSample(J[2],l[2].bitsPerSample);break;case 3:if(void 0===Y)throw Error("Palette image missing color map");var st=J[0];$=this.clampColorSample(Y[st],16),tt=this.clampColorSample(Y[H+st],16),et=this.clampColorSample(Y[2*H+st],16);break;default:throw RangeError("Unknown Photometric Interpretation:",G)}D.fillStyle="rgba("+$+", "+tt+", "+et+", "+it+")",D.fillRect(K,Q+Z,1,1)}k=V}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}},n.Particle=function(t,e,i,r,s,o,a,c,h,l,d,u){this.pos=t?t:n.p(0,0),this.startPos=e?e:n.p(0,0),this.color=i?i:{r:0,g:0,b:0,a:255},this.deltaColor=r?r:{r:0,g:0,b:0,a:255},this.size=s||0,this.deltaSize=o||0,this.rotation=a||0,this.deltaRotation=c||0,this.timeToLive=h||0,this.atlasIndex=l||0,this.modeA=d?d:new n.Particle.ModeA,this.modeB=u?u:new n.Particle.ModeB,this.isChangeColor=!1,this.drawPos=n.p(0,0)},n.Particle.ModeA=function(t,e,i){this.dir=t?t:n.p(0,0),this.radialAccel=e||0,this.tangentialAccel=i||0},n.Particle.ModeB=function(t,e,i,n){this.angle=t||0,this.degreesPerSecond=e||0,this.radius=i||0,this.deltaRadius=n||0},n.Particle.TemporaryPoints=[n.p(),n.p(),n.p(),n.p()],n.ParticleSystem=_ccsg.Node.extend({_className:"ParticleSystem",_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:n.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,atlasIndex:0,_transformSystemDirty:!1,_allocatedParticles:0,_isActive:!1,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,positionType:null,autoRemoveOnFinish:!1,emitterMode:0,_textureLoaded:null,ctor:function(t){if(_ccsg.Node.prototype.ctor.call(this),this.emitterMode=n.ParticleSystem.Mode.GRAVITY,this.modeA=new n.ParticleSystem.ModeA,this.modeB=new n.ParticleSystem.ModeB,this._blendFunc={src:n.BLEND_SRC,dst:n.BLEND_DST},this._particles=[],this._sourcePosition=n.p(0,0),this._posVar=n.p(0,0),this._startColor=n.color(255,255,255,255),this._startColorVar=n.color(255,255,255,255),this._endColor=n.color(255,255,255,255),this._endColorVar=n.color(255,255,255,255),this._plistFile="",this._elapsed=0,this._dontTint=!1,this._pointZeroForParticle=n.p(0,0),this._emitCounter=0,this._particleIdx=0,this._batchNode=null,this.atlasIndex=0,this._transformSystemDirty=!1,this._allocatedParticles=0,this._isActive=!1,this.particleCount=0,this.duration=0,this.life=0,this.lifeVar=0,this.angle=0,this.angleVar=0,this.startSize=0,this.startSizeVar=0,this.endSize=0,this.endSizeVar=0,this.startSpin=0,this.startSpinVar=0,this.endSpin=0,this.endSpinVar=0,this.emissionRate=0,this._totalParticles=0,this._texture=null,this._opacityModifyRGB=!1,this.positionType=n.ParticleSystem.Type.FREE,this.autoRemoveOnFinish=!1,this._textureLoaded=!0,!t||n.js.isNumber(t)){var e=t||100;this.setDrawMode(n.ParticleSystem.TEXTURE_MODE),this.initWithTotalParticles(e)}else n.js.isString(t)?this.initWithFile(t):n.js.isObject(t)&&this.initWithDictionary(t,"")},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.ParticleSystem.CanvasRenderCmd(this):new n.ParticleSystem.WebGLRenderCmd(this)},ignoreColor:function(t){this._dontTint=t},initTexCoordsWithRect:function(t){this._renderCmd.initTexCoordsWithRect(t)},getBatchNode:function(){return this._batchNode},setBatchNode:function(t){this._renderCmd.setBatchNode(t)},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getDrawMode:function(){return this._renderCmd.getDrawMode()},setDrawMode:function(t){this._renderCmd.setDrawMode(t)},getShapeType:function(){return this._renderCmd.getShapeType()},setShapeType:function(t){this._renderCmd.setShapeType(t)},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},setParticleCount:function(t){this.particleCount=t},getDuration:function(){return this.duration},setDuration:function(t){this.duration=t},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(t){this._sourcePosition=t},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(t){this._posVar=t},getLife:function(){return this.life},setLife:function(t){this.life=t},getLifeVar:function(){return this.lifeVar},setLifeVar:function(t){this.lifeVar=t},getAngle:function(){return this.angle},setAngle:function(t){this.angle=t},getAngleVar:function(){return this.angleVar},setAngleVar:function(t){this.angleVar=t},getGravity:function(){var t=this.modeA.gravity;return n.p(t.x,t.y)},setGravity:function(t){this.modeA.gravity=t},getSpeed:function(){return this.modeA.speed},setSpeed:function(t){this.modeA.speed=t},getSpeedVar:function(){return this.modeA.speedVar},setSpeedVar:function(t){this.modeA.speedVar=t},getTangentialAccel:function(){return this.modeA.tangentialAccel},setTangentialAccel:function(t){this.modeA.tangentialAccel=t},getTangentialAccelVar:function(){return this.modeA.tangentialAccelVar},setTangentialAccelVar:function(t){this.modeA.tangentialAccelVar=t},getRadialAccel:function(){return this.modeA.radialAccel},setRadialAccel:function(t){this.modeA.radialAccel=t},getRadialAccelVar:function(){return this.modeA.radialAccelVar},setRadialAccelVar:function(t){this.modeA.radialAccelVar=t},getRotationIsDir:function(){return this.modeA.rotationIsDir},setRotationIsDir:function(t){this.modeA.rotationIsDir=t},getStartRadius:function(){return this.modeB.startRadius},setStartRadius:function(t){this.modeB.startRadius=t},getStartRadiusVar:function(){return this.modeB.startRadiusVar},setStartRadiusVar:function(t){this.modeB.startRadiusVar=t},getEndRadius:function(){return this.modeB.endRadius},setEndRadius:function(t){this.modeB.endRadius=t},getEndRadiusVar:function(){return this.modeB.endRadiusVar},setEndRadiusVar:function(t){this.modeB.endRadiusVar=t},getRotatePerSecond:function(){return this.modeB.rotatePerSecond},setRotatePerSecond:function(t){this.modeB.rotatePerSecond=t},getRotatePerSecondVar:function(){return this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(t){this.modeB.rotatePerSecondVar=t},setScale:function(t,e){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScale.call(this,t,e)},setRotation:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setRotation.call(this,t)},setScaleX:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScaleY.call(this,t)},getStartSize:function(){return this.startSize},setStartSize:function(t){this.startSize=t},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(t){this.startSizeVar=t},getEndSize:function(){return this.endSize},setEndSize:function(t){this.endSize=t},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(t){this.endSizeVar=t},getStartColor:function(){return n.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(t){this._startColor=n.color(t)},getStartColorVar:function(){return n.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},setStartColorVar:function(t){this._startColorVar=n.color(t)},getEndColor:function(){return n.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(t){this._endColor=n.color(t)},getEndColorVar:function(){return n.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(t){this._endColorVar=n.color(t)},getStartSpin:function(){return this.startSpin},setStartSpin:function(t){this.startSpin=t},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(t){this.startSpinVar=t},getEndSpin:function(){return this.endSpin},setEndSpin:function(t){this.endSpin=t},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(t){this.endSpinVar=t},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(t){this.emissionRate=t},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(t){this._renderCmd.setTotalParticles(t)},getTexture:function(){return this._texture},setTexture:function(t){t&&(t.isLoaded()?this.setTextureWithRect(t,n.rect(0,0,t.width,t.height)):(this._textureLoaded=!1,t.once("load",function(e){this._textureLoaded=!0,this.setTextureWithRect(t,n.rect(0,0,t.width,t.height))},this)))},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?this._blendFunc!==t&&(this._blendFunc=t,this._updateBlendFunc()):(this._blendFunc.src!==t||this._blendFunc.dst!==e)&&(this._blendFunc={src:t,dst:e},this._updateBlendFunc())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t},isBlendAdditive:function(){return this._blendFunc.src===n.SRC_ALPHA&&this._blendFunc.dst===n.ONE||this._blendFunc.src===n.ONE&&this._blendFunc.dst===n.ONE},setBlendAdditive:function(t){var e=this._blendFunc;t?(e.src=n.SRC_ALPHA,e.dst=n.ONE):this._renderCmd._setBlendAdditive()},getPositionType:function(){return this.positionType},setPositionType:function(t){this.positionType=t},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(t){this.autoRemoveOnFinish=t},getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(t){this.emitterMode=t},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(t){this._plistFile=t;var e=n.loader.getRes(t);return e?this.initWithDictionary(e,""):(n.log("cc.ParticleSystem.initWithFile(): Particles: file not found"),!1)},getBoundingBoxToWorld:function(){return n.rect(0,0,n._canvas.width,n._canvas.height)},initWithDictionary:function(t,e){var i=!1,r=null,s=this._valueForKey,o=parseInt(s("maxParticles",t));if(this.initWithTotalParticles(o)){this.angle=parseFloat(s("angle",t)),this.angleVar=parseFloat(s("angleVariance",t)),this.duration=parseFloat(s("duration",t)),this._blendFunc.src=parseInt(s("blendFuncSource",t)),this._blendFunc.dst=parseInt(s("blendFuncDestination",t));var a=this._startColor;a.r=255*parseFloat(s("startColorRed",t)),a.g=255*parseFloat(s("startColorGreen",t)),a.b=255*parseFloat(s("startColorBlue",t)),a.a=255*parseFloat(s("startColorAlpha",t));var c=this._startColorVar;c.r=255*parseFloat(s("startColorVarianceRed",t)),c.g=255*parseFloat(s("startColorVarianceGreen",t)),c.b=255*parseFloat(s("startColorVarianceBlue",t)),c.a=255*parseFloat(s("startColorVarianceAlpha",t));var h=this._endColor;h.r=255*parseFloat(s("finishColorRed",t)),h.g=255*parseFloat(s("finishColorGreen",t)),h.b=255*parseFloat(s("finishColorBlue",t)),h.a=255*parseFloat(s("finishColorAlpha",t));

var l=this._endColorVar;if(l.r=255*parseFloat(s("finishColorVarianceRed",t)),l.g=255*parseFloat(s("finishColorVarianceGreen",t)),l.b=255*parseFloat(s("finishColorVarianceBlue",t)),l.a=255*parseFloat(s("finishColorVarianceAlpha",t)),this.startSize=parseFloat(s("startParticleSize",t)),this.startSizeVar=parseFloat(s("startParticleSizeVariance",t)),this.endSize=parseFloat(s("finishParticleSize",t)),this.endSizeVar=parseFloat(s("finishParticleSizeVariance",t)),this.setPosition(parseFloat(s("sourcePositionx",t)),parseFloat(s("sourcePositiony",t))),this._posVar.x=parseFloat(s("sourcePositionVariancex",t)),this._posVar.y=parseFloat(s("sourcePositionVariancey",t)),this.startSpin=parseFloat(s("rotationStart",t)),this.startSpinVar=parseFloat(s("rotationStartVariance",t)),this.endSpin=parseFloat(s("rotationEnd",t)),this.endSpinVar=parseFloat(s("rotationEndVariance",t)),this.emitterMode=parseInt(s("emitterType",t)),this.emitterMode===n.ParticleSystem.Mode.GRAVITY){var d=this.modeA;d.gravity.x=parseFloat(s("gravityx",t)),d.gravity.y=parseFloat(s("gravityy",t)),d.speed=parseFloat(s("speed",t)),d.speedVar=parseFloat(s("speedVariance",t));var u=s("radialAcceleration",t);d.radialAccel=u?parseFloat(u):0,u=s("radialAccelVariance",t),d.radialAccelVar=u?parseFloat(u):0,u=s("tangentialAcceleration",t),d.tangentialAccel=u?parseFloat(u):0,u=s("tangentialAccelVariance",t),d.tangentialAccelVar=u?parseFloat(u):0;var _=s("rotationIsDir",t).toLowerCase();d.rotationIsDir=null!=_&&("true"===_||"1"===_)}else{if(this.emitterMode!==n.ParticleSystem.Mode.RADIUS)return n.log("cc.ParticleSystem.initWithDictionary(): Invalid emitterType in config file"),!1;var f=this.modeB;f.startRadius=parseFloat(s("maxRadius",t)),f.startRadiusVar=parseFloat(s("maxRadiusVariance",t)),f.endRadius=parseFloat(s("minRadius",t)),f.endRadiusVar=0,f.rotatePerSecond=parseFloat(s("rotatePerSecond",t)),f.rotatePerSecondVar=parseFloat(s("rotatePerSecondVariance",t))}if(this.life=parseFloat(s("particleLifespan",t)),this.lifeVar=parseFloat(s("particleLifespanVariance",t)),this.emissionRate=this._totalParticles/this.life,!this._batchNode){this._opacityModifyRGB=!1;var p=s("textureFileName",t),g=n.path.changeBasename(this._plistFile,p),m=n.textureCache.getTextureForKey(g);if(m)this.setTexture(m);else{var y=s("textureImageData",t);if(y&&0!==y.length){if(r=n.unzipBase64AsArray(y,1),!r)return n.log("cc.ParticleSystem: error decoding or ungzipping textureImageData"),!1;var v=n.getImageFormatByData(r);if(v!==n.FMT_TIFF&&v!==n.FMT_PNG)return n.log("cc.ParticleSystem: unknown image format with Data"),!1;var T=document.createElement("canvas");if(v===n.FMT_PNG){var C=new n.PNGReader(r);C.render(T)}else{var S=n.tiffReader;S.parseTIFF(r,T)}n.textureCache.cacheImage(g,T);var E=n.textureCache.getTextureForKey(g);E||n.log("cc.ParticleSystem.initWithDictionary() : error loading the texture"),this.setTexture(E)}else{if(m=n.textureCache.addImage(g),!m)return!1;this.setTexture(m)}}}i=!0}return i},initWithTotalParticles:function(t){this._totalParticles=t;var e,i=this._particles;for(i.length=0,e=0;t>e;e++)i[e]=new n.Particle;if(!i)return n.log("Particle system: not enough memory"),!1;if(this._allocatedParticles=t,this._batchNode)for(e=0;e<this._totalParticles;e++)i[e].atlasIndex=e;return this._isActive=!0,this._blendFunc.src=n.BLEND_SRC,this._blendFunc.dst=n.BLEND_DST,this.positionType=n.ParticleSystem.Type.FREE,this.emitterMode=n.ParticleSystem.Mode.GRAVITY,this.autoRemoveOnFinish=!1,this._transformSystemDirty=!1,this.scheduleUpdateWithPriority(1),this._renderCmd._initWithTotalParticles(t),!0},destroyParticleSystem:function(){this.unscheduleUpdate()},addParticle:function(){if(this.isFull())return!1;var t=this._renderCmd.addParticle();return this.initParticle(t),++this.particleCount,!0},initParticle:function(t){var e=n.randomMinus1To1;t.timeToLive=this.life+this.lifeVar*e(),t.timeToLive=Math.max(0,t.timeToLive),t.pos.x=this._sourcePosition.x+this._posVar.x*e(),t.pos.y=this._sourcePosition.y+this._posVar.y*e();var i,r,s=this._startColor,o=this._startColorVar,a=this._endColor,c=this._endColorVar;i={r:n.clampf(s.r+o.r*e(),0,255),g:n.clampf(s.g+o.g*e(),0,255),b:n.clampf(s.b+o.b*e(),0,255),a:n.clampf(s.a+o.a*e(),0,255)},r={r:n.clampf(a.r+c.r*e(),0,255),g:n.clampf(a.g+c.g*e(),0,255),b:n.clampf(a.b+c.b*e(),0,255),a:n.clampf(a.a+c.a*e(),0,255)},t.color=i;var h=t.deltaColor,l=t.timeToLive;h.r=(r.r-i.r)/l,h.g=(r.g-i.g)/l,h.b=(r.b-i.b)/l,h.a=(r.a-i.a)/l;var d=this.startSize+this.startSizeVar*e();if(d=Math.max(0,d),t.size=d,this.endSize===n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE)t.deltaSize=0;else{var u=this.endSize+this.endSizeVar*e();u=Math.max(0,u),t.deltaSize=(u-d)/l}var _=this.startSpin+this.startSpinVar*e(),f=this.endSpin+this.endSpinVar*e();t.rotation=_,t.deltaRotation=(f-_)/l,this.positionType===n.ParticleSystem.Type.FREE?t.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this.positionType===n.ParticleSystem.Type.RELATIVE&&(t.startPos.x=this._position.x,t.startPos.y=this._position.y);var p=n.degreesToRadians(this.angle+this.angleVar*e());if(this.emitterMode===n.ParticleSystem.Mode.GRAVITY){var g=this.modeA,m=t.modeA,y=g.speed+g.speedVar*e();m.dir.x=Math.cos(p),m.dir.y=Math.sin(p),n.pMultIn(m.dir,y),m.radialAccel=g.radialAccel+g.radialAccelVar*e(),m.tangentialAccel=g.tangentialAccel+g.tangentialAccelVar*e(),g.rotationIsDir&&(t.rotation=-n.radiansToDegrees(n.pToAngle(m.dir)))}else{var v=this.modeB,T=t.modeB,C=v.startRadius+v.startRadiusVar*e(),S=v.endRadius+v.endRadiusVar*e();T.radius=C,T.deltaRadius=v.endRadius===n.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(S-C)/l,T.angle=p,T.degreesPerSecond=n.degreesToRadians(v.rotatePerSecond+v.rotatePerSecondVar*e())}},stopSystem:function(){this._isActive=!1,this._elapsed=this.duration,this._emitCounter=0},resetSystem:function(){this._isActive=!0,this._elapsed=0;var t=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)t[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=this._totalParticles},updateQuadWithParticle:function(t,e){this._renderCmd.updateQuadWithParticle(t,e)},postStep:function(){this._renderCmd.postStep()},update:function(t){if(this._isActive&&this.emissionRate){var e=1/this.emissionRate;for(this.particleCount<this._totalParticles&&(this._emitCounter+=t);this.particleCount<this._totalParticles&&this._emitCounter>e;)this.addParticle(),this._emitCounter-=e;this._elapsed+=t,-1!==this.duration&&this.duration<this._elapsed&&this.stopSystem()}this._particleIdx=0;var i=n.Particle.TemporaryPoints[0];if(this.positionType===n.ParticleSystem.Type.FREE?n.pIn(i,this.convertToWorldSpace(this._pointZeroForParticle)):this.positionType===n.ParticleSystem.Type.RELATIVE&&(i.x=this._position.x,i.y=this._position.y),this._visible){for(var r=n.Particle.TemporaryPoints[1],s=n.Particle.TemporaryPoints[2],o=n.Particle.TemporaryPoints[3],a=this._particles;this._particleIdx<this.particleCount;){n.pZeroIn(r),n.pZeroIn(s),n.pZeroIn(o);var c=a[this._particleIdx];if(c.timeToLive-=t,c.timeToLive>0){if(this.emitterMode===n.ParticleSystem.Mode.GRAVITY){var h=o,l=r,d=s;c.pos.x||c.pos.y?(n.pIn(l,c.pos),n.pNormalizeIn(l)):n.pZeroIn(l),n.pIn(d,l),n.pMultIn(l,c.modeA.radialAccel);var u=d.x;d.x=-d.y,d.y=u,n.pMultIn(d,c.modeA.tangentialAccel),n.pIn(h,l),n.pAddIn(h,d),n.pAddIn(h,this.modeA.gravity),n.pMultIn(h,t),n.pAddIn(c.modeA.dir,h),n.pIn(h,c.modeA.dir),n.pMultIn(h,t),n.pAddIn(c.pos,h)}else{var _=c.modeB;_.angle+=_.degreesPerSecond*t,_.radius+=_.deltaRadius*t,c.pos.x=-Math.cos(_.angle)*_.radius,c.pos.y=-Math.sin(_.angle)*_.radius}this._renderCmd._updateDeltaColor(c,t),c.size+=c.deltaSize*t,c.size=Math.max(0,c.size),c.rotation+=c.deltaRotation*t;var f=r;if(this.positionType===n.ParticleSystem.Type.FREE||this.positionType===n.ParticleSystem.Type.RELATIVE){var p=s;n.pIn(p,i),n.pSubIn(p,c.startPos),n.pIn(f,c.pos),n.pSubIn(f,p)}else n.pIn(f,c.pos);this._batchNode&&(f.x+=this._position.x,f.y+=this._position.y),this._renderCmd.updateParticlePosition(c,f),++this._particleIdx}else{var g=c.atlasIndex;if(this._particleIdx!==this.particleCount-1){var m=a[this._particleIdx];a[this._particleIdx]=a[this.particleCount-1],a[this.particleCount-1]=m}if(this._batchNode&&(this._batchNode.disableParticle(this.atlasIndex+g),a[this.particleCount-1].atlasIndex=g),--this.particleCount,0===this.particleCount&&this.autoRemoveOnFinish)return this.unscheduleUpdate(),void this._parent.removeChild(this,!0)}}this._transformSystemDirty=!1}this._batchNode||this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(t,e){if(e){var i=e[t];return null!=i?i:""}return""},_updateBlendFunc:function(){if(this._batchNode)return void n.log("Can't change blending functions when the particle is being batched");var t=this._texture;if(t&&t instanceof n.Texture2D){this._opacityModifyRGB=!1;var e=this._blendFunc;e.src===n.BLEND_SRC&&e.dst===n.BLEND_DST&&(t.hasPremultipliedAlpha()?this._opacityModifyRGB=!0:(e.src=n.SRC_ALPHA,e.dst=n.ONE_MINUS_SRC_ALPHA))}},clone:function(){var t=new n.ParticleSystem;if(t.initWithTotalParticles(this.getTotalParticles())){t.setAngle(this.getAngle()),t.setAngleVar(this.getAngleVar()),t.setDuration(this.getDuration());var e=this.getBlendFunc();if(t.setBlendFunc(e.src,e.dst),t.setStartColor(this.getStartColor()),t.setStartColorVar(this.getStartColorVar()),t.setEndColor(this.getEndColor()),t.setEndColorVar(this.getEndColorVar()),t.setStartSize(this.getStartSize()),t.setStartSizeVar(this.getStartSizeVar()),t.setEndSize(this.getEndSize()),t.setEndSizeVar(this.getEndSizeVar()),t.setPosition(n.p(this.x,this.y)),t.setPosVar(n.p(this.getPosVar().x,this.getPosVar().y)),t.setPositionType(this.getPositionType()),t.setStartSpin(this.getStartSpin()||0),t.setStartSpinVar(this.getStartSpinVar()||0),t.setEndSpin(this.getEndSpin()||0),t.setEndSpinVar(this.getEndSpinVar()||0),t.setEmitterMode(this.getEmitterMode()),this.getEmitterMode()===n.ParticleSystem.Mode.GRAVITY){var i=this.getGravity();t.setGravity(n.p(i.x,i.y)),t.setSpeed(this.getSpeed()),t.setSpeedVar(this.getSpeedVar()),t.setRadialAccel(this.getRadialAccel()),t.setRadialAccelVar(this.getRadialAccelVar()),t.setTangentialAccel(this.getTangentialAccel()),t.setTangentialAccelVar(this.getTangentialAccelVar())}else this.getEmitterMode()===n.ParticleSystem.Mode.RADIUS&&(t.setStartRadius(this.getStartRadius()),t.setStartRadiusVar(this.getStartRadiusVar()),t.setEndRadius(this.getEndRadius()),t.setEndRadiusVar(this.getEndRadiusVar()),t.setRotatePerSecond(this.getRotatePerSecond()),t.setRotatePerSecondVar(this.getRotatePerSecondVar()));if(t.setLife(this.getLife()),t.setLifeVar(this.getLifeVar()),t.setEmissionRate(this.getEmissionRate()),!this.getBatchNode()){t.setOpacityModifyRGB(this.isOpacityModifyRGB());var r=this.getTexture();if(r){var s=r.getContentSize();t.setTextureWithRect(r,n.rect(0,0,s.width,s.height))}}}return t},setDisplayFrame:function(t){if(t){var e=t.getOffsetInPixels();(0!==e.x||0!==e.y)&&n.log("cc.ParticleSystem.setDisplayFrame(): QuadParticle only supports SpriteFrames with no offsets");var i=t.getTexture(),r=this._texture;r!==i&&this.setTexture(i)}},setTextureWithRect:function(t,e){var i=this._texture;i!==t&&(this._texture=t,this._updateBlendFunc()),this.initTexCoordsWithRect(e)},listenBackToForeground:function(t){}});var c=n.ParticleSystem.prototype;c.opacityModifyRGB,n.defineGetterSetter(c,"opacityModifyRGB",c.isOpacityModifyRGB,c.setOpacityModifyRGB),c.batchNode,n.defineGetterSetter(c,"batchNode",c.getBatchNode,c.setBatchNode),c.drawMode,n.defineGetterSetter(c,"drawMode",c.getDrawMode,c.setDrawMode),c.shapeType,n.defineGetterSetter(c,"shapeType",c.getShapeType,c.setShapeType),c.active,n.defineGetterSetter(c,"active",c.isActive),c.sourcePos,n.defineGetterSetter(c,"sourcePos",c.getSourcePosition,c.setSourcePosition),c.posVar,n.defineGetterSetter(c,"posVar",c.getPosVar,c.setPosVar),c.gravity,n.defineGetterSetter(c,"gravity",c.getGravity,c.setGravity),c.speed,n.defineGetterSetter(c,"speed",c.getSpeed,c.setSpeed),c.speedVar,n.defineGetterSetter(c,"speedVar",c.getSpeedVar,c.setSpeedVar),c.tangentialAccel,n.defineGetterSetter(c,"tangentialAccel",c.getTangentialAccel,c.setTangentialAccel),c.tangentialAccelVar,n.defineGetterSetter(c,"tangentialAccelVar",c.getTangentialAccelVar,c.setTangentialAccelVar),c.radialAccel,n.defineGetterSetter(c,"radialAccel",c.getRadialAccel,c.setRadialAccel),c.radialAccelVar,n.defineGetterSetter(c,"radialAccelVar",c.getRadialAccelVar,c.setRadialAccelVar),c.rotationIsDir,n.defineGetterSetter(c,"rotationIsDir",c.getRotationIsDir,c.setRotationIsDir),c.startRadius,n.defineGetterSetter(c,"startRadius",c.getStartRadius,c.setStartRadius),c.startRadiusVar,n.defineGetterSetter(c,"startRadiusVar",c.getStartRadiusVar,c.setStartRadiusVar),c.endRadius,n.defineGetterSetter(c,"endRadius",c.getEndRadius,c.setEndRadius),c.endRadiusVar,n.defineGetterSetter(c,"endRadiusVar",c.getEndRadiusVar,c.setEndRadiusVar),c.rotatePerS,n.defineGetterSetter(c,"rotatePerS",c.getRotatePerSecond,c.setRotatePerSecond),c.rotatePerSVar,n.defineGetterSetter(c,"rotatePerSVar",c.getRotatePerSecondVar,c.setRotatePerSecondVar),c.startColor,n.defineGetterSetter(c,"startColor",c.getStartColor,c.setStartColor),c.startColorVar,n.defineGetterSetter(c,"startColorVar",c.getStartColorVar,c.setStartColorVar),c.endColor,n.defineGetterSetter(c,"endColor",c.getEndColor,c.setEndColor),c.endColorVar,n.defineGetterSetter(c,"endColorVar",c.getEndColorVar,c.setEndColorVar),c.totalParticles,n.defineGetterSetter(c,"totalParticles",c.getTotalParticles,c.setTotalParticles),c.texture,n.defineGetterSetter(c,"texture",c.getTexture,c.setTexture),n.ParticleSystem.create=function(t){return new n.ParticleSystem(t)},n.ParticleSystem.createWithTotalParticles=n.ParticleSystem.create,n.ParticleSystem.ModeA=function(t,e,i,r,s,o,a,c){this.gravity=t?t:n.p(0,0),this.speed=e||0,this.speedVar=i||0,this.tangentialAccel=r||0,this.tangentialAccelVar=s||0,this.radialAccel=o||0,this.radialAccelVar=a||0,this.rotationIsDir=c||!1},n.ParticleSystem.ModeB=function(t,e,i,n,r,s){this.startRadius=t||0,this.startRadiusVar=e||0,this.endRadius=i||0,this.endRadiusVar=n||0,this.rotatePerSecond=r||0,this.rotatePerSecondVar=s||0},n.ParticleSystem.SHAPE_MODE=0,n.ParticleSystem.TEXTURE_MODE=1,n.ParticleSystem.STAR_SHAPE=0,n.ParticleSystem.BALL_SHAPE=1,n.ParticleSystem.DURATION_INFINITY=-1,n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1,n.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1,n.ParticleSystem.Mode=n.Enum({GRAVITY:0,RADIUS:1}),n.ParticleSystem.Type=n.Enum({FREE:0,RELATIVE:1,GROUPED:2}),function(){n.ParticleSystem.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._drawMode=n.ParticleSystem.TEXTURE_MODE,this._shapeType=n.ParticleSystem.BALL_SHAPE,this._pointRect=n.rect(0,0,0,0),this._tintCache=document.createElement("canvas")};var t=n.ParticleSystem.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.ParticleSystem.CanvasRenderCmd,t.getDrawMode=function(){return this._drawMode},t.setDrawMode=function(t){this._drawMode=t},t.getShapeType=function(){return this._shapeType},t.setShapeType=function(t){this._shapeType=t},t.setBatchNode=function(t){this._batchNode!==t&&(this._node._batchNode=t)},t.updateQuadWithParticle=function(t,e){},t.updateParticlePosition=function(t,e){n.pIn(t.drawPos,e)},t.rendering=function(t,e,i){var r=t||n._renderContext,s=r.getContext(),o=this._node,a=this._pointRect;r.setTransform(this._worldTransform,e,i),r.save(),s.globalCompositeOperation=o.isBlendAdditive()?"lighter":"source-over";var c,h,l,d,u=this._node.particleCount,_=this._node._particles;if(o.drawMode!==n.ParticleSystem.SHAPE_MODE&&o._texture){if(!o._texture._textureLoaded)return void r.restore();var f=o._texture.getHtmlElementObj();if(!f.width||!f.height)return void r.restore();var p=f;for(c=0;u>c;c++)if(h=_[c],l=0|.5*h.size,d=h.color.a/255,0!==d){s.globalAlpha=d,s.save(),s.translate(0|h.drawPos.x,-(0|h.drawPos.y));var g=4*Math.floor(h.size/4),m=a.width,y=a.height;s.scale(Math.max(1/m*g,1e-6),Math.max(1/y*g,1e-6)),h.rotation&&s.rotate(n.degreesToRadians(h.rotation)),p=h.isChangeColor?this._changeTextureColor(o._texture,h.color,this._pointRect):f,s.drawImage(p,-(0|m/2),-(0|y/2)),s.restore()}}else{var v=n._drawingUtil;for(c=0;u>c;c++)h=_[c],l=0|.5*h.size,d=h.color.a/255,0!==d&&(s.globalAlpha=d,s.save(),s.translate(0|h.drawPos.x,-(0|h.drawPos.y)),o.shapeType===n.ParticleSystem.STAR_SHAPE?(h.rotation&&s.rotate(n.degreesToRadians(h.rotation)),v.drawStar(r,l,h.color)):v.drawColorBall(r,l,h.color),s.restore())}r.restore(),n.g_NumberOfDraws++},t._changeTextureColor=function(t,e,i){var n=this._tintCache,r=t.getContentSize();return n.width=r.width,n.height=r.height,t._generateColorTexture(e.r,e.g,e.b,i,n)},t.initTexCoordsWithRect=function(t){this._pointRect=t},t.setTotalParticles=function(t){this._node._totalParticles=200>t?t:200},t.addParticle=function(){var t,e=this._node,i=e._particles;return e.particleCount<i.length?t=i[e.particleCount]:(t=new n.Particle,i.push(t)),t},t._setupVBO=function(){},t._allocMemory=function(){return!0},t.postStep=function(){},t._setBlendAdditive=function(){var t=this._node._blendFunc;t.src=n.BLEND_SRC,t.dst=n.BLEND_DST},t._initWithTotalParticles=function(t){},t._updateDeltaColor=function(t,e){this._node._dontTint||(t.color.r+=t.deltaColor.r*e,t.color.g+=t.deltaColor.g*e,t.color.b+=t.deltaColor.b*e,t.color.a+=t.deltaColor.a*e,t.isChangeColor=!0)}}(),function(){n.ParticleSystem.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._buffersVBO=[0,0],this._quads=[],this._indices=[],this._quadsArrayBuffer=null};var t=n.ParticleSystem.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.ParticleSystem.WebGLRenderCmd,t.getDrawMode=function(){},t.setDrawMode=function(t){},t.getShapeType=function(){},t.setShapeType=function(t){},t.setBatchNode=function(t){var e=this._node;if(e._batchNode!==t){var i=e._batchNode;if(e._batchNode=t,t)for(var r=e._particles,s=0;s<e._totalParticles;s++)r[s].atlasIndex=s;t?i||(e._batchNode.textureAtlas._copyQuadsToTextureAtlas(this._quads,e.atlasIndex),n._renderContext.deleteBuffer(this._buffersVBO[1])):(this._allocMemory(),this.initIndices(e._totalParticles),e.setTexture(i.getTexture()),this._setupVBO())}},t.initIndices=function(t){for(var e=this._indices,i=0,n=t;n>i;++i){var r=6*i,s=4*i;e[r+0]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+5]=s+1,e[r+4]=s+2,e[r+3]=s+3}},t.isDifferentTexture=function(t,e){return t===e},t.updateParticlePosition=function(t,e){this.updateQuadWithParticle(t,e)},t.updateQuadWithParticle=function(t,e){var i=null,r=this._node;if(r._batchNode){var s=r._batchNode.textureAtlas.quads;i=s[r.atlasIndex+t.atlasIndex],r._batchNode.textureAtlas.dirty=!0}else i=this._quads[r._particleIdx];var o,a,c,h;r._opacityModifyRGB?(o=0|t.color.r*t.color.a/255,a=0|t.color.g*t.color.a/255,c=0|t.color.b*t.color.a/255):(o=0|t.color.r,a=0|t.color.g,c=0|t.color.b),h=0|t.color.a;var l=i.bl.colors,d=i.br.colors,u=i.tl.colors,_=i.tr.colors;l.r=d.r=u.r=_.r=o,l.g=d.g=u.g=_.g=a,l.b=d.b=u.b=_.b=c,l.a=d.a=u.a=_.a=h;var f=t.size/2;if(t.rotation){var p=-f,g=-f,m=f,y=f,v=e.x,T=e.y,C=-n.degreesToRadians(t.rotation),S=Math.cos(C),E=Math.sin(C),b=p*S-g*E+v,x=p*E+g*S+T,A=m*S-g*E+v,R=m*E+g*S+T,I=m*S-y*E+v,P=m*E+y*S+T,L=p*S-y*E+v,w=p*E+y*S+T;i.bl.vertices.x=b,i.bl.vertices.y=x,i.br.vertices.x=A,i.br.vertices.y=R,i.tl.vertices.x=L,i.tl.vertices.y=w,i.tr.vertices.x=I,i.tr.vertices.y=P}else i.bl.vertices.x=e.x-f,i.bl.vertices.y=e.y-f,i.br.vertices.x=e.x+f,i.br.vertices.y=e.y-f,i.tl.vertices.x=e.x-f,i.tl.vertices.y=e.y+f,i.tr.vertices.x=e.x+f,i.tr.vertices.y=e.y+f},t.rendering=function(t){var e=this._node;if(e._texture){var i=t||n._renderContext;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),n.glBindTexture2D(e._texture),n.glBlendFuncForParticle(e._blendFunc.src,e._blendFunc.dst),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),i.bindBuffer(i.ARRAY_BUFFER,this._buffersVBO[0]),i.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,3,i.FLOAT,!1,24,0),i.vertexAttribPointer(n.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,24,12),i.vertexAttribPointer(n.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,!1,24,16),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),i.drawElements(i.TRIANGLES,6*e._particleIdx,i.UNSIGNED_SHORT,0)}},t.initTexCoordsWithRect=function(t){var e=this._node,i=e.texture,r=n.contentScaleFactor(),s=n.rect(t.x*r,t.y*r,t.width*r,t.height*r),o=t.width,a=t.height;i&&(o=i.getPixelWidth(),a=i.getPixelHeight());var c,h,l,d;n.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(c=(2*s.x+1)/(2*o),h=(2*s.y+1)/(2*a),l=c+(2*s.width-2)/(2*o),d=h+(2*s.height-2)/(2*a)):(c=s.x/o,h=s.y/a,l=c+s.width/o,d=h+s.height/a);var u=d;d=h,h=u;var _,f=0,p=0;e._batchNode?(_=e._batchNode.textureAtlas.quads,f=e.atlasIndex,p=e.atlasIndex+e._totalParticles):(_=this._quads,f=0,p=e._totalParticles);for(var g=f;p>g;g++){_[g]||(_[g]=n.V3F_C4B_T2F_QuadZero());var m=_[g];m.bl.texCoords.u=c,m.bl.texCoords.v=h,m.br.texCoords.u=l,m.br.texCoords.v=h,m.tl.texCoords.u=c,m.tl.texCoords.v=d,m.tr.texCoords.u=l,m.tr.texCoords.v=d}},t.setTotalParticles=function(t){var e=this._node;if(t>e._allocatedParticles){var i=n.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(6*t);var r=new ArrayBuffer(t*i),s=e._particles;s.length=0;var o=this._quads;o.length=0;for(var a=0;t>a;a++)s[a]=new n.Particle,o[a]=new n.V3F_C4B_T2F_Quad(null,null,null,null,r,a*i);if(e._allocatedParticles=t,e._totalParticles=t,e._batchNode)for(var c=0;t>c;c++)s[c].atlasIndex=c;this._quadsArrayBuffer=r,this.initIndices(t),this._setupVBO(),e._texture&&this.initTexCoordsWithRect(n.rect(0,0,e._texture.width,e._texture.height))}else e._totalParticles=t;e.resetSystem()},t.addParticle=function(){var t=this._node,e=t._particles;return e[t.particleCount]},t._setupVBO=function(){var t=n._renderContext;this._buffersVBO[0]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),this._buffersVBO[1]=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},t._allocMemory=function(){var t=this._node;if(t._batchNode)return n.log("cc.ParticleSystem._allocMemory(): Memory should not be allocated when not using batchNode"),!1;var e=n.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=t._totalParticles,r=this._quads;r.length=0,this._indices=new Uint16Array(6*i);for(var s=new ArrayBuffer(e*i),o=0;i>o;o++)r[o]=new n.V3F_C4B_T2F_Quad(null,null,null,null,s,o*e);return r&&this._indices?(this._quadsArrayBuffer=s,!0):(n.log("cocos2d: Particle system: not enough memory"),!1)},t.postStep=function(){var t=n._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW)},t._setBlendAdditive=function(){var t=this._node._blendFunc;this._texture&&!this._texture.hasPremultipliedAlpha()?(t.src=n.SRC_ALPHA,t.dst=n.ONE_MINUS_SRC_ALPHA):(t.src=n.BLEND_SRC,t.dst=n.BLEND_DST)},t._initWithTotalParticles=function(t){return this._allocMemory()?(this.initIndices(t),this._setupVBO(),void(this._shaderProgram=n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURECOLOR))):!1},t._updateDeltaColor=function(t,e){t.color.r+=t.deltaColor.r*e,t.color.g+=t.deltaColor.g*e,t.color.b+=t.deltaColor.b*e,t.color.a+=t.deltaColor.a*e,t.isChangeColor=!0}}(),n.ParticleFire=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?300:150)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(n.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(60),this.setSpeedVar(20),this.setAngle(90),this.setAngleVar(10);var e=n.director.getWinSize();return this.setPosition(e.width/2,60),this.setPosVar(n.p(40,20)),this.setLife(3),this.setLifeVar(.25),this.setStartSize(54),this.setStartSizeVar(10),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(n.color(194,64,31,255)),this.setStartColorVar(n.color(0,0,0,0)),this.setEndColor(n.color(0,0,0,255)),this.setEndColorVar(n.color(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}}),n.ParticleFire.create=function(){return new n.ParticleFire},n.ParticleFireworks=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?1500:150)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(n.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(0,-90)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(180),this.setSpeedVar(50);var e=n.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setAngle(90),this.setAngleVar(20),this.setLife(3.5),this.setLifeVar(1),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(n.color(128,128,128,255)),this.setStartColorVar(n.color(128,128,128,255)),this.setEndColor(n.color(26,26,26,51)),this.setEndColorVar(n.color(26,26,26,51)),this.setStartSize(8),this.setStartSizeVar(2),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setBlendAdditive(!1),!0}return!1}}),n.ParticleFireworks.create=function(){return new n.ParticleFireworks},n.ParticleSun=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?350:150)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setBlendAdditive(!0),this.setDuration(n.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(20),this.setSpeedVar(5),this.setAngle(90),this.setAngleVar(360);var e=n.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(n.p(0,0)),this.setLife(1),this.setLifeVar(.5),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(n.color(194,64,31,255)),this.setStartColorVar(n.color(0,0,0,0)),this.setEndColor(n.color(0,0,0,255)),this.setEndColorVar(n.color(0,0,0,0)),!0}return!1}}),n.ParticleSun.create=function(){return new n.ParticleSun},n.ParticleGalaxy=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(n.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(0,0)),this.setSpeed(60),this.setSpeedVar(10),this.setRadialAccel(-80),this.setRadialAccelVar(0),this.setTangentialAccel(80),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var e=n.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(n.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(37),this.setStartSizeVar(10),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(n.color(31,64,194,255)),this.setStartColorVar(n.color(0,0,0,0)),this.setEndColor(n.color(0,0,0,255)),this.setEndColorVar(n.color(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}}),n.ParticleGalaxy.create=function(){return new n.ParticleGalaxy},n.ParticleFlower=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?250:100)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(n.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(0,0)),this.setSpeed(80),this.setSpeedVar(10),this.setRadialAccel(-60),this.setRadialAccelVar(0),this.setTangentialAccel(15),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var e=n.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(n.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(n.color(128,128,128,255)),this.setStartColorVar(n.color(128,128,128,128)),this.setEndColor(n.color(0,0,0,255)),this.setEndColorVar(n.color(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}}),n.ParticleFlower.create=function(){return new n.ParticleFlower},n.ParticleMeteor=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?150:100)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(n.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(-200,200)),this.setSpeed(15),this.setSpeedVar(5),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var e=n.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(n.p(0,0)),this.setLife(2),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(n.color(51,102,179)),this.setStartColorVar(n.color(0,0,51,26)),this.setEndColor(n.color(0,0,0,255)),this.setEndColorVar(n.color(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}}),n.ParticleMeteor.create=function(){return new n.ParticleMeteor},n.ParticleSpiral=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?500:100)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(n.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(0,0)),this.setSpeed(150),this.setSpeedVar(0),this.setRadialAccel(-380),this.setRadialAccelVar(0),this.setTangentialAccel(45),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(0);var e=n.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(n.p(0,0)),this.setLife(12),this.setLifeVar(0),this.setStartSize(20),this.setStartSizeVar(0),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(n.color(128,128,128,255)),this.setStartColorVar(n.color(128,128,128,0)),this.setEndColor(n.color(128,128,128,255)),this.setEndColorVar(n.color(128,128,128,0)),this.setBlendAdditive(!1),!0}return!1}}),n.ParticleSpiral.create=function(){return new n.ParticleSpiral},n.ParticleExplosion=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?700:300)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(.1),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(0,0)),this.setSpeed(70),this.setSpeedVar(40),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var e=n.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(n.p(0,0)),this.setLife(5),this.setLifeVar(2),this.setStartSize(15),this.setStartSizeVar(10),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),
this.setEmissionRate(this.getTotalParticles()/this.getDuration()),this.setStartColor(n.color(179,26,51,255)),this.setStartColorVar(n.color(128,128,128,0)),this.setEndColor(n.color(128,128,128,0)),this.setEndColorVar(n.color(128,128,128,0)),this.setBlendAdditive(!1),!0}return!1}}),n.ParticleExplosion.create=function(){return new n.ParticleExplosion},n.ParticleSmoke=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(n.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(25),this.setSpeedVar(10),this.setAngle(90),this.setAngleVar(5);var e=n.director.getWinSize();return this.setPosition(e.width/2,0),this.setPosVar(n.p(20,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(n.color(204,204,204,255)),this.setStartColorVar(n.color(5,5,5,0)),this.setEndColor(n.color(0,0,0,255)),this.setEndColorVar(n.color(0,0,0,0)),this.setBlendAdditive(!1),!0}return!1}}),n.ParticleSmoke.create=function(){return new n.ParticleSmoke},n.ParticleSnow=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?700:250)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(n.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(0,-1)),this.setSpeed(5),this.setSpeedVar(1),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1);var e=n.director.getWinSize();return this.setPosition(e.width/2,e.height+10),this.setPosVar(n.p(e.width/2,0)),this.setAngle(-90),this.setAngleVar(5),this.setLife(45),this.setLifeVar(15),this.setStartSize(10),this.setStartSizeVar(5),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(10),this.setStartColor(n.color(255,255,255,255)),this.setStartColorVar(n.color(0,0,0,0)),this.setEndColor(n.color(255,255,255,0)),this.setEndColorVar(n.color(0,0,0,0)),this.setBlendAdditive(!1),!0}return!1}}),n.ParticleSnow.create=function(){return new n.ParticleSnow},n.ParticleRain=n.ParticleSystem.extend({ctor:function(){n.ParticleSystem.prototype.ctor.call(this,n._renderType===n.game.RENDER_TYPE_WEBGL?1e3:300)},initWithTotalParticles:function(t){if(n.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(n.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(n.ParticleSystem.Mode.GRAVITY),this.setGravity(n.p(10,-10)),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1),this.setSpeed(130),this.setSpeedVar(30),this.setAngle(-90),this.setAngleVar(5);var e=n.director.getWinSize();return this.setPosition(e.width/2,e.height),this.setPosVar(n.p(e.width/2,0)),this.setLife(4.5),this.setLifeVar(0),this.setStartSize(4),this.setStartSizeVar(2),this.setEndSize(n.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(20),this.setStartColor(n.color(179,204,255,255)),this.setStartColorVar(n.color(0,0,0,0)),this.setEndColor(n.color(179,204,255,128)),this.setEndColorVar(n.color(0,0,0,0)),this.setBlendAdditive(!1),!0}return!1}}),n.ParticleRain.create=function(){return new n.ParticleRain},n.PARTICLE_DEFAULT_CAPACITY=500,n.ParticleBatchNode=_ccsg.Node.extend({textureAtlas:null,_blendFunc:null,_className:"ParticleBatchNode",ctor:function(t,e){_ccsg.Node.prototype.ctor.call(this),this._blendFunc={src:n.BLEND_SRC,dst:n.BLEND_DST},n.js.isString(t)?this.init(t,e):t instanceof n.Texture2D&&this.initWithTexture(t,e)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.ParticleBatchNode.CanvasRenderCmd(this):new n.ParticleBatchNode.WebGLRenderCmd(this)},initWithTexture:function(t,e){return this.textureAtlas=new n.TextureAtlas,this.textureAtlas.initWithTexture(t,e),this._children.length=0,this._renderCmd._initWithTexture(),!0},initWithFile:function(t,e){var i=n.textureCache.addImage(t);return this.initWithTexture(i,e)},init:function(t,e){var i=n.textureCache.addImage(t);return this.initWithTexture(i,e)},addChild:function(t,e,i){if(!t)throw new Error("cc.ParticleBatchNode.addChild() : child should be non-null");if(!(t instanceof n.ParticleSystem))throw new Error("cc.ParticleBatchNode.addChild() : only supports cc.ParticleSystem as children");if(e=null==e?t.zIndex:e,i=null==i?t.tag:i,t.getTexture()!==this.textureAtlas.texture)throw new Error("cc.ParticleSystem.addChild() : the child is not using the same texture id");var r=t.getBlendFunc();if(0===this._children.length)this.setBlendFunc(r);else if(r.src!==this._blendFunc.src||r.dst!==this._blendFunc.dst)return void n.log("cc.ParticleSystem.addChild() : Can't add a ParticleSystem that uses a different blending function");var s=this._addChildHelper(t,e,i),o=0;if(0!==s){var a=this._children[s-1];o=a.getAtlasIndex()+a.getTotalParticles()}else o=0;this.insertChild(t,o),t.setBatchNode(this)},insertChild:function(t,e){var i=t.getTotalParticles(),n=this.textureAtlas,r=n.totalQuads;t.setAtlasIndex(e),r+i>n.getCapacity()&&(this._increaseAtlasCapacityTo(r+i),n.fillWithEmptyQuadsFromIndex(n.getCapacity()-i,i)),t.getAtlasIndex()+i!==r&&n.moveQuadsFromIndex(e,e+i),n.increaseTotalQuadsWith(i),this._updateAllAtlasIndexes()},removeChild:function(t,e){if(null!=t){if(!(t instanceof n.ParticleSystem))throw new Error("cc.ParticleBatchNode.removeChild(): only supports cc.ParticleSystem as children");if(-1===this._children.indexOf(t))return void n.log("cc.ParticleBatchNode.removeChild(): doesn't contain the sprite. Can't remove it");_ccsg.Node.prototype.removeChild.call(this,t,e);var i=this.textureAtlas;i.removeQuadsAtIndex(t.getAtlasIndex(),t.getTotalParticles()),i.fillWithEmptyQuadsFromIndex(i.totalQuads,t.getTotalParticles()),t.setBatchNode(null),this._updateAllAtlasIndexes()}},reorderChild:function(t,e){if(!t)throw new Error("cc.ParticleBatchNode.reorderChild(): child should be non-null");if(!(t instanceof n.ParticleSystem))throw new Error("cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children");if(-1===this._children.indexOf(t))return void n.log("cc.ParticleBatchNode.reorderChild(): Child doesn't belong to batch");if(e!==t.zIndex){if(this._children.length>1){var i=this._getCurrentIndex(t,e);if(i.oldIndex!==i.newIndex){this._children.splice(i.oldIndex,1),this._children.splice(i.newIndex,0,t);var r=t.getAtlasIndex();this._updateAllAtlasIndexes();for(var s=0,o=this._children,a=0;a<o.length;a++){var c=o[a];if(c===t){s=t.getAtlasIndex();break}}this.textureAtlas.moveQuadsFromIndex(r,t.getTotalParticles(),s),t.updateWithNoTime()}}t._setLocalZOrder(e)}},removeChildAtIndex:function(t,e){this.removeChild(this._children[i],e)},removeAllChildren:function(t){for(var e=this._children,i=0;i<e.length;i++)e[i].setBatchNode(null);_ccsg.Node.prototype.removeAllChildren.call(this,t),this.textureAtlas.removeAllQuads()},disableParticle:function(t){var e=this.textureAtlas.quads[t];e.br.vertices.x=e.br.vertices.y=e.tr.vertices.x=e.tr.vertices.y=e.tl.vertices.x=e.tl.vertices.y=e.bl.vertices.x=e.bl.vertices.y=0,this.textureAtlas._setDirty(!0)},getTexture:function(){return this.textureAtlas.texture},setTexture:function(t){this.textureAtlas.texture=t;var e=this._blendFunc;t&&!t.hasPremultipliedAlpha()&&e.src===n.BLEND_SRC&&e.dst===n.BLEND_DST&&(e.src=n.SRC_ALPHA,e.dst=n.ONE_MINUS_SRC_ALPHA)},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.src=e)},getBlendFunc:function(){return new n.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_updateAllAtlasIndexes:function(){for(var t=0,e=this._children,i=0;i<e.length;i++){var n=e[i];n.setAtlasIndex(t),t+=n.getTotalParticles()}},_increaseAtlasCapacityTo:function(t){n.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this.textureAtlas.getCapacity()+"] to ["+t+"]."),this.textureAtlas.resizeCapacity(t)||n.log("cc.ParticleBatchNode._increaseAtlasCapacityTo() : WARNING: Not enough memory to resize the atlas")},_searchNewPositionInChildrenForZ:function(t){for(var e=this._children,i=e.length,n=0;i>n;n++)if(e[n].zIndex>t)return n;return i},_getCurrentIndex:function(t,e){for(var i=!1,n=!1,r=0,s=0,o=0,a=this._children,c=a.length,h=0;c>h;h++){var l=a[h];if(l.zIndex>e&&!n&&(r=h,n=!0,i&&n))break;if(t===l&&(s=h,i=!0,n||(o=-1),i&&n))break}return n||(r=c),r+=o,{newIndex:r,oldIndex:s}},_addChildHelper:function(t,e,i){if(!t)throw new Error("cc.ParticleBatchNode._addChildHelper(): child should be non-null");if(t.parent)return n.log("cc.ParticleBatchNode._addChildHelper(): child already added. It can't be added again"),null;this._children||(this._children=[]);var r=this._searchNewPositionInChildrenForZ(e);return this._children.splice(r,0,t),t.tag=i,t._setLocalZOrder(e),t.parent=this,this._running&&(t.onEnter(),t.onEnterTransitionDidFinish()),r},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=n.SRC_ALPHA,this._blendFunc.dst=n.ONE_MINUS_SRC_ALPHA)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t}});var c=n.ParticleBatchNode.prototype;c.texture,n.defineGetterSetter(c,"texture",c.getTexture,c.setTexture),n.ParticleBatchNode.create=function(t,e){return new n.ParticleBatchNode(t,e)},function(){n.ParticleBatchNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1};var t=n.ParticleBatchNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.ParticleBatchNode.CanvasRenderCmd,t._initWithTexture=function(){}}(),function(){n.ParticleBatchNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=n.ParticleBatchNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.ParticleBatchNode.WebGLRenderCmd,t.rendering=function(t){var e=this._node;0!==e.textureAtlas.totalQuads&&(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),n.glBlendFuncForParticle(e._blendFunc.src,e._blendFunc.dst),e.textureAtlas.drawQuads())},t._initWithTexture=function(){this._shaderProgram=n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURECOLOR)},t.visit=function(t){var e=this._node;if(e._visible){var i=n.current_stack;i.stack.push(i.top),this._syncStatus(t),i.top=this._stackMatrix,n.renderer.pushRenderCommand(this),this._dirtyFlag=0,n.kmGLPopMatrix()}}}(),n.IMEKeyboardNotificationInfo=function(t,e,i){this.begin=t||n.rect(0,0,0,0),this.end=e||n.rect(0,0,0,0),this.duration=i||0},n.IMEDelegate=n._Class.extend({ctor:function(){n.imeDispatcher.addDelegate(this)},removeDelegate:function(){n.imeDispatcher.removeDelegate(this)},attachWithIME:function(){return n.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return n.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return!1},didAttachWithIME:function(){},canDetachWithIME:function(){return!1},didDetachWithIME:function(){},insertText:function(t,e){},deleteBackward:function(){},getContentText:function(){return""},keyboardWillShow:function(t){},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){}}),n.IMEDispatcher=n._Class.extend({_domInputControl:null,impl:null,_currentInputString:"",_lastClickPosition:null,ctor:function(){this.impl=new n.IMEDispatcher.Impl,this._lastClickPosition=n.p(0,0)},init:function(){if(!n.sys.isMobile){this._domInputControl=n.$("#imeDispatcherInput"),this._domInputControl||(this._domInputControl=n.$new("input"),this._domInputControl.setAttribute("type","text"),this._domInputControl.setAttribute("id","imeDispatcherInput"),this._domInputControl.resize(0,0),this._domInputControl.translates(0,0),this._domInputControl.style.opacity="0",this._domInputControl.style.fontSize="1px",this._domInputControl.setAttribute("tabindex",2),this._domInputControl.style.position="absolute",this._domInputControl.style.top=0,this._domInputControl.style.left=0,document.body.appendChild(this._domInputControl));var t=this;this._domInputControl.addEventListener("input",function(){t._processDomInputString(t._domInputControl.value)},!1),this._domInputControl.addEventListener("keydown",function(e){e.keyCode===n.KEY.tab?(e.stopPropagation(),e.preventDefault()):e.keyCode===n.KEY.enter&&(t.dispatchInsertText("\n",1),e.stopPropagation(),e.preventDefault())},!1),/msie/i.test(navigator.userAgent)&&this._domInputControl.addEventListener("keyup",function(e){e.keyCode===n.KEY.backspace&&t._processDomInputString(t._domInputControl.value)},!1),window.addEventListener("mousedown",function(e){var i=e.pageX||0,n=e.pageY||0;t._lastClickPosition.x=i,t._lastClickPosition.y=n},!1)}},_processDomInputString:function(t){var e,i,n=this._currentInputString.length<t.length?this._currentInputString.length:t.length;for(i=0;n>i&&t[i]===this._currentInputString[i];i++);var r=this._currentInputString.length-i,s=t.length-i;for(e=0;r>e;e++)this.dispatchDeleteBackward();for(e=0;s>e;e++)this.dispatchInsertText(t[i+e],1);this._currentInputString=t},dispatchInsertText:function(t,e){!this.impl||!t||0>=e||this.impl._delegateWithIme&&this.impl._delegateWithIme.insertText(t,e)},dispatchDeleteBackward:function(){this.impl&&this.impl._delegateWithIme&&this.impl._delegateWithIme.deleteBackward()},getContentText:function(){if(this.impl&&this.impl._delegateWithIme){var t=this.impl._delegateWithIme.getContentText();return t?t:""}return""},dispatchKeyboardWillShow:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardWillShow(t)}},dispatchKeyboardDidShow:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardDidShow(t)}},dispatchKeyboardWillHide:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardWillHide(t)}},dispatchKeyboardDidHide:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardDidHide(t)}},addDelegate:function(t){t&&this.impl&&(this.impl._delegateList.indexOf(t)>-1||this.impl._delegateList.splice(0,0,t))},attachDelegateWithIME:function(t){if(!this.impl||!t)return!1;if(-1===this.impl._delegateList.indexOf(t))return!1;if(this.impl._delegateWithIme){if(!this.impl._delegateWithIme.canDetachWithIME()||!t.canAttachWithIME())return!1;var e=this.impl._delegateWithIme;return this.impl._delegateWithIme=null,e.didDetachWithIME(),this._focusDomInput(t),!0}return t.canAttachWithIME()?(this._focusDomInput(t),!0):!1},_focusDomInput:function(t){if(n.sys.isMobile){this.impl._delegateWithIme=t,t.didAttachWithIME(),this._currentInputString=t.string||"";var e,i=t.getTipMessage?t.getTipMessage():"please enter your word:";e=window.Window&&Window.prototype.prompt!=prompt?Window.prototype.prompt.call(window,i,this._currentInputString):prompt(i,this._currentInputString),null!=e&&this._processDomInputString(e),this.dispatchInsertText("\n",1)}else this.impl._delegateWithIme=t,this._currentInputString=t.string||"",t.didAttachWithIME(),this._domInputControl.focus(),this._domInputControl.value=this._currentInputString,this._domInputControlTranslate()},_domInputControlTranslate:function(){/msie/i.test(navigator.userAgent)?(this._domInputControl.style.left=this._lastClickPosition.x+"px",this._domInputControl.style.top=this._lastClickPosition.y+"px"):this._domInputControl.translates(this._lastClickPosition.x,this._lastClickPosition.y)},detachDelegateWithIME:function(t){return this.impl&&t?this.impl._delegateWithIme!==t?!1:t.canDetachWithIME()?(this.impl._delegateWithIme=null,t.didDetachWithIME(),n._canvas.focus(),!0):!1:!1},removeDelegate:function(t){this.impl&&t&&-1!==this.impl._delegateList.indexOf(t)&&(this.impl._delegateWithIme&&t===this.impl._delegateWithIme&&(this.impl._delegateWithIme=null),n.js.array.remove(this.impl._delegateList,t))},processKeycode:function(t){32>t?t===n.KEY.backspace?this.dispatchDeleteBackward():t===n.KEY.enter?this.dispatchInsertText("\n",1):t===n.KEY.tab||t===n.KEY.escape:255>t&&this.dispatchInsertText(String.fromCharCode(t),1)}}),n.IMEDispatcher.Impl=n._Class.extend({_delegateWithIme:null,_delegateList:null,ctor:function(){this._delegateList=[]},findDelegate:function(t){for(var e=0;e<this._delegateList.length;e++)if(this._delegateList[e]===t)return e;return null}}),n.imeDispatcher=new n.IMEDispatcher,document.body?n.imeDispatcher.init():window.addEventListener("load",function(){n.imeDispatcher.init()},!1),n.TextFieldDelegate=n._Class.extend({onTextFieldAttachWithIME:function(t){return!1},onTextFieldDetachWithIME:function(t){return!1},onTextFieldInsertText:function(t,e,i){return!1},onTextFieldDeleteBackward:function(t,e,i){return!1},onDraw:function(t){return!1}}),n.TextFieldTTF=n.LabelTTF.extend({delegate:null,colorSpaceHolder:null,_colorText:null,_lens:null,_inputText:"",_placeHolder:"",_charCount:0,_className:"TextFieldTTF",ctor:function(t,e,i,r,s){this.colorSpaceHolder=n.color(127,127,127),this._colorText=n.color(255,255,255,255),n.LabelTTF.prototype.ctor.call(this),void 0!==s?(this.initWithPlaceHolder("",e,i,r,s),t&&this.setPlaceHolder(t)):void 0===r&&void 0!==i&&(this.initWithString("",arguments[1],arguments[2]),t&&this.setPlaceHolder(t))},onEnter:function(){n.LabelTTF.prototype.onEnter.call(this),n.imeDispatcher.addDelegate(this)},onExit:function(){n.LabelTTF.prototype.onExit.call(this),n.imeDispatcher.removeDelegate(this)},getDelegate:function(){return this.delegate},setDelegate:function(t){this.delegate=t},getCharCount:function(){return this._charCount},getColorSpaceHolder:function(){return n.color(this.colorSpaceHolder)},setColorSpaceHolder:function(t){this.colorSpaceHolder.r=t.r,this.colorSpaceHolder.g=t.g,this.colorSpaceHolder.b=t.b,this.colorSpaceHolder.a=n.js.isUndefined(t.a)?255:t.a,this._inputText.length||this.setColor(this.colorSpaceHolder)},setTextColor:function(t){this._colorText.r=t.r,this._colorText.g=t.g,this._colorText.b=t.b,this._colorText.a=n.js.isUndefined(t.a)?255:t.a,this._inputText.length&&this.setColor(this._colorText)},initWithPlaceHolder:function(t,e,i,n,r){switch(arguments.length){case 5:return t&&this.setPlaceHolder(t),this.initWithString(this._placeHolder,n,r,e,i);case 3:return t&&this.setPlaceHolder(t),this.initWithString(this._placeHolder,arguments[1],arguments[2]);default:throw new Error("Argument must be non-nil ")}},setString:function(t){t=String(t),this._inputText=t||"",this._inputText.length?(n.LabelTTF.prototype.setString.call(this,this._inputText),this.setColor(this._colorText)):(n.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder)),n._renderType===n.game.RENDER_TYPE_CANVAS&&this._renderCmd._updateTexture(),this._charCount=this._inputText.length},getString:function(){return this._inputText},setPlaceHolder:function(t){this._placeHolder=t||"",this._inputText.length||(n.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder))},getPlaceHolder:function(){return this._placeHolder},draw:function(t){var e=t||n._renderContext;this.delegate&&this.delegate.onDraw(this)||n.LabelTTF.prototype.draw.call(this,e)},visit:function(t){this._super(t)},attachWithIME:function(){return n.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return n.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return this.delegate?!this.delegate.onTextFieldAttachWithIME(this):!0},didAttachWithIME:function(){},canDetachWithIME:function(){return this.delegate?!this.delegate.onTextFieldDetachWithIME(this):!0},didDetachWithIME:function(){},deleteBackward:function(){var t=this._inputText.length;if(0!==t){var e=1;if(!this.delegate||!this.delegate.onTextFieldDeleteBackward(this,this._inputText[t-e],e))return e>=t?(this._inputText="",this._charCount=0,n.LabelTTF.prototype.setString.call(this,this._placeHolder),void this.setColor(this.colorSpaceHolder)):void(this.string=this._inputText.substring(0,t-e))}},removeDelegate:function(){n.imeDispatcher.removeDelegate(this)},_tipMessage:"please enter your word:",setTipMessage:function(t){null!=t&&(this._tipMessage=t)},getTipMessage:function(){return this._tipMessage},insertText:function(t,e){var i=t,n=i.indexOf("\n");if(n>-1&&(i=i.substring(0,n)),i.length>0){if(this.delegate&&this.delegate.onTextFieldInsertText(this,i,i.length))return;var r=this._inputText+i;this._charCount=r.length,this.string=r}-1!==n&&(this.delegate&&this.delegate.onTextFieldInsertText(this,"\n",1)||this.detachWithIME())},getContentText:function(){return this._inputText},keyboardWillShow:function(t){},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){}});var c=n.TextFieldTTF.prototype;c.charCount,n.defineGetterSetter(c,"charCount",c.getCharCount),c.placeHolder,n.defineGetterSetter(c,"placeHolder",c.getPlaceHolder,c.setPlaceHolder),n.TextFieldTTF.create=function(t,e,i,r,s){return new n.TextFieldTTF(t,e,i,r,s)},n._globalFontSize=n.ITEM_SIZE,n._globalFontName="Arial",n._globalFontNameRelease=!1,n.MenuItem=_ccsg.Node.extend({_enabled:!1,_target:null,_callback:null,_isSelected:!1,_className:"MenuItem",ctor:function(t,e){var i=_ccsg.Node.prototype;i.ctor.call(this),this._target=null,this._callback=null,this._isSelected=!1,this._enabled=!1,i.setAnchorPoint.call(this,.5,.5),this._target=e||null,this._callback=t||null,this._callback&&(this._enabled=!0)},isSelected:function(){return this._isSelected},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},setTarget:function(t,e){this._target=e,this._callback=t},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t},initWithCallback:function(t,e){return this.anchorX=.5,this.anchorY=.5,this._target=e,this._callback=t,this._enabled=!0,this._isSelected=!1,!0},rect:function(){var t=this._position,e=this._contentSize,i=this._anchorPoint;return n.rect(t.x-e.width*i.x,t.y-e.height*i.y,e.width,e.height)},selected:function(){this._isSelected=!0},unselected:function(){this._isSelected=!1},setCallback:function(t,e){this._target=e,this._callback=t},activate:function(){if(this._enabled){var t=this._target,e=this._callback;if(!e)return;t&&n.js.isString(e)?t[e](this):t&&n.js.isFunction(e)?e.call(t,this):e(this)}}});var c=n.MenuItem.prototype;c.enabled,n.defineGetterSetter(c,"enabled",c.isEnabled,c.setEnabled),n.MenuItem.create=function(t,e){return new n.MenuItem(t,e)},n.MenuItemLabel=n.MenuItem.extend({_disabledColor:null,_label:null,_originalScale:0,_colorBackup:null,ctor:function(t,e,i){n.MenuItem.prototype.ctor.call(this,e,i),this._disabledColor=null,this._label=null,this._colorBackup=null,t&&(this._originalScale=1,this._colorBackup=n.Color.WHITE,this._disabledColor=n.color(126,126,126),this.setLabel(t),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0))},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(t){this._disabledColor=t},getLabel:function(){return this._label},setLabel:function(t){t&&(this.addChild(t),t.anchorX=0,t.anchorY=0,this.width=t.width,this.height=t.height,t.setCascadeColorEnabled(!0)),this._label&&this.removeChild(this._label,!0),this._label=t},setEnabled:function(t){this._enabled!==t&&(t?this.setColor(this._colorBackup):(this._colorBackup=this.color,this.setColor(this._disabledColor))),n.MenuItem.prototype.setEnabled.call(this,t)},initWithLabel:function(t,e,i){return this.initWithCallback(e,i),this._originalScale=1,this._colorBackup=n.Color.WHITE,this._disabledColor=n.color(126,126,126),this.setLabel(t),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},setString:function(t){this._label.string=t,this.width=this._label.width,this.height=this._label.height},getString:function(){return this._label.string},activate:function(){this._enabled&&(this.stopAllActions(),this.scale=this._originalScale,n.MenuItem.prototype.activate.call(this))},selected:function(){if(this._enabled){n.MenuItem.prototype.selected.call(this);var t=this.getActionByTag(n.ZOOM_ACTION_TAG);t?this.stopAction(t):this._originalScale=this.scale;var e=n.scaleTo(.1,1.2*this._originalScale);e.setTag(n.ZOOM_ACTION_TAG),this.runAction(e)}},unselected:function(){if(this._enabled){n.MenuItem.prototype.unselected.call(this),this.stopActionByTag(n.ZOOM_ACTION_TAG);var t=n.scaleTo(.1,this._originalScale);t.setTag(n.ZOOM_ACTION_TAG),this.runAction(t)}}});var c=n.MenuItemLabel.prototype;c.string,n.defineGetterSetter(c,"string",c.getString,c.setString),c.disabledColor,n.defineGetterSetter(c,"disabledColor",c.getDisabledColor,c.setDisabledColor),c.label,n.defineGetterSetter(c,"label",c.getLabel,c.setLabel),n.MenuItemLabel.create=function(t,e,i){return new n.MenuItemLabel(t,e,i)},n.MenuItemAtlasFont=n.MenuItemLabel.extend({ctor:function(t,e,i,r,s,o,a){var c;t&&t.length>0&&(c=new n.LabelAtlas(t,e,i,r,s)),n.MenuItemLabel.prototype.ctor.call(this,c,o,a)},initWithString:function(t,e,i,r,s,o,a){if(!t||0===t.length)throw new Error("cc.MenuItemAtlasFont.initWithString(): value should be non-null and its length should be greater than 0");var c=new n.LabelAtlas;return c.initWithString(t,e,i,r,s),this.initWithLabel(c,o,a),!0}}),n.MenuItemAtlasFont.create=function(t,e,i,r,s,o,a){return new n.MenuItemAtlasFont(t,e,i,r,s,o,a)},n.MenuItemFont=n.MenuItemLabel.extend({_fontSize:null,_fontName:null,ctor:function(t,e,i){var r;t&&t.length>0?(this._fontName=n._globalFontName,this._fontSize=n._globalFontSize,r=new n.LabelTTF(t,this._fontName,this._fontSize)):(this._fontSize=0,this._fontName=""),n.MenuItemLabel.prototype.ctor.call(this,r,e,i)},initWithString:function(t,e,i){if(!t||0===t.length)throw new Error("Value should be non-null and its length should be greater than 0");this._fontName=n._globalFontName,this._fontSize=n._globalFontSize;var r=new n.LabelTTF(t,this._fontName,this._fontSize);return this.initWithLabel(r,e,i),!0},setFontSize:function(t){this._fontSize=t,this._recreateLabel()},getFontSize:function(){return this._fontSize},setFontName:function(t){this._fontName=t,this._recreateLabel()},getFontName:function(){return this._fontName},_recreateLabel:function(){var t=new n.LabelTTF(this._label.string,this._fontName,this._fontSize);this.setLabel(t)}}),n.MenuItemFont.setFontSize=function(t){n._globalFontSize=t},n.MenuItemFont.fontSize=function(){return n._globalFontSize},n.MenuItemFont.setFontName=function(t){n._globalFontNameRelease&&(n._globalFontName=""),n._globalFontName=t,n._globalFontNameRelease=!0};var c=n.MenuItemFont.prototype;c.fontSize,n.defineGetterSetter(c,"fontSize",c.getFontSize,c.setFontSize),c.fontName,n.defineGetterSetter(c,"fontName",c.getFontName,c.setFontName),n.MenuItemFont.fontName=function(){return n._globalFontName},n.MenuItemFont.create=function(t,e,i){return new n.MenuItemFont(t,e,i)},n.MenuItemSprite=n.MenuItem.extend({_normalImage:null,_selectedImage:null,_disabledImage:null,ctor:function(t,e,i,r,s){if(n.MenuItem.prototype.ctor.call(this),this._normalImage=null,this._selectedImage=null,this._disabledImage=null,void 0!==e){var o,a,c;void 0!==s?(o=i,c=r,a=s):void 0!==r&&n.js.isFunction(r)?(o=i,c=r):void 0!==r&&n.js.isFunction(i)?(a=r,c=i,o=null):void 0===i&&(o=null),this.initWithNormalSprite(t,e,o,c,a)}},getNormalImage:function(){return this._normalImage},setNormalImage:function(t){this._normalImage!==t&&(t&&(this.addChild(t,0,n.NORMAL_TAG),t.anchorX=0,t.anchorY=0),this._normalImage&&this.removeChild(this._normalImage,!0),this._normalImage=t,this._normalImage&&(this.width=this._normalImage.width,this.height=this._normalImage.height,this._updateImagesVisibility(),t.textureLoaded&&!t.textureLoaded()&&t.once("load",function(e){this.width=t.width,this.height=t.height},this)))},getSelectedImage:function(){return this._selectedImage},setSelectedImage:function(t){this._selectedImage!==t&&(t&&(this.addChild(t,0,n.SELECTED_TAG),t.anchorX=0,t.anchorY=0),this._selectedImage&&this.removeChild(this._selectedImage,!0),this._selectedImage=t,this._updateImagesVisibility())},getDisabledImage:function(){return this._disabledImage},setDisabledImage:function(t){this._disabledImage!==t&&(t&&(this.addChild(t,0,n.DISABLE_TAG),t.anchorX=0,t.anchorY=0),this._disabledImage&&this.removeChild(this._disabledImage,!0),this._disabledImage=t,this._updateImagesVisibility())},initWithNormalSprite:function(t,e,i,n,r){this.initWithCallback(n,r),this.setNormalImage(t),this.setSelectedImage(e),this.setDisabledImage(i);var s=this._normalImage;return s&&(this.width=s.width,this.height=s.height,s.textureLoaded&&!s.textureLoaded()&&s.once("load",function(t){this.width=s.width,this.height=s.height,this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0)},this)),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},selected:function(){n.MenuItem.prototype.selected.call(this),this._normalImage&&(this._disabledImage&&(this._disabledImage.visible=!1),this._selectedImage?(this._normalImage.visible=!1,this._selectedImage.visible=!0):this._normalImage.visible=!0)},unselected:function(){n.MenuItem.prototype.unselected.call(this),this._normalImage&&(this._normalImage.visible=!0,this._selectedImage&&(this._selectedImage.visible=!1),this._disabledImage&&(this._disabledImage.visible=!1))},setEnabled:function(t){this._enabled!==t&&(n.MenuItem.prototype.setEnabled.call(this,t),this._updateImagesVisibility())},_updateImagesVisibility:function(){var t=this._normalImage,e=this._selectedImage,i=this._disabledImage;this._enabled?(t&&(t.visible=!0),e&&(e.visible=!1),i&&(i.visible=!1)):i?(t&&(t.visible=!1),e&&(e.visible=!1),i&&(i.visible=!0)):(t&&(t.visible=!0),e&&(e.visible=!1))}});var c=n.MenuItemSprite.prototype;c.normalImage,n.defineGetterSetter(c,"normalImage",c.getNormalImage,c.setNormalImage),c.selectedImage,n.defineGetterSetter(c,"selectedImage",c.getSelectedImage,c.setSelectedImage),c.disabledImage,n.defineGetterSetter(c,"disabledImage",c.getDisabledImage,c.setDisabledImage),n.MenuItemSprite.create=function(t,e,i,r,s){return new n.MenuItemSprite(t,e,i,r,s||void 0)},n.MenuItemImage=n.MenuItemSprite.extend({ctor:function(t,e,i,r,s){var o=null,a=null,c=null,h=null,l=null;void 0===t||null===t?n.MenuItemSprite.prototype.ctor.call(this):(o=new n.Sprite(t),e&&(a=new n.Sprite(e)),void 0===r?h=i:void 0===s?(h=i,l=r):s&&(c=new n.Sprite(i),h=r,l=s),n.MenuItemSprite.prototype.ctor.call(this,o,a,c,h,l))},setNormalSpriteFrame:function(t){this.setNormalImage(new n.Sprite(t))},setSelectedSpriteFrame:function(t){this.setSelectedImage(new n.Sprite(t))},setDisabledSpriteFrame:function(t){this.setDisabledImage(new n.Sprite(t))},initWithNormalImage:function(t,e,i,r,s){var o=null,a=null,c=null;return t&&(o=new n.Sprite(t)),e&&(a=new n.Sprite(e)),i&&(c=new n.Sprite(i)),this.initWithNormalSprite(o,a,c,r,s)}}),n.MenuItemImage.create=function(t,e,i,r,s){return new n.MenuItemImage(t,e,i,r,s)},n.MenuItemToggle=n.MenuItem.extend({subItems:null,_selectedIndex:0,_opacity:null,_color:null,ctor:function(){n.MenuItem.prototype.ctor.call(this),this._selectedIndex=0,this.subItems=[],this._opacity=0,this._color=n.Color.WHITE,arguments.length>0&&this.initWithItems(Array.prototype.slice.apply(arguments))},getOpacity:function(){return this._opacity},setOpacity:function(t){if(this._opacity=t,this.subItems&&this.subItems.length>0)for(var e=0;e<this.subItems.length;e++)this.subItems[e].opacity=t;this._color.a=t},getColor:function(){var t=this._color;return n.color(t.r,t.g,t.b,t.a)},setColor:function(t){var e=this._color;if(e.r=t.r,e.g=t.g,e.b=t.b,this.subItems&&this.subItems.length>0)for(var i=0;i<this.subItems.length;i++)this.subItems[i].setColor(t);

void 0===t.a||t.a_undefined||this.setOpacity(t.a)},getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(t){if(t!==this._selectedIndex){this._selectedIndex=t;var e=this.getChildByTag(n.CURRENT_ITEM);e&&e.removeFromParent(!1);var i=this.subItems[this._selectedIndex];this.addChild(i,0,n.CURRENT_ITEM);var r=i.width,s=i.height;this.width=r,this.height=s,i.setPosition(r/2,s/2)}},getSubItems:function(){return this.subItems},setSubItems:function(t){this.subItems=t},initWithItems:function(t){var e=t.length;n.js.isFunction(t[t.length-2])?(this.initWithCallback(t[t.length-2],t[t.length-1]),e-=2):n.js.isFunction(t[t.length-1])?(this.initWithCallback(t[t.length-1],null),e-=1):this.initWithCallback(null,null);var i=this.subItems;i.length=0;for(var r=0;e>r;r++)t[r]&&i.push(t[r]);return this._selectedIndex=n.UINT_MAX,this.setSelectedIndex(0),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},addSubItem:function(t){this.subItems.push(t)},activate:function(){if(this._enabled){var t=(this._selectedIndex+1)%this.subItems.length;this.setSelectedIndex(t)}n.MenuItem.prototype.activate.call(this)},selected:function(){n.MenuItem.prototype.selected.call(this),this.subItems[this._selectedIndex].selected()},unselected:function(){n.MenuItem.prototype.unselected.call(this),this.subItems[this._selectedIndex].unselected()},setEnabled:function(t){if(this._enabled!==t){n.MenuItem.prototype.setEnabled.call(this,t);var e=this.subItems;if(e&&e.length>0)for(var i=0;i<e.length;i++)e[i].enabled=t}},selectedItem:function(){return this.subItems[this._selectedIndex]},getSelectedItem:function(){return this.subItems[this._selectedIndex]},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this),this.setSelectedIndex(this._selectedIndex)}});var c=n.MenuItemToggle.prototype;c.selectedIndex,n.defineGetterSetter(c,"selectedIndex",c.getSelectedIndex,c.setSelectedIndex),n.MenuItemToggle.create=function(){arguments.length>0&&null==arguments[arguments.length-1]&&n.log("parameters should not be ending with null in Javascript");var t=new n.MenuItemToggle;return t.initWithItems(Array.prototype.slice.apply(arguments)),t},n.MENU_STATE_WAITING=0,n.MENU_STATE_TRACKING_TOUCH=1,n.MENU_HANDLER_PRIORITY=-128,n.DEFAULT_PADDING=5,n.Menu=n.Layer.extend({enabled:!1,_selectedItem:null,_state:-1,_touchListener:null,_className:"Menu",ctor:function(t){n.Layer.prototype.ctor.call(this),this._color=n.Color.WHITE,this.enabled=!1,this._opacity=255,this._selectedItem=null,this._state=-1,this._touchListener=n.EventListener.create({event:n.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan,onTouchMoved:this._onTouchMoved,onTouchEnded:this._onTouchEnded,onTouchCancelled:this._onTouchCancelled}),arguments.length>0&&null==arguments[arguments.length-1]&&n.log("parameters should not be ending with null in Javascript");var e,i=arguments.length;if(0===i)e=[];else if(1===i)e=t instanceof Array?t:[t];else if(i>1){e=[];for(var r=0;i>r;r++)arguments[r]&&e.push(arguments[r])}this.initWithArray(e)},onEnter:function(){var t=this._touchListener;t._isRegistered()||n.eventManager.addListener(t,this),_ccsg.Node.prototype.onEnter.call(this)},isEnabled:function(){return this.enabled},setEnabled:function(t){this.enabled=t},initWithItems:function(t){var e=[];if(t)for(var i=0;i<t.length;i++)t[i]&&e.push(t[i]);return this.initWithArray(e)},initWithArray:function(t){if(n.Layer.prototype.init.call(this)){this.enabled=!0;var e=n.winSize;if(this.setPosition(e.width/2,e.height/2),this.setContentSize(e),this.setAnchorPoint(.5,.5),this.ignoreAnchorPointForPosition(!0),t)for(var i=0;i<t.length;i++)this.addChild(t[i],i);return this._selectedItem=null,this._state=n.MENU_STATE_WAITING,this.cascadeColor=!0,this.cascadeOpacity=!0,!0}return!1},addChild:function(t,e,i){if(!(t instanceof n.MenuItem))throw new Error("cc.Menu.addChild() : Menu only supports MenuItem objects as children");n.Layer.prototype.addChild.call(this,t,e,i)},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(n.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(t){var e,i,n,r,s,o=-t,a=this._children;if(a&&a.length>0){for(i=0,e=a.length;e>i;i++)o+=a[i].height*a[i].scaleY+t;var c=o/2;for(i=0,e=a.length;e>i;i++)s=a[i],r=s.height,n=s.scaleY,s.setPosition(0,c-r*n/2),c-=r*n+t}},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(n.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(t){var e,i,n,r,s,o=-t,a=this._children;if(a&&a.length>0){for(e=0,i=a.length;i>e;e++)o+=a[e].width*a[e].scaleX+t;var c=-o/2;for(e=0,i=a.length;i>e;e++)s=a[e],n=s.scaleX,r=a[e].width,s.setPosition(c+r*n/2,0),c+=r*n+t}},alignItemsInColumns:function(){arguments.length>0&&null==arguments[arguments.length-1]&&n.log("parameters should not be ending with null in Javascript");for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var i,r,s,o=-5,a=0,c=0,h=0,l=this._children;if(l&&l.length>0)for(e=0,s=l.length;s>e;e++)a>=t.length||(i=t[a],i&&(r=l[e].height,c=c>=r||isNaN(r)?c:r,++h,h>=i&&(o+=c+5,h=0,c=0,++a)));var d=n.director.getWinSize();a=0,c=0,i=0;var u=0,_=0,f=o/2;if(l&&l.length>0)for(e=0,s=l.length;s>e;e++){var p=l[e];0===i&&(i=t[a],u=d.width/(1+i),_=u),r=p._getHeight(),c=c>=r||isNaN(r)?c:r,p.setPosition(_-d.width/2,f-r/2),_+=u,++h,h>=i&&(f-=c+5,h=0,i=0,c=0,++a)}},alignItemsInRows:function(){arguments.length>0&&null==arguments[arguments.length-1]&&n.log("parameters should not be ending with null in Javascript");var t,e=[];for(t=0;t<arguments.length;t++)e.push(arguments[t]);var i,r,s,o,a=[],c=[],h=-10,l=-5,d=0,u=0,_=0,f=this._children;if(f&&f.length>0)for(t=0,s=f.length;s>t;t++)r=f[t],d>=e.length||(i=e[d],i&&(o=r.width,u=u>=o||isNaN(o)?u:o,l+=r.height+5,++_,_>=i&&(a.push(u),c.push(l),h+=u+10,_=0,u=0,l=-5,++d)));var p=n.director.getWinSize();d=0,u=0,i=0;var g=-h/2,m=0;if(f&&f.length>0)for(t=0,s=f.length;s>t;t++)r=f[t],0===i&&(i=e[d],m=c[d]),o=r._getWidth(),u=u>=o||isNaN(o)?u:o,r.setPosition(g+a[d]/2,m-p.height/2),m-=r.height+10,++_,_>=i&&(g+=u+5,_=0,i=0,u=0,++d)},removeChild:function(t,e){if(null!=t){if(!(t instanceof n.MenuItem))return void n.log("cc.Menu.removeChild():Menu only supports MenuItem objects as children");this._selectedItem===t&&(this._selectedItem=null),_ccsg.Node.prototype.removeChild.call(this,t,e)}},_onTouchBegan:function(t,e){var i=e.getCurrentTarget();if(i._state!==n.MENU_STATE_WAITING||!i._visible||!i.enabled)return!1;for(var r=i.parent;null!=r;r=r.parent)if(!r.isVisible())return!1;return i._selectedItem=i._itemForTouch(t),i._selectedItem?(i._state=n.MENU_STATE_TRACKING_TOUCH,i._selectedItem.selected(),i._selectedItem.setNodeDirty(),!0):!1},_onTouchEnded:function(t,e){var i=e.getCurrentTarget();return i._state!==n.MENU_STATE_TRACKING_TOUCH?void n.log("cc.Menu.onTouchEnded(): invalid state"):(i._selectedItem&&(i._selectedItem.unselected(),i._selectedItem.setNodeDirty(),i._selectedItem.activate()),void(i._state=n.MENU_STATE_WAITING))},_onTouchCancelled:function(t,e){var i=e.getCurrentTarget();return i._state!==n.MENU_STATE_TRACKING_TOUCH?void n.log("cc.Menu.onTouchCancelled(): invalid state"):(i._selectedItem&&(i._selectedItem.unselected(),i._selectedItem.setNodeDirty()),void(i._state=n.MENU_STATE_WAITING))},_onTouchMoved:function(t,e){var i=e.getCurrentTarget();if(i._state!==n.MENU_STATE_TRACKING_TOUCH)return void n.log("cc.Menu.onTouchMoved(): invalid state");var r=i._itemForTouch(t);r!==i._selectedItem&&(i._selectedItem&&(i._selectedItem.unselected(),i._selectedItem.setNodeDirty()),i._selectedItem=r,i._selectedItem&&(i._selectedItem.selected(),i._selectedItem.setNodeDirty()))},onExit:function(){this._state===n.MENU_STATE_TRACKING_TOUCH&&(this._selectedItem&&(this._selectedItem.unselected(),this._selectedItem=null),this._state=n.MENU_STATE_WAITING),_ccsg.Node.prototype.onExit.call(this)},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_itemForTouch:function(t){var e,i=t.getLocation(),r=this._children;if(r&&r.length>0)for(var s=r.length-1;s>=0;s--)if(e=r[s],e.isVisible()&&e.isEnabled()){var o=e.convertToNodeSpace(i),a=e.rect();if(a.x=0,a.y=0,n.rectContainsPoint(a,o))return e}return null}});var c=n.Menu.prototype;c.enabled,n.Menu.create=function(t){var e=arguments.length;e>0&&null==arguments[e-1]&&n.log("parameters should not be ending with null in Javascript");var i;return i=0===e?new n.Menu:new n.Menu(1===e?t:Array.prototype.slice.call(arguments,0))},n.TGA_OK=0,n.TGA_ERROR_FILE_OPEN=1,n.TGA_ERROR_READING_FILE=2,n.TGA_ERROR_INDEXED_COLOR=3,n.TGA_ERROR_MEMORY=4,n.TGA_ERROR_COMPRESSED_FILE=5,n.ImageTGA=function(t,e,i,n,r,s,o){this.status=t||0,this.type=e||0,this.pixelDepth=i||0,this.width=n||0,this.height=r||0,this.imageData=s||[],this.flipped=o||0},n.tgaLoadHeader=function(t,e,i){var r=2;if(r+1>e)return!1;var s=new n.BinaryStreamReader(t);if(s.setOffset(r),i.type=s.readByte(),r+=10,r+4+1>e)return!1;if(s.setOffset(r),i.width=s.readUnsignedShort(),i.height=s.readUnsignedInteger(),i.pixelDepth=s.readByte(),r+=5,r+1>e)return!1;var o=s.readByte();return i.flipped=0,32&o&&(i.flipped=1),!0},n.tgaLoadImageData=function(t,e,i){var r,s,o,a,c=18;if(r=0|i.pixelDepth/2,s=i.height*i.width*r,c+s>e)return!1;if(i.imageData=n.__getSubArray(t,c,c+s),r>=3)for(o=0;s>o;o+=r)a=i.imageData[o],i.imageData[o]=i.imageData[o+2],i.imageData[o+2]=a;return!0},n.tgaRGBtogreyscale=function(t){var e,i;if(8!==t.pixelDepth){var n=t.pixelDepth/8,r=new Uint8Array(t.height*t.width);if(null!==r){for(e=0,i=0;i<t.width*t.height;e+=n,i++)r[i]=.3*t.imageData[e]+.59*t.imageData[e+1]+.11*t.imageData[e+2];t.pixelDepth=8,t.type=3,t.imageData=r}}},n.tgaDestroy=function(t){t&&(t.imageData=null,t=null)},n.tgaLoadRLEImageData=function(t,e,i){var r,s,o,a=0,c=0,h=0,l=[],d=0,u=18;for(r=i.pixelDepth/8,s=i.height*i.width,o=0;s>o;o++){if(0!==d)d--,c=0!==h;else{if(u+1>e)break;d=t[u],u+=1,h=128&d,h&&(d-=128),c=0}if(!c){if(u+r>e)break;if(l=n.__getSubArray(t,u,u+r),u+=r,r>=3){var _=l[0];l[0]=l[2],l[2]=_}}for(var f=0;r>f;f++)i.imageData[a+f]=l[f];a+=r}return!0},n.tgaFlipImage=function(t){for(var e=t.pixelDepth/8,i=t.width*e,r=0;r<t.height/2;r++){var s=n.__getSubArray(t.imageData,r*i,r*i+i);n.__setDataToArray(n.__getSubArray(t.imageData,(t.height-(r+1))*i,i),t.imageData,r*i),n.__setDataToArray(s,t.imageData,(t.height-(r+1))*i)}t.flipped=0},n.__getSubArray=function(t,e,i){return t instanceof Array?t.slice(e,i):t.subarray(e,i)},n.__setDataToArray=function(t,e,i){for(var n=0;n<t.length;n++)e[i+n]=t[n]},n.BinaryStreamReader=n._Class.extend({_binaryData:null,_offset:0,ctor:function(t){this._binaryData=t},setBinaryData:function(t){this._binaryData=t,this._offset=0},getBinaryData:function(){return this._binaryData},_checkSize:function(t){if(!(this._offset+Math.ceil(t/8)<this._data.length))throw new Error("Index out of bound")},_decodeFloat:function(t,e){var i=t+e+1,n=i>>3;this._checkSize(i);var r=Math.pow(2,e-1)-1,s=this._readBits(t+e,1,n),o=this._readBits(t,e,n),a=0,c=2,h=0;do for(var l=this._readByte(++h,n),d=t%8||8,u=1<<d;u>>=1;)l&u&&(a+=1/c),c*=2;while(t-=d);return this._offset+=n,o===(r<<1)+1?a?0/0:s?-(1/0):+(1/0):(1+-2*s)*(o||a?o?Math.pow(2,o-r)*(1+a):Math.pow(2,-r+1)*a:0)},_readByte:function(t,e){return this._data[this._offset+e-t-1]},_decodeInt:function(t,e){var i=this._readBits(0,t,t/8),n=Math.pow(2,t),r=e&&i>=n/2?i-n:i;return this._offset+=t/8,r},_shl:function(t,e){for(++e;--e;t=1073741824===(1073741824&(t%=2147483648))?2*t:2*(t-1073741824)+2147483647+1);return t},_readBits:function(t,e,i){var n=(t+e)%8,r=t%8,s=i-(t>>3)-1,o=i+(-(t+e)>>3),a=s-o,c=this._readByte(s,i)>>r&(1<<(a?8-r:e))-1;for(a&&n&&(c+=(this._readByte(o++,i)&(1<<n)-1)<<(a--<<3)-r);a;)c+=this._shl(this._readByte(o++,i),(a--<<3)-r);return c},readInteger:function(){return this._decodeInt(32,!0)},readUnsignedInteger:function(){return this._decodeInt(32,!1)},readSingle:function(){return this._decodeFloat(23,8)},readShort:function(){return this._decodeInt(16,!0)},readUnsignedShort:function(){return this._decodeInt(16,!1)},readByte:function(){var t=this._data[this._offset];return this._offset+=1,t},readData:function(t,e){return this._binaryData instanceof Array?this._binaryData.slice(t,e):this._binaryData.subarray(t,e)},setOffset:function(t){this._offset=t},getOffset:function(){return this._offset}}),n.TMX_ORIENTATION_ORTHO=0,n.TMX_ORIENTATION_HEX=1,n.TMX_ORIENTATION_ISO=2,n.TMXTiledMap=_ccsg.Node.extend({properties:null,mapOrientation:null,objectGroups:null,_mapSize:null,_tileSize:null,_tileProperties:null,_className:"TMXTiledMap",ctor:function(t,e){_ccsg.Node.prototype.ctor.call(this),this._mapSize=n.size(0,0),this._tileSize=n.size(0,0),void 0!==e?this.initWithXML(t,e):void 0!==t&&this.initWithTMXFile(t)},getMapSize:function(){return n.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return n.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getMapOrientation:function(){return this.mapOrientation},setMapOrientation:function(t){this.mapOrientation=t},getObjectGroups:function(){return this.objectGroups},setObjectGroups:function(t){this.objectGroups=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){if(!t||0===t.length)throw new Error("cc.TMXTiledMap.initWithTMXFile(): tmxFile should be non-null or non-empty string.");this.width=0,this.height=0;var e=new n.TMXMapInfo(t);if(!e)return!1;var i=e.getTilesets();return i&&0!==i.length||n.log("cc.TMXTiledMap.initWithTMXFile(): Map not found. Please check the filename."),this._buildWithMapInfo(e),!0},initWithXML:function(t,e){this.width=0,this.height=0;var i=new n.TMXMapInfo(t,e),r=i.getTilesets();return r&&0!==r.length||n.log("cc.TMXTiledMap.initWithXML(): Map not found. Please check the filename."),this._buildWithMapInfo(i),!0},_buildWithMapInfo:function(t){this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this.mapOrientation=t.orientation,this.objectGroups=t.getObjectGroups(),this.properties=t.properties,this._tileProperties=t.getTileProperties();var e=0,i=t.getLayers();if(i)for(var n=null,r=0,s=i.length;s>r;r++)if(n=i[r],n&&n.visible){var o=this._parseLayer(n,t);this.addChild(o,e,e),this.width=Math.max(this.width,o.width),this.height=Math.max(this.height,o.height),e++}},allLayers:function(){for(var t=[],e=this._children,i=0,r=e.length;r>i;i++){var s=e[i];s&&s instanceof n.TMXLayer&&t.push(s)}return t},getLayer:function(t){if(!t||0===t.length)throw new Error("cc.TMXTiledMap.getLayer(): layerName should be non-null or non-empty string.");for(var e=this._children,i=0;i<e.length;i++){var n=e[i];if(n&&n.layerName===t)return n}return null},getObjectGroup:function(t){if(!t||0===t.length)throw new Error("cc.TMXTiledMap.getObjectGroup(): groupName should be non-null or non-empty string.");if(this.objectGroups)for(var e=0;e<this.objectGroups.length;e++){var i=this.objectGroups[e];if(i&&i.groupName===t)return i}return null},getProperty:function(t){return this.properties[t.toString()]},propertiesForGID:function(t){return n.log("propertiesForGID is deprecated. Please use getPropertiesForGID instead."),this.getPropertiesForGID[t]},getPropertiesForGID:function(t){return this._tileProperties[t]},_parseLayer:function(t,e){var i=this._tilesetForLayer(t,e),r=new n.TMXLayer(i,t,e);return t.ownTiles=!1,r.setupTiles(),r},_tilesetForLayer:function(t,e){var i=t._layerSize,r=e.getTilesets();if(r)for(var s=r.length-1;s>=0;s--){var o=r[s];if(o)for(var a=0;a<i.height;a++)for(var c=0;c<i.width;c++){var h=c+i.width*a,l=t._tiles[h];if(0!==l&&(l&n.TMX_TILE_FLIPPED_MASK)>>>0>=o.firstGid)return o}}return n.log("cocos2d: Warning: TMX Layer "+t.name+" has no tiles"),null}});var c=n.TMXTiledMap.prototype;c.mapWidth,n.defineGetterSetter(c,"mapWidth",c._getMapWidth,c._setMapWidth),c.mapHeight,n.defineGetterSetter(c,"mapHeight",c._getMapHeight,c._setMapHeight),c.tileWidth,n.defineGetterSetter(c,"tileWidth",c._getTileWidth,c._setTileWidth),c.tileHeight,n.defineGetterSetter(c,"tileHeight",c._getTileHeight,c._setTileHeight),n.TMXTiledMap.create=function(t,e){return new n.TMXTiledMap(t,e)},n.TMX_PROPERTY_NONE=0,n.TMX_PROPERTY_MAP=1,n.TMX_PROPERTY_LAYER=2,n.TMX_PROPERTY_OBJECTGROUP=3,n.TMX_PROPERTY_OBJECT=4,n.TMX_PROPERTY_TILE=5,n.TMX_TILE_HORIZONTAL_FLAG=2147483648,n.TMX_TILE_VERTICAL_FLAG=1073741824,n.TMX_TILE_DIAGONAL_FLAG=536870912,n.TMX_TILE_FLIPPED_ALL=(n.TMX_TILE_HORIZONTAL_FLAG|n.TMX_TILE_VERTICAL_FLAG|n.TMX_TILE_DIAGONAL_FLAG)>>>0,n.TMX_TILE_FLIPPED_MASK=~n.TMX_TILE_FLIPPED_ALL>>>0,n.TMXLayerInfo=n._Class.extend({properties:null,name:"",_layerSize:null,_tiles:null,visible:null,_opacity:null,ownTiles:!0,_minGID:1e5,_maxGID:0,offset:null,ctor:function(){this.properties=[],this.name="",this._layerSize=null,this._tiles=[],this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=n.p(0,0)},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}}),n.TMXTilesetInfo=n._Class.extend({name:"",firstGid:0,_tileSize:null,spacing:0,margin:0,sourceImage:"",imageSize:null,ctor:function(){this._tileSize=n.size(0,0),this.imageSize=n.size(0,0)},rectForGID:function(t){var e=n.rect(0,0,0,0);e.width=this._tileSize.width,e.height=this._tileSize.height,t&=n.TMX_TILE_FLIPPED_MASK,t-=parseInt(this.firstGid,10);var i=parseInt((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing),10);return e.x=parseInt(t%i*(this._tileSize.width+this.spacing)+this.margin,10),e.y=parseInt(parseInt(t/i,10)*(this._tileSize.height+this.spacing)+this.margin,10),e}}),n.TMXMapInfo=n.SAXParser.extend({properties:null,orientation:null,parentElement:null,parentGID:null,layerAttrs:0,storingCharacters:!1,tmxFileName:null,currentString:null,_objectGroups:null,_mapSize:null,_tileSize:null,_layers:null,_tilesets:null,_tileProperties:null,_resources:"",_currentFirstGID:0,ctor:function(t,e){n.SAXParser.prototype.ctor.apply(this),this._mapSize=n.size(0,0),this._tileSize=n.size(0,0),this._layers=[],this._tilesets=[],this._objectGroups=[],this.properties=[],this._tileProperties={},this._currentFirstGID=0,void 0!==e?this.initWithXML(t,e):void 0!==t&&this.initWithTMXFile(t)},getOrientation:function(){return this.orientation},setOrientation:function(t){this.orientation=t},getMapSize:function(){return n.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return n.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getLayers:function(){return this._layers},setLayers:function(t){this._layers.push(t)},getTilesets:function(){return this._tilesets},setTilesets:function(t){this._tilesets.push(t)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(t){this._objectGroups.push(t)},getParentElement:function(){return this.parentElement},setParentElement:function(t){this.parentElement=t},getParentGID:function(){return this.parentGID},setParentGID:function(t){this.parentGID=t},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(t){this.layerAttrs=t},getStoringCharacters:function(){return this.storingCharacters},setStoringCharacters:function(t){this.storingCharacters=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){return this._internalInit(t,null),this.parseXMLFile(t)},initWithXML:function(t,e){return this._internalInit(null,e),this.parseXMLString(t)},parseXMLFile:function(t,e){e=e||!1;var i=e?t:n.loader.getRes(t);if(!i)throw new Error("Please load the resource first : "+t);var r,s,o=this._parseXML(i),a=o.documentElement,c=a.getAttribute("version"),h=a.getAttribute("orientation");if("map"===a.nodeName){"1.0"!==c&&null!==c&&n.log("cocos2d: TMXFormat: Unsupported TMX version:"+c),"orthogonal"===h?this.orientation=n.TMX_ORIENTATION_ORTHO:"isometric"===h?this.orientation=n.TMX_ORIENTATION_ISO:"hexagonal"===h?this.orientation=n.TMX_ORIENTATION_HEX:null!==h&&n.log("cocos2d: TMXFomat: Unsupported orientation:"+h);var l=n.size(0,0);l.width=parseFloat(a.getAttribute("width")),l.height=parseFloat(a.getAttribute("height")),this.setMapSize(l),l=n.size(0,0),l.width=parseFloat(a.getAttribute("tilewidth")),l.height=parseFloat(a.getAttribute("tileheight")),this.setTileSize(l);var d=a.querySelectorAll("map > properties >  property");if(d){var u={};for(r=0;r<d.length;r++)u[d[r].getAttribute("name")]=d[r].getAttribute("value");this.properties=u}}var _=a.getElementsByTagName("tileset");for("map"!==a.nodeName&&(_=[],_.push(a)),r=0;r<_.length;r++){var f=_[r],p=f.getAttribute("source");if(p){var g=e?n.path.join(this._resources,p):n.path.changeBasename(t,p);this.parseXMLFile(g)}else{var m=new n.TMXTilesetInfo;m.name=f.getAttribute("name")||"",m.firstGid=parseInt(f.getAttribute("firstgid"))||0,m.spacing=parseInt(f.getAttribute("spacing"))||0,m.margin=parseInt(f.getAttribute("margin"))||0;var y=n.size(0,0);y.width=parseFloat(f.getAttribute("tilewidth")),y.height=parseFloat(f.getAttribute("tileheight")),m._tileSize=y;var v=f.getElementsByTagName("image")[0],T=v.getAttribute("source"),C=-1;if(this.tmxFileName&&(C=this.tmxFileName.lastIndexOf("/")),-1!==C){var S=this.tmxFileName.substr(0,C+1);m.sourceImage=S+T}else m.sourceImage=this._resources+(this._resources?"/":"")+T;this.setTilesets(m);var E=f.getElementsByTagName("tile");if(E)for(var b=0;b<E.length;b++){var x=E[b];this.parentGID=parseInt(m.firstGid)+parseInt(x.getAttribute("id")||0);var A=x.querySelectorAll("properties > property");if(A){var R={};for(s=0;s<A.length;s++){var I=A[s].getAttribute("name");R[I]=A[s].getAttribute("value")}this._tileProperties[this.parentGID]=R}}}}var P=a.getElementsByTagName("layer");if(P)for(r=0;r<P.length;r++){var L=P[r],w=L.getElementsByTagName("data")[0],O=new n.TMXLayerInfo;O.name=L.getAttribute("name");var F=n.size(0,0);F.width=parseFloat(L.getAttribute("width")),F.height=parseFloat(L.getAttribute("height")),O._layerSize=F;var N=L.getAttribute("visible");O.visible=!("0"==N);var D=L.getAttribute("opacity")||1;O._opacity=D?parseInt(255*parseFloat(D)):255,O.offset=n.p(parseFloat(L.getAttribute("x"))||0,parseFloat(L.getAttribute("y"))||0);var B="";for(s=0;s<w.childNodes.length;s++)B+=w.childNodes[s].nodeValue;B=B.trim();var M=w.getAttribute("compression"),W=w.getAttribute("encoding");if(M&&"gzip"!==M&&"zlib"!==M)return n.log("cc.TMXMapInfo.parseXMLFile(): unsupported compression method"),null;switch(M){case"gzip":O._tiles=n.unzipBase64AsArray(B,4);break;case"zlib":var z=new Zlib.Inflate(n.Codec.Base64.decodeAsArray(B,1));O._tiles=n.uint8ArrayToUint32Array(z.decompress());break;case null:case"":if("base64"===W)O._tiles=n.Codec.Base64.decodeAsArray(B,4);else if("csv"===W){O._tiles=[];for(var V=B.split(","),k=0;k<V.length;k++)O._tiles.push(parseInt(V[k]))}else{var G=w.getElementsByTagName("tile");O._tiles=[];for(var U=0;U<G.length;U++)O._tiles.push(parseInt(G[U].getAttribute("gid")))}break;default:this.layerAttrs===n.TMXLayerInfo.ATTRIB_NONE&&n.log("cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported")}var X=L.querySelectorAll("properties > property");if(X){var Y={};for(s=0;s<X.length;s++)Y[X[s].getAttribute("name")]=X[s].getAttribute("value");O.properties=Y}this.setLayers(O)}var H=a.getElementsByTagName("objectgroup");if(H)for(r=0;r<H.length;r++){var j=H[r],Q=new n.TMXObjectGroup;Q.groupName=j.getAttribute("name"),Q.setPositionOffset(n.p(parseFloat(j.getAttribute("x"))*this.getTileSize().width||0,parseFloat(j.getAttribute("y"))*this.getTileSize().height||0));var Z=j.querySelectorAll("objectgroup > properties > property");if(Z)for(s=0;s<Z.length;s++){var q={};q[Z[s].getAttribute("name")]=Z[s].getAttribute("value"),Q.properties=q}var K=j.querySelectorAll("object"),J=n.director.getContentScaleFactor();if(K)for(s=0;s<K.length;s++){var $=K[s],tt={};tt.name=$.getAttribute("name")||"",tt.type=$.getAttribute("type")||"",tt.width=parseInt($.getAttribute("width"))||0,tt.height=parseInt($.getAttribute("height"))||0,tt.x=((0|($.getAttribute("x")||0))+Q.getPositionOffset().x)/J;var et=(0|($.getAttribute("y")||0))+Q.getPositionOffset().y/J;tt.y=(parseInt(this.getMapSize().height*this.getTileSize().height)-et-tt.height)/n.director.getContentScaleFactor(),tt.rotation=parseInt($.getAttribute("rotation"))||0;var it=$.querySelectorAll("properties > property");if(it)for(var nt=0;nt<it.length;nt++)tt[it[nt].getAttribute("name")]=it[nt].getAttribute("value");var rt=$.querySelectorAll("polygon");if(rt&&rt.length>0){var st=rt[0].getAttribute("points");st&&(tt.points=this._parsePointsString(st))}var ot=$.querySelectorAll("polyline");if(ot&&ot.length>0){var at=ot[0].getAttribute("points");at&&(tt.polylinePoints=this._parsePointsString(at))}Q.setObjects(tt)}this.setObjectGroups(Q)}return a},_parsePointsString:function(t){if(!t)return null;for(var e=[],i=t.split(" "),n=0;n<i.length;n++){var r=i[n].split(",");e.push({x:r[0],y:r[1]})}return e},parseXMLString:function(t){return this.parseXMLFile(t,!0)},getTileProperties:function(){return this._tileProperties},setTileProperties:function(t){this._tileProperties.push(t)},getCurrentString:function(){return this.currentString},setCurrentString:function(t){this.currentString=t},getTMXFileName:function(){return this.tmxFileName},setTMXFileName:function(t){this.tmxFileName=t},_internalInit:function(t,e){this._tilesets.length=0,this._layers.length=0,this.tmxFileName=t,e&&(this._resources=e),this._objectGroups.length=0,this.properties.length=0,this._tileProperties.length=0,this.currentString="",this.storingCharacters=!1,this.layerAttrs=n.TMXLayerInfo.ATTRIB_NONE,this.parentElement=n.TMX_PROPERTY_NONE,this._currentFirstGID=0}});var c=n.TMXMapInfo.prototype;c.mapWidth,n.defineGetterSetter(c,"mapWidth",c._getMapWidth,c._setMapWidth),c.mapHeight,n.defineGetterSetter(c,"mapHeight",c._getMapHeight,c._setMapHeight),c.tileWidth,n.defineGetterSetter(c,"tileWidth",c._getTileWidth,c._setTileWidth),c.tileHeight,n.defineGetterSetter(c,"tileHeight",c._getTileHeight,c._setTileHeight),n.TMXMapInfo.create=function(t,e){return new n.TMXMapInfo(t,e)},n.loader.register(["tmx","tsx"],n._txtLoader),n.TMXLayerInfo.ATTRIB_NONE=1,n.TMXLayerInfo.ATTRIB_BASE64=2,n.TMXLayerInfo.ATTRIB_GZIP=4,n.TMXLayerInfo.ATTRIB_ZLIB=8,n.TMXObjectGroup=n._Class.extend({properties:null,groupName:"",_positionOffset:null,_objects:null,ctor:function(){this.groupName="",this._positionOffset=n.p(0,0),this.properties=[],this._objects=[]},getPositionOffset:function(){return n.p(this._positionOffset)},setPositionOffset:function(t){this._positionOffset.x=t.x,this._positionOffset.y=t.y},getProperties:function(){return this.properties},setProperties:function(t){this.properties.push(t)},getGroupName:function(){return this.groupName.toString()},setGroupName:function(t){this.groupName=t},propertyNamed:function(t){return this.properties[t]},objectNamed:function(t){return this.getObject(t)},getObject:function(t){if(this._objects&&this._objects.length>0)for(var e=this._objects,i=0,n=e.length;n>i;i++){var r=e[i].name;if(r&&r===t)return e[i]}return null},getObjects:function(){return this._objects},setObjects:function(t){this._objects.push(t)}}),n.TMXLayer=n.SpriteBatchNode.extend({tiles:null,tileset:null,layerOrientation:null,properties:null,layerName:"",_layerSize:null,_mapTileSize:null,_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,_className:"TMXLayer",ctor:function(t,e,i){n.SpriteBatchNode.prototype.ctor.call(this),this._descendants=[],this._layerSize=n.size(0,0),this._mapTileSize=n.size(0,0),void 0!==i&&this.initWithTilesetInfo(t,e,i)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.TMXLayer.CanvasRenderCmd(this):new n.TMXLayer.WebGLRenderCmd(this)},setContentSize:function(t,e){_ccsg.Node.prototype.setContentSize.call(this,t,e),this._renderCmd._updateCacheContext(t,e)},getTexture:function(){return this._renderCmd.getTexture()},getLayerSize:function(){return n.size(this._layerSize.width,this._layerSize.height)},setLayerSize:function(t){this._layerSize.width=t.width,this._layerSize.height=t.height},_getLayerWidth:function(){return this._layerSize.width},_setLayerWidth:function(t){this._layerSize.width=t},_getLayerHeight:function(){return this._layerSize.height},_setLayerHeight:function(t){this._layerSize.height=t},getMapTileSize:function(){return n.size(this._mapTileSize.width,this._mapTileSize.height)},setMapTileSize:function(t){this._mapTileSize.width=t.width,this._mapTileSize.height=t.height},_getTileWidth:function(){return this._mapTileSize.width},_setTileWidth:function(t){this._mapTileSize.width=t},_getTileHeight:function(){return this._mapTileSize.height},_setTileHeight:function(t){this._mapTileSize.height=t},getTiles:function(){return this.tiles},setTiles:function(t){this.tiles=t},getTileset:function(){return this.tileset},setTileset:function(t){this.tileset=t},getLayerOrientation:function(){return this.layerOrientation},setLayerOrientation:function(t){this.layerOrientation=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTilesetInfo:function(t,e,i){var r,s=e._layerSize,o=parseInt(s.width*s.height),a=.35*o+1;if(t&&(r=n.textureCache.addImage(t.sourceImage)),this.initWithTexture(r,a)){this.layerName=e.name,this._layerSize=s,this.tiles=e._tiles,this._minGID=e._minGID,this._maxGID=e._maxGID,this._opacity=e._opacity,this.properties=e.properties,this._contentScaleFactor=n.director.getContentScaleFactor(),this.tileset=t,this._mapTileSize=i.getTileSize(),this.layerOrientation=i.orientation;var c=this._calculateLayerOffset(e.offset);return this.setPosition(n.pointPixelsToPoints(c)),this._atlasIndexArray=[],this.setContentSize(n.sizePixelsToPoints(n.size(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height))),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,!0}return!1},releaseMap:function(){this.tiles&&(this.tiles=null),this._atlasIndexArray&&(this._atlasIndexArray=null)},getTileAt:function(t,e){if(!t)throw new Error("cc.TMXLayer.getTileAt(): pos should be non-null");if(void 0!==e&&(t=n.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("cc.TMXLayer.getTileAt(): invalid position");if(!this.tiles||!this._atlasIndexArray)return n.log("cc.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released"),null;var i=null,r=this.getTileGIDAt(t);if(0===r)return i;var s=0|t.x+t.y*this._layerSize.width;if(i=this.getChildByTag(s),!i){var o=this.tileset.rectForGID(r);o=n.rectPixelsToPoints(o),i=new n.Sprite,i.initWithTexture(this.texture,o),i.batchNode=this,i.setPosition(this.getPositionAt(t)),i.vertexZ=this._vertexZForPos(t),i.anchorX=0,i.anchorY=0,i.opacity=this._opacity;var a=this._atlasIndexForExistantZ(s);this.addSpriteWithoutQuad(i,a,s)}return i},getTileGIDAt:function(t,e){if(null==t)throw new Error("cc.TMXLayer.getTileGIDAt(): pos should be non-null");if(void 0!==e&&(t=n.p(t,e)),
t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("cc.TMXLayer.getTileGIDAt(): invalid position");if(!this.tiles||!this._atlasIndexArray)return n.log("cc.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released"),null;var i=0|t.x+t.y*this._layerSize.width,r=this.tiles[i];return(r&n.TMX_TILE_FLIPPED_MASK)>>>0},getTileFlagsAt:function(t,e){if(!t)throw new Error("cc.TMXLayer.getTileFlagsAt(): pos should be non-null");if(void 0!==e&&(t=n.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("cc.TMXLayer.getTileFlagsAt(): invalid position");if(!this.tiles||!this._atlasIndexArray)return n.log("cc.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released"),null;var i=0|t.x+t.y*this._layerSize.width,r=this.tiles[i];return(r&n.TMX_TILE_FLIPPED_ALL)>>>0},setTileGID:function(t,e,i,r){if(!e)throw new Error("cc.TMXLayer.setTileGID(): pos should be non-null");var s;if(void 0!==r?s=n.p(e,i):(s=e,r=i),s.x>=this._layerSize.width||s.y>=this._layerSize.height||s.x<0||s.y<0)throw new Error("cc.TMXLayer.setTileGID(): invalid position");if(!this.tiles||!this._atlasIndexArray)return void n.log("cc.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released");if(0!==t&&t<this.tileset.firstGid)return void n.log("cc.TMXLayer.setTileGID(): invalid gid:"+t);r=r||0,this._setNodeDirtyForCache();var o=this.getTileFlagsAt(s),a=this.getTileGIDAt(s);if(a!==t||o!==r){var c=(t|r)>>>0;if(0===t)this.removeTileAt(s);else if(0===a)this._insertTileForGID(c,s);else{var h=s.x+s.y*this._layerSize.width,l=this.getChildByTag(h);if(l){var d=this.tileset.rectForGID(t);d=n.rectPixelsToPoints(d),l.setTextureRect(d,!1),null!=r&&this._setupTileSprite(l,s,c),this.tiles[h]=c}else this._updateTileForGID(c,s)}}},removeTileAt:function(t,e){if(!t)throw new Error("cc.TMXLayer.removeTileAt(): pos should be non-null");if(void 0!==e&&(t=n.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("cc.TMXLayer.removeTileAt(): invalid position");if(!this.tiles||!this._atlasIndexArray)return void n.log("cc.TMXLayer.removeTileAt(): TMXLayer: the tiles map has been released");var i=this.getTileGIDAt(t);if(0!==i){n._renderType===n.game.RENDER_TYPE_CANVAS&&this._setNodeDirtyForCache();var r=0|t.x+t.y*this._layerSize.width,s=this._atlasIndexForExistantZ(r);this.tiles[r]=0,this._atlasIndexArray.splice(s,1);var o=this.getChildByTag(r);if(o)n.SpriteBatchNode.prototype.removeChild.call(this,o,!0);else if(n._renderType===n.game.RENDER_TYPE_WEBGL&&this.textureAtlas.removeQuadAtIndex(s),this._children)for(var a=this._children,c=0,h=a.length;h>c;c++){var l=a[c];if(l){var d=l.atlasIndex;d>=s&&(l.atlasIndex=d-1)}}}},getPositionAt:function(t,e){void 0!==e&&(t=n.p(t,e));var i=n.p(0,0);switch(this.layerOrientation){case n.TMX_ORIENTATION_ORTHO:i=this._positionForOrthoAt(t);break;case n.TMX_ORIENTATION_ISO:i=this._positionForIsoAt(t);break;case n.TMX_ORIENTATION_HEX:i=this._positionForHexAt(t)}return n.pointPixelsToPoints(i)},getProperty:function(t){return this.properties[t]},setupTiles:function(){this._renderCmd.initImageSize(),this._parseInternalProperties(),n._renderType===n.game.RENDER_TYPE_CANVAS&&this._setNodeDirtyForCache();for(var t=this._layerSize.height,e=this._layerSize.width,i=0;t>i;i++)for(var r=0;e>r;r++){var s=r+e*i,o=this.tiles[s];0!==o&&(this._appendTileForGID(o,n.p(r,i)),this._minGID=Math.min(o,this._minGID),this._maxGID=Math.max(o,this._maxGID))}this._maxGID>=this.tileset.firstGid&&this._minGID>=this.tileset.firstGid||n.log("cocos2d:TMX: Only 1 tileset per layer is supported")},addChild:function(t,e,i){n.log("addChild: is not supported on cc.TMXLayer. Instead use setTileGID or tileAt.")},removeChild:function(t,e){if(t){if(-1===this._children.indexOf(t))return void n.log("cc.TMXLayer.removeChild(): Tile does not belong to TMXLayer");n._renderType===n.game.RENDER_TYPE_CANVAS&&this._setNodeDirtyForCache();var i=t.atlasIndex,r=this._atlasIndexArray[i];this.tiles[r]=0,this._atlasIndexArray.splice(i,1),n.SpriteBatchNode.prototype.removeChild.call(this,t,e),n.renderer.childrenOrderDirty=!0}},getLayerName:function(){return this.layerName},setLayerName:function(t){this.layerName=t},_positionForIsoAt:function(t){return n.p(this._mapTileSize.width/2*(this._layerSize.width+t.x-t.y-1),this._mapTileSize.height/2*(2*this._layerSize.height-t.x-t.y-2))},_positionForOrthoAt:function(t){return n.p(t.x*this._mapTileSize.width,(this._layerSize.height-t.y-1)*this._mapTileSize.height)},_positionForHexAt:function(t){var e=t.x%2===1?-this._mapTileSize.height/2:0;return n.p(t.x*this._mapTileSize.width*3/4,(this._layerSize.height-t.y-1)*this._mapTileSize.height+e)},_calculateLayerOffset:function(t){var e=n.p(0,0);switch(this.layerOrientation){case n.TMX_ORIENTATION_ORTHO:e=n.p(t.x*this._mapTileSize.width,-t.y*this._mapTileSize.height);break;case n.TMX_ORIENTATION_ISO:e=n.p(this._mapTileSize.width/2*(t.x-t.y),this._mapTileSize.height/2*(-t.x-t.y));break;case n.TMX_ORIENTATION_HEX:(0!==t.x||0!==t.y)&&n.log("offset for hexagonal map not implemented yet")}return e},_appendTileForGID:function(t,e){var i=this.tileset.rectForGID(t);i=n.rectPixelsToPoints(i);var r=0|e.x+e.y*this._layerSize.width,s=this._renderCmd._reusedTileWithRect(i);this._setupTileSprite(s,e,t);var o=this._atlasIndexArray.length;return this.insertQuadFromSprite(s,o),this._atlasIndexArray.splice(o,0,r),s},_insertTileForGID:function(t,e){var i=this.tileset.rectForGID(t);i=n.rectPixelsToPoints(i);var r=0|e.x+e.y*this._layerSize.width,s=this._renderCmd._reusedTileWithRect(i);this._setupTileSprite(s,e,t);var o=this._atlasIndexForNewZ(r);if(this.insertQuadFromSprite(s,o),this._atlasIndexArray.splice(o,0,r),this._children)for(var a=this._children,c=0,h=a.length;h>c;c++){var l=a[c];if(l){var d=l.atlasIndex;d>=o&&(l.atlasIndex=d+1)}}return this.tiles[r]=t,s},_updateTileForGID:function(t,e){var i=this.tileset.rectForGID(t),r=this._contentScaleFactor;i=n.rect(i.x/r,i.y/r,i.width/r,i.height/r);var s=e.x+e.y*this._layerSize.width,o=this._renderCmd._reusedTileWithRect(i);return this._setupTileSprite(o,e,t),o.atlasIndex=this._atlasIndexForExistantZ(s),o.dirty=!0,o.updateTransform(),this.tiles[s]=t,o},_parseInternalProperties:function(){var t=this.getProperty("cc_vertexz");if(t)if("automatic"===t){this._useAutomaticVertexZ=!0;var e=this.getProperty("cc_alpha_func"),i=0;if(e&&(i=parseFloat(e)),n._renderType===n.game.RENDER_TYPE_WEBGL){this.shaderProgram=n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURECOLORALPHATEST);var r=n._renderContext.getUniformLocation(this.shaderProgram.getProgram(),n.UNIFORM_ALPHA_TEST_VALUE_S);this.shaderProgram.use(),this.shaderProgram.setUniformLocationWith1f(r,i)}}else this._vertexZvalue=parseInt(t,10)},_setupTileSprite:function(t,e,i){var r=e.x+e.y*this._layerSize.width;if(t.setPosition(this.getPositionAt(e)),n._renderType===n.game.RENDER_TYPE_WEBGL?t.vertexZ=this._vertexZForPos(e):t.tag=r,t.anchorX=0,t.anchorY=0,t.opacity=this._opacity,n._renderType===n.game.RENDER_TYPE_WEBGL&&(t.rotation=0),t.setFlippedX(!1),t.setFlippedY(!1),(i&n.TMX_TILE_DIAGONAL_FLAG)>>>0){t.anchorX=.5,t.anchorY=.5,t.x=this.getPositionAt(e).x+t.width/2,t.y=this.getPositionAt(e).y+t.height/2;var s=(i&(n.TMX_TILE_HORIZONTAL_FLAG|n.TMX_TILE_VERTICAL_FLAG)>>>0)>>>0;s===n.TMX_TILE_HORIZONTAL_FLAG?t.rotation=90:s===n.TMX_TILE_VERTICAL_FLAG?t.rotation=270:s===(n.TMX_TILE_VERTICAL_FLAG|n.TMX_TILE_HORIZONTAL_FLAG)>>>0?(t.rotation=90,t.setFlippedX(!0)):(t.rotation=270,t.setFlippedX(!0))}else(i&n.TMX_TILE_HORIZONTAL_FLAG)>>>0&&t.setFlippedX(!0),(i&n.TMX_TILE_VERTICAL_FLAG)>>>0&&t.setFlippedY(!0)},_vertexZForPos:function(t){var e=0,i=0;if(this._useAutomaticVertexZ)switch(this.layerOrientation){case n.TMX_ORIENTATION_ISO:i=this._layerSize.width+this._layerSize.height,e=-(i-(t.x+t.y));break;case n.TMX_ORIENTATION_ORTHO:e=-(this._layerSize.height-t.y);break;case n.TMX_ORIENTATION_HEX:n.log("TMX Hexa zOrder not supported");break;default:n.log("TMX invalid value")}else e=this._vertexZvalue;return e},_atlasIndexForExistantZ:function(t){var e;if(this._atlasIndexArray)for(var i=this._atlasIndexArray,r=0,s=i.length;s>r&&(e=i[r],e!==t);r++);return n.js.isNumber(e)||n.log("cc.TMXLayer._atlasIndexForExistantZ(): TMX atlas index not found. Shall not happen"),r},_atlasIndexForNewZ:function(t){for(var e=this._atlasIndexArray,i=0,n=e.length;n>i;i++){var r=e[i];if(r>t)break}return i}});var c=n.TMXLayer.prototype;n.defineGetterSetter(c,"texture",c.getTexture,c.setTexture),c.layerWidth,n.defineGetterSetter(c,"layerWidth",c._getLayerWidth,c._setLayerWidth),c.layerHeight,n.defineGetterSetter(c,"layerHeight",c._getLayerHeight,c._setLayerHeight),c.tileWidth,n.defineGetterSetter(c,"tileWidth",c._getTileWidth,c._setTileWidth),c.tileHeight,n.defineGetterSetter(c,"tileHeight",c._getTileHeight,c._setTileHeight),n.TMXLayer.create=function(t,e,i){return new n.TMXLayer(t,e,i)},function(){n.TMXLayer.CanvasRenderCmd=function(t){n.SpriteBatchNode.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._realWorldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0};var e=n._canvas,i=document.createElement("canvas");i.width=e.width,i.height=e.height,this._cacheCanvas=i,this._cacheContext=new n.CanvasContextWrapper(this._cacheCanvas.getContext("2d"));var r=new n.Texture2D;r.initWithElement(i),r.handleLoadedTexture(),this._cacheTexture=r,this._cacheDirty=!1};var t=n.TMXLayer.CanvasRenderCmd.prototype=Object.create(n.SpriteBatchNode.CanvasRenderCmd.prototype);t.constructor=n.TMXLayer.CanvasRenderCmd,t._setNodeDirtyForCache=function(){this._cacheDirty=!0},t._renderingChildToCache=function(){if(this._cacheDirty){var t=this._cacheContext,e=t.getContext(),i=this._cacheCanvas;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height);for(var n=this._node._children,r=0,s=n.length;s>r;r++)if(n[r]){var o=n[r]._renderCmd;o&&(o.rendering(t,1,1),o._cacheDirty=!1)}this._cacheDirty=!1}},t.rendering=function(t,e,i){var r=this._displayedOpacity/255;if(!(0>=r)){var s=this._node;this._renderingChildToCache();var o=t||n._renderContext,a=o.getContext();o.setGlobalAlpha(r);var c=this._cacheCanvas;if(c&&0!==c.width&&0!==c.height){o.setTransform(this._realWorldTransform,e,i);var h=c.height*i;if(s.layerOrientation===n.TMX_ORIENTATION_HEX){var l=.5*s._mapTileSize.height*i;a.drawImage(c,0,0,c.width,c.height,0,-h+l,c.width*e,h)}else a.drawImage(c,0,0,c.width,c.height,0,-h,c.width*e,h)}n.g_NumberOfDraws++}},t._updateCacheContext=function(t,e){var i=this._node,r=i._contentSize,s=this._cacheCanvas,o=n.contentScaleFactor();s.width=0|1.5*r.width*o,s.height=0|1.5*r.height*o,i.layerOrientation===n.TMX_ORIENTATION_HEX?this._cacheContext.setOffset(0,.5*-i._mapTileSize.height):this._cacheContext.setOffset(0,0);var a=this._cacheTexture._contentSize;a.width=s.width,a.height=s.height},t.getTexture=function(){return this._cacheTexture},t.visit=function(t){var e,i,r=this._node,s=r._children;if(r._visible&&s&&0!==s.length){if(t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1),this._syncStatus(t),this._cacheDirty){var o=this._cacheContext,a=this._cacheCanvas,c=o.getContext(),h=r.__instanceId,l=n.renderer;for(l._turnToCacheMode(h),r.sortAllChildren(),e=0,i=s.length;i>e;e++)if(s[e]){var d=s[e]._renderCmd;d&&(d.visit(this),d._cacheDirty=!1)}c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,a.width,a.height),l._renderingToCacheCanvas(o,h),this._cacheDirty=!1}n.renderer.pushRenderCommand(this),this._dirtyFlag=0}},t.transform=function(t,e){var i=this.getNodeToParentTransform(),n=this._realWorldTransform;if(t){var r=t._worldTransform;n.a=i.a*r.a+i.b*r.c,n.b=i.a*r.b+i.b*r.d,n.c=i.c*r.a+i.d*r.c,n.d=i.c*r.b+i.d*r.d,n.tx=r.a*i.tx+r.c*i.ty+r.tx,n.ty=r.d*i.ty+r.ty+r.b*i.tx}else n.a=i.a,n.b=i.b,n.c=i.c,n.d=i.d,n.tx=i.tx,n.ty=i.ty;if(e){var s=this._node._children;if(!s||0===s.length)return;var o,a;for(o=0,a=s.length;a>o;o++)s[o]._renderCmd.transform(this,e)}},t.initImageSize=function(){var t=this._node;t.tileset.imageSize=this._texture.getContentSizeInPixels()},t._reusedTileWithRect=function(t){var e=this._node;return e._reusedTile=new n.Sprite,e._reusedTile.initWithTexture(this._texture,t,!1),e._reusedTile.batchNode=e,e._reusedTile.parent=e,e._reusedTile._renderCmd._cachedParent=e._renderCmd,e._reusedTile}}(),function(){n.TMXLayer.WebGLRenderCmd=function(t){n.SpriteBatchNode.WebGLRenderCmd.call(this,t),this._needDraw=!0};var t=n.TMXLayer.WebGLRenderCmd.prototype=Object.create(n.SpriteBatchNode.WebGLRenderCmd.prototype);t.constructor=n.TMXLayer.WebGLRenderCmd,t._updateCacheContext=function(){},t.initImageSize=function(){var t=this._node;t.tileset.imageSize=this._textureAtlas.texture.getContentSizeInPixels(),this._textureAtlas.texture.setAliasTexParameters()},t._reusedTileWithRect=function(t){var e=this._node;return e._reusedTile?(e._reusedTile.batchNode=null,e._reusedTile.setTextureRect(t,!1),e._reusedTile.batchNode=e):(e._reusedTile=new n.Sprite,e._reusedTile.initWithTexture(e.texture,t,!1),e._reusedTile.batchNode=e),e._reusedTile}}(),n.PointObject=n._Class.extend({_ratio:null,_offset:null,_child:null,ctor:function(t,e){this.initWithCCPoint(t,e)},getRatio:function(){return this._ratio},setRatio:function(t){this._ratio=t},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t},getChild:function(){return this._child},setChild:function(t){this._child=t},initWithCCPoint:function(t,e){return this._ratio=t,this._offset=e,this._child=null,!0}}),n.PointObject.create=function(t,e){return new n.PointObject(t,e)},n.ParallaxNode=_ccsg.Node.extend({parallaxArray:null,_lastPosition:null,_className:"ParallaxNode",getParallaxArray:function(){return this.parallaxArray},setParallaxArray:function(t){this.parallaxArray=t},ctor:function(){_ccsg.Node.prototype.ctor.call(this),this.parallaxArray=[],this._lastPosition=n.p(-100,-100)},addChild:function(t,e,i,r){if(3===arguments.length)return void n.log("ParallaxNode: use addChild(child, z, ratio, offset) instead");if(!t)throw new Error("cc.ParallaxNode.addChild(): child should be non-null");var s=new n.PointObject(i,r);s.setChild(t),this.parallaxArray.push(s),t.setPosition(this._position.x*i.x+r.x,this._position.y*i.y+r.y),_ccsg.Node.prototype.addChild.call(this,t,e,t.tag)},removeChild:function(t,e){for(var i=this.parallaxArray,n=0;n<i.length;n++){var r=i[n];if(r.getChild()===t){i.splice(n,1);break}}_ccsg.Node.prototype.removeChild.call(this,t,e)},removeAllChildren:function(t){this.parallaxArray.length=0,_ccsg.Node.prototype.removeAllChildren.call(this,t)},_updateParallaxPosition:function(){var t=this._absolutePosition();if(!n.pointEqualToPoint(t,this._lastPosition)){for(var e=this.parallaxArray,i=0,r=e.length;r>i;i++){var s=e[i],o=s.getChild();o.setPosition(-t.x+t.x*s.getRatio().x+s.getOffset().x,-t.y+t.y*s.getRatio().y+s.getOffset().y)}this._lastPosition=t}},_absolutePosition:function(){for(var t=this._position,e=this;null!==e.parent;)e=e.parent,t=n.pAdd(t,e.getPosition());return t},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.ParallaxNode.CanvasRenderCmd(this):new n.ParallaxNode.WebGLRenderCmd(this)}}),n.ParallaxNode.create=function(){return new n.ParallaxNode},function(){n.ParallaxNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1};var t=n.ParallaxNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.ParallaxNode.CanvasRenderCmd,t.updateStatus=function(){this._node._updateParallaxPosition(),_ccsg.Node.CanvasRenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){this._node._updateParallaxPosition(),_ccsg.Node.CanvasRenderCmd.prototype._syncStatus.call(this,t)}}(),n.game.once(n.game.EVENT_RENDERER_INITED,function(){if(n._renderType===n.game.RENDER_TYPE_WEBGL){n.ParallaxNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!1};var t=n.ParallaxNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.ParallaxNode.WebGLRenderCmd,t.updateStatus=function(){this._node._updateParallaxPosition(),_ccsg.Node.WebGLRenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){this._node._updateParallaxPosition(),_ccsg.Node.WebGLRenderCmd.prototype._syncStatus.call(this,t)}}}),function(){var t=!1,e=n.sys,i=e.browserVersion,r=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),s={common:{MULTI_CHANNEL:!0,WEB_AUDIO:r,AUTOPLAY:!0}};if(s[e.BROWSER_TYPE_IE]={MULTI_CHANNEL:!0,WEB_AUDIO:r,AUTOPLAY:!0,USE_EMPTIED_EVENT:!0},s[e.BROWSER_TYPE_ANDROID]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1},s[e.BROWSER_TYPE_CHROME]={MULTI_CHANNEL:!0,WEB_AUDIO:!0,AUTOPLAY:!1},s[e.BROWSER_TYPE_FIREFOX]={MULTI_CHANNEL:!0,WEB_AUDIO:!0,AUTOPLAY:!0,DELAY_CREATE_CTX:!0},s[e.BROWSER_TYPE_UC]={MULTI_CHANNEL:!0,WEB_AUDIO:!1,AUTOPLAY:!1},s[e.BROWSER_TYPE_QQ]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!0},s[e.BROWSER_TYPE_OUPENG]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},s[e.BROWSER_TYPE_WECHAT]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},s[e.BROWSER_TYPE_360]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!0},s[e.BROWSER_TYPE_MIUI]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!0},s[e.BROWSER_TYPE_LIEBAO]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},s[e.BROWSER_TYPE_SOUGOU]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},s[e.BROWSER_TYPE_BAIDU]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},s[e.BROWSER_TYPE_BAIDU_APP]={MULTI_CHANNEL:!1,WEB_AUDIO:!1,AUTOPLAY:!1,REPLAY_AFTER_TOUCH:!0,USE_EMPTIED_EVENT:!0},s[e.BROWSER_TYPE_SAFARI]={MULTI_CHANNEL:!0,WEB_AUDIO:!0,AUTOPLAY:!1,webAudioCallback:function(t){document.createElement("audio").src=t}},n.sys.isMobile)window.__audioSupport=n.sys.os!==n.sys.OS_IOS?s[e.browserType]||s.common:s[e.BROWSER_TYPE_SAFARI];else switch(e.browserType){case e.BROWSER_TYPE_IE:window.__audioSupport=s[e.BROWSER_TYPE_IE];break;case e.BROWSER_TYPE_FIREFOX:window.__audioSupport=s[e.BROWSER_TYPE_FIREFOX];break;default:window.__audioSupport=s.common}if(i)switch(e.browserType){case e.BROWSER_TYPE_CHROME:i=parseInt(i),30>i?window.__audioSupport={MULTI_CHANNEL:!1,WEB_AUDIO:!0,AUTOPLAY:!1}:42===i&&(window.__audioSupport.NEED_MANUAL_LOOP=!0);break;case e.BROWSER_TYPE_MIUI:n.sys.isMobile&&(i=i.match(/\d+/g),(i[0]<2||2===i[0]&&0===i[1]&&i[2]<=1)&&(window.__audioSupport.AUTOPLAY=!1))}t&&setTimeout(function(){n.log("browse type: "+e.browserType),n.log("browse version: "+i),n.log("MULTI_CHANNEL: "+window.__audioSupport.MULTI_CHANNEL),n.log("WEB_AUDIO: "+window.__audioSupport.WEB_AUDIO),n.log("AUTOPLAY: "+window.__audioSupport.AUTOPLAY)},0)}(),n.Audio=n._Class.extend({volume:1,loop:!1,src:null,_touch:!1,_playing:!1,_AUDIO_TYPE:"AUDIO",_pause:!1,_buffer:null,_currentSource:null,_startTime:null,_currentTime:null,_context:null,_volume:null,_ignoreEnded:!1,_manualLoop:!1,_element:null,ctor:function(t,e,i){t&&(this._context=t),e&&(this._volume=e),t&&e&&(this._AUDIO_TYPE="WEBAUDIO"),this.src=i},_setBufferCallback:null,setBuffer:function(t){if(t){var e=this._playing;this._AUDIO_TYPE="WEBAUDIO",this._buffer&&this._buffer!==t&&this.getPlaying()&&this.stop(),this._buffer=t,e&&this.play(),this._volume.gain.value=this.volume,this._setBufferCallback&&this._setBufferCallback(t)}},_setElementCallback:null,setElement:function(t){if(t){var e=this._playing;this._AUDIO_TYPE="AUDIO",this._element&&this._element!==t&&this.getPlaying()&&this.stop(),this._element=t,e&&this.play(),t.volume=this.volume,t.loop=this.loop,this._setElementCallback&&this._setElementCallback(t)}},play:function(t,e){this._playing=!0,this.loop=void 0===e?this.loop:e,"AUDIO"===this._AUDIO_TYPE?this._playOfAudio(t):this._playOfWebAudio(t)},getPlaying:function(){if(!this._playing)return!1;if("AUDIO"===this._AUDIO_TYPE){var t=this._element;return!t||this._pause||t.ended?this._playing=!1:!0}var e=this._currentSource;return e&&e.playbackState?this._currentTime+this._context.currentTime-this._startTime<e.buffer.duration:!0},_playOfWebAudio:function(t){var e=this._currentSource;if(this._buffer){if(!this._pause&&e){if(!(0===this._context.currentTime||this._currentTime+this._context.currentTime-this._startTime>e.buffer.duration))return;this._stopOfWebAudio()}var i=this._context.createBufferSource();if(i.buffer=this._buffer,i.connect(this._volume),i.loop=this._manualLoop?!1:this.loop,this._startTime=this._context.currentTime,this._currentTime=t||0,this._ignoreEnded=!1,i.start)i.start(0,t||0);else if(i.noteGrainOn){var n=i.buffer.duration;this.loop?i.noteGrainOn(0,t,n):i.noteGrainOn(0,t,n-t)}else i.noteOn(0);this._currentSource=i;var r=this;i.onended=function(){return r._manualLoop&&r._playing&&r.loop?(r.stop(),void r.play()):void(r._ignoreEnded?r._ignoreEnded=!1:r._pause?r._playing=!1:r.stop())}}},_playOfAudio:function(){var t=this._element;t&&(t.loop=this.loop,t.play())},stop:function(){this._playing=!1,"AUDIO"===this._AUDIO_TYPE?this._stopOfAudio():this._stopOfWebAudio()},_stopOfWebAudio:function(){var t=this._currentSource;this._ignoreEnded=!0,t&&(t.stop(0),this._currentSource=null)},_stopOfAudio:function(){var t=this._element;t&&(t.pause(),t.duration&&t.duration!==1/0&&(t.currentTime=0))},pause:function(){this.getPlaying()!==!1&&(this._playing=!1,this._pause=!0,"AUDIO"===this._AUDIO_TYPE?this._pauseOfAudio():this._pauseOfWebAudio())},_pauseOfWebAudio:function(){this._currentTime+=this._context.currentTime-this._startTime;var t=this._currentSource;t&&t.stop(0)},_pauseOfAudio:function(){var t=this._element;t&&t.pause()},resume:function(){this._pause&&("AUDIO"===this._AUDIO_TYPE?this._resumeOfAudio():this._resumeOfWebAudio(),this._pause=!1,this._playing=!0)},_resumeOfWebAudio:function(){var t=this._currentSource;if(t){this._startTime=this._context.currentTime;var e=this._currentTime%t.buffer.duration;this._playOfWebAudio(e)}},_resumeOfAudio:function(){var t=this._element;t&&t.play()},setVolume:function(t){t>1&&(t=1),0>t&&(t=0),this.volume=t,"AUDIO"===this._AUDIO_TYPE?this._element&&(this._element.volume=t):this._volume&&(this._volume.gain.value=t)},getVolume:function(){return this.volume},cloneNode:function(){var t,e;if("AUDIO"===this._AUDIO_TYPE){t=new n.Audio;var i=document.createElement("audio");i.src=this.src,t.setElement(i)}else{var r=this._context.createGain();r.gain.value=1,r.connect(this._context.destination),t=new n.Audio(this._context,r,this.src),this._buffer?t.setBuffer(this._buffer):(e=this,this._setBufferCallback=function(i){t.setBuffer(i),e._setBufferCallback=null}),t._manualLoop=this._manualLoop}return t._AUDIO_TYPE=this._AUDIO_TYPE,t}}),function(t){var e=t.WEB_AUDIO,i=t.MULTI_CHANNEL,r=t.AUTOPLAY,s=[];!function(){var t=document.createElement("audio");if(t.canPlayType){var e=t.canPlayType('audio/ogg; codecs="vorbis"');e&&""!==e&&s.push(".ogg");var i=t.canPlayType("audio/mpeg");i&&""!==i&&s.push(".mp3");var n=t.canPlayType('audio/wav; codecs="1"');n&&""!==n&&s.push(".wav");var r=t.canPlayType("audio/mp4");r&&""!==r&&s.push(".mp4");var o=t.canPlayType("audio/x-m4a");o&&""!==o&&s.push(".m4a")}}();try{if(e){var o=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);t.DELAY_CREATE_CTX&&setTimeout(function(){o=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0)}}catch(a){e=!1,n.log("browser don't support web audio")}var c={cache:{},load:function(i,r,a,h){if(0===s.length)return h("can not support audio!");var l;n.loader.audioPath&&(i=n.path.join(n.loader.audioPath,i));var d=n.path.extname(i),u=[d];for(l=0;l<s.length;l++)d!==s[l]&&u.push(s[l]);var _;if(c.cache[r])return h(null,c.cache[r]);if(e)try{var f=o.createGain();f.gain.value=1,f.connect(o.destination),_=new n.Audio(o,f,i),t.NEED_MANUAL_LOOP&&(_._manualLoop=!0)}catch(p){e=!1,n.log("browser don't support web audio"),_=new n.Audio(null,null,i)}else _=new n.Audio(null,null,i);this.loadAudioFromExtList(i,u,_,h),c.cache[r]=_},loadAudioFromExtList:function(i,r,a,h){if(0===r.length){var l="can not found the resource of audio! Last match url is : ";return l+=i.replace(/\.(.*)?$/,"("),s.forEach(function(t){l+=t+"|"}),l=l.replace(/\|$/,")"),h({status:520,errorMessage:l},null)}if(i=n.path.changeExtname(i,r.splice(0,1)),e){t.webAudioCallback&&t.webAudioCallback(i);var d=new XMLHttpRequest;d.open("GET",i,!0),d.responseType="arraybuffer",d.onload=function(){o.decodeAudioData(d.response,function(t){a.setBuffer(t),h(null,a)},function(){c.loadAudioFromExtList(i,r,a,h)})},d.onerror=function(){h({status:520,errorMessage:l},null)},d.send()}else{var u=document.createElement("audio"),_=!1,f=!1,p=setTimeout(function(){0===u.readyState?y():(f=!0,u.pause(),document.body.removeChild(u),h("audio load timeout : "+i,a))},1e4),g=function(){if(!_){try{u.currentTime=0,u.volume=1}catch(t){}document.body.removeChild(u),a.setElement(u),u.removeEventListener("canplaythrough",g,!1),u.removeEventListener("error",m,!1),u.removeEventListener("emptied",y,!1),!f&&h(null,a),_=!0,clearTimeout(p)}},m=function(){_&&(document.body.removeChild(u),u.removeEventListener("canplaythrough",g,!1),u.removeEventListener("error",m,!1),u.removeEventListener("emptied",y,!1),!f&&c.loadAudioFromExtList(i,r,a,h),_=!0,clearTimeout(p))},y=function(){f=!0,g(),h(null,a)};u.addEventListener("canplaythrough",g,!1),u.addEventListener("error",m,!1),t.USE_EMPTIED_EVENT&&u.addEventListener("emptied",y,!1),u.src=i,document.body.appendChild(u),u.volume=0}}};if(n.loader.register(["mp3","ogg","wav","mp4","m4a"],c),n.audioEngine={_currMusic:null,_musicVolume:1,features:t,willPlayMusic:function(){return!1},playMusic:function(t,e){var i=this._currMusic;i&&i.src!==t&&i.getPlaying()&&i.stop();var r=c.cache[t];r||(n.loader.load(t),r=c.cache[t]),r.play(0,e),r.setVolume(this._musicVolume),this._currMusic=r},stopMusic:function(t){var e=this._currMusic;e&&(e.stop(),t&&n.loader.release(e.src))},pauseMusic:function(){var t=this._currMusic;t&&t.pause()},resumeMusic:function(){var t=this._currMusic;t&&t.resume()},rewindMusic:function(){var t=this._currMusic;t&&(t.stop(),t.play())},getMusicVolume:function(){return this._musicVolume},setMusicVolume:function(t){t-=0,isNaN(t)&&(t=1),t>1&&(t=1),0>t&&(t=0),this._musicVolume=t;var e=this._currMusic;e&&e.setVolume(t)},isMusicPlaying:function(){var t=this._currMusic;return t?t.getPlaying():!1},_audioPool:{},_maxAudioInstance:5,_effectVolume:1,playEffect:function(t,r){if(!i)return null;var s=this._audioPool[t];s||(s=this._audioPool[t]=[]);var o;for(o=0;o<s.length&&s[o].getPlaying();o++);if(s[o])a=s[o],a.setVolume(this._effectVolume),a.play(0,r);else if(!e&&o>this._maxAudioInstance)n.log("Error: %s greater than %d",t,this._maxAudioInstance);else{var a=c.cache[t];a||(n.loader.load(t),a=c.cache[t]),a=a.cloneNode(),a.setVolume(this._effectVolume),a.loop=r||!1,a.play(),s.push(a)}return a},setEffectsVolume:function(t){t-=0,isNaN(t)&&(t=1),t>1&&(t=1),0>t&&(t=0),this._effectVolume=t;var e=this._audioPool;for(var i in e){var n=e[i];if(Array.isArray(n))for(var r=0;r<n.length;r++)n[r].setVolume(t)}},getEffectsVolume:function(){return this._effectVolume},pauseEffect:function(t){t&&t.pause()},pauseAllEffects:function(){var t=this._audioPool;for(var e in t)for(var i=t[e],n=0;n<t[e].length;n++)i[n].getPlaying()&&i[n].pause()},resumeEffect:function(t){t&&t.resume()},resumeAllEffects:function(){var t=this._audioPool;for(var e in t)for(var i=t[e],n=0;n<t[e].length;n++)i[n].resume()},stopEffect:function(t){t&&t.stop()},stopAllEffects:function(){var t=this._audioPool;for(var e in t)for(var i=t[e],n=0;n<t[e].length;n++)i[n].stop()},unloadEffect:function(t){if(t){n.loader.release(t);var e=this._audioPool[t];e&&(e.length=0),delete this._audioPool[t],delete c.cache[t]}},end:function(){this.stopMusic(),this.stopAllEffects()},_pauseCache:[],_pausePlaying:function(){var t=this._currMusic;t&&t.getPlaying()&&(t.pause(),this._pauseCache.push(t));var e=this._audioPool;for(var i in e)for(var n=e[i],r=0;r<e[i].length;r++)n[r].getPlaying()&&(n[r].pause(),this._pauseCache.push(n[r]))},_resumePlaying:function(){for(var t=this._pauseCache,e=0;e<t.length;e++)t[e].resume();t.length=0}},!r){var h=function(){var e=n.audioEngine._currMusic;e&&e._touch===!1&&e._playing&&e.getPlaying()&&(e._touch=!0,e.play(0,e.loop),!t.REPLAY_AFTER_TOUCH&&n._canvas.removeEventListener("touchstart",h))};setTimeout(function(){n._canvas&&n._canvas.addEventListener("touchstart",h,!1)},150)}}(window.__audioSupport);var r=r||{};r.Class=r.Class||n._Class,r.Class.extend=r.Class.extend||n._Class.extend,r.Node=r.Node||_ccsg.Node,r.Node.extend=r.Node.extend||_ccsg.Node.extend,r.ProtectedNode=r.ProtectedNode||n.ProtectedNode,r.ProtectedNode.extend=r.ProtectedNode.extend||n.ProtectedNode.extend,r.cocosGUIVersion="CocosGUI v1.0.0.0",_=t("../cocos2d/core/event/event-target"),r._FocusNavigationController=n._Class.extend({_keyboardListener:null,_firstFocusedWidget:null,_enableFocusNavigation:!1,_keyboardEventPriority:1,enableFocusNavigation:function(t){this._enableFocusNavigation!==t&&(this._enableFocusNavigation=t,t?this._addKeyboardEventListener():this._removeKeyboardEventListener())},_setFirstFocsuedWidget:function(t){this._firstFocusedWidget=t},_onKeyPressed:function(t,e){this._enableFocusNavigation&&this._firstFocusedWidget&&(t===n.KEY.dpadDown&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(r.Widget.DOWN,this._firstFocusedWidget)),t===n.KEY.dpadUp&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(r.Widget.UP,this._firstFocusedWidget)),t===n.KEY.dpadLeft&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(r.Widget.LEFT,this._firstFocusedWidget)),t===n.KEY.dpadRight&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(r.Widget.RIGHT,this._firstFocusedWidget)))},_addKeyboardEventListener:function(){this._keyboardListener||(this._keyboardListener=n.EventListener.create({event:n.EventListener.KEYBOARD,onKeyReleased:this._onKeyPressed.bind(this)}),n.eventManager.addListener(this._keyboardListener,this._keyboardEventPriority))},_removeKeyboardEventListener:function(){this._keyboardListener&&(n.eventManager.removeEventListener(this._keyboardListener),this._keyboardListener=null)}}),r.__LAYOUT_COMPONENT_NAME="__ui_layout",r.Widget=r.ProtectedNode.extend({_enabled:!0,_bright:!0,_touchEnabled:!1,_brightStyle:null,_touchBeganPosition:null,_touchMovePosition:null,_touchEndPosition:null,_touchEventListener:null,_touchEventSelector:null,_name:"default",_widgetType:null,_actionTag:0,_customSize:null,_layoutParameterDictionary:null,_layoutParameterType:0,_focused:!1,_focusEnabled:!0,_ignoreSize:!1,_affectByClipping:!1,_sizeType:null,_sizePercent:null,_positionType:null,_positionPercent:null,_hit:!1,_nodes:null,_touchListener:null,_className:"Widget",_flippedX:!1,_flippedY:!1,_opacity:255,_highlight:!1,_touchEventCallback:null,_clickEventListener:null,_propagateTouchEvents:!0,_unifySize:!1,_callbackName:null,_callbackType:null,_usingLayoutComponent:!1,_inViewRect:!0,ctor:function(){n.ProtectedNode.prototype.ctor.call(this),_.call(this),this._brightStyle=r.Widget.BRIGHT_STYLE_NONE,this._touchBeganPosition=n.p(0,0),this._touchMovePosition=n.p(0,0),this._touchEndPosition=n.p(0,0),this._widgetType=r.Widget.TYPE_WIDGET,this._customSize=n.size(0,0),this._layoutParameterDictionary={},this._sizeType=r.Widget.SIZE_ABSOLUTE,this._sizePercent=n.p(0,0),this._positionType=r.Widget.POSITION_ABSOLUTE,this._positionPercent=n.p(0,0),this._nodes=[],this._layoutParameterType=r.LayoutParameter.NONE,this.init()},init:function(){return n.ProtectedNode.prototype.init.call(this)?(this._layoutParameterDictionary={},this._initRenderer(),this.setBright(!0),this.onFocusChanged=this.onFocusChange.bind(this),this.onNextFocusedWidget=null,this.setAnchorPoint(n.p(.5,.5)),this.ignoreContentAdaptWithSize(!0),!0):!1},onEnter:function(){var t=this._touchListener;t&&!t._isRegistered()&&this._touchEnabled&&n.eventManager.addListener(t,this),this._usingLayoutComponent||this.updateSizeAndPosition(),
n.ProtectedNode.prototype.onEnter.call(this)},onExit:function(){this.unscheduleUpdate(),n.ProtectedNode.prototype.onExit.call(this)},_getOrCreateLayoutComponent:function(){var t=this.getComponent(r.__LAYOUT_COMPONENT_NAME);return null==t&&(t=new r.LayoutComponent,this.addComponent(t)),t},getWidgetParent:function(){var t=this.getParent();return t instanceof r.Widget?t:null},_updateContentSizeWithTextureSize:function(t){return this._unifySize?void this.setContentSize(t):void this.setContentSize(this._ignoreSize?t:this._customSize)},_isAncestorsEnabled:function(){var t=this._getAncensterWidget(this);return null==t?!0:t&&!t.isEnabled()?!1:t._isAncestorsEnabled()},setPropagateTouchEvents:function(t){this._propagateTouchEvents=t},isPropagateTouchEvents:function(){return this._propagateTouchEvents},setSwallowTouches:function(t){this._touchListener&&this._touchListener.setSwallowTouches(t)},isSwallowTouches:function(){return this._touchListener?this._touchListener.isSwallowTouches():!1},_getAncensterWidget:function(t){if(null==t)return null;var e=t.getParent();return null==e?null:e instanceof r.Widget?e:this._getAncensterWidget(e.getParent())},_isAncestorsVisible:function(t){if(null==t)return!0;var e=t.getParent();return e&&!e.isVisible()?!1:this._isAncestorsVisible(e)},_cleanupWidget:function(){this._eventDispatcher.removeEventListener(this._touchListener),this._touchEnabled=!1,this._touchListener=null,r.Widget._focusedWidget===this&&(r.Widget._focusedWidget=null,r.Widget._focusNavigationController=null)},setEnabled:function(t){this._enabled=t},_initRenderer:function(){},setContentSize:function(t,e){var i=void 0===e?t.width:t,n=void 0===e?t.height:e;if(_ccsg.Node.prototype.setContentSize.call(this,i,n),this._customSize.width=i,this._customSize.height=n,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var r=this.getWidgetParent(),s=r?r.getContentSize():this._parent.getContentSize();this._sizePercent.x=s.width>0?i/s.width:0,this._sizePercent.y=s.height>0?n/s.height:0}this._onSizeChanged()},_setWidth:function(t){if(_ccsg.Node.prototype._setWidth.call(this,t),this._customSize.width=t,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var e=this.getWidgetParent(),i=e?e.width:this._parent.width;this._sizePercent.x=i>0?this._customSize.width/i:0}this._onSizeChanged()},_setHeight:function(t){if(_ccsg.Node.prototype._setHeight.call(this,t),this._customSize.height=t,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var e=this.getWidgetParent(),i=e?e.height:this._parent.height;this._sizePercent.y=i>0?this._customSize.height/i:0}this._onSizeChanged()},setSizePercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();return e.setUsingPercentContentSize(!0),e.setPercentContentSize(t),void e.refreshLayout()}this._sizePercent.x=t.x,this._sizePercent.y=t.y;var i=this._customSize.width,n=this._customSize.height;if(this._running){var r=this.getWidgetParent();r?(i=r.width*t.x,n=r.height*t.y):(i=this._parent.width*t.x,n=this._parent.height*t.y)}this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(i,n),this._customSize.width=i,this._customSize.height=n},_setWidthPercent:function(t){this._sizePercent.x=t;var e=this._customSize.width;if(this._running){var i=this.getWidgetParent();e=(i?i.width:this._parent.width)*t}this._setWidth(this._ignoreSize?this.getVirtualRendererSize().width:e),this._customSize.width=e},_setHeightPercent:function(t){this._sizePercent.y=t;var e=this._customSize.height;if(this._running){var i=this.getWidgetParent();e=(i?i.height:this._parent.height)*t}this._setHeight(this._ignoreSize?this.getVirtualRendererSize().height:e),this._customSize.height=e},updateSizeAndPosition:function(t){if(!t){var e=this.getWidgetParent();t=e?e.getLayoutSize():this._parent.getContentSize()}switch(this._sizeType){case r.Widget.SIZE_ABSOLUTE:this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():this._customSize),this._sizePercent.x=t.width>0?this._customSize.width/t.width:0,this._sizePercent.y=t.height>0?this._customSize.height/t.height:0;break;case r.Widget.SIZE_PERCENT:var i=n.size(t.width*this._sizePercent.x,t.height*this._sizePercent.y);this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():i),this._customSize.width=i.width,this._customSize.height=i.height}this._onSizeChanged();var s=this.getPosition();switch(this._positionType){case r.Widget.POSITION_ABSOLUTE:t.width<=0||t.height<=0?this._positionPercent.x=this._positionPercent.y=0:(this._positionPercent.x=s.x/t.width,this._positionPercent.y=s.y/t.height);break;case r.Widget.POSITION_PERCENT:s=n.p(t.width*this._positionPercent.x,t.height*this._positionPercent.y)}if(this._parent instanceof r.ImageView){var o=this._parent._imageRenderer;if(o&&!o._textureLoaded)return}this.setPosition(s)},setSizeType:function(t){if(this._sizeType=t,this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setUsingPercentContentSize(this._sizeType===r.SIZE_PERCENT)}},getSizeType:function(){return this._sizeType},ignoreContentAdaptWithSize:function(t){return this._unifySize?void this.setContentSize(this._customSize):void(this._ignoreSize!==t&&(this._ignoreSize=t,this.setContentSize(t?this.getVirtualRendererSize():this._customSize)))},isIgnoreContentAdaptWithSize:function(){return this._ignoreSize},getCustomSize:function(){return n.size(this._customSize)},getLayoutSize:function(){return n.size(this._contentSize)},getSizePercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._sizePercent=t.getPercentContentSize()}return this._sizePercent},_getWidthPercent:function(){return this._sizePercent.x},_getHeightPercent:function(){return this._sizePercent.y},getWorldPosition:function(){return this.convertToWorldSpace(n.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},getVirtualRenderer:function(){return this},getVirtualRendererSize:function(){return n.size(this._contentSize)},_onSizeChanged:function(){if(!this._usingLayoutComponent)for(var t=this.getChildren(),e=0,i=t.length;i>e;e++){var n=t[e];n instanceof r.Widget&&n.updateSizeAndPosition()}},setTouchEnabled:function(t){this._touchEnabled!==t&&(this._touchEnabled=t,this._touchEnabled?(this._touchListener||(this._touchListener=n.EventListener.create({event:n.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)})),n.eventManager.addListener(this._touchListener,this)):n.eventManager.removeListener(this._touchListener))},isTouchEnabled:function(){return this._touchEnabled},isHighlighted:function(){return this._highlight},setHighlighted:function(t){t!==this._highlight&&(this._highlight=t,this._bright?this.setBrightStyle(this._highlight?r.Widget.BRIGHT_STYLE_HIGH_LIGHT:r.Widget.BRIGHT_STYLE_NORMAL):this._onPressStateChangedToDisabled())},isFocused:function(){return this._focused},setFocused:function(t){this._focused=t,t&&(r.Widget._focusedWidget=this,r.Widget._focusNavigationController&&r.Widget._focusNavigationController._setFirstFocsuedWidget(this))},isFocusEnabled:function(){return this._focusEnabled},setFocusEnabled:function(t){this._focusEnabled=t},findNextFocusedWidget:function(t,e){if(null===this.onNextFocusedWidget||null==this.onNextFocusedWidget(t)){var i=e instanceof r.Layout;if(this.isFocused()||i){var n=this.getParent();return null!==n&&n instanceof r.Layout?n.findNextFocusedWidget(t,e):i?e.findNextFocusedWidget(t,e):e}return e}var s=this.onNextFocusedWidget(t);return this.dispatchFocusEvent(this,s),s},requestFocus:function(){this!==r.Widget._focusedWidget&&this.dispatchFocusEvent(r.Widget._focusedWidget,this)},getCurrentFocusedWidget:function(){return r.Widget._focusedWidget},onFocusChanged:null,onNextFocusedWidget:null,onFocusChange:function(t,e){t&&t.setFocused(!1),e&&e.setFocused(!0)},dispatchFocusEvent:function(t,e){t&&!t.isFocused()&&(t=r.Widget._focusedWidget),e!==t&&(e&&e.onFocusChanged&&e.onFocusChanged(t,e),t&&e.onFocusChanged&&t.onFocusChanged(t,e),n.eventManager.dispatchEvent(new n.Event.EventFocus(t,e)))},setBright:function(t){this._bright=t,this._bright?(this._brightStyle=r.Widget.BRIGHT_STYLE_NONE,this.setBrightStyle(r.Widget.BRIGHT_STYLE_NORMAL)):this._onPressStateChangedToDisabled()},setBrightStyle:function(t){if(this._brightStyle!==t)switch(t=t||r.Widget.BRIGHT_STYLE_NORMAL,this._brightStyle=t,this._brightStyle){case r.Widget.BRIGHT_STYLE_NORMAL:this._onPressStateChangedToNormal();break;case r.Widget.BRIGHT_STYLE_HIGH_LIGHT:this._onPressStateChangedToPressed()}},_onPressStateChangedToNormal:function(){},_onPressStateChangedToPressed:function(){},_onPressStateChangedToDisabled:function(){},_updateChildrenDisplayedRGBA:function(){this.setColor(this.getColor()),this.setOpacity(this.getOpacity())},didNotSelectSelf:function(){},_isTargetActive:function(t){return t===n.Event.TOUCH?this._enabled&&this._touchEnabled:t===n.Event.FOCUS?this._enabled&&this._focusEnabled:this._enabled},_getBubblingTargets:function(t,e){for(var i=this.getWidgetParent();i;)i.hasEventListener(t)&&e.push(i),i=i.getWidgetParent()},onTouchBegan:function(t,e){if(this._hit=!1,this.isVisible()&&this.isEnabled()&&this._isAncestorsEnabled()&&this._isAncestorsVisible(this)){var i=t.getLocation();this._touchBeganPosition.x=i.x,this._touchBeganPosition.y=i.y,this.hitTest(this._touchBeganPosition)&&this.isClippingParentContainsPoint(this._touchBeganPosition)&&(this._hit=!0)}return this._hit?(this.setHighlighted(!0),this._propagateTouchEvents&&(e._widgetEventType=r.Widget.TOUCH_BEGAN,this.dispatchEvent(e)),this._pushDownEvent(),!0):!1},onTouchMoved:function(t,e){var i=t.getLocation();this._touchMovePosition.x=i.x,this._touchMovePosition.y=i.y,this.setHighlighted(this.hitTest(i)),this._propagateTouchEvents&&(e._widgetEventType=r.Widget.TOUCH_MOVED,this.dispatchEvent(e)),this._moveEvent()},onTouchEnded:function(t,e){var i=t.getLocation();this._touchEndPosition.x=i.x,this._touchEndPosition.y=i.y,this._propagateTouchEvents&&(e._widgetEventType=r.Widget.TOUCH_ENDED,this.dispatchEvent(e));var n=this._highlight;this.setHighlighted(!1),n?this._releaseUpEvent():this._cancelUpEvent()},onTouchCancelled:function(t){this.setHighlighted(!1),this._cancelUpEvent()},onTouchLongClicked:function(t){this.longClickEvent()},_pushDownEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,r.Widget.TOUCH_BEGAN),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,r.Widget.TOUCH_BEGAN)},_moveEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,r.Widget.TOUCH_MOVED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,r.Widget.TOUCH_MOVED)},_releaseUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,r.Widget.TOUCH_ENDED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,r.Widget.TOUCH_ENDED),this._clickEventListener&&this._clickEventListener(this)},_cancelUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,r.Widget.TOUCH_CANCELED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,r.Widget.TOUCH_CANCELED)},longClickEvent:function(){},addTouchEventListener:function(t,e){void 0===e?this._touchEventCallback=t:(this._touchEventSelector=t,this._touchEventListener=e)},addClickEventListener:function(t){this._clickEventListener=t},hitTest:function(t){var e=n.rect(0,0,this._contentSize.width,this._contentSize.height);return n.rectContainsPoint(e,this.convertToNodeSpace(t))},isClippingParentContainsPoint:function(t){this._affectByClipping=!1;for(var e=this.getParent(),i=null;e;){if(e instanceof r.Layout&&e.isClippingEnabled()){this._affectByClipping=!0,i=e;break}e=e.getParent()}return this._affectByClipping&&i?i.hitTest(t)?i.isClippingParentContainsPoint(t):!1:!0},checkChildInfo:function(t,e,i){var n=this.getWidgetParent();n&&n.checkChildInfo(t,e,i)},setPosition:function(t,e){if(!this._usingLayoutComponent&&this._running){var i=this.getWidgetParent();if(i){var n=i.getContentSize();n.width<=0||n.height<=0?(this._positionPercent.x=0,this._positionPercent.y=0):void 0===e?(this._positionPercent.x=t.x/n.width,this._positionPercent.y=t.y/n.height):(this._positionPercent.x=t/n.width,this._positionPercent.y=e/n.height)}}_ccsg.Node.prototype.setPosition.call(this,t,e)},setPositionX:function(t){if(this._running){var e=this.getWidgetParent();if(e){var i=e.width;this._positionPercent.x=0>=i?0:t/i}}_ccsg.Node.prototype.setPositionX.call(this,t)},setPositionY:function(t){if(this._running){var e=this.getWidgetParent();if(e){var i=e.height;this._positionPercent.y=0>=i?0:t/i}}_ccsg.Node.prototype.setPositionY.call(this,t)},setPositionPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();return e.setPositionPercentX(t.x),e.setPositionPercentY(t.y),void e.refreshLayout()}this._setXPercent(t.x),this._setYPercent(t.y),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},_setXPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();return e.setPositionPercentX(t.x),void e.refreshLayout()}this._positionPercent.x=t},_setYPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();return e.setPositionPercentY(t.x),void e.refreshLayout()}this._positionPercent.y=t},getPositionPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return n.p(this._positionPercent)},_getXPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return this._positionPercent.x},_getYPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return this._positionPercent.y},setPositionType:function(t){if(this._positionType=t,this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();t===r.POSITION_ABSOLUTE?(e.setPositionPercentXEnabled(!1),e.setPositionPercentYEnabled(!1)):(e.setPositionPercentXEnabled(!0),e.setPositionPercentYEnabled(!0))}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPositionType:function(){return this._positionType},setFlippedX:function(t){var e=this.getScaleX();this._flippedX=t,this.setScaleX(e)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t,this.setScaleY(e)},isFlippedY:function(){return this._flippedY},_adaptRenderers:function(){},isBright:function(){return this._bright},isEnabled:function(){return this._enabled},getLeftBoundary:function(){return this.getPositionX()-this._getAnchorX()*this._contentSize.width},getBottomBoundary:function(){return this.getPositionY()-this._getAnchorY()*this._contentSize.height},getRightBoundary:function(){return this.getLeftBoundary()+this._contentSize.width},getTopBoundary:function(){return this.getBottomBoundary()+this._contentSize.height},getTouchBeganPosition:function(){return n.p(this._touchBeganPosition)},getTouchMovePosition:function(){return n.p(this._touchMovePosition)},getTouchEndPosition:function(){return n.p(this._touchEndPosition)},getWidgetType:function(){return this._widgetType},setLayoutParameter:function(t){t&&(this._layoutParameterDictionary[t.getLayoutType()]=t,this._layoutParameterType=t.getLayoutType())},getLayoutParameter:function(t){return t=t||this._layoutParameterType,this._layoutParameterDictionary[t]},getDescription:function(){return"Widget"},clone:function(){var t=this._createCloneInstance();return t._copyProperties(this),t._copyClonedWidgetChildren(this),t},_createCloneInstance:function(){return new r.Widget},_copyClonedWidgetChildren:function(t){for(var e=t.getChildren(),i=0;i<e.length;i++){var n=e[i];n instanceof r.Widget&&this.addChild(n.clone())}},_copySpecialProperties:function(t){},_copyProperties:function(t){this.setEnabled(t.isEnabled()),this.setVisible(t.isVisible()),this.setBright(t.isBright()),this.setTouchEnabled(t.isTouchEnabled()),this.setLocalZOrder(t.getLocalZOrder()),this.setTag(t.getTag()),this.setName(t.getName()),this.setActionTag(t.getActionTag()),this._ignoreSize=t._ignoreSize,this.setContentSize(t._contentSize),this._customSize.width=t._customSize.width,this._customSize.height=t._customSize.height,this._copySpecialProperties(t),this._sizeType=t.getSizeType(),this._sizePercent.x=t._sizePercent.x,this._sizePercent.y=t._sizePercent.y,this._positionType=t._positionType,this._positionPercent.x=t._positionPercent.x,this._positionPercent.y=t._positionPercent.y,this.setPosition(t.getPosition()),this.setAnchorPoint(t.getAnchorPoint()),this.setScaleX(t.getScaleX()),this.setScaleY(t.getScaleY()),this.setRotation(t.getRotation()),this.setRotationX(t.getRotationX()),this.setRotationY(t.getRotationY()),this.setFlippedX(t.isFlippedX()),this.setFlippedY(t.isFlippedY()),this.setColor(t.getColor()),this.setOpacity(t.getOpacity()),this._touchEventCallback=t._touchEventCallback,this._touchEventListener=t._touchEventListener,this._touchEventSelector=t._touchEventSelector,this._clickEventListener=t._clickEventListener,this._focused=t._focused,this._focusEnabled=t._focusEnabled,this._propagateTouchEvents=t._propagateTouchEvents;for(var e in t._layoutParameterDictionary){var i=t._layoutParameterDictionary[e];i&&this.setLayoutParameter(i.clone())}this._onSizeChanged()},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},getLeftInParent:function(){return n.log("getLeftInParent is deprecated. Please use getLeftBoundary instead."),this.getLeftBoundary()},getBottomInParent:function(){return n.log("getBottomInParent is deprecated. Please use getBottomBoundary instead."),this.getBottomBoundary()},getRightInParent:function(){return n.log("getRightInParent is deprecated. Please use getRightBoundary instead."),this.getRightBoundary()},getTopInParent:function(){return n.log("getTopInParent is deprecated. Please use getTopBoundary instead."),this.getTopBoundary()},getTouchEndPos:function(){return n.log("getTouchEndPos is deprecated. Please use getTouchEndPosition instead."),this.getTouchEndPosition()},getTouchMovePos:function(){return n.log("getTouchMovePos is deprecated. Please use getTouchMovePosition instead."),this.getTouchMovePosition()},clippingParentAreaContainPoint:function(t){n.log("clippingParentAreaContainPoint is deprecated. Please use isClippingParentContainsPoint instead."),this.isClippingParentContainsPoint(t)},getTouchStartPos:function(){return n.log("getTouchStartPos is deprecated. Please use getTouchBeganPosition instead."),this.getTouchBeganPosition()},setSize:function(t){this.setContentSize(t)},getSize:function(){return this.getContentSize()},addNode:function(t,e,i){return t instanceof r.Widget?void n.log("Please use addChild to add a Widget."):(_ccsg.Node.prototype.addChild.call(this,t,e,i),void this._nodes.push(t))},getNodeByTag:function(t){for(var e=this._nodes,i=0;i<e.length;i++){var n=e[i];if(n&&n.getTag()===t)return n}return null},getNodes:function(){return this._nodes},removeNode:function(t,e){_ccsg.Node.prototype.removeChild.call(this,t,e),n.js.array.remove(this._nodes,t)},removeNodeByTag:function(t,e){var i=this.getChildByTag(t);i?this.removeChild(i,e):n.log("cocos2d: removeNodeByTag(tag = %d): child not found!",t)},removeAllNodes:function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t];_ccsg.Node.prototype.removeChild.call(this,e)}this._nodes.length=0},_findLayout:function(){n.renderer.childrenOrderDirty=!0;for(var t=this._parent;t;){if(t._doLayout){t._doLayoutDirty=!0;break}t=t._parent}},isUnifySizeEnabled:function(){return this._unifySize},setUnifySizeEnabled:function(t){this._unifySize=t},_ccEventCallback:null,addCCSEventListener:function(t){this._ccEventCallback=t},setScaleX:function(t){this._flippedX&&(t=-1*t),_ccsg.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._flippedY&&(t=-1*t),_ccsg.Node.prototype.setScaleY.call(this,t)},setScale:function(t,e){void 0===e&&(e=t),this.setScaleX(t),this.setScaleY(e)},getScaleX:function(){var t=_ccsg.Node.prototype.getScaleX.call(this);return this._flippedX&&(t=-1*t),t},getScaleY:function(){var t=_ccsg.Node.prototype.getScaleY.call(this);return this._flippedY&&(t=-1*t),t},getScale:function(){return this.getScaleX()!==this.getScaleY()&&n.log("Widget#scale. ScaleX != ScaleY. Don't know which one to return"),this.getScaleX()},setCallbackName:function(t){this._callbackName=t},getCallbackName:function(){return this._callbackName},setCallbackType:function(t){this._callbackType=t},getCallbackType:function(){return this._callbackType},setLayoutComponentEnabled:function(t){this._usingLayoutComponent=t},isLayoutComponentEnabled:function(){return this._usingLayoutComponent},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_WEBGL?new r.Widget.WebGLRenderCmd(this):new r.Widget.CanvasRenderCmd(this)}});var c=r.Widget.prototype;c.xPercent,n.defineGetterSetter(c,"xPercent",c._getXPercent,c._setXPercent),c.yPercent,n.defineGetterSetter(c,"yPercent",c._getYPercent,c._setYPercent),c.widthPercent,n.defineGetterSetter(c,"widthPercent",c._getWidthPercent,c._setWidthPercent),c.heightPercent,n.defineGetterSetter(c,"heightPercent",c._getHeightPercent,c._setHeightPercent),c.widgetParent,n.defineGetterSetter(c,"widgetParent",c.getWidgetParent),c.enabled,n.defineGetterSetter(c,"enabled",c.isEnabled,c.setEnabled),c.focused,n.defineGetterSetter(c,"focused",c.isFocused,c.setFocused),c.sizeType,n.defineGetterSetter(c,"sizeType",c.getSizeType,c.setSizeType),c.widgetType,n.defineGetterSetter(c,"widgetType",c.getWidgetType),c.touchEnabled,n.defineGetterSetter(c,"touchEnabled",c.isTouchEnabled,c.setTouchEnabled),c.updateEnabled,n.defineGetterSetter(c,"updateEnabled",c.isUpdateEnabled,c.setUpdateEnabled),c.bright,n.defineGetterSetter(c,"bright",c.isBright,c.setBright),c.name,n.defineGetterSetter(c,"name",c.getName,c.setName),c.actionTag,n.defineGetterSetter(c,"actionTag",c.getActionTag,c.setActionTag),c.opacity,n.defineGetterSetter(c,"opacity",c.getOpacity,c.setOpacity),c=null,r.Widget.create=function(){return new r.Widget},n.js.addon(r.Widget.prototype,_.prototype),r.Widget._focusedWidget=null,r.Widget._focusNavigationController=null,r.Widget.enableDpadNavigation=function(t){t?(null==r.Widget._focusNavigationController&&(r.Widget._focusNavigationController=new r._FocusNavigationController,r.Widget._focusedWidget&&r.Widget._focusNavigationController._setFirstFocsuedWidget(r.Widget._focusedWidget)),r.Widget._focusNavigationController.enableFocusNavigation(!0)):r.Widget._focusNavigationController&&(r.Widget._focusNavigationController.enableFocusNavigation(!1),r.Widget._focusNavigationController=null)},r.Widget.getCurrentFocusedWidget=function(){return r.Widget._focusedWidget},r.Widget.BRIGHT_STYLE_NONE=-1,r.Widget.BRIGHT_STYLE_NORMAL=0,r.Widget.BRIGHT_STYLE_HIGH_LIGHT=1,r.Widget.TYPE_WIDGET=0,r.Widget.TYPE_CONTAINER=1,r.Widget.LEFT=0,r.Widget.RIGHT=1,r.Widget.UP=2,r.Widget.DOWN=3,r.Widget.LOCAL_TEXTURE=0,r.Widget.PLIST_TEXTURE=1,r.Widget.TOUCH_BEGAN="widget_touch_began",r.Widget.TOUCH_MOVED="widget_touch_moved",r.Widget.TOUCH_ENDED="widget_touch_ended",r.Widget.TOUCH_CANCELED="widget_touch_canceled",r.Widget.SIZE_ABSOLUTE=0,r.Widget.SIZE_PERCENT=1,r.Widget.POSITION_ABSOLUTE=0,r.Widget.POSITION_PERCENT=1,n.game.once(n.game.EVENT_RENDERER_INITED,function(){if(n._renderType===n.game.RENDER_TYPE_CANVAS){r.Widget.CanvasRenderCmd=function(t){n.ProtectedNode.CanvasRenderCmd.call(this,t),this._needDraw=!1};var t=r.Widget.CanvasRenderCmd.prototype=Object.create(n.ProtectedNode.CanvasRenderCmd.prototype);t.constructor=r.Widget.CanvasRenderCmd,t.visit=function(t){var e=this._node;e._visible&&(e._adaptRenderers(),n.ProtectedNode.CanvasRenderCmd.prototype.visit.call(this,t))},t.transform=function(t,e){var i=this._node;if(i._visible){if(i._adaptRenderers(),!this._usingLayoutComponent){var r=i.getWidgetParent();if(r){var s=r.getContentSize();0!==s.width&&0!==s.height&&(i._position.x=s.width*i._positionPercent.x,i._position.y=s.height*i._positionPercent.y)}}n.ProtectedNode.CanvasRenderCmd.prototype.transform.call(this,t,e)}}}else{r.Widget.WebGLRenderCmd=function(t){n.ProtectedNode.WebGLRenderCmd.call(this,t),this._needDraw=!1};var t=r.Widget.WebGLRenderCmd.prototype=Object.create(n.ProtectedNode.WebGLRenderCmd.prototype);t.constructor=r.Widget.WebGLRenderCmd,t.visit=function(t){var e=this._node;e._visible&&(e._adaptRenderers(),n.ProtectedNode.WebGLRenderCmd.prototype.visit.call(this,t))},t.transform=function(t,e){var i=this._node;if(i._visible){if(i._adaptRenderers(),!this._usingLayoutComponent){var r=i.getWidgetParent();if(r){var s=r.getContentSize();0!==s.width&&0!==s.height&&(i._position.x=s.width*i._positionPercent.x,i._position.y=s.height*i._positionPercent.y)}}n.ProtectedNode.WebGLRenderCmd.prototype.transform.call(this,t,e)}}}}),_=t("../cocos2d/core/event/event-target"),r.Scale9Sprite=n.Scale9Sprite=_ccsg.Node.extend({_textureInited:!1,_spriteRect:null,_spriteFrameRotated:!1,_derivedCapInsets:null,_scale9Image:null,_scale9Enabled:!0,_blendFunc:null,_originalSize:null,_preferredSize:null,_insetLeft:0,_insetTop:0,_insetRight:0,_insetBottom:0,_flippedX:!1,_flippedY:!1,_isPatch9:!1,_brightState:0,_nonSliceSpriteAnchor:null,_textureLoaded:!1,_renderingType:1,_quads:[],_quadsDirty:!0,ctor:function(t,e,i){if(_ccsg.Node.prototype.ctor.call(this),_.call(this),this._nonSliceSpriteAnchor=n.p(.5,.5),this._originalSize=n.size(0,0),this._preferredSize=n.rect(0,0,0,0),this._spriteRect=n.rect(0,0,0,0),this._blendFunc=n.BlendFunc._disable(),this.setAnchorPoint(n.p(.5,.5)),void 0!=t)if(t instanceof n.SpriteFrame)this.initWithSpriteFrame(t,e);else{var r=n.spriteFrameCache.getSpriteFrame(t);r?this.initWithSpriteFrame(r,e):this.initWithFile(t,e,i)}else this.init()},textureLoaded:function(){return this._textureLoaded},initWithFile:function(t,e,i){if(t instanceof n.Rect&&(i=t,t=e),e=e||n.rect(0,0,0,0),!t)throw new Error("ccui.Scale9Sprite.initWithFile(): file should be non-null");var r=n.Sprite.create(t,e);this.init(r,e,i)},initWithSpriteFrame:function(t,e){if(!t||!t.getTexture())throw new Error("ccui.Scale9Sprite.initWithSpriteFrame(): spriteFrame should be non-null and its texture should be non-null");var i=t.textureLoaded();void 0!==e&&(this._derivedCapInsets=e),this._textureLoaded=!1;var r=function(){var e=n.Sprite.createWithSpriteFrame(t);this._onScale9ResourcesLoaded(e,t.isRotated(),t.getRect(),t.getOriginalSize())};i?r.call(this):t.once("load",r,this)},initWithSpriteFrameName:function(t,e){if(!t)throw new Error("ccui.Scale9Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null");var i=n.spriteFrameCache.getSpriteFrame(t);return i?this.initWithSpriteFrame(i,e):(n.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),!1)},init:function(t,e,i,r,s,o){return null===t?!0:(t=t||null,e=e||n.rect(0,0,0,0),i=i||!1,r=r||n.p(0,0),s=s||n.size(e.width,e.height),i instanceof n.Rect&&(o=arguments[2],i=!1),r instanceof n.Rect&&(o=arguments[3],r=n.p(0,0)),this.updateWithSprite(t,e,i,r,s,o),!0)},setBlendFunc:function(t){this._blendFunc.src=t.src,this._blendFunc.dst=t.dst,this._applyBlendFunc()},getBlendFunc:function(){return new n.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},resizableSpriteWithCapInsets:function(t){return result=new n.Scale9Sprite,result.init(this._scale9Image,this._spriteRect,this._spriteFrameRotated,n.rect(0,0,0,0),this._originalSize,t),result},_onScale9ResourcesLoaded:function(t,e,i,r){this._spriteFrameRotated=e,this._textureLoaded=!0;var s=this.getOpacity(),o=this.getColor();this._updateBlendFunc(t.getTexture()),this._scale9Image=t,this._scale9Image.setAnchorPoint(n.p(0,0)),this._scale9Image.setPosition(n.p(0,0)),this._spriteRect.equals(n.rect(0,0,0,0))&&(this._spriteRect=n.rect(i)),n.sizeEqualToSize(this._originalSize,n.size(0,0))&&(this._originalSize=n.size(r)),n.sizeEqualToSize(this._preferredSize,n.size(0,0))&&this.setPreferredSize(this._originalSize),this._scale9Enabled||(this.addChild(this._scale9Image),this._adjustScale9ImagePosition()),this._applyBlendFunc(),this.setState(this._brightState),this._textureInited&&(this.setOpacity(s),this.setColor(o)),this._textureInited=!0,this._derivedCapInsets&&(this._insetLeft=this._derivedCapInsets.x,this._insetTop=this._derivedCapInsets.y,this._insetRight=this._originalSize.width-this._insetLeft-this._derivedCapInsets.width,this._insetBottom=this._originalSize.height-this._insetTop-this._derivedCapInsets.height,this._derivedCapInsets=null),this._quadsDirty=!0},updateWithSprite:function(t,e,i,r,s,o){if(r instanceof n.Rect&&(o=arguments[3],r=n.size(0,0),s=n.size(e.width,e.height)),this._spriteRect=n.rect(e),this._spriteFrameRotated=i,this._originalSize=s,void 0!==o&&(this._derivedCapInsets=o),this._textureLoaded=!1,null===t)return this._quadsDirty=!0,!0;var a=t.textureLoaded(),c=function(){var e=t.getTexture().getContentSize();this._onScale9ResourcesLoaded(t,i,n.rect(0,0,e.width,e.height),e)};if(a)c.call(this);else{var h=t.getTexture();h&&h.once("load",c,this)}return!0},setSpriteFrame:function(t,e){var i=n.Sprite.createWithTexture(t.getTexture());this.updateWithSprite(i,t.getRect(),t.isRotated(),t.getOffset(),t.getOriginalSize(),e)},setContentSize:function(t){n.sizeEqualToSize(this._contentSize,t)||(_ccsg.Node.prototype.setContentSize.call(this,t),this._preferredSize=t,this._quadsDirty=!0,this._adjustScale9ImagePosition())},setAnchorPoint:function(t){_ccsg.Node.prototype.setAnchorPoint.call(this,t),this._scale9Enabled||null!==this._scale9Image&&(this._nonSliceSpriteAnchor=t,this._scale9Image.setAnchorPoint(t),this._adjustScale9ImagePosition())},setState:function(t){this._brightState=t,this._renderCmd.setState(t)},getState:function(){return this._brightState},getOriginalSize:function(){return n.size(this._originalSize)},setPreferredSize:function(t){return this.setContentSize(t)},getPreferredSize:function(){return n.size(this._preferredSize)},setRenderingType:function(t){this._renderingType!=t&&(this._renderingType=t,this._quadsDirty=!0)},setCapInsets:function(t){this._textureLoaded?(this._quadsDirty=!0,this._insetLeft=t.x,this._insetTop=t.y,this._insetRight=this._originalSize.width-this._insetLeft-t.width,this._insetBottom=this._originalSize.height-this._insetTop-t.height):n.log("Can not set capinset when resource is loading")},getCapInsets:function(){return n.rect(this._insetLeft,this._insetTop,this._originalSize.width-this._insetLeft-this._insetRight,this._originalSize.height-this._insetTop-this._insetBottom)},setInsetLeft:function(t){this._insetLeft=t,this._quadsDirty=!0},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(t){this._insetTop=t,this._quadsDirty=!0},getInsetTop:function(){return this._insetTop},setInsetRight:function(t){this._insetRight=t,this._quadsDirty=!0},getInsetRight:function(){return this._insetRight},setInsetBottom:function(t){this._insetBottom=t,this._quadsDirty=!0},getInsetBottom:function(){return this._insetBottom},setScale9Enabled:function(t){this._scale9Enabled!=t&&(this._scale9Enabled=t,this._scale9Image&&(this._scale9Enabled?this.removeChild(this._scale9Image):(this.addChild(this._scale9Image),this._adjustScale9ImagePosition())),this._quadsDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},getSprite:function(){return this._scale9Image},setFlippedX:function(t){
var e=this.getScaleX();this._flippedX=t,this.setScaleX(e)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t,this.setScaleY(e)},isFlippedY:function(){return this._flippedY},setScaleX:function(t){this._flippedX&&(t=-1*t),_ccsg.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._flippedY&&(t=-1*t),_ccsg.Node.prototype.setScaleY.call(this,t)},setScale:function(t,e){void 0===e&&(e=t),this.setScaleX(t),this.setScaleY(e)},getScaleX:function(){var t=_ccsg.Node.prototype.getScaleX.call(this);return this._flippedX&&(t=-1*t),t},getScaleY:function(){var t=_ccsg.Node.prototype.getScaleY.call(this);return this._flippedY&&(t=-1*t),t},getScale:function(){return this.getScaleX()},setCameraMask:function(t,e){_ccsg.Node.prototype.setCameraMask.call(this,t,e),this._scale9Image&&this._scale9Image.setCameraMask(t,e)},_adjustScale9ImagePosition:function(){this._scale9Image&&(this._scale9Enabled||(this._scale9Image.setAnchorPoint(this._nonSliceSpriteAnchor),this._scale9Image.setPosition(this._contentSize.width*this._scale9Image.getAnchorPoint().x,this._contentSize.height*this._scale9Image.getAnchorPoint().y)))},_applyBlendFunc:function(){null!=this._scale9Image&&this._scale9Image.setBlendFunc(this._blendFunc)},_updateBlendFunc:function(t){t&&t.hasPremultipliedAlpha()?(this._blendFunc=n.BlendFunc._alphaPremultiplied(),this.setOpacityModifyRGB(!0)):(this._blendFunc=n.BlendFunc._alphaNonPremultiplied(),this.setOpacityModifyRGB(!1))},_buildQuads:function(){if(this._scale9Enabled){var t=null;if(null!=this._scale9Image&&(t=this._scale9Image.getTexture()),null==t)return;var e=n.rectPointsToPixels(this.getCapInsets()),i=(n.rectPointsToPixels(this._spriteRect),n.sizePointsToPixels(this._originalSize));this._isPatch9&&(i=n.size(i.width-2,i.height-2)),e.equals(n.rect(0,0,0,0))&&(e=n.rect(i.width/3,i.height/3,i.width/3,i.height/3)),this._calculateQuads(this._calculateUV(t,e,i),this._calculateVertices(e,i))}},_cleanupQuads:function(){this._quads=[]},_calculateUV:function(t,e,i){var r=t.getPixelWidth(),s=t.getPixelHeight(),o=0,a=0,c=0,h=0,l=0,d=0;this._spriteFrameRotated?(c=e.y,a=e.height,o=i.height-a-c,h=e.x,l=e.width,d=i.width-(h+l)):(o=e.x,a=e.width,c=i.width-(o+a),h=e.y,l=e.height,d=i.height-(h+l));var u=n.rectPointsToPixels(this._spriteRect);if(this._isPatch9){var _=1.3;u=n.rect(u.origin.x+_,u.origin.y+_,u.size.width-2,u.size.height-2)}var f,p,g,m,y,v,T,C;this._spriteFrameRotated?(f=u.x/r,p=(o+u.x)/r,g=(o+a+u.x)/r,m=(u.x+u.height)/r,C=u.y/s,T=(h+u.y)/s,v=(h+l+u.y)/s,y=(u.y+u.width)/s):(f=u.x/r,p=(o+u.x)/r,g=(o+a+u.x)/r,m=(u.x+u.width)/r,y=u.y/s,v=(h+u.y)/s,T=(h+l+u.y)/s,C=(u.y+u.height)/s);var S=[];return S.push(n.p(f,C)),S.push(n.p(p,T)),S.push(n.p(g,v)),S.push(n.p(m,y)),S},_calculateVertices:function(t,e){var i=0,r=0,s=0,o=0,a=0,c=0;i=t.x,r=t.width,s=e.width-(i+r),o=t.y,a=t.height,c=e.height-(o+a),i/=n.contentScaleFactor(),s/=n.contentScaleFactor(),o/=n.contentScaleFactor(),c/=n.contentScaleFactor();var h,l,d,u,_,f,p,g,m=this.getPreferredSize(),y=m.width-i-s,v=m.height-o-c;if(y>=0)h=0,l=i,d=i+y,u=m.width;else{var T=m.width/(i+s);h=0,l=d=i*T,u=(i+s)*T}if(v>=0)_=0,f=c,p=c+v,g=m.height;else{var C=m.height/(o+c);_=0,f=p=c*C,g=(c+o)*C}var S=[];return S.push(n.p(h,_)),S.push(n.p(l,f)),S.push(n.p(d,p)),S.push(n.p(u,g)),S},_onColorOpacityDirty:function(){var t=this.getDisplayedColor();t.a=this.getDisplayedOpacity();var e,i=this._quads.length;for(e=0;i>e;++e)this._quads[e]._bl.colors=t,this._quads[e]._br.colors=t,this._quads[e]._tl.colors=t,this._quads[e]._tr.colors=t},_calculateQuads:function(t,e){var i=this.getDisplayedColor();if(i.a=this.getDisplayedOpacity(),this._renderingType==r.Scale9Sprite.RenderingType.SIMPLE){var s=new n.V3F_C4B_T2F_Quad;return s._bl.colors=i,s._br.colors=i,s._tl.colors=i,s._tr.colors=i,s._bl.vertices=new n.Vertex3F(e[0].x,e[0].y,0),s._br.vertices=new n.Vertex3F(e[3].x,e[0].y,0),s._tl.vertices=new n.Vertex3F(e[0].x,e[3].y,0),s._tr.vertices=new n.Vertex3F(e[3].x,e[3].y,0),this._spriteFrameRotated?(s._bl.texCoords=new n.Tex2F(t[0].x,t[0].y),s._br.texCoords=new n.Tex2F(t[0].x,t[3].y),s._tl.texCoords=new n.Tex2F(t[3].x,t[0].y),s._tr.texCoords=new n.Tex2F(t[3].x,t[3].y)):(s._bl.texCoords=new n.Tex2F(t[0].x,t[0].y),s._br.texCoords=new n.Tex2F(t[3].x,t[0].y),s._tl.texCoords=new n.Tex2F(t[0].x,t[3].y),s._tr.texCoords=new n.Tex2F(t[3].x,t[3].y)),void this._quads.push(s)}for(var o=0;3>o;++o)for(var a=0;3>a;++a){var s=new n.V3F_C4B_T2F_Quad;s._bl.colors=i,s._br.colors=i,s._tl.colors=i,s._tr.colors=i,s._bl.vertices=new n.Vertex3F(e[a].x,e[o].y,0),s._br.vertices=new n.Vertex3F(e[a+1].x,e[o].y,0),s._tl.vertices=new n.Vertex3F(e[a].x,e[o+1].y,0),s._tr.vertices=new n.Vertex3F(e[a+1].x,e[o+1].y,0),this._spriteFrameRotated?(s._bl.texCoords=new n.Tex2F(t[o].x,t[a].y),s._br.texCoords=new n.Tex2F(t[o].x,t[a+1].y),s._tl.texCoords=new n.Tex2F(t[o+1].x,t[a].y),s._tr.texCoords=new n.Tex2F(t[a+1].x,t[o+1].y)):(s._bl.texCoords=new n.Tex2F(t[a].x,t[o].y),s._br.texCoords=new n.Tex2F(t[a+1].x,t[o].y),s._tl.texCoords=new n.Tex2F(t[a].x,t[o+1].y),s._tr.texCoords=new n.Tex2F(t[a+1].x,t[o+1].y)),this._quads.push(s)}},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new r.Scale9Sprite.CanvasRenderCmd(this):new r.Scale9Sprite.WebGLRenderCmd(this)}});var c=r.Scale9Sprite.prototype;n.js.addon(c,_.prototype),c.preferredSize,n.defineGetterSetter(c,"preferredSize",c.getPreferredSize,c.setPreferredSize),c.capInsets,n.defineGetterSetter(c,"capInsets",c.getCapInsets,c.setCapInsets),c.insetLeft,n.defineGetterSetter(c,"insetLeft",c.getInsetLeft,c.setInsetLeft),c.insetTop,n.defineGetterSetter(c,"insetTop",c.getInsetTop,c.setInsetTop),c.insetRight,n.defineGetterSetter(c,"insetRight",c.getInsetRight,c.setInsetRight),c.insetBottom,n.defineGetterSetter(c,"insetBottom",c.getInsetBottom,c.setInsetBottom),c=null,r.Scale9Sprite.create=function(t,e,i){return new r.Scale9Sprite(t,e,i)},r.Scale9Sprite.createWithSpriteFrame=function(t,e){return new r.Scale9Sprite(t,e)},r.Scale9Sprite.createWithSpriteFrameName=function(t,e){return new r.Scale9Sprite(t,e)},r.Scale9Sprite.POSITIONS_CENTRE=0,r.Scale9Sprite.POSITIONS_TOP=1,r.Scale9Sprite.POSITIONS_LEFT=2,r.Scale9Sprite.POSITIONS_RIGHT=3,r.Scale9Sprite.POSITIONS_BOTTOM=4,r.Scale9Sprite.POSITIONS_TOPRIGHT=5,r.Scale9Sprite.POSITIONS_TOPLEFT=6,r.Scale9Sprite.POSITIONS_BOTTOMRIGHT=7,r.Scale9Sprite.state={NORMAL:0,GRAY:1},r.Scale9Sprite.RenderingType={SIMPLE:0,SLICE:1},function(){r.Scale9Sprite.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._state=r.Scale9Sprite.state.NORMAL,this._textureToRender=null};var t=r.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=r.Scale9Sprite.CanvasRenderCmd,t._updateDisplayOpacity=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayOpacity.call(this,t);var e=this._node,i=e._scale9Image;if(i){var n=255;e._cascadeOpacityEnabled&&(n=this._displayedOpacity),i._renderCmd._updateDisplayOpacity(n)}},t._updateDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t);var e=this._node,i=e._scale9Image;if(i){var r=n.Color.WHITE;this._cascadeColorEnabled&&(r=e._displayedColor),i._renderCmd._updateDisplayColor(r),i._renderCmd._updateColor()}this._textureToRender=null},t.setState=function(t){if(this._state!==t){var e=this._node._scale9Image;e&&(this._state=t,this._textureToRender=null)}},t.rendering=function(t,e,i){var r=this._node;if(r._scale9Enabled){var s=this._displayedOpacity,o=s/255,a=null;if(r.getSprite()&&(a=r.getSprite()._texture),r._textureLoaded&&0!==s){if(null===this._textureToRender){this._textureToRender=a,n.Scale9Sprite.state.GRAY===this._state&&(this._textureToRender=this._textureToRender._generateGrayTexture());var c=r.getDisplayedColor();!a||255===c.r&&255===c.g&&255===c.b||(this._textureToRender=a._generateColorTexture(c.r,c.g,c.b))}var h=t||n._renderContext,l=h.getContext();if(h.setTransform(this._worldTransform,e,i),h.setCompositeOperation(r._blendFunc),h.setGlobalAlpha(o),this._textureToRender){r._quadsDirty&&(r._cleanupQuads(),r._buildQuads(),r._quadsDirty=!1);for(var d=r._quads,u=0;u<d.length;++u){var _,f,p,g,m,y,v,T;m=d[u]._bl.vertices.x,y=d[u]._bl.vertices.y,v=d[u]._tr.vertices.x-d[u]._bl.vertices.x,T=d[u]._tr.vertices.y-d[u]._bl.vertices.y,y=-y-T;var C=this._textureToRender.getPixelWidth(),S=this._textureToRender.getPixelHeight();_=d[u]._bl.texCoords.u*C,f=d[u]._bl.texCoords.v*S,p=(d[u]._tr.texCoords.u-d[u]._bl.texCoords.u)*C,g=(d[u]._tr.texCoords.v-d[u]._bl.texCoords.v)*S,m*=e,y*=i,v*=e,T*=i;var E=this._textureToRender._htmlElementObj;""!==this._textureToRender._pattern?(h.setFillStyle(l.createPattern(E,this._textureToRender._pattern)),l.fillRect(m,y,v,T)):l.drawImage(E,_,f,p,g,m,y,v,T)}}n.g_NumberOfDraws+=d.length}}}}(),function(){if(_ccsg.Node.WebGLRenderCmd){r.Scale9Sprite.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._cachedParent=null,this._cacheDirty=!1,this._quadWebBuffer=n._renderContext.createBuffer(),this._colorOpacityDirty=!1};var t=r.Scale9Sprite.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=r.Scale9Sprite.WebGLRenderCmd,t.rendering=function(t){var e=this._node;if(e._scale9Enabled){var i=null;if(e.getSprite()&&(i=e.getSprite()._texture),e.textureLoaded()&&0!==this._displayedOpacity){var r=!1;e._quadsDirty&&(e._cleanupQuads(),e._buildQuads(),e._quadsDirty=!1,this._colorOpacityDirty=!1,r=!0),this._colorOpacityDirty&&(e._onColorOpacityDirty(),this._colorOpacityDirty=!1,r=!0);var s=t||n._renderContext;if(null!=i){this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),n.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),n.glBindTexture2DN(0,i),n.glEnableVertexAttribs(n.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),s.bindBuffer(s.ARRAY_BUFFER,this._quadWebBuffer);var o=e._quads,a=0,c=o.length;if(0==c)return;if(r){s.bufferData(s.ARRAY_BUFFER,o[0].arrayBuffer.byteLength*o.length,s.DYNAMIC_DRAW);for(var h=0;h<o.length;++h)s.bufferSubData(s.ARRAY_BUFFER,a,o[h].arrayBuffer),a+=o[h].arrayBuffer.byteLength}a=0;for(var h=0;h<o.length;++h)s.vertexAttribPointer(0,3,s.FLOAT,!1,24,a),s.vertexAttribPointer(1,4,s.UNSIGNED_BYTE,!0,24,12+a),s.vertexAttribPointer(2,2,s.FLOAT,!1,24,16+a),s.drawArrays(s.TRIANGLE_STRIP,0,4),a+=o[h].arrayBuffer.byteLength;n.g_NumberOfDraws+=o.length}}}},t._updateDisplayOpacity=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayOpacity.call(this,t);var e=this._node,i=e._scale9Image;if(i){var n=255;e._cascadeOpacityEnabled&&(n=this._displayedOpacity),i._renderCmd._updateDisplayOpacity(n)}this._colorOpacityDirty=!0},t._updateDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t);var e=this._node,i=e._scale9Image;if(i){var r=n.Color.WHITE;this._cascadeColorEnabled&&(r=e._displayedColor),i._renderCmd._updateDisplayColor(r),i._renderCmd._updateColor()}this._colorOpacityDirty=!0},t.setState=function(t){var e=this._node,i=this._node._scale9Image;e.isScale9Enabled?t===r.Scale9Sprite.state.NORMAL?e.setShaderProgram(n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURECOLOR)):t===r.Scale9Sprite.state.GRAY&&e.setShaderProgram(r.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram()):t===r.Scale9Sprite.state.NORMAL?i.setShaderProgram(n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURECOLOR)):t===r.Scale9Sprite.state.GRAY&&i.setShaderProgram(r.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram())},r.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=null,r.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram=function(){var t=r.Scale9Sprite.WebGLRenderCmd._grayShaderProgram;return t?t:(t=new n.GLProgram,t.initWithVertexShaderByteArray(n.SHADER_POSITION_TEXTURE_COLOR_VERT,r.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),r.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=t,t)},r.Scale9Sprite.WebGLRenderCmd._grayShaderFragment="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    vec4 c = texture2D(CC_Texture0, v_texCoord); \n    gl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b); \n     gl_FragColor.w = c.w ; \n}"}}(),r.Layout=r.Widget.extend({_clippingEnabled:!1,_backGroundScale9Enabled:null,_backGroundImage:null,_backGroundImageFileName:null,_backGroundImageCapInsets:null,_colorType:null,_bgImageTexType:r.Widget.LOCAL_TEXTURE,_colorRender:null,_gradientRender:null,_color:null,_startColor:null,_endColor:null,_alongVector:null,_opacity:255,_backGroundImageTextureSize:null,_layoutType:null,_doLayoutDirty:!0,_clippingRectDirty:!0,_clippingType:null,_clippingStencil:null,_scissorRectDirty:!1,_clippingRect:null,_clippingParent:null,_className:"Layout",_backGroundImageColor:null,_finalPositionX:0,_finalPositionY:0,_backGroundImageOpacity:0,_loopFocus:!1,__passFocusToChild:!0,_isFocusPassing:!1,_isInterceptTouch:!1,ctor:function(){this._layoutType=r.Layout.Type.ABSOLUTE,this._widgetType=r.Widget.TYPE_CONTAINER,this._clippingType=r.Layout.CLIPPING_STENCIL,this._colorType=r.Layout.BG_COLOR_NONE,r.Widget.prototype.ctor.call(this),this._backGroundImageCapInsets=n.rect(0,0,0,0),this._color=n.color(255,255,255,255),this._startColor=n.color(255,255,255,255),this._endColor=n.color(255,255,255,255),this._alongVector=n.p(0,-1),this._backGroundImageTextureSize=n.size(0,0),this._clippingRect=n.rect(0,0,0,0),this._backGroundImageColor=n.color(255,255,255,255)},onEnter:function(){r.Widget.prototype.onEnter.call(this),this._clippingStencil&&this._clippingStencil.onEnter(),this._doLayoutDirty=!0,this._clippingRectDirty=!0},onExit:function(){r.Widget.prototype.onExit.call(this),this._clippingStencil&&this._clippingStencil.onExit()},setLoopFocus:function(t){this._loopFocus=t},isLoopFocus:function(){return this._loopFocus},setPassFocusToChild:function(t){this.__passFocusToChild=t},isPassFocusToChild:function(){return this.__passFocusToChild},findNextFocusedWidget:function(t,e){if(this._isFocusPassing||this.isFocused()){var i=this.getParent();if(this._isFocusPassing=!1,this.__passFocusToChild){var s=this._passFocusToChild(t,e);return s instanceof r.Layout&&i?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,this)):s}return null!=i&&i instanceof r.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,this)):this}if(!(e.isFocused()||e instanceof r.Layout))return e;if(this._layoutType===r.Layout.Type.LINEAR_HORIZONTAL)switch(t){case r.Widget.LEFT:return this._getPreviousFocusedWidget(t,e);case r.Widget.RIGHT:return this._getNextFocusedWidget(t,e);case r.Widget.DOWN:case r.Widget.UP:return this._isLastWidgetInContainer(this,t)?this._isWidgetAncestorSupportLoopFocus(e,t)?r.Widget.prototype.findNextFocusedWidget.call(this,t,this):e:r.Widget.prototype.findNextFocusedWidget.call(this,t,this);default:return n.assert(0,"Invalid Focus Direction"),e}else{if(this._layoutType!==r.Layout.Type.LINEAR_VERTICAL)return n.assert(0,"Un Supported Layout type, please use VBox and HBox instead!!!"),e;switch(t){case r.Widget.LEFT:case r.Widget.RIGHT:return this._isLastWidgetInContainer(this,t)?this._isWidgetAncestorSupportLoopFocus(e,t)?r.Widget.prototype.findNextFocusedWidget.call(this,t,this):e:r.Widget.prototype.findNextFocusedWidget.call(this,t,this);case r.Widget.DOWN:return this._getNextFocusedWidget(t,e);case r.Widget.UP:return this._getPreviousFocusedWidget(t,e);default:return n.assert(0,"Invalid Focus Direction"),e}}},onPassFocusToChild:null,init:function(){return r.Widget.prototype.init.call(this)?(this.ignoreContentAdaptWithSize(!1),this.setContentSize(n.size(0,0)),this.setAnchorPoint(0,0),this.onPassFocusToChild=this._findNearestChildWidgetIndex.bind(this),!0):!1},addChild:function(t,e,i){t instanceof r.Widget&&this._supplyTheLayoutParameterLackToChild(t),r.Widget.prototype.addChild.call(this,t,e,i),this._doLayoutDirty=!0},removeChild:function(t,e){r.Widget.prototype.removeChild.call(this,t,e),this._doLayoutDirty=!0},removeAllChildren:function(t){r.Widget.prototype.removeAllChildren.call(this,t),this._doLayoutDirty=!0},removeAllChildrenWithCleanup:function(t){r.Widget.prototype.removeAllChildrenWithCleanup.call(this,t),this._doLayoutDirty=!0},isClippingEnabled:function(){return this._clippingEnabled},visit:function(t){if(this._visible)if(this._adaptRenderers(),this._doLayout(),this._clippingEnabled)switch(this._clippingType){case r.Layout.CLIPPING_STENCIL:this._renderCmd.stencilClippingVisit(t);break;case r.Layout.CLIPPING_SCISSOR:this._renderCmd.scissorClippingVisit(t)}else r.Widget.prototype.visit.call(this,t)},setClippingEnabled:function(t){if(t!==this._clippingEnabled)switch(this._clippingEnabled=t,this._clippingType){case r.Layout.CLIPPING_STENCIL:t?(this._clippingStencil=new n.DrawNode,this._renderCmd.rebindStencilRendering(this._clippingStencil),this._running&&this._clippingStencil.onEnter(),this._setStencilClippingSize(this._contentSize)):(this._running&&this._clippingStencil&&this._clippingStencil.onExit(),this._clippingStencil=null)}},setClippingType:function(t){if(t!==this._clippingType){if(n._renderType===n.game.RENDER_TYPE_CANVAS&&t===r.Layout.CLIPPING_SCISSOR)return void n.log("Only supports STENCIL on canvas mode.");var e=this.isClippingEnabled();this.setClippingEnabled(!1),this._clippingType=t,this.setClippingEnabled(e)}},getClippingType:function(){return this._clippingType},_setStencilClippingSize:function(t){if(this._clippingEnabled&&this._clippingType===r.Layout.CLIPPING_STENCIL){var e=[];e[0]=n.p(0,0),e[1]=n.p(t.width,0),e[2]=n.p(t.width,t.height),e[3]=n.p(0,t.height);var i=n.Color.GREEN;this._clippingStencil.clear(),this._clippingStencil.drawPoly(e,4,i,0,i)}},_getClippingRect:function(){if(this._clippingRectDirty){for(var t,e=this.convertToWorldSpace(n.p(0,0)),i=this.getNodeToWorldTransform(),s=this._contentSize.width*i.a,o=this._contentSize.height*i.d,a=this;a;)if(a=a.getParent(),a&&a instanceof r.Layout&&a.isClippingEnabled()){this._clippingParent=a;break}if(this._clippingParent){t=this._clippingParent._getClippingRect();var c=e.x-s*this._anchorPoint.x,h=e.y-o*this._anchorPoint.y,l=s,d=o,u=e.x-t.x;0>u&&(c=t.x,l+=u);var _=e.x+s-(t.x+t.width);_>0&&(l-=_);var f=e.y+o-(t.y+t.height);f>0&&(d-=f);var p=e.y-t.y;0>p&&(h=t.x,d+=p),0>l&&(l=0),0>d&&(d=0),this._clippingRect.x=c,this._clippingRect.y=h,this._clippingRect.width=l,this._clippingRect.height=d}else this._clippingRect.x=e.x-s*this._anchorPoint.x,this._clippingRect.y=e.y-o*this._anchorPoint.y,this._clippingRect.width=s,this._clippingRect.height=o;this._clippingRectDirty=!1}return this._clippingRect},_onSizeChanged:function(){r.Widget.prototype._onSizeChanged.call(this);var t=this._contentSize;this._setStencilClippingSize(t),this._doLayoutDirty=!0,this._clippingRectDirty=!0,this._backGroundImage&&(this._backGroundImage.setPosition(.5*t.width,.5*t.height),this._backGroundScale9Enabled&&this._backGroundImage instanceof r.Scale9Sprite&&this._backGroundImage.setPreferredSize(t)),this._colorRender&&this._colorRender.setContentSize(t),this._gradientRender&&this._gradientRender.setContentSize(t)},setBackGroundImageScale9Enabled:function(t){this._backGroundScale9Enabled!==t&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundScale9Enabled=t,this._addBackGroundImage(),this.setBackGroundImage(this._backGroundImageFileName,this._bgImageTexType),this.setBackGroundImageCapInsets(this._backGroundImageCapInsets))},isBackGroundImageScale9Enabled:function(){return this._backGroundScale9Enabled},setBackGroundImage:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,null===this._backGroundImage&&(this._addBackGroundImage(),this.setBackGroundImageScale9Enabled(this._backGroundScale9Enabled)),this._backGroundImageFileName=t,this._bgImageTexType=e;var i=this._backGroundImage;switch(this._bgImageTexType){case r.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._backGroundScale9Enabled&&i.setPreferredSize(this._contentSize),this._backGroundImageTextureSize=i.getContentSize(),i.setPosition(.5*this._contentSize.width,.5*this._contentSize.height),this._updateBackGroundImageColor()}},setBackGroundImageCapInsets:function(t){if(t){var e=this._backGroundImageCapInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._backGroundScale9Enabled&&this._backGroundImage.setCapInsets(t)}},getBackGroundImageCapInsets:function(){return n.rect(this._backGroundImageCapInsets)},_supplyTheLayoutParameterLackToChild:function(t){if(t)switch(this._layoutType){case r.Layout.Type.ABSOLUTE:break;case r.Layout.Type.LINEAR_HORIZONTAL:case r.Layout.Type.LINEAR_VERTICAL:var e=t.getLayoutParameter(r.LayoutParameter.LINEAR);e||t.setLayoutParameter(new r.LinearLayoutParameter);break;case r.Layout.Type.RELATIVE:var e=t.getLayoutParameter(r.LayoutParameter.RELATIVE);e||t.setLayoutParameter(new r.RelativeLayoutParameter)}},_addBackGroundImage:function(){var t=this._contentSize;this._backGroundScale9Enabled?(this._backGroundImage=new r.Scale9Sprite,this._backGroundImage.setPreferredSize(t)):this._backGroundImage=new n.Sprite,this.addProtectedChild(this._backGroundImage,r.Layout.BACKGROUND_IMAGE_ZORDER,-1),this._backGroundImage.setPosition(.5*t.width,.5*t.height)},removeBackGroundImage:function(){this._backGroundImage&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundImageFileName="",this._backGroundImageTextureSize.width=0,this._backGroundImageTextureSize.height=0)},setBackGroundColorType:function(t){if(this._colorType!==t){switch(this._colorType){case r.Layout.BG_COLOR_NONE:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null),this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null);break;case r.Layout.BG_COLOR_SOLID:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null);break;case r.Layout.BG_COLOR_GRADIENT:this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null)}switch(this._colorType=t,this._colorType){case r.Layout.BG_COLOR_NONE:break;case r.Layout.BG_COLOR_SOLID:this._colorRender=new n.LayerColor,this._colorRender.setContentSize(this._contentSize),this._colorRender.setOpacity(this._opacity),this._colorRender.setColor(this._color),this.addProtectedChild(this._colorRender,r.Layout.BACKGROUND_RENDERER_ZORDER,-1);break;case r.Layout.BG_COLOR_GRADIENT:this._gradientRender=new n.LayerGradient(n.color(255,0,0,255),n.color(0,255,0,255)),this._gradientRender.setContentSize(this._contentSize),this._gradientRender.setOpacity(this._opacity),this._gradientRender.setStartColor(this._startColor),this._gradientRender.setEndColor(this._endColor),this._gradientRender.setVector(this._alongVector),this.addProtectedChild(this._gradientRender,r.Layout.BACKGROUND_RENDERER_ZORDER,-1)}}},getBackGroundColorType:function(){return this._colorType},setBackGroundColor:function(t,e){e?(this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._gradientRender&&this._gradientRender.setStartColor(t),this._endColor.r=e.r,this._endColor.g=e.g,this._endColor.b=e.b,this._gradientRender&&this._gradientRender.setEndColor(e)):(this._color.r=t.r,this._color.g=t.g,this._color.b=t.b,this._colorRender&&this._colorRender.setColor(t))},getBackGroundColor:function(){var t=this._color;return n.color(t.r,t.g,t.b,t.a)},getBackGroundStartColor:function(){var t=this._startColor;return n.color(t.r,t.g,t.b,t.a)},getBackGroundEndColor:function(){var t=this._endColor;return n.color(t.r,t.g,t.b,t.a)},setBackGroundColorOpacity:function(t){switch(this._opacity=t,this._colorType){case r.Layout.BG_COLOR_NONE:break;case r.Layout.BG_COLOR_SOLID:this._colorRender.setOpacity(t);break;case r.Layout.BG_COLOR_GRADIENT:this._gradientRender.setOpacity(t)}},getBackGroundColorOpacity:function(){return this._opacity},setBackGroundColorVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._gradientRender&&this._gradientRender.setVector(t)},getBackGroundColorVector:function(){return this._alongVector},setBackGroundImageColor:function(t){this._backGroundImageColor.r=t.r,this._backGroundImageColor.g=t.g,this._backGroundImageColor.b=t.b,this._updateBackGroundImageColor()},setBackGroundImageOpacity:function(t){this._backGroundImageColor.a=t,this.getBackGroundImageColor()},getBackGroundImageColor:function(){var t=this._backGroundImageColor;return n.color(t.r,t.g,t.b,t.a)},getBackGroundImageOpacity:function(){return this._backGroundImageColor.a},_updateBackGroundImageColor:function(){this._backGroundImage&&this._backGroundImage.setColor(this._backGroundImageColor)},getBackGroundImageTextureSize:function(){return this._backGroundImageTextureSize},setLayoutType:function(t){this._layoutType=t;for(var e=this._children,i=null,n=0;n<e.length;n++)i=e[n],i instanceof r.Widget&&this._supplyTheLayoutParameterLackToChild(i);this._doLayoutDirty=!0},getLayoutType:function(){return this._layoutType},requestDoLayout:function(){this._doLayoutDirty=!0},_doLayout:function(){if(this._doLayoutDirty){this.sortAllChildren();var t=r.getLayoutManager(this._layoutType);t&&t._doLayout(this),this._doLayoutDirty=!1}},_getLayoutContentSize:function(){return this.getContentSize()},_getLayoutElements:function(){return this.getChildren()},_updateBackGroundImageOpacity:function(){this._backGroundImage&&this._backGroundImage.setOpacity(this._backGroundImageOpacity)},_updateBackGroundImageRGBA:function(){this._backGroundImage&&(this._backGroundImage.setColor(this._backGroundImageColor),this._backGroundImage.setOpacity(this._backGroundImageOpacity))},_getLayoutAccumulatedSize:function(){for(var t,e=this.getChildren(),i=n.size(0,0),s=0,o=0,a=e.length;a>o;o++){var c=e[o];if(null!==c&&c instanceof r.Layout)t=c._getLayoutAccumulatedSize(),i.width+=t.width,i.height+=t.height;else if(c instanceof r.Widget){s++;var h=c.getLayoutParameter().getMargin();t=c.getContentSize(),i.width+=t.width+.5*(h.right+h.left),i.height+=t.height+.5*(h.top+h.bottom)}}var l=this.getLayoutType();return l===r.Layout.Type.LINEAR_HORIZONTAL&&(i.height=i.height-i.height/s*(s-1)),l===r.Layout.Type.LINEAR_VERTICAL&&(i.width=i.width-i.width/s*(s-1)),i},_findNearestChildWidgetIndex:function(t,e){if(null==e||e===this)return this._findFirstFocusEnabledWidgetIndex();var i,s=0,o=this.getChildren(),a=o.length,c=n.FLT_MAX,h=0;if(t===r.Widget.LEFT||t===r.Widget.RIGHT||t===r.Widget.DOWN||t===r.Widget.UP){for(i=this._getWorldCenterPoint(e);a>s;){var l=o[s];if(l&&l instanceof r.Widget&&l.isFocusEnabled()){var d=l instanceof r.Layout?l._calculateNearestDistance(e):n.pLength(n.pSub(this._getWorldCenterPoint(l),i));c>d&&(h=s,c=d)}s++}return h}return n.log("invalid focus direction!"),0},_findFarthestChildWidgetIndex:function(t,e){if(null==e||e===this)return this._findFirstFocusEnabledWidgetIndex();var i=0,s=this.getChildren(),o=s.length,a=-n.FLT_MAX,c=0;if(t===r.Widget.LEFT||t===r.Widget.RIGHT||t===r.Widget.DOWN||t===r.Widget.UP){for(var h=this._getWorldCenterPoint(e);o>i;){var l=s[i];if(l&&l instanceof r.Widget&&l.isFocusEnabled()){var d=l instanceof r.Layout?l._calculateFarthestDistance(e):n.pLength(n.pSub(this._getWorldCenterPoint(l),h));d>a&&(c=i,a=d)}i++}return c}return n.log("invalid focus direction!!!"),0},_calculateNearestDistance:function(t){for(var e=n.FLT_MAX,i=this._getWorldCenterPoint(t),s=this._children,o=0,a=s.length;a>o;o++){var c,h=s[o];if(h instanceof r.Layout)c=h._calculateNearestDistance(t);else{if(!(h instanceof r.Widget&&h.isFocusEnabled()))continue;c=n.pLength(n.pSub(this._getWorldCenterPoint(h),i))}e>c&&(e=c)}return e},_calculateFarthestDistance:function(t){for(var e=-n.FLT_MAX,i=this._getWorldCenterPoint(t),s=this._children,o=0,a=s.length;a>o;o++){var c,h=s[o];if(h instanceof r.Layout)c=h._calculateFarthestDistance(t);else{if(!(h instanceof r.Widget&&h.isFocusEnabled()))continue;var l=this._getWorldCenterPoint(h);c=n.pLength(n.pSub(l,i))}c>e&&(e=c)}return e},_findProperSearchingFunctor:function(t,e){if(null!=e){var i=this._getWorldCenterPoint(e),s=this._getWorldCenterPoint(this._findFirstNonLayoutWidget());t===r.Widget.LEFT?this.onPassFocusToChild=i.x>s.x?this._findNearestChildWidgetIndex.bind(this):this._findFarthestChildWidgetIndex.bind(this):t===r.Widget.RIGHT?this.onPassFocusToChild=i.x>s.x?this._findFarthestChildWidgetIndex.bind(this):this._findNearestChildWidgetIndex.bind(this):t===r.Widget.DOWN?this.onPassFocusToChild=i.y>s.y?this._findNearestChildWidgetIndex.bind(this):this._findFarthestChildWidgetIndex.bind(this):t===r.Widget.UP?this.onPassFocusToChild=i.y<s.y?this._findNearestChildWidgetIndex.bind(this):this._findFarthestChildWidgetIndex.bind(this):n.log("invalid direction!")}},_findFirstNonLayoutWidget:function(){for(var t=this._children,e=0,i=t.length;i>e;e++){var n=t[e];if(n instanceof r.Layout){var s=n._findFirstNonLayoutWidget();if(s)return s}else if(n instanceof r.Widget)return n}return null},_findFirstFocusEnabledWidgetIndex:function(){for(var t=0,e=this.getChildren(),i=e.length;i>t;){var n=e[t];if(n&&n instanceof r.Widget&&n.isFocusEnabled())return t;t++}return 0},_findFocusEnabledChildWidgetByIndex:function(t){var e=this._getChildWidgetByIndex(t);return e?e.isFocusEnabled()?e:(t+=1,this._findFocusEnabledChildWidgetByIndex(t)):null},_getWorldCenterPoint:function(t){var e=t instanceof r.Layout?t._getLayoutAccumulatedSize():t.getContentSize();return t.convertToWorldSpace(n.p(e.width/2,e.height/2))},_getNextFocusedWidget:function(t,e){var i=null,n=this._children,s=n.indexOf(e);return s+=1,s<n.length?(i=this._getChildWidgetByIndex(s),i?i.isFocusEnabled()?i instanceof r.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getNextFocusedWidget(t,i):e):this._loopFocus?this._checkFocusEnabledChild()?(s=0,i=this._getChildWidgetByIndex(s),i.isFocusEnabled()?i instanceof r.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getNextFocusedWidget(t,i)):e instanceof r.Layout?e:r.Widget._focusedWidget:this._isLastWidgetInContainer(e,t)?this._isWidgetAncestorSupportLoopFocus(this,t)?r.Widget.prototype.findNextFocusedWidget.call(this,t,this):e instanceof r.Layout?e:r.Widget._focusedWidget:r.Widget.prototype.findNextFocusedWidget.call(this,t,this)},_getPreviousFocusedWidget:function(t,e){var i=null,n=this._children,s=n.indexOf(e);return s-=1,s>=0?(i=this._getChildWidgetByIndex(s),i.isFocusEnabled()?i instanceof r.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getPreviousFocusedWidget(t,i)):this._loopFocus?this._checkFocusEnabledChild()?(s=n.length-1,i=this._getChildWidgetByIndex(s),i.isFocusEnabled()?i instanceof r.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getPreviousFocusedWidget(t,i)):e instanceof r.Layout?e:r.Widget._focusedWidget:this._isLastWidgetInContainer(e,t)?this._isWidgetAncestorSupportLoopFocus(this,t)?r.Widget.prototype.findNextFocusedWidget.call(this,t,this):e instanceof r.Layout?e:r.Widget._focusedWidget:r.Widget.prototype.findNextFocusedWidget.call(this,t,this)},_getChildWidgetByIndex:function(t){for(var e=this._children,i=e.length,n=0,s=t;i>t;){var o=e[t];if(o&&o instanceof r.Widget)return o;n++,t++}for(var a=0;s>a;){var c=e[a];if(c&&c instanceof r.Widget)return c;n++,a++}return null},_isLastWidgetInContainer:function(t,e){var i=t.getParent();if(null==i||!(i instanceof r.Layout))return!0;var s=i.getChildren(),o=s.indexOf(t);if(i.getLayoutType()===r.Layout.Type.LINEAR_HORIZONTAL){if(e===r.Widget.LEFT)return 0===o?this._isLastWidgetInContainer(i,e):!1;if(e===r.Widget.RIGHT)return o===s.length-1?this._isLastWidgetInContainer(i,e):!1;if(e===r.Widget.DOWN)return this._isLastWidgetInContainer(i,e);if(e===r.Widget.UP)return this._isLastWidgetInContainer(i,e);

}else{if(i.getLayoutType()!==r.Layout.Type.LINEAR_VERTICAL)return n.log("invalid layout Type"),!1;if(e===r.Widget.UP)return 0===o?this._isLastWidgetInContainer(i,e):!1;if(e===r.Widget.DOWN)return o===s.length-1?this._isLastWidgetInContainer(i,e):!1;if(e===r.Widget.LEFT)return this._isLastWidgetInContainer(i,e);if(e===r.Widget.RIGHT)return this._isLastWidgetInContainer(i,e)}},_isWidgetAncestorSupportLoopFocus:function(t,e){var i=t.getParent();if(null==i||!(i instanceof r.Layout))return!1;if(i.isLoopFocus()){var s=i.getLayoutType();return s===r.Layout.Type.LINEAR_HORIZONTAL?e===r.Widget.LEFT||e===r.Widget.RIGHT?!0:this._isWidgetAncestorSupportLoopFocus(i,e):s===r.Layout.Type.LINEAR_VERTICAL?e===r.Widget.DOWN||e===r.Widget.UP?!0:this._isWidgetAncestorSupportLoopFocus(i,e):(n.assert(0,"invalid layout type"),!1)}return this._isWidgetAncestorSupportLoopFocus(i,e)},_passFocusToChild:function(t,e){if(this._checkFocusEnabledChild()){var i=r.Widget.getCurrentFocusedWidget();this._findProperSearchingFunctor(t,i);var n=this.onPassFocusToChild(t,i),s=this._getChildWidgetByIndex(n);return s instanceof r.Layout?(s._isFocusPassing=!0,s.findNextFocusedWidget(t,s)):(this.dispatchFocusEvent(e,s),s)}return this},_checkFocusEnabledChild:function(){for(var t=this._children,e=0,i=t.length;i>e;e++){var n=t[e];if(n&&n instanceof r.Widget&&n.isFocusEnabled())return!0}return!1},getDescription:function(){return"Layout"},_createCloneInstance:function(){return new r.Layout},_copyClonedWidgetChildren:function(t){r.Widget.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){t instanceof r.Layout&&(this.setBackGroundImageScale9Enabled(t._backGroundScale9Enabled),this.setBackGroundImage(t._backGroundImageFileName,t._bgImageTexType),this.setBackGroundImageCapInsets(t._backGroundImageCapInsets),this.setBackGroundColorType(t._colorType),this.setBackGroundColor(t._color),this.setBackGroundColor(t._startColor,t._endColor),this.setBackGroundColorOpacity(t._opacity),this.setBackGroundColorVector(t._alongVector),this.setLayoutType(t._layoutType),this.setClippingEnabled(t._clippingEnabled),this.setClippingType(t._clippingType),this._loopFocus=t._loopFocus,this.__passFocusToChild=t.__passFocusToChild,this._isInterceptTouch=t._isInterceptTouch)},forceDoLayout:function(){this.requestDoLayout(),this._doLayout()},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_WEBGL?new r.Layout.WebGLRenderCmd(this):new r.Layout.CanvasRenderCmd(this)}});var c=r.Layout.prototype;c.clippingEnabled,n.defineGetterSetter(c,"clippingEnabled",c.isClippingEnabled,c.setClippingEnabled),c.clippingType,n.defineGetterSetter(c,"clippingType",null,c.setClippingType),c.layoutType,n.defineGetterSetter(c,"layoutType",c.getLayoutType,c.setLayoutType),c=null,r.Layout.create=function(){return new r.Layout},r.Layout.BG_COLOR_NONE=0,r.Layout.BG_COLOR_SOLID=1,r.Layout.BG_COLOR_GRADIENT=2,r.Layout.Type=n.Enum({ABSOLUTE:0,LINEAR_VERTICAL:1,LINEAR_HORIZONTAL:2,RELATIVE:3}),r.Layout.CLIPPING_STENCIL=0,r.Layout.CLIPPING_SCISSOR=1,r.Layout.BACKGROUND_IMAGE_ZORDER=-1,r.Layout.BACKGROUND_RENDERER_ZORDER=-2,function(){r.Layout.CanvasRenderCmd=function(t){r.ProtectedNode.CanvasRenderCmd.call(this,t),this._needDraw=!1,this._clipElemType=!1,this._locCache=null,this._rendererSaveCmd=new n.CustomRenderCmd(this,this._onRenderSaveCmd),this._rendererSaveCmdSprite=new n.CustomRenderCmd(this,this._onRenderSaveSpriteCmd),this._rendererClipCmd=new n.CustomRenderCmd(this,this._onRenderClipCmd),this._rendererRestoreCmd=new n.CustomRenderCmd(this,this._onRenderRestoreCmd)};var t=r.Layout.CanvasRenderCmd.prototype=Object.create(r.ProtectedNode.CanvasRenderCmd.prototype);t.constructor=r.Layout.CanvasRenderCmd,t.visit=function(t){var e=this._node;if(e._visible)if(e._adaptRenderers(),e._doLayout(),e._clippingEnabled)switch(e._clippingType){case r.Layout.CLIPPING_STENCIL:this.stencilClippingVisit(t);break;case r.Layout.CLIPPING_SCISSOR:this.scissorClippingVisit(t)}else r.Widget.CanvasRenderCmd.prototype.visit.call(this,t)},t._onRenderSaveCmd=function(t,e,i){var s=t||n._renderContext,o=s.getContext();if(this._clipElemType){var a=o.canvas;this._locCache=r.Layout.CanvasRenderCmd._getSharedCache(),this._locCache.width=a.width,this._locCache.height=a.height;var c=this._locCache.getContext("2d");c.drawImage(a,0,0)}else s.save(),s.save(),s.setTransform(this._worldTransform,e,i)},t._onRenderSaveSpriteCmd=function(t){var e=t||n._renderContext;this._clipElemType&&e.setCompositeOperation("destination-in")},t._onRenderClipCmd=function(t){var e=t||n._renderContext,i=e.getContext();this._clipElemType||(e.restore(),i.clip())},t._onRenderRestoreCmd=function(t){var e=t||n._renderContext,i=e.getContext();this._clipElemType?(i.save(),i.setTransform(1,0,0,1,0,0),i.globalCompositeOperation="destination-over",i.drawImage(this._locCache,0,0),i.restore()):e.restore()},t.rebindStencilRendering=function(t){t._renderCmd.rendering=this.__stencilDraw},t.__stencilDraw=function(t,e,i){for(var r=t||n._renderContext,s=r.getContext(),o=this._buffer,a=0,c=o.length;c>a;a++){var h=o[a],l=h.verts,d=l[0];s.beginPath(),s.moveTo(d.x*e,-d.y*i);for(var u=1,_=l.length;_>u;u++)s.lineTo(l[u].x*e,-l[u].y*i);s.closePath()}},t.stencilClippingVisit=t.scissorClippingVisit=function(t){var e=this._node;if(e._clippingStencil&&e._clippingStencil.isVisible()){if(this._clipElemType=e._stencil instanceof n.Sprite,this._syncStatus(t),n.renderer.pushRenderCommand(this._rendererSaveCmd),this._clipElemType&&(n.ProtectedNode.prototype.visit.call(e,t),n.renderer.pushRenderCommand(this._rendererSaveCmdSprite)),e._clippingStencil.visit(this),n.renderer.pushRenderCommand(this._rendererClipCmd),!this._clipElemType){e.sortAllChildren(),e.sortAllProtectedChildren();for(var i,r=e._children,s=0,o=e._protectedChildren,a=0,c=r.length,h=o.length;c>a&&(i=r[a],i&&i.getLocalZOrder()<0);a++)i.visit(this);for(;h>s&&(i=o[s],i&&i.getLocalZOrder()<0);s++)i.visit(this);for(;c>a;a++)r[a].visit(this);for(;h>s;s++)o[s].visit(this);n.renderer.pushRenderCommand(this._rendererRestoreCmd)}this._dirtyFlag=0}},r.Layout.CanvasRenderCmd._getSharedCache=function(){return n.ClippingNode._sharedCache||(n.ClippingNode._sharedCache=document.createElement("canvas"))}}(),function(){if(r.ProtectedNode.WebGLRenderCmd){r.Layout.WebGLRenderCmd=function(t){r.ProtectedNode.WebGLRenderCmd.call(this,t),this._needDraw=!1,this._currentStencilEnabled=0,this._currentStencilWriteMask=0,this._currentStencilFunc=0,this._currentStencilRef=0,this._currentStencilValueMask=0,this._currentStencilFail=0,this._currentStencilPassDepthFail=0,this._currentStencilPassDepthPass=0,this._currentDepthWriteMask=!1,this._mask_layer_le=0,this._beforeVisitCmdStencil=new n.CustomRenderCmd(this,this._onBeforeVisitStencil),this._afterDrawStencilCmd=new n.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmdStencil=new n.CustomRenderCmd(this,this._onAfterVisitStencil),this._beforeVisitCmdScissor=new n.CustomRenderCmd(this,this._onBeforeVisitScissor),this._afterVisitCmdScissor=new n.CustomRenderCmd(this,this._onAfterVisitScissor)};var t=r.Layout.WebGLRenderCmd.prototype=Object.create(r.ProtectedNode.WebGLRenderCmd.prototype);t.constructor=r.Layout.WebGLRenderCmd,t.visit=function(t){var e=this._node;if(e._visible)if(e._adaptRenderers(),e._doLayout(),e._clippingEnabled)switch(e._clippingType){case r.Layout.CLIPPING_STENCIL:this.stencilClippingVisit(t);break;case r.Layout.CLIPPING_SCISSOR:this.scissorClippingVisit(t)}else r.Widget.WebGLRenderCmd.prototype.visit.call(this,t)},t._onBeforeVisitStencil=function(t){var e=t||n._renderContext;r.Layout.WebGLRenderCmd._layer++;var i=1<<r.Layout.WebGLRenderCmd._layer,s=i-1;this._mask_layer_le=i|s,this._currentStencilEnabled=e.isEnabled(e.STENCIL_TEST),this._currentStencilWriteMask=e.getParameter(e.STENCIL_WRITEMASK),this._currentStencilFunc=e.getParameter(e.STENCIL_FUNC),this._currentStencilRef=e.getParameter(e.STENCIL_REF),this._currentStencilValueMask=e.getParameter(e.STENCIL_VALUE_MASK),this._currentStencilFail=e.getParameter(e.STENCIL_FAIL),this._currentStencilPassDepthFail=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),this._currentStencilPassDepthPass=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),e.enable(e.STENCIL_TEST),e.stencilMask(i),this._currentDepthWriteMask=e.getParameter(e.DEPTH_WRITEMASK),e.depthMask(!1),e.stencilFunc(e.NEVER,i,i),e.stencilOp(e.ZERO,e.KEEP,e.KEEP),this._drawFullScreenQuadClearStencil(),e.stencilFunc(e.NEVER,i,i),e.stencilOp(e.REPLACE,e.KEEP,e.KEEP)},t._onAfterDrawStencil=function(t){var e=t||n._renderContext;e.depthMask(this._currentDepthWriteMask),e.stencilFunc(e.EQUAL,this._mask_layer_le,this._mask_layer_le),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t._onAfterVisitStencil=function(t){var e=t||n._renderContext;e.stencilFunc(this._currentStencilFunc,this._currentStencilRef,this._currentStencilValueMask),e.stencilOp(this._currentStencilFail,this._currentStencilPassDepthFail,this._currentStencilPassDepthPass),e.stencilMask(this._currentStencilWriteMask),this._currentStencilEnabled||e.disable(e.STENCIL_TEST),r.Layout.WebGLRenderCmd._layer--},t._onBeforeVisitScissor=function(t){var e=this._getClippingRect(),i=t||n._renderContext;i.enable(i.SCISSOR_TEST),n.view.setScissorInPoints(e.x,e.y,e.width,e.height)},t._onAfterVisitScissor=function(t){var e=t||n._renderContext;e.disable(e.SCISSOR_TEST)},t._drawFullScreenQuadClearStencil=function(){n.kmGLMatrixMode(n.KM_GL_PROJECTION),n.kmGLPushMatrix(),n.kmGLLoadIdentity(),n.kmGLMatrixMode(n.KM_GL_MODELVIEW),n.kmGLPushMatrix(),n.kmGLLoadIdentity(),n._drawingUtil.drawSolidRect(n.p(-1,-1),n.p(1,1),n.color(255,255,255,255)),n.kmGLMatrixMode(n.KM_GL_PROJECTION),n.kmGLPopMatrix(),n.kmGLMatrixMode(n.KM_GL_MODELVIEW),n.kmGLPopMatrix()},t.rebindStencilRendering=function(t){},t.transform=function(t,e){var i=this._node;r.ProtectedNode.WebGLRenderCmd.prototype.transform.call(this,t,e),i._clippingStencil&&i._clippingStencil._renderCmd.transform(this,e)},t.stencilClippingVisit=function(t){var e=this._node;if(e._clippingStencil&&e._clippingStencil.isVisible()){if(r.Layout.WebGLRenderCmd._layer+1===n.stencilBits)return r.Layout.WebGLRenderCmd._visit_once=!0,r.Layout.WebGLRenderCmd._visit_once&&(n.log("Nesting more than "+n.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its childs."),r.Layout.WebGLRenderCmd._visit_once=!1),void _ccsg.Node.prototype.visit.call(e,t);n.renderer.pushRenderCommand(this._beforeVisitCmdStencil);var i=n.current_stack;i.stack.push(i.top),this._syncStatus(t),this._dirtyFlag=0,i.top=this._stackMatrix,e._clippingStencil.visit(this),n.renderer.pushRenderCommand(this._afterDrawStencilCmd);var s=0,o=0;e.sortAllChildren(),e.sortAllProtectedChildren();for(var a,c=e._children,h=e._protectedChildren,l=c.length,d=h.length;l>s&&(a=c[s],a&&a.getLocalZOrder()<0);s++)a.visit(this);for(;d>o&&(a=h[o],a&&a.getLocalZOrder()<0);o++)a.visit(this);for(;l>s;s++)c[s].visit(this);for(;d>o;o++)h[o].visit(this);n.renderer.pushRenderCommand(this._afterVisitCmdStencil),i.top=i.stack.pop()}},t.scissorClippingVisit=function(t){n.renderer.pushRenderCommand(this._beforeVisitCmdScissor),n.ProtectedNode.prototype.visit.call(this._node,t),n.renderer.pushRenderCommand(this._afterVisitCmdScissor)},r.Layout.WebGLRenderCmd._layer=-1,r.Layout.WebGLRenderCmd._visit_once=null}}(),r.Margin=r.Class.extend({left:0,top:0,right:0,bottom:0,ctor:function(t,e,i,n){void 0!==t&&void 0===e&&(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom),void 0!==n&&(this.left=t,this.top=e,this.right=i,this.bottom=n)},setMargin:function(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n},equals:function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom}}),r.MarginZero=function(){return new r.Margin(0,0,0,0)},r.LayoutParameter=r.Class.extend({_margin:null,_layoutParameterType:null,ctor:function(){this._margin=new r.Margin,this._layoutParameterType=r.LayoutParameter.NONE},setMargin:function(t){n.js.isObject(t)?(this._margin.left=t.left,this._margin.top=t.top,this._margin.right=t.right,this._margin.bottom=t.bottom):(this._margin.left=arguments[0],this._margin.top=arguments[1],this._margin.right=arguments[2],this._margin.bottom=arguments[3])},getMargin:function(){return this._margin},getLayoutType:function(){return this._layoutParameterType},clone:function(){var t=this._createCloneInstance();return t._copyProperties(this),t},_createCloneInstance:function(){return new r.LayoutParameter},_copyProperties:function(t){this._margin.bottom=t._margin.bottom,this._margin.left=t._margin.left,this._margin.right=t._margin.right,this._margin.top=t._margin.top}}),r.LayoutParameter.create=function(){return new r.LayoutParameter},r.LayoutParameter.NONE=0,r.LayoutParameter.LINEAR=1,r.LayoutParameter.RELATIVE=2,r.LinearLayoutParameter=r.LayoutParameter.extend({_linearGravity:null,ctor:function(){r.LayoutParameter.prototype.ctor.call(this),this._linearGravity=r.LinearLayoutParameter.NONE,this._layoutParameterType=r.LayoutParameter.LINEAR},setGravity:function(t){this._linearGravity=t},getGravity:function(){return this._linearGravity},_createCloneInstance:function(){return new r.LinearLayoutParameter},_copyProperties:function(t){r.LayoutParameter.prototype._copyProperties.call(this,t),t instanceof r.LinearLayoutParameter&&this.setGravity(t._linearGravity)}}),r.LinearLayoutParameter.create=function(){return new r.LinearLayoutParameter},r.LinearLayoutParameter.NONE=0,r.LinearLayoutParameter.LEFT=1,r.LinearLayoutParameter.TOP=2,r.LinearLayoutParameter.RIGHT=3,r.LinearLayoutParameter.BOTTOM=4,r.LinearLayoutParameter.CENTER_VERTICAL=5,r.LinearLayoutParameter.CENTER_HORIZONTAL=6,r.RelativeLayoutParameter=r.LayoutParameter.extend({_relativeAlign:null,_relativeWidgetName:"",_relativeLayoutName:"",_put:!1,ctor:function(){r.LayoutParameter.prototype.ctor.call(this),this._relativeAlign=r.RelativeLayoutParameter.Type.NONE,this._relativeWidgetName="",this._relativeLayoutName="",this._put=!1,this._layoutParameterType=r.LayoutParameter.RELATIVE},setAlign:function(t){this._relativeAlign=t},getAlign:function(){return this._relativeAlign},setRelativeToWidgetName:function(t){this._relativeWidgetName=t},getRelativeToWidgetName:function(){return this._relativeWidgetName},setRelativeName:function(t){this._relativeLayoutName=t},getRelativeName:function(){return this._relativeLayoutName},_createCloneInstance:function(){return new r.RelativeLayoutParameter},_copyProperties:function(t){r.LayoutParameter.prototype._copyProperties.call(this,t),t instanceof r.RelativeLayoutParameter&&(this.setAlign(t._relativeAlign),this.setRelativeToWidgetName(t._relativeWidgetName),this.setRelativeName(t._relativeLayoutName))}}),r.RelativeLayoutParameter.create=function(){return new r.RelativeLayoutParameter},r.RelativeLayoutParameter.Type=n.Enum({NONE:0,PARENT_TOP_LEFT:1,PARENT_TOP_CENTER_HORIZONTAL:2,PARENT_TOP_RIGHT:3,PARENT_LEFT_CENTER_VERTICAL:4,CENTER_IN_PARENT:5,PARENT_RIGHT_CENTER_VERTICAL:6,PARENT_LEFT_BOTTOM:7,PARENT_BOTTOM_CENTER_HORIZONTAL:8,PARENT_RIGHT_BOTTOM:9,LOCATION_ABOVE_LEFTALIGN:10,LOCATION_ABOVE_CENTER:11,LOCATION_ABOVE_RIGHTALIGN:12,LOCATION_LEFT_OF_TOPALIGN:13,LOCATION_LEFT_OF_CENTER:14,LOCATION_LEFT_OF_BOTTOMALIGN:15,LOCATION_RIGHT_OF_TOPALIGN:16,LOCATION_RIGHT_OF_CENTER:17,LOCATION_RIGHT_OF_BOTTOMALIGN:18,LOCATION_BELOW_LEFTALIGN:19,LOCATION_BELOW_CENTER:20,LOCATION_BELOW_RIGHTALIGN:21}),r.LINEAR_GRAVITY_NONE=0,r.LINEAR_GRAVITY_LEFT=1,r.LINEAR_GRAVITY_TOP=2,r.LINEAR_GRAVITY_RIGHT=3,r.LINEAR_GRAVITY_BOTTOM=4,r.LINEAR_GRAVITY_CENTER_VERTICAL=5,r.LINEAR_GRAVITY_CENTER_HORIZONTAL=6,r.RELATIVE_ALIGN_NONE=0,r.RELATIVE_ALIGN_PARENT_TOP_LEFT=1,r.RELATIVE_ALIGN_PARENT_TOP_CENTER_HORIZONTAL=2,r.RELATIVE_ALIGN_PARENT_TOP_RIGHT=3,r.RELATIVE_ALIGN_PARENT_LEFT_CENTER_VERTICAL=4,r.RELATIVE_ALIGN_PARENT_CENTER=5,r.RELATIVE_ALIGN_PARENT_RIGHT_CENTER_VERTICAL=6,r.RELATIVE_ALIGN_PARENT_LEFT_BOTTOM=7,r.RELATIVE_ALIGN_PARENT_BOTTOM_CENTER_HORIZONTAL=8,r.RELATIVE_ALIGN_PARENT_RIGHT_BOTTOM=9,r.RELATIVE_ALIGN_LOCATION_ABOVE_LEFT=10,r.RELATIVE_ALIGN_LOCATION_ABOVE_CENTER=11,r.RELATIVE_ALIGN_LOCATION_ABOVE_RIGHT=12,r.RELATIVE_ALIGN_LOCATION_LEFT_TOP=13,r.RELATIVE_ALIGN_LOCATION_LEFT_CENTER=14,r.RELATIVE_ALIGN_LOCATION_LEFT_BOTTOM=15,r.RELATIVE_ALIGN_LOCATION_RIGHT_TOP=16,r.RELATIVE_ALIGN_LOCATION_RIGHT_CENTER=17,r.RELATIVE_ALIGN_LOCATION_RIGHT_BOTTOM=18,r.RELATIVE_ALIGN_LOCATION_BELOW_TOP=19,r.RELATIVE_ALIGN_LOCATION_BELOW_CENTER=20,r.RELATIVE_ALIGN_LOCATION_BELOW_BOTTOM=21,r.getLayoutManager=function(t){switch(t){case r.Layout.Type.LINEAR_VERTICAL:return r.linearVerticalLayoutManager;case r.Layout.Type.LINEAR_HORIZONTAL:return r.linearHorizontalLayoutManager;case r.Layout.Type.RELATIVE:return r.relativeLayoutManager}return null},r.linearVerticalLayoutManager={_doLayout:function(t){for(var e=t._getLayoutContentSize(),i=t._getLayoutElements(),n=e.height,s=0,o=i.length;o>s;s++){var a=i[s];if(a){var c=a.getLayoutParameter();if(c){var h=c.getGravity(),l=a.getAnchorPoint(),d=a.getContentSize(),u=l.x*d.width,_=n-(1-l.y)*d.height;switch(h){case r.LinearLayoutParameter.NONE:case r.LinearLayoutParameter.LEFT:break;case r.LinearLayoutParameter.RIGHT:u=e.width-(1-l.x)*d.width;break;case r.LinearLayoutParameter.CENTER_HORIZONTAL:u=e.width/2-d.width*(.5-l.x)}var f=c.getMargin();u+=f.left,_-=f.top,a.setPosition(u,_),n=a.getPositionY()-l.y*d.height-f.bottom}}}}},r.linearHorizontalLayoutManager={_doLayout:function(t){for(var e=t._getLayoutContentSize(),i=t._getLayoutElements(),n=0,s=0,o=i.length;o>s;s++){var a=i[s];if(a){var c=a.getLayoutParameter();if(c){var h=c.getGravity(),l=a.getAnchorPoint(),d=a.getContentSize(),u=n+l.x*d.width,_=e.height-(1-l.y)*d.height;switch(h){case r.LinearLayoutParameter.NONE:case r.LinearLayoutParameter.TOP:break;case r.LinearLayoutParameter.BOTTOM:_=l.y*d.height;break;case r.LinearLayoutParameter.CENTER_VERTICAL:_=e.height/2-d.height*(.5-l.y)}var f=c.getMargin();u+=f.left,_-=f.top,a.setPosition(u,_),n=a.getRightBoundary()+f.right}}}}},r.relativeLayoutManager={_unlayoutChildCount:0,_widgetChildren:[],_widget:null,_finalPositionX:0,_finalPositionY:0,_relativeWidgetLP:null,_doLayout:function(t){this._widgetChildren=this._getAllWidgets(t);for(var e=this._widgetChildren;this._unlayoutChildCount>0;){for(var i=0,n=e.length;n>i;i++){this._widget=e[i];var r=this._widget.getLayoutParameter();if(r){if(r._put)continue;var s=this._calculateFinalPositionWithRelativeWidget(t);if(!s)continue;this._calculateFinalPositionWithRelativeAlign(),this._widget.setPosition(this._finalPositionX,this._finalPositionY),r._put=!0}}this._unlayoutChildCount--}this._widgetChildren.length=0},_getAllWidgets:function(t){var e=t._getLayoutElements(),i=this._widgetChildren;i.length=0;for(var n=0,r=e.length;r>n;n++){var s=e[n];if(s){var o=s.getLayoutParameter();o._put=!1,this._unlayoutChildCount++,i.push(s)}}return i},_getRelativeWidget:function(t){var e=null,i=t.getLayoutParameter(),n=i.getRelativeToWidgetName();if(n&&0!==n.length)for(var r=this._widgetChildren,s=0,o=r.length;o>s;s++){var a=r[s];if(a){var c=a.getLayoutParameter();if(c&&c.getRelativeName()===n){e=a,this._relativeWidgetLP=c;break}}}return e},_calculateFinalPositionWithRelativeWidget:function(t){var e=this._widget,i=e.getAnchorPoint(),n=e.getContentSize();this._finalPositionX=0,this._finalPositionY=0;var s=this._getRelativeWidget(e),o=e.getLayoutParameter(),a=o.getAlign(),c=t._getLayoutContentSize();switch(a){case r.RelativeLayoutParameter.Type.NONE:case r.RelativeLayoutParameter.Type.PARENT_TOP_LEFT:this._finalPositionX=i.x*n.width,this._finalPositionY=c.height-(1-i.y)*n.height;break;case r.RelativeLayoutParameter.Type.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionX=.5*c.width-n.width*(.5-i.x),this._finalPositionY=c.height-(1-i.y)*n.height;break;case r.RelativeLayoutParameter.Type.PARENT_TOP_RIGHT:this._finalPositionX=c.width-(1-i.x)*n.width,this._finalPositionY=c.height-(1-i.y)*n.height;break;case r.RelativeLayoutParameter.Type.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX=i.x*n.width,this._finalPositionY=.5*c.height-n.height*(.5-i.y);break;case r.RelativeLayoutParameter.Type.CENTER_IN_PARENT:this._finalPositionX=.5*c.width-n.width*(.5-i.x),this._finalPositionY=.5*c.height-n.height*(.5-i.y);break;case r.RelativeLayoutParameter.Type.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX=c.width-(1-i.x)*n.width,this._finalPositionY=.5*c.height-n.height*(.5-i.y);break;case r.RelativeLayoutParameter.Type.PARENT_LEFT_BOTTOM:this._finalPositionX=i.x*n.width,this._finalPositionY=i.y*n.height;break;case r.RelativeLayoutParameter.Type.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionX=.5*c.width-n.width*(.5-i.x),this._finalPositionY=i.y*n.height;break;case r.RelativeLayoutParameter.Type.PARENT_RIGHT_BOTTOM:this._finalPositionX=c.width-(1-i.x)*n.width,this._finalPositionY=i.y*n.height;break;case r.RelativeLayoutParameter.Type.LOCATION_ABOVE_LEFTALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getTopBoundary()+i.y*n.height,this._finalPositionX=s.getLeftBoundary()+i.x*n.width}break;case r.RelativeLayoutParameter.Type.LOCATION_ABOVE_CENTER:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;var h=s.getContentSize();this._finalPositionY=s.getTopBoundary()+i.y*n.height,this._finalPositionX=s.getLeftBoundary()+.5*h.width+i.x*n.width-.5*n.width}break;case r.RelativeLayoutParameter.Type.LOCATION_ABOVE_RIGHTALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getTopBoundary()+i.y*n.height,this._finalPositionX=s.getRightBoundary()-(1-i.x)*n.width}break;case r.RelativeLayoutParameter.Type.LOCATION_LEFT_OF_TOPALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getTopBoundary()-(1-i.y)*n.height,this._finalPositionX=s.getLeftBoundary()-(1-i.x)*n.width}break;case r.RelativeLayoutParameter.Type.LOCATION_LEFT_OF_CENTER:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;var h=s.getContentSize();this._finalPositionX=s.getLeftBoundary()-(1-i.x)*n.width,this._finalPositionY=s.getBottomBoundary()+.5*h.height+i.y*n.height-.5*n.height}break;case r.RelativeLayoutParameter.Type.LOCATION_LEFT_OF_BOTTOMALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getBottomBoundary()+i.y*n.height,this._finalPositionX=s.getLeftBoundary()-(1-i.x)*n.width}break;case r.RelativeLayoutParameter.Type.LOCATION_RIGHT_OF_TOPALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getTopBoundary()-(1-i.y)*n.height,this._finalPositionX=s.getRightBoundary()+i.x*n.width}break;case r.RelativeLayoutParameter.Type.LOCATION_RIGHT_OF_CENTER:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;var h=s.getContentSize(),l=s.getRightBoundary();this._finalPositionX=l+i.x*n.width,this._finalPositionY=s.getBottomBoundary()+.5*h.height+i.y*n.height-.5*n.height}break;case r.RelativeLayoutParameter.Type.LOCATION_RIGHT_OF_BOTTOMALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getBottomBoundary()+i.y*n.height,this._finalPositionX=s.getRightBoundary()+i.x*n.width}break;case r.RelativeLayoutParameter.Type.LOCATION_BELOW_LEFTALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getBottomBoundary()-(1-i.y)*n.height,this._finalPositionX=s.getLeftBoundary()+i.x*n.width}break;case r.RelativeLayoutParameter.Type.LOCATION_BELOW_CENTER:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;var h=s.getContentSize();this._finalPositionY=s.getBottomBoundary()-(1-i.y)*n.height,this._finalPositionX=s.getLeftBoundary()+.5*h.width+i.x*n.width-.5*n.width}break;case r.RelativeLayoutParameter.Type.LOCATION_BELOW_RIGHTALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getBottomBoundary()-(1-i.y)*n.height,this._finalPositionX=s.getRightBoundary()-(1-i.x)*n.width}}return!0},_calculateFinalPositionWithRelativeAlign:function(){var t=this._widget.getLayoutParameter(),e=t.getMargin(),i=t.getAlign();switch(i){case r.RelativeLayoutParameter.Type.NONE:case r.RelativeLayoutParameter.Type.PARENT_TOP_LEFT:this._finalPositionX+=e.left,this._finalPositionY-=e.top;break;case r.RelativeLayoutParameter.Type.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionY-=e.top;break;case r.RelativeLayoutParameter.Type.PARENT_TOP_RIGHT:this._finalPositionX-=e.right,this._finalPositionY-=e.top;break;case r.RelativeLayoutParameter.Type.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX+=e.left;break;case r.RelativeLayoutParameter.Type.CENTER_IN_PARENT:break;case r.RelativeLayoutParameter.Type.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX-=e.right;break;case r.RelativeLayoutParameter.Type.PARENT_LEFT_BOTTOM:this._finalPositionX+=e.left,this._finalPositionY+=e.bottom;break;case r.RelativeLayoutParameter.Type.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionY+=e.bottom;break;case r.RelativeLayoutParameter.Type.PARENT_RIGHT_BOTTOM:this._finalPositionX-=e.right,this._finalPositionY+=e.bottom;break;case r.RelativeLayoutParameter.Type.LOCATION_ABOVE_LEFTALIGN:this._finalPositionY+=e.bottom,this._finalPositionX+=e.left;break;case r.RelativeLayoutParameter.Type.LOCATION_ABOVE_RIGHTALIGN:this._finalPositionY+=e.bottom,this._finalPositionX-=e.right;break;case r.RelativeLayoutParameter.Type.LOCATION_ABOVE_CENTER:this._finalPositionY+=e.bottom;break;case r.RelativeLayoutParameter.Type.LOCATION_LEFT_OF_TOPALIGN:this._finalPositionX-=e.right,this._finalPositionY-=e.top;break;case r.RelativeLayoutParameter.Type.LOCATION_LEFT_OF_BOTTOMALIGN:this._finalPositionX-=e.right,this._finalPositionY+=e.bottom;break;case r.RelativeLayoutParameter.Type.LOCATION_LEFT_OF_CENTER:this._finalPositionX-=e.right;break;case r.RelativeLayoutParameter.Type.LOCATION_RIGHT_OF_TOPALIGN:this._finalPositionX+=e.left,this._finalPositionY-=e.top;break;case r.RelativeLayoutParameter.Type.LOCATION_RIGHT_OF_BOTTOMALIGN:this._finalPositionX+=e.left,this._finalPositionY+=e.bottom;break;case r.RelativeLayoutParameter.Type.LOCATION_RIGHT_OF_CENTER:this._finalPositionX+=e.left;break;case r.RelativeLayoutParameter.Type.LOCATION_BELOW_LEFTALIGN:this._finalPositionY-=e.top,this._finalPositionX+=e.left;break;case r.RelativeLayoutParameter.Type.LOCATION_BELOW_RIGHTALIGN:this._finalPositionY-=e.top,this._finalPositionX-=e.right;break;case r.RelativeLayoutParameter.Type.LOCATION_BELOW_CENTER:this._finalPositionY-=e.top}}},r.HBox=r.Layout.extend({ctor:function(t){r.Layout.prototype.ctor.call(this,t),void 0!==t?this.initWithSize(t):this.init()},init:function(){return r.Layout.prototype.init.call(this)?(this.setLayoutType(r.Layout.Type.LINEAR_HORIZONTAL),!0):!1},initWithSize:function(t){return this.init()?(this.setContentSize(t),!0):!1}}),r.HBox.create=function(t){return new r.HBox(t)},r.VBox=r.Layout.extend({ctor:function(t){r.Layout.prototype.ctor.call(this,t),void 0!==t?this.initWithSize(t):this.init()},init:function(){return r.Layout.prototype.init.call(this)?(this.setLayoutType(r.Layout.Type.LINEAR_VERTICAL),!0):!1},initWithSize:function(t){return this.init()?(this.setContentSize(t),!0):!1}}),r.VBox.create=function(t){return new r.VBox(t)},r.RelativeBox=r.Layout.extend({ctor:function(t){t?this.initWithSize(t):this.init()},init:function(){return r.Layout.prototype.init.call(this)?(this.setLayoutType(r.Layout.Type.RELATIVE),!0):!1},initWithSize:function(t){return this.init()?(this.setContentSize(t),!0):!1}}),r.RelativeBox.create=function(t){return new r.RelativeBox(t)},r.helper={seekWidgetByTag:function(t,e){if(!t)return null;if(t.getTag()===e)return t;for(var i=t.getChildren(),n=i.length,s=0;n>s;s++){var o=i[s],a=r.helper.seekWidgetByTag(o,e);if(null!==a)return a}return null},seekWidgetByName:function(t,e){if(!t)return null;if(t.getName()===e)return t;for(var i=t.getChildren(),n=i.length,s=0;n>s;s++){var o=i[s],a=r.helper.seekWidgetByName(o,e);if(null!==a)return a}return null},seekWidgetByRelativeName:function(t,e){if(!t)return null;for(var i=t.getChildren(),n=i.length,s=0;n>s;s++){var o=i[s],a=o.getLayoutParameter(r.LayoutParameter.RELATIVE);if(a&&a.getRelativeName()===e)return o}return null},seekActionWidgetByActionTag:function(t,e){if(!t)return null;if(t.getActionTag()===e)return t;for(var i=t.getChildren(),n=0;n<i.length;n++){var s=i[n],o=r.helper.seekActionWidgetByActionTag(s,e);if(null!==o)return o}return null},_activeLayout:!0,doLayout:function(t){if(this._activeLayout)for(var e,i=t.getChildren(),n=0,s=i.length;s>n;n++){e=i[n];var o=e.getComponent(r.LayoutComponent.NAME),a=e.getParent();null!=o&&null!==a&&o.refreshLayout&&o.refreshLayout()}},changeLayoutSystemActiveState:function(t){this._activeLayout=t},restrictCapInsetRect:function(t,e){var i=t.x,r=t.y,s=t.width,o=t.height;return e.width<s&&(i=0,s=0),e.height<o&&(r=0,o=0),n.rect(i,r,s,o)}},r.Button=r.Widget.extend({_buttonNormalRenderer:null,_buttonClickedRenderer:null,_buttonDisableRenderer:null,_titleRenderer:null,_normalFileName:"",_clickedFileName:"",_disabledFileName:"",_prevIgnoreSize:!0,_scale9Enabled:!1,_capInsetsNormal:null,_capInsetsPressed:null,_capInsetsDisabled:null,_normalTexType:r.Widget.LOCAL_TEXTURE,_pressedTexType:r.Widget.LOCAL_TEXTURE,_disabledTexType:r.Widget.LOCAL_TEXTURE,_normalTextureSize:null,_pressedTextureSize:null,_disabledTextureSize:null,pressedActionEnabled:!1,_titleColor:null,_normalTextureScaleXInSize:1,_normalTextureScaleYInSize:1,_pressedTextureScaleXInSize:1,_pressedTextureScaleYInSize:1,_zoomScale:.1,_normalTextureLoaded:!1,_pressedTextureLoaded:!1,_disabledTextureLoaded:!1,_className:"Button",_normalTextureAdaptDirty:!0,_pressedTextureAdaptDirty:!0,_disabledTextureAdaptDirty:!0,_fontName:"Thonburi",_fontSize:12,_type:0,ctor:function(t,e,i,s){this._capInsetsNormal=n.rect(0,0,0,0),this._capInsetsPressed=n.rect(0,0,0,0),this._capInsetsDisabled=n.rect(0,0,0,0),this._normalTextureSize=n.size(0,0),this._pressedTextureSize=n.size(0,0),this._disabledTextureSize=n.size(0,0),this._titleColor=n.Color.WHITE,r.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0),this.init(t,e,i,s)},init:function(t,e,i,n){if(r.Widget.prototype.init.call(this)){if(void 0===t)return!0;this.loadTextures(t,e,i,n)}return!1},_initRenderer:function(){this._buttonNormalRenderer=new n.Sprite,this._buttonClickedRenderer=new n.Sprite,this._buttonDisableRenderer=new n.Sprite,this._titleRenderer=new n.LabelTTF(""),this._titleRenderer.setAnchorPoint(.5,.5),this.addProtectedChild(this._buttonNormalRenderer,r.Button.NORMAL_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonClickedRenderer,r.Button.PRESSED_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonDisableRenderer,r.Button.DISABLED_RENDERER_ZORDER,-1),this.addProtectedChild(this._titleRenderer,r.Button.TITLE_RENDERER_ZORDER,-1)},setScale9Enabled:function(t){if(this._scale9Enabled!==t){if(this._brightStyle=r.Widget.BRIGHT_STYLE_NONE,this._scale9Enabled=t,this.removeProtectedChild(this._buttonNormalRenderer),this.removeProtectedChild(this._buttonClickedRenderer),this.removeProtectedChild(this._buttonDisableRenderer),this._scale9Enabled?(this._buttonNormalRenderer=new r.Scale9Sprite,this._buttonClickedRenderer=new r.Scale9Sprite,this._buttonDisableRenderer=new r.Scale9Sprite):(this._buttonNormalRenderer=new n.Sprite,this._buttonClickedRenderer=new n.Sprite,this._buttonDisableRenderer=new n.Sprite),this._buttonClickedRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!1),this.loadTextureNormal(this._normalFileName,this._normalTexType),this.loadTexturePressed(this._clickedFileName,this._pressedTexType),this.loadTextureDisabled(this._disabledFileName,this._disabledTexType),this.addProtectedChild(this._buttonNormalRenderer,r.Button.NORMAL_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonClickedRenderer,r.Button.PRESSED_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonDisableRenderer,r.Button.DISABLED_RENDERER_ZORDER,-1),this._scale9Enabled){
var e=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=e}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsetsNormalRenderer(this._capInsetsNormal),this.setCapInsetsPressedRenderer(this._capInsetsPressed),this.setCapInsetsDisabledRenderer(this._capInsetsDisabled),this.setBright(this._bright),this._normalTextureAdaptDirty=!0,this._pressedTextureAdaptDirty=!0,this._disabledTextureAdaptDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){return this._unifySize?void this._updateContentSize():void((!this._scale9Enabled||this._scale9Enabled&&!t)&&(r.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t))},getVirtualRendererSize:function(){return this._unifySize?this._getNormalSize():!this._normalTextureLoaded&&this._titleRenderer.getString().length>0?this._titleRenderer.getContentSize():n.size(this._normalTextureSize)},loadTextures:function(t,e,i,n){this.loadTextureNormal(t,n),this.loadTexturePressed(e,n),this.loadTextureDisabled(i,n)},loadTextureNormal:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._normalFileName=t,this._normalTexType=e;var i=this,n=this._buttonNormalRenderer;switch(n._textureLoaded||n.once("load",function(){i.loadTextureNormal(i._normalFileName,i._normalTexType)}),this._normalTexType){case r.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t)}this._normalTextureLoaded=n._textureLoaded,this._normalTextureSize=this._buttonNormalRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._unifySize?this._scale9Enabled&&(n.setCapInsets(this._capInsetsNormal),this._updateContentSizeWithTextureSize(this._getNormalSize())):this._updateContentSizeWithTextureSize(this._normalTextureSize),this._normalTextureAdaptDirty=!0,this._findLayout()}},loadTexturePressed:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._clickedFileName=t,this._pressedTexType=e;var i=this,n=this._buttonClickedRenderer;switch(n._textureLoaded||n.once("load",function(){i.loadTexturePressed(i._clickedFileName,i._pressedTexType)}),this._pressedTexType){case r.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t)}this._scale9Enabled&&n.setCapInsets(this._capInsetsPressed),this._pressedTextureSize=this._buttonClickedRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._pressedTextureLoaded=!0,this._pressedTextureAdaptDirty=!0,this._findLayout()}},loadTextureDisabled:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._disabledFileName=t,this._disabledTexType=e;var i=this,n=this._buttonDisableRenderer;switch(n._textureLoaded||n.once("load",function(){i.loadTextureDisabled(i._disabledFileName,i._disabledTexType)}),this._disabledTexType){case r.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t)}this._scale9Enabled&&n.setCapInsets(this._capInsetsDisabled),this._disabledTextureSize=this._buttonDisableRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._disabledTextureLoaded=!0,this._disabledTextureAdaptDirty=!0,this._findLayout()}},setCapInsets:function(t){this.setCapInsetsNormalRenderer(t),this.setCapInsetsPressedRenderer(t),this.setCapInsetsDisabledRenderer(t)},setCapInsetsNormalRenderer:function(t){if(t){var e=t.x,i=t.y,n=t.width,r=t.height;this._normalTextureSize.width<n&&(e=0,n=0),this._normalTextureSize.height<r&&(i=0,r=0);var s=this._capInsetsNormal;s.x=e,s.y=i,s.width=n,s.height=r,this._scale9Enabled&&this._buttonNormalRenderer.setCapInsets(s)}},getCapInsetsNormalRenderer:function(){return n.rect(this._capInsetsNormal)},setCapInsetsPressedRenderer:function(t){if(t&&this._scale9Enabled){var e=t.x,i=t.y,n=t.width,r=t.height;this._pressedTextureSize.width<n&&(e=0,n=0),this._pressedTextureSize.height<r&&(i=0,r=0);var s=this._capInsetsPressed;s.x=e,s.y=i,s.width=n,s.height=r,this._buttonClickedRenderer.setCapInsets(s)}},getCapInsetsPressedRenderer:function(){return n.rect(this._capInsetsPressed)},setCapInsetsDisabledRenderer:function(t){if(t&&this._scale9Enabled){var e=t.x,i=t.y,n=t.width,r=t.height;this._disabledTextureSize.width<n&&(e=0,n=0),this._disabledTextureSize.height<r&&(i=0,r=0);var s=this._capInsetsDisabled;s.x=e,s.y=i,s.width=n,s.height=r,this._buttonDisableRenderer.setCapInsets(s)}},getCapInsetsDisabledRenderer:function(){return n.rect(this._capInsetsDisabled)},_onPressStateChangedToNormal:function(){if(this._buttonNormalRenderer.setVisible(!0),this._buttonClickedRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!1),this._scale9Enabled&&this._buttonNormalRenderer.setState(r.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded){if(this.pressedActionEnabled)if(this._buttonNormalRenderer.stopAllActions(),this._buttonClickedRenderer.stopAllActions(),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize),this._titleRenderer.stopAllActions(),this._unifySize){var t=n.scaleTo(r.Button.ZOOM_ACTION_TIME_STEP,1,1);this._titleRenderer.runAction(t)}else this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1)}else this._buttonNormalRenderer.stopAllActions(),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._titleRenderer.stopAllActions(),this._scale9Enabled&&this._buttonNormalRenderer.setColor(n.Color.WHITE),this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1)},_onPressStateChangedToPressed:function(){var t=this._buttonNormalRenderer;if(this._scale9Enabled&&t.setState(r.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded){if(t.setVisible(!1),this._buttonClickedRenderer.setVisible(!0),this._buttonDisableRenderer.setVisible(!1),this.pressedActionEnabled){t.stopAllActions(),this._buttonClickedRenderer.stopAllActions();var e=n.scaleTo(r.Button.ZOOM_ACTION_TIME_STEP,this._pressedTextureScaleXInSize+this._zoomScale,this._pressedTextureScaleYInSize+this._zoomScale);this._buttonClickedRenderer.runAction(e),t.setScale(this._pressedTextureScaleXInSize+this._zoomScale,this._pressedTextureScaleYInSize+this._zoomScale),this._titleRenderer.stopAllActions(),this._titleRenderer.runAction(n.scaleTo(r.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale))}}else t.setVisible(!0),this._buttonClickedRenderer.setVisible(!0),this._buttonDisableRenderer.setVisible(!1),t.stopAllActions(),t.setScale(this._normalTextureScaleXInSize+this._zoomScale,this._normalTextureScaleYInSize+this._zoomScale),this._titleRenderer.stopAllActions(),this._titleRenderer.setScaleX(1+this._zoomScale),this._titleRenderer.setScaleY(1+this._zoomScale)},_onPressStateChangedToDisabled:function(){this._disabledTextureLoaded?(this._buttonNormalRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!0)):this._normalTextureLoaded&&this._scale9Enabled&&this._buttonNormalRenderer.setState(r.Scale9Sprite.state.GRAY),this._buttonClickedRenderer.setVisible(!1),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize)},_updateContentSize:function(){if(this._unifySize){if(this._scale9Enabled)r.ProtectedNode.setContentSize(this._customSize);else{var t=this._getNormalSize();r.ProtectedNode.setContentSize(t)}return void this._onSizeChanged()}this._ignoreSize&&this.setContentSize(this.getVirtualRendererSize())},_onSizeChanged:function(){r.Widget.prototype._onSizeChanged.call(this),this._updateTitleLocation(),this._normalTextureAdaptDirty=!0,this._pressedTextureAdaptDirty=!0,this._disabledTextureAdaptDirty=!0},getVirtualRenderer:function(){if(!this._bright)return this._buttonDisableRenderer;switch(this._brightStyle){case r.Widget.BRIGHT_STYLE_NORMAL:return this._buttonNormalRenderer;case r.Widget.BRIGHT_STYLE_HIGH_LIGHT:return this._buttonClickedRenderer;default:return null}},_normalTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled||(this._buttonNormalRenderer.setScale(1),this._normalTextureScaleXInSize=this._normalTextureScaleYInSize=1);else if(this._scale9Enabled)this._buttonNormalRenderer.setPreferredSize(this._contentSize),this._normalTextureScaleXInSize=this._normalTextureScaleYInSize=1,this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize);else{var t=this._normalTextureSize;if(t.width<=0||t.height<=0)return void this._buttonNormalRenderer.setScale(1);var e=this._contentSize.width/t.width,i=this._contentSize.height/t.height;this._buttonNormalRenderer.setScaleX(e),this._buttonNormalRenderer.setScaleY(i),this._normalTextureScaleXInSize=e,this._normalTextureScaleYInSize=i}this._buttonNormalRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_pressedTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled||(this._buttonClickedRenderer.setScale(1),this._pressedTextureScaleXInSize=this._pressedTextureScaleYInSize=1);else if(this._scale9Enabled)this._buttonClickedRenderer.setPreferredSize(this._contentSize),this._pressedTextureScaleXInSize=this._pressedTextureScaleYInSize=1,this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize);else{var t=this._pressedTextureSize;if(t.width<=0||t.height<=0)return void this._buttonClickedRenderer.setScale(1);var e=this._contentSize.width/t.width,i=this._contentSize.height/t.height;this._buttonClickedRenderer.setScaleX(e),this._buttonClickedRenderer.setScaleY(i),this._pressedTextureScaleXInSize=e,this._pressedTextureScaleYInSize=i}this._buttonClickedRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_disabledTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled&&this._buttonDisableRenderer.setScale(1);else if(this._scale9Enabled)this._buttonDisableRenderer.setScale(1),this._buttonDisableRenderer.setPreferredSize(this._contentSize);else{var t=this._disabledTextureSize;if(t.width<=0||t.height<=0)return void this._buttonDisableRenderer.setScale(1);var e=this._contentSize.width/t.width,i=this._contentSize.height/t.height;this._buttonDisableRenderer.setScaleX(e),this._buttonDisableRenderer.setScaleY(i)}this._buttonDisableRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_adaptRenderers:function(){this._normalTextureAdaptDirty&&(this._normalTextureScaleChangedWithSize(),this._normalTextureAdaptDirty=!1),this._pressedTextureAdaptDirty&&(this._pressedTextureScaleChangedWithSize(),this._pressedTextureAdaptDirty=!1),this._disabledTextureAdaptDirty&&(this._disabledTextureScaleChangedWithSize(),this._disabledTextureAdaptDirty=!1)},_updateTitleLocation:function(){this._titleRenderer.setPosition(.5*this._contentSize.width,.5*this._contentSize.height)},setPressedActionEnabled:function(t){this.pressedActionEnabled=t},setTitleText:function(t){if(t!==this.getTitleText())if(this._titleRenderer.setString(t),this._ignoreSize){var e=this.getVirtualRendererSize();this.setContentSize(e)}else this._titleRenderer._renderCmd._updateTTF()},getTitleText:function(){return this._titleRenderer.getString()},setTitleColor:function(t){this._titleRenderer.setFontFillColor(t)},getTitleColor:function(){return this._titleRenderer._getFillStyle()},setTitleFontSize:function(t){this._titleRenderer.setFontSize(t),this._fontSize=t},getTitleFontSize:function(){return this._titleRenderer.getFontSize()},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getNormalTextureSize:function(){return this._normalTextureSize},setTitleFontName:function(t){this._titleRenderer.setFontName(t),this._fontName=t},getTitleRenderer:function(){return this._titleRenderer},getTitleFontName:function(){return this._titleRenderer.getFontName()},_setTitleFont:function(t){this._titleRenderer.font=t},_getTitleFont:function(){return this._titleRenderer.font},getDescription:function(){return"Button"},_createCloneInstance:function(){return new r.Button},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTextureNormal(t._normalFileName,t._normalTexType),this.loadTexturePressed(t._clickedFileName,t._pressedTexType),this.loadTextureDisabled(t._disabledFileName,t._disabledTexType),this.setCapInsetsNormalRenderer(t._capInsetsNormal),this.setCapInsetsPressedRenderer(t._capInsetsPressed),this.setCapInsetsDisabledRenderer(t._capInsetsDisabled),this.setTitleText(t.getTitleText()),this.setTitleFontName(t.getTitleFontName()),this.setTitleFontSize(t.getTitleFontSize()),this.setTitleColor(t.getTitleColor()),this.setPressedActionEnabled(t.pressedActionEnabled),this.setZoomScale(t._zoomScale)},_getNormalSize:function(){var t;null!==this._titleRenderer&&(t=this._titleRenderer.getContentSize());var e;null!==this._buttonNormalRenderer&&(e=this._buttonNormalRenderer.getContentSize());var i=t.width>e.width?t.width:e.width,r=t.height>e.height?t.height:e.height;return n.size(i,r)}});var c=r.Button.prototype;c.titleText,n.defineGetterSetter(c,"titleText",c.getTitleText,c.setTitleText),c.titleFont,n.defineGetterSetter(c,"titleFont",c._getTitleFont,c._setTitleFont),c.titleFontSize,n.defineGetterSetter(c,"titleFontSize",c.getTitleFontSize,c.setTitleFontSize),c.titleFontName,n.defineGetterSetter(c,"titleFontName",c.getTitleFontName,c.setTitleFontName),c.titleColor,n.defineGetterSetter(c,"titleColor",c.getTitleColor,c.setTitleColor),c=null,r.Button.create=function(t,e,i,n){return new r.Button(t,e,i,n)},r.Button.NORMAL_RENDERER_ZORDER=-2,r.Button.PRESSED_RENDERER_ZORDER=-2,r.Button.DISABLED_RENDERER_ZORDER=-2,r.Button.TITLE_RENDERER_ZORDER=-1,r.Button.ZOOM_ACTION_TIME_STEP=.05,r.Button.SYSTEM=0,r.Button.TTF=1,r.CheckBox=r.Widget.extend({_backGroundBoxRenderer:null,_backGroundSelectedBoxRenderer:null,_frontCrossRenderer:null,_backGroundBoxDisabledRenderer:null,_frontCrossDisabledRenderer:null,_isSelected:!0,_checkBoxEventListener:null,_checkBoxEventSelector:null,_backGroundTexType:r.Widget.LOCAL_TEXTURE,_backGroundSelectedTexType:r.Widget.LOCAL_TEXTURE,_frontCrossTexType:r.Widget.LOCAL_TEXTURE,_backGroundDisabledTexType:r.Widget.LOCAL_TEXTURE,_frontCrossDisabledTexType:r.Widget.LOCAL_TEXTURE,_backGroundFileName:"",_backGroundSelectedFileName:"",_frontCrossFileName:"",_backGroundDisabledFileName:"",_frontCrossDisabledFileName:"",_className:"CheckBox",_zoomScale:.1,_backgroundTextureScaleX:.1,_backgroundTextureScaleY:.1,_backGroundBoxRendererAdaptDirty:!0,_backGroundSelectedBoxRendererAdaptDirty:!0,_frontCrossRendererAdaptDirty:!0,_backGroundBoxDisabledRendererAdaptDirty:!0,_frontCrossDisabledRendererAdaptDirty:!0,ctor:function(t,e,i,n,s,o){r.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0);for(var a=0,c=0;c<arguments.length;c++){var h=typeof arguments[c];"string"===h?isNaN(arguments[c]-0)?a++:(o=arguments[c],arguments[c]=void 0):"number"===h&&a++}switch(a){case 2:o=i,i=e,e=void 0}o=void 0===o?0:o,this.init(t,e,i,n,s,o)},init:function(t,e,i,n,s,o){return r.Widget.prototype.init.call(this)?(this._isSelected=!0,this.setSelected(!1),this.loadTextures(t,e,i,n,s,o),!0):!1},_initRenderer:function(){this._backGroundBoxRenderer=new n.Sprite,this._backGroundSelectedBoxRenderer=new n.Sprite,this._frontCrossRenderer=new n.Sprite,this._backGroundBoxDisabledRenderer=new n.Sprite,this._frontCrossDisabledRenderer=new n.Sprite,this.addProtectedChild(this._backGroundBoxRenderer,r.CheckBox.BOX_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundSelectedBoxRenderer,r.CheckBox.BOX_SELECTED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossRenderer,r.CheckBox.FRONT_CROSS_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundBoxDisabledRenderer,r.CheckBox.BOX_DISABLED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossDisabledRenderer,r.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER,-1)},loadTextures:function(t,e,i,n,r,s){t&&this.loadTextureBackGround(t,s),e&&this.loadTextureBackGroundSelected(e,s),i&&this.loadTextureFrontCross(i,s),n&&this.loadTextureBackGroundDisabled(n,s),r&&this.loadTextureFrontCrossDisabled(r,s)},loadTextureBackGround:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._backGroundFileName=t,this._backGroundTexType=e;var i=this._backGroundBoxRenderer;switch(i._textureLoaded?this._backGroundBoxRenderer.setContentSize(this._customSize):i.once("load",function(){this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this.loadTextureBackGround(this._backGroundFileName,this._backGroundTexType)},this),this._backGroundTexType){case r.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this._backGroundBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundSelected:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._backGroundSelectedFileName=t,this._backGroundSelectedTexType=e;var i=this._backGroundSelectedBoxRenderer;switch(i._textureLoaded||i.once("load",function(){this.loadTextureBackGroundSelected(this._backGroundSelectedFileName,this._backGroundSelectedTexType)},this),this._backGroundSelectedTexType){case r.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._backGroundSelectedBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCross:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._frontCrossFileName=t,this._frontCrossTexType=e;var i=this._frontCrossRenderer;switch(i._textureLoaded||i.once("load",function(){this.loadTextureFrontCross(this._frontCrossFileName,this._frontCrossTexType)},this),this._frontCrossTexType){case r.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._frontCrossRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundDisabled:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._backGroundDisabledFileName=t,this._backGroundDisabledTexType=e;var i=this._backGroundBoxDisabledRenderer;switch(i._textureLoaded||i.once("load",function(){this.loadTextureBackGroundDisabled(this._backGroundDisabledFileName,this._backGroundDisabledTexType)},this),this._backGroundDisabledTexType){case r.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._backGroundBoxDisabledRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCrossDisabled:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._frontCrossDisabledFileName=t,this._frontCrossDisabledTexType=e;var i=this._frontCrossDisabledRenderer;switch(i._textureLoaded||i.once("load",function(){this.loadTextureFrontCrossDisabled(this._frontCrossDisabledFileName,this._frontCrossDisabledTexType)},this),this._frontCrossDisabledTexType){case r.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._frontCrossDisabledRendererAdaptDirty=!0,this._findLayout()}},_onPressStateChangedToNormal:function(){this._backGroundBoxRenderer.setVisible(!0),this._backGroundSelectedBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossRenderer.setVisible(!0),this._frontCrossRendererAdaptDirty=!0)},_onPressStateChangedToPressed:function(){this._backGroundSelectedFileName?(this._backGroundBoxRenderer.setVisible(!1),this._backGroundSelectedBoxRenderer.setVisible(!0),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1)):(this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._backGroundDisabledFileName&&this._frontCrossDisabledFileName&&(this._backGroundBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!0)),this._backGroundSelectedBoxRenderer.setVisible(!1),this._frontCrossRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossDisabledRenderer.setVisible(!0),this._frontCrossDisabledRendererAdaptDirty=!0)},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},setSelectedState:function(t){this.setSelected(t)},setSelected:function(t){t!==this._isSelected&&(this._isSelected=t,this._frontCrossRenderer.setVisible(this._isSelected))},getSelectedState:function(){return this.isSelected()},isSelected:function(){return this._isSelected},_selectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,r.CheckBox.EVENT_SELECTED):this._checkBoxEventSelector(this,r.CheckBox.EVENT_SELECTED))},_unSelectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,r.CheckBox.EVENT_UNSELECTED):this._checkBoxEventSelector(this,r.CheckBox.EVENT_UNSELECTED))},_releaseUpEvent:function(){r.Widget.prototype._releaseUpEvent.call(this),this._isSelected?(this.setSelected(!1),this._unSelectedEvent()):(this.setSelected(!0),this._selectedEvent())},addEventListenerCheckBox:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._checkBoxEventSelector=t,this._checkBoxEventListener=e},getVirtualRendererSize:function(){return this._backGroundBoxRenderer.getContentSize()},_onSizeChanged:function(){r.Widget.prototype._onSizeChanged.call(this),this._backGroundBoxRendererAdaptDirty=!0,this._backGroundSelectedBoxRendererAdaptDirty=!0,this._frontCrossRendererAdaptDirty=!0,this._backGroundBoxDisabledRendererAdaptDirty=!0,this._frontCrossDisabledRendererAdaptDirty=!0},getVirtualRenderer:function(){return this._backGroundBoxRenderer},_backGroundTextureScaleChangedWithSize:function(){var t=this._backGroundBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1),this._backgroundTextureScaleX=this._backgroundTextureScaleY=1;else{var i=t.getContentSize();if(i.width<=0||i.height<=0)return t.setScale(1),void(this._backgroundTextureScaleX=this._backgroundTextureScaleY=1);var n=e.width/i.width,r=e.height/i.height;this._backgroundTextureScaleX=n,this._backgroundTextureScaleY=r,t.setScaleX(n),t.setScaleY(r)}t.setPosition(.5*e.width,.5*e.height)},_backGroundSelectedTextureScaleChangedWithSize:function(){var t=this._backGroundSelectedBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0)return void t.setScale(1);var n=e.width/i.width,r=e.height/i.height;t.setScaleX(n),t.setScaleY(r)}t.setPosition(.5*e.width,.5*e.height)},_frontCrossTextureScaleChangedWithSize:function(){var t=this._frontCrossRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0)return void t.setScale(1);var n=e.width/i.width,r=e.height/i.height;t.setScaleX(n),t.setScaleY(r)}t.setPosition(.5*e.width,.5*e.height)},_backGroundDisabledTextureScaleChangedWithSize:function(){var t=this._backGroundBoxDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0)return void t.setScale(1);var n=e.width/i.width,r=e.height/i.height;t.setScaleX(n),t.setScaleY(r)}t.setPosition(.5*e.width,.5*e.height)},_frontCrossDisabledTextureScaleChangedWithSize:function(){var t=this._frontCrossDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0)return void t.setScale(1);var n=e.width/i.width,r=e.height/i.height;t.setScaleX(n),t.setScaleY(r)}t.setPosition(.5*e.width,.5*e.height)},getDescription:function(){return"CheckBox"},_createCloneInstance:function(){return new r.CheckBox},_copySpecialProperties:function(t){t instanceof r.CheckBox&&(this.loadTextureBackGround(t._backGroundFileName,t._backGroundTexType),this.loadTextureBackGroundSelected(t._backGroundSelectedFileName,t._backGroundSelectedTexType),this.loadTextureFrontCross(t._frontCrossFileName,t._frontCrossTexType),this.loadTextureBackGroundDisabled(t._backGroundDisabledFileName,t._backGroundDisabledTexType),this.loadTextureFrontCrossDisabled(t._frontCrossDisabledFileName,t._frontCrossDisabledTexType),this.setSelected(t._isSelected),this._checkBoxEventListener=t._checkBoxEventListener,this._checkBoxEventSelector=t._checkBoxEventSelector,this._ccEventCallback=t._ccEventCallback,this._zoomScale=t._zoomScale,this._backgroundTextureScaleX=t._backgroundTextureScaleX,this._backgroundTextureScaleY=t._backgroundTextureScaleY)},_adaptRenderers:function(){this._backGroundBoxRendererAdaptDirty&&(this._backGroundTextureScaleChangedWithSize(),this._backGroundBoxRendererAdaptDirty=!1),this._backGroundSelectedBoxRendererAdaptDirty&&(this._backGroundSelectedTextureScaleChangedWithSize(),this._backGroundSelectedBoxRendererAdaptDirty=!1),this._frontCrossRendererAdaptDirty&&(this._frontCrossTextureScaleChangedWithSize(),this._frontCrossRendererAdaptDirty=!1),this._backGroundBoxDisabledRendererAdaptDirty&&(this._backGroundDisabledTextureScaleChangedWithSize(),this._backGroundBoxDisabledRendererAdaptDirty=!1),this._frontCrossDisabledRendererAdaptDirty&&(this._frontCrossDisabledTextureScaleChangedWithSize(),this._frontCrossDisabledRendererAdaptDirty=!1)}});var c=r.CheckBox.prototype;c.selected,n.defineGetterSetter(c,"selected",c.isSelected,c.setSelected),c=null,r.CheckBox.create=function(t,e,i,n,s,o){return new r.CheckBox(t,e,i,n,s,o)},r.CheckBox.EVENT_SELECTED=0,r.CheckBox.EVENT_UNSELECTED=1,r.CheckBox.BOX_RENDERER_ZORDER=-1,r.CheckBox.BOX_SELECTED_RENDERER_ZORDER=-1,r.CheckBox.BOX_DISABLED_RENDERER_ZORDER=-1,r.CheckBox.FRONT_CROSS_RENDERER_ZORDER=-1,r.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER=-1,r.ImageView=r.Widget.extend({_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_imageRenderer:null,_textureFile:"",_imageTexType:r.Widget.LOCAL_TEXTURE,_imageTextureSize:null,_className:"ImageView",_imageRendererAdaptDirty:!0,ctor:function(t,e){this._capInsets=n.rect(0,0,0,0),this._imageTextureSize=n.size(this._capInsets.width,this._capInsets.height),r.Widget.prototype.ctor.call(this),e=void 0===e?0:e,this._init(t,e)},_init:function(t,e){void 0===t?this._imageTexType=r.Widget.LOCAL_TEXTURE:this.loadTexture(t,e)},_initRenderer:function(){this._imageRenderer=new n.Sprite,this.addProtectedChild(this._imageRenderer,r.ImageView.RENDERER_ZORDER,-1)},loadTexture:function(t,e){if(t){var i=this;e=e||r.Widget.LOCAL_TEXTURE,this._textureFile=t,this._imageTexType=e;var n=i._imageRenderer;switch(n._textureLoaded||n.once("load",function(){i.loadTexture(i._textureFile,i._imageTexType)}),i._imageTexType){case r.Widget.LOCAL_TEXTURE:i._scale9Enabled?(n.initWithFile(t),n.setCapInsets(i._capInsets)):n.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:i._scale9Enabled?(n.initWithSpriteFrameName(t),n.setCapInsets(i._capInsets)):n.initWithSpriteFrameName(t)}i._imageTextureSize=n.getContentSize(),this._updateChildrenDisplayedRGBA(),i._updateContentSizeWithTextureSize(i._imageTextureSize),i._imageRendererAdaptDirty=!0,i._findLayout()}},setTextureRect:function(t){this._scale9Enabled||this._imageRenderer.setTextureRect(t)},setScale9Enabled:function(t){if(this._scale9Enabled!==t){if(this._scale9Enabled=t,this.removeProtectedChild(this._imageRenderer),this._imageRenderer=null,this._imageRenderer=this._scale9Enabled?new r.Scale9Sprite:new n.Sprite,this.loadTexture(this._textureFile,this._imageTexType),this.addProtectedChild(this._imageRenderer,r.ImageView.RENDERER_ZORDER,-1),this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=e}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsets(this._capInsets),this._imageRendererAdaptDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(r.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},setCapInsets:function(t){if(t){var e=this._capInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._imageRenderer.setCapInsets(t)}},getCapInsets:function(){return n.rect(this._capInsets)},_onSizeChanged:function(){r.Widget.prototype._onSizeChanged.call(this),this._imageRendererAdaptDirty=!0},_adaptRenderers:function(){this._imageRendererAdaptDirty&&(this._imageTextureScaleChangedWithSize(),this._imageRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return n.size(this._imageTextureSize)},getVirtualRenderer:function(){return this._imageRenderer},_imageTextureScaleChangedWithSize:function(){if(this._ignoreSize)this._scale9Enabled||this._imageRenderer.setScale(1);else if(this._scale9Enabled)this._imageRenderer.setPreferredSize(this._contentSize),this._imageRenderer.setScale(1);else{var t=this._imageTextureSize;if(t.width<=0||t.height<=0)return void this._imageRenderer.setScale(1);this._imageRenderer.setScaleX(this._contentSize.width/t.width),this._imageRenderer.setScaleY(this._contentSize.height/t.height)}this._imageRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"ImageView"},_createCloneInstance:function(){return new r.ImageView},_copySpecialProperties:function(t){t instanceof r.ImageView&&(this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTexture(t._textureFile,t._imageTexType),this.setCapInsets(t._capInsets))},setContentSize:function(t,e){if(null!=e&&(t=n.size(t,e)),r.Widget.prototype.setContentSize.call(this,t),this._scale9Enabled)this._imageRenderer.setContentSize(t);else{var i=this._imageRenderer.getContentSize();this._imageRenderer.setScaleX(t.width/i.width),this._imageRenderer.setScaleY(t.height/i.height)}}}),r.ImageView.create=function(t,e){return new r.ImageView(t,e)},r.ImageView.RENDERER_ZORDER=-1,r.LoadingBar=r.Widget.extend({_direction:null,_percent:100,_totalLength:0,_barRenderer:null,_renderBarTexType:r.Widget.LOCAL_TEXTURE,_barRendererTextureSize:null,_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_textureFile:"",_isTextureLoaded:!1,_className:"LoadingBar",_barRendererAdaptDirty:!0,ctor:function(t,e){this._direction=r.LoadingBar.Type.LEFT,this._barRendererTextureSize=n.size(0,0),this._capInsets=n.rect(0,0,0,0),r.Widget.prototype.ctor.call(this),void 0!==t&&this.loadTexture(t),void 0!==e&&this.setPercent(e)},_initRenderer:function(){this._barRenderer=new n.Sprite,this.addProtectedChild(this._barRenderer,r.LoadingBar.RENDERER_ZORDER,-1),this._barRenderer.setAnchorPoint(0,.5)},setDirection:function(t){if(this._direction!==t)switch(this._direction=t,this._direction){case r.LoadingBar.Type.LEFT:this._barRenderer.setAnchorPoint(0,.5),this._barRenderer.setPosition(0,.5*this._contentSize.height),this._scale9Enabled||this._barRenderer.setFlippedX(!1);break;case r.LoadingBar.Type.RIGHT:this._barRenderer.setAnchorPoint(1,.5),this._barRenderer.setPosition(this._totalLength,.5*this._contentSize.height),this._scale9Enabled||this._barRenderer.setFlippedX(!0)}},getDirection:function(){return this._direction},loadTexture:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,
this._renderBarTexType=e,this._textureFile=t;var i=this._barRenderer,n=this;switch(i._textureLoaded||i.once("load",function(){n.loadTexture(n._textureFile,n._renderBarTexType),n._setPercent(n._percent)}),this._renderBarTexType){case r.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}var s=i.getContentSize();switch(this._barRendererTextureSize.width=s.width,this._barRendererTextureSize.height=s.height,this._direction){case r.LoadingBar.Type.LEFT:i.setAnchorPoint(0,.5),this._scale9Enabled||i.setFlippedX(!1);break;case r.LoadingBar.Type.RIGHT:i.setAnchorPoint(1,.5),this._scale9Enabled||i.setFlippedX(!0)}this._scale9Enabled&&i.setCapInsets(this._capInsets),this._updateChildrenDisplayedRGBA(),this._barRendererScaleChangedWithSize(),this._updateContentSizeWithTextureSize(this._barRendererTextureSize),this._barRendererAdaptDirty=!0,this._findLayout()}},setScale9Enabled:function(t){if(this._scale9Enabled!==t){if(this._scale9Enabled=t,this.removeProtectedChild(this._barRenderer),this._barRenderer=this._scale9Enabled?new r.Scale9Sprite:new n.Sprite,this.loadTexture(this._textureFile,this._renderBarTexType),this.addProtectedChild(this._barRenderer,r.LoadingBar.RENDERER_ZORDER,-1),this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=e}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsets(this._capInsets),this.setPercent(this._percent),this._barRendererAdaptDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},setCapInsets:function(t){if(t){var e=this._capInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._barRenderer.setCapInsets(t)}},getCapInsets:function(){return n.rect(this._capInsets)},setPercent:function(t){t>100&&(t=100),0>t&&(t=0),t!==this._percent&&(this._percent=t,this._setPercent(t))},_setPercent:function(){var t,e,i,r;this._totalLength<=0||(t=this._percent/100,this._scale9Enabled?this._setScale9Scale():(i=this._barRenderer,r=this._barRendererTextureSize,e=i.getTextureRect(),e.width=r.width*t,i.setTextureRect(n.rect(e.x,e.y,r.width*t,r.height),i._rectRotated)))},setContentSize:function(t,e){r.Widget.prototype.setContentSize.call(this,t,e),this._totalLength=void 0===e?t.width:t},getPercent:function(){return this._percent},_onSizeChanged:function(){r.Widget.prototype._onSizeChanged.call(this),this._barRendererAdaptDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1)},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(r.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},getVirtualRendererSize:function(){return n.size(this._barRendererTextureSize)},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){var t=this._barRenderer,e=this._contentSize;if(this._unifySize)this._totalLength=this._contentSize.width,this.setPercent(this._percent);else if(this._ignoreSize)this._scale9Enabled||(this._totalLength=this._barRendererTextureSize.width,t.setScale(1));else if(this._totalLength=e.width,this._scale9Enabled)this._setScale9Scale(),t.setScale(1);else{var i=this._barRendererTextureSize;if(i.width<=0||i.height<=0)return void t.setScale(1);var n=e.width/i.width,s=e.height/i.height;t.setScaleX(n),t.setScaleY(s)}switch(this._direction){case r.LoadingBar.Type.LEFT:t.setPosition(0,.5*e.height);break;case r.LoadingBar.Type.RIGHT:t.setPosition(this._totalLength,.5*e.height)}},_setScale9Scale:function(){var t=this._percent/100*this._totalLength;this._barRenderer.setPreferredSize(n.size(t,this._contentSize.height))},getDescription:function(){return"LoadingBar"},_createCloneInstance:function(){return new r.LoadingBar},_copySpecialProperties:function(t){t instanceof r.LoadingBar&&(this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTexture(t._textureFile,t._renderBarTexType),this.setCapInsets(t._capInsets),this.setPercent(t._percent),this.setDirection(t._direction))}});var c=r.LoadingBar.prototype;c.direction,n.defineGetterSetter(c,"direction",c.getDirection,c.setDirection),c.percent,n.defineGetterSetter(c,"percent",c.getPercent,c.setPercent),c=null,r.LoadingBar.create=function(t,e){return new r.LoadingBar(t,e)},r.LoadingBar.Type=n.Enum({LEFT:0,RIGHT:1}),r.LoadingBar.RENDERER_ZORDER=-1,r.Slider=r.Widget.extend({_barRenderer:null,_progressBarRenderer:null,_barTextureSize:null,_progressBarTextureSize:null,_slidBallNormalRenderer:null,_slidBallPressedRenderer:null,_slidBallDisabledRenderer:null,_slidBallRenderer:null,_barLength:0,_percent:0,_scale9Enabled:!1,_prevIgnoreSize:!0,_textureFile:"",_progressBarTextureFile:"",_slidBallNormalTextureFile:"",_slidBallPressedTextureFile:"",_slidBallDisabledTextureFile:"",_capInsetsBarRenderer:null,_capInsetsProgressBarRenderer:null,_sliderEventListener:null,_sliderEventSelector:null,_barTexType:r.Widget.LOCAL_TEXTURE,_progressBarTexType:r.Widget.LOCAL_TEXTURE,_ballNTexType:r.Widget.LOCAL_TEXTURE,_ballPTexType:r.Widget.LOCAL_TEXTURE,_ballDTexType:r.Widget.LOCAL_TEXTURE,_isTextureLoaded:!1,_className:"Slider",_barRendererAdaptDirty:!0,_progressBarRendererDirty:!0,_unifySize:!1,_zoomScale:.1,_sliderBallNormalTextureScaleX:1,_sliderBallNormalTextureScaleY:1,ctor:function(t,e,i){this._barTextureSize=n.size(0,0),this._progressBarTextureSize=n.size(0,0),this._capInsetsBarRenderer=n.rect(0,0,0,0),this._capInsetsProgressBarRenderer=n.rect(0,0,0,0),r.Widget.prototype.ctor.call(this),i=null==i?0:i,this.setTouchEnabled(!0),t&&this.loadBarTexture(t,i),e&&this.loadSlidBallTextures(e,i)},init:function(){return r.Widget.prototype.init.call(this)},_initRenderer:function(){this._barRenderer=new n.Sprite,this._progressBarRenderer=new n.Sprite,this._progressBarRenderer.setAnchorPoint(0,.5),this.addProtectedChild(this._barRenderer,r.Slider.BASEBAR_RENDERER_ZORDER,-1),this.addProtectedChild(this._progressBarRenderer,r.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._slidBallNormalRenderer=new n.Sprite,this._slidBallPressedRenderer=new n.Sprite,this._slidBallPressedRenderer.setVisible(!1),this._slidBallDisabledRenderer=new n.Sprite,this._slidBallDisabledRenderer.setVisible(!1),this._slidBallRenderer=new _ccsg.Node,this._slidBallRenderer.addChild(this._slidBallNormalRenderer),this._slidBallRenderer.addChild(this._slidBallPressedRenderer),this._slidBallRenderer.addChild(this._slidBallDisabledRenderer),this._slidBallRenderer.setCascadeColorEnabled(!0),this._slidBallRenderer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._slidBallRenderer,r.Slider.BALL_RENDERER_ZORDER,-1)},loadBarTexture:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._textureFile=t,this._barTexType=e;var i=this._barRenderer,n=this;switch(i._textureLoaded||i.once("load",function(){n.loadBarTexture(n._textureFile,n._barTexType)}),this._barTexType){case r.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._barRendererAdaptDirty=!0,this._progressBarRendererDirty=!0,this._updateContentSizeWithTextureSize(this._barRenderer.getContentSize()),this._findLayout(),this._barTextureSize=this._barRenderer.getContentSize()}},loadProgressBarTexture:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._progressBarTextureFile=t,this._progressBarTexType=e;var i=this._progressBarRenderer,s=this;switch(i._textureLoaded||i.once("load",function(){s.loadProgressBarTexture(s._progressBarTextureFile,s._progressBarTexType)}),this._progressBarTexType){case r.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._progressBarRenderer.setAnchorPoint(n.p(0,.5));var o=this._progressBarRenderer.getContentSize();this._progressBarTextureSize={width:o.width,height:o.height},this._progressBarRendererDirty=!0,this._findLayout()}},setScale9Enabled:function(t){if(this._scale9Enabled!==t){if(this._scale9Enabled=t,this.removeProtectedChild(this._barRenderer,!0),this.removeProtectedChild(this._progressBarRenderer,!0),this._barRenderer=null,this._progressBarRenderer=null,this._scale9Enabled?(this._barRenderer=new r.Scale9Sprite,this._progressBarRenderer=new r.Scale9Sprite):(this._barRenderer=new n.Sprite,this._progressBarRenderer=new n.Sprite),this.loadBarTexture(this._textureFile,this._barTexType),this.loadProgressBarTexture(this._progressBarTextureFile,this._progressBarTexType),this.addProtectedChild(this._barRenderer,r.Slider.BASEBAR_RENDERER_ZORDER,-1),this.addProtectedChild(this._progressBarRenderer,r.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=e}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsetsBarRenderer(this._capInsetsBarRenderer),this.setCapInsetProgressBarRenderer(this._capInsetsProgressBarRenderer),this._barRendererAdaptDirty=!0,this._progressBarRendererDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(r.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},setCapInsets:function(t){this.setCapInsetsBarRenderer(t),this.setCapInsetProgressBarRenderer(t)},setCapInsetsBarRenderer:function(t){if(t){var e=this._capInsetsBarRenderer;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._barRenderer.setCapInsets(t)}},getCapInsetsBarRenderer:function(){return n.rect(this._capInsetsBarRenderer)},setCapInsetProgressBarRenderer:function(t){if(t){var e=this._capInsetsProgressBarRenderer;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._progressBarRenderer.setCapInsets(t)}},getCapInsetsProgressBarRenderer:function(){return n.rect(this._capInsetsProgressBarRenderer)},loadSlidBallTextures:function(t,e,i,n){this.loadSlidBallTextureNormal(t,n),this.loadSlidBallTexturePressed(e,n),this.loadSlidBallTextureDisabled(i,n)},loadSlidBallTextureNormal:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._slidBallNormalTextureFile=t,this._ballNTexType=e;var i=this;switch(this._slidBallNormalRenderer._textureLoaded||this._slidBallNormalRenderer.once("load",function(){i.loadSlidBallTextureNormal(i._slidBallNormalTextureFile,i._ballNTexType)}),this._ballNTexType){case r.Widget.LOCAL_TEXTURE:this._slidBallNormalRenderer.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:this._slidBallNormalRenderer.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},loadSlidBallTexturePressed:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._slidBallPressedTextureFile=t,this._ballPTexType=e;var i=this;switch(this._slidBallPressedRenderer._textureLoaded||this._slidBallPressedRenderer.once("load",function(){i.loadSlidBallTexturePressed(i._slidBallPressedTextureFile,i._ballPTexType)}),this._ballPTexType){case r.Widget.LOCAL_TEXTURE:this._slidBallPressedRenderer.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:this._slidBallPressedRenderer.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},loadSlidBallTextureDisabled:function(t,e){if(t){e=e||r.Widget.LOCAL_TEXTURE,this._slidBallDisabledTextureFile=t,this._ballDTexType=e;var i=this;switch(this._slidBallDisabledRenderer._textureLoaded||this._slidBallDisabledRenderer.once("load",function(){i.loadSlidBallTextureDisabled(i._slidBallDisabledTextureFile,i._ballDTexType)}),this._ballDTexType){case r.Widget.LOCAL_TEXTURE:this._slidBallDisabledRenderer.initWithFile(t);break;case r.Widget.PLIST_TEXTURE:this._slidBallDisabledRenderer.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},setPercent:function(t){t>100&&(t=100),0>t&&(t=0),this._percent=t;var e=t/100,i=this._barLength*e;if(this._slidBallRenderer.setPosition(i,this._contentSize.height/2),this._scale9Enabled)this._progressBarRenderer.setPreferredSize(n.size(i,this._contentSize.height));else{var r=this._progressBarRenderer,s=r.getTextureRect();r.setTextureRect(n.rect(s.x,s.y,i/r._scaleX,s.height),r.isTextureRectRotated())}},hitTest:function(t){var e=this._slidBallNormalRenderer.convertToNodeSpace(t),i=this._slidBallNormalRenderer.getContentSize(),r=n.rect(0,0,i.width,i.height);return e.x>=r.x&&e.x<=r.x+r.width&&e.y>=r.y&&e.y<=r.y+r.height},onTouchBegan:function(t,e){var i=r.Widget.prototype.onTouchBegan.call(this,t,e);if(this._hit){var n=this.convertToNodeSpace(this._touchBeganPosition);this.setPercent(this._getPercentWithBallPos(n.x)),this._percentChangedEvent()}return i},onTouchMoved:function(t,e){var i=t.getLocation(),n=this.convertToNodeSpace(i);this.setPercent(this._getPercentWithBallPos(n.x)),this._percentChangedEvent()},onTouchEnded:function(t,e){r.Widget.prototype.onTouchEnded.call(this,t,e)},onTouchCancelled:function(t,e){r.Widget.prototype.onTouchCancelled.call(this,t,e)},_getPercentWithBallPos:function(t){return t/this._barLength*100},addEventListenerSlider:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._sliderEventSelector=t,this._sliderEventListener=e},_percentChangedEvent:function(){this._sliderEventSelector&&(this._sliderEventListener?this._sliderEventSelector.call(this._sliderEventListener,this,r.Slider.EVENT_PERCENT_CHANGED):this._sliderEventSelector(this,r.Slider.EVENT_PERCENT_CHANGED)),this._ccEventCallback&&this._ccEventCallback(this,r.Slider.EVENT_PERCENT_CHANGED)},getPercent:function(){return this._percent},_onSizeChanged:function(){r.Widget.prototype._onSizeChanged.call(this),this._barRendererAdaptDirty=!0,this._progressBarRendererDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1),this._progressBarRendererDirty&&(this._progressBarRendererScaleChangedWithSize(),this._progressBarRendererDirty=!1)},getVirtualRendererSize:function(){return this._barRenderer.getContentSize()},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){if(this._unifySize)this._barLength=this._contentSize.width,this._barRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize)this._barRenderer.setScale(1),this._barLength=this._contentSize.width;else if(this._barLength=this._contentSize.width,this._scale9Enabled)this._barRenderer.setPreferredSize(this._contentSize),this._barRenderer.setScale(1);else{var t=this._barTextureSize;if(t.width<=0||t.height<=0)this._barRenderer.setScale(1);else{var e=this._contentSize.width/t.width,i=this._contentSize.height/t.height;this._barRenderer.setScaleX(e),this._barRenderer.setScaleY(i)}}this._barRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2),this.setPercent(this._percent)},_progressBarRendererScaleChangedWithSize:function(){if(this._unifySize)this._progressBarRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize){if(!this._scale9Enabled){var t=this._progressBarTextureSize,e=this._contentSize.width/t.width,i=this._contentSize.height/t.height;this._progressBarRenderer.setScaleX(e),this._progressBarRenderer.setScaleY(i)}}else if(this._scale9Enabled)this._progressBarRenderer.setPreferredSize(this._contentSize),this._progressBarRenderer.setScale(1);else{var t=this._progressBarTextureSize;if(t.width<=0||t.height<=0)return void this._progressBarRenderer.setScale(1);var e=this._contentSize.width/t.width,i=this._contentSize.height/t.height;this._progressBarRenderer.setScaleX(e),this._progressBarRenderer.setScaleY(i)}this._progressBarRenderer.setPosition(0,this._contentSize.height/2),this.setPercent(this._percent)},_onPressStateChangedToNormal:function(){this._slidBallNormalRenderer.setVisible(!0),this._slidBallPressedRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!1),this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY)},_onPressStateChangedToPressed:function(){this._slidBallPressedTextureFile?(this._slidBallNormalRenderer.setVisible(!1),this._slidBallPressedRenderer.setVisible(!0),this._slidBallDisabledRenderer.setVisible(!1)):this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX+this._zoomScale,this._sliderBallNormalTextureScaleY+this._zoomScale)},_onPressStateChangedToDisabled:function(){this._slidBallDisabledTextureFile&&(this._slidBallNormalRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!0)),this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY),this._slidBallPressedRenderer.setVisible(!1)},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getDescription:function(){return"Slider"},_createCloneInstance:function(){return new r.Slider},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadBarTexture(t._textureFile,t._barTexType),this.loadProgressBarTexture(t._progressBarTextureFile,t._progressBarTexType),this.loadSlidBallTextureNormal(t._slidBallNormalTextureFile,t._ballNTexType),this.loadSlidBallTexturePressed(t._slidBallPressedTextureFile,t._ballPTexType),this.loadSlidBallTextureDisabled(t._slidBallDisabledTextureFile,t._ballDTexType),this.setPercent(t.getPercent()),this._sliderEventListener=t._sliderEventListener,this._sliderEventSelector=t._sliderEventSelector,this._zoomScale=t._zoomScale,this._ccEventCallback=t._ccEventCallback}});var c=r.Slider.prototype;c.percent,n.defineGetterSetter(c,"percent",c.getPercent,c.setPercent),c=null,r.Slider.create=function(t,e,i){return new r.Slider(t,e,i)},r.Slider.EVENT_PERCENT_CHANGED=0,r.Slider.BASEBAR_RENDERER_ZORDER=-3,r.Slider.PROGRESSBAR_RENDERER_ZORDER=-2,r.Slider.BALL_RENDERER_ZORDER=-1,r.Text=r.Widget.extend({_touchScaleChangeEnabled:!1,_normalScaleValueX:1,_normalScaleValueY:1,_fontName:"Thonburi",_fontSize:10,_onSelectedScaleOffset:.5,_labelRenderer:"",_textAreaSize:null,_textVerticalAlignment:0,_textHorizontalAlignment:0,_className:"Text",_type:null,_labelRendererAdaptDirty:!0,ctor:function(t,e,i){this._type=r.Text.Type.SYSTEM,this._textAreaSize=n.size(0,0),r.Widget.prototype.ctor.call(this),void 0!==i&&this.init(t,e,i)},init:function(t,e,i){return r.Widget.prototype.init.call(this)?(arguments.length>0?(this.setFontName(e),this.setFontSize(i),this.setString(t)):this.setFontName(this._fontName),!0):!1},_initRenderer:function(){this._labelRenderer=new n.LabelTTF,this.addProtectedChild(this._labelRenderer,r.Text.RENDERER_ZORDER,-1)},setText:function(t){n.log("Please use the setString"),this.setString(t)},setString:function(t){t!==this._labelRenderer.getString()&&(this._labelRenderer.setString(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0)},getStringValue:function(){return n.log("Please use the getString"),this._labelRenderer.getString()},getString:function(){return this._labelRenderer.getString()},getStringLength:function(){return this._labelRenderer.getStringLength()},setFontSize:function(t){this._labelRenderer.setFontSize(t),this._fontSize=t,this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getFontSize:function(){return this._fontSize},setFontName:function(t){this._fontName=t,this._labelRenderer.setFontName(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getFontName:function(){return this._fontName},_setFont:function(t){var e=n.LabelTTF._fontStyleRE.exec(t);e&&(this._fontSize=parseInt(e[1]),this._fontName=e[2],this._labelRenderer._setFont(t),this._labelScaleChangedWithSize())},_getFont:function(){return this._labelRenderer._getFont()},getType:function(){return this._type},setTextAreaSize:function(t){this._labelRenderer.setDimensions(t),this._ignoreSize||(this._customSize=t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextAreaSize:function(){return this._labelRenderer.getDimensions()},setTextHorizontalAlignment:function(t){this._labelRenderer.setHorizontalAlignment(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextHorizontalAlignment:function(){return this._labelRenderer.getHorizontalAlignment()},setTextVerticalAlignment:function(t){this._labelRenderer.setVerticalAlignment(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextVerticalAlignment:function(){return this._labelRenderer.getVerticalAlignment()},setTouchScaleChangeEnabled:function(t){this._touchScaleChangeEnabled=t},isTouchScaleChangeEnabled:function(){return this._touchScaleChangeEnabled},_onPressStateChangedToNormal:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX),this._labelRenderer.setScaleY(this._normalScaleValueY))},_onPressStateChangedToPressed:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX+this._onSelectedScaleOffset),this._labelRenderer.setScaleY(this._normalScaleValueY+this._onSelectedScaleOffset))},_onPressStateChangedToDisabled:function(){},_onSizeChanged:function(){r.Widget.prototype._onSizeChanged.call(this),this._labelRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelRendererAdaptDirty&&(this._labelScaleChangedWithSize(),this._labelRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelRenderer},getAutoRenderSize:function(){var t=this._labelRenderer.getContentSize();return this._ignoreSize||(this._labelRenderer.setDimensions(0,0),t=this._labelRenderer.getContentSize(),this._labelRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),t},_labelScaleChangedWithSize:function(){var t=this._contentSize;if(this._ignoreSize)this._labelRenderer.setDimensions(0,0),this._labelRenderer.setScale(1),this._normalScaleValueX=this._normalScaleValueY=1;else{this._labelRenderer.setDimensions(n.size(t.width,t.height));var e=this._labelRenderer.getContentSize();if(e.width<=0||e.height<=0)return void this._labelRenderer.setScale(1);var i=t.width/e.width,r=t.height/e.height;this._labelRenderer.setScaleX(i),this._labelRenderer.setScaleY(r),this._normalScaleValueX=i,this._normalScaleValueY=r}this._labelRenderer.setPosition(t.width/2,t.height/2)},getDescription:function(){return"Label"},enableShadow:function(t,e,i){this._labelRenderer.enableShadow(t,e,i)},enableOutline:function(t,e){this._labelRenderer.enableStroke(t,e)},enableGlow:function(t){this._type===r.Text.Type.TTF&&this._labelRenderer.enableGlow(t)},disableEffect:function(){this._labelRenderer.disableEffect&&this._labelRenderer.disableEffect()},_createCloneInstance:function(){return new r.Text},_copySpecialProperties:function(t){t instanceof r.Text&&(this.setFontName(t._fontName),this.setFontSize(t.getFontSize()),this.setString(t.getString()),this.setTouchScaleChangeEnabled(t.touchScaleEnabled),this.setTextAreaSize(t._textAreaSize),this.setTextHorizontalAlignment(t._labelRenderer.getHorizontalAlignment()),this.setTextVerticalAlignment(t._labelRenderer.getVerticalAlignment()),this.setContentSize(t.getContentSize()),this.setTextColor(t.getTextColor()))},_setBoundingWidth:function(t){this._textAreaSize.width=t,this._labelRenderer._setBoundingWidth(t),this._labelScaleChangedWithSize()},_setBoundingHeight:function(t){this._textAreaSize.height=t,this._labelRenderer._setBoundingHeight(t),this._labelScaleChangedWithSize()},_getBoundingWidth:function(){return this._textAreaSize.width},_getBoundingHeight:function(){return this._textAreaSize.height},_changePosition:function(){this._adaptRenderers()},setColor:function(t){n.ProtectedNode.prototype.setColor.call(this,t),this._labelRenderer.setColor(t)},setTextColor:function(t){this._labelRenderer.setFontFillColor(t)},getTextColor:function(){return this._labelRenderer._getFillStyle()}});var c=r.Text.prototype;c.boundingWidth,n.defineGetterSetter(c,"boundingWidth",c._getBoundingWidth,c._setBoundingWidth),c.boundingHeight,n.defineGetterSetter(c,"boundingHeight",c._getBoundingHeight,c._setBoundingHeight),c.string,n.defineGetterSetter(c,"string",c.getString,c.setString),c.stringLength,n.defineGetterSetter(c,"stringLength",c.getStringLength),c.font,n.defineGetterSetter(c,"font",c._getFont,c._setFont),c.fontSize,n.defineGetterSetter(c,"fontSize",c.getFontSize,c.setFontSize),c.fontName,n.defineGetterSetter(c,"fontName",c.getFontName,c.setFontName),c.textAlign,n.defineGetterSetter(c,"textAlign",c.getTextHorizontalAlignment,c.setTextHorizontalAlignment),c.verticalAlign,n.defineGetterSetter(c,"verticalAlign",c.getTextVerticalAlignment,c.setTextVerticalAlignment),c=null,r.Label=r.Text.create=function(t,e,i){return new r.Text(t,e,i)},r.Text.RENDERER_ZORDER=-1,r.Text.Type={SYSTEM:0,TTF:1},r.TextAtlas=r.Widget.extend({_labelAtlasRenderer:null,_stringValue:"",_charMapFileName:"",_itemWidth:0,_itemHeight:0,_startCharMap:"",_className:"TextAtlas",_labelAtlasRendererAdaptDirty:null,ctor:function(t,e,i,n,s){r.Widget.prototype.ctor.call(this),void 0!==s&&this.setProperty(t,e,i,n,s)},_initRenderer:function(){this._labelAtlasRenderer=new n.LabelAtlas,this._labelAtlasRenderer.setAnchorPoint(n.p(.5,.5)),this.addProtectedChild(this._labelAtlasRenderer,r.TextAtlas.RENDERER_ZORDER,-1)},setProperty:function(t,e,i,n,r){this._stringValue=t,this._charMapFileName=e,this._itemWidth=i,this._itemHeight=n,this._startCharMap=r,this._labelAtlasRenderer.initWithString(t,this._charMapFileName,this._itemWidth,this._itemHeight,this._startCharMap[0]),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0},setString:function(t){t!==this._labelAtlasRenderer.getString()&&(this._stringValue=t,this._labelAtlasRenderer.setString(t),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0)},setStringValue:function(t){n.log("Please use the setString"),this.setString(t)},getStringValue:function(){return n.log("Please use the getString"),this.getString()},getString:function(){return this._labelAtlasRenderer.getString()},getStringLength:function(){return this._labelAtlasRenderer.getStringLength()},_onSizeChanged:function(){r.Widget.prototype._onSizeChanged.call(this),this._labelAtlasRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelAtlasRendererAdaptDirty&&(this._labelAtlasScaleChangedWithSize(),this._labelAtlasRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelAtlasRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelAtlasRenderer},_labelAtlasScaleChangedWithSize:function(){var t=this._labelAtlasRenderer;if(this._ignoreSize)t.setScale(1);else{var e=t.getContentSize();if(e.width<=0||e.height<=0)return void t.setScale(1);t.setScaleX(this._contentSize.width/e.width),t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"LabelAtlas"},_copySpecialProperties:function(t){t&&this.setProperty(t._stringValue,t._charMapFileName,t._itemWidth,t._itemHeight,t._startCharMap)},_createCloneInstance:function(){return new r.TextAtlas}});var c=r.TextAtlas.prototype;c.string,n.defineGetterSetter(c,"string",c.getString,c.setString),c=null,r.TextAtlas.create=function(t,e,i,n,s){return new r.TextAtlas(t,e,i,n,s)},r.TextAtlas.RENDERER_ZORDER=-1,r.LabelBMFont=r.TextBMFont=r.Widget.extend({_labelBMFontRenderer:null,_fntFileHasInit:!1,_fntFileName:"",_stringValue:"",_className:"TextBMFont",_labelBMFontRendererAdaptDirty:!0,ctor:function(t,e){r.Widget.prototype.ctor.call(this),void 0!=e&&(this.setFntFile(e),this.setString(t))},_initRenderer:function(){this._labelBMFontRenderer=new n.LabelBMFont,this.addProtectedChild(this._labelBMFontRenderer,r.TextBMFont.RENDERER_ZORDER,-1)},setFntFile:function(t){if(t){this._fntFileName=t,this._fntFileHasInit=!0,this._labelBMFontRenderer.initWithString(this._stringValue,t),this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0;var e=this,i=e._labelBMFontRenderer;i._textureLoaded||i.once("load",function(){e.setFntFile(e._fntFileName)})}},setText:function(t){n.log("Please use the setString"),this.setString(t)},setString:function(t){t!==this._labelBMFontRenderer.getString()&&(this._stringValue=t,this._labelBMFontRenderer.setString(t),this._fntFileHasInit&&(this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0))},getString:function(){return this._stringValue},getStringLength:function(){return this._labelBMFontRenderer.getStringLength()},_onSizeChanged:function(){r.Widget.prototype._onSizeChanged.call(this),this._labelBMFontRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelBMFontRendererAdaptDirty&&(this._labelBMFontScaleChangedWithSize(),this._labelBMFontRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelBMFontRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelBMFontRenderer},_labelBMFontScaleChangedWithSize:function(){var t=this._labelBMFontRenderer;if(this._ignoreSize)t.setScale(1);else{var e=t.getContentSize();if(e.width<=0||e.height<=0)return void t.setScale(1);t.setScaleX(this._contentSize.width/e.width),t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"TextBMFont"},_createCloneInstance:function(){return new r.TextBMFont},_copySpecialProperties:function(t){this.setFntFile(t._fntFileName),this.setString(t._stringValue)}});var c=r.TextBMFont.prototype;c.string,n.defineGetterSetter(c,"string",c.getString,c.setString),c=null,r.TextBMFont.create=function(t,e){return new r.TextBMFont(t,e)},r.TextBMFont.RENDERER_ZORDER=-1,r._TextFieldRenderer=n.TextFieldTTF.extend({_maxLengthEnabled:!1,_maxLength:0,_passwordEnabled:!1,_passwordStyleText:"",_attachWithIME:!1,_detachWithIME:!1,_insertText:!1,_deleteBackward:!1,_className:"_TextFieldRenderer",ctor:function(){n.TextFieldTTF.prototype.ctor.call(this),this._maxLengthEnabled=!1,this._maxLength=0,this._passwordEnabled=!1,this._passwordStyleText="*",this._attachWithIME=!1,this._detachWithIME=!1,this._insertText=!1,this._deleteBackward=!1},onEnter:function(){n.TextFieldTTF.prototype.onEnter.call(this),n.TextFieldTTF.prototype.setDelegate.call(this,this)},onTextFieldAttachWithIME:function(t){return this.setAttachWithIME(!0),!1},onTextFieldInsertText:function(t,e,i){return 1===i&&"\n"===e?!1:(this.setInsertText(!0),this._maxLengthEnabled&&n.TextFieldTTF.prototype.getCharCount.call(this)>=this._maxLength)},onTextFieldDeleteBackward:function(t,e,i){return this.setDeleteBackward(!0),!1},onTextFieldDetachWithIME:function(t){return this.setDetachWithIME(!0),!1},insertText:function(t,e){var i=t;if("\n"!==t&&this._maxLengthEnabled){var r=this.getString().length;if(r>=this._maxLength)return void(this._passwordEnabled&&this.setPasswordText(this.getString()))}n.TextFieldTTF.prototype.insertText.call(this,i,e),this._passwordEnabled&&n.TextFieldTTF.prototype.getCharCount.call(this)>0&&this.setPasswordText(this.getString())},deleteBackward:function(){n.TextFieldTTF.prototype.deleteBackward.call(this),n.TextFieldTTF.prototype.getCharCount.call(this)>0&&this._passwordEnabled&&this.setPasswordText(this._inputText)},openIME:function(){n.TextFieldTTF.prototype.attachWithIME.call(this)},closeIME:function(){n.TextFieldTTF.prototype.detachWithIME.call(this)},setMaxLengthEnabled:function(t){this._maxLengthEnabled=t},isMaxLengthEnabled:function(){return this._maxLengthEnabled},setMaxLength:function(t){this._maxLength=t},getMaxLength:function(){return this._maxLength},getCharCount:function(){
return n.TextFieldTTF.prototype.getCharCount.call(this)},setPasswordEnabled:function(t){this._passwordEnabled=t},isPasswordEnabled:function(){return this._passwordEnabled},setPasswordStyleText:function(t){if(!(t.length>1)){var e=t.charCodeAt(0);33>e||e>126||(this._passwordStyleText=t)}},setPasswordText:function(t){var e="",i=t.length,r=i;this._maxLengthEnabled&&i>this._maxLength&&(r=this._maxLength);for(var s=0;r>s;++s)e+=this._passwordStyleText;n.LabelTTF.prototype.setString.call(this,e)},setAttachWithIME:function(t){this._attachWithIME=t},getAttachWithIME:function(){return this._attachWithIME},setDetachWithIME:function(t){this._detachWithIME=t},getDetachWithIME:function(){return this._detachWithIME},setInsertText:function(t){this._insertText=t},getInsertText:function(){return this._insertText},setDeleteBackward:function(t){this._deleteBackward=t},getDeleteBackward:function(){return this._deleteBackward},onDraw:function(t){return!1}}),r._TextFieldRenderer.create=function(t,e,i){var n=new r._TextFieldRenderer;return n&&n.initWithString("",e,i)?(t&&n.setPlaceHolder(t),n):null},r.TextField=r.Widget.extend({_textFieldRenderer:null,_touchWidth:0,_touchHeight:0,_useTouchArea:!1,_textFieldEventListener:null,_textFieldEventSelector:null,_passwordStyleText:"",_textFieldRendererAdaptDirty:!0,_fontName:"",_fontSize:12,_ccEventCallback:null,ctor:function(t,e,i){r.Widget.prototype.ctor.call(this),e&&this.setFontName(e),i&&this.setFontSize(i),t&&this.setPlaceHolder(t)},init:function(){return r.Widget.prototype.init.call(this)?(this.setTouchEnabled(!0),!0):!1},onEnter:function(){r.Widget.prototype.onEnter.call(this),this.scheduleUpdate()},_initRenderer:function(){this._textFieldRenderer=r._TextFieldRenderer.create("input words here","Thonburi",20),this.addProtectedChild(this._textFieldRenderer,r.TextField.RENDERER_ZORDER,-1)},setTouchSize:function(t){this._touchWidth=t.width,this._touchHeight=t.height},setTouchAreaEnabled:function(t){this._useTouchArea=t},hitTest:function(t){if(this._useTouchArea){var e=this.convertToNodeSpace(t),i=n.rect(-this._touchWidth*this._anchorPoint.x,-this._touchHeight*this._anchorPoint.y,this._touchWidth,this._touchHeight);return e.x>=i.x&&e.x<=i.x+i.width&&e.y>=i.y&&e.y<=i.y+i.height}return r.Widget.prototype.hitTest.call(this,t)},getTouchSize:function(){return n.size(this._touchWidth,this._touchHeight)},setText:function(t){n.log("Please use the setString"),this.setString(t)},setString:function(t){null!=t&&(t=String(t),this.isMaxLengthEnabled()&&(t=t.substr(0,this.getMaxLength())),this.isPasswordEnabled()?(this._textFieldRenderer.setPasswordText(t),this._textFieldRenderer.setString(""),this._textFieldRenderer.insertText(t,t.length)):this._textFieldRenderer.setString(t),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()))},setPlaceHolder:function(t){this._textFieldRenderer.setPlaceHolder(t),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getPlaceHolder:function(){return this._textFieldRenderer.getPlaceHolder()},getPlaceHolderColor:function(){return this._textFieldRenderer.getPlaceHolderColor()},setPlaceHolderColor:function(t){this._textFieldRenderer.setColorSpaceHolder(t)},setTextColor:function(t){this._textFieldRenderer.setTextColor(t)},setFontSize:function(t){this._textFieldRenderer.setFontSize(t),this._fontSize=t,this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontSize:function(){return this._fontSize},setFontName:function(t){this._textFieldRenderer.setFontName(t),this._fontName=t,this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontName:function(){return this._fontName},didNotSelectSelf:function(){this._textFieldRenderer.detachWithIME()},getStringValue:function(){return n.log("Please use the getString"),this.getString()},getString:function(){return this._textFieldRenderer.getString()},getStringLength:function(){return this._textFieldRenderer.getStringLength()},onTouchBegan:function(t,e){var i=this,n=r.Widget.prototype.onTouchBegan.call(i,t,e);return i._hit?setTimeout(function(){i._textFieldRenderer.attachWithIME()},0):setTimeout(function(){i._textFieldRenderer.detachWithIME()},0),n},setMaxLengthEnabled:function(t){this._textFieldRenderer.setMaxLengthEnabled(t)},isMaxLengthEnabled:function(){return this._textFieldRenderer.isMaxLengthEnabled()},setMaxLength:function(t){this._textFieldRenderer.setMaxLength(t),this.setString(this.getString())},getMaxLength:function(){return this._textFieldRenderer.getMaxLength()},setPasswordEnabled:function(t){this._textFieldRenderer.setPasswordEnabled(t)},isPasswordEnabled:function(){return this._textFieldRenderer.isPasswordEnabled()},setPasswordStyleText:function(t){this._textFieldRenderer.setPasswordStyleText(t),this._passwordStyleText=t,this.setString(this.getString())},getPasswordStyleText:function(){return this._passwordStyleText},update:function(t){this.getDetachWithIME()&&(this._detachWithIMEEvent(),this.setDetachWithIME(!1)),this.getAttachWithIME()&&(this._attachWithIMEEvent(),this.setAttachWithIME(!1)),this.getInsertText()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._insertTextEvent(),this.setInsertText(!1)),this.getDeleteBackward()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._deleteBackwardEvent(),this.setDeleteBackward(!1))},getAttachWithIME:function(){return this._textFieldRenderer.getAttachWithIME()},setAttachWithIME:function(t){this._textFieldRenderer.setAttachWithIME(t)},getDetachWithIME:function(){return this._textFieldRenderer.getDetachWithIME()},setDetachWithIME:function(t){this._textFieldRenderer.setDetachWithIME(t)},getInsertText:function(){return this._textFieldRenderer.getInsertText()},setInsertText:function(t){this._textFieldRenderer.setInsertText(t)},getDeleteBackward:function(){return this._textFieldRenderer.getDeleteBackward()},setDeleteBackward:function(t){this._textFieldRenderer.setDeleteBackward(t)},_attachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,r.TextField.EVENT_ATTACH_WITH_IME):this._textFieldEventSelector(this,r.TextField.EVENT_ATTACH_WITH_IME)),this._ccEventCallback&&this._ccEventCallback(this,r.TextField.EVENT_ATTACH_WITH_IME)},_detachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,r.TextField.EVENT_DETACH_WITH_IME):this._textFieldEventSelector(this,r.TextField.EVENT_DETACH_WITH_IME)),this._ccEventCallback&&this._ccEventCallback(this,r.TextField.EVENT_DETACH_WITH_IME)},_insertTextEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,r.TextField.EVENT_INSERT_TEXT):this._textFieldEventSelector(this,r.TextField.EVENT_INSERT_TEXT)),this._ccEventCallback&&this._ccEventCallback(this,r.TextField.EVENT_INSERT_TEXT)},_deleteBackwardEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,r.TextField.EVENT_DELETE_BACKWARD):this._textFieldEventSelector(this,r.TextField.EVENT_DELETE_BACKWARD)),this._ccEventCallback&&this._ccEventCallback(this,r.TextField.EVENT_DELETE_BACKWARD)},addEventListenerTextField:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._textFieldEventSelector=t,this._textFieldEventListener=e},_onSizeChanged:function(){r.Widget.prototype._onSizeChanged.call(this),this._textFieldRendererAdaptDirty=!0},_adaptRenderers:function(){this._textFieldRendererAdaptDirty&&(this._textfieldRendererScaleChangedWithSize(),this._textFieldRendererAdaptDirty=!1)},_textfieldRendererScaleChangedWithSize:function(){this._ignoreSize||this._textFieldRenderer.setDimensions(this._contentSize),this._textFieldRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getAutoRenderSize:function(){var t=this._textFieldRenderer.getContentSize();return this._ignoreSize||(this._textFieldRenderer.setDimensions(0,0),t=this._textFieldRenderer.getContentSize(),this._textFieldRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),t},getVirtualRendererSize:function(){return this._textFieldRenderer.getContentSize()},getVirtualRenderer:function(){return this._textFieldRenderer},getDescription:function(){return"TextField"},attachWithIME:function(){this._textFieldRenderer.attachWithIME()},_createCloneInstance:function(){return new r.TextField},_copySpecialProperties:function(t){this.setString(t._textFieldRenderer.getString()),this.setPlaceHolder(t.getString()),this.setFontSize(t._textFieldRenderer.getFontSize()),this.setFontName(t._textFieldRenderer.getFontName()),this.setMaxLengthEnabled(t.isMaxLengthEnabled()),this.setMaxLength(t.getMaxLength()),this.setPasswordEnabled(t.isPasswordEnabled()),this.setPasswordStyleText(t._passwordStyleText),this.setAttachWithIME(t.getAttachWithIME()),this.setDetachWithIME(t.getDetachWithIME()),this.setInsertText(t.getInsertText()),this.setDeleteBackward(t.getDeleteBackward()),this._ccEventCallback=t._ccEventCallback,this._textFieldEventListener=t._textFieldEventListener,this._textFieldEventSelector=t._textFieldEventSelector},setTextAreaSize:function(t){this.setContentSize(t)},setTextHorizontalAlignment:function(t){this._textFieldRenderer.setHorizontalAlignment(t)},setTextVerticalAlignment:function(t){this._textFieldRenderer.setVerticalAlignment(t)},_setFont:function(t){this._textFieldRenderer._setFont(t),this._textFieldRendererAdaptDirty=!0},_getFont:function(){return this._textFieldRenderer._getFont()},_changePosition:function(){this._adaptRenderers()}}),r.TextField.create=function(t,e,i){return new r.TextField(t,e,i)};var c=r.TextField.prototype;c.string,n.defineGetterSetter(c,"string",c.getString,c.setString),c.placeHolder,n.defineGetterSetter(c,"placeHolder",c.getPlaceHolder,c.setPlaceHolder),c.font,n.defineGetterSetter(c,"font",c._getFont,c._setFont),c.fontSize,n.defineGetterSetter(c,"fontSize",c.getFontSize,c.setFontSize),c.fontName,n.defineGetterSetter(c,"fontName",c.getFontName,c.setFontName),c.maxLengthEnabled,n.defineGetterSetter(c,"maxLengthEnabled",c.isMaxLengthEnabled,c.setMaxLengthEnabled),c.maxLength,n.defineGetterSetter(c,"maxLength",c.getMaxLength,c.setMaxLength),c.passwordEnabled,n.defineGetterSetter(c,"passwordEnabled",c.isPasswordEnabled,c.setPasswordEnabled),c=null,r.TextField.EVENT_ATTACH_WITH_IME=0,r.TextField.EVENT_DETACH_WITH_IME=1,r.TextField.EVENT_INSERT_TEXT=2,r.TextField.EVENT_DELETE_BACKWARD=3,r.TextField.RENDERER_ZORDER=-1,r.WebView=r.Widget.extend({ctor:function(t){r.Widget.prototype.ctor.call(this),this._EventList={},t&&this.loadURL(t)},setJavascriptInterfaceScheme:function(t){},loadData:function(t,e,i,n){},loadHTMLString:function(t,e){},loadURL:function(t){this._renderCmd.updateURL(t),this._dispatchEvent(r.WebView.EventType.LOADING)},stopLoading:function(){n.log("Web does not support loading")},reload:function(){var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.location.reload()}},canGoBack:function(){return n.log("Web does not support query history"),!0},canGoForward:function(){return n.log("Web does not support query history"),!0},goBack:function(){try{if(r.WebView._polyfill.closeHistory)return n.log("The current browser does not support the GoBack");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.history.back.call(e)}}catch(i){n.log(i)}},goForward:function(){try{if(r.WebView._polyfill.closeHistory)return n.log("The current browser does not support the GoForward");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.history.forward.call(e)}}catch(i){n.log(i)}},evaluateJS:function(t){var e=this._renderCmd._iframe;if(e){var i=e.contentWindow;try{i.eval(t),this._dispatchEvent(r.WebView.EventType.JS_EVALUATED)}catch(n){console.error(n)}}},setScalesPageToFit:function(){n.log("Web does not support zoom")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];e&&e.call(this,this,this._renderCmd._iframe.src)},_createRenderCmd:function(){return new r.WebView.RenderCmd(this)},setContentSize:function(t,e){r.Widget.prototype.setContentSize.call(this,t,e),void 0===e&&(e=t.height,t=t.width),this._renderCmd.changeSize(t,e)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()}}),r.WebView.EventType={LOADING:"loading",LOADED:"load",ERROR:"error",JS_EVALUATED:"js"},function(){var t=r.WebView._polyfill={devicePixelRatio:!1,enableDiv:!1};n.sys.os===n.sys.OS_IOS&&(t.enableDiv=!0),n.sys.isMobile?n.sys.browserType===n.sys.BROWSER_TYPE_FIREFOX&&(t.enableBG=!0):n.sys.browserType===n.sys.BROWSER_TYPE_IE&&(t.closeHistory=!0)}(),function(t){r.WebView.RenderCmd=function(e){_ccsg.Node.CanvasRenderCmd.call(this,e),this._div=null,this._iframe=null,t.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._div.appendChild(this._iframe)):this._div=this._iframe=document.createElement("iframe"),t.enableBG&&(this._div.style.background="#FFF"),this._iframe.addEventListener("load",function(){e._dispatchEvent(r.WebView.EventType.LOADED)}),this._iframe.addEventListener("error",function(){e._dispatchEvent(r.WebView.EventType.ERROR)}),this._div.style.background="#FFF",this._div.style.height="200px",this._div.style.width="300px",this._div.style.overflow="scroll",this._listener=null,this.initStyle()};var e=r.WebView.RenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);e.constructor=r.WebView.RenderCmd,e.updateStatus=function(){t.devicePixelRatio=n.view.isRetinaEnabled();var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag;i&e.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,n.view._scaleX,n.view._scaleY),this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty^this._dirtyFlag)},e.visit=function(){var t=this,e=n.container,i=n.eventManager;if(this._node._visible)e.appendChild(this._div),null===this._listener&&(this._listener=i.addCustomListener(n.game.EVENT_RESIZE,function(){t.resize()}));else{var r=!1;r="contains"in e?e.contains(this._div):e.compareDocumentPosition(this._div)%16,r&&e.removeChild(this._div);var s=i._listenersMap[n.game.EVENT_RESIZE].getFixedPriorityListeners();i._removeListenerInVector(s,this._listener),this._listener=null}this.updateStatus(),this.resize(n.view)},e.resize=function(t){t=t||n.view;var e=this._node,i=n.eventManager;if(e._parent&&e._visible)this.updateMatrix(this._worldTransform,t._scaleX,t._scaleY);else{var r=i._listenersMap[n.game.EVENT_RESIZE].getFixedPriorityListeners();i._removeListenerInVector(r,this._listener),this._listener=null}},e.updateMatrix=function(e,i,n){var r=this._node;if(t.devicePixelRatio&&1!==i&&1!==i){var s=window.devicePixelRatio;i/=s,n/=s}if(this._loaded!==!1){var o=r._contentSize.width,a=r._contentSize.height,c=e.a*i,h=e.b,l=e.c,d=e.d*n,u=e.tx*i-o/2+o*r._scaleX/2*i,_=e.ty*n-a/2+a*r._scaleY/2*n,f="matrix("+c+","+h+","+l+","+d+","+u+","+-_+")";this._div.style.transform=f,this._div.style["-webkit-transform"]=f}},e.initStyle=function(){if(this._div){var t=this._div;t.style.position="absolute",t.style.bottom="0px",t.style.left="0px"}},e.updateURL=function(t){var e=this._iframe;e.src=t;var i=this,n=function(){i._loaded=!0,e.removeEventListener("load",n)};e.addEventListener("load",n)},e.changeSize=function(t,e){var i=this._div;i&&(i.style.width=t+"px",i.style.height=e+"px")},e.removeDom=function(){var t=this._div;if(t){var e=!1;e="contains"in n.container?n.container.contains(t):n.container.compareDocumentPosition(t)%16,e&&n.container.removeChild(t)}}}(r.WebView._polyfill),r.VideoPlayer=r.Widget.extend({_played:!1,_playing:!1,_stopped:!0,ctor:function(t){r.Widget.prototype.ctor.call(this),this._EventList={},t&&this.setURL(t)},_createRenderCmd:function(){return new r.VideoPlayer.RenderCmd(this)},setURL:function(t){this._renderCmd.updateURL(t)},getURL:function(){return this._renderCmd._url},play:function(){var t=this,e=this._renderCmd._video;e&&(this._played=!0,e.pause(),(this._stopped!==!1||this._playing!==!1||this._played!==!0)&&(e.currentTime=0),r.VideoPlayer._polyfill.autoplayAfterOperation?setTimeout(function(){e.play(),t._playing=!0,t._stopped=!1},20):(e.play(),this._playing=!0,this._stopped=!1))},pause:function(){var t=this._renderCmd._video;t&&this._playing===!0&&this._stopped===!1&&(t.pause(),this._playing=!1)},resume:function(){this._stopped===!1&&this._playing===!1&&this._played===!0&&this.play()},stop:function(){var t=this,e=this._renderCmd._video;e&&(e.pause(),e.currentTime=0,this._playing=!1,this._stopped=!0),setTimeout(function(){t._dispatchEvent(r.VideoPlayer.EventType.STOPPED)},0)},seekTo:function(t){var e=this._renderCmd._video;e&&(e.currentTime=t,r.VideoPlayer._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout(function(){e.play()},20))},isPlaying:function(){return r.VideoPlayer._polyfill.autoplayAfterOperation&&this._playing&&setTimeout(function(){video.play()},20),this._playing},setKeepAspectRatioEnabled:function(t){n.log("On the web is always keep the aspect ratio")},isKeepAspectRatioEnabled:function(){return!1},setFullScreenEnabled:function(t){var e=this._renderCmd._video;e&&(t?n.screen.requestFullScreen(e):n.screen.exitFullScreen(e))},isFullScreenEnabled:function(){n.log("Can't know status")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];e&&e.call(this,this,this._renderCmd._video.src)},onPlayEvent:function(){var t=this._EventList[r.VideoPlayer.EventType.PLAYING];if(t)for(var e=0;e<t.length;e++)t[e].call(this,this,this._renderCmd._video.src)},setContentSize:function(t,e){r.Widget.prototype.setContentSize.call(this,t,e),void 0===e&&(e=t.height,t=t.width),this._renderCmd.changeSize(t,e)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()},onEnter:function(){r.Widget.prototype.onEnter.call(this);var t=r.VideoPlayer.elements;-1===t.indexOf(this)&&t.push(this)},onExit:function(){r.Widget.prototype.onExit.call(this);var t=r.VideoPlayer.elements,e=t.indexOf(this);-1!==e&&t.splice(e,1)}}),r.VideoPlayer.elements=[],r.VideoPlayer.pauseElements=[],n.eventManager.addCustomListener(n.game.EVENT_HIDE,function(){for(var t,e=r.VideoPlayer.elements,i=0;i<e.length;i++)t=e[i],e[i]._playing&&(t.pause(),r.VideoPlayer.pauseElements.push(t))}),n.eventManager.addCustomListener(n.game.EVENT_SHOW,function(){for(var t=r.VideoPlayer.pauseElements,e=t.pop();e;)e.play(),e=t.pop()}),r.VideoPlayer.EventType={PLAYING:"play",PAUSED:"pause",STOPPED:"stop",COMPLETED:"complete"},function(t){t._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]},function(){var e=document.createElement("video");e.canPlayType("video/ogg")&&(t._polyfill.canPlayType.push(".ogg"),t._polyfill.canPlayType.push(".ogv")),e.canPlayType("video/mp4")&&t._polyfill.canPlayType.push(".mp4"),e.canPlayType("video/webm")&&t._polyfill.canPlayType.push(".webm")}(),n.sys.OS_IOS===n.sys.os&&(t._polyfill.devicePixelRatio=!0,t._polyfill.event="progress"),n.sys.browserType===n.sys.BROWSER_TYPE_FIREFOX&&(t._polyfill.autoplayAfterOperation=!0);var e=document.createElement("style");e.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(e)}(r.VideoPlayer),function(t){r.VideoPlayer.RenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._listener=null,this._url="",this.initStyle()};var e=r.VideoPlayer.RenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);e.constructor=r.VideoPlayer.RenderCmd,e.visit=function(){var t=this,e=n.container,i=n.eventManager;if(this._node._visible)e.appendChild(this._video),null===this._listener&&(this._listener=n.eventManager.addCustomListener(n.game.EVENT_RESIZE,function(){t.resize()}));else{var r=!1;r="contains"in e?e.contains(this._video):e.compareDocumentPosition(this._video)%16,r&&e.removeChild(this._video),i.removeListener(this._listener),this._listener=null}this.updateStatus()},e.updateStatus=function(){t.devicePixelRatio=n.view.isRetinaEnabled();var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag;i&e.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,n.view._scaleX,n.view._scaleY),this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty^this._dirtyFlag)},e.resize=function(t){t=t||n.view;var e=this._node,i=n.eventManager;e._parent&&e._visible?this.updateMatrix(this._worldTransform,t._scaleX,t._scaleY):(i.removeListener(this._listener),this._listener=null)},e.updateMatrix=function(e,i,n){var r=this._node;if(t.devicePixelRatio){var s=window.devicePixelRatio;i/=s,n/=s}if(this._loaded!==!1){var o=r._contentSize.width,a=r._contentSize.height,c=e.a*i,h=e.b,l=e.c,d=e.d*n,u=e.tx*i-o/2+o*r._scaleX/2*i,_=e.ty*n-a/2+a*r._scaleY/2*n,f="matrix("+c+","+h+","+l+","+d+","+u+","+-_+")";this._video.style.transform=f,this._video.style["-webkit-transform"]=f}},e.updateURL=function(e){var i,r,s,o,a,c=this._node;if(this._url!=e){this._url=e,n.loader.resPath&&!/^http/.test(e)&&(e=n.path.join(n.loader.resPath,e)),s=!1,o=n.container,s="contains"in o?o.contains(this._video):o.compareDocumentPosition(this._video)%16,s&&o.removeChild(this._video),this._video=document.createElement("video"),r=this._video,this.bindEvent();var h=this,l=function(){1!=h._loaded&&(h._loaded=!0,h.changeSize(),h.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),r.removeEventListener(t.event,l),r.currentTime=0,r.style.visibility="visible",r.play(),c._played||(r.pause(),r.currentTime=0))};r.addEventListener(t.event,l),r.preload="metadata",r.style.visibility="hidden",this._loaded=!1,c._played=!1,c._playing=!1,c._stopped=!0,this.initStyle(),this.visit(),i=document.createElement("source"),i.src=e,r.appendChild(i),a=n.path.extname(e);for(var d=0;d<t.canPlayType.length;d++)a!==t.canPlayType[d]&&(i=document.createElement("source"),i.src=e.replace(a,t.canPlayType[d]),r.appendChild(i))}},e.bindEvent=function(){var t=this,e=this._node,i=this._video;i.addEventListener("ended",function(){e._renderCmd.updateMatrix(t._worldTransform,n.view._scaleX,n.view._scaleY),e._playing=!1,e._dispatchEvent(r.VideoPlayer.EventType.COMPLETED)}),i.addEventListener("play",function(){e._dispatchEvent(r.VideoPlayer.EventType.PLAYING)}),i.addEventListener("pause",function(){e._dispatchEvent(r.VideoPlayer.EventType.PAUSED)})},e.initStyle=function(){if(this._video){var t=this._video;t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.className="cocosVideo"}},e.changeSize=function(t,e){var i=this._node._contentSize;t=t||i.width,e=e||i.height;var n=this._video;n&&(0!==t&&(n.width=t),0!==e&&(n.height=e))},e.removeDom=function(){var t=this._video;if(t){var e=!1;e="contains"in n.container?n.container.contains(t):n.container.compareDocumentPosition(t)%16,e&&n.container.removeChild(t)}}}(r.VideoPlayer._polyfill),r.RichElement=r.Class.extend({_type:0,_tag:0,_color:null,_opacity:0,ctor:function(){this._type=0,this._tag=0,this._color=n.color(255,255,255,255)},init:function(t,e,i){this._tag=t,this._color.r=e.r,this._color.g=e.g,this._color.b=e.b,this._opacity=i,this._color.a=void 0===i?e.a:i}}),r.RichElementText=r.RichElement.extend({_text:"",_fontName:"",_fontSize:0,_fontDefinition:null,ctor:function(t,e,i,s,o,a){r.RichElement.prototype.ctor.call(this),this._type=r.RichElement.TEXT,this._text="",this._fontName="",this._fontSize=0,e&&e instanceof n.FontDefinition?this.initWithStringAndTextDefinition(t,s,e,i):a&&this.init(t,e,i,s,o,a)},init:function(t,e,i,n,s,o){r.RichElement.prototype.init.call(this,t,e,i),this._text=n,this._fontName=s,this._fontSize=o},initWithStringAndTextDefinition:function(t,e,i,n){r.RichElement.prototype.init.call(this,t,i.fillStyle,n),this._fontDefinition=i,this._text=e,this._fontName=i.fontName,this._fontSize=i.fontSize}}),r.RichElementText.create=function(t,e,i,n,s,o){return new r.RichElementText(t,e,i,n,s,o)},r.RichElementImage=r.RichElement.extend({_filePath:"",_textureRect:null,_textureType:0,ctor:function(t,e,i,s){r.RichElement.prototype.ctor.call(this),this._type=r.RichElement.IMAGE,this._filePath="",this._textureRect=n.rect(0,0,0,0),this._textureType=0,void 0!==s&&this.init(t,e,i,s)},init:function(t,e,i,n){r.RichElement.prototype.init.call(this,t,e,i),this._filePath=n}}),r.RichElementImage.create=function(t,e,i,n){return new r.RichElementImage(t,e,i,n)},r.RichElementCustomNode=r.RichElement.extend({_customNode:null,ctor:function(t,e,i,n){r.RichElement.prototype.ctor.call(this),this._type=r.RichElement.CUSTOM,this._customNode=null,void 0!==n&&this.init(t,e,i,n)},init:function(t,e,i,n){r.RichElement.prototype.init.call(this,t,e,i),this._customNode=n}}),r.RichElementCustomNode.create=function(t,e,i,n){return new r.RichElementCustomNode(t,e,i,n)},r.RichText=r.Widget.extend({_formatTextDirty:!1,_richElements:null,_elementRenders:null,_leftSpaceWidth:0,_verticalSpace:0,_elementRenderersContainer:null,_lineBreakOnSpace:!1,_textHorizontalAlignment:null,_textVerticalAlignment:null,ctor:function(){r.Widget.prototype.ctor.call(this),this._formatTextDirty=!1,this._richElements=[],this._elementRenders=[],this._leftSpaceWidth=0,this._verticalSpace=0,this._textHorizontalAlignment=n.TextAlignment.LEFT,this._textVerticalAlignment=n.VerticalTextAlignment.TOP},_initRenderer:function(){this._elementRenderersContainer=new _ccsg.Node,this._elementRenderersContainer.setAnchorPoint(.5,.5),this.addProtectedChild(this._elementRenderersContainer,0,-1)},insertElement:function(t,e){this._richElements.splice(e,0,t),this._formatTextDirty=!0},pushBackElement:function(t){this._richElements.push(t),this._formatTextDirty=!0},removeElement:function(t){n.js.isNumber(t)?this._richElements.splice(t,1):n.js.array.remove(this._richElements,t),this._formatTextDirty=!0},formatText:function(){if(this._formatTextDirty){this._elementRenderersContainer.removeAllChildren(),this._elementRenders.length=0;var t,e,i=this._richElements;if(this._ignoreSize)for(this._addNewLine(),t=0;t<i.length;t++){e=i[t];var s=null;switch(e._type){case r.RichElement.TEXT:s=e._fontDefinition?new n.LabelTTF(e._text,e._fontDefinition):new n.LabelTTF(e._text,e._fontName,e._fontSize);break;case r.RichElement.IMAGE:s=new n.Sprite(e._filePath);break;case r.RichElement.CUSTOM:s=e._customNode}s.setColor(e._color),s.setOpacity(e._color.a),this._pushToContainer(s)}else for(this._addNewLine(),t=0;t<i.length;t++)switch(e=i[t],e._type){case r.RichElement.TEXT:e._fontDefinition?this._handleTextRenderer(e._text,e._fontDefinition,e._fontDefinition.fontSize,e._fontDefinition.fillStyle):this._handleTextRenderer(e._text,e._fontName,e._fontSize,e._color);break;case r.RichElement.IMAGE:this._handleImageRenderer(e._filePath,e._color,e._color.a);break;case r.RichElement.CUSTOM:this._handleCustomRenderer(e._customNode)}this.formatRenderers(),this._formatTextDirty=!1}},_handleTextRenderer:function(t,e,i,r){if(""!==t){if("\n"===t)return void this._addNewLine();var s=e instanceof n.FontDefinition?new n.LabelTTF(t,e):new n.LabelTTF(t,e,i),o=s.getContentSize().width;if(this._leftSpaceWidth-=o,this._leftSpaceWidth<0){var a=-this._leftSpaceWidth/o,c=t,h=c.length,l=h*(1-a),d=c.substr(0,l),u=c.substr(l,c.length-1),_=l>0;if(this._lineBreakOnSpace){var f=d.lastIndexOf(" ");l=-1===f?l:f+1,u=c.substr(l,c.length-1),_=l>0&&" "!==u}if(_){var p=null;e instanceof n.FontDefinition?(p=new n.LabelTTF(d.substr(0,l),e),p.setOpacity(e.fillStyle.a)):(p=new n.LabelTTF(d.substr(0,l),e,i),p.setColor(r),p.setOpacity(r.a)),this._pushToContainer(p)}this._addNewLine(),this._handleTextRenderer(u,e,i,r)}else e instanceof n.FontDefinition?s.setOpacity(e.fillStyle.a):(s.setColor(r),s.setOpacity(r.a)),this._pushToContainer(s)}},_handleImageRenderer:function(t,e,i){var r=new n.Sprite(t);this._handleCustomRenderer(r)},_handleCustomRenderer:function(t){var e=t.getContentSize();this._leftSpaceWidth-=e.width,this._leftSpaceWidth<0?(this._addNewLine(),this._pushToContainer(t),this._leftSpaceWidth-=e.width):this._pushToContainer(t)},_addNewLine:function(){this._leftSpaceWidth=this._customSize.width,this._elementRenders.push([])},formatRenderers:function(){var t,e,i,r,s,o,a,c=0,h=this._elementRenderersContainer,l=this._elementRenders;if(this._ignoreSize){var d=0;for(i=l[0],r=0,e=0;e<i.length;e++){s=i[e],s.setAnchorPoint(n.p(0,0)),s.setPosition(r,0),h.addChild(s,1,e),o=s.getLineHeight?s.getLineHeight():c;var u=s.getContentSize();d+=u.width,c=Math.max(Math.min(c,o),u.height),r+=u.width}if(this._textHorizontalAlignment!==n.TextAlignment.LEFT)for(a=0,this._textHorizontalAlignment===n.TextAlignment.RIGHT?a=this._contentSize.width-r:this._textHorizontalAlignment===n.TextAlignment.CENTER&&(a=(this._contentSize.width-r)/2),e=0;e<i.length;e++)i[e].x+=a;h.setContentSize(d,c)}else{var _=[];for(t=0;t<l.length;t++){i=l[t];var f=0;for(e=0;e<i.length;e++)s=i[e],o=s.getLineHeight?s.getLineHeight():s.getContentSize().height,f=Math.max(Math.min(s.getContentSize().height,o),f);_[t]=f,c+=_[t]}var p=this._customSize.height;for(t=0;t<l.length;t++){for(i=l[t],r=0,p-=_[t]+this._verticalSpace,e=0;e<i.length;e++)s=i[e],s.setAnchorPoint(n.p(0,0)),s.setPosition(n.p(r,p)),h.addChild(s,1),r+=s.getContentSize().width;if(this._textHorizontalAlignment!==n.TextAlignment.LEFT||this._textVerticalAlignment!==n.VerticalTextAlignment.TOP){a=0,this._textHorizontalAlignment===n.TextAlignment.RIGHT?a=this._contentSize.width-r:this._textHorizontalAlignment===n.TextAlignment.CENTER&&(a=(this._contentSize.width-r)/2);var g=0;for(this._textVerticalAlignment===n.VerticalTextAlignment.BOTTOM?g=this._customSize.height-c:this._textVerticalAlignment===n.VerticalTextAlignment.CENTER&&(g=(this._customSize.height-c)/2),e=0;e<i.length;e++)s=i[e],s.x+=a,s.y-=g}}h.setContentSize(this._contentSize)}var m=l.length;for(t=0;m>t;t++)l[t].length=0;this._elementRenders.length=0,this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():this._customSize),this._updateContentSizeWithTextureSize(this._contentSize),h.setPosition(.5*this._contentSize.width,.5*this._contentSize.height)},_pushToContainer:function(t){this._elementRenders.length<=0||this._elementRenders[this._elementRenders.length-1].push(t)},_adaptRenderers:function(){this.formatText()},setVerticalSpace:function(t){this._verticalSpace=t},setAnchorPoint:function(t){r.Widget.prototype.setAnchorPoint.call(this,t),this._elementRenderersContainer.setAnchorPoint(t)},_setAnchorX:function(t){r.Widget.prototype._setAnchorX.call(this,t),this._elementRenderersContainer._setAnchorX(t)},_setAnchorY:function(t){r.Widget.prototype._setAnchorY.call(this,t),this._elementRenderersContainer._setAnchorY(t)},getVirtualRendererSize:function(){return this._elementRenderersContainer.getContentSize()},ignoreContentAdaptWithSize:function(t){this._ignoreSize!==t&&(this._formatTextDirty=!0,r.Widget.prototype.ignoreContentAdaptWithSize.call(this,t))},getContentSize:function(){return this.formatText(),_ccsg.Node.prototype.getContentSize.call(this)},_getWidth:function(){return this.formatText(),_ccsg.Node.prototype._getWidth.call(this)},_getHeight:function(){return this.formatText(),_ccsg.Node.prototype._getHeight.call(this)},setContentSize:function(t,e){var i=void 0===e?t.width:t,n=void 0===e?t.height:e;r.Widget.prototype.setContentSize.call(this,i,n),
this._formatTextDirty=!0},getDescription:function(){return"RichText"},setCascadeOpacityEnabled:function(t){this._super(t),this._elementRenderersContainer.setCascadeOpacityEnabled(t)},setLineBreakOnSpace:function(t){this._lineBreakOnSpace=t,this._formatTextDirty=!0,this.formatText()},setTextHorizontalAlignment:function(t){t!==this._textHorizontalAlignment&&(this._textHorizontalAlignment=t,this.formatText())},setTextVerticalAlignment:function(t){t!==this._textVerticalAlignment&&(this._textVerticalAlignment=t,this.formatText())}}),r.RichText.create=function(){return new r.RichText},r.RichElement.TEXT=0,r.RichElement.IMAGE=1,r.RichElement.CUSTOM=2,r.ScrollView=r.Layout.extend({_innerContainer:null,direction:null,_autoScrollDir:null,_topBoundary:0,_bottomBoundary:0,_leftBoundary:0,_rightBoundary:0,_bounceTopBoundary:0,_bounceBottomBoundary:0,_bounceLeftBoundary:0,_bounceRightBoundary:0,_autoScroll:!1,_autoScrollAddUpTime:0,_autoScrollOriginalSpeed:0,_autoScrollAcceleration:0,_isAutoScrollSpeedAttenuated:!1,_needCheckAutoScrollDestination:!1,_autoScrollDestination:null,_bePressed:!1,_slidTime:0,_moveChildPoint:null,_childFocusCancelOffset:0,_leftBounceNeeded:!1,_topBounceNeeded:!1,_rightBounceNeeded:!1,_bottomBounceNeeded:!1,bounceEnabled:!1,_bouncing:!1,_bounceDir:null,_bounceOriginalSpeed:0,inertiaScrollEnabled:!1,_scrollViewEventListener:null,_scrollViewEventSelector:null,_className:"ScrollView",ctor:function(){r.Layout.prototype.ctor.call(this),this.direction=r.ScrollView.Dir.NONE,this._autoScrollDir=n.p(0,0),this._autoScrollAcceleration=-1e3,this._autoScrollDestination=n.p(0,0),this._slidTime=0,this._moveChildPoint=n.p(0,0),this._childFocusCancelOffset=5,this._bounceDir=n.p(0,0),this._bounceOriginalSpeed=0,this.inertiaScrollEnabled=!0,this.setTouchEnabled(!0),this.on(n.Event.TOUCH,this.interceptTouchEvent)},init:function(){return r.Layout.prototype.init.call(this)?(this.setClippingEnabled(!0),this._innerContainer.setTouchEnabled(!1),!0):!1},onEnter:function(){r.Layout.prototype.onEnter.call(this),this.scheduleUpdate(!0)},findNextFocusedWidget:function(t,e){return this.getLayoutType()===r.Layout.Type.LINEAR_VERTICAL||this.getLayoutType()===r.Layout.Type.LINEAR_HORIZONTAL?this._innerContainer.findNextFocusedWidget(t,e):r.Widget.prototype.findNextFocusedWidget.call(this,t,e)},_initRenderer:function(){r.Layout.prototype._initRenderer.call(this),this._innerContainer=new r.Layout,this._innerContainer.setColor(n.color(255,255,255)),this._innerContainer.setOpacity(255),this._innerContainer.setCascadeColorEnabled(!0),this._innerContainer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._innerContainer,1,1)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_WEBGL?new r.ScrollView.WebGLRenderCmd(this):new r.ScrollView.CanvasRenderCmd(this)},_onSizeChanged:function(){r.Layout.prototype._onSizeChanged.call(this);var t=this._contentSize;this._topBoundary=t.height,this._rightBoundary=t.width;var e=t.width/3,i=t.height/3;this._bounceTopBoundary=t.height-i,this._bounceBottomBoundary=i,this._bounceLeftBoundary=e,this._bounceRightBoundary=t.width-e;var s=this._innerContainer.getContentSize();this._innerContainer.setContentSize(n.size(Math.max(s.width,t.width),Math.max(s.height,t.height))),this._innerContainer.setPosition(0,t.height-this._innerContainer.getContentSize().height)},setInnerContainerSize:function(t){var e=this._innerContainer,i=this._contentSize,s=i.width,o=i.height,a=e.getContentSize();t.width<i.width?n.log("Inner width <= ScrollView width, it will be force sized!"):s=t.width,t.height<i.height?n.log("Inner height <= ScrollView height, it will be force sized!"):o=t.height,e.setContentSize(n.size(s,o));var c,h;switch(this.direction){case r.ScrollView.Dir.VERTICAL:c=e.getContentSize(),h=a.height-c.height,this._scrollChildren(0,h);break;case r.ScrollView.Dir.HORIZONTAL:e.getRightBoundary()<=i.width&&(c=e.getContentSize(),h=a.width-c.width,this._scrollChildren(h,0));break;case r.ScrollView.Dir.BOTH:c=e.getContentSize();var l=a.height-c.height,d=e.getRightBoundary()<=i.width?a.width-c.width:0;this._scrollChildren(d,l)}var u=e.getContentSize(),_=e.getPosition(),f=e.getAnchorPoint();e.getLeftBoundary()>0&&e.setPosition(f.x*u.width,_.y),e.getRightBoundary()<i.width&&e.setPosition(i.width-(1-f.x)*u.width,_.y),_.y>0&&e.setPosition(_.x,f.y*u.height),e.getTopBoundary()<i.height&&e.setPosition(_.x,i.height-(1-f.y)*u.height)},_setInnerWidth:function(t){var e=this._contentSize.width,i=e,s=this._innerContainer,o=s.width;switch(e>t?n.log("Inner width <= scrollview width, it will be force sized!"):i=t,s.width=i,this.direction){case r.ScrollView.Dir.HORIZONTAL:case r.ScrollView.Dir.BOTH:if(s.getRightBoundary()<=e){var a=s.width,c=o-a;this._scrollChildren(c,0)}}var h=s.anchorX;s.getLeftBoundary()>0&&(s.x=h*i),s.getRightBoundary()<e&&(s.x=e-(1-h)*i)},_setInnerHeight:function(t){var e=this._contentSize.height,i=e,s=this._innerContainer,o=s.height;switch(e>t?n.log("Inner height <= scrollview height, it will be force sized!"):i=t,s.height=i,this.direction){case r.ScrollView.Dir.VERTICAL:case r.ScrollView.Dir.BOTH:var a=i,c=o-a;this._scrollChildren(0,c)}var h=s.anchorY;s.getLeftBoundary()>0&&(s.y=h*i),s.getRightBoundary()<e&&(s.y=e-(1-h)*i)},getInnerContainerSize:function(){return this._innerContainer.getContentSize()},_getInnerWidth:function(){return this._innerContainer.width},_getInnerHeight:function(){return this._innerContainer.height},_isInContainer:function(t){var e=t._position,i=t._contentSize,n=t._anchorPoint,r=this._customSize,s=this._innerContainer._position,o=0,a=0;return(o=e.y-n.y*i.height)>=r.height-s.y||o+i.height<=-s.y||(a=e.x-n.x*i.width)>=r.width-s.x||a+i.width<=-s.x?!1:!0},updateChildren:function(){for(var t,e=this._innerContainer._children,i=0;i<e.length;i++)t=e[i],t._inViewRect===!0&&this._isInContainer(t)===!1?t._inViewRect=!1:t._inViewRect===!1&&this._isInContainer(t)===!0&&(t._inViewRect=!0)},addChild:function(t,e,i){return t?(this._clippingEnabled&&this._isInContainer(t)===!1&&(t._inViewRect=!1),e=e||t.getLocalZOrder(),i=i||t.getTag(),this._innerContainer.addChild(t,e,i)):!1},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(t){this._innerContainer.removeAllChildrenWithCleanup(t)},removeChild:function(t,e){return this._innerContainer.removeChild(t,e)},getChildren:function(){return this._innerContainer.getChildren()},getChildrenCount:function(){return this._innerContainer.getChildrenCount()},getChildByTag:function(t){return this._innerContainer.getChildByTag(t)},getChildByName:function(t){return this._innerContainer.getChildByName(t)},_moveChildren:function(t,e){var i=this._innerContainer;this._moveChildPoint.x=i.x+t,this._moveChildPoint.y=i.y+e,this._innerContainer.setPosition(this._moveChildPoint),this._clippingEnabled&&0!==this._innerContainer._children.length&&this.updateChildren()},_autoScrollChildren:function(t){var e=this._autoScrollAddUpTime;if(this._autoScrollAddUpTime+=t,this._isAutoScrollSpeedAttenuated){var i=this._autoScrollOriginalSpeed+this._autoScrollAcceleration*this._autoScrollAddUpTime;if(0>=i)this._stopAutoScrollChildren(),this._checkNeedBounce();else{var n=2*e+t,r=(this._autoScrollOriginalSpeed+this._autoScrollAcceleration*n*.5)*t,s=r*this._autoScrollDir.x,o=r*this._autoScrollDir.y;this._scrollChildren(s,o)||(this._stopAutoScrollChildren(),this._checkNeedBounce())}}else if(this._needCheckAutoScrollDestination){var a=this._autoScrollDir.x*t*this._autoScrollOriginalSpeed,c=this._autoScrollDir.y*t*this._autoScrollOriginalSpeed,h=this._checkCustomScrollDestination(a,c),l=this._scrollChildren(a,c);h&&l||(this._stopAutoScrollChildren(),this._checkNeedBounce())}else this._scrollChildren(this._autoScrollDir.x*t*this._autoScrollOriginalSpeed,this._autoScrollDir.y*t*this._autoScrollOriginalSpeed)||(this._stopAutoScrollChildren(),this._checkNeedBounce())},_bounceChildren:function(t){var e=this._bounceOriginalSpeed,i=this._bounceDir;0>=e&&this._stopBounceChildren(),this._bounceScrollChildren(i.x*t*e,i.y*t*e)||this._stopBounceChildren()},_checkNeedBounce:function(){if(!this.bounceEnabled)return!1;this._checkBounceBoundary();var t=this._topBounceNeeded,e=this._bottomBounceNeeded,i=this._leftBounceNeeded,r=this._rightBounceNeeded;if(t||e||i||r){var s,o,a=this._contentSize,c=this._innerContainer;return t&&i?(s=n.pSub(n.p(0,a.height),n.p(c.getLeftBoundary(),c.getTopBoundary())),o=n.pLength(s)/.2,this._bounceDir=n.pNormalize(s),this._startBounceChildren(o)):t&&r?(s=n.pSub(n.p(a.width,a.height),n.p(c.getRightBoundary(),c.getTopBoundary())),o=n.pLength(s)/.2,this._bounceDir=n.pNormalize(s),this._startBounceChildren(o)):e&&i?(s=n.pSub(n.p(0,0),n.p(c.getLeftBoundary(),c.getBottomBoundary())),o=n.pLength(s)/.2,this._bounceDir=n.pNormalize(s),this._startBounceChildren(o)):e&&r?(s=n.pSub(n.p(a.width,0),n.p(c.getRightBoundary(),c.getBottomBoundary())),o=n.pLength(s)/.2,this._bounceDir=n.pNormalize(s),this._startBounceChildren(o)):t?(s=n.pSub(n.p(0,a.height),n.p(0,c.getTopBoundary())),o=n.pLength(s)/.2,this._bounceDir=n.pNormalize(s),this._startBounceChildren(o)):e?(s=n.pSub(n.p(0,0),n.p(0,c.getBottomBoundary())),o=n.pLength(s)/.2,this._bounceDir=n.pNormalize(s),this._startBounceChildren(o)):i?(s=n.pSub(n.p(0,0),n.p(c.getLeftBoundary(),0)),o=n.pLength(s)/.2,this._bounceDir=n.pNormalize(s),this._startBounceChildren(o)):r&&(s=n.pSub(n.p(a.width,0),n.p(c.getRightBoundary(),0)),o=n.pLength(s)/.2,this._bounceDir=n.pNormalize(s),this._startBounceChildren(o)),!0}return!1},_checkBounceBoundary:function(){var t=this._innerContainer,e=t.getBottomBoundary();e>this._bottomBoundary?(this._scrollToBottomEvent(),this._bottomBounceNeeded=!0):this._bottomBounceNeeded=!1;var i=t.getTopBoundary();i<this._topBoundary?(this._scrollToTopEvent(),this._topBounceNeeded=!0):this._topBounceNeeded=!1;var n=t.getRightBoundary();n<this._rightBoundary?(this._scrollToRightEvent(),this._rightBounceNeeded=!0):this._rightBounceNeeded=!1;var r=t.getLeftBoundary();r>this._leftBoundary?(this._scrollToLeftEvent(),this._leftBounceNeeded=!0):this._leftBounceNeeded=!1},_startBounceChildren:function(t){this._bounceOriginalSpeed=t,this._bouncing=!0},_stopBounceChildren:function(){this._bouncing=!1,this._bounceOriginalSpeed=0,this._leftBounceNeeded=!1,this._rightBounceNeeded=!1,this._topBounceNeeded=!1,this._bottomBounceNeeded=!1},_startAutoScrollChildrenWithOriginalSpeed:function(t,e,i,n){this._stopAutoScrollChildren(),this._autoScrollDir.x=t.x,this._autoScrollDir.y=t.y,this._isAutoScrollSpeedAttenuated=i,this._autoScrollOriginalSpeed=e,this._autoScroll=!0,this._autoScrollAcceleration=n},_startAutoScrollChildrenWithDestination:function(t,e,i){this._needCheckAutoScrollDestination=!1,this._autoScrollDestination=t;var r=n.pSub(t,this._innerContainer.getPosition()),s=n.pNormalize(r),o=0,a=-1e3,c=n.pLength(r);i?(a=-(2*c)/(e*e),o=2*c/e):(this._needCheckAutoScrollDestination=!0,o=c/e),this._startAutoScrollChildrenWithOriginalSpeed(s,o,i,a)},_jumpToDestination:function(t,e){void 0!==t.x&&(e=t.y,t=t.x);var i=t,n=e;switch(this.direction){case r.ScrollView.Dir.VERTICAL:0>=e&&(n=Math.max(e,this._contentSize.height-this._innerContainer.getContentSize().height));break;case r.ScrollView.Dir.HORIZONTAL:0>=t&&(i=Math.max(t,this._contentSize.width-this._innerContainer.getContentSize().width));break;case r.ScrollView.Dir.BOTH:0>=e&&(n=Math.max(e,this._contentSize.height-this._innerContainer.getContentSize().height)),0>=t&&(i=Math.max(t,this._contentSize.width-this._innerContainer.getContentSize().width))}this._innerContainer.setPosition(i,n)},_stopAutoScrollChildren:function(){this._autoScroll=!1,this._autoScrollOriginalSpeed=0,this._autoScrollAddUpTime=0},_bounceScrollChildren:function(t,e){var i,n,r,s,o,a=!0,c=this._innerContainer;if(t>0&&e>0)i=t,n=e,r=c.getRightBoundary(),r+i>=this._rightBoundary&&(i=this._rightBoundary-r,this._bounceRightEvent(),a=!1),s=c.getTopBoundary(),s+e>=this._topBoundary&&(n=this._topBoundary-s,this._bounceTopEvent(),a=!1),this._moveChildren(i,n);else if(0>t&&e>0)i=t,n=e,h=c.getLeftBoundary(),h+i<=this._leftBoundary&&(i=this._leftBoundary-h,this._bounceLeftEvent(),a=!1),s=c.getTopBoundary(),s+e>=this._topBoundary&&(n=this._topBoundary-s,this._bounceTopEvent(),a=!1),this._moveChildren(i,n);else if(0>t&&0>e){i=t,n=e;var h=c.getLeftBoundary();h+i<=this._leftBoundary&&(i=this._leftBoundary-h,this._bounceLeftEvent(),a=!1),o=c.getBottomBoundary(),o+e<=this._bottomBoundary&&(n=this._bottomBoundary-o,this._bounceBottomEvent(),a=!1),this._moveChildren(i,n)}else if(t>0&&0>e)i=t,n=e,r=c.getRightBoundary(),r+i>=this._rightBoundary&&(i=this._rightBoundary-r,this._bounceRightEvent(),a=!1),o=c.getBottomBoundary(),o+e<=this._bottomBoundary&&(n=this._bottomBoundary-o,this._bounceBottomEvent(),a=!1),this._moveChildren(i,n);else if(0===t&&e>0)n=e,s=c.getTopBoundary(),s+e>=this._topBoundary&&(n=this._topBoundary-s,this._bounceTopEvent(),a=!1),this._moveChildren(0,n);else if(0===t&&0>e)n=e,o=c.getBottomBoundary(),o+e<=this._bottomBoundary&&(n=this._bottomBoundary-o,this._bounceBottomEvent(),a=!1),this._moveChildren(0,n);else if(t>0&&0===e)i=t,r=c.getRightBoundary(),r+i>=this._rightBoundary&&(i=this._rightBoundary-r,this._bounceRightEvent(),a=!1),this._moveChildren(i,0);else if(0>t&&0===e){i=t;var l=c.getLeftBoundary();l+i<=this._leftBoundary&&(i=this._leftBoundary-l,this._bounceLeftEvent(),a=!1),this._moveChildren(i,0)}return a},_checkCustomScrollDestination:function(t,e){var i,n,s,o,a=!0,c=this._innerContainer,h=this._autoScrollDestination;switch(this.direction){case r.ScrollView.Dir.VERTICAL:this._autoScrollDir.y>0?(i=c.getBottomBoundary(),i+e>=h.y&&(e=h.y-i,a=!1)):(i=c.getBottomBoundary(),i+e<=h.y&&(e=h.y-i,a=!1));break;case r.ScrollView.Dir.HORIZONTAL:this._autoScrollDir.x>0?(n=c.getLeftBoundary(),n+t>=h.x&&(t=h.x-n,a=!1)):(n=c.getLeftBoundary(),n+t<=h.x&&(t=h.x-n,a=!1));break;case r.ScrollView.Dir.BOTH:t>0&&e>0?(n=c.getLeftBoundary(),n+t>=h.x&&(t=h.x-n,a=!1),i=c.getBottomBoundary(),i+e>=h.y&&(e=h.y-i,a=!1)):0>t&&e>0?(s=c.getRightBoundary(),s+t<=h.x&&(t=h.x-s,a=!1),i=c.getBottomBoundary(),i+e>=h.y&&(e=h.y-i,a=!1)):0>t&&0>e?(s=c.getRightBoundary(),s+t<=h.x&&(t=h.x-s,a=!1),o=c.getTopBoundary(),o+e<=h.y&&(e=h.y-o,a=!1)):t>0&&0>e?(n=c.getLeftBoundary(),n+t>=h.x&&(t=h.x-n,a=!1),o=c.getTopBoundary(),o+e<=h.y&&(e=h.y-o,a=!1)):0===t&&e>0?(i=c.getBottomBoundary(),i+e>=h.y&&(e=h.y-i,a=!1)):0>t&&0===e?(s=c.getRightBoundary(),s+t<=h.x&&(t=h.x-s,a=!1)):0===t&&0>e?(o=c.getTopBoundary(),o+e<=h.y&&(e=h.y-o,a=!1)):t>0&&0===e&&(n=c.getLeftBoundary(),n+t>=h.x&&(t=h.x-n,a=!1))}return a},_scrollChildren:function(t,e){var i=!0;switch(this._scrollingEvent(),this.direction){case r.ScrollView.Dir.VERTICAL:i=this._scrollChildrenVertical(t,e);break;case r.ScrollView.Dir.HORIZONTAL:i=this._scrollChildrenHorizontal(t,e);break;case r.ScrollView.Dir.BOTH:i=this._scrollChildrenBoth(t,e)}return i},_scrollChildrenVertical:function(t,e){var i,n,r=e,s=!0,o=this._innerContainer;return this.bounceEnabled?(i=o.getBottomBoundary(),i+e>=this._bounceBottomBoundary&&(r=this._bounceBottomBoundary-i,this._scrollToBottomEvent(),s=!1),n=o.getTopBoundary(),n+e<=this._bounceTopBoundary&&(r=this._bounceTopBoundary-n,this._scrollToTopEvent(),s=!1)):(i=o.getBottomBoundary(),i+e>=this._bottomBoundary&&(r=this._bottomBoundary-i,this._scrollToBottomEvent(),s=!1),n=o.getTopBoundary(),n+e<=this._topBoundary&&(r=this._topBoundary-n,this._scrollToTopEvent(),s=!1)),this._moveChildren(0,r),s},_scrollChildrenHorizontal:function(t,e){var i,n,r=!0,s=t,o=this._innerContainer;return this.bounceEnabled?(i=o.getRightBoundary(),i+t<=this._bounceRightBoundary&&(s=this._bounceRightBoundary-i,this._scrollToRightEvent(),r=!1),n=o.getLeftBoundary(),n+t>=this._bounceLeftBoundary&&(s=this._bounceLeftBoundary-n,this._scrollToLeftEvent(),r=!1)):(i=o.getRightBoundary(),i+t<=this._rightBoundary&&(s=this._rightBoundary-i,this._scrollToRightEvent(),r=!1),n=o.getLeftBoundary(),n+t>=this._leftBoundary&&(s=this._leftBoundary-n,this._scrollToLeftEvent(),r=!1)),this._moveChildren(s,0),r},_scrollChildrenBoth:function(t,e){var i,n,r,s,o=!0,a=t,c=e,h=this._innerContainer;return this.bounceEnabled?t>0&&e>0?(i=h.getLeftBoundary(),i+t>=this._bounceLeftBoundary&&(a=this._bounceLeftBoundary-i,this._scrollToLeftEvent(),o=!1),n=h.getBottomBoundary(),n+e>=this._bounceBottomBoundary&&(c=this._bounceBottomBoundary-n,this._scrollToBottomEvent(),o=!1)):0>t&&e>0?(r=h.getRightBoundary(),r+t<=this._bounceRightBoundary&&(a=this._bounceRightBoundary-r,this._scrollToRightEvent(),o=!1),n=h.getBottomBoundary(),n+e>=this._bounceBottomBoundary&&(c=this._bounceBottomBoundary-n,this._scrollToBottomEvent(),o=!1)):0>t&&0>e?(r=h.getRightBoundary(),r+t<=this._bounceRightBoundary&&(a=this._bounceRightBoundary-r,this._scrollToRightEvent(),o=!1),s=h.getTopBoundary(),s+e<=this._bounceTopBoundary&&(c=this._bounceTopBoundary-s,this._scrollToTopEvent(),o=!1)):t>0&&0>e?(i=h.getLeftBoundary(),i+t>=this._bounceLeftBoundary&&(a=this._bounceLeftBoundary-i,this._scrollToLeftEvent(),o=!1),s=h.getTopBoundary(),s+e<=this._bounceTopBoundary&&(c=this._bounceTopBoundary-s,this._scrollToTopEvent(),o=!1)):0===t&&e>0?(n=h.getBottomBoundary(),n+e>=this._bounceBottomBoundary&&(c=this._bounceBottomBoundary-n,this._scrollToBottomEvent(),o=!1)):0>t&&0===e?(r=h.getRightBoundary(),r+t<=this._bounceRightBoundary&&(a=this._bounceRightBoundary-r,this._scrollToRightEvent(),o=!1)):0===t&&0>e?(s=h.getTopBoundary(),s+e<=this._bounceTopBoundary&&(c=this._bounceTopBoundary-s,this._scrollToTopEvent(),o=!1)):t>0&&0===e&&(i=h.getLeftBoundary(),i+t>=this._bounceLeftBoundary&&(a=this._bounceLeftBoundary-i,this._scrollToLeftEvent(),o=!1)):t>0&&e>0?(i=h.getLeftBoundary(),i+t>=this._leftBoundary&&(a=this._leftBoundary-i,this._scrollToLeftEvent(),o=!1),n=h.getBottomBoundary(),n+e>=this._bottomBoundary&&(c=this._bottomBoundary-n,this._scrollToBottomEvent(),o=!1)):0>t&&e>0?(r=h.getRightBoundary(),r+t<=this._rightBoundary&&(a=this._rightBoundary-r,this._scrollToRightEvent(),o=!1),n=h.getBottomBoundary(),n+e>=this._bottomBoundary&&(c=this._bottomBoundary-n,this._scrollToBottomEvent(),o=!1)):0>t&&0>e?(r=h.getRightBoundary(),r+t<=this._rightBoundary&&(a=this._rightBoundary-r,this._scrollToRightEvent(),o=!1),s=h.getTopBoundary(),s+e<=this._topBoundary&&(c=this._topBoundary-s,this._scrollToTopEvent(),o=!1)):t>0&&0>e?(i=h.getLeftBoundary(),i+t>=this._leftBoundary&&(a=this._leftBoundary-i,this._scrollToLeftEvent(),o=!1),s=this._innerContainer.getTopBoundary(),s+e<=this._topBoundary&&(c=this._topBoundary-s,this._scrollToTopEvent(),o=!1)):0===t&&e>0?(n=this._innerContainer.getBottomBoundary(),n+e>=this._bottomBoundary&&(c=this._bottomBoundary-n,this._scrollToBottomEvent(),o=!1)):0>t&&0===e?(r=this._innerContainer.getRightBoundary(),r+t<=this._rightBoundary&&(a=this._rightBoundary-r,this._scrollToRightEvent(),o=!1)):0===t&&0>e?(s=this._innerContainer.getTopBoundary(),s+e<=this._topBoundary&&(c=this._topBoundary-s,this._scrollToTopEvent(),o=!1)):t>0&&0===e&&(i=this._innerContainer.getLeftBoundary(),i+t>=this._leftBoundary&&(a=this._leftBoundary-i,this._scrollToLeftEvent(),o=!1)),this._moveChildren(a,c),o},scrollToBottom:function(t,e){this._startAutoScrollChildrenWithDestination(n.p(this._innerContainer.getPositionX(),0),t,e)},scrollToTop:function(t,e){this._startAutoScrollChildrenWithDestination(n.p(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToLeft:function(t,e){this._startAutoScrollChildrenWithDestination(n.p(0,this._innerContainer.getPositionY()),t,e)},scrollToRight:function(t,e){this._startAutoScrollChildrenWithDestination(n.p(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY()),t,e)},scrollToTopLeft:function(t,e){return this.direction!==r.ScrollView.Dir.BOTH?void n.log("Scroll direction is not both!"):void this._startAutoScrollChildrenWithDestination(n.p(0,this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToTopRight:function(t,e){if(this.direction!==r.ScrollView.Dir.BOTH)return void n.log("Scroll direction is not both!");var i=this._innerContainer.getContentSize();this._startAutoScrollChildrenWithDestination(n.p(this._contentSize.width-i.width,this._contentSize.height-i.height),t,e)},scrollToBottomLeft:function(t,e){return this.direction!==r.ScrollView.Dir.BOTH?void n.log("Scroll direction is not both!"):void this._startAutoScrollChildrenWithDestination(n.p(0,0),t,e)},scrollToBottomRight:function(t,e){return this.direction!==r.ScrollView.Dir.BOTH?void n.log("Scroll direction is not both!"):void this._startAutoScrollChildrenWithDestination(n.p(this._contentSize.width-this._innerContainer.getContentSize().width,0),t,e)},scrollToPercentVertical:function(t,e,i){var r=this._contentSize.height-this._innerContainer.getContentSize().height,s=-r;this._startAutoScrollChildrenWithDestination(n.p(this._innerContainer.getPositionX(),r+t*s/100),e,i)},scrollToPercentHorizontal:function(t,e,i){var r=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollChildrenWithDestination(n.p(-(t*r/100),this._innerContainer.getPositionY()),e,i)},scrollToPercentBothDirection:function(t,e,i){if(this.direction===r.ScrollView.Dir.BOTH){var s=this._contentSize.height-this._innerContainer.getContentSize().height,o=-s,a=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollChildrenWithDestination(n.p(-(t.x*a/100),s+t.y*o/100),e,i)}},jumpToBottom:function(){this._jumpToDestination(this._innerContainer.getPositionX(),0)},jumpToTop:function(){this._jumpToDestination(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToLeft:function(){this._jumpToDestination(0,this._innerContainer.getPositionY())},jumpToRight:function(){this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY())},jumpToTopLeft:function(){return this.direction!==r.ScrollView.Dir.BOTH?void n.log("Scroll direction is not both!"):void this._jumpToDestination(0,this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToTopRight:function(){if(this.direction!==r.ScrollView.Dir.BOTH)return void n.log("Scroll direction is not both!");var t=this._innerContainer.getContentSize();this._jumpToDestination(this._contentSize.width-t.width,this._contentSize.height-t.height)},jumpToBottomLeft:function(){return this.direction!==r.ScrollView.Dir.BOTH?void n.log("Scroll direction is not both!"):void this._jumpToDestination(0,0)},jumpToBottomRight:function(){return this.direction!==r.ScrollView.Dir.BOTH?void n.log("Scroll direction is not both!"):void this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,0)},jumpToPercentVertical:function(t){var e=this._contentSize.height-this._innerContainer.getContentSize().height,i=-e;this._jumpToDestination(this._innerContainer.getPositionX(),e+t*i/100)},jumpToPercentHorizontal:function(t){var e=this._innerContainer.getContentSize().width-this._contentSize.width;this._jumpToDestination(-(t*e/100),this._innerContainer.getPositionY())},jumpToPercentBothDirection:function(t){if(this.direction===r.ScrollView.Dir.BOTH){var e=this._innerContainer.getContentSize(),i=this._contentSize.height-e.height,n=-i,s=e.width-this._contentSize.width;this._jumpToDestination(-(t.x*s/100),i+t.y*n/100)}},_startRecordSlidAction:function(){this._autoScroll&&this._stopAutoScrollChildren(),this._bouncing&&this._stopBounceChildren(),this._slidTime=0},_endRecordSlidAction:function(){if(!this._checkNeedBounce()&&this.inertiaScrollEnabled){if(this._slidTime<=.016)return;var t,e=0,i=this.convertToNodeSpace(this._touchEndPosition),s=this.convertToNodeSpace(this._touchBeganPosition);switch(this.direction){case r.ScrollView.Dir.VERTICAL:e=i.y-s.y,t=0>e?r.ScrollView.SCROLLDIR_DOWN:r.ScrollView.SCROLLDIR_UP;break;case r.ScrollView.Dir.HORIZONTAL:e=i.x-s.x,t=0>e?r.ScrollView.SCROLLDIR_LEFT:r.ScrollView.SCROLLDIR_RIGHT;break;case r.ScrollView.Dir.BOTH:var o=n.pSub(i,s);e=n.pLength(o),t=n.pNormalize(o);break;default:t=n.p(0,0)}var a=Math.min(Math.abs(e)/this._slidTime,r.ScrollView.AUTO_SCROLL_MAX_SPEED);this._startAutoScrollChildrenWithOriginalSpeed(t,a,!0,-1e3),this._slidTime=0}},_handlePressLogic:function(t){this._startRecordSlidAction(),this._bePressed=!0},_handleMoveLogic:function(t){var e=this.convertToNodeSpace(t.getLocation()),i=this.convertToNodeSpace(t.getPreviousLocation()),s=n.pSub(e,i);switch(this.direction){case r.ScrollView.Dir.VERTICAL:this._scrollChildren(0,s.y);break;case r.ScrollView.Dir.HORIZONTAL:this._scrollChildren(s.x,0);break;case r.ScrollView.Dir.BOTH:this._scrollChildren(s.x,s.y)}},_handleReleaseLogic:function(t){this._endRecordSlidAction(),this._bePressed=!1},onTouchBegan:function(t,e){var i=r.Layout.prototype.onTouchBegan.call(this,t,e);return this._isInterceptTouch||this._hit&&this._handlePressLogic(t),i},onTouchMoved:function(t,e){r.Layout.prototype.onTouchMoved.call(this,t,e),this._isInterceptTouch||this._handleMoveLogic(t)},onTouchEnded:function(t,e){r.Layout.prototype.onTouchEnded.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},onTouchCancelled:function(t,e){r.Layout.prototype.onTouchCancelled.call(this,t,e),this._isInterceptTouch||this.handleReleaseLogic(t),this._isInterceptTouch=!1},update:function(t){this._autoScroll&&this._autoScrollChildren(t),this._bouncing&&this._bounceChildren(t),this._recordSlidTime(t)},_recordSlidTime:function(t){this._bePressed&&(this._slidTime+=t)},interceptTouchEvent:function(t){var e,i,s=t._widgetEventType,o=t.currentTouch;if(this._touchEnabled)switch(e=o.getLocation(),s){case r.Widget.TOUCH_BEGAN:this._isInterceptTouch=!0,this._touchBeganPosition.x=e.x,this._touchBeganPosition.y=e.y,this._handlePressLogic(o);break;case r.Widget.TOUCH_MOVED:i=n.pLength(n.pSub(t.target.getTouchBeganPosition(),e)),this._touchMovePosition.x=e.x,this._touchMovePosition.y=e.y,i>this._childFocusCancelOffset&&(t.target.setHighlighted(!1),this._handleMoveLogic(o));break;case r.Widget.TOUCH_CANCELED:case r.Widget.TOUCH_ENDED:this._touchEndPosition.x=e.x,this._touchEndPosition.y=e.y,this._handleReleaseLogic(o),t.target.isSwallowTouches()&&(this._isInterceptTouch=!1)}},_scrollToTopEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,r.ScrollView.Event.SCROLL_TO_TOP):this._scrollViewEventSelector(this,r.ScrollView.Event.SCROLL_TO_TOP)),this._ccEventCallback&&this._ccEventCallback(this,r.ScrollView.Event.SCROLL_TO_TOP)},_scrollToBottomEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,r.ScrollView.Event.SCROLL_TO_BOTTOM):this._scrollViewEventSelector(this,r.ScrollView.Event.SCROLL_TO_BOTTOM)),this._ccEventCallback&&this._ccEventCallback(this,r.ScrollView.Event.SCROLL_TO_BOTTOM)},_scrollToLeftEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,r.ScrollView.Event.SCROLL_TO_LEFT):this._scrollViewEventSelector(this,r.ScrollView.Event.SCROLL_TO_LEFT)),this._ccEventCallback&&this._ccEventCallback(this,r.ScrollView.Event.SCROLL_TO_LEFT)},_scrollToRightEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,r.ScrollView.Event.SCROLL_TO_RIGHT):this._scrollViewEventSelector(this,r.ScrollView.Event.SCROLL_TO_RIGHT)),this._ccEventCallback&&this._ccEventCallback(this,r.ScrollView.Event.SCROLL_TO_RIGHT)},_scrollingEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,r.ScrollView.Event.SCROLLING):this._scrollViewEventSelector(this,r.ScrollView.Event.SCROLLING)),this._ccEventCallback&&this._ccEventCallback(this,r.ScrollView.Event.SCROLLING)},_bounceTopEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,r.ScrollView.Event.BOUNCE_TOP):this._scrollViewEventSelector(this,r.ScrollView.Event.BOUNCE_TOP)),this._ccEventCallback&&this._ccEventCallback(this,r.ScrollView.Event.BOUNCE_TOP)},_bounceBottomEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,r.ScrollView.Event.BOUNCE_BOTTOM):this._scrollViewEventSelector(this,r.ScrollView.Event.BOUNCE_BOTTOM)),this._ccEventCallback&&this._ccEventCallback(this,r.ScrollView.Event.BOUNCE_BOTTOM)},_bounceLeftEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,r.ScrollView.Event.BOUNCE_LEFT):this._scrollViewEventSelector(this,r.ScrollView.Event.BOUNCE_LEFT)),this._ccEventCallback&&this._ccEventCallback(this,r.ScrollView.Event.BOUNCE_LEFT)},_bounceRightEvent:function(){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,r.ScrollView.Event.BOUNCE_RIGHT):this._scrollViewEventSelector(this,r.ScrollView.Event.BOUNCE_RIGHT)),this._ccEventCallback&&this._ccEventCallback(this,r.ScrollView.Event.BOUNCE_RIGHT)},addEventListenerScrollView:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._scrollViewEventSelector=t,this._scrollViewEventListener=e},setDirection:function(t){this.direction=t},getDirection:function(){return this.direction},setBounceEnabled:function(t){this.bounceEnabled=t},isBounceEnabled:function(){return this.bounceEnabled},setInertiaScrollEnabled:function(t){this.inertiaScrollEnabled=t},isInertiaScrollEnabled:function(){return this.inertiaScrollEnabled},getInnerContainer:function(){return this._innerContainer},setLayoutType:function(t){this._innerContainer.setLayoutType(t)},getLayoutType:function(){return this._innerContainer.getLayoutType()},_doLayout:function(){this._doLayoutDirty&&(this._doLayoutDirty=!1)},getDescription:function(){return"ScrollView"},_createCloneInstance:function(){return new r.ScrollView},_copyClonedWidgetChildren:function(t){r.Layout.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){t instanceof r.ScrollView&&(r.Layout.prototype._copySpecialProperties.call(this,t),this.setInnerContainerSize(t.getInnerContainerSize()),this.setDirection(t.direction),this.setBounceEnabled(t.bounceEnabled),this.setInertiaScrollEnabled(t.inertiaScrollEnabled),this._scrollViewEventListener=t._scrollViewEventListener,this._scrollViewEventSelector=t._scrollViewEventSelector,this._ccEventCallback=t._ccEventCallback)},getNodeByTag:function(t){return this._innerContainer.getNodeByTag(t)},getNodes:function(){return this._innerContainer.getNodes()},removeNode:function(t){this._innerContainer.removeNode(t)},removeNodeByTag:function(t){this._innerContainer.removeNodeByTag(t)},removeAllNodes:function(){this._innerContainer.removeAllNodes()},addNode:function(t,e,i){this._innerContainer.addNode(t,e,i)}});var c=r.ScrollView.prototype;c.innerWidth,n.defineGetterSetter(c,"innerWidth",c._getInnerWidth,c._setInnerWidth),c.innerHeight,n.defineGetterSetter(c,"innerHeight",c._getInnerHeight,c._setInnerHeight),c=null,r.ScrollView.create=function(){return new r.ScrollView},r.ScrollView.Dir=n.Enum({NONE:0,VERTICAL:1,HORIZONTAL:2,BOTH:3}),r.ScrollView.Event=n.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8}),r.ScrollView.AUTO_SCROLL_MAX_SPEED=1e3,r.ScrollView.SCROLLDIR_UP=n.p(0,1),r.ScrollView.SCROLLDIR_DOWN=n.p(0,-1),r.ScrollView.SCROLLDIR_LEFT=n.p(-1,0),r.ScrollView.SCROLLDIR_RIGHT=n.p(1,0),r.ListView=r.ScrollView.extend({_model:null,_items:null,_gravity:null,
_itemsMargin:0,_curSelectedIndex:0,_refreshViewDirty:!0,_listViewEventListener:null,_listViewEventSelector:null,ctor:function(){r.ScrollView.prototype.ctor.call(this),this._items=[],this._gravity=r.ListView.GRAVITY_CENTER_VERTICAL,this.setTouchEnabled(!0),this.init()},init:function(){return r.ScrollView.prototype.init.call(this)?(this.setLayoutType(r.Layout.Type.LINEAR_VERTICAL),!0):!1},setItemModel:function(t){return t?void(this._model=t):void n.log("Can't set a null to item model!")},_updateInnerContainerSize:function(){var t,e,i=this._items;switch(this.direction){case r.ScrollView.Dir.VERTICAL:t=i.length;var s=(t-1)*this._itemsMargin;for(e=0;t>e;e++)s+=i[e].getContentSize().height;this.setInnerContainerSize(n.size(this._contentSize.width,s));break;case r.ScrollView.Dir.HORIZONTAL:t=i.length;var o=(t-1)*this._itemsMargin;for(e=0;t>e;e++)o+=i[e].getContentSize().width;this.setInnerContainerSize(n.size(o,this._contentSize.height))}},_remedyLayoutParameter:function(t){n.assert(null!=t,"ListView Item can't be nil!");var e=t.getLayoutParameter(),i=!0;e||(e=new r.LinearLayoutParameter,i=!1);var s=this.getIndex(t);switch(this.direction){case r.ScrollView.Dir.VERTICAL:this._remedyVerticalLayoutParameter(e,s);break;case r.ScrollView.Dir.HORIZONTAL:this._remedyHorizontalLayoutParameter(e,s)}i||t.setLayoutParameter(e)},_remedyVerticalLayoutParameter:function(t,e){switch(n.assert(null!=t,"Layout parameter can't be nil!"),this._gravity){case r.ListView.GRAVITY_LEFT:t.setGravity(r.LinearLayoutParameter.LEFT);break;case r.ListView.GRAVITY_RIGHT:t.setGravity(r.LinearLayoutParameter.RIGHT);break;case r.ListView.GRAVITY_CENTER_HORIZONTAL:t.setGravity(r.LinearLayoutParameter.CENTER_HORIZONTAL)}t.setMargin(0===e?r.MarginZero():new r.Margin(0,this._itemsMargin,0,0))},_remedyHorizontalLayoutParameter:function(t,e){switch(n.assert(null!=t,"Layout parameter can't be nil!"),this._gravity){case r.ListView.GRAVITY_TOP:t.setGravity(r.LinearLayoutParameter.TOP);break;case r.ListView.GRAVITY_BOTTOM:t.setGravity(r.LinearLayoutParameter.BOTTOM);break;case r.ListView.GRAVITY_CENTER_VERTICAL:t.setGravity(r.LinearLayoutParameter.CENTER_VERTICAL)}t.setMargin(0===e?r.MarginZero():new r.Margin(this._itemsMargin,0,0,0))},pushBackDefaultItem:function(){if(null!=this._model){var t=this._model.clone();this._remedyLayoutParameter(t),this.addChild(t),this._refreshViewDirty=!0}},insertDefaultItem:function(t){if(null!=this._model){var e=this._model.clone();this._items.splice(t,0,e),r.ScrollView.prototype.addChild.call(this,e),this._remedyLayoutParameter(e),this._refreshViewDirty=!0}},pushBackCustomItem:function(t){this._remedyLayoutParameter(t),this.addChild(t),this._refreshViewDirty=!0},addChild:function(t,e,i){t&&(e=e||t.getLocalZOrder(),i=i||t.getName(),r.ScrollView.prototype.addChild.call(this,t,e,i),t instanceof r.Widget&&this._items.push(t))},removeChild:function(t,e){if(t){var i=this._items.indexOf(t);i>-1&&this._items.splice(i,1),r.ScrollView.prototype.removeChild.call(this,t,e)}},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(t){r.ScrollView.prototype.removeAllChildrenWithCleanup.call(this,t),this._items=[]},insertCustomItem:function(t,e){this._items.splice(e,0,t),r.ScrollView.prototype.addChild.call(this,t),this._remedyLayoutParameter(t),this._refreshViewDirty=!0},removeItem:function(t){var e=this.getItem(t);null!=e&&(this.removeChild(e,!0),this._refreshViewDirty=!0)},removeLastItem:function(){this.removeItem(this._items.length-1)},removeAllItems:function(){this.removeAllChildren()},getItem:function(t){return 0>t||t>=this._items.length?null:this._items[t]},getItems:function(){return this._items},getIndex:function(t){return null==t?-1:this._items.indexOf(t)},setGravity:function(t){this._gravity!==t&&(this._gravity=t,this._refreshViewDirty=!0)},setItemsMargin:function(t){this._itemsMargin!==t&&(this._itemsMargin=t,this._refreshViewDirty=!0)},getItemsMargin:function(){return this._itemsMargin},setDirection:function(t){switch(t){case r.ScrollView.Dir.VERTICAL:this.setLayoutType(r.Layout.Type.LINEAR_VERTICAL);break;case r.ScrollView.Dir.HORIZONTAL:this.setLayoutType(r.Layout.Type.LINEAR_HORIZONTAL);break;case r.ScrollView.Dir.BOTH:return;default:return}r.ScrollView.prototype.setDirection.call(this,t)},requestRefreshView:function(){this._refreshViewDirty=!0},refreshView:function(){for(var t=this._items,e=0;e<t.length;e++){var i=t[e];i.setLocalZOrder(e),this._remedyLayoutParameter(i)}this._updateInnerContainerSize()},doLayout:function(){this._doLayout()},_doLayout:function(){r.Layout.prototype._doLayout.call(this),this._refreshViewDirty&&(this.refreshView(),this._refreshViewDirty=!1)},addEventListenerListView:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._listViewEventListener=e,this._listViewEventSelector=t},_selectedItemEvent:function(t){var e=t===r.Widget.TOUCH_BEGAN?r.ListView.ON_SELECTED_ITEM_START:r.ListView.ON_SELECTED_ITEM_END;this._listViewEventSelector&&(this._listViewEventListener?this._listViewEventSelector.call(this._listViewEventListener,this,e):this._listViewEventSelector(this,e)),this._ccEventCallback&&this._ccEventCallback(this,e)},interceptTouchEvent:function(t){{var e,i=t._widgetEventType;t.currentTouch}if(r.ScrollView.prototype.interceptTouchEvent.call(this,t),this._touchEnabled&&i!==r.Widget.TOUCH_MOVED){for(e=t.target;e;){if(e&&e.getParent()===this._innerContainer){this._curSelectedIndex=this.getIndex(e);break}e=e.getParent()}t.target.isHighlighted()&&this._selectedItemEvent(i)}},getCurSelectedIndex:function(){return this._curSelectedIndex},_onSizeChanged:function(){r.ScrollView.prototype._onSizeChanged.call(this),this._refreshViewDirty=!0},getDescription:function(){return"ListView"},_createCloneInstance:function(){return new r.ListView},_copyClonedWidgetChildren:function(t){for(var e=t.getItems(),i=0;i<e.length;i++){var n=e[i];this.pushBackCustomItem(n.clone())}},_copySpecialProperties:function(t){t instanceof r.ListView&&(r.ScrollView.prototype._copySpecialProperties.call(this,t),this.setItemModel(t._model),this.setItemsMargin(t._itemsMargin),this.setGravity(t._gravity),this._listViewEventListener=t._listViewEventListener,this._listViewEventSelector=t._listViewEventSelector)},forceDoLayout:function(){this._refreshViewDirty&&(this.refreshView(),this._refreshViewDirty=!1),this._innerContainer.forceDoLayout()}}),r.ListView.create=function(){return new r.ListView},r.ListView.EVENT_SELECTED_ITEM=0,r.ListView.ON_SELECTED_ITEM_START=0,r.ListView.ON_SELECTED_ITEM_END=1,r.ListView.GRAVITY_LEFT=0,r.ListView.GRAVITY_RIGHT=1,r.ListView.GRAVITY_CENTER_HORIZONTAL=2,r.ListView.GRAVITY_TOP=3,r.ListView.GRAVITY_BOTTOM=4,r.ListView.GRAVITY_CENTER_VERTICAL=5,r.PageView=r.Layout.extend({_curPageIdx:0,_pages:null,_touchMoveDirection:null,_touchStartLocation:0,_touchMoveStartLocation:0,_movePagePoint:null,_leftBoundaryChild:null,_rightBoundaryChild:null,_leftBoundary:0,_rightBoundary:0,_isAutoScrolling:!1,_autoScrollDistance:0,_autoScrollSpeed:0,_autoScrollDirection:0,_childFocusCancelOffset:0,_pageViewEventListener:null,_pageViewEventSelector:null,_className:"PageView",_customScrollThreshold:0,_usingCustomScrollThreshold:!1,ctor:function(){r.Layout.prototype.ctor.call(this),this._pages=[],this._touchMoveDirection=r.PageView.TOUCH_DIR_LEFT,this._movePagePoint=null,this._leftBoundaryChild=null,this._rightBoundaryChild=null,this._childFocusCancelOffset=5,this._pageViewEventListener=null,this._pageViewEventSelector=null,this.setTouchEnabled(!0),this.on(n.Event.TOUCH,this.interceptTouchEvent)},init:function(){return r.Layout.prototype.init.call(this)?(this.setClippingEnabled(!0),!0):!1},onEnter:function(){r.Layout.prototype.onEnter.call(this),this.scheduleUpdate(!0)},addWidgetToPage:function(t,e,i){if(t&&!(0>e)){var r=this._getPageCount();if(0>e||e>=r){if(i){e>r&&n.log("pageIdx is %d, it will be added as page id [%d]",e,r);var s=this._createPage();s.addChild(t),this.addPage(s)}}else{var o=this._pages[e];o&&o.addChild(t)}}},_createPage:function(){var t=new r.Layout;return t.setContentSize(this.getContentSize()),t},addPage:function(t){t&&-1===this._pages.indexOf(t)&&(this.addChild(t),this._pages.push(t),this._doLayoutDirty=!0)},insertPage:function(t,e){if(!(0>e)&&t&&-1===this._pages.indexOf(t)){var i=this._getPageCount();e>=i?this.addPage(t):(this._pages[e]=t,this.addChild(t)),this._doLayoutDirty=!0}},removePage:function(t){if(t){this.removeChild(t);var e=this._pages.indexOf(t);e>-1&&this._pages.splice(e,1),this._doLayoutDirty=!0}},removePageAtIndex:function(t){if(!(0>t||t>=this._pages.length)){var e=this._pages[t];e&&this.removePage(e)}},removeAllPages:function(){for(var t=this._pages,e=0,i=t.length;i>e;e++)this.removeChild(t[e]);this._pages.length=0},_updateBoundaryPages:function(){var t=this._pages;return t.length<=0?(this._leftBoundaryChild=null,void(this._rightBoundaryChild=null)):(this._leftBoundaryChild=t[0],void(this._rightBoundaryChild=t[t.length-1]))},_getPageCount:function(){return this._pages.length},_getPositionXByIndex:function(t){return this.getContentSize().width*(t-this._curPageIdx)},_onSizeChanged:function(){r.Layout.prototype._onSizeChanged.call(this),this._rightBoundary=this.getContentSize().width,this._doLayoutDirty=!0},_updateAllPagesSize:function(){for(var t=this.getContentSize(),e=this._pages,i=0,n=e.length;n>i;i++)e[i].setContentSize(t)},_updateAllPagesPosition:function(){var t=this._getPageCount();if(0>=t)return void(this._curPageIdx=0);this._curPageIdx>=t&&(this._curPageIdx=t-1);for(var e=this.getContentSize().width,i=this._pages,r=0;t>r;r++)i[r].setPosition(n.p((r-this._curPageIdx)*e,0))},scrollToPage:function(t){if(!(0>t||t>=this._pages.length)){this._curPageIdx=t;var e=this._pages[t];this._autoScrollDistance=-e.getPosition().x,this._autoScrollSpeed=Math.abs(this._autoScrollDistance)/.2,this._autoScrollDirection=this._autoScrollDistance>0?r.PageView.DIRECTION_RIGHT:r.PageView.DIRECTION_LEFT,this._isAutoScrolling=!0}},update:function(t){this._isAutoScrolling&&this._autoScroll(t)},setLayoutType:function(t){},getLayoutType:function(){return r.Layout.Type.ABSOLUTE},_autoScroll:function(t){var e;switch(this._autoScrollDirection){case r.PageView.DIRECTION_LEFT:e=this._autoScrollSpeed*t,this._autoScrollDistance+e>=0?(e=-this._autoScrollDistance,this._autoScrollDistance=0,this._isAutoScrolling=!1):this._autoScrollDistance+=e,this._scrollPages(-e),this._isAutoScrolling||this._pageTurningEvent();break;case r.PageView.DIRECTION_RIGHT:e=this._autoScrollSpeed*t,this._autoScrollDistance-e<=0?(e=this._autoScrollDistance,this._autoScrollDistance=0,this._isAutoScrolling=!1):this._autoScrollDistance-=e,this._scrollPages(e),this._isAutoScrolling||this._pageTurningEvent()}},onTouchMoved:function(t,e){r.Layout.prototype.onTouchMoved.call(this,t,e),this._isInterceptTouch||this._handleMoveLogic(t)},onTouchEnded:function(t,e){r.Layout.prototype.onTouchEnded.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},onTouchCancelled:function(t,e){r.Layout.prototype.onTouchCancelled.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},_doLayout:function(){this._doLayoutDirty&&(this._updateAllPagesPosition(),this._updateAllPagesSize(),this._updateBoundaryPages(),this._doLayoutDirty=!1)},_movePages:function(t){for(var e=this._pages,i=e.length,n=0;i>n;n++){var r=e[n];r.setPositionX(r.getPositionX()+t)}},_scrollPages:function(t){if(this._pages.length<=0)return!1;if(!this._leftBoundaryChild||!this._rightBoundaryChild)return!1;var e=t;switch(this._touchMoveDirection){case r.PageView.TOUCH_DIR_LEFT:var i=this._rightBoundaryChild.getRightBoundary();if(i+t<=this._rightBoundary)return e=this._rightBoundary-i,this._movePages(e),!1;break;case r.PageView.TOUCH_DIR_RIGHT:var n=this._leftBoundaryChild.getLeftBoundary();if(n+t>=this._leftBoundary)return e=this._leftBoundary-n,this._movePages(e),!1}return this._movePages(e),!0},_handleMoveLogic:function(t){var e=t.getLocation().x-t.getPreviousLocation().x;0>e?this._touchMoveDirection=r.PageView.TOUCH_DIR_LEFT:e>0&&(this._touchMoveDirection=r.PageView.TOUCH_DIR_RIGHT),this._scrollPages(e)},setCustomScrollThreshold:function(t){n.assert(t>0,"Invalid threshold!"),this._customScrollThreshold=t,this.setUsingCustomScrollThreshold(!0)},getCustomScrollThreshold:function(){return this._customScrollThreshold},setUsingCustomScrollThreshold:function(t){this._usingCustomScrollThreshold=t},isUsingCustomScrollThreshold:function(){return this._usingCustomScrollThreshold},_handleReleaseLogic:function(t){if(!(this._pages.length<=0)){var e=this._pages[this._curPageIdx];if(e){var i=e.getPosition(),n=this._pages.length,r=i.x,s=this.getSize().width;this._usingCustomScrollThreshold||(this._customScrollThreshold=s/2);var o=this._customScrollThreshold;-o>=r?this._curPageIdx>=n-1?this._scrollPages(-r):this.scrollToPage(this._curPageIdx+1):r>=o?this._curPageIdx<=0?this._scrollPages(-r):this.scrollToPage(this._curPageIdx-1):this.scrollToPage(this._curPageIdx)}}},interceptTouchEvent:function(t){var e,i=t._widgetEventType,n=t.currentTouch,s=0;if(this._touchEnabled)switch(e=n.getLocation(),i){case r.Widget.TOUCH_BEGAN:this._touchBeganPosition.x=e.x,this._touchBeganPosition.y=e.y,this._isInterceptTouch=!0;break;case r.Widget.TOUCH_MOVED:this._touchMovePosition.x=e.x,this._touchMovePosition.y=e.y,s=Math.abs(t.target.getTouchBeganPosition().x-e.x),s>this._childFocusCancelOffset&&(t.target.setHighlighted(!1),this._handleMoveLogic(n));break;case r.Widget.TOUCH_ENDED:case r.Widget.TOUCH_CANCELED:this._touchEndPosition.x=e.x,this._touchEndPosition.y=e.y,this._handleReleaseLogic(n),t.target.isSwallowTouches()&&(this._isInterceptTouch=!1)}},_pageTurningEvent:function(){this._pageViewEventSelector&&(this._pageViewEventListener?this._pageViewEventSelector.call(this._pageViewEventListener,this,r.PageView.EVENT_TURNING):this._pageViewEventSelector(this,r.PageView.EVENT_TURNING)),this._ccEventCallback&&this._ccEventCallback(this,r.PageView.EVENT_TURNING)},addEventListenerPageView:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._pageViewEventSelector=t,this._pageViewEventListener=e},getCurPageIndex:function(){return this._curPageIdx},getPages:function(){return this._pages},getPage:function(t){return 0>t||t>=this._pages.length?null:this._pages[t]},getDescription:function(){return"PageView"},_createCloneInstance:function(){return new r.PageView},_copyClonedWidgetChildren:function(t){for(var e=t.getPages(),i=0;i<e.length;i++){var n=e[i];this.addPage(n.clone())}},_copySpecialProperties:function(t){r.Layout.prototype._copySpecialProperties.call(this,t),this._ccEventCallback=t._ccEventCallback,this._pageViewEventListener=t._pageViewEventListener,this._pageViewEventSelector=t._pageViewEventSelector,this._usingCustomScrollThreshold=t._usingCustomScrollThreshold,this._customScrollThreshold=t._customScrollThreshold}}),r.PageView.create=function(){return new r.PageView},r.PageView.EVENT_TURNING=0,r.PageView.TOUCH_DIR_LEFT=0,r.PageView.TOUCH_DIR_RIGHT=1,r.PageView.DIRECTION_LEFT=0,r.PageView.DIRECTION_RIGHT=1,function(){if(r.ProtectedNode.CanvasRenderCmd){r.ScrollView.CanvasRenderCmd=function(t){r.Layout.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._dirty=!1};var t=r.ScrollView.CanvasRenderCmd.prototype=Object.create(r.Layout.CanvasRenderCmd.prototype);t.constructor=r.ScrollView.CanvasRenderCmd,t.visit=function(t){var e=this._node;if(e._visible){n.renderer.pushRenderCommand(this);var i=e.__instanceId;n.renderer._turnToCacheMode(i),r.Layout.CanvasRenderCmd.prototype.visit.call(this,t),this._dirtyFlag=0,n.renderer._turnToNormalMode()}},t.rendering=function(t){var e,i,s=this._node.__instanceId,o=n.renderer._cacheToCanvasCmds[s],a=n.view.getScaleX(),c=n.view.getScaleY(),h=t||n._renderContext;for(h.computeRealOffsetY(),e=0,i=o.length;i>e;e++){var l=o[e]._node;l instanceof r.ScrollView||l&&l._parent&&l._parent._inViewRect===!1||o[e].rendering(h,a,c)}}}}(),function(){if(r.ProtectedNode.WebGLRenderCmd){r.ScrollView.WebGLRenderCmd=function(t){r.Layout.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._dirty=!1};var t=r.ScrollView.WebGLRenderCmd.prototype=Object.create(r.Layout.WebGLRenderCmd.prototype);t.constructor=r.ScrollView.WebGLRenderCmd,t.visit=function(t){var e=this._node;if(e._visible){var i=this._node.__instanceId;n.renderer.pushRenderCommand(this),n.renderer._turnToCacheMode(i),r.Layout.WebGLRenderCmd.prototype.visit.call(this,t),this._dirtyFlag=0,n.renderer._turnToNormalMode()}},t.rendering=function(t){var e,i,s=this._node.__instanceId,o=n.renderer._cacheToBufferCmds[s],a=t||n._renderContext;for(e=0,i=o.length;i>e;e++){var c=o[e]._node;c instanceof r.ScrollView||c&&c._parent&&c._parent._inViewRect===!1||o[e].rendering(a)}}}}(),n._Component=n._Class.extend({_owner:null,_name:"",_enabled:!0,ctor:function(){this._owner=null,this._name="",this._enabled=!0},init:function(){return!0},onEnter:function(){},onExit:function(){},update:function(t){},serialize:function(t){},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t},getName:function(){return this._name},setName:function(t){this._name=t},setOwner:function(t){this._owner=t},getOwner:function(){return this._owner}}),n._Component.create=function(){return new n._Component},r.LayoutComponent_ReferencePoint={BOTTOM_LEFT:0,TOP_LEFT:1,BOTTOM_RIGHT:2,TOP_RIGHT:3},r.LayoutComponent_PositionType={Position:0,RelativePosition:1,PreRelativePosition:2,PreRelativePositionEnable:3},r.LayoutComponent_SizeType={Size:0,PreSize:1,PreSizeEnable:2},r.LayoutComponent=n._Component.extend({_horizontalEdge:0,_verticalEdge:0,_leftMargin:0,_rightMargin:0,_bottomMargin:0,_topMargin:0,_usingPositionPercentX:!1,_positionPercentX:0,_usingPositionPercentY:!1,_positionPercentY:0,_usingStretchWidth:!1,_usingStretchHeight:!1,_percentWidth:0,_usingPercentWidth:!1,_percentHeight:0,_usingPercentHeight:!1,_actived:!0,_isPercentOnly:!1,ctor:function(){this._name=r.LayoutComponent.NAME},init:function(){var t=!0;return n._Component.prototype.init.call(this)?t:!1},getPercentContentSize:function(){return n.p(this._percentWidth,this._percentHeight)},setPercentContentSize:function(t){this.setPercentWidth(t.x),this.setPercentHeight(t.y)},setUsingPercentContentSize:function(t){this._usingPercentWidth=this._usingPercentHeight=t},SetActiveEnable:function(t){this._actived=t},getUsingPercentContentSize:function(){return this._usingPercentWidth&&this._usingPercentHeight},getAnchorPosition:function(){return this._owner.getAnchorPoint()},setAnchorPosition:function(t,e){var i=this._owner.getBoundingBox();this._owner.setAnchorPoint(t,e);var n=this._owner.getBoundingBox(),r=i.x-n.x,s=i.y-n.y,o=this._owner.getPosition();o.x+=r,o.y+=s,this.setPosition(o)},getPosition:function(){return this._owner.getPosition()},setPosition:function(t,e){var i,n=this._getOwnerParent();if(null!=n){void 0===e?(i=t.x,e=t.y):i=t;var r=n.getContentSize();0!==r.width?this._positionPercentX=i/r.width:(this._positionPercentX=0,this._usingPositionPercentX&&(i=0)),0!==r.height?this._positionPercentY=e/r.height:(this._positionPercentY=0,this._usingPositionPercentY&&(e=0)),this._owner.setPosition(i,e),this._refreshHorizontalMargin(),this._refreshVerticalMargin()}else this._owner.setPosition(t,e)},isPositionPercentXEnabled:function(){return this._usingPositionPercentX},setPositionPercentXEnabled:function(t){this._usingPositionPercentX=t,this._usingPositionPercentX&&(this._horizontalEdge=r.LayoutComponent.horizontalEdge.NONE)},getPositionPercentX:function(){return this._positionPercentX},setPositionPercentX:function(t){this._positionPercentX=t;var e=this._getOwnerParent();null!==e&&(this._owner.setPositionX(e.width*this._positionPercentX),this._refreshHorizontalMargin())},isPositionPercentYEnabled:function(){return this._usingPositionPercentY},setPositionPercentYEnabled:function(t){this._usingPositionPercentY=t,this._usingPositionPercentY&&(this._verticalEdge=r.LayoutComponent.verticalEdge.NONE)},getPositionPercentY:function(){return this._positionPercentY},setPositionPercentY:function(t){this._positionPercentY=t;var e=this._getOwnerParent();null!==e&&(this._owner.setPositionY(e.height*this._positionPercentY),this._refreshVerticalMargin())},getHorizontalEdge:function(){return this._horizontalEdge},setHorizontalEdge:function(t){this._horizontalEdge=t,this._horizontalEdge!==r.LayoutComponent.horizontalEdge.NONE&&(this._usingPositionPercentX=!1);var e=this._getOwnerParent();if(null!==e){var i=this._owner.getPosition(),n=e.getContentSize();0!==n.width?this._positionPercentX=i.x/n.width:(this._positionPercentX=0,i.x=0,this._usingPositionPercentX&&this._owner.setPosition(i)),this._refreshHorizontalMargin()}},getVerticalEdge:function(){return this._verticalEdge},setVerticalEdge:function(t){this._verticalEdge=t,this._verticalEdge!==r.LayoutComponent.verticalEdge.NONE&&(this._usingPositionPercentY=!1);var e=this._getOwnerParent();if(null!==e){var i=this._owner.getPosition(),n=e.getContentSize();0!==n.height?this._positionPercentY=i.y/n.height:(this._positionPercentY=0,i.y=0,this._usingPositionPercentY&&this._owner.setPosition(i)),this._refreshVerticalMargin()}},getLeftMargin:function(){return this._leftMargin},setLeftMargin:function(t){this._leftMargin=t},getRightMargin:function(){return this._rightMargin},setRightMargin:function(t){this._rightMargin=t},getTopMargin:function(){return this._topMargin},setTopMargin:function(t){this._topMargin=t},getBottomMargin:function(){return this._bottomMargin},setBottomMargin:function(t){this._bottomMargin=t},getSize:function(){return this.getOwner().getContentSize()},setSize:function(t){var e=this._getOwnerParent();if(null!==e){var i=t,n=e.getContentSize();0!==n.width?this._percentWidth=i.width/n.width:(this._percentWidth=0,this._usingPercentWidth&&(i.width=0)),0!==n.height?this._percentHeight=i.height/n.height:(this._percentHeight=0,this._usingPercentHeight&&(i.height=0)),this._owner.setContentSize(i),this._refreshHorizontalMargin(),this._refreshVerticalMargin()}else this._owner.setContentSize(t)},isPercentWidthEnabled:function(){return this._usingPercentWidth},setPercentWidthEnabled:function(t){this._usingPercentWidth=t,this._usingPercentWidth&&(this._usingStretchWidth=!1)},getSizeWidth:function(){return this._owner.width},setSizeWidth:function(t){var e=this._owner.getContentSize();e.width=t;var i=this._getOwnerParent();if(null!==i){var n=i.getContentSize();0!==n.width?this._percentWidth=e.width/n.width:(this._percentWidth=0,this._usingPercentWidth&&(e.width=0)),this._owner.setContentSize(e),this._refreshHorizontalMargin()}else this._owner.setContentSize(e)},getPercentWidth:function(){return this._percentWidth},setPercentWidth:function(t){this._percentWidth=t;var e=this._getOwnerParent();if(null!==e){var i=this._owner.getContentSize();i.width=e.width*this._percentWidth,this._owner.setContentSize(i),this._refreshHorizontalMargin()}},isPercentHeightEnabled:function(){return this._usingPercentHeight},setPercentHeightEnabled:function(t){this._usingPercentHeight=t,this._usingPercentHeight&&(this._usingStretchHeight=!1)},getSizeHeight:function(){return this._owner.height},setSizeHeight:function(t){var e=this._owner.getContentSize();e.height=t;var i=this._getOwnerParent();if(null!==i){var n=i.getContentSize();0!==n.height?this._percentHeight=e.height/n.height:(this._percentHeight=0,this._usingPercentHeight&&(e.height=0)),this._owner.setContentSize(e),this._refreshVerticalMargin()}else this._owner.setContentSize(e)},getPercentHeight:function(){return this._percentHeight},setPercentHeight:function(t){this._percentHeight=t;var e=this._getOwnerParent();if(null!==e){var i=this._owner.getContentSize();i.height=e.height*this._percentHeight,this._owner.setContentSize(i),this._refreshVerticalMargin()}},isStretchWidthEnabled:function(){return this._usingStretchWidth},setStretchWidthEnabled:function(t){this._usingStretchWidth=t,this._usingStretchWidth&&(this._usingPercentWidth=!1)},isStretchHeightEnabled:function(){return this._usingStretchHeight},setStretchHeightEnabled:function(t){this._usingStretchHeight=t,this._usingStretchHeight&&(this._usingPercentHeight=!1)},setPercentOnlyEnabled:function(t){this._isPercentOnly=t},setActiveEnabled:function(t){this._actived=t},refreshLayout:function(){if(this._actived){var t=this._getOwnerParent();if(null!==t){var e=t.getContentSize(),i=this._owner,n=i.getAnchorPoint(),s=i.getContentSize(),o=i.getPosition();switch(this._horizontalEdge){case r.LayoutComponent.horizontalEdge.NONE:this._usingStretchWidth&&!this._isPercentOnly?(s.width=e.width*this._percentWidth,o.x=this._leftMargin+n.x*s.width):(this._usingPositionPercentX&&(o.x=e.width*this._positionPercentX),this._usingPercentWidth&&(s.width=e.width*this._percentWidth));break;case r.LayoutComponent.horizontalEdge.LEFT:if(this._isPercentOnly)break;(this._usingPercentWidth||this._usingStretchWidth)&&(s.width=e.width*this._percentWidth),o.x=this._leftMargin+n.x*s.width;break;case r.LayoutComponent.horizontalEdge.RIGHT:if(this._isPercentOnly)break;(this._usingPercentWidth||this._usingStretchWidth)&&(s.width=e.width*this._percentWidth),o.x=e.width-(this._rightMargin+(1-n.x)*s.width);break;case r.LayoutComponent.horizontalEdge.CENTER:if(this._isPercentOnly)break;this._usingStretchWidth?(s.width=e.width-this._leftMargin-this._rightMargin,s.width<0&&(s.width=0),o.x=this._leftMargin+n.x*s.width):(this._usingPercentWidth&&(s.width=e.width*this._percentWidth),o.x=e.width*this._positionPercentX)}switch(this._verticalEdge){case r.LayoutComponent.verticalEdge.NONE:this._usingStretchHeight&&!this._isPercentOnly?(s.height=e.height*this._percentHeight,o.y=this._bottomMargin+n.y*s.height):(this._usingPositionPercentY&&(o.y=e.height*this._positionPercentY),this._usingPercentHeight&&(s.height=e.height*this._percentHeight));break;case r.LayoutComponent.verticalEdge.BOTTOM:if(this._isPercentOnly)break;(this._usingPercentHeight||this._usingStretchHeight)&&(s.height=e.height*this._percentHeight),o.y=this._bottomMargin+n.y*s.height;break;case r.LayoutComponent.verticalEdge.TOP:if(this._isPercentOnly)break;(this._usingPercentHeight||this._usingStretchHeight)&&(s.height=e.height*this._percentHeight),o.y=e.height-(this._topMargin+(1-n.y)*s.height);break;case r.LayoutComponent.verticalEdge.CENTER:if(this._isPercentOnly)break;this._usingStretchHeight?(s.height=e.height-this._topMargin-this._bottomMargin,s.height<0&&(s.height=0),o.y=this._bottomMargin+n.y*s.height):(this._usingPercentHeight&&(s.height=e.height*this._percentHeight),o.y=e.height*this._positionPercentY)}if(i.setPosition(o),i.setContentSize(s),i instanceof r.PageView){i.forceDoLayout();for(var a=i.getPages(),c=0;c<a.length;c++)r.helper.doLayout(a[c])}else r.helper.doLayout(i)}}},_getOwnerParent:function(){return this._owner?this._owner.getParent():null},_refreshHorizontalMargin:function(){var t=this._getOwnerParent();if(null!==t){var e=this._owner.getPosition(),i=this._owner.getAnchorPoint(),n=this._owner.getContentSize(),r=t.getContentSize();this._leftMargin=e.x-i.x*n.width,this._rightMargin=r.width-(e.x+(1-i.x)*n.width)}},_refreshVerticalMargin:function(){var t=this._getOwnerParent();if(null!==t){var e=this._owner.getPosition(),i=this._owner.getAnchorPoint(),n=this._owner.getContentSize(),r=t.getContentSize();this._bottomMargin=e.y-i.y*n.height,this._topMargin=r.height-(e.y+(1-i.y)*n.height)}}}),r.LayoutComponent.horizontalEdge={NONE:0,LEFT:1,RIGHT:2,CENTER:3},r.LayoutComponent.verticalEdge={NONE:0,BOTTOM:1,TOP:2,CENTER:3},r.LayoutComponent.NAME="__ui_layout",r.LayoutComponent.bindLayoutComponent=function(t){var e=t.getComponent(r.LayoutComponent.NAME);return void 0!==e?e:(e=new r.LayoutComponent,e&&e.init()?(t.addComponent(e),e):null)},n.ComponentContainer=n._Class.extend({_components:null,_owner:null,ctor:function(t){this._components=null,this._owner=t},getComponent:function(t){if(!t)throw new Error("cc.ComponentContainer.getComponent(): name should be non-null");return t=t.trim(),this._components||(this._components={}),this._components[t]},add:function(t){if(!t)throw new Error("cc.ComponentContainer.add(): component should be non-null");if(t.getOwner())return n.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),!1;null==this._components&&(this._components={},this._owner.scheduleUpdate());var e=this._components[t.getName()];return e?(n.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),!1):(t.setOwner(this._owner),this._components[t.getName()]=t,t.onEnter(),!0)},remove:function(t){if(!t)throw new Error("cc.ComponentContainer.remove(): name should be non-null");return this._components?t instanceof n._Component?this._removeByComponent(t):(t=t.trim(),this._removeByComponent(this._components[t])):!1},_removeByComponent:function(t){return t?(t.onExit(),t.setOwner(null),delete this._components[t.getName()],!0):!1},removeAll:function(){if(this._components){var t=this._components;for(var e in t){var i=t[e];i.onExit(),i.setOwner(null),delete t[e]}this._owner.unscheduleUpdate(),this._components=null}},_alloc:function(){this._components={}},visit:function(t){if(this._components){var e=this._components;for(var i in e)e[i].update(t)}},isEmpty:function(){return this._components?0===this._components.length:!0}});var p={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array};p.BoneData=function(t,e){this.name=t,this.parent=e},p.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},p.BlendMode={normal:0,additive:1,multiply:2,screen:3},p.SlotData=function(t,e){this.name=t,this.boneData=e},p.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,blendMode:p.BlendMode.normal},p.IkConstraintData=function(t){this.name=t,this.bones=[]},p.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},p.Bone=function(t,e,i){this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()},p.Bone.yDown=!1,p.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t)this.worldX=this.x*t.m00+this.y*t.m01+t.worldX,this.worldY=this.x*t.m10+this.y*t.m11+t.worldY,this.data.inheritScale?(this.worldScaleX=t.worldScaleX*this.scaleX,this.worldScaleY=t.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=t.worldFlipX!=this.flipX,this.worldFlipY=t.worldFlipY!=this.flipY;else{var e=this.skeleton.flipX,i=this.skeleton.flipY;this.worldX=e?-this.x:this.x,this.worldY=i!=p.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=e!=this.flipX,this.worldFlipY=i!=this.flipY}var n=this.worldRotation*p.degRad,r=Math.cos(n),s=Math.sin(n);this.worldFlipX?(this.m00=-r*this.worldScaleX,this.m01=s*this.worldScaleY):(this.m00=r*this.worldScaleX,this.m01=-s*this.worldScaleY),this.worldFlipY!=p.Bone.yDown?(this.m10=-s*this.worldScaleX,this.m11=-r*this.worldScaleY):(this.m10=s*this.worldScaleX,this.m11=r*this.worldScaleY)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.rotationIK=this.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.flipX=t.flipX,this.flipY=t.flipY},worldToLocal:function(t){var e=t[0]-this.worldX,i=t[1]-this.worldY,n=this.m00,r=this.m10,s=this.m01,o=this.m11;this.worldFlipX!=(this.worldFlipY!=p.Bone.yDown)&&(n=-n,o=-o);var a=1/(n*o-s*r);t[0]=e*n*a-i*s*a,t[1]=i*o*a-e*r*a},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX,t[1]=e*this.m10+i*this.m11+this.worldY}},p.Slot=function(t,e){this.data=t,this.bone=e,this.setToSetupPose();

},p.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.bone.skeleton.data.slots,i=0,n=e.length;n>i;i++)if(e[i]==t){this.setAttachment(t.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName):null);break}}},p.IkConstraint=function(t,e){this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var i=0,n=t.bones.length;n>i;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)},p.IkConstraint.prototype={apply:function(){var t=this.target,e=this.bones;switch(e.length){case 1:p.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:p.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix)}}},p.IkConstraint.apply1=function(t,e,i,n){var r=t.data.inheritRotation&&t.parent?t.parent.worldRotation:0,s=t.rotation,o=Math.atan2(i-t.worldY,e-t.worldX)*p.radDeg;t.worldFlipX!=(t.worldFlipY!=p.Bone.yDown)&&(o=-o),o-=r,t.rotationIK=s+(o-s)*n},p.IkConstraint.apply2=function(t,e,i,n,r,s){var o=e.rotation,a=t.rotation;if(!s)return e.rotationIK=o,void(t.rotationIK=a);var c,h,l=p.temp,d=t.parent;d?(l[0]=i,l[1]=n,d.worldToLocal(l),i=(l[0]-t.x)*d.worldScaleX,n=(l[1]-t.y)*d.worldScaleY):(i-=t.x,n-=t.y),e.parent==t?(c=e.x,h=e.y):(l[0]=e.x,l[1]=e.y,e.parent.localToWorld(l),t.worldToLocal(l),c=l[0],h=l[1]);var u=c*t.worldScaleX,_=h*t.worldScaleY,f=Math.atan2(_,u),g=Math.sqrt(u*u+_*_),m=e.data.length*e.worldScaleX,y=2*g*m;if(1e-4>y)return void(e.rotationIK=o+(Math.atan2(n,i)*p.radDeg-a-o)*s);var v=(i*i+n*n-g*g-m*m)/y;-1>v?v=-1:v>1&&(v=1);var T=Math.acos(v)*r,C=g+m*v,S=m*Math.sin(T),E=Math.atan2(n*C-i*S,i*C+n*S),b=(E-f)*p.radDeg-a;b>180?b-=360:-180>b&&(b+=360),t.rotationIK=a+b*s,b=(T+f)*p.radDeg-o,b>180?b-=360:-180>b&&(b+=360),e.rotationIK=o+(b+t.worldRotation-e.parent.worldRotation)*s},p.Skin=function(t){this.name=t,this.attachments={}},p.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":"),r=parseInt(i.substring(0,n)),s=i.substring(n+1),o=t.slots[r];if(o.attachment&&o.attachment.name==s){var a=this.getAttachment(r,s);a&&o.setAttachment(a)}}}},p.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},p.Animation.prototype={apply:function(t,e,i,n,r){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var s=this.timelines,o=0,a=s.length;a>o;o++)s[o].apply(t,e,i,r,1)},mix:function(t,e,i,n,r,s){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var o=this.timelines,a=0,c=o.length;c>a;a++)o[a].apply(t,e,i,r,s)}},p.Animation.binarySearch=function(t,e,i){var n=0,r=Math.floor(t.length/i)-2;if(!r)return i;for(var s=r>>>1;;){if(t[(s+1)*i]<=e?n=s+1:r=s,n==r)return(n+1)*i;s=n+r>>>1}},p.Animation.binarySearch1=function(t,e){var i=0,n=t.length-2;if(!n)return 1;for(var r=n>>>1;;){if(t[r+1]<=e?i=r+1:n=r,i==n)return i+1;r=i+n>>>1}},p.Animation.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;r>=n;n+=i)if(t[n]>e)return n;return-1},p.Curves=function(t){this.curves=[]},p.Curves.prototype={setLinear:function(t){this.curves[19*t]=0},setStepped:function(t){this.curves[19*t]=1},setCurve:function(t,e,i,n,r){var s=.1,o=s*s,a=o*s,c=3*s,h=3*o,l=6*o,d=6*a,u=2*-e+n,_=2*-i+r,f=3*(e-n)+1,p=3*(i-r)+1,g=e*c+u*h+f*a,m=i*c+_*h+p*a,y=u*l+f*d,v=_*l+p*d,T=f*d,C=p*d,S=19*t,E=this.curves;E[S++]=2;for(var b=g,x=m,A=S+19-1;A>S;S+=2)E[S]=b,E[S+1]=x,g+=y,m+=v,y+=T,v+=C,b+=g,x+=m},getCurvePercent:function(t,e){e=0>e?0:e>1?1:e;var i=this.curves,n=19*t,r=i[n];if(0===r)return e;if(1==r)return 0;n++;for(var s=0,o=n,a=n+19-1;a>n;n+=2)if(s=i[n],s>=e){var c,h;return n==o?(c=0,h=0):(c=i[n-2],h=i[n-1]),h+(i[n+1]-h)*(e-c)/(s-c)}var l=i[n-1];return l+(1-l)*(e-s)/(1-s)}},p.RotateTimeline=function(t){this.curves=new p.Curves(t),this.frames=[],this.frames.length=2*t},p.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,e,i,n,r){var s=this.frames;if(!(i<s[0])){var o=t.bones[this.boneIndex];if(i>=s[s.length-2]){for(var a=o.data.rotation+s[s.length-1]-o.rotation;a>180;)a-=360;for(;-180>a;)a+=360;return void(o.rotation+=a*r)}var c=p.Animation.binarySearch(s,i,2),h=s[c-1],l=s[c],d=1-(i-l)/(s[c-2]-l);d=this.curves.getCurvePercent(c/2-1,d);for(var a=s[c+1]-h;a>180;)a-=360;for(;-180>a;)a+=360;for(a=o.data.rotation+(h+a*d)-o.rotation;a>180;)a-=360;for(;-180>a;)a+=360;o.rotation+=a*r}}},p.TranslateTimeline=function(t){this.curves=new p.Curves(t),this.frames=[],this.frames.length=3*t},p.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,n,r){var s=this.frames;if(!(i<s[0])){var o=t.bones[this.boneIndex];if(i>=s[s.length-3])return o.x+=(o.data.x+s[s.length-2]-o.x)*r,void(o.y+=(o.data.y+s[s.length-1]-o.y)*r);var a=p.Animation.binarySearch(s,i,3),c=s[a-2],h=s[a-1],l=s[a],d=1-(i-l)/(s[a+-3]-l);d=this.curves.getCurvePercent(a/3-1,d),o.x+=(o.data.x+c+(s[a+1]-c)*d-o.x)*r,o.y+=(o.data.y+h+(s[a+2]-h)*d-o.y)*r}}},p.ScaleTimeline=function(t){this.curves=new p.Curves(t),this.frames=[],this.frames.length=3*t},p.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,n,r){var s=this.frames;if(!(i<s[0])){var o=t.bones[this.boneIndex];if(i>=s[s.length-3])return o.scaleX+=(o.data.scaleX*s[s.length-2]-o.scaleX)*r,void(o.scaleY+=(o.data.scaleY*s[s.length-1]-o.scaleY)*r);var a=p.Animation.binarySearch(s,i,3),c=s[a-2],h=s[a-1],l=s[a],d=1-(i-l)/(s[a+-3]-l);d=this.curves.getCurvePercent(a/3-1,d),o.scaleX+=(o.data.scaleX*(c+(s[a+1]-c)*d)-o.scaleX)*r,o.scaleY+=(o.data.scaleY*(h+(s[a+2]-h)*d)-o.scaleY)*r}}},p.ColorTimeline=function(t){this.curves=new p.Curves(t),this.frames=[],this.frames.length=5*t},p.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,s){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n,this.frames[t+3]=r,this.frames[t+4]=s},apply:function(t,e,i,n,r){var s=this.frames;if(!(i<s[0])){var o,a,c,h;if(i>=s[s.length-5]){var l=s.length-1;o=s[l-3],a=s[l-2],c=s[l-1],h=s[l]}else{var d=p.Animation.binarySearch(s,i,5),u=s[d-4],_=s[d-3],f=s[d-2],g=s[d-1],m=s[d],y=1-(i-m)/(s[d-5]-m);y=this.curves.getCurvePercent(d/5-1,y),o=u+(s[d+1]-u)*y,a=_+(s[d+2]-_)*y,c=f+(s[d+3]-f)*y,h=g+(s[d+4]-g)*y}var v=t.slots[this.slotIndex];1>r?(v.r+=(o-v.r)*r,v.g+=(a-v.g)*r,v.b+=(c-v.b)*r,v.a+=(h-v.a)*r):(v.r=o,v.g=a,v.b=c,v.a=h)}}},p.AttachmentTimeline=function(t){this.curves=new p.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},p.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0])return void(e>i&&this.apply(t,e,Number.MAX_VALUE,null,0));e>i&&(e=-1);var o=i>=s[s.length-1]?s.length-1:p.Animation.binarySearch1(s,i)-1;if(!(s[o]<e)){var a=this.attachmentNames[o];t.slots[this.slotIndex].setAttachment(a?t.getAttachmentBySlotIndex(this.slotIndex,a):null)}}},p.EventTimeline=function(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t},p.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.events[t]=i},apply:function(t,e,i,n,r){if(n){var s=this.frames,o=s.length;if(e>i)this.apply(t,e,Number.MAX_VALUE,n,r),e=-1;else if(e>=s[o-1])return;if(!(i<s[0])){var a;if(e<s[0])a=0;else{a=p.Animation.binarySearch1(s,e);for(var c=s[a];a>0&&s[a-1]==c;)a--}for(var h=this.events;o>a&&i>=s[a];a++)n.push(h[a])}}}},p.DrawOrderTimeline=function(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t},p.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},apply:function(t,e,i,n,r){var s=this.frames;if(!(i<s[0])){var o;o=i>=s[s.length-1]?s.length-1:p.Animation.binarySearch1(s,i)-1;var a=t.drawOrder,c=t.slots,h=this.drawOrders[o];if(h)for(var l=0,d=h.length;d>l;l++)a[l]=t.slots[h[l]];else for(var l=0,d=c.length;d>l;l++)a[l]=c[l]}}},p.FfdTimeline=function(t){this.curves=new p.Curves(t),this.frames=[],this.frames.length=t,this.frameVertices=[],this.frameVertices.length=t},p.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},apply:function(t,e,i,n,r){var s=t.slots[this.slotIndex];if(s.attachment==this.attachment){var o=this.frames;if(!(i<o[0])){var a=this.frameVertices,c=a[0].length,h=s.attachmentVertices;if(h.length!=c&&(r=1),h.length=c,i>=o[o.length-1]){var l=a[o.length-1];if(1>r)for(var d=0;c>d;d++)h[d]+=(l[d]-h[d])*r;else for(var d=0;c>d;d++)h[d]=l[d]}else{var u=p.Animation.binarySearch1(o,i),_=o[u],f=1-(i-_)/(o[u-1]-_);f=this.curves.getCurvePercent(u-1,0>f?0:f>1?1:f);var g=a[u-1],m=a[u];if(1>r)for(var d=0;c>d;d++){var y=g[d];h[d]+=(y+(m[d]-y)*f-h[d])*r}else for(var d=0;c>d;d++){var y=g[d];h[d]=y+(m[d]-y)*f}}}}}},p.IkConstraintTimeline=function(t){this.curves=new p.Curves(t),this.frames=[],this.frames.length=3*t},p.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,n,r){var s=this.frames;if(!(i<s[0])){var o=t.ikConstraints[this.ikConstraintIndex];if(i>=s[s.length-3])return o.mix+=(s[s.length-2]-o.mix)*r,void(o.bendDirection=s[s.length-1]);var a=p.Animation.binarySearch(s,i,3),c=s[a+-2],h=s[a],l=1-(i-h)/(s[a+-3]-h);l=this.curves.getCurvePercent(a/3-1,l);var d=c+(s[a+1]-c)*l;o.mix+=(d-o.mix)*r,o.bendDirection=s[a+-1]}}},p.FlipXTimeline=function(t){this.curves=new p.Curves(t),this.frames=[],this.frames.length=2*t},p.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0])return void(e>i&&this.apply(t,e,Number.MAX_VALUE,null,0));e>i&&(e=-1);var o=(i>=s[s.length-2]?s.length:p.Animation.binarySearch(s,i,2))-2;s[o]<e||(t.bones[this.boneIndex].flipX=0!=s[o+1])}},p.FlipYTimeline=function(t){this.curves=new p.Curves(t),this.frames=[],this.frames.length=2*t},p.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,i,n,r){var s=this.frames;if(i<s[0])return void(e>i&&this.apply(t,e,Number.MAX_VALUE,null,0));e>i&&(e=-1);var o=(i>=s[s.length-2]?s.length:p.Animation.binarySearch(s,i,2))-2;s[o]<e||(t.bones[this.boneIndex].flipY=0!=s[o+1])}},p.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},p.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){for(var e=this.events,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null}},p.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,i=t.bones.length;i>e;e++){var n=t.bones[e],r=n.parent?this.bones[t.bones.indexOf(n.parent)]:null;this.bones.push(new p.Bone(n,this,r))}this.slots=[],this.drawOrder=[];for(var e=0,i=t.slots.length;i>e;e++){var s=t.slots[e],o=this.bones[t.bones.indexOf(s.boneData)],a=new p.Slot(s,o);this.slots.push(a),this.drawOrder.push(a)}this.ikConstraints=[];for(var e=0,i=t.ikConstraints.length;i>e;e++)this.ikConstraints.push(new p.IkConstraint(t.ikConstraints[e],this));this.boneCache=[],this.updateCache()},p.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,i=e+1,n=this.boneCache;n.length>i&&(n.length=i);for(var r=0,s=n.length;s>r;r++)n[r].length=0;for(;n.length<i;)n[n.length]=[];var o=n[0],a=this.bones;t:for(var r=0,s=a.length;s>r;r++){var c=a[r],h=c;do{for(var l=0;e>l;l++)for(var d=t[l],u=d.bones[0],_=d.bones[d.bones.length-1];;){if(h==_){n[l].push(c),n[l+1].push(c);continue t}if(_==u)break;_=_.parent}h=h.parent}while(h);o[o.length]=c}},updateWorldTransform:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++){var n=t[e];n.rotationIK=n.rotation}for(var e=0,r=this.boneCache.length-1;;){for(var s=this.boneCache[e],o=0,a=s.length;a>o;o++)s[o].updateWorldTransform();if(e==r)break;this.ikConstraints[e].apply(),e++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,e=0,i=n.length;i>e;e++){var r=n[e];r.bendDirection=r.data.bendDirection,r.mix=r.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=this.drawOrder,i=0,n=t.length;n>i;i++)e[i]=t[i],t[i].setToSetupPose(i)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw new Error("Skin not found: "+t);this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;n>i;i++){var r=e[i],s=r.data.attachmentName;if(s){var o=t.getAttachment(i,s);o&&r.setAttachment(o)}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var i=this.slots,n=0,r=i.length;r>n;n++){var s=i[n];if(s.data.name==t){var o=null;if(e&&(o=this.getAttachmentBySlotIndex(n,e),!o))throw new Error("Attachment not found: "+e+", for slot: "+t);return void s.setAttachment(o)}}throw new Error("Slot not found: "+t)},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t}},p.EventData=function(t){this.name=t},p.EventData.prototype={intValue:0,floatValue:0,stringValue:null},p.Event=function(t){this.data=t},p.Event.prototype={intValue:0,floatValue:0,stringValue:null},p.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},p.RegionAttachment=function(t){this.name=t,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},p.RegionAttachment.prototype={type:p.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,r){var s=this.uvs;r?(s[2]=t,s[3]=n,s[4]=t,s[5]=e,s[6]=i,s[7]=e,s[0]=i,s[1]=n):(s[0]=t,s[1]=n,s[2]=t,s[3]=e,s[4]=i,s[5]=e,s[6]=i,s[7]=n)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.regionOffsetX*t,n=-this.height/2*this.scaleY+this.regionOffsetY*e,r=i+this.regionWidth*t,s=n+this.regionHeight*e,o=this.rotation*p.degRad,a=Math.cos(o),c=Math.sin(o),h=i*a+this.x,l=i*c,d=n*a+this.y,u=n*c,_=r*a+this.x,f=r*c,g=s*a+this.y,m=s*c,y=this.offset;y[0]=h-u,y[1]=d+l,y[2]=h-m,y[3]=g+l,y[4]=_-m,y[5]=g+f,y[6]=_-u,y[7]=d+f},computeVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;var r=i.m00,s=i.m01,o=i.m10,a=i.m11,c=this.offset;n[0]=c[0]*r+c[1]*s+t,n[1]=c[0]*o+c[1]*a+e,n[2]=c[2]*r+c[3]*s+t,n[3]=c[2]*o+c[3]*a+e,n[4]=c[4]*r+c[5]*s+t,n[5]=c[4]*o+c[5]*a+e,n[6]=c[6]*r+c[7]*s+t,n[7]=c[6]*o+c[7]*a+e}},p.MeshAttachment=function(t){this.name=t},p.MeshAttachment.prototype={type:p.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,i=this.regionUVs.length;if(this.uvs&&this.uvs.length==i||(this.uvs=new p.Float32Array(i)),this.regionRotate)for(var n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n+1]*t,this.uvs[n+1]=this.regionV+e-this.regionUVs[n]*e;else for(var n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n]*t,this.uvs[n+1]=this.regionV+this.regionUVs[n+1]*e},computeWorldVertices:function(t,e,i,n){var r=i.bone;t+=r.worldX,e+=r.worldY;var s=r.m00,o=r.m01,a=r.m10,c=r.m11,h=this.vertices,l=h.length;i.attachmentVertices.length==l&&(h=i.attachmentVertices);for(var d=0;l>d;d+=2){var u=h[d],_=h[d+1];n[d]=u*s+_*o+t,n[d+1]=u*a+_*c+e}}},p.SkinnedMeshAttachment=function(t){this.name=t},p.SkinnedMeshAttachment.prototype={type:p.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,e,i,n,r){var s=this.regionU2-this.regionU,o=this.regionV2-this.regionV,a=this.regionUVs.length;if(this.uvs&&this.uvs.length==a||(this.uvs=new p.Float32Array(a)),this.regionRotate)for(var c=0;a>c;c+=2)this.uvs[c]=this.regionU+this.regionUVs[c+1]*s,this.uvs[c+1]=this.regionV+o-this.regionUVs[c]*o;else for(var c=0;a>c;c+=2)this.uvs[c]=this.regionU+this.regionUVs[c]*s,this.uvs[c+1]=this.regionV+this.regionUVs[c+1]*o},computeWorldVertices:function(t,e,i,n){var r,s,o,a,c,h,l,d=i.bone.skeleton.bones,u=this.weights,_=this.bones,f=0,p=0,g=0,m=0,y=_.length;if(i.attachmentVertices.length)for(var v=i.attachmentVertices;y>p;f+=2){for(s=0,o=0,r=_[p++]+p;r>p;p++,g+=3,m+=2)a=d[_[p]],c=u[g]+v[m],h=u[g+1]+v[m+1],l=u[g+2],s+=(c*a.m00+h*a.m01+a.worldX)*l,o+=(c*a.m10+h*a.m11+a.worldY)*l;n[f]=s+t,n[f+1]=o+e}else for(;y>p;f+=2){for(s=0,o=0,r=_[p++]+p;r>p;p++,g+=3)a=d[_[p]],c=u[g],h=u[g+1],l=u[g+2],s+=(c*a.m00+h*a.m01+a.worldX)*l,o+=(c*a.m10+h*a.m11+a.worldY)*l;n[f]=s+t,n[f+1]=o+e}}},p.BoundingBoxAttachment=function(t){this.name=t,this.vertices=[]},p.BoundingBoxAttachment.prototype={type:p.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;for(var r=i.m00,s=i.m01,o=i.m10,a=i.m11,c=this.vertices,h=0,l=c.length;l>h;h+=2){var d=c[h],u=c[h+1];n[h]=d*r+u*s+t,n[h+1]=d*o+u*a+e}}},p.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},p.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw new Error("Animation not found: "+t);var r=this.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);this.setMix(n,r,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}},p.TrackEntry=function(){},p.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},p.AnimationState=function(t){this.data=t,this.tracks=[],this.events=[]},p.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){if(i.time+=t*i.timeScale,i.previous){var n=t*i.previous.timeScale;i.previous.time+=n,i.mixTime+=n}var r=i.next;r?(r.time=i.lastTime-r.delay,r.time>=0&&this.setCurrent(e,r)):!i.loop&&i.lastTime>=i.endTime&&this.clearTrack(e)}}},apply:function(t){for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){this.events.length=0;var n=i.time,r=i.lastTime,s=i.endTime,o=i.loop;!o&&n>s&&(n=s);var a=i.previous;if(a){var c=a.time;!a.loop&&c>a.endTime&&(c=a.endTime),a.animation.apply(t,c,c,a.loop,null);var h=i.mixTime/i.mixDuration*i.mix;h>=1&&(h=1,i.previous=null),i.animation.mix(t,i.lastTime,n,o,this.events,h)}else 1==i.mix?i.animation.apply(t,i.lastTime,n,o,this.events):i.animation.mix(t,i.lastTime,n,o,this.events,i.mix);for(var l=0,d=this.events.length;d>l;l++){var u=this.events[l];i.onEvent&&i.onEvent(e,u),this.onEvent&&this.onEvent(e,u)}if(o?r%s>n%s:s>r&&n>=s){var _=Math.floor(n/s);i.onComplete&&i.onComplete(e,_),this.onComplete&&this.onComplete(e,_)}i.lastTime=i.time}}},clearTracks:function(){for(var t=0,e=this.tracks.length;e>t;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];e&&(e.onEnd&&e.onEnd(t),this.onEnd&&this.onEnd(t),this.tracks[t]=null)}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;i.previous=null,i.onEnd&&i.onEnd(t),this.onEnd&&this.onEnd(t),e.mixDuration=this.data.getMix(i.animation,e.animation),e.mixDuration>0&&(e.mixTime=0,e.previous=n&&i.mixTime/i.mixDuration<.5?n:i)}this.tracks[t]=e,e.onStart&&e.onStart(t),this.onStart&&this.onStart(t)},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw new Error("Animation not found: "+e);return this.setAnimation(t,n,i)},setAnimation:function(t,e,i){var n=new p.TrackEntry;return n.animation=e,n.loop=i,n.endTime=e.duration,this.setCurrent(t,n),n},addAnimationByName:function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);return this.addAnimation(t,r,i,n)},addAnimation:function(t,e,i,n){var r=new p.TrackEntry;r.animation=e,r.loop=i,r.endTime=e.duration;var s=this._expandToIndex(t);if(s){for(;s.next;)s=s.next;s.next=r}else this.tracks[t]=r;return 0>=n&&(s?n+=s.endTime-this.data.getMix(s.animation,e):n=0),r.delay=n,r},getCurrent:function(t){return t>=this.tracks.length?null:this.tracks[t]}},p.SkeletonJson=function(t){this.attachmentLoader=t},p.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,e){var i=new p.SkeletonData;i.name=e;var n=t.skeleton;n&&(i.hash=n.hash,i.version=n.spine,i.width=n.width||0,i.height=n.height||0);for(var r=t.bones,s=0,o=r.length;o>s;s++){var a=r[s],c=null;if(a.parent&&(c=i.findBone(a.parent),!c))throw new Error("Parent bone not found: "+a.parent);var h=new p.BoneData(a.name,c);h.length=(a.length||0)*this.scale,h.x=(a.x||0)*this.scale,h.y=(a.y||0)*this.scale,h.rotation=a.rotation||0,h.scaleX=a.hasOwnProperty("scaleX")?a.scaleX:1,h.scaleY=a.hasOwnProperty("scaleY")?a.scaleY:1,h.inheritScale=a.hasOwnProperty("inheritScale")?a.inheritScale:!0,h.inheritRotation=a.hasOwnProperty("inheritRotation")?a.inheritRotation:!0,i.bones.push(h)}var l=t.ik;if(l)for(var s=0,o=l.length;o>s;s++){for(var d=l[s],u=new p.IkConstraintData(d.name),r=d.bones,_=0,f=r.length;f>_;_++){var g=i.findBone(r[_]);if(!g)throw new Error("IK bone not found: "+r[_]);u.bones.push(g)}if(u.target=i.findBone(d.target),!u.target)throw new Error("Target bone not found: "+d.target);u.bendDirection=!d.hasOwnProperty("bendPositive")||d.bendPositive?1:-1,u.mix=d.hasOwnProperty("mix")?d.mix:1,i.ikConstraints.push(u)}for(var m=t.slots,s=0,o=m.length;o>s;s++){var y=m[s],h=i.findBone(y.bone);if(!h)throw new Error("Slot bone not found: "+y.bone);var v=new p.SlotData(y.name,h),T=y.color;T&&(v.r=this.toColor(T,0),v.g=this.toColor(T,1),v.b=this.toColor(T,2),v.a=this.toColor(T,3)),v.attachmentName=y.attachment,v.blendMode=p.AttachmentType[y.blend||"normal"],i.slots.push(v)}var C=t.skins;for(var S in C)if(C.hasOwnProperty(S)){var E=C[S],b=new p.Skin(S);for(var x in E)if(E.hasOwnProperty(x)){var A=i.findSlotIndex(x),R=E[x];for(var I in R)if(R.hasOwnProperty(I)){var P=this.readAttachment(b,I,R[I]);P&&b.addAttachment(A,I,P)}}i.skins.push(b),"default"==b.name&&(i.defaultSkin=b)}var L=t.events;for(var w in L)if(L.hasOwnProperty(w)){var O=L[w],F=new p.EventData(w);F.intValue=O["int"]||0,F.floatValue=O["float"]||0,F.stringValue=O.string||null,i.events.push(F)}var N=t.animations;for(var D in N)N.hasOwnProperty(D)&&this.readAnimation(D,N[D],i);return i},readAttachment:function(t,e,i){e=i.name||e;var n=p.AttachmentType[i.type||"region"],r=i.path||e,s=this.scale;if(n==p.AttachmentType.region){var o=this.attachmentLoader.newRegionAttachment(t,e,r);if(!o)return null;o.path=r,o.x=(i.x||0)*s,o.y=(i.y||0)*s,o.scaleX=i.hasOwnProperty("scaleX")?i.scaleX:1,o.scaleY=i.hasOwnProperty("scaleY")?i.scaleY:1,o.rotation=i.rotation||0,o.width=(i.width||0)*s,o.height=(i.height||0)*s;var a=i.color;return a&&(o.r=this.toColor(a,0),o.g=this.toColor(a,1),o.b=this.toColor(a,2),o.a=this.toColor(a,3)),o.updateOffset(),o}if(n==p.AttachmentType.mesh){var c=this.attachmentLoader.newMeshAttachment(t,e,r);return c?(c.path=r,c.vertices=this.getFloatArray(i,"vertices",s),c.triangles=this.getIntArray(i,"triangles"),c.regionUVs=this.getFloatArray(i,"uvs",1),c.updateUVs(),a=i.color,a&&(c.r=this.toColor(a,0),c.g=this.toColor(a,1),c.b=this.toColor(a,2),c.a=this.toColor(a,3)),c.hullLength=2*(i.hull||0),i.edges&&(c.edges=this.getIntArray(i,"edges")),c.width=(i.width||0)*s,c.height=(i.height||0)*s,c):null}if(n==p.AttachmentType.skinnedmesh){var c=this.attachmentLoader.newSkinnedMeshAttachment(t,e,r);if(!c)return null;c.path=r;for(var h=this.getFloatArray(i,"uvs",1),l=this.getFloatArray(i,"vertices",1),d=[],u=[],_=0,f=l.length;f>_;){var g=0|l[_++];u[u.length]=g;for(var m=_+4*g;m>_;)u[u.length]=l[_],d[d.length]=l[_+1]*s,d[d.length]=l[_+2]*s,d[d.length]=l[_+3],_+=4}return c.bones=u,c.weights=d,c.triangles=this.getIntArray(i,"triangles"),c.regionUVs=h,c.updateUVs(),a=i.color,a&&(c.r=this.toColor(a,0),c.g=this.toColor(a,1),c.b=this.toColor(a,2),c.a=this.toColor(a,3)),c.hullLength=2*(i.hull||0),i.edges&&(c.edges=this.getIntArray(i,"edges")),c.width=(i.width||0)*s,c.height=(i.height||0)*s,c}if(n==p.AttachmentType.boundingbox){for(var y=this.attachmentLoader.newBoundingBoxAttachment(t,e),l=i.vertices,_=0,f=l.length;f>_;_++)y.vertices.push(l[_]*s);return y}throw new Error("Unknown attachment type: "+n)},readAnimation:function(t,e,i){var n=[],r=0,s=e.slots;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o],c=i.findSlotIndex(o);for(var h in a)if(a.hasOwnProperty(h)){var l=a[h];if("color"==h){var d=new p.ColorTimeline(l.length);d.slotIndex=c;for(var u=0,_=0,f=l.length;f>_;_++){var g=l[_],m=g.color,y=this.toColor(m,0),v=this.toColor(m,1),T=this.toColor(m,2),C=this.toColor(m,3);d.setFrame(u,g.time,y,v,T,C),this.readCurve(d,u,g),u++}n.push(d),r=Math.max(r,d.frames[5*d.getFrameCount()-5])}else{if("attachment"!=h)throw new Error("Invalid timeline type for a slot: "+h+" ("+o+")");var d=new p.AttachmentTimeline(l.length);d.slotIndex=c;for(var u=0,_=0,f=l.length;f>_;_++){var g=l[_];d.setFrame(u++,g.time,g.name)}n.push(d),r=Math.max(r,d.frames[d.getFrameCount()-1])}}}var S=e.bones;for(var E in S)if(S.hasOwnProperty(E)){var b=i.findBoneIndex(E);if(-1==b)throw new Error("Bone not found: "+E);var x=S[E];for(var h in x)if(x.hasOwnProperty(h)){var l=x[h];if("rotate"==h){var d=new p.RotateTimeline(l.length);d.boneIndex=b;for(var u=0,_=0,f=l.length;f>_;_++){var g=l[_];d.setFrame(u,g.time,g.angle),this.readCurve(d,u,g),u++}n.push(d),r=Math.max(r,d.frames[2*d.getFrameCount()-2])}else if("translate"==h||"scale"==h){var d,A=1;"scale"==h?d=new p.ScaleTimeline(l.length):(d=new p.TranslateTimeline(l.length),A=this.scale),d.boneIndex=b;for(var u=0,_=0,f=l.length;f>_;_++){var g=l[_],R=(g.x||0)*A,I=(g.y||0)*A;d.setFrame(u,g.time,R,I),this.readCurve(d,u,g),u++}n.push(d),r=Math.max(r,d.frames[3*d.getFrameCount()-3])}else{if("flipX"!=h&&"flipY"!=h)throw new Error("Invalid timeline type for a bone: "+h+" ("+E+")");var R="flipX"==h,d=R?new p.FlipXTimeline(l.length):new p.FlipYTimeline(l.length);d.boneIndex=b;for(var P=R?"x":"y",u=0,_=0,f=l.length;f>_;_++){var g=l[_];d.setFrame(u,g.time,g[P]||!1),u++}n.push(d),r=Math.max(r,d.frames[2*d.getFrameCount()-2])}}}var L=e.ik;for(var w in L)if(L.hasOwnProperty(w)){var O=i.findIkConstraint(w),l=L[w],d=new p.IkConstraintTimeline(l.length);d.ikConstraintIndex=i.ikConstraints.indexOf(O);for(var u=0,_=0,f=l.length;f>_;_++){var g=l[_],F=g.hasOwnProperty("mix")?g.mix:1,N=!g.hasOwnProperty("bendPositive")||g.bendPositive?1:-1;d.setFrame(u,g.time,F,N),this.readCurve(d,u,g),u++}n.push(d),r=Math.max(r,d.frames[3*d.frameCount-3])}var D=e.ffd;for(var B in D){var M=i.findSkin(B),a=D[B];for(o in a){var c=i.findSlotIndex(o),W=a[o];for(var z in W){var l=W[z],d=new p.FfdTimeline(l.length),V=M.getAttachment(c,z);if(!V)throw new Error("FFD attachment not found: "+z);d.slotIndex=c,d.attachment=V;var k,G=V.type==p.AttachmentType.mesh;k=G?V.vertices.length:V.weights.length/3*2;for(var u=0,_=0,f=l.length;f>_;_++){var U,g=l[_];if(g.vertices){var X=g.vertices,U=[];U.length=k;var Y=g.offset||0,H=X.length;if(1==this.scale)for(var j=0;H>j;j++)U[j+Y]=X[j];else for(var j=0;H>j;j++)U[j+Y]=X[j]*this.scale;if(G)for(var Q=V.vertices,j=0,H=U.length;H>j;j++)U[j]+=Q[j]}else G?U=V.vertices:(U=[],U.length=k);d.setFrame(u,g.time,U),this.readCurve(d,u,g),u++}n[n.length]=d,r=Math.max(r,d.frames[d.frameCount-1])}}}var Z=e.drawOrder;if(Z||(Z=e.draworder),Z){for(var d=new p.DrawOrderTimeline(Z.length),q=i.slots.length,u=0,_=0,f=Z.length;f>_;_++){var K=Z[_],J=null;if(K.offsets){J=[],J.length=q;for(var j=q-1;j>=0;j--)J[j]=-1;var $=K.offsets,tt=[];tt.length=q-$.length;for(var et=0,it=0,j=0,H=$.length;H>j;j++){var nt=$[j],c=i.findSlotIndex(nt.slot);if(-1==c)throw new Error("Slot not found: "+nt.slot);for(;et!=c;)tt[it++]=et++;J[et+nt.offset]=et++}for(;q>et;)tt[it++]=et++;for(var j=q-1;j>=0;j--)-1==J[j]&&(J[j]=tt[--it])}d.setFrame(u++,K.time,J)}n.push(d),r=Math.max(r,d.frames[d.getFrameCount()-1])}var rt=e.events;if(rt){for(var d=new p.EventTimeline(rt.length),u=0,_=0,f=rt.length;f>_;_++){var st=rt[_],ot=i.findEvent(st.name);if(!ot)throw new Error("Event not found: "+st.name);var at=new p.Event(ot);at.intValue=st.hasOwnProperty("int")?st["int"]:ot.intValue,at.floatValue=st.hasOwnProperty("float")?st["float"]:ot.floatValue,at.stringValue=st.hasOwnProperty("string")?st.string:ot.stringValue,
d.setFrame(u++,st.time,at)}n.push(d),r=Math.max(r,d.frames[d.getFrameCount()-1])}i.animations.push(new p.Animation(t,n,r))},readCurve:function(t,e,i){var n=i.curve;n?"stepped"==n?t.curves.setStepped(e):n instanceof Array&&t.curves.setCurve(e,n[0],n[1],n[2],n[3]):t.curves.setLinear(e)},toColor:function(t,e){if(8!=t.length)throw new Error("Color hexidecimal length must be 8, recieved: "+t);return parseInt(t.substring(2*e,2*e+2),16)/255},getFloatArray:function(t,e,i){var n=t[e],r=new p.Float32Array(n.length),s=0,o=n.length;if(1==i)for(;o>s;s++)r[s]=n[s];else for(;o>s;s++)r[s]=n[s]*i;return r},getIntArray:function(t,e){for(var i=t[e],n=new p.Uint16Array(i.length),r=0,s=i.length;s>r;r++)n[r]=0|i[r];return n}},p.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var i=new p.AtlasReader(t),n=[];n.length=4;for(var r=null;;){var s=i.readLine();if(null===s)break;if(s=i.trim(s),s.length)if(r){var o=new p.AtlasRegion;o.name=s,o.page=r,o.rotate="true"==i.readValue(),i.readTuple(n);var a=parseInt(n[0]),c=parseInt(n[1]);i.readTuple(n);var h=parseInt(n[0]),l=parseInt(n[1]);o.u=a/r.width,o.v=c/r.height,o.rotate?(o.u2=(a+l)/r.width,o.v2=(c+h)/r.height):(o.u2=(a+h)/r.width,o.v2=(c+l)/r.height),o.x=a,o.y=c,o.width=Math.abs(h),o.height=Math.abs(l),4==i.readTuple(n)&&(o.splits=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],4==i.readTuple(n)&&(o.pads=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],i.readTuple(n))),o.originalWidth=parseInt(n[0]),o.originalHeight=parseInt(n[1]),i.readTuple(n),o.offsetX=parseInt(n[0]),o.offsetY=parseInt(n[1]),o.index=parseInt(i.readValue()),this.regions.push(o)}else{r=new p.AtlasPage,r.name=s,2==i.readTuple(n)&&(r.width=parseInt(n[0]),r.height=parseInt(n[1]),i.readTuple(n)),r.format=p.Atlas.Format[n[0]],i.readTuple(n),r.minFilter=p.Atlas.TextureFilter[n[0]],r.magFilter=p.Atlas.TextureFilter[n[1]];var d=i.readValue();r.uWrap=p.Atlas.TextureWrap.clampToEdge,r.vWrap=p.Atlas.TextureWrap.clampToEdge,"x"==d?r.uWrap=p.Atlas.TextureWrap.repeat:"y"==d?r.vWrap=p.Atlas.TextureWrap.repeat:"xy"==d&&(r.uWrap=r.vWrap=p.Atlas.TextureWrap.repeat),e.load(r,s,this),this.pages.push(r)}else r=null}},p.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;i>e;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,n=e.length;n>i;i++){var r=e[i];r.page==t&&(r.u=r.x/t.width,r.v=r.y/t.height,r.rotate?(r.u2=(r.x+r.height)/t.width,r.v2=(r.y+r.width)/t.height):(r.u2=(r.x+r.width)/t.width,r.v2=(r.y+r.height)/t.height))}}},p.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},p.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},p.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},p.AtlasPage=function(){},p.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},p.AtlasRegion=function(){},p.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},p.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},p.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw new Error("Invalid line: "+e);for(var n=0,r=i+1;3>n;n++){var s=e.indexOf(",",r);if(-1==s)break;t[n]=this.trim(e.substr(r,s-r)),r=s+1}return t[n]=this.trim(e.substring(r)),n+1}},p.AtlasAttachmentLoader=function(t){this.atlas=t},p.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,e,i){var n=this.atlas.findRegion(i);if(!n)throw new Error("Region not found in atlas: "+i+" (region attachment: "+e+")");var r=new p.RegionAttachment(e);return r.rendererObject=n,r.setUVs(n.u,n.v,n.u2,n.v2,n.rotate),r.regionOffsetX=n.offsetX,r.regionOffsetY=n.offsetY,r.regionWidth=n.width,r.regionHeight=n.height,r.regionOriginalWidth=n.originalWidth,r.regionOriginalHeight=n.originalHeight,r},newMeshAttachment:function(t,e,i){var n=this.atlas.findRegion(i);if(!n)throw new Error("Region not found in atlas: "+i+" (mesh attachment: "+e+")");var r=new p.MeshAttachment(e);return r.rendererObject=n,r.regionU=n.u,r.regionV=n.v,r.regionU2=n.u2,r.regionV2=n.v2,r.regionRotate=n.rotate,r.regionOffsetX=n.offsetX,r.regionOffsetY=n.offsetY,r.regionWidth=n.width,r.regionHeight=n.height,r.regionOriginalWidth=n.originalWidth,r.regionOriginalHeight=n.originalHeight,r},newSkinnedMeshAttachment:function(t,e,i){var n=this.atlas.findRegion(i);if(!n)throw new Error("Region not found in atlas: "+i+" (skinned mesh attachment: "+e+")");var r=new p.SkinnedMeshAttachment(e);return r.rendererObject=n,r.regionU=n.u,r.regionV=n.v,r.regionU2=n.u2,r.regionV2=n.v2,r.regionRotate=n.rotate,r.regionOffsetX=n.offsetX,r.regionOffsetY=n.offsetY,r.regionWidth=n.width,r.regionHeight=n.height,r.regionOriginalWidth=n.originalWidth,r.regionOriginalHeight=n.originalHeight,r},newBoundingBoxAttachment:function(t,e){return new p.BoundingBoxAttachment(e)}},p.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},p.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){var i=t.slots,n=i.length,r=t.x,s=t.y,o=this.boundingBoxes,a=this.polygonPool,c=this.polygons;o.length=0;for(var h=0,l=c.length;l>h;h++)a.push(c[h]);c.length=0;for(var h=0;n>h;h++){var d=i[h],u=d.attachment;if(u.type==p.AttachmentType.boundingbox){o.push(u);var _,f=a.length;f>0?(_=a[f-1],a.splice(f-1,1)):_=[],c.push(_),_.length=u.vertices.length,u.computeWorldVertices(r,s,d.bone,_)}}e&&this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MIN_VALUE,s=0,o=t.length;o>s;s++)for(var a=t[s],c=0,h=a.length;h>c;c+=2){var l=a[c],d=a[c+1];e=Math.min(e,l),i=Math.min(i,d),n=Math.max(n,l),r=Math.max(r,d)}this.minX=e,this.minY=i,this.maxX=n,this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,n){var r=this.minX,s=this.minY,o=this.maxX,a=this.maxY;if(r>=t&&r>=i||s>=e&&s>=n||t>=o&&i>=o||e>=a&&n>=a)return!1;var c=(n-e)/(i-t),h=c*(r-t)+e;if(h>s&&a>h)return!0;if(h=c*(o-t)+e,h>s&&a>h)return!0;var l=(s-e)/c+t;return l>r&&o>l?!0:(l=(a-e)/c+t,l>r&&o>l?!0:!1)},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var i=this.polygons,n=0,r=i.length;r>n;n++)if(this.polygonContainsPoint(i[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,i,n){for(var r=this.polygons,s=0,o=r.length;o>s;s++)if(r[s].intersectsSegment(t,e,i,n))return this.boundingBoxes[s];return null},polygonContainsPoint:function(t,e,i){for(var n=t.length,r=n-2,s=!1,o=0;n>o;o+=2){var a=t[o+1],c=t[r+1];if(i>a&&c>=i||i>c&&a>=i){var h=t[o];h+(i-a)/(c-a)*(t[r]-h)<e&&(s=!s)}r=o}return s},polygonIntersectsSegment:function(t,e,i,n,r){for(var s=t.length,o=e-n,a=i-r,c=e*r-i*n,h=t[s-2],l=t[s-1],d=0;s>d;d+=2){var u=t[d],_=t[d+1],f=h*_-l*u,p=h-u,g=l-_,m=o*g-a*p,y=(c*p-o*f)/m;if((y>=h&&u>=y||y>=u&&h>=y)&&(y>=e&&n>=y||y>=n&&e>=y)){var v=(c*g-a*f)/m;if((v>=l&&_>=v||v>=_&&l>=v)&&(v>=i&&r>=v||v>=r&&i>=v))return!0}h=u,l=_}return!1},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}};var o=o||{};o.VERTEX_INDEX={X1:0,Y1:1,X2:2,Y2:3,X3:4,Y3:5,X4:6,Y4:7},o.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3},o.Skeleton=_ccsg.Node.extend({_skeleton:null,_rootBone:null,_timeScale:1,_debugSlots:!1,_debugBones:!1,_premultipliedAlpha:!1,_ownsSkeletonData:null,_atlas:null,_blendFunc:null,ctor:function(t,e,i){_ccsg.Node.prototype.ctor.call(this),this._blendFunc={src:n.BLEND_SRC,dst:n.BLEND_DST},0===arguments.length?this.init():this.initWithArgs(t,e,i)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new o.Skeleton.CanvasRenderCmd(this):new o.Skeleton.WebGLRenderCmd(this)},init:function(){_ccsg.Node.prototype.init.call(this),this._blendFunc.src=n.ONE,this._blendFunc.dst=n.ONE_MINUS_SRC_ALPHA,this.scheduleUpdate()},setDebugSolots:function(t){this._debugSlots=t},setDebugBones:function(t){this._debugBones=t},setDebugSlotsEnabled:function(t){this._debugSlots=t},getDebugSlotsEnabled:function(){return this._debugSlots},setDebugBonesEnabled:function(t){this._debugBones=t},getDebugBonesEnabled:function(){return this._debugBones},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},initWithArgs:function(t,e,i){var r,s,a,c=t,h=e;if(n.js.isString(c)){if(n.js.isString(h)){var l=n.loader.getRes(h);o._atlasLoader.setAtlasFile(h),s=new p.Atlas(l,o._atlasLoader)}else s=e;i=i||1/n.director.getContentScaleFactor();var d=new p.AtlasAttachmentLoader(s),u=new p.SkeletonJson(d);u.scale=i;var _=n.loader.getRes(c);r=u.readSkeletonData(_),s.dispose(u),a=!0}else r=t,a=e;this.setSkeletonData(r,a),this.init()},getBoundingBox:function(){for(var t=n.FLT_MAX,e=n.FLT_MAX,i=n.FLT_MIN,r=n.FLT_MIN,s=this.getScaleX(),a=this.getScaleY(),c=[],h=this._skeleton.slots,l=o.VERTEX_INDEX,d=0,u=h.length;u>d;++d){var _=h[d];if(_.attachment&&_.attachment.type==o.ATTACHMENT_TYPE.REGION){var f=_.attachment;this._computeRegionAttachmentWorldVertices(f,_.bone.skeleton.x,_.bone.skeleton.y,_.bone,c),t=Math.min(t,c[l.X1]*s,c[l.X4]*s,c[l.X2]*s,c[l.X3]*s),e=Math.min(e,c[l.Y1]*a,c[l.Y4]*a,c[l.Y2]*a,c[l.Y3]*a),i=Math.max(i,c[l.X1]*s,c[l.X4]*s,c[l.X2]*s,c[l.X3]*s),r=Math.max(r,c[l.Y1]*a,c[l.Y4]*a,c[l.Y2]*a,c[l.Y3]*a)}}var p=this.getPosition();return n.rect(p.x+t,p.y+e,i-t,r-e)},_computeRegionAttachmentWorldVertices:function(t,e,i,n,r){var s=t.offset,a=o.VERTEX_INDEX;e+=n.worldX,i+=n.worldY,r[a.X1]=s[a.X1]*n.m00+s[a.Y1]*n.m01+e,r[a.Y1]=s[a.X1]*n.m10+s[a.Y1]*n.m11+i,r[a.X2]=s[a.X2]*n.m00+s[a.Y2]*n.m01+e,r[a.Y2]=s[a.X2]*n.m10+s[a.Y2]*n.m11+i,r[a.X3]=s[a.X3]*n.m00+s[a.Y3]*n.m01+e,r[a.Y3]=s[a.X3]*n.m10+s[a.Y3]*n.m11+i,r[a.X4]=s[a.X4]*n.m00+s[a.Y4]*n.m01+e,r[a.Y4]=s[a.X4]*n.m10+s[a.Y4]*n.m11+i},updateWorldTransform:function(){this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton.setSlotsToSetupPose()},findBone:function(t){return this._skeleton.findBone(t)},findSlot:function(t){return this._skeleton.findSlot(t)},setSkin:function(t){return this._skeleton.setSkinByName(t)},getAttachment:function(t,e){return this._skeleton.getAttachmentBySlotName(t,e)},setAttachment:function(t,e){this._skeleton.setAttachment(t,e)},setOpacityModifyRGB:function(t){this._premultipliedAlpha=t},isOpacityModifyRGB:function(){return this._premultipliedAlpha},setSkeletonData:function(t,e){null!=t.width&&null!=t.height&&this.setContentSize(t.width/n.director.getContentScaleFactor(),t.height/n.director.getContentScaleFactor()),this._skeleton=new p.Skeleton(t),this._skeleton.updateWorldTransform(),this._rootBone=this._skeleton.getRootBone(),this._ownsSkeletonData=e,this._renderCmd._createChildFormSkeletonData()},getTextureAtlas:function(t){return t.rendererObject.page.rendererObject},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e)},update:function(t){this._skeleton.update(t)}}),o.Skeleton.create=function(t,e,i){return new o.Skeleton(t,e,i)},function(){o.Skeleton.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0};var t=o.Skeleton.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=o.Skeleton.CanvasRenderCmd,t.rendering=function(t,e,i){var r,s,a,c,h=this._node;t=t||n._renderContext;var l=h._skeleton,d=l.drawOrder;for(r=0,s=d.length;s>r;r++)a=d[r],c=a._slotNode,c._visible&&c._renderCmd&&a.currentSprite&&(c._renderCmd.transform(this,!0),a.currentSprite._renderCmd.rendering(t,e,i),c._renderCmd._dirtyFlag=a.currentSprite._renderCmd._dirtyFlag=0);if(h._debugSlots||h._debugBones){t.setTransform(this._worldTransform,e,i),t.setGlobalAlpha(1);var u,_=n._drawingUtil;if(h._debugSlots){_.setDrawColor(0,0,255,255),_.setLineWidth(1);var f=[];for(r=0,s=l.slots.length;s>r;r++)a=l.drawOrder[r],a.attachment&&a.attachment.type==o.ATTACHMENT_TYPE.REGION&&(u=a.attachment,this._updateRegionAttachmentSlot(u,a,f),_.drawPoly(f,4,!0))}if(h._debugBones){var p;for(_.setLineWidth(2),_.setDrawColor(255,0,0,255),r=0,s=l.bones.length;s>r;r++){p=l.bones[r];var g=p.data.length*p.m00+p.worldX,m=p.data.length*p.m10+p.worldY;_.drawLine({x:p.worldX,y:p.worldY},{x:g,y:m})}for(_.setPointSize(4),_.setDrawColor(0,0,255,255),r=0,s=l.bones.length;s>r;r++)p=l.bones[r],_.drawPoint({x:p.worldX,y:p.worldY}),0===r&&_.setDrawColor(0,255,0,255)}}},t._updateRegionAttachmentSlot=function(t,e,i){if(i){var r={},s=o.VERTEX_INDEX,a=e.bone;t.computeVertices(a.skeleton.x,a.skeleton.y,a,r),i.length=0,i.push(n.p(r[s.X1],r[s.Y1])),i.push(n.p(r[s.X4],r[s.Y4])),i.push(n.p(r[s.X3],r[s.Y3])),i.push(n.p(r[s.X2],r[s.Y2]))}},t._createChildFormSkeletonData=function(){for(var t,e,i=this._node,n=i._skeleton,r=0,s=n.slots.length;s>r;r++){var o=n.slots[r],a=o.attachment,c=new _ccsg.Node;o._slotNode=c,a instanceof p.RegionAttachment?(t=a.rendererObject.name,e=this._createSprite(o,a),o.currentSprite=e,o.currentSpriteName=t,c.addChild(e)):a instanceof p.MeshAttachment}},t._createSprite=function(t,e){var i=e.rendererObject,r=(i.page._texture,new n.Rect(i.x,i.y,i.width,i.height)),s=new n.Sprite;return s.initWithTexture(i.page._texture,r,i.rotate,!1),s._rect.width=e.width,s._rect.height=e.height,s.setContentSize(e.width,e.height),s.setRotation(-e.rotation),s.setScale(i.width/i.originalWidth*e.scaleX,i.height/i.originalHeight*e.scaleY),t.sprites=t.sprites||{},t.sprites[i.name]=s,s},t._updateChild=function(){var t,e,i,r,s,o,a=this._node._skeleton,c=a.slots;for(t=0,e=c.length;e>t;t++)if(r=c[t],s=r.attachment,o=r._slotNode,s){var h=s.type;if(h===p.AttachmentType.region){if(s.rendererObject&&(!r.currentSpriteName||r.currentSpriteName!==s.name)){var l=s.rendererObject.name;if(void 0!==r.currentSprite&&r.currentSprite.setVisible(!1),r.sprites=r.sprites||{},void 0!==r.sprites[l])r.sprites[l].setVisible(!0);else{var d=this._createSprite(r,s);o.addChild(d)}r.currentSprite=r.sprites[l],r.currentSpriteName=l}var u=r.bone;o.setPosition(u.worldX+s.x*u.m00+s.y*u.m01,u.worldY+s.x*u.m10+s.y*u.m11),o.setScale(u.worldScaleX,u.worldScaleY),i=r.currentSprite,i._flippedX=u.worldFlipX,i._flippedY=u.worldFlipY,i._flippedY||i._flippedX?(o.setRotation(u.worldRotation),i.setRotation(s.rotation)):(o.setRotation(-u.worldRotation),i.setRotation(-s.rotation)),i._renderCmd._displayedOpacity=0|a.a*r.a*255;var _=0|a.r*r.r*255,f=0|a.g*r.g*255,g=0|a.b*r.b*255;i.setColor(n.color(_,f,g)),i._renderCmd._updateColor()}else if(h!==p.AttachmentType.skinnedmesh){o.setVisible(!1);continue}o.setVisible(!0)}else o.setVisible(!1)}}(),function(){o.Skeleton.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this.setShaderProgram(n.shaderCache.programForKey(n.SHADER_POSITION_TEXTURECOLOR)),this._tmpQuad=new n.V3F_C4B_T2F_Quad};var t=o.Skeleton.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=o.Skeleton.WebGLRenderCmd,t.rendering=function(t){var e,i,r,s,a,c,h=this._node,l=this._tmpQuad,d=h.getColor(),u=h._skeleton,_=h._blendFunc,f=h._premultipliedAlpha;for(this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),u.r=d.r/255,u.g=d.g/255,u.b=d.b/255,u.a=h.getOpacity()/255,f&&(u.r*=u.a,u.g*=u.a,u.b*=u.a),a=0,c=u.drawOrder.length;c>a;a++)if(s=u.drawOrder[a],s.attachment){switch(r=s.attachment,s.attachment.type){case o.ATTACHMENT_TYPE.REGION:this._updateRegionAttachmentQuad(r,s,l,f);break;case o.ATTACHMENT_TYPE.MESH:this._updateMeshAttachmentQuad(r,s,l,f);break;case o.ATTACHMENT_TYPE.SKINNED_MESH:break;default:continue}var g=h.getTextureAtlas(r);if(s.data.blendMode!=e)switch(i&&(i.drawQuads(),i.removeAllQuads()),e=s.data.blendMode){case p.BlendMode.additive:n.glBlendFunc(f?n.ONE:n.SRC_ALPHA,n.ONE);break;case p.BlendMode.multiply:n.glBlendFunc(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA);break;case p.BlendMode.screen:n.glBlendFunc(n.ONE,n.ONE_MINUS_SRC_COLOR);break;default:n.glBlendFunc(_.src,_.dst)}else g!=i&&i&&(i.drawQuads(),i.removeAllQuads());i=g;var m=i.getTotalQuads();if(i.getCapacity()==m&&(i.drawQuads(),i.removeAllQuads(),!i.resizeCapacity(2*i.getCapacity())))return;i.updateQuad(l,m)}if(i&&(i.drawQuads(),i.removeAllQuads()),h._debugBones||h._debugSlots){n.kmGLMatrixMode(n.KM_GL_MODELVIEW),n.current_stack.stack.push(n.current_stack.top),n.current_stack.top=this._stackMatrix;var y=n._drawingUtil;if(h._debugSlots)for(y.setDrawColor(0,0,255,255),y.setLineWidth(1),a=0,c=u.slots.length;c>a;a++)if(s=u.drawOrder[a],s.attachment&&s.attachment.type==o.ATTACHMENT_TYPE.REGION){r=s.attachment,this._updateRegionAttachmentQuad(r,s,l);var v=[];v.push(n.p(l.bl.vertices.x,l.bl.vertices.y)),v.push(n.p(l.br.vertices.x,l.br.vertices.y)),v.push(n.p(l.tr.vertices.x,l.tr.vertices.y)),v.push(n.p(l.tl.vertices.x,l.tl.vertices.y)),y.drawPoly(v,4,!0)}if(h._debugBones){var T;for(y.setLineWidth(2),y.setDrawColor(255,0,0,255),a=0,c=u.bones.length;c>a;a++){T=u.bones[a];var C=T.data.length*T.m00+T.worldX,S=T.data.length*T.m10+T.worldY;y.drawLine(n.p(T.worldX,T.worldY),n.p(C,S))}for(y.setPointSize(4),y.setDrawColor(0,0,255,255),a=0,c=u.bones.length;c>a;a++)T=u.bones[a],y.drawPoint(n.p(T.worldX,T.worldY)),0==a&&y.setDrawColor(0,255,0,255)}n.kmGLPopMatrix()}},t._createChildFormSkeletonData=function(){},t._updateChild=function(){},t._updateRegionAttachmentQuad=function(t,e,i,n){var r={};t.computeVertices(e.bone.skeleton.x,e.bone.skeleton.y,e.bone,r);var s=e.bone.skeleton.r*e.r*255,a=e.bone.skeleton.g*e.g*255,c=e.bone.skeleton.b*e.b*255,h=e.bone.skeleton.a*e.a;n&&(s*=h,a*=h,c*=h);var l=255*h;i.bl.colors.r=i.tl.colors.r=i.tr.colors.r=i.br.colors.r=s,i.bl.colors.g=i.tl.colors.g=i.tr.colors.g=i.br.colors.g=a,i.bl.colors.b=i.tl.colors.b=i.tr.colors.b=i.br.colors.b=c,i.bl.colors.a=i.tl.colors.a=i.tr.colors.a=i.br.colors.a=l;var d=o.VERTEX_INDEX;i.bl.vertices.x=r[d.X1],i.bl.vertices.y=r[d.Y1],i.tl.vertices.x=r[d.X2],i.tl.vertices.y=r[d.Y2],i.tr.vertices.x=r[d.X3],i.tr.vertices.y=r[d.Y3],i.br.vertices.x=r[d.X4],i.br.vertices.y=r[d.Y4],i.bl.texCoords.u=t.uvs[d.X1],i.bl.texCoords.v=t.uvs[d.Y1],i.tl.texCoords.u=t.uvs[d.X2],i.tl.texCoords.v=t.uvs[d.Y2],i.tr.texCoords.u=t.uvs[d.X3],i.tr.texCoords.v=t.uvs[d.Y3],i.br.texCoords.u=t.uvs[d.X4],i.br.texCoords.v=t.uvs[d.Y4]},t._updateMeshAttachmentQuad=function(t,e,i,n){var r={};t.computeWorldVertices(e.bone.x,e.bone.y,e,r);var s=e.bone.skeleton.r*e.r*255,a=e.bone.skeleton.g*e.g*255,c=e.bone.skeleton.b*e.b*255,h=e.bone.skeleton.a*e.a;n&&(s*=h,a*=h,c*=h);var l=255*h;i.bl.colors.r=i.tl.colors.r=i.tr.colors.r=i.br.colors.r=s,i.bl.colors.g=i.tl.colors.g=i.tr.colors.g=i.br.colors.g=a,i.bl.colors.b=i.tl.colors.b=i.tr.colors.b=i.br.colors.b=c,i.bl.colors.a=i.tl.colors.a=i.tr.colors.a=i.br.colors.a=l;var d=o.VERTEX_INDEX;i.bl.vertices.x=r[d.X1],i.bl.vertices.y=r[d.Y1],i.tl.vertices.x=r[d.X2],i.tl.vertices.y=r[d.Y2],i.tr.vertices.x=r[d.X3],i.tr.vertices.y=r[d.Y3],i.br.vertices.x=r[d.X4],i.br.vertices.y=r[d.Y4],i.bl.texCoords.u=t.uvs[d.X1],i.bl.texCoords.v=t.uvs[d.Y1],i.tl.texCoords.u=t.uvs[d.X2],i.tl.texCoords.v=t.uvs[d.Y2],i.tr.texCoords.u=t.uvs[d.X3],i.tr.texCoords.v=t.uvs[d.Y3],i.br.texCoords.u=t.uvs[d.X4],i.br.texCoords.v=t.uvs[d.Y4]}}(),o._atlasPage_createTexture_webGL=function(t,e){var i=n.textureCache.addImage(e);t.rendererObject=new n.TextureAtlas(i,128),t.width=i.getPixelWidth(),t.height=i.getPixelHeight()},o._atlasPage_createTexture_canvas=function(t,e){t._texture=n.textureCache.addImage(e)},o._atlasPage_disposeTexture=function(t){t.rendererObject.release()},o._atlasLoader={spAtlasFile:null,setAtlasFile:function(t){this.spAtlasFile=t},load:function(t,e,i){var r=n.path.join(n.path.dirname(this.spAtlasFile),e);n._renderType===n.game.RENDER_TYPE_WEBGL?o._atlasPage_createTexture_webGL(t,r):o._atlasPage_createTexture_canvas(t,r)},unload:function(t){}},o.ANIMATION_EVENT_TYPE={START:0,END:1,COMPLETE:2,EVENT:3},o.TrackEntryListeners=function(t,e,i,n){this.startListener=t||null,this.endListener=e||null,this.completeListener=i||null,this.eventListener=n||null},o.TrackEntryListeners.getListeners=function(t){return t.rendererObject||(t.rendererObject=new o.TrackEntryListeners,t.listener=o.trackEntryCallback),t.rendererObject},o.trackEntryCallback=function(t,e,i,n,r){t.rendererObject.onTrackEntryEvent(e,i,n,r)},o.SkeletonAnimation=o.Skeleton.extend({_state:null,_target:null,_callback:null,_ownsAnimationStateData:!1,_startListener:null,_endListener:null,_completeListener:null,_eventListener:null,init:function(){o.Skeleton.prototype.init.call(this),this._ownsAnimationStateData=!0,this.setAnimationStateData(new p.AnimationStateData(this._skeleton.data))},setAnimationStateData:function(t){var e=new p.AnimationState(t);e.rendererObject=this,e.onStart=this._onAnimationStateStart.bind(this),e.onComplete=this._onAnimationStateComplete.bind(this),e.onEnd=this._onAnimationStateEnd.bind(this),e.onEvent=this._onAnimationStateEvent.bind(this),this._state=e},setMix:function(t,e,i){this._state.data.setMixByName(t,e,i)},setAnimationListener:function(t,e){this._target=t,this._callback=e},setAnimation:function(t,e,i){var r=this._skeleton.data.findAnimation(e);return r?this._state.setAnimation(t,r,i):(n.log("Spine: Animation not found: "+e),null)},addAnimation:function(t,e,i,r){r=null==r?0:r;var s=this._skeleton.data.findAnimation(e);return s?this._state.addAnimation(t,s,i,r):(n.log("Spine: Animation not found:"+e),null)},getCurrent:function(t){return this._state.getCurrent(t)},clearTracks:function(){this._state.clearTracks()},clearTrack:function(t){this._state.clearTrack(t)},update:function(t){this._super(t),t*=this._timeScale,this._state.update(t),this._state.apply(this._skeleton),this._skeleton.updateWorldTransform(),this._renderCmd._updateChild()},setStartListener:function(t){this._startListener=t},setEndListener:function(t){this._endListener=t},setCompleteListener:function(t){this._completeListener=t},setEventListener:function(t){this._eventListener=t},setTrackStartListener:function(t,e){o.TrackEntryListeners.getListeners(t).startListener=e},setTrackEndListener:function(t,e){o.TrackEntryListeners.getListeners(t).endListener=e},setTrackCompleteListener:function(t,e){o.TrackEntryListeners.getListeners(t).completeListener=e},setTrackEventListener:function(t,e){o.TrackEntryListeners.getListeners(t).eventListener=e},onTrackEntryEvent:function(t,e,i,n){var r=this._state.getCurrent(t);if(r.rendererObject){var s=r.rendererObject;switch(e){case o.ANIMATION_EVENT_TYPE.START:s.startListener&&s.startListener(t);break;case o.ANIMATION_EVENT_TYPE.END:s.endListener&&s.endListener(t);break;case o.ANIMATION_EVENT_TYPE.COMPLETE:s.completeListener&&s.completeListener(t,n);break;case o.ANIMATION_EVENT_TYPE.EVENT:s.eventListener&&s.eventListener(t,i)}}},onAnimationStateEvent:function(t,e,i,n){switch(e){case o.ANIMATION_EVENT_TYPE.START:this._startListener&&this._startListener(t);break;case o.ANIMATION_EVENT_TYPE.END:this._endListener&&this._endListener(t);break;case o.ANIMATION_EVENT_TYPE.COMPLETE:this._completeListener&&this._completeListener(t,n);break;case o.ANIMATION_EVENT_TYPE.EVENT:this._eventListener&&this._eventListener(t,i)}},getState:function(){return this._state},_onAnimationStateStart:function(t){this._animationStateCallback(t,o.ANIMATION_EVENT_TYPE.START,null,0)},_onAnimationStateEnd:function(t){this._animationStateCallback(t,o.ANIMATION_EVENT_TYPE.END,null,0)},_onAnimationStateComplete:function(t,e){this._animationStateCallback(t,o.ANIMATION_EVENT_TYPE.COMPLETE,null,e)},_onAnimationStateEvent:function(t,e){this._animationStateCallback(t,o.ANIMATION_EVENT_TYPE.EVENT,e,0)},_animationStateCallback:function(t,e,i,n){this.onAnimationStateEvent(t,e,i,n),this._target&&this._callback&&this._callback.call(this._target,this,t,e,i,n)}}),o.SkeletonAnimation.create=function(t,e,i){return new o.SkeletonAnimation(t,e,i)},n.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var e=void 0===t._running?!1:!t._running;n.director.getScheduler().schedule(this._releaseCB,t,0,0,0,e)},putInPool:function(t){var e=n.js._getClassId(t.constructor);e&&(this._pool[e]||(this._pool[e]=[]),t.retain&&t.retain(),t.unuse&&t.unuse(),this._pool[e].push(t))},hasObject:function(t){var e=n.js._getClassId(t),i=this._pool[e];return i&&0!==i.length?!0:!1},removeObject:function(t){var e=n.js._getClassId(t.constructor);if(e){var i=this._pool[e];if(i)for(var r=0;r<i.length;r++)t===i[r]&&(t.release&&t.release(),i.splice(r,1))}},getFromPool:function(t){if(this.hasObject(t)){var e=n.js._getClassId(t),i=this._pool[e],r=Array.prototype.slice.call(arguments);r.shift();var s=i.pop();return s.reuse&&s.reuse.apply(s,r),n.sys.isNative&&s.release&&this._autoRelease(s),s}},drainAllPools:function(){for(var t in this._pool)for(var e=0;e<this._pool[t].length;e++){var i=this._pool[t][e];i.release&&i.release()}this._pool={}}},n.__convertVerts=function(t){for(var e=[],i=0;i<t.length/2;i++)e[i]={x:t[2*i],y:t[2*i+1]};return e},n.ColorForBody=function(t){return t.isRogue()||t.isSleeping()?n.color(128,128,128,128):t.nodeIdleTime>t.space.sleepTimeThreshold?n.color(84,84,84,128):n.color(255,0,0,128)},n.DrawShape=function(t,e){var i=t.body,r=n.ColorForBody(i);switch(t.collisionCode){case a.CircleShape.prototype.collisionCode:this.drawDot(t.tc,Math.max(t.r,1),r),this.drawSegment(t.tc,a.v.add(t.tc,a.v.mult(i.rot,t.r)),1,r);break;case a.SegmentShape.prototype.collisionCode:this.drawSegment(t.ta,t.tb,Math.max(t.r,2),r);break;case a.PolyShape.prototype.collisionCode:var s=n.color(r.r,r.g,r.b,n.lerp(r.a,255,.5));this.drawPoly(n.__convertVerts(t.tVerts),r,1,s);break;default:n.log("cc.DrawShape(): Bad assertion in DrawShape()")}},n.DrawConstraint=function(t,e){var i,r,s=t.a,o=t.b;if(t instanceof a.PinJoint)i=s.local2World(t.anchr1),r=o.local2World(t.anchr2),this.drawDot(i,3,n.CONSTRAINT_COLOR),this.drawDot(r,3,n.CONSTRAINT_COLOR),this.drawSegment(i,r,1,n.CONSTRAINT_COLOR);else if(t instanceof a.SlideJoint)i=s.local2World(t.anchr1),r=o.local2World(t.anchr2),this.drawDot(i,3,n.CONSTRAINT_COLOR),this.drawDot(r,3,n.CONSTRAINT_COLOR),this.drawSegment(i,r,1,n.CONSTRAINT_COLOR);else if(t instanceof a.PivotJoint)i=s.local2World(t.anchr1),r=o.local2World(t.anchr2),this.drawDot(i,3,n.CONSTRAINT_COLOR),this.drawDot(r,3,n.CONSTRAINT_COLOR);else if(t instanceof a.GrooveJoint){i=s.local2World(t.grv_a),r=s.local2World(t.grv_b);var c=o.local2World(t.anchr2);this.drawDot(c,3,n.CONSTRAINT_COLOR),this.drawSegment(i,r,1,n.CONSTRAINT_COLOR)}else t instanceof a.DampedSpring},n.CONSTRAINT_COLOR=n.color(0,255,0,128),n.PhysicsDebugNode=n.DrawNode.extend({_space:null,_className:"PhysicsDebugNode",ctor:function(t){n.DrawNode.prototype.ctor.call(this),this._space=t},getSpace:function(){return this._space},setSpace:function(t){this._space=t},draw:function(t){this._space&&(this._space.eachShape(n.DrawShape.bind(this)),this._space.eachConstraint(n.DrawConstraint.bind(this)),n.DrawNode.prototype.draw.call(this),this.clear())},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.PhysicsDebugNode.CanvasRenderCmd(this):new n.PhysicsDebugNode.WebGLRenderCmd(this)}}),n.PhysicsDebugNode.create=function(t){return new n.PhysicsDebugNode(t)},function(){n.PhysicsDebugNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._buffer=t._buffer,this._needDraw=!0};var t=n.PhysicsDebugNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.PhysicsDebugNode.CanvasRenderCmd,t.rendering=function(t,e,i){var r=this._node;r._space&&(r._space.eachShape(n.DrawShape.bind(r)),r._space.eachConstraint(n.DrawConstraint.bind(r)),n.DrawNode.CanvasRenderCmd.prototype.rendering.call(this,t,e,i),r.clear())},t._drawDot=n.DrawNode.CanvasRenderCmd.prototype._drawDot,t._drawSegment=n.DrawNode.CanvasRenderCmd.prototype._drawSegment,t._drawPoly=n.DrawNode.CanvasRenderCmd.prototype._drawPoly}(),function(){n.PhysicsDebugNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0},n.PhysicsDebugNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),n.PhysicsDebugNode.WebGLRenderCmd.prototype.constructor=n.PhysicsDebugNode.WebGLRenderCmd,n.PhysicsDebugNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;e._space&&(e._space.eachShape(n.DrawShape.bind(e)),e._space.eachConstraint(n.DrawConstraint.bind(e)),n.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),e._render(),e.clear())}}(),function(){Object.create=Object.create||function(t){function e(){}return e.prototype=t,new e};var t,e,i=function(t,e){if(!t)throw new Error("Assertion failed: "+e)},n=function(t,e){!t&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+e),console.trace&&console.trace())},r=function(t,e){return e>t?t:e},s=function(t,e){return t>e?t:e};"object"==typeof window&&window.navigator.userAgent.indexOf("Firefox")>-1?(t=Math.min,e=Math.max):(t=r,e=s);var o=function(t,e){return e>t?t+" "+e:e+" "+t},c=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return t[i]=t[t.length-1],void t.length--},h=function(t,e,i){var n=b(e,i),r=g(v(n,b(t,i))/F(n));return E(i,A(n,r))},l=function(t,e,i,n,r,s){var o=i-r,a=n-s,c=g(T(o,a,t-r,e-s)/N(o,a));return new m(r+o*c,s+a*c)};a.momentForCircle=function(t,e,i,n){return t*(.5*(e*e+i*i)+F(n))},a.areaForCircle=function(t,e){return Math.PI*Math.abs(t*t-e*e)},a.momentForSegment=function(t,e,i){var n=A(E(e,i),.5);return t*(V(i,e)/12+F(n))},a.areaForSegment=function(t,e,i){return i*(Math.PI*i+2*z(t,e))},a.momentForPoly=function(t,e,i){for(var n=0,r=0,s=e.length,o=0;s>o;o+=2){var a=e[o]+i.x,c=e[o+1]+i.y,h=e[(o+2)%s]+i.x,l=e[(o+3)%s]+i.y,d=I(h,l,a,c),u=T(a,c,a,c)+T(a,c,h,l)+T(h,l,h,l);n+=d*u,r+=d}return t*n/(6*r)},a.areaForPoly=function(t){for(var e=0,i=0,n=t.length;n>i;i+=2)e+=R(new m(t[i],t[i+1]),new m(t[(i+2)%n],t[(i+3)%n]));return-e/2},a.centroidForPoly=function(t){for(var e=0,i=new m(0,0),n=0,r=t.length;r>n;n+=2){var s=new m(t[n],t[n+1]),o=new m(t[(n+2)%r],t[(n+3)%r]),a=R(s,o);e+=a,i=E(i,A(E(s,o),a))}return A(i,1/(3*e))},a.recenterPoly=function(t){for(var e=a.centroidForPoly(t),i=0;i<t.length;i+=2)t[i]-=e.x,t[i+1]-=e.y},a.momentForBox=function(t,e,i){return t*(e*e+i*i)/12},a.momentForBox2=function(t,e){var i=e.r-e.l,n=e.t-e.b,r=A([e.l+e.r,e.b+e.t],.5);return a.momentForBox(t,i,n)+t*F(r)};var d=a.loopIndexes=function(t){var e,i,n,r,s=0,o=0;e=n=t[0],i=r=t[1];for(var a=t.length>>1,c=1;a>c;c++){var h=t[2*c],l=t[2*c+1];e>h||h==e&&i>l?(e=h,i=l,s=c):(h>n||h==n&&l>r)&&(n=h,r=l,o=c)}return[s,o]},u=function(t,e,i){var n=t[2*e];t[2*e]=t[2*i],t[2*i]=n,n=t[2*e+1],t[2*e+1]=t[2*i+1],t[2*i+1]=n},_=function(t,e,i,n,r,s){if(0===i)return 0;for(var o=0,a=e,c=b(r,n),h=s*C(c),l=e,d=e+i-1;d>=l;){var _=new m(t[2*l],t[2*l+1]),f=R(c,b(_,n));f>h?(f>o&&(o=f,a=l),l++):(u(t,l,d),d--)}return a!=e&&u(t,e,a),l-e},f=function(t,e,i,n,r,s,o,a){if(0>n)return 0;if(0==n)return e[2*a]=s.x,e[2*a+1]=s.y,1;var c=_(e,i,n,r,s,t),h=new m(e[2*i],e[2*i+1]),l=f(t,e,i+1,c-1,r,h,s,a),d=a+l++;e[2*d]=s.x,e[2*d+1]=s.y;var u=_(e,i+c,n-c,s,o,t),p=new m(e[2*(i+c)],e[2*(i+c)+1]);

return l+f(t,e,i+c+1,u-1,s,p,o,a+l)};a.convexHull=function(t,e,i){if(e)for(var r=0;r<t.length;r++)e[r]=t[r];else e=t;var s=d(t),o=s[0],a=s[1];if(o==a)return e.length=2,e;u(e,0,o),u(e,1,0==a?o:a);var c=new m(e[0],e[1]),h=new m(e[2],e[3]),l=t.length>>1,_=f(i,e,2,l-2,c,h,c,1)+1;return e.length=2*_,n(tt(e),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),e};var p=function(i,n,r){return t(e(i,n),r)},g=function(i){return e(0,t(i,1))},m=a.Vect=function(t,e){this.x=t,this.y=e};a.v=function(t,e){return new m(t,e)};var y=a.vzero=new m(0,0),v=a.v.dot=function(t,e){return t.x*e.x+t.y*e.y},T=function(t,e,i,n){return t*i+e*n},C=a.v.len=function(t){return Math.sqrt(v(t,t))},S=a.v.len2=function(t,e){return Math.sqrt(t*t+e*e)},E=(a.v.eql=function(t,e){return t.x===e.x&&t.y===e.y},a.v.add=function(t,e){return new m(t.x+e.x,t.y+e.y)});m.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};var b=a.v.sub=function(t,e){return new m(t.x-e.x,t.y-e.y)};m.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};var x=a.v.neg=function(t){return new m(-t.x,-t.y)};m.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var A=a.v.mult=function(t,e){return new m(t.x*e,t.y*e)};m.prototype.mult=function(t){return this.x*=t,this.y*=t,this};var R=a.v.cross=function(t,e){return t.x*e.y-t.y*e.x},I=function(t,e,i,n){return t*n-e*i},P=a.v.perp=function(t){return new m(-t.y,t.x)},L=(a.v.pvrperp=function(t){return new m(t.y,-t.x)},a.v.project=function(t,e){return A(e,v(t,e)/F(e))});m.prototype.project=function(t){return this.mult(v(this,t)/F(t)),this};var w=a.v.rotate=function(t,e){return new m(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};m.prototype.rotate=function(t){return this.x=this.x*t.x-this.y*t.y,this.y=this.x*t.y+this.y*t.x,this};var O=a.v.unrotate=function(t,e){return new m(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},F=a.v.lengthsq=function(t){return v(t,t)},N=a.v.lengthsq2=function(t,e){return t*t+e*e},D=a.v.lerp=function(t,e,i){return E(A(t,1-i),A(e,i))},B=a.v.normalize=function(t){return A(t,1/C(t))},M=a.v.normalize_safe=function(t){return 0===t.x&&0===t.y?y:B(t)},W=a.v.clamp=function(t,e){return v(t,t)>e*e?A(B(t),e):t},z=(a.v.lerpconst=function(t,e,i){return E(t,W(b(e,t),i))},a.v.dist=function(t,e){return C(b(t,e))}),V=a.v.distsq=function(t,e){return F(b(t,e))},k=(a.v.near=function(t,e,i){return V(t,e)<i*i},a.v.slerp=function(t,e,i){var n=Math.acos(v(t,e));if(n){var r=1/Math.sin(n);return E(A(t,Math.sin((1-i)*n)*r),A(e,Math.sin(i*n)*r))}return t}),G=(a.v.slerpconst=function(e,i,n){var r=Math.acos(v(e,i));return k(e,i,t(n,r)/r)},a.v.forangle=function(t){return new m(Math.cos(t),Math.sin(t))},a.v.toangle=function(t){return Math.atan2(t.y,t.x)},a.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"},0),U=a.BB=function(t,e,i,n){this.l=t,this.b=e,this.r=i,this.t=n,G++};a.bb=function(t,e,i,n){return new U(t,e,i,n)};var X=function(t,e){return new U(t.x-e,t.y-e,t.x+e,t.y+e)},Y=function(t,e,i,n,r){return t.l<=n&&e<=t.r&&t.b<=r&&i<=t.t},H=0,j=(a.NO_GROUP=0,a.ALL_LAYERS=-1);a.resetShapeIdCounter=function(){H=0};var Q=a.Shape=function(t){this.body=t,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=H++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=y,this.collision_type=0,this.group=0,this.layers=j,this.space=null,this.collisionCode=this.collisionCode};Q.prototype.setElasticity=function(t){this.e=t},Q.prototype.setFriction=function(t){this.body.activate(),this.u=t},Q.prototype.setLayers=function(t){this.body.activate(),this.layers=t},Q.prototype.setSensor=function(t){this.body.activate(),this.sensor=t},Q.prototype.setCollisionType=function(t){this.body.activate(),this.collision_type=t},Q.prototype.getBody=function(){return this.body},Q.prototype.active=function(){return this.body&&-1!==this.body.shapeList.indexOf(this)},Q.prototype.setBody=function(t){i(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=t},Q.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},Q.prototype.update=function(t,e){i(!isNaN(e.x),"Rotation is NaN"),i(!isNaN(t.x),"Position is NaN"),this.cacheData(t,e)},Q.prototype.pointQuery=function(t){var e=this.nearestPointQuery(t);return e.d<0?e:void 0},Q.prototype.getBB=function(){return new U(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var Z=function(t,e,i){this.shape=t,this.p=e,this.d=i},q=function(t,e,i){this.shape=t,this.t=e,this.n=i};q.prototype.hitPoint=function(t,e){return D(t,e,this.t)},q.prototype.hitDist=function(t,e){return z(t,e)*this.t};var K=a.CircleShape=function(t,e,i){this.c=this.tc=i,this.r=e,this.type="circle",Q.call(this,t)};K.prototype=Object.create(Q.prototype),K.prototype.cacheData=function(t,e){var i=this.tc=w(this.c,e).add(t),n=this.r;this.bb_l=i.x-n,this.bb_b=i.y-n,this.bb_r=i.x+n,this.bb_t=i.y+n},K.prototype.nearestPointQuery=function(t){var e=t.x-this.tc.x,i=t.y-this.tc.y,n=S(e,i),r=this.r,s=new m(this.tc.x+e*r/n,this.tc.y+i*r/n);return new Z(this,s,n-r)};var J=function(t,e,i,n,r,s){n=b(n,e),r=b(r,e);var o=v(n,n)-2*v(n,r)+v(r,r),a=-2*v(n,n)+2*v(n,r),c=v(n,n)-i*i,h=a*a-4*o*c;if(h>=0){var l=(-a-Math.sqrt(h))/(2*o);if(l>=0&&1>=l)return new q(t,l,B(D(n,r,l)))}};K.prototype.segmentQuery=function(t,e){return J(this,this.tc,this.r,t,e)};var $=a.SegmentShape=function(t,e,i,n){this.a=e,this.b=i,this.n=P(B(b(i,e))),this.ta=this.tb=this.tn=null,this.r=n,this.a_tangent=y,this.b_tangent=y,this.type="segment",Q.call(this,t)};$.prototype=Object.create(Q.prototype),$.prototype.cacheData=function(t,e){this.ta=E(t,w(this.a,e)),this.tb=E(t,w(this.b,e)),this.tn=w(this.n,e);var i,n,r,s;this.ta.x<this.tb.x?(i=this.ta.x,n=this.tb.x):(i=this.tb.x,n=this.ta.x),this.ta.y<this.tb.y?(r=this.ta.y,s=this.tb.y):(r=this.tb.y,s=this.ta.y);var o=this.r;this.bb_l=i-o,this.bb_b=r-o,this.bb_r=n+o,this.bb_t=s+o},$.prototype.nearestPointQuery=function(t){var e=h(t,this.ta,this.tb),i=t.x-e.x,n=t.y-e.y,r=S(i,n),s=this.r,o=r?E(e,A(new m(i,n),s/r)):e;return new Z(this,o,r-s)},$.prototype.segmentQuery=function(t,e){var i=this.tn,n=v(b(this.ta,t),i),r=this.r,s=n>0?x(i):i,o=b(A(s,r),t),a=E(this.ta,o),c=E(this.tb,o),h=b(e,t);if(R(h,a)*R(h,c)<=0){var l=n+(n>0?-r:r),d=-l,u=v(h,i)-l;if(0>d*u)return new q(this,d/(d-u),s)}else if(0!==r){var _=J(this,this.ta,this.r,t,e),f=J(this,this.tb,this.r,t,e);return _?f&&f.t<_.t?f:_:f}},$.prototype.setNeighbors=function(t,e){this.a_tangent=b(t,this.a),this.b_tangent=b(e,this.b)},$.prototype.setEndpoints=function(t,e){this.a=t,this.b=e,this.n=P(B(b(e,t)))};var tt=function(t){for(var e=t.length,i=0;e>i;i+=2){var n=t[i],r=t[i+1],s=t[(i+2)%e],o=t[(i+3)%e],a=t[(i+4)%e],c=t[(i+5)%e];if(I(s-n,o-r,a-s,c-o)>0)return!1}return!0},et=a.PolyShape=function(t,e,i){this.setVerts(e,i),this.type="poly",Q.call(this,t)};et.prototype=Object.create(Q.prototype);var it=function(t,e){this.n=t,this.d=e};it.prototype.compare=function(t){return v(this.n,t)-this.d},et.prototype.setVerts=function(t,e){i(t.length>=4,"Polygons require some verts"),i("number"==typeof t[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),i(tt(t),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var n=t.length,r=n>>1;this.verts=new Array(n),this.tVerts=new Array(n),this.planes=new Array(r),this.tPlanes=new Array(r);for(var s=0;n>s;s+=2){var o=t[s]+e.x,a=t[s+1]+e.y,c=t[(s+2)%n]+e.x,h=t[(s+3)%n]+e.y,l=B(P(new m(c-o,h-a)));this.verts[s]=o,this.verts[s+1]=a,this.planes[s>>1]=new it(l,T(l.x,l.y,o,a)),this.tPlanes[s>>1]=new it(new m(0,0),0)}};var nt=(a.BoxShape=function(t,e,i){var n=e/2,r=i/2;return nt(t,new U(-n,-r,n,r))},a.BoxShape2=function(t,e){var i=[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b];return new et(t,i,y)});et.prototype.transformVerts=function(i,n){for(var r=this.verts,s=this.tVerts,o=1/0,a=-(1/0),c=1/0,h=-(1/0),l=0;l<r.length;l+=2){var d=r[l],u=r[l+1],_=i.x+d*n.x-u*n.y,f=i.y+d*n.y+u*n.x;s[l]=_,s[l+1]=f,o=t(o,_),a=e(a,_),c=t(c,f),h=e(h,f)}this.bb_l=o,this.bb_b=c,this.bb_r=a,this.bb_t=h},et.prototype.transformAxes=function(t,e){for(var i=this.planes,n=this.tPlanes,r=0;r<i.length;r++){var s=w(i[r].n,e);n[r].n=s,n[r].d=v(t,s)+i[r].d}},et.prototype.cacheData=function(t,e){this.transformAxes(t,e),this.transformVerts(t,e)},et.prototype.nearestPointQuery=function(t){for(var e=this.tPlanes,i=this.tVerts,n=i[i.length-2],r=i[i.length-1],s=1/0,o=y,a=!1,c=0;c<e.length;c++){e[c].compare(t)>0&&(a=!0);var h=i[2*c],d=i[2*c+1],u=l(t.x,t.y,n,r,h,d),_=z(t,u);s>_&&(s=_,o=u),n=h,r=d}return new Z(this,o,a?s:-s)},et.prototype.segmentQuery=function(t,e){for(var i=this.tPlanes,n=this.tVerts,r=i.length,s=2*r,o=0;r>o;o++){var a=i[o].n,c=v(t,a);if(!(i[o].d>c)){var h=v(e,a),l=(i[o].d-c)/(h-c);if(!(0>l||l>1)){var d=D(t,e,l),u=-R(a,d),_=-I(a.x,a.y,n[2*o],n[2*o+1]),f=-I(a.x,a.y,n[(2*o+2)%s],n[(2*o+3)%s]);if(u>=_&&f>=u)return new q(this,l,a)}}}},et.prototype.valueOnAxis=function(e,i){for(var n=this.tVerts,r=T(e.x,e.y,n[0],n[1]),s=2;s<n.length;s+=2)r=t(r,T(e.x,e.y,n[s],n[s+1]));return r-i},et.prototype.containsVert=function(t,e){for(var i=this.tPlanes,n=0;n<i.length;n++){var r=i[n].n,s=T(r.x,r.y,t,e)-i[n].d;if(s>0)return!1}return!0},et.prototype.containsVertPartial=function(t,e,i){for(var n=this.tPlanes,r=0;r<n.length;r++){var s=n[r].n;if(!(v(s,i)<0)){var o=T(s.x,s.y,t,e)-n[r].d;if(o>0)return!1}}return!0},et.prototype.getNumVerts=function(){return this.verts.length/2},et.prototype.getVert=function(t){return new m(this.verts[2*t],this.verts[2*t+1])};var rt=a.Body=function(t,e){this.p=new m(0,0),this.vx=this.vy=0,this.f=new m(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(t),this.setMoment(e),this.rot=new m(0,0),this.setAngle(0)},st=function(){var t=new rt(1/0,1/0);return t.nodeIdleTime=1/0,t};if(a.StaticBody=st,"undefined"!=typeof DEBUG&&DEBUG){var ot=function(t,e){i(t.x==t.x&&t.y==t.y,e)},at=function(t,e){i(Math.abs(t.x)!==1/0&&Math.abs(t.y)!==1/0,e)},ct=function(t,e){ot(t,e),at(t,e)};rt.prototype.sanityCheck=function(){i(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),i(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid."),ct(this.p,"Body's position is invalid."),ct(this.f,"Body's force is invalid."),i(this.vx===this.vx&&Math.abs(this.vx)!==1/0,"Body's velocity is invalid."),i(this.vy===this.vy&&Math.abs(this.vy)!==1/0,"Body's velocity is invalid."),i(this.a===this.a&&Math.abs(this.a)!==1/0,"Body's angle is invalid."),i(this.w===this.w&&Math.abs(this.w)!==1/0,"Body's angular velocity is invalid."),i(this.t===this.t&&Math.abs(this.t)!==1/0,"Body's torque is invalid."),ct(this.rot,"Body's rotation vector is invalid."),i(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),i(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else rt.prototype.sanityCheck=function(){};rt.prototype.getPos=function(){return this.p},rt.prototype.getVel=function(){return new m(this.vx,this.vy)},rt.prototype.getAngVel=function(){return this.w},rt.prototype.isSleeping=function(){return null!==this.nodeRoot},rt.prototype.isStatic=function(){return this.nodeIdleTime===1/0},rt.prototype.isRogue=function(){return null===this.space},rt.prototype.setMass=function(t){i(t>0,"Mass must be positive and non-zero."),this.activate(),this.m=t,this.m_inv=1/t},rt.prototype.setMoment=function(t){i(t>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=t,this.i_inv=1/t},rt.prototype.addShape=function(t){this.shapeList.push(t)},rt.prototype.removeShape=function(t){c(this.shapeList,t)};var ht=function(t,e,i){return t===i?t.next(e):(t.a===e?t.next_a=ht(t.next_a,e,i):t.next_b=ht(t.next_b,e,i),t)};rt.prototype.removeConstraint=function(t){this.constraintList=ht(this.constraintList,this,t)},rt.prototype.setPos=function(t){this.activate(),this.sanityCheck(),t===y&&(t=a.v(0,0)),this.p=t},rt.prototype.setVel=function(t){this.activate(),this.vx=t.x,this.vy=t.y},rt.prototype.setAngVel=function(t){this.activate(),this.w=t},rt.prototype.setAngleInternal=function(t){i(!isNaN(t),"Internal Error: Attempting to set body's angle to NaN"),this.a=t,this.rot.x=Math.cos(t),this.rot.y=Math.sin(t)},rt.prototype.setAngle=function(t){this.activate(),this.sanityCheck(),this.setAngleInternal(t)},rt.prototype.velocity_func=function(t,e,i){var n=this.vx*e+(t.x+this.f.x*this.m_inv)*i,r=this.vy*e+(t.y+this.f.y*this.m_inv)*i,s=this.v_limit,o=n*n+r*r,a=o>s*s?s/Math.sqrt(o):1;this.vx=n*a,this.vy=r*a;var c=this.w_limit;this.w=p(this.w*e+this.t*this.i_inv*i,-c,c),this.sanityCheck()},rt.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t,this.p.y+=(this.vy+this.v_biasy)*t,this.setAngleInternal(this.a+(this.w+this.w_bias)*t),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},rt.prototype.resetForces=function(){this.activate(),this.f=new m(0,0),this.t=0},rt.prototype.applyForce=function(t,e){this.activate(),this.f=E(this.f,t),this.t+=R(e,t)},rt.prototype.applyImpulse=function(t,e){this.activate(),de(this,t.x,t.y,e)},rt.prototype.getVelAtPoint=function(t){return E(new m(this.vx,this.vy),A(P(t),this.w))},rt.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(b(t,this.p))},rt.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(w(t,this.rot))},rt.prototype.eachShape=function(t){for(var e=0,i=this.shapeList.length;i>e;e++)t(this.shapeList[e])},rt.prototype.eachConstraint=function(t){for(var e=this.constraintList;e;){var i=e.next(this);t(e),e=i}},rt.prototype.eachArbiter=function(t){for(var e=this.arbiterList;e;){var i=e.next(this);e.swappedColl=this===e.body_b,t(e),e=i}},rt.prototype.local2World=function(t){return E(this.p,w(t,this.rot))},rt.prototype.world2Local=function(t){return O(b(t,this.p),this.rot)},rt.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy,e=this.w*this.w;return(t?t*this.m:0)+(e?e*this.i:0)};var lt=a.SpatialIndex=function(t){if(this.staticIndex=t,t){if(t.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");t.dynamicIndex=this}};lt.prototype.collideStatic=function(t,e){if(t.count>0){var i=t.query;this.each(function(t){i(t,new U(t.bb_l,t.bb_b,t.bb_r,t.bb_t),e)})}};var dt=a.BBTree=function(t){lt.call(this,t),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};dt.prototype=Object.create(lt.prototype);var ut=0,_t=function(i,n,r){this.obj=null,this.bb_l=t(n.bb_l,r.bb_l),this.bb_b=t(n.bb_b,r.bb_b),this.bb_r=e(n.bb_r,r.bb_r),this.bb_t=e(n.bb_t,r.bb_t),this.parent=null,this.setA(n),this.setB(r)};dt.prototype.makeNode=function(t,e){var i=this.pooledNodes;return i?(this.pooledNodes=i.parent,i.constructor(this,t,e),i):(ut++,new _t(this,t,e))};var ft=0,pt=function(t,e){this.obj=e,t.getBB(e,this),this.parent=null,this.stamp=1,this.pairs=null,ft++};dt.prototype.getBB=function(i,n){var r=this.velocityFunc;if(r){var s=.1,o=(i.bb_r-i.bb_l)*s,a=(i.bb_t-i.bb_b)*s,c=A(r(i),.1);n.bb_l=i.bb_l+t(-o,c.x),n.bb_b=i.bb_b+t(-a,c.y),n.bb_r=i.bb_r+e(o,c.x),n.bb_t=i.bb_t+e(a,c.y)}else n.bb_l=i.bb_l,n.bb_b=i.bb_b,n.bb_r=i.bb_r,n.bb_t=i.bb_t},dt.prototype.getStamp=function(){var t=this.dynamicIndex;return t&&t.stamp?t.stamp:this.stamp},dt.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var gt=0,mt=function(t,e,i,n){this.prevA=null,this.leafA=t,this.nextA=e,this.prevB=null,this.leafB=i,this.nextB=n};dt.prototype.makePair=function(t,e,i,n){var r=this.pooledPairs;return r?(this.pooledPairs=r.prevA,r.prevA=null,r.leafA=t,r.nextA=e,r.prevB=null,r.leafB=i,r.nextB=n,r):(gt++,new mt(t,e,i,n))},mt.prototype.recycle=function(t){this.prevA=t.pooledPairs,t.pooledPairs=this};var yt=function(t,e,i){i&&(i.leafA===e?i.prevA=t:i.prevB=t),t?t.leafA===e?t.nextA=i:t.nextB=i:e.pairs=i};pt.prototype.clearPairs=function(t){var e,i=this.pairs;for(this.pairs=null;i;)i.leafA===this?(e=i.nextA,yt(i.prevB,i.leafB,i.nextB)):(e=i.nextB,yt(i.prevA,i.leafA,i.nextA)),i.recycle(t),i=e};var vt=function(t,e,i){var n=t.pairs,r=e.pairs,s=i.makePair(t,n,e,r);t.pairs=e.pairs=s,n&&(n.leafA===t?n.prevA=s:n.prevB=s),r&&(r.leafA===e?r.prevA=s:r.prevB=s)};_t.prototype.recycle=function(t){this.parent=t.pooledNodes,t.pooledNodes=this},pt.prototype.recycle=function(t){},_t.prototype.setA=function(t){this.A=t,t.parent=this},_t.prototype.setB=function(t){this.B=t,t.parent=this},pt.prototype.isLeaf=!0,_t.prototype.isLeaf=!1,_t.prototype.otherChild=function(t){return this.A==t?this.B:this.A},_t.prototype.replaceChild=function(i,r,s){n(i==this.A||i==this.B,"Node is not a child of parent."),this.A==i?(this.A.recycle(s),this.setA(r)):(this.B.recycle(s),this.setB(r));for(var o=this;o;o=o.parent){var a=o.A,c=o.B;o.bb_l=t(a.bb_l,c.bb_l),o.bb_b=t(a.bb_b,c.bb_b),o.bb_r=e(a.bb_r,c.bb_r),o.bb_t=e(a.bb_t,c.bb_t)}},_t.prototype.bbArea=pt.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var Tt=function(i,n){return(e(i.bb_r,n.bb_r)-t(i.bb_l,n.bb_l))*(e(i.bb_t,n.bb_t)-t(i.bb_b,n.bb_b))},Ct=function(t,e){return Math.abs(t.bb_l+t.bb_r-e.bb_l-e.bb_r)+Math.abs(t.bb_b+t.bb_t-e.bb_b-e.bb_t)},St=function(i,n,r){if(null==i)return n;if(i.isLeaf)return r.makeNode(n,i);var s=i.B.bbArea()+Tt(i.A,n),o=i.A.bbArea()+Tt(i.B,n);return s===o&&(s=Ct(i.A,n),o=Ct(i.B,n)),s>o?i.setB(St(i.B,n,r)):i.setA(St(i.A,n,r)),i.bb_l=t(i.bb_l,n.bb_l),i.bb_b=t(i.bb_b,n.bb_b),i.bb_r=e(i.bb_r,n.bb_r),i.bb_t=e(i.bb_t,n.bb_t),i};_t.prototype.intersectsBB=pt.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var Et=function(t,e,i){t.intersectsBB(e)&&(t.isLeaf?i(t.obj):(Et(t.A,e,i),Et(t.B,e,i)))},bt=function(i,n,r){var s=1/(r.x-n.x),o=i.bb_l==n.x?-(1/0):(i.bb_l-n.x)*s,a=i.bb_r==n.x?1/0:(i.bb_r-n.x)*s,c=t(o,a),h=e(o,a),l=1/(r.y-n.y),d=i.bb_b==n.y?-(1/0):(i.bb_b-n.y)*l,u=i.bb_t==n.y?1/0:(i.bb_t-n.y)*l,_=t(d,u),f=e(d,u);if(h>=_&&f>=c){var p=e(c,_),g=t(h,f);if(g>=0&&1>=p)return e(p,0)}return 1/0},xt=function(e,i,n,r,s){if(e.isLeaf)return s(e.obj);var o=bt(e.A,i,n),a=bt(e.B,i,n);return a>o?(r>o&&(r=t(r,xt(e.A,i,n,r,s))),r>a&&(r=t(r,xt(e.B,i,n,r,s)))):(r>a&&(r=t(r,xt(e.B,i,n,r,s))),r>o&&(r=t(r,xt(e.A,i,n,r,s)))),r};dt.prototype.subtreeRecycle=function(t){t.isLeaf&&(this.subtreeRecycle(t.A),this.subtreeRecycle(t.B),t.recycle(this))};var At=function(t,e,i){if(e==t)return null;var n=e.parent;if(n==t){var r=t.otherChild(e);return r.parent=t.parent,t.recycle(i),r}return n.parent.replaceChild(n,n.otherChild(e),i),t},Rt=function(t,e){return t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t};pt.prototype.markLeafQuery=function(t,e,i,n){Rt(t,this)&&(e?vt(t,this,i):(this.stamp<t.stamp&&vt(this,t,i),n&&n(t.obj,this.obj)))},_t.prototype.markLeafQuery=function(t,e,i,n){Rt(t,this)&&(this.A.markLeafQuery(t,e,i,n),this.B.markLeafQuery(t,e,i,n))},pt.prototype.markSubtree=function(t,e,i){if(this.stamp==t.getStamp()){e&&e.markLeafQuery(this,!1,t,i);for(var n=this;n.parent;n=n.parent)n==n.parent.A?n.parent.B.markLeafQuery(this,!0,t,i):n.parent.A.markLeafQuery(this,!1,t,i)}else for(var r=this.pairs;r;)this===r.leafB?(i&&i(r.leafA.obj,this.obj),r=r.nextB):r=r.nextA},_t.prototype.markSubtree=function(t,e,i){this.A.markSubtree(t,e,i),this.B.markSubtree(t,e,i)},pt.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t},pt.prototype.update=function(t){var e=t.root,i=this.obj;return this.containsObj(i)?!1:(t.getBB(this.obj,this),e=At(e,this,t),t.root=St(e,this,t),this.clearPairs(t),this.stamp=t.getStamp(),!0)},pt.prototype.addPairs=function(t){var e=t.dynamicIndex;if(e){var i=e.root;i&&i.markLeafQuery(this,!0,e,null)}else{var n=t.staticIndex.root;this.markSubtree(t,n,null)}},dt.prototype.insert=function(t,e){var i=new pt(this,t);this.leaves[e]=i,this.root=St(this.root,i,this),this.count++,i.stamp=this.getStamp(),i.addPairs(this),this.incrementStamp()},dt.prototype.remove=function(t,e){var i=this.leaves[e];delete this.leaves[e],this.root=At(this.root,i,this),this.count--,i.clearPairs(this),i.recycle(this)},dt.prototype.contains=function(t,e){return null!=this.leaves[e]};var It=function(t,e){};dt.prototype.reindexQuery=function(t){if(this.root){var e,i=this.leaves;for(e in i)i[e].update(this);var n=this.staticIndex,r=n&&n.root;this.root.markSubtree(this,r,t),n&&!r&&this.collideStatic(this,n,t),this.incrementStamp()}},dt.prototype.reindex=function(){this.reindexQuery(It)},dt.prototype.reindexObject=function(t,e){var i=this.leaves[e];i&&(i.update(this)&&i.addPairs(this),this.incrementStamp())},dt.prototype.pointQuery=function(t,e){this.query(new U(t.x,t.y,t.x,t.y),e)},dt.prototype.segmentQuery=function(t,e,i,n){this.root&&xt(this.root,t,e,i,n)},dt.prototype.query=function(t,e){this.root&&Et(this.root,t,e)},dt.prototype.count=function(){return this.count},dt.prototype.each=function(t){var e;for(e in this.leaves)t(this.leaves[e].obj)};var Pt=function(i,n,r,s,o){return(e(i.bb_r,s)-t(i.bb_l,n))*(e(i.bb_t,o)-t(i.bb_b,r))},Lt=function(i,n,r,s){if(1==s)return n[r];if(2==s)return i.makeNode(n[r],n[r+1]);for(var o=n[r],a=o.bb_l,c=o.bb_b,h=o.bb_r,l=o.bb_t,d=r+s,u=r+1;d>u;u++)o=n[u],a=t(a,o.bb_l),c=t(c,o.bb_b),h=e(h,o.bb_r),l=e(l,o.bb_t);var _=h-a>l-c,f=new Array(2*s);if(_)for(var u=r;d>u;u++)f[2*u+0]=n[u].bb_l,f[2*u+1]=n[u].bb_r;else for(var u=r;d>u;u++)f[2*u+0]=n[u].bb_b,f[2*u+1]=n[u].bb_t;f.sort(function(t,e){return t-e});var p=.5*(f[s-1]+f[s]),g=a,m=c,y=h,v=l,T=a,C=c,S=h,E=l;_?y=T=p:v=C=p;for(var b=d,x=r;b>x;){var o=n[x];Pt(o,T,C,S,E)<Pt(o,g,m,y,v)?(b--,n[x]=n[b],n[b]=o):x++}if(b==s){for(var o=null,u=r;d>u;u++)o=St(o,n[u],i);return o}return NodeNew(i,Lt(i,n,r,b-r),Lt(i,n,b,d-b))};dt.prototype.optimize=function(){var t=new Array(this.count),e=0;for(var i in this.leaves)t[e++]=this.nodes[i];tree.subtreeRecycle(root),this.root=Lt(tree,t,t.length)};var wt=function(t,e){!t.isLeaf&&10>=e&&(wt(t.A,e+1),wt(t.B,e+1));for(var i="",n=0;e>n;n++)i+=" ";console.log(i+t.bb_b+" "+t.bb_t)};dt.prototype.log=function(){this.root&&wt(this.root,0)};var Ot=a.CollisionHandler=function(){this.a=this.b=0};Ot.prototype.begin=function(t,e){return!0},Ot.prototype.preSolve=function(t,e){return!0},Ot.prototype.postSolve=function(t,e){},Ot.prototype.separate=function(t,e){};var Ft=function(t,e){this.e=0,this.u=0,this.surface_vr=y,this.a=t,this.body_a=t.body,this.b=e,this.body_b=e.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};Ft.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},Ft.prototype.totalImpulse=function(){for(var t=this.contacts,e=new m(0,0),i=0,n=t.length;n>i;i++){var r=t[i];e.add(A(r.n,r.jnAcc))}return this.swappedColl?e:e.neg()},Ft.prototype.totalImpulseWithFriction=function(){for(var t=this.contacts,e=new m(0,0),i=0,n=t.length;n>i;i++){var r=t[i];e.add(new m(r.jnAcc,r.jtAcc).rotate(r.n))}return this.swappedColl?e:e.neg()},Ft.prototype.totalKE=function(){for(var t=(1-this.e)/(1+this.e),e=0,i=this.contacts,n=0,r=i.length;r>n;n++){var s=i[n],o=s.jnAcc,a=s.jtAcc;e+=t*o*o/s.nMass+a*a/s.tMass}return e},Ft.prototype.ignore=function(){this.state="ignore"},Ft.prototype.getA=function(){return this.swappedColl?this.b:this.a},Ft.prototype.getB=function(){return this.swappedColl?this.a:this.b},Ft.prototype.isFirstContact=function(){return"first coll"===this.state};var Nt=function(t,e,i){this.point=t,this.normal=e,this.dist=i};Ft.prototype.getContactPointSet=function(){var t,e=new Array(this.contacts.length);for(t=0;t<e.length;t++)e[t]=new Nt(this.contacts[t].p,this.contacts[t].n,this.contacts[t].dist);return e},Ft.prototype.getNormal=function(t){var e=this.contacts[t].n;return this.swappedColl?x(e):e},Ft.prototype.getPoint=function(t){return this.contacts[t].p},Ft.prototype.getDepth=function(t){return this.contacts[t].dist};var Dt=function(t,e,i,n){i?i.body_a===e?i.thread_a_next=n:i.thread_b_next=n:e.arbiterList=n,n&&(n.body_a===e?n.thread_a_prev=i:n.thread_b_prev=i)};Ft.prototype.unthread=function(){Dt(this,this.body_a,this.thread_a_prev,this.thread_a_next),Dt(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},Ft.prototype.update=function(t,e,i,n){if(this.contacts)for(var r=0;r<this.contacts.length;r++)for(var s=this.contacts[r],o=0;o<t.length;o++){var a=t[o];a.hash===s.hash&&(a.jnAcc=s.jnAcc,a.jtAcc=s.jtAcc)}this.contacts=t,this.handler=e,this.swappedColl=i.collision_type!==e.a,this.e=i.e*n.e,this.u=i.u*n.u,this.surface_vr=b(i.surface_v,n.surface_v),this.a=i,this.body_a=i.body,this.b=n,this.body_b=n.body,"cached"==this.state&&(this.state="first coll")},Ft.prototype.preStep=function(e,i,n){for(var r=this.body_a,s=this.body_b,o=0;o<this.contacts.length;o++){var a=this.contacts[o];a.r1=b(a.p,r.p),a.r2=b(a.p,s.p),a.nMass=1/pe(r,s,a.r1,a.r2,a.n),a.tMass=1/pe(r,s,a.r1,a.r2,P(a.n)),a.bias=-n*t(0,a.dist+i)/e,a.jBias=0,a.bounce=le(r,s,a.r1,a.r2,a.n)*this.e}},Ft.prototype.applyCachedImpulse=function(t){if(!this.isFirstContact())for(var e=this.body_a,i=this.body_b,n=0;n<this.contacts.length;n++){var r=this.contacts[n],s=r.n.x,o=r.n.y,a=s*r.jnAcc-o*r.jtAcc,c=s*r.jtAcc+o*r.jnAcc;ue(e,i,r.r1,r.r2,a*t,c*t)}};var Bt=0,Mt=0;Ft.prototype.applyImpulse=function(){Bt++;for(var t=this.body_a,i=this.body_b,n=this.surface_vr,r=this.u,s=0;s<this.contacts.length;s++){Mt++;var o=this.contacts[s],a=o.nMass,c=o.n,h=o.r1,l=o.r2,d=i.vx-l.y*i.w-(t.vx-h.y*t.w),u=i.vy+l.x*i.w-(t.vy+h.x*t.w),_=c.x*(i.v_biasx-l.y*i.w_bias-t.v_biasx+h.y*t.w_bias)+c.y*(l.x*i.w_bias+i.v_biasy-h.x*t.w_bias-t.v_biasy),f=T(d,u,c.x,c.y),g=T(d+n.x,u+n.y,-c.y,c.x),m=(o.bias-_)*a,y=o.jBias;o.jBias=e(y+m,0);var v=-(o.bounce+f)*a,C=o.jnAcc;o.jnAcc=e(C+v,0);var S=r*o.jnAcc,E=-g*o.tMass,b=o.jtAcc;o.jtAcc=p(b+E,-S,S);var x=c.x*(o.jBias-y),A=c.y*(o.jBias-y);_e(t,-x,-A,h),_e(i,x,A,l);var R=o.jnAcc-C,I=o.jtAcc-b;ue(t,i,h,l,c.x*R-c.y*I,c.x*I+c.y*R)}},Ft.prototype.callSeparate=function(t){var e=t.lookupHandler(this.a.collision_type,this.b.collision_type);e.separate(this,t)},Ft.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var Wt=0,zt=function(t,e,i,n){this.p=t,this.n=e,this.dist=i,this.r1=this.r2=y,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=n,Wt++},Vt=[],kt=function(t,e,i,n){var r=i+n,s=b(e,t),o=F(s);if(!(o>=r*r)){var a=Math.sqrt(o);return new zt(E(t,A(s,.5+(i-.5*r)/(a?a:1/0))),a?A(s,1/a):new m(1,0),a-r,0)}},Gt=function(t,e){var i=kt(t.tc,e.tc,t.r,e.r);return i?[i]:Vt},Ut=function(t,e){var i=e.ta,n=e.tb,r=t.tc,s=b(n,i),o=g(v(s,b(r,i))/F(s)),a=E(i,A(s,o)),c=kt(r,a,t.r,e.r);if(c){var h=c.n;return 0===o&&v(h,e.a_tangent)<0||1===o&&v(h,e.b_tangent)<0?Vt:[c]}return Vt},Xt=0,Yt=function(t,e){var i=0,n=t.valueOnAxis(e[0].n,e[0].d);if(n>0)return-1;for(var r=1;r<e.length;r++){var s=t.valueOnAxis(e[r].n,e[r].d);if(s>0)return-1;s>n&&(n=s,i=r)}return Xt=n,i},Ht=function(t,e,i,n){for(var r=[],s=t.tVerts,a=0;a<s.length;a+=2){var c=s[a],h=s[a+1];e.containsVertPartial(c,h,x(i))&&r.push(new zt(new m(c,h),i,n,o(t.hashid,a)))}for(var l=e.tVerts,a=0;a<l.length;a+=2){var c=l[a],h=l[a+1];t.containsVertPartial(c,h,i)&&r.push(new zt(new m(c,h),i,n,o(e.hashid,a)))}return r},jt=function(t,e,i,n){for(var r=[],s=t.tVerts,a=0;a<s.length;a+=2){var c=s[a],h=s[a+1];e.containsVert(c,h)&&r.push(new zt(new m(c,h),i,n,o(t.hashid,a>>1)))}for(var l=e.tVerts,a=0;a<l.length;a+=2){var c=l[a],h=l[a+1];t.containsVert(c,h)&&r.push(new zt(new m(c,h),i,n,o(e.hashid,a>>1)))}return r.length?r:Ht(t,e,i,n)},Qt=function(t,e){var i=Yt(e,t.tPlanes);if(-1==i)return Vt;var n=Xt,r=Yt(t,e.tPlanes);if(-1==r)return Vt;var s=Xt;return n>s?jt(t,e,t.tPlanes[i].n,n):jt(t,e,x(e.tPlanes[r].n),s)},Zt=function(e,i,n){var r=v(i,e.ta)-e.r,s=v(i,e.tb)-e.r;return t(r,s)-n},qt=function(t,e,i,n,r){for(var s=R(e.tn,e.ta),a=R(e.tn,e.tb),c=A(e.tn,r),h=i.tVerts,l=0;l<h.length;l+=2){var d=h[l],u=h[l+1];if(T(d,u,c.x,c.y)<v(e.tn,e.ta)*r+e.r){var _=I(e.tn.x,e.tn.y,d,u);s>=_&&_>=a&&t.push(new zt(new m(d,u),c,n,o(i.hashid,l)))}}},Kt=function(t,e){var i=[],n=e.tPlanes,r=n.length,s=v(t.tn,t.ta),a=e.valueOnAxis(t.tn,s)-t.r,c=e.valueOnAxis(x(t.tn),-s)-t.r;if(c>0||a>0)return Vt;var h=0,l=Zt(t,n[0].n,n[0].d);if(l>0)return Vt;for(var d=0;r>d;d++){var u=Zt(t,n[d].n,n[d].d);if(u>0)return Vt;u>l&&(l=u,h=d)}var _=x(n[h].n),f=E(t.ta,A(_,t.r)),p=E(t.tb,A(_,t.r));if(e.containsVert(f.x,f.y)&&i.push(new zt(f,_,l,o(t.hashid,0))),e.containsVert(p.x,p.y)&&i.push(new zt(p,_,l,o(t.hashid,1))),(a>=l||c>=l)&&(a>c?qt(i,t,e,a,1):qt(i,t,e,c,-1)),0===i.length){var g,y=2*h,T=e.tVerts,C=new m(T[y],T[y+1]);if(g=kt(t.ta,C,t.r,0,i))return[g];if(g=kt(t.tb,C,t.r,0,i))return[g];var S=2*r,b=new m(T[(y+2)%S],T[(y+3)%S]);if(g=kt(t.ta,b,t.r,0,i))return[g];if(g=kt(t.tb,b,t.r,0,i))return[g]}return i},Jt=function(t,e){for(var i=e.tPlanes,n=0,r=v(i[0].n,t.tc)-i[0].d-t.r,s=0;s<i.length;s++){var o=v(i[s].n,t.tc)-i[s].d-t.r;if(o>0)return Vt;o>r&&(r=o,n=s)}var a=i[n].n,c=e.tVerts,h=c.length,l=n<<1,d=c[l],u=c[l+1],_=c[(l+2)%h],f=c[(l+3)%h],p=I(a.x,a.y,d,u),g=I(a.x,a.y,_,f),y=R(a,t.tc);if(g>y){var T=kt(t.tc,new m(_,f),t.r,0,T);return T?[T]:Vt}if(p>y)return[new zt(b(t.tc,A(a,t.r+r/2)),x(a),r,0)];var T=kt(t.tc,new m(d,u),t.r,0,T);return T?[T]:Vt};K.prototype.collisionCode=0,$.prototype.collisionCode=1,et.prototype.collisionCode=2,K.prototype.collisionTable=[Gt,Ut,Jt],$.prototype.collisionTable=[null,function(t,e){return Vt},Kt],et.prototype.collisionTable=[null,null,Qt];var $t=a.collideShapes=function(t,e){return i(t.collisionCode<=e.collisionCode,"Collided shapes must be sorted by type"),t.collisionTable[e.collisionCode](t,e)},te=new Ot,ee=a.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new dt(null),this.activeShapes=new dt(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=te,this.postStepCallbacks=[],this.iterations=10,this.gravity=y,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new rt(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};ee.prototype.getCurrentTimeStep=function(){return this.curr_dt},ee.prototype.setIterations=function(t){this.iterations=t},ee.prototype.isLocked=function(){return this.locked};var ie=function(t){i(!t.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};ee.prototype.addCollisionHandler=function(t,e,i,n,r,s){ie(this),this.removeCollisionHandler(t,e);var a=new Ot;a.a=t,a.b=e,i&&(a.begin=i),n&&(a.preSolve=n),r&&(a.postSolve=r),s&&(a.separate=s),this.collisionHandlers[o(t,e)]=a},ee.prototype.removeCollisionHandler=function(t,e){ie(this),delete this.collisionHandlers[o(t,e)]},ee.prototype.setDefaultCollisionHandler=function(t,e,i,n){ie(this);var r=new Ot;t&&(r.begin=t),e&&(r.preSolve=e),i&&(r.postSolve=i),n&&(r.separate=n),this.defaultHandler=r},ee.prototype.lookupHandler=function(t,e){return this.collisionHandlers[o(t,e)]||this.defaultHandler},ee.prototype.addShape=function(t){var e=t.body;return e.isStatic()?this.addStaticShape(t):(i(!t.space,"This shape is already added to a space and cannot be added to another."),ie(this),e.activate(),e.addShape(t),t.update(e.p,e.rot),this.activeShapes.insert(t,t.hashid),t.space=this,t)},ee.prototype.addStaticShape=function(t){i(!t.space,"This shape is already added to a space and cannot be added to another."),ie(this);var e=t.body;return e.addShape(t),t.update(e.p,e.rot),this.staticShapes.insert(t,t.hashid),
t.space=this,t},ee.prototype.addBody=function(t){return i(!t.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),i(!t.space,"This body is already added to a space and cannot be added to another."),ie(this),this.bodies.push(t),t.space=this,t},ee.prototype.addConstraint=function(t){i(!t.space,"This shape is already added to a space and cannot be added to another."),ie(this);var e=t.a,n=t.b;return e.activate(),n.activate(),this.constraints.push(t),t.next_a=e.constraintList,e.constraintList=t,t.next_b=n.constraintList,n.constraintList=t,t.space=this,t},ee.prototype.filterArbiters=function(t,e){for(var i in this.cachedArbiters){var n=this.cachedArbiters[i];(t===n.body_a&&(e===n.a||null===e)||t===n.body_b&&(e===n.b||null===e))&&(e&&"cached"!==n.state&&n.callSeparate(this),n.unthread(),c(this.arbiters,n),delete this.cachedArbiters[i])}},ee.prototype.removeShape=function(t){var e=t.body;e.isStatic()?this.removeStaticShape(t):(i(this.containsShape(t),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),ie(this),e.activate(),e.removeShape(t),this.filterArbiters(e,t),this.activeShapes.remove(t,t.hashid),t.space=null)},ee.prototype.removeStaticShape=function(t){i(this.containsShape(t),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),ie(this);var e=t.body;e.isStatic()&&e.activateStatic(t),e.removeShape(t),this.filterArbiters(e,t),this.staticShapes.remove(t,t.hashid),t.space=null},ee.prototype.removeBody=function(t){i(this.containsBody(t),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),ie(this),t.activate(),c(this.bodies,t),t.space=null},ee.prototype.removeConstraint=function(t){i(this.containsConstraint(t),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),ie(this),t.a.activate(),t.b.activate(),c(this.constraints,t),t.a.removeConstraint(t),t.b.removeConstraint(t),t.space=null},ee.prototype.containsShape=function(t){return t.space===this},ee.prototype.containsBody=function(t){return t.space==this},ee.prototype.containsConstraint=function(t){return t.space==this},ee.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[o(t.a.hashid,t.b.hashid)],c(this.arbiters,t)},ee.prototype.eachBody=function(t){this.lock();for(var e=this.bodies,i=0;i<e.length;i++)t(e[i]);for(var n=this.sleepingComponents,i=0;i<n.length;i++)for(var r=n[i],s=r;s;){var o=s.nodeNext;t(s),s=o}this.unlock(!0)},ee.prototype.eachShape=function(t){this.lock(),this.activeShapes.each(t),this.staticShapes.each(t),this.unlock(!0)},ee.prototype.eachConstraint=function(t){this.lock();for(var e=this.constraints,i=0;i<e.length;i++)t(e[i]);this.unlock(!0)},ee.prototype.reindexStatic=function(){i(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(t){var e=t.body;t.update(e.p,e.rot)}),this.staticShapes.reindex()},ee.prototype.reindexShape=function(t){i(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var e=t.body;t.update(e.p,e.rot),this.activeShapes.reindexObject(t,t.hashid),this.staticShapes.reindexObject(t,t.hashid)},ee.prototype.reindexShapesForBody=function(t){for(var e=t.shapeList;e;e=e.next)this.reindexShape(e)},ee.prototype.useSpatialHash=function(t,e){throw new Error("Spatial Hash not implemented.")},ee.prototype.activateBody=function(t){if(i(!t.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked)-1===this.rousedBodies.indexOf(t)&&this.rousedBodies.push(t);else{this.bodies.push(t);for(var e=0;e<t.shapeList.length;e++){var n=t.shapeList[e];this.staticShapes.remove(n,n.hashid),this.activeShapes.insert(n,n.hashid)}for(var r=t.arbiterList;r;r=r.next(t)){var s=r.body_a;if(t===s||s.isStatic()){var a=r.a,c=r.b;this.cachedArbiters[o(a.hashid,c.hashid)]=r,r.stamp=this.stamp,r.handler=this.lookupHandler(a.collision_type,c.collision_type),this.arbiters.push(r)}}for(var h=t.constraintList;h;h=h.nodeNext){var s=h.a;(t===s||s.isStatic())&&this.constraints.push(h)}}},ee.prototype.deactivateBody=function(t){i(!t.isRogue(),"Internal error: Attempting to deactivate a rogue body."),c(this.bodies,t);for(var e=0;e<t.shapeList.length;e++){var n=t.shapeList[e];this.activeShapes.remove(n,n.hashid),this.staticShapes.insert(n,n.hashid)}for(var r=t.arbiterList;r;r=r.next(t)){var s=r.body_a;(t===s||s.isStatic())&&this.uncacheArbiter(r)}for(var o=t.constraintList;o;o=o.nodeNext){var s=o.a;(t===s||s.isStatic())&&c(this.constraints,o)}};var ne=function(t){return t?t.nodeRoot:null},re=function(t){if(t&&t.isSleeping(t)){i(!t.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var e=t.space,n=t;n;){var r=n.nodeNext;n.nodeIdleTime=0,n.nodeRoot=null,n.nodeNext=null,e.activateBody(n),n=r}c(e.sleepingComponents,t)}};rt.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,re(ne(this)))},rt.prototype.activateStatic=function(t){i(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var e=this.arbiterList;e;e=e.next(this))t&&t!=e.a&&t!=e.b||(e.body_a==this?e.body_b:e.body_a).activate()},rt.prototype.pushArbiter=function(t){n(null===(t.body_a===this?t.thread_a_next:t.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),n(null===(t.body_a===this?t.thread_a_prev:t.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;n(null===e||null===(e.body_a===this?e.thread_a_prev:e.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),t.body_a===this?t.thread_a_next=e:t.thread_b_next=e,e&&(e.body_a===this?e.thread_a_prev=t:e.thread_b_prev=t),this.arbiterList=t};var se=function(t,e){e.nodeRoot=t,e!==t&&(e.nodeNext=t.nodeNext,t.nodeNext=e)},oe=function(t,e){if(!e.isRogue()){var i=ne(e);if(null==i){se(t,e);for(var r=e.arbiterList;r;r=r.next(e))oe(t,e==r.body_a?r.body_b:r.body_a);for(var s=e.constraintList;s;s=s.next(e))oe(t,e==s.a?s.b:s.a)}else n(i===t,"Internal Error: Inconsistency detected in the contact graph.")}},ae=function(t,e){for(var i=t;i;i=i.nodeNext)if(i.nodeIdleTime<e)return!0;return!1};ee.prototype.processComponents=function(t){for(var e=this.sleepTimeThreshold!==1/0,i=this.bodies,r=0;r<i.length;r++){var s=i[r];n(null===s.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),n(null===s.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(e)for(var o=this.idleSpeedThreshold,a=o?o*o:F(this.gravity)*t*t,r=0;r<i.length;r++){var s=i[r],c=a?s.m*a:0;s.nodeIdleTime=s.kineticEnergy()>c?0:s.nodeIdleTime+t}for(var h=this.arbiters,r=0,l=h.length;l>r;r++){var d=h[r],u=d.body_a,_=d.body_b;e&&((_.isRogue()&&!_.isStatic()||u.isSleeping())&&u.activate(),(u.isRogue()&&!u.isStatic()||_.isSleeping())&&_.activate()),u.pushArbiter(d),_.pushArbiter(d)}if(e){for(var f=this.constraints,r=0;r<f.length;r++){var p=f[r],u=p.a,_=p.b;_.isRogue()&&!_.isStatic()&&u.activate(),u.isRogue()&&!u.isStatic()&&_.activate()}for(var r=0;r<i.length;){var s=i[r];if(null!==ne(s)||(oe(s,s),ae(s,this.sleepTimeThreshold)))r++,s.nodeRoot=null,s.nodeNext=null;else{this.sleepingComponents.push(s);for(var g=s;g;g=g.nodeNext)this.deactivateBody(g)}}}},rt.prototype.sleep=function(){this.sleepWithGroup(null)},rt.prototype.sleepWithGroup=function(t){i(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var e=this.space;if(i(e,"Cannot put a rogue body to sleep."),i(!e.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),i(null===t||t.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping())return void i(ne(this)===ne(t),"The body is already sleeping and it's group cannot be reassigned.");for(var n=0;n<this.shapeList.length;n++)this.shapeList[n].update(this.p,this.rot);if(e.deactivateBody(this),t){var r=ne(t);this.nodeRoot=r,this.nodeNext=r.nodeNext,this.nodeIdleTime=0,r.nodeNext=this}else this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,e.sleepingComponents.push(this);c(e.bodies,this)},ee.prototype.activateShapesTouchingShape=function(t){this.sleepTimeThreshold!==1/0&&this.shapeQuery(t,function(t,e){t.body.activate()})},ee.prototype.pointQuery=function(t,e,i,n){var r=function(r){(!r.group||i!==r.group)&&e&r.layers&&r.pointQuery(t)&&n(r)},s=new U(t.x,t.y,t.x,t.y);this.lock(),this.activeShapes.query(s,r),this.staticShapes.query(s,r),this.unlock(!0)},ee.prototype.pointQueryFirst=function(t,e,i){var n=null;return this.pointQuery(t,e,i,function(t){t.sensor||(n=t)}),n},ee.prototype.nearestPointQuery=function(t,e,i,n,r){var s=function(s){if((!s.group||n!==s.group)&&i&s.layers){var o=s.nearestPointQuery(t);o.d<e&&r(s,o.d,o.p)}},o=X(t,e);this.lock(),this.activeShapes.query(o,s),this.staticShapes.query(o,s),this.unlock(!0)},ee.prototype.nearestPointQueryNearest=function(t,e,i,n){var r,s=function(s){if((!s.group||n!==s.group)&&i&s.layers&&!s.sensor){var o=s.nearestPointQuery(t);o.d<e&&(!r||o.d<r.d)&&(r=o)}},o=X(t,e);return this.activeShapes.query(o,s),this.staticShapes.query(o,s),r},ee.prototype.segmentQuery=function(t,e,i,n,r){var s=function(s){var o;return(!s.group||n!==s.group)&&i&s.layers&&(o=s.segmentQuery(t,e))&&r(s,o.t,o.n),1};this.lock(),this.staticShapes.segmentQuery(t,e,1,s),this.activeShapes.segmentQuery(t,e,1,s),this.unlock(!0)},ee.prototype.segmentQueryFirst=function(t,e,i,n){var r=null,s=function(s){var o;return(!s.group||n!==s.group)&&i&s.layers&&!s.sensor&&(o=s.segmentQuery(t,e))&&(null===r||o.t<r.t)&&(r=o),r?r.t:1};return this.staticShapes.segmentQuery(t,e,1,s),this.activeShapes.segmentQuery(t,e,r?r.t:1,s),r},ee.prototype.bbQuery=function(t,e,i,n){var r=function(r){(!r.group||i!==r.group)&&e&r.layers&&Y(t,r.bb_l,r.bb_b,r.bb_r,r.bb_t)&&n(r)};this.lock(),this.activeShapes.query(t,r),this.staticShapes.query(t,r),this.unlock(!0)},ee.prototype.shapeQuery=function(t,e){var i=t.body;i&&t.update(i.p,i.rot);var n=new U(t.bb_l,t.bb_b,t.bb_r,t.bb_t),r=!1,s=function(i){var n=t;if((!n.group||n.group!==i.group)&&n.layers&i.layers&&n!==i){var s;if(n.collisionCode<=i.collisionCode)s=$t(n,i);else{s=$t(i,n);for(var o=0;o<s.length;o++)s[o].n=x(s[o].n)}if(s.length&&(r=!(n.sensor||i.sensor),e)){for(var a=new Array(s.length),o=0;o<s.length;o++)a[o]=new Nt(s[o].p,s[o].n,s[o].dist);e(i,a)}}};return this.lock(),this.activeShapes.query(n,s),this.staticShapes.query(n,s),this.unlock(!0),r},ee.prototype.addPostStepCallback=function(t){n(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(t)},ee.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++)this.postStepCallbacks[t]();this.postStepCallbacks=[]},ee.prototype.lock=function(){this.locked++},ee.prototype.unlock=function(t){if(this.locked--,i(this.locked>=0,"Internal Error: Space lock underflow."),0===this.locked&&t){for(var e=this.rousedBodies,n=0;n<e.length;n++)this.activateBody(e[n]);e.length=0,this.runPostStepCallbacks()}},ee.prototype.makeCollideShapes=function(){var t=this;return function(e,i){var n=t;if(e.bb_l<=i.bb_r&&i.bb_l<=e.bb_r&&e.bb_b<=i.bb_t&&i.bb_b<=e.bb_t&&e.body!==i.body&&(!e.group||e.group!==i.group)&&e.layers&i.layers){var r=n.lookupHandler(e.collision_type,i.collision_type),s=e.sensor||i.sensor;if(!s||r!==te){if(e.collisionCode>i.collisionCode){var a=e;e=i,i=a}var c=$t(e,i);if(0!==c.length){var h=o(e.hashid,i.hashid),l=n.cachedArbiters[h];l||(l=n.cachedArbiters[h]=new Ft(e,i)),l.update(c,r,e,i),"first coll"!=l.state||r.begin(l,n)||l.ignore(),"ignore"!==l.state&&r.preSolve(l,n)&&!s?n.arbiters.push(l):(l.contacts=null,"ignore"!==l.state&&(l.state="normal")),l.stamp=n.stamp}}}}},ee.prototype.arbiterSetFilter=function(t){var e=this.stamp-t.stamp,i=t.body_a,n=t.body_b;return(i.isStatic()||i.isSleeping())&&(n.isStatic()||n.isSleeping())?!0:(e>=1&&"cached"!=t.state&&(t.callSeparate(this),t.state="cached"),e>=this.collisionPersistence?(t.contacts=null,!1):!0)};var ce=function(t){var e=t.body;t.update(e.p,e.rot)};ee.prototype.step=function(t){if(0!==t){i(0===y.x&&0===y.y,"vzero is invalid"),this.stamp++;var e=this.curr_dt;this.curr_dt=t;var n,r,s,o=this.bodies,a=this.constraints,c=this.arbiters;for(n=0;n<c.length;n++){var h=c[n];h.state="normal",h.body_a.isSleeping()||h.body_b.isSleeping()||h.unthread()}for(c.length=0,this.lock(),n=0;n<o.length;n++)o[n].position_func(t);this.activeShapes.each(ce),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(t),this.lock();for(s in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[s])||delete this.cachedArbiters[s];var l=this.collisionSlop,d=1-Math.pow(this.collisionBias,t);for(n=0;n<c.length;n++)c[n].preStep(t,l,d);for(n=0;n<a.length;n++){var u=a[n];u.preSolve(this),u.preStep(t)}var _=Math.pow(this.damping,t),f=this.gravity;for(n=0;n<o.length;n++)o[n].velocity_func(f,_,t);var p=0===e?0:t/e;for(n=0;n<c.length;n++)c[n].applyCachedImpulse(p);for(n=0;n<a.length;n++)a[n].applyCachedImpulse(p);for(n=0;n<this.iterations;n++){for(r=0;r<c.length;r++)c[r].applyImpulse();for(r=0;r<a.length;r++)a[r].applyImpulse()}for(n=0;n<a.length;n++)a[n].postSolve(this);for(n=0;n<c.length;n++)c[n].handler.postSolve(c[n],this);this.unlock(!0)}};var he=function(t,e,i,n){var r=t.vx+-i.y*t.w,s=t.vy+i.x*t.w,o=e.vx+-n.y*e.w,a=e.vy+n.x*e.w;return new m(o-r,a-s)},le=function(t,e,i,n,r){var s=t.vx+-i.y*t.w,o=t.vy+i.x*t.w,a=e.vx+-n.y*e.w,c=e.vy+n.x*e.w;return T(a-s,c-o,r.x,r.y)},de=function(t,e,i,n){t.vx+=e*t.m_inv,t.vy+=i*t.m_inv,t.w+=t.i_inv*(n.x*i-n.y*e)},ue=function(t,e,i,n,r,s){de(t,-r,-s,i),de(e,r,s,n)},_e=function(t,e,i,n){t.v_biasx+=e*t.m_inv,t.v_biasy+=i*t.m_inv,t.w_bias+=t.i_inv*I(n.x,n.y,e,i)},fe=function(t,e,i){var n=R(e,i);return t.m_inv+t.i_inv*n*n},pe=function(t,e,i,r,s){var o=fe(t,i,s)+fe(e,r,s);return n(0!==o,"Unsolvable collision or constraint."),o},ge=function(t,e,i,r,s,o){var a,c,h,l,d=t.m_inv+e.m_inv;a=d,c=0,h=0,l=d;var u=t.i_inv,_=i.x*i.x*u,f=i.y*i.y*u,p=-i.x*i.y*u;a+=f,c+=p,h+=p,l+=_;var g=e.i_inv,m=r.x*r.x*g,y=r.y*r.y*g,v=-r.x*r.y*g;a+=y,c+=v,h+=v,l+=m;var T=a*l-c*h;n(0!==T,"Unsolvable constraint.");var C=1/T;s.x=l*C,s.y=-c*C,o.x=-h*C,o.y=a*C},me=function(t,e,i){return new m(v(t,e),v(t,i))},ye=function(t,e){return 1-Math.pow(t,e)},ve=a.Constraint=function(t,e){this.a=t,this.b=e,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};ve.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},ve.prototype.preStep=function(t){},ve.prototype.applyCachedImpulse=function(t){},ve.prototype.applyImpulse=function(){},ve.prototype.getImpulse=function(){return 0},ve.prototype.preSolve=function(t){},ve.prototype.postSolve=function(t){},ve.prototype.next=function(t){return this.a===t?this.next_a:this.next_b};var Te=a.PinJoint=function(t,e,i,r){ve.call(this,t,e),this.anchr1=i,this.anchr2=r;var s=t?E(t.p,w(i,t.rot)):i,o=e?E(e.p,w(r,e.rot)):r;this.dist=C(b(o,s)),n(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Te.prototype=Object.create(ve.prototype),Te.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=w(this.anchr1,e.rot),this.r2=w(this.anchr2,i.rot);var n=b(E(i.p,this.r2),E(e.p,this.r1)),r=C(n);this.n=A(n,1/(r?r:1/0)),this.nMass=1/pe(e,i,this.r1,this.r2,this.n);var s=this.maxBias;this.bias=p(-ye(this.errorBias,t)*(r-this.dist)/t,-s,s),this.jnMax=this.maxForce*t},Te.prototype.applyCachedImpulse=function(t){var e=A(this.n,this.jnAcc*t);ue(this.a,this.b,this.r1,this.r2,e.x,e.y)},Te.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=le(t,e,this.r1,this.r2,i),r=(this.bias-n)*this.nMass,s=this.jnAcc;this.jnAcc=p(s+r,-this.jnMax,this.jnMax),r=this.jnAcc-s,ue(t,e,this.r1,this.r2,i.x*r,i.y*r)},Te.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Ce=a.SlideJoint=function(t,e,i,n,r,s){ve.call(this,t,e),this.anchr1=i,this.anchr2=n,this.min=r,this.max=s,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Ce.prototype=Object.create(ve.prototype),Ce.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=w(this.anchr1,e.rot),this.r2=w(this.anchr2,i.rot);var n=b(E(i.p,this.r2),E(e.p,this.r1)),r=C(n),s=0;r>this.max?(s=r-this.max,this.n=M(n)):r<this.min?(s=this.min-r,this.n=x(M(n))):(this.n=y,this.jnAcc=0),this.nMass=1/pe(e,i,this.r1,this.r2,this.n);var o=this.maxBias;this.bias=p(-ye(this.errorBias,t)*s/t,-o,o),this.jnMax=this.maxForce*t},Ce.prototype.applyCachedImpulse=function(t){var e=this.jnAcc*t;ue(this.a,this.b,this.r1,this.r2,this.n.x*e,this.n.y*e)},Ce.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var t=this.a,e=this.b,i=this.n,n=this.r1,r=this.r2,s=he(t,e,n,r),o=v(s,i),a=(this.bias-o)*this.nMass,c=this.jnAcc;this.jnAcc=p(c+a,-this.jnMax,0),a=this.jnAcc-c,ue(t,e,this.r1,this.r2,i.x*a,i.y*a)}},Ce.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Se=a.PivotJoint=function(t,e,i,n){if(ve.call(this,t,e),"undefined"==typeof n){var r=i;i=t?t.world2Local(r):r,n=e?e.world2Local(r):r}this.anchr1=i,this.anchr2=n,this.r1=this.r2=y,this.k1=new m(0,0),this.k2=new m(0,0),this.jAcc=y,this.jMaxLen=0,this.bias=y};Se.prototype=Object.create(ve.prototype),Se.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=w(this.anchr1,e.rot),this.r2=w(this.anchr2,i.rot),ge(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var n=b(E(i.p,this.r2),E(e.p,this.r1));this.bias=W(A(n,-ye(this.errorBias,t)/t),this.maxBias)},Se.prototype.applyCachedImpulse=function(t){ue(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Se.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,r=he(t,e,i,n),s=me(b(this.bias,r),this.k1,this.k2),o=this.jAcc;this.jAcc=W(E(this.jAcc,s),this.jMaxLen),ue(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Se.prototype.getImpulse=function(){return C(this.jAcc)};var Ee=a.GrooveJoint=function(t,e,i,n,r){ve.call(this,t,e),this.grv_a=i,this.grv_b=n,this.grv_n=P(B(b(n,i))),this.anchr2=r,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new m(0,0),this.k2=new m(0,0),this.jAcc=y,this.jMaxLen=0,this.bias=null};Ee.prototype=Object.create(ve.prototype),Ee.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.local2World(this.grv_a),r=e.local2World(this.grv_b),s=w(this.grv_n,e.rot),o=v(n,s);this.grv_tn=s,this.r2=w(this.anchr2,i.rot);var a=R(E(i.p,this.r2),s);a<=R(n,s)?(this.clamp=1,this.r1=b(n,e.p)):a>=R(r,s)?(this.clamp=-1,this.r1=b(r,e.p)):(this.clamp=0,this.r1=b(E(A(P(s),-a),A(s,o)),e.p)),ge(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var c=b(E(i.p,this.r2),E(e.p,this.r1));this.bias=W(A(c,-ye(this.errorBias,t)/t),this.maxBias)},Ee.prototype.applyCachedImpulse=function(t){ue(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Ee.prototype.grooveConstrain=function(t){var e=this.grv_tn,i=this.clamp*R(t,e)>0?t:L(t,e);return W(i,this.jMaxLen)},Ee.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,r=he(t,e,i,n),s=me(b(this.bias,r),this.k1,this.k2),o=this.jAcc;this.jAcc=this.grooveConstrain(E(o,s)),ue(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Ee.prototype.getImpulse=function(){return C(this.jAcc)},Ee.prototype.setGrooveA=function(t){this.grv_a=t,this.grv_n=P(B(b(this.grv_b,t))),this.activateBodies()},Ee.prototype.setGrooveB=function(t){this.grv_b=t,this.grv_n=P(B(b(t,this.grv_a))),this.activateBodies()};var be=function(t,e){return(t.restLength-e)*t.stiffness},xe=a.DampedSpring=function(t,e,i,n,r,s,o){ve.call(this,t,e),this.anchr1=i,this.anchr2=n,this.restLength=r,this.stiffness=s,this.damping=o,this.springForceFunc=be,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};xe.prototype=Object.create(ve.prototype),xe.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=w(this.anchr1,e.rot),this.r2=w(this.anchr2,i.rot);var r=b(E(i.p,this.r2),E(e.p,this.r1)),s=C(r);this.n=A(r,1/(s?s:1/0));var o=pe(e,i,this.r1,this.r2,this.n);n(0!==o,"Unsolvable this."),this.nMass=1/o,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*t*o);var a=this.springForceFunc(this,s);ue(e,i,this.r1,this.r2,this.n.x*a*t,this.n.y*a*t)},xe.prototype.applyCachedImpulse=function(t){},xe.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=this.r1,r=this.r2,s=le(t,e,n,r,i),o=(this.target_vrn-s)*this.v_coef;this.target_vrn=s+o,o*=this.nMass,ue(t,e,this.r1,this.r2,this.n.x*o,this.n.y*o)},xe.prototype.getImpulse=function(){return 0};var Ae=function(t,e){return(e-t.restAngle)*t.stiffness},Re=a.DampedRotarySpring=function(t,e,i,n,r){ve.call(this,t,e),this.restAngle=i,this.stiffness=n,this.damping=r,this.springTorqueFunc=Ae,this.target_wrn=0,this.w_coef=0,this.iSum=0};Re.prototype=Object.create(ve.prototype),Re.prototype.preStep=function(t){var e=this.a,i=this.b,r=e.i_inv+i.i_inv;n(0!==r,"Unsolvable spring."),this.iSum=1/r,this.w_coef=1-Math.exp(-this.damping*t*r),this.target_wrn=0;var s=this.springTorqueFunc(this,e.a-i.a)*t;e.w-=s*e.i_inv,i.w+=s*i.i_inv},Re.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=t.w-e.w,n=(this.target_wrn-i)*this.w_coef;this.target_wrn=i+n;var r=n*this.iSum;t.w+=r*t.i_inv,e.w-=r*e.i_inv};var Ie=a.RotaryLimitJoint=function(t,e,i,n){ve.call(this,t,e),this.min=i,this.max=n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Ie.prototype=Object.create(ve.prototype),Ie.prototype.preStep=function(t){var e=this.a,i=this.b,n=i.a-e.a,r=0;n>this.max?r=this.max-n:n<this.min&&(r=this.min-n),this.iSum=1/(1/e.i+1/i.i);var s=this.maxBias;this.bias=p(-ye(this.errorBias,t)*r/t,-s,s),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},Ie.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Ie.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,n=-(this.bias+i)*this.iSum,r=this.jAcc;this.jAcc=this.bias<0?p(r+n,0,this.jMax):p(r+n,-this.jMax,0),n=this.jAcc-r,t.w-=n*t.i_inv,e.w+=n*e.i_inv}},Ie.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var Pe=a.RatchetJoint=function(t,e,i,n){ve.call(this,t,e),this.angle=0,this.phase=i,this.ratchet=n,this.angle=(e?e.a:0)-(t?t.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};Pe.prototype=Object.create(ve.prototype),Pe.prototype.preStep=function(t){var e=this.a,i=this.b,n=this.angle,r=this.phase,s=this.ratchet,o=i.a-e.a,a=n-o,c=0;a*s>0?c=a:this.angle=Math.floor((o-r)/s)*s+r,this.iSum=1/(e.i_inv+i.i_inv);var h=this.maxBias;this.bias=p(-ye(this.errorBias,t)*c/t,-h,h),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},Pe.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Pe.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,n=this.ratchet,r=-(this.bias+i)*this.iSum,s=this.jAcc;this.jAcc=p((s+r)*n,0,this.jMax*Math.abs(n))/n,r=this.jAcc-s,t.w-=r*t.i_inv,e.w+=r*e.i_inv}},Pe.prototype.getImpulse=function(t){return Math.abs(t.jAcc)};var Le=a.GearJoint=function(t,e,i,n){ve.call(this,t,e),this.phase=i,this.ratio=n,this.ratio_inv=1/n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Le.prototype=Object.create(ve.prototype),Le.prototype.preStep=function(t){var e=this.a,i=this.b;this.iSum=1/(e.i_inv*this.ratio_inv+this.ratio*i.i_inv);var n=this.maxBias;this.bias=p(-ye(this.errorBias,t)*(i.a*this.ratio-e.a-this.phase)/t,-n,n),this.jMax=this.maxForce*t},Le.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv*this.ratio_inv,i.w+=n*i.i_inv},Le.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w*this.ratio-t.w,n=(this.bias-i)*this.iSum,r=this.jAcc;this.jAcc=p(r+n,-this.jMax,this.jMax),n=this.jAcc-r,t.w-=n*t.i_inv*this.ratio_inv,e.w+=n*e.i_inv},Le.prototype.getImpulse=function(){return Math.abs(this.jAcc)},Le.prototype.setRatio=function(t){this.ratio=t,this.ratio_inv=1/t,this.activateBodies()};var we=a.SimpleMotor=function(t,e,i){ve.call(this,t,e),this.rate=i,this.jAcc=0,this.iSum=this.jMax=0};we.prototype=Object.create(ve.prototype),we.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*t},we.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},we.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w-t.w+this.rate,n=-i*this.iSum,r=this.jAcc;this.jAcc=p(r+n,-this.jMax,this.jMax),n=this.jAcc-r,t.w-=n*t.i_inv,e.w+=n*e.i_inv},we.prototype.getImpulse=function(){return Math.abs(this.jAcc)}}()}).call(window,cc,ccui,ccs,sp,cp)},{"../cocos2d/core/CCGame":19,"../cocos2d/core/event/event-target":48,"../cocos2d/core/platform/CCLoader":56,"../cocos2d/core/platform/CCSys":59,"../cocos2d/core/sprites/CCSpriteFrame":73,"../cocos2d/core/utils":83}],3:[function(t,e,i){function n(t,e){a.call(this,t),this.animation=e}function r(t){var e=t.split(".");return e.shift(),e.length>0?e:null}function s(t,e){function i(t){if(!Array.isArray(t))return!1;for(var e=0,i=t.length;i>e;e++){var n=t[e];if(!Array.isArray(n)||6!==n.length)return!1}return!0}function n(t,n,s){var a,a,d=t instanceof cc.Node&&"position"===n,u=[];a=d?new h:new c,a.target=t;var _,f,p=n.indexOf("."),g=-1!==p;g?(_=n.slice(0,p),f=t[_]):_=n,a.prop=_,a.subProps=r(n);for(var m=0,y=s.length;y>m;m++){var v=s[m],T=v.frame/e.duration;if(a.ratios.push(T),d){var C=v.motionPath;C&&!i(C)&&(cc.error("motion path of target ["+t.name+"] in prop ["+n+"] frame ["+m+"] is not valid"),C=null),u.push(C)}var S=v.value;a.values.push(S);var E=v.curve;if(E){if("string"==typeof E){a.types.push(E);continue}if(Array.isArray(E)){a.types.push(E[0]===E[1]&&E[2]===E[3]?c.Linear:c.Bezier(E));continue}}a.types.push(c.Linear)}return d&&l(u,a,o.duration,o.sample),a}function s(t,e){var i=e.props,r=e.comps;if(i)for(var s in i){var o=i[s],c=n(t,s,o);a.push(c)}if(r)for(var h in r){var l=t.getComponent(h);if(l){var d=r[h];for(var s in d){var o=d[s],c=n(l,s,o);a.push(c)}}}}var o=e.clip,a=e.curves;a.length=0,e.duration=o.duration,e.speed=o.speed,e.wrapMode=o.wrapMode,e.frameRate=o.sample,e.repeatCount=(e.wrapMode&_.Loop)===_.Loop?1/0:1;var p=o.events;if(p)for(var g,m=0,y=p.length;y>m;m++){g||(g=new d,g.target=t,a.push(g));var v,T=p[m],C=T.frame/e.duration,S=f(g.ratios,C);S>=0?v=g.events[S]:(v=new u,g.ratios.push(C),g.events.push(v)),v.add(T.func,T.params)}var E=o.curveData,b=E.paths;s(t,E);for(var x in b){var A=cc.find(x,t);if(A){var R=b[x];s(A,R)}}}var o=cc.js,a=t("./animators").Animator,c=t("./animation-curves").DynamicAnimCurve,h=t("./animation-curves").SampledAnimCurve,l=t("./motion-path-helper").sampleMotionPaths,d=t("./animation-curves").EventAnimCurve,u=t("./animation-curves").EventInfo,_=t("./types").WrapModeMask,f=t("./binary-search");o.extend(n,a);var p=n.prototype;p.playState=function(t,e){var i=t.clip;if(i){{t.curves}t.curveLoaded||s(this.target,t),this.playingAnims.push(t),t.play(),t.time=e||0,this.play()}},p.sample=function(){for(var t=this.playingAnims,e=0;e<t.length;e++){var i=t[e];i.sample()}},p.stopState=function(t){o.array.remove(this.playingAnims,t)&&t.stop()},p.pauseState=function(t){t&&t.pause()},p.resumeState=function(t){t&&t.resume()},p.setStateTime=function(t,e){t&&t.setTime(e)},e.exports=n},{"./animation-curves":5,"./animators":8,"./binary-search":10,"./motion-path-helper":13,"./types":15}],4:[function(t,e,i){var n=cc.Class({name:"cc.AnimationClip","extends":cc.Asset,properties:{_duration:{"default":0,type:"Float"},duration:{get:function(){return this._duration}},sample:{"default":60},speed:{"default":1},wrapMode:{"default":cc.WrapMode.Normal},curveData:{"default":{},visible:!1},events:{"default":[],visible:!1}}});cc.AnimationClip=e.exports=n},{}],5:[function(t,e,i){function n(t,e){if("string"==typeof e){var i=cc.Easing[e];i?t=i(t):cc.error("Can't find easing type ["+e+"]")}else Array.isArray(e)&&(t=r(e,t));return t}var r=t("./bezier").bezierByTime,s=t("./binary-search"),o=t("./types").WrapModeMask,a=cc.Class({name:"cc.AnimCurve",sample:function(t,e,i){},onTimeChangedManually:function(){}}),c=cc.Class({name:"cc.DynamicAnimCurve","extends":a,properties:{target:null,prop:"",values:[],ratios:[],types:[],subProps:null},_calcValue:function(t,e){var i,n=this.values,r=n[t-1],s=n[t];if("number"==typeof r)i=r+(s-r)*e;else{var o=r.lerp;i=o?r.lerp(s,e):r}return i},_applyValue:function(t,e,i){t[e]=i},_findFrameIndex:s,sample:function(t,e,i){var r=this.values,s=this.ratios,o=s.length;if(0!==o){var a,c=this._findFrameIndex(s,e);if(0>c)if(c=~c,0>=c)a=r[0];else if(c>=o)a=r[o-1];else{var h=s[c-1],l=s[c],d=this.types[c-1],u=(e-h)/(l-h);u=n(u,d),a=this._calcValue(c,u)}else a=r[c];var _=this.subProps;if(_){for(var f=this.target[this.prop],p=f,g=0;g<_.length-1;g++){var m=_[g];if(!p)return;p=p[m]}var y=_[_.length-1];if(!p)return;this._applyValue(p,y,a),a=f}this._applyValue(this.target,this.prop,a)}}});c.Linear=null,c.Bezier=function(t){return t};var h=cc.Class({name:"cc.SampledAnimCurve","extends":c,_findFrameIndex:function(t,e){var i=t.length-1;if(0===i)return 0;var n=t[0];if(n>e)return 0;var r=t[i];if(e>r)return i;e=(e-n)/(r-n);var s=1/i,o=e/s|0;return o}}),l=function(){this.events=[]};l.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})};var d=cc.Class({name:"cc.EventAnimCurve","extends":a,properties:{target:null,ratios:[],events:[],_lastWrappedInfo:null},_wrapIterations:function(t){return t-(0|t)===0&&(t-=1),0|t},sample:function(t,e,i){var n=this.ratios.length,r=i.getWrappedInfo(i.time),a=r.direction,c=s(this.ratios,r.ratio);0>c&&(c=~c-1,0>a&&(c+=1));var h=this._lastWrappedInfo,l=h?h.frameIndex:r.frameIndex;if(h){if(l!==c){var d=i.wrapMode,u=this._wrapIterations(r.iterations),_=this._wrapIterations(h.iterations);a=h.direction;do{if(u>=_&&(-1===a&&0===l?((d&o.PingPong)===o.PingPong?a*=-1:l=n,_++):1===a&&l===n-1&&((d&o.PingPong)===o.PingPong?a*=-1:l=-1,_++),l===c))break;l+=a,this._fireEvent(l)}while(l!==c)}}else this._fireEvent(c);r.frameIndex=c,this._lastWrappedInfo=r},_fireEvent:function(t){if(!(0>t||t>=this.events.length))for(var e=this.events[t],i=e.events,n=this.target._components,r=0;r<i.length;r++)for(var s=i[r],o=s.func,a=0;a<n.length;a++){var c=n[a],h=c[o];h&&h.apply(c,s.params)}},onTimeChangedManually:function(){this._lastWrappedInfo=null}});e.exports={AnimCurve:a,DynamicAnimCurve:c,SampledAnimCurve:h,EventAnimCurve:d,EventInfo:l,computeRatioByType:n}},{"./bezier":9,"./binary-search":10,"./types":15}],6:[function(t,e,i){var n=(cc.js,cc._Class.extend({ctor:function(){this.animators=[]},update:function(t){for(var e=this.animators,i=0,n=e.length;n>i;i++){var r=e[i];r._isPlaying&&!r._isPaused&&(r.update(t),r._isPlaying||(i--,n--))}},destruct:function(){},addAnimator:function(t){this.animators.push(t)},removeAnimator:function(t){var e=this.animators.indexOf(t);e>=0?this.animators.splice(e,1):cc.error("animator not added or already removed")}}));cc.AnimationManager=e.exports=n},{}],7:[function(t,e,i){function n(t,e){s.call(this,null,null,{duration:t.length}),this._clip=t,this._name=e||t.name}var r=cc.js,s=t("./types").AnimationNode;r.extend(n,s);var o=n.prototype;r.get(o,"clip",function(){return this._clip}),r.get(o,"name",function(){return this._name}),r.obsolete(o,"AnimationState.length","duration"),r.getset(o,"curveLoaded",function(){return this.curves.length>0},function(t){this.curves.length=0}),o.onPlay=function(){this.setTime(0)},o.setTime=function(t){this.time=t||0,this.curves.forEach(function(t){t.onTimeChangedManually()})},cc.AnimationState=e.exports=n},{"./types":15}],8:[function(t,e,i){function n(t){this.target=t,this.playingAnims=[]}function r(t){n.call(this,t)}function s(t){for(var e=0,i=0,n=t.length,r=0;n>r;r++){var s=t[r],o=s.ratio;if(0===r&&"number"!=typeof o?s.computedRatio=o=0:r===n-1&&"number"!=typeof o&&(s.computedRatio=o=1),
"number"==typeof o){if(r>e+1)for(var a=r-e,c=(o-i)/a,h=e+1;r>h;h++)i+=c,t[h].computedRatio=i;e=r,i=o}}}function o(t,e,i){for(var n,r=0;r<t.length;r++)if(n=t[r],n.target===e&&n.prop===i)return n;return null}function a(t,e,i,n,r){var s=o(t,e,i);s||(s=new d,t.push(s),s.target=e,s.prop=i),s.values.push(n),s.ratios.push(r)}var c=cc.js,h=t("./playable"),l=t("./types").AnimationNode,d=t("./animation-curves").DynamicAnimCurve;c.extend(n,h);var u=n.prototype;u.update=function(t){for(var e=this.playingAnims,i=0;i<e.length;i++){var n=e[i];n._isPlaying&&!n._isPaused&&(n.update(t),n._isPlaying||(e.splice(i,1),i--))}0===e.length&&this.stop()},u.onPlay=function(){cc.director.getAnimationManager().addAnimator(this)},u.onStop=function(){this.playingAnims.length=0,cc.director.getAnimationManager().removeAnimator(this)},c.extend(r,n);var _=r.prototype;_.animate=function(t,e){if(!t)return cc.error("[animate] keyFrames must be non-nil"),null;s(t);var i=this._doAnimate(t,e);return this.play(),i},_._doAnimate=function(t,e){var i=new l(this,null,e);i.play();for(var n=i.curves,r=-1,s=0;s<t.length;s++){var o=t[s],c=o.ratio;if("number"!=typeof c&&(c=o.computedRatio),0>c)cc.error("[animate] ratio should >= 0!");else if(r>c)cc.error("[animate] ratio should in the order of smallest to largest!");else{r=c;for(var h in o){var d=o[h];if("props"===h)for(var u in d)a(n,this.target,u,d[u],c);else if("comps"===h)for(var _ in d){var f=this.target.getComponent(_),p=d[_];for(var u in p)a(n,f,u,p[u],c)}}}}return this.playingAnims.push(i),i},e.exports={Animator:n,EntityAnimator:r}},{"./animation-curves":5,"./playable":14,"./types":15}],9:[function(t,e,i){function n(t,e,i,n,r){var s=1-r;return t*s*s*s+3*e*s*s*r+3*i*s*r*r+n*r*r*r}function r(t){return 0>t?-Math.pow(-t,1/3):Math.pow(t,1/3)}function s(t,e){var i,n,s,o,l,_=e-0,f=e-t[0],p=e-t[2],g=e-1,m=3*_,y=3*f,v=3*p,T=-_+y-v+g,C=1/T,S=1/3,E=(m-6*f+v)*C,b=E*S,x=(-m+y)*C,A=_*C,R=(3*x-E*E)*S,I=R*S,P=(2*E*E*E-9*E*x+27*A)/27,L=P/2,w=L*L+I*I*I;if(0>w){var O=-R*S,F=O*O*O,N=u(F),D=-P/(2*N),B=-1>D?-1:D>1?1:D,M=c(B),W=r(N),z=2*W;return s=z*a(M*S)-b,o=z*a((M+d)*S)-b,l=z*a((M+2*d)*S)-b,s>=0&&1>=s?o>=0&&1>=o?l>=0&&1>=l?h(s,o,l):h(s,o):l>=0&&1>=l?h(s,l):s:o>=0&&1>=o?l>=0&&1>=l?h(o,l):o:l}if(0===w)return i=0>L?r(-L):-r(L),s=2*i-b,o=-i-b,s>=0&&1>=s?o>=0&&1>=o?h(s,o):s:o;var V=u(w);return i=r(-L+V),n=r(L+V),s=i-n-b}function o(t,e){var i=s(t,e),n=0,r=t[1],o=t[3],a=1,c=1-i;return n*c*c*c+3*r*i*c*c+3*o*i*i*c+a*i*i*i}var a=Math.cos,c=Math.acos,h=Math.max,l=Math.PI,d=2*l,u=Math.sqrt;e.exports={bezier:n,bezierByTime:o}},{}],10:[function(t,e,i){function n(t,e){for(var i=0,n=t.length-1;n>=i;){var s=i+n>>1;if(Math.abs(t[s]-e)<r)return s;t[s]>e?n=s-1:i=s+1}return~i}var r=1e-6;e.exports=n},{}],11:[function(t,e,i){function n(t,e){return function(i){return.5>i?e(2*i)/2:t(2*i-1)/2+.5}}var r={linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)))},elasticOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/n)+1)},elasticInOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n):i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)*.5+1)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?.5*t*t*((e+1)*t-e):.5*((t-=2)*t*((e+1)*t+e)+2)},bounceOut:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},smooth:function(t){return 0>=t?0:t>=1?1:t*t*(3-2*t)},fade:function(t){return 0>=t?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}};r.quadOutIn=n(r.quadIn,r.quadOut),r.cubicOutIn=n(r.cubicIn,r.cubicOut),r.quartOutIn=n(r.quartIn,r.quartOut),r.quintOutIn=n(r.quintIn,r.quintOut),r.sineOutIn=n(r.sineIn,r.sineOut),r.expoOutIn=n(r.expoIn,r.expoOut),r.circOutIn=n(r.circIn,r.circOut),r.backOutIn=n(r.backIn,r.backOut),r.backOutIn=n(r.backIn,r.backOut),r.bounceIn=function(t){return 1-r.bounceOut(1-t)},r.bounceInOut=function(t){return.5>t?.5*r.bounceIn(2*t):.5*r.bounceOut(2*t-1)+.5},r.bounceOutIn=n(r.bounceIn,r.bounceOut),cc.Easing=e.exports=r},{}],12:[function(t,e,i){t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animators"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")},{"./animation-animator":3,"./animation-clip":4,"./animation-curves":5,"./animation-manager":6,"./animation-state":7,"./animators":8,"./bezier":9,"./easing":11,"./motion-path-helper":13,"./types":15}],13:[function(t,e,i){function n(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function r(){this.start=l(),this.end=l(),this.startCtrlPoint=l(),this.endCtrlPoint=l()}function s(t,e,i,r){function s(t){return t instanceof cc.Vec2?{"in":t,pos:t,out:t}:Array.isArray(t)&&6===t.length?{"in":l(t[2],t[3]),pos:l(t[0],t[1]),out:l(t[4],t[5])}:{"in":cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}function c(t,e,i){f.push(t),p.push(e),g.push(i)}var d=e.values;if(0!==t.length&&0!==d.length){d=d.map(function(t){return l(t[0],t[1])});for(var u=e.types,_=e.ratios,f=e.values=[],p=e.types=[],g=e.ratios=[],m=0,y=2.220446049250313e-16,v=0,T=t.length;T-1>v;v++){var C=t[v],S=_[v],E=_[v+1],b=E-S,x=d[v],A=d[v+1],R=u[v],I=[],P=m/b,L=1/(b*i*r);if(C){var w=[];w.push(s(x));for(var O=0,F=C.length;F>O;O++){var N=s(C[O]);w.push(N)}w.push(s(A));var D=new n(w);D.computeBeziers();for(var B=D.progresses;1-P>y;){var M=P;M=a(M,R);var W=h(B,M);0>W&&(W=~W),M-=W>0?B[W-1]:0,M/=D.ratios[W];var z=D.beziers[W].getPointAt(M);I.push(z),P+=L}}else for(;1-P>y;){var M=P;M=a(M,R),I.push(x.lerp(A,M)),P+=L}for(var O=0,F=I.length;F>O;O++){var V=S+m+L*O*b;c(I[O],o.Linear,V)}m=Math.abs(P-1)>y?(P-1)*b:0}c(d[d.length-1],o.Linear,_[_.length-1])}}var o=t("./animation-curves").DynamicAnimCurve,a=t("./animation-curves").computeRatioByType,c=t("./bezier").bezier,h=(t("./bezier").bezierByTime,t("./binary-search")),l=cc.v2;n.prototype.computeBeziers=function(){this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var t=1;t<this.points.length;t++){var e=this.points[t-1],i=this.points[t],n=new r;n.start=e.pos,n.startCtrlPoint=e.out,n.end=i.pos,n.endCtrlPoint=i["in"],this.beziers.push(n),this.length+=n.getLength()}for(var s=0,t=0;t<this.beziers.length;t++){var n=this.beziers[t];this.ratios[t]=n.getLength()/this.length,this.progresses[t]=s+=this.ratios[t]}return this.beziers},r.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},r.prototype.getPoint=function(t){var e=c(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t),i=c(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new l(e,i)},r.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},r.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var e,i,n=[],r=this.getPoint(0),s=0;for(n.push(0),i=1;t>=i;i++)e=this.getPoint(i/t),s+=cc.pDistance(e,r),n.push(s),r=e;return this.cacheArcLengths=n,n},r.prototype.getUtoTmapping=function(t,e){var i,n=this.getLengths(),r=0,s=n.length;i=e?e:t*n[s-1];for(var o,a=0,c=s-1;c>=a;)if(r=Math.floor(a+(c-a)/2),o=n[r]-i,0>o)a=r+1;else{if(!(o>0)){c=r;break}c=r-1}if(r=c,n[r]===i){var h=r/(s-1);return h}var l=n[r],d=n[r+1],u=d-l,_=(i-l)/u,h=(r+_)/(s-1);return h},e.exports={sampleMotionPaths:s,Curve:n,Bezier:r}},{"./animation-curves":5,"./bezier":9,"./binary-search":10}],14:[function(t,e,i){function n(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var r=cc.js,s=n.prototype;r.get(s,"isPlaying",function(){return this._isPlaying},!0),r.get(s,"isPaused",function(){return this._isPaused},!0);var o=function(){};s.onPlay=o,s.onPause=o,s.onResume=o,s.onStop=o,s.onError=o,s.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError("already-playing"):(this._isPlaying=!0,this.onPlay())},s.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._isPaused=!1,this.onStop())},s.pause=function(){this._isPaused=!0,this.onPause()},s.resume=function(){this._isPaused=!1,this.onResume()},s.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.exports=n},{}],15:[function(t,e,i){function n(t,e,i){if(c.call(this),this.animator=t,this.curves=e||[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=a.Normal,i){this.delay=i.delay||this.delay;var n=i.duration;"undefined"!=typeof n&&(this.duration=n);var r=i.speed;"undefined"!=typeof r&&(this.speed=r);var s=i.wrapMode;if("undefined"!=typeof s){var h="number"==typeof s;this.wrapMode=h?s:a[s]}var l=i.repeatCount;"undefined"!=typeof l?this.repeatCount=l:this.wrapMode&o.Loop&&(this.repeatCount=1/0)}this.time=0,this._timeNoScale=0,this._firstFramePlayed=!1,this._duringDelay=!1,this.delay>0&&(this._duringDelay=!0)}var r=cc.js,s=t("./playable"),o={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},a=cc.Enum({Default:0,Normal:1,Reverse:o.Reverse,Loop:o.Loop,LoopReverse:o.Loop|o.Reverse,PingPong:o.PingPong,PingPongReverse:o.PingPong|o.Reverse});cc.WrapMode=a;var c=function(){s.call(this)};r.extend(c,s),c.prototype.update=function(t){},r.extend(n,c),r.mixin(n.prototype,{update:function(t){if(this._duringDelay){if(this._timeNoScale+=t,this._timeNoScale<this.delay)return;this._duringDelay=!1}this._firstFramePlayed?this.time+=t*this.speed:this._firstFramePlayed=!0,this.sample()&&this.stop()},_needRevers:function(t){var e=this.wrapMode,i=!1;if((e&o.PingPong)===o.PingPong){var n=t-(0|t)===0;n&&t>0&&(t-=1);var r=1&t;r&&(i=!i)}return(e&o.Reverse)===o.Reverse&&(i=!i),i},getWrappedInfo:function(t){var e=!1,i=this.duration,n=0,r=this.wrapMode,s=Math.abs(t/i);s>this.repeatCount&&(s=this.repeatCount);var a=!1;r&o.ShouldWrap&&(a=this._needRevers(s));var c=a?-1:1;if(this.speed<0&&(c*=-1),s>=this.repeatCount){e=!0;var h=this.repeatCount-(0|this.repeatCount);0===h&&(h=1),t=h*i*(t>0?1:-1)}if(t>i){var l=t%i;t=0===l?i:l}else 0>t&&(t%=i,0!==t&&(t+=i));return r&o.ShouldWrap&&a&&(t=i-t),n=t/i,{ratio:n,time:t,direction:c,stopped:e,iterations:s}},sample:function(){for(var t=this.getWrappedInfo(this.time),e=this.curves,i=0,n=e.length;n>i;i++){var r=e[i];r.sample(t.time,t.ratio,this)}return t.stopped}}),cc.AnimationNode=n,e.exports={WrapModeMask:o,WrapMode:a,AnimationNode:n}},{"./playable":14}],16:[function(t,e,i){function n(t){for(var e=t._children,i=0,r=e.length;r>i;i++){var s=e[i];s._dirtyFlags=0,n(s)}}var r=t("./event/event-target"),s=t("./platform/_CCClass"),o=t("./platform/CCObject");cc.g_NumberOfDraws=0,cc.Director=s.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_loadingScene:"",_runningScene:null,_scene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,ctor:function(){var t=this;r.call(t),t._lastUpdate=Date.now(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc._widgetManager.init(this),!0},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(t-this._lastUpdate)/1e3,cc.game.config[cc.game.CONFIG_KEY.debugMode]>0&&this._deltaTime>.2&&(this._deltaTime=1/60),this._lastUpdate=t},convertToGL:null,convertToUI:null,engineUpdate:function(t){this._scheduler.update(t)},visit:function(t){if(this.emit(cc.Director.EVENT_BEFORE_VISIT,this),this._beforeVisitScene&&this._beforeVisitScene(),this._scene&&n(this._scene),this._runningScene){var e=cc.renderer;e.childrenOrderDirty===!0?(e.clearRenderCommands(),this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),e.resetFlag()):e.transformDirty()===!0&&e.transform()}this._notificationNode&&this._notificationNode.visit(),this.emit(cc.Director.EVENT_AFTER_VISIT,this),this._afterVisitScene&&this._afterVisitScene()},render:function(t){cc.g_NumberOfDraws=0,cc.renderer.clear(),cc.renderer.rendering(cc._renderContext),this._totalFrames++,this.emit(cc.Director.EVENT_AFTER_DRAW)},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director.popScene),this._scenesStack.pop();var t=this._scenesStack.length;0===t?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){cc.animationCache._clear(),cc.spriteFrameCache._clear(),cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll(),cc.eventManager&&cc.eventManager.setEnabled(!1),this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData(),cc.checkGLErrorDebug()},pushScene:function(t){cc.assert(t,cc._LogInfos.Director.pushScene),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runScene:function(t,e){cc.assert(t,cc._LogInfos.Director.pushScene);var i=this._scene;cc.isValid(i)&&i.destroy(),this._scene=null,cc.Object._deferredDestroy(),e&&e(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t);for(var n=cc.game._persistRootNodes,r=0;r<n.length;++r){var s=n[r];s.parent=t}var o=t;if(t instanceof cc.Scene&&(t._load(),this._scene=t,o=t._sgNode),this._runningScene){var r=this._scenesStack.length;this._scenesStack[Math.max(r-1,0)]=o,this._sendCleanupToScene=!0,this._nextScene=o}else this.pushScene(o),this.startAnimation();this._nextScene&&this.setNextScene(),t instanceof cc.Scene&&t._activate()},loadScene:function(t,e,i){var n,r;if(this._loadingScene)return cc.error('[loadScene] Failed to load scene "%s" because "%s" is already loading',t,this._loadingScene),!1;if("string"==typeof t){t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://assets/")||(t="/"+t);for(var s=0;s<cc.game._sceneInfos.length;s++){r=cc.game._sceneInfos[s];var o=r.url;if(o.endsWith(t)){n=r.uuid;break}}}else{if(r=cc.game._sceneInfos[t],"object"!=typeof r)return cc.error("[loadScene] The scene index to load (%s) is out of range.",t),!1;n=r.uuid}return n?(this._loadingScene=t,this._loadSceneByUuid(n,e,i),!0):(cc.error('[loadScene] Can not load the scene "%s" because it has not been added to the build settings before play.',t),!1)},_loadSceneByUuid:function(t,e,i){cc.AssetLibrary.loadAsset(t,function(t,n){var r;if(t)t="Failed to load scene: "+t,cc.error(t);else{var s=n._uuid;r=n.scene,r instanceof cc.Scene?(r._id=s,cc.director.runScene(r,i)):(t="The asset "+s+" is not a scene",cc.error(t),r=null)}cc.director._loadingScene="",e&&e(t,r)})},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.log(cc._LogInfos.Director.resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;if(cc.TransitionScene&&(t=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,e=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1),!e){var i=this._runningScene;i&&(i.onExitTransitionDidStart(),i.onExit()),this._sendCleanupToScene&&i&&i.cleanup()}this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,t||null===this._runningScene||(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(t){cc.renderer.childrenOrderDirty=!0,this._notificationNode&&(this._notificationNode.onExitTransitionDidStart(),this._notificationNode.onExit(),this._notificationNode.cleanup()),this._notificationNode=t,t&&(this._notificationNode.onEnter(),this._notificationNode.onEnterTransitionDidFinish())},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getScene:function(){return this._scene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return cc.profiler?cc.profiler.isShowingStats():!1},setDisplayStats:function(t){cc.profiler&&(t?cc.profiler.showStats():cc.profiler.hideStats())},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assert(this._runningScene,cc._LogInfos.Director.popToSceneStackLevel_2);var e=this._scenesStack,i=e.length;if(0===i)return void this.end();if(!(t>i)){for(;i>t;){var n=e.pop();n.running&&(n.onExitTransitionDidStart(),n.onExit()),n.cleanup(),i--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!1}},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager=t)},getAnimationManager:function(){return this._animationManager},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){var t=Date.now();this._secondsPerFrame=(t-this._lastUpdate)/1e3}}),cc.js.addon(cc.Director.prototype,r.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_COMPONENT_UPDATE="director_component_update",cc.Director.EVENT_COMPONENT_LATE_UPDATE="director_component_late_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_BEFORE_VISIT="director_before_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||(this.calculateDeltaTime(),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this.emit(cc.Director.EVENT_COMPONENT_UPDATE,this._deltaTime),o._deferredDestroy(),this.engineUpdate(this._deltaTime),this.emit(cc.Director.EVENT_COMPONENT_LATE_UPDATE,this._deltaTime),this.emit(cc.Director.EVENT_AFTER_UPDATE)),this._nextScene&&this.setNextScene(),this.visit(this._deltaTime),this.render(this._deltaTime),this._calculateMPF())},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_3D},{"./event/event-target":48,"./platform/CCObject":58,"./platform/_CCClass":60}],17:[function(t,e,i){t("./CCDirector"),t("./CCGame"),cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.Director.prototype;t.getProjection=function(t){return this._projection},t.setProjection=function(t){this._projection=t,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this)},t.setDepthTest=function(){},t.setClearColor=function(t){cc.renderer._clearColor=t,cc.renderer._clearFillStyle="rgb("+t.r+","+t.g+","+t.b+")"},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,cc.eventManager&&cc.eventManager.setEnabled(!0)},t.getVisibleSize=function(){return this.getWinSize()},t.getVisibleOrigin=function(){return cc.p(0,0)}}else cc.Director._fpsImage=new Image,cc.Director._fpsImage.addEventListener("load",function(){cc.Director._fpsImageLoaded=!0}),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage)})},{"./CCDirector":16,"./CCGame":19}],18:[function(t,e,i){t("./CCDirector"),t("./CCGame");var n=function(t){cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,t);var e=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,e),t.multiply(e)};cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc._Class.extend({updateProjection:function(){}});var t=cc.Director.prototype,e=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty);var i,n=t._children;for(i=0;i<n.length;i++)e(n[i])}};cc.Director._getInstance().on(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var t=(cc.director,cc.director._scenesStack),i=0;i<t.length;i++)e(t[i])}),t.setProjection=function(t){var e=this,i=e._winSizeInPoints;e.setViewport();var n=e._openGLView,r=n._viewPortRect.x/n._scaleX,s=n._viewPortRect.y/n._scaleY;switch(t){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity();var o=cc.math.Matrix4.createOrthographicProjection(-r,i.width-r,-s,i.height-s,-1024,1024);cc.kmGLMultMatrix(o),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var a=e.getZEye(),c=new cc.math.Matrix4,h=new cc.math.Matrix4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),c=cc.math.Matrix4.createPerspectiveProjection(60,i.width/i.height,.1,2*a),cc.kmGLMultMatrix(c),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();var l=new cc.math.Vec3(-r+i.width/2,-s+i.height/2,a),d=new cc.math.Vec3(-r+i.width/2,-s+i.height/2,0),u=new cc.math.Vec3(0,1,0);h.lookAt(l,d,u),cc.kmGLMultMatrix(h);break;case cc.Director.PROJECTION_CUSTOM:e._projectionDelegate&&e._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director.setProjection)}e._projection=t,e.emit(cc.Director.EVENT_PROJECTION_CHANGED,e),cc.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){cc.renderer.setDepthTest(t)},t.setClearColor=function(t){cc.renderer._clearColor=t},t.setOpenGLView=function(t){var e=this;e._winSizeInPoints.width=cc._canvas.width,e._winSizeInPoints.height=cc._canvas.height,e._openGLView=t||cc.view;var i=cc.configuration;i.gatherGPUInfo(),i.dumpInfo(),e.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},t._clear=function(){var t=cc._renderContext;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t._beforeVisitScene=function(){cc.kmGLPushMatrix()},t._afterVisitScene=function(){cc.kmGLPopMatrix()},t.convertToGL=function(t){var e=new cc.math.Matrix4;n(e);var i=e.inverse(),r=e.mat[14]/e.mat[15],s=this._openGLView.getDesignResolutionSize(),o=new cc.math.Vec3(2*t.x/s.width-1,1-2*t.y/s.height,r);return o.transformCoord(i),cc.p(o.x,o.y)},t.convertToUI=function(t){var e=new cc.math.Matrix4;n(e);var i=new cc.math.Vec3(t.x,t.y,0);i.transformCoord(e);var r=this._openGLView.getDesignResolutionSize();return cc.p(r.width*(.5*i.x+.5),r.height*(.5*-i.y+.5))},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var t=this._openGLView;if(t){var e=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,e.width,e.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){t?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)},t.setGLDefaultValues=function(){var t=this;t.setAlphaBlending(!0),t.setDepthTest(!1),t.setProjection(t._projection),cc._renderContext.clearColor(0,0,0,0)}}})},{"./CCDirector":16,"./CCGame":19}],19:[function(t,e,i){var n=t("./event/event-target"),r={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESIZE:"game_on_resize",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_eventHide:null,_eventShow:null,_persistRootNodes:[],CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",registerSystemEvent:"registerSystemEvent",jsList:"jsList",scenes:"scenes"},_paused:!0,_isCloning:!1,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(t){var e=this,i=e.config,n=e.CONFIG_KEY;i[n.frameRate]=t,e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._paused=!0,e._setAnimFrame(),e._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._pausePlaying(),this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._resumePlaying(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.popToSceneStackLevel(0),cc.audioEngine&&cc.audioEngine.end(),r.onStart()},prepare:function(t){var e=this,i=e.config,n=e.CONFIG_KEY;if(this._loadConfig(),this._prepared)return void(t&&t());if(!this._prepareCalled){if(cc._engineLoaded){this._prepareCalled=!0,this._initRenderer(i[n.width],i[n.height]),cc.view=cc.EGLView._getInstance(),cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop();var r=i[n.jsList];return void(r?cc.loader.loadJsWithImg(r,function(i){if(i)throw new Error(i);e._prepared=!0,t&&t()}):t&&t())}cc.initEngine(this.config,function(){e.prepare(t)})}},run:function(t,e){"function"==typeof t?r.onStart=t:(t&&(r.config=t),"function"==typeof e&&(r.onStart=e)),this.prepare(r.onStart&&r.onStart.bind(r))},addPersistRootNode:function(t){if(!(!t instanceof cc.Node)){var e=this._persistRootNodes.indexOf(t);if(-1===e){var i=cc.director._scene;if(cc.isValid(i)){if(t.parent){if(t.parent!==i)return void cc.warn("The node can not be made persist because it's not under root node.")}else t.parent=i;this._persistRootNodes.push(t),t._persistNode=!0}}}},removePersistRootNode:function(t){var e=this._persistRootNodes.indexOf(t);-1!==e&&this._persistRootNodes.splice(e,1),t._persistNode=!1},isPersistRootNode:function(t){return t._persistNode},_setAnimFrame:function(){this._lastTime=new Date,this._frameTime=1e3/r.config[r.CONFIG_KEY.frameRate],cc.sys.os===cc.sys.OS_IOS&&cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT||60!==r.config[r.CONFIG_KEY.frameRate]?(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=(new Date).getTime(),i=Math.max(0,r._frameTime-(e-r._lastTime)),n=window.setTimeout(function(){t()},i);return r._lastTime=e+i,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t,e=this,i=e.config,n=e.CONFIG_KEY,r=cc.director;r.setDisplayStats(i[n.showFPS]),t=function(){e._paused||(r.mainLoop(),e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._intervalId=window.requestAnimFrame(t))},window.requestAnimFrame(t),e._paused=!1},_loadConfig:function(){if(this.config)return void this._initConfig(this.config);if(document.ccConfig)this._initConfig(document.ccConfig);else try{for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var i=t[e].getAttribute("cocos");if(""===i||i)break}var n,r,s;e<t.length&&(n=t[e].src,n&&(s=/(.*)\//.exec(n)[0],cc.loader.resPath=s,n=cc.path.join(s,"project.json")),r=cc.loader._loadTxtSync(n)),r||(r=cc.loader._loadTxtSync("project.json"));var o=JSON.parse(r);this._initConfig(o||{});

}catch(a){cc.log("Failed to read or parse project.json"),this._initConfig({})}},_initConfig:function(t){var e=this.CONFIG_KEY,i=t[e.modules];t[e.showFPS]=t[e.showFPS]||!1,t[e.engineDir]=t[e.engineDir]||"frameworks/cocos2d-html5",null==t[e.debugMode]&&(t[e.debugMode]=0),t[e.frameRate]=t[e.frameRate]||60,null==t[e.renderMode]&&(t[e.renderMode]=0),null==t[e.registerSystemEvent]&&(t[e.registerSystemEvent]=!0),i&&i.indexOf("core")<0&&i.splice(0,0,"core"),i&&(t[e.modules]=i),this._sceneInfos=this._sceneInfos.concat(t[e.scenes]),this.config=t},_initRenderer:function(t,e){if(!this._rendererInitialized){if(!cc._supportRender)throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var i,n,s,o=this.config[r.CONFIG_KEY.id],a=window,c=cc.$(o)||cc.$("#"+o);"CANVAS"===c.tagName?(t=t||c.width,e=e||c.height,this.canvas=cc._canvas=i=c,this.container=cc.container=n=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(n,i)):("DIV"!==c.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),t=t||c.clientWidth,e=e||c.clientHeight,this.canvas=cc._canvas=i=document.createElement("CANVAS"),this.container=cc.container=n=document.createElement("DIV"),c.appendChild(n)),n.setAttribute("id","Cocos2dGameContainer"),n.appendChild(i),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,i.addClass("gameCanvas"),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99),i.style.outline="none",s=n.style,s.width=(t||480)+"px",s.height=(e||320)+"px",s.margin="0 auto",s.position="relative",s.overflow="hidden",n.top="100%",cc._renderType===r.RENDER_TYPE_WEBGL&&(this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(i,{stencil:!0,preserveDrawingBuffer:!0,antialias:!cc.sys.isMobile,alpha:!0})),this._renderContext?(cc.renderer=cc.rendererWebGL,a.gl=this._renderContext,cc.shaderCache._init(),cc._drawingUtil=new cc.DrawingPrimitiveWebGL(this._renderContext),cc.textureCache._initializingRenderer()):(cc.renderer=cc.rendererCanvas,this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(i.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(this._renderContext):null),cc._gameDiv=n,r.canvas.oncontextmenu=function(){return cc._isContextMenuEnable?void 0:!1},this.emit(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){var t,e,i=window;this._eventHide=this._eventHide||new cc.Event.EventCustom(this.EVENT_HIDE),this._eventHide.setUserData(this),this._eventShow=this._eventShow||new cc.Event.EventCustom(this.EVENT_SHOW),this._eventShow.setUserData(this),this.config[this.CONFIG_KEY.registerSystemEvent]&&cc.inputManager.registerSystemEvent(this.canvas),cc.js.isUndefined(document.hidden)?cc.js.isUndefined(document.mozHidden)?cc.js.isUndefined(document.msHidden)?cc.js.isUndefined(document.webkitHidden)||(t="webkitHidden",e="webkitvisibilitychange"):(t="msHidden",e="msvisibilitychange"):(t="mozHidden",e="mozvisibilitychange"):(t="hidden",e="visibilitychange");var n=function(){cc.eventManager&&r._eventHide&&cc.eventManager.dispatchEvent(r._eventHide)},s=function(){cc.eventManager&&r._eventShow&&cc.eventManager.dispatchEvent(r._eventShow)};t?document.addEventListener(e,function(){document[t]?n():s()},!1):(i.addEventListener("blur",n,!1),i.addEventListener("focus",s,!1)),navigator.userAgent.indexOf("MicroMessenger")>-1&&(i.onfocus=function(){s()}),"onpageshow"in window&&"onpagehide"in window&&(i.addEventListener("pagehide",n,!1),i.addEventListener("pageshow",s,!1)),cc.eventManager.addCustomListener(r.EVENT_HIDE,function(){r.pause()}),cc.eventManager.addCustomListener(r.EVENT_SHOW,function(){r.resume()})}};n.call(r),cc.js.addon(r,n.prototype),cc.game=e.exports=r},{"./event/event-target":48}],20:[function(t,e,i){var n=cc.js,r=cc.Object.Flags,s=r.Destroying,o=r.DontDestroy,a=cc.Class({name:"cc.Node","extends":t("./utils/base-node"),mixins:[cc.EventTarget],properties:{active:{get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent&&this._parent._activeInHierarchy;e&&this._onActivatedInHierarchy(t)}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}},_active:!0,_components:[],_prefab:{"default":null,editorOnly:!0},_persistNode:{get:function(){return(this._objFlags&o)>0},set:function(t){t?this._objFlags|=o:this._objFlags&=~o}}},ctor:function(){var t=arguments[0];this._name="undefined"!=typeof t?t:"New Node",this._activeInHierarchy=!1,this._widget=null,this.__eventTargets=[]},statics:{_DirtyFlags:t("./utils/misc").DirtyFlags},destroy:function(){cc.Object.prototype.destroy.call(this)&&this._activeInHierarchy&&this._deactivateChildComponents()},_onPreDestroy:function(){var t,e;this._objFlags|=s;var i=this._parent,n=i&&i._objFlags&s,r=this._children;for(t=0,e=r.length;e>t;++t)r[t]._destroyImmediate();for(t=0,e=this._components.length;e>t;++t){var o=this._components[t];o._destroyImmediate()}for(t=0,e=this.__eventTargets.length;e>t;++t){var a=this.__eventTargets[t];a&&a.targetOff(this)}this.__eventTargets.length=0,this._persistNode&&cc.game.removePersistRootNode(this),n||(i&&i._children.splice(i._children.indexOf(this),1),this._removeSgNode())},getComponent:function(t){if(!t)return cc.error("getComponent: Type must be non-nil"),null;var e;if(e="string"==typeof t?n.getClassByName(t):t)for(var i=0;i<this._components.length;++i){var r=this._components[i];if(r instanceof e)return r}return null},_checkMultipleComp:!1,addComponent:function(t){if(this._objFlags&s,!1)return cc.error("isDestroying"),null;var e;if("string"==typeof t){if(e=n.getClassByName(t),!e)return cc.error('addComponent: Failed to get class "%s"',t),cc._RFpeek()&&cc.error('addComponent: Should not add component ("%s") when the scripts are still loading.',t),null}else{if(!t)return cc.error("addComponent: Type must be non-nil"),null;e=t}if("function"!=typeof e)return cc.error("addComponent: The component to add must be a constructor"),null;if(!cc.isChildClassOf(e,cc.Component))return cc.error("addComponent: The component to add must be child class of cc.Component"),null;if(e._disallowMultiple,!1)return null;var i=e._requireComponent;if(i&&!this.getComponent(i)){var r=this.addComponent(i);if(!r)return null}var o=new e;return o.node=this,this._components.push(o),this._activeInHierarchy&&o.__onNodeActivated(!0),o},_addComponentAt:!1,removeComponent:function(t){return t?("object"!=typeof t&&(t=this.getComponent(t)),void(t&&t.destroy())):void cc.error("removeComponent: Component must be non-nil")},_getDependComponent:!1,_removeComponent:function(t){if(!t)return void cc.error("Argument must be non-nil");if(!(this._objFlags&s)){var e=this._components.indexOf(t);-1!==e?(this._components.splice(e,1),t.node=null):t.node!==this&&cc.error("Component not owned by this entity")}},_registerIfAttached:!1,_onActivatedInHierarchy:function(t){this._activeInHierarchy=t;for(var e=this._components.length,i=0;e>i;++i){var n=this._components[i];!(n instanceof cc.Component),n.__onNodeActivated(t)}for(var r=0,s=this.childrenCount;s>r;++r){var o=this._children[r];o._active&&o._onActivatedInHierarchy(t)}},_onHierarchyChanged:function(t){!this._persistNode||this._parent instanceof cc.Scene||cc.game.removePersistRootNode(this);var e=this._active&&!(!t||!t._activeInHierarchy),i=this._active&&!(!this._parent||!this._parent._activeInHierarchy);e!==i&&this._onActivatedInHierarchy(i)},_deactivateChildComponents:function(){for(var t=this._components.length,e=0;t>e;++e){var i=this._components[e];i.__onNodeActivated(!1)}for(var n=0,r=this.childrenCount;r>n;++n){var s=this._children[n];s._active&&s._deactivateChildComponents()}},_instantiate:function(){var t=cc.instantiate._clone(this,this);return t._parent=null,t._onBatchCreated(),t},_onColorChanged:function(){for(var t=0;t<this._components.length;++t){var e=this._components[t];e instanceof cc._ComponentInSG&&e.isValid&&(e._sgNode.setColor(this._color),this._cascadeOpacityEnabled||e._sgNode.setOpacity(this._opacity))}},_onCascadeChanged:function(){for(var t=this._cascadeOpacityEnabled?255:this._opacity,e=0;e<this._components.length;++e){var i=this._components[e];i instanceof cc._ComponentInSG&&i.isValid&&i._sgNode.setOpacity(t)}},_onAnchorChanged:function(){for(var t=0;t<this._components.length;++t){var e=this._components[t];e instanceof cc._ComponentInSG&&e.isValid&&(e._sgNode.setAnchorPoint(this._anchorPoint),e._sgNode.ignoreAnchorPointForPosition(this._ignoreAnchorPointForPosition))}},_onOpacityModifyRGBChanged:function(){for(var t=0;t<this._components.length;++t){var e=this._components[t];e instanceof cc._ComponentInSG&&e.isValid&&e._sgNode.setOpacityModifyRGB(this._opacityModifyRGB)}}});cc.Node=e.exports=a},{"./utils/base-node":81,"./utils/misc":84}],21:[function(t,e,i){var n=function(){};cc.Scene=cc.Class({name:"cc.Scene","extends":t("./utils/base-node"),ctor:function(){var t=this._sgNode=new _ccsg.Scene;t.retain(),t.setAnchorPoint(0,0),this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning},destroy:function(){var t=this._children,e=cc.Object.Flags.DontDestroy;this._sgNode.release();for(var i=0,n=t.length;n>i;++i){var r=t[i];r.isValid&&(r._objFlags&e||r.destroy())}this._super(),this._activeInHierarchy=!1},_onHierarchyChanged:n,_onColorChanged:n,_onAnchorChanged:n,_onOpacityModifyRGBChanged:n,_onCascadeChanged:n,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0)},_activate:function(){var t,e,i=this._children,n=i.length;for(this._activeInHierarchy=!0,t=0;n>t;++t)e=i[t],e._active&&e._onActivatedInHierarchy(!0)}}),e.exports=cc.Scene},{"./utils/base-node":81}],22:[function(t,e,i){var n=t("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset","extends":n,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0,enumerable:!1})},properties:{url:{get:function(){if(this._rawFiles){if(cc.AssetLibrary){var t=cc.AssetLibrary.getImportedDir(this._uuid),e=this._rawFiles[0];return t+cc.path.sep+e}cc.error("asset.url is not usable in core process")}return""},visible:!1},urls:{get:function(){if(this._rawFiles){if(cc.AssetLibrary){var t=cc.AssetLibrary.getImportedDir(this._uuid);return this._rawFiles.map(function(e){return t+cc.path.sep+e})}cc.error("asset.urls is not usable in core process")}return[]},visible:!1},_rawFiles:null},statics:{deserialize:function(t){return cc.deserialize(t)}},serialize:function(){return Editor.serialize(this)},createNode:null,_setRawFiles:function(t){t=t.map(function(t){"."===t.charAt(0)&&(t=t.slice(1));var e=t.charAt(0);return("/"===e||"\\"===e)&&(t=t.slice(1)),t}),this._rawFiles=t.length>0?t:null}}),e.exports=cc.Asset},{"./CCRawAsset":27}],23:[function(t,e,i){var n=cc.Class({name:"cc.AudioClip","extends":cc.RawAsset});cc.AudioClip=n,e.exports=n},{}],24:[function(t,e,i){var n=cc.Class({name:"cc.BitmapFont","extends":cc.Font});cc.BitmapFont=n,e.exports=n},{}],25:[function(t,e,i){var n=cc.Class({name:"cc.Font","extends":cc.RawAsset});cc.Font=n,e.exports=n},{}],26:[function(t,e,i){var n=cc.Class({name:"cc.Prefab","extends":cc.Asset,properties:{data:null},createNode:function(t){},_instantiate:function(){var t=cc.instantiate(this.data);return t}});cc.Prefab=e.exports=n,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{}],27:[function(t,e,i){var n=t("../platform/CCObject");cc.RawAsset=cc.Class({name:"cc.RawAsset","extends":n,statics:{createNodeByInfo:null}}),e.exports=cc.RawAsset},{"../platform/CCObject":58}],28:[function(t,e,i){var n=cc.Class({name:"cc.SceneAsset","extends":cc.Asset,properties:{scene:null}});cc.SceneAsset=n,e.exports=n},{}],29:[function(t,e,i){var n=cc.Class({name:"cc.Script","extends":cc.Asset});cc._Script=n;var r=cc.Class({name:"cc.JavaScript","extends":n});cc._JavaScript=r;var s=cc.Class({name:"cc.CoffeeScript","extends":n});cc._CoffeeScript=s},{}],30:[function(t,e,i){var n=cc.Class({name:"cc.SpriteAnimationAsset","extends":cc.Asset,properties:{0:{"default":"",url:cc.Texture2D},1:{"default":"",url:cc.Texture2D},2:{"default":"",url:cc.Texture2D},3:{"default":"",url:cc.Texture2D},4:{"default":"",url:cc.Texture2D},5:{"default":"",url:cc.Texture2D},6:{"default":"",url:cc.Texture2D},7:{"default":"",url:cc.Texture2D},8:{"default":"",url:cc.Texture2D},9:{"default":"",url:cc.Texture2D},loop:{"default":!0},delay:{"default":.5}}});cc.SpriteAnimationAsset=n,e.exports=n},{}],31:[function(t,e,i){var n=cc.Class({name:"cc.SpriteAtlas","extends":cc.RawAsset});cc.SpriteAtlas=n,e.exports=n},{}],32:[function(t,e,i){var n=cc.Class({name:"cc.TTFFont","extends":cc.Font});cc.TTFFont=n,e.exports=n},{}],33:[function(t,e,i){var n=cc.Class({name:"cc.TiledMapAsset","extends":cc.RawAsset,statics:{createNodeByInfo:function(t,e){}}});cc.TiledMapAsset=n,e.exports=n},{"fire-url":void 0}],34:[function(t,e,i){t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCBitmapFont"),t("./CCScripts"),t("./CCSceneAsset"),t("../sprites/CCSpriteFrame"),t("../textures/CCTexture2D"),t("./CCTTFFont"),t("./CCSpriteAnimation"),t("./CCSpriteAtlas"),t("./CCTiledMapAsset")},{"../sprites/CCSpriteFrame":73,"../textures/CCTexture2D":74,"./CCAsset":22,"./CCAudioClip":23,"./CCBitmapFont":24,"./CCFont":25,"./CCPrefab":26,"./CCRawAsset":27,"./CCSceneAsset":28,"./CCScripts":29,"./CCSpriteAnimation":30,"./CCSpriteAtlas":31,"./CCTTFFont":32,"./CCTiledMapAsset":33}],35:[function(t,e,i){function n(t){return t instanceof cc.Scene?cc.visibleRect:!t._sizeProvider||t._sizeProvider instanceof _ccsg.Node?t._contentSize:t.getContentSize()}function r(t,e){var i,r,s,o,a=t._parent,c=n(a),h=c.width,l=c.height,d=a._anchorPoint;if(a instanceof cc.Scene){var u=cc.visibleRect;i=u.left.x,r=u.right.x,o=u.bottom.y,s=u.top.y}else i=-d.x*h,r=i+h,o=-d.y*l,s=o+l;i+=e._isAbsLeft?e._left:e._left*h,r-=e._isAbsRight?e._right:e._right*h,o+=e._isAbsBottom?e._bottom:e._bottom*l,s-=e._isAbsTop?e._top:e._top*l;var _,f=t.getAnchorPoint(),p=t._position.x,g=f.x;if(e.isStretchWidth)_=r-i,t.width=_,p=i+g*_;else if(_=t.width,e.isAlignHorizontalCenter){var m=(.5-d.x)*h;p=m+(g-.5)*_}else e.isAlignLeft?p=i+g*_:e.isAlignRight&&(p=r+g*_-_);var y,v=t._position.y,T=f.y;if(e.isStretchHeight)y=s-o,t.height=y,v=o+T*y;else if(y=t.height,e.isAlignVerticalCenter){var C=(.5-d.y)*l;v=C+(T-.5)*y}else e.isAlignBottom?v=o+T*y:e.isAlignTop&&(v=s+T*y-y);t.setPosition(p,v)}function s(t){var e=t._widget;e&&r(t,e);for(var i=t._children,n=0;n<i.length;n++){var o=i[n];o._active&&s(o)}}function o(){var t=cc.director.getScene();t&&s(t)}cc._widgetManager={init:function(t){t.on(cc.Director.EVENT_BEFORE_VISIT,o)},add:function(t){t.node._widget=t},remove:function(t){t.node._widget=null},_getParentSize:n}},{}],36:[function(t,e,i){function n(t,e){return t===e?!0:t&&e&&(t.name===e.name||t._uuid===e._uuid)}var r=t("../../animation/animation-animator"),s=t("../../animation/animation-clip"),o=cc.Class({name:"cc.AnimationComponent","extends":t("./CCComponent"),editor:!1,ctor:function(){this._animator=null,this._nameToState={},this._didInit=!1,this._currentClip=null},properties:{defaultClip:{"default":null,type:s,displayName:"Animation"},currentClip:{get:function(){return this._currentClip},set:function(t,e){this._currentClip=t},type:s,visible:!1},_clips:{"default":[],type:[s],displayName:"Animations",visible:!0},playAutomatically:!0},onLoad:function(){if(this._init(),this.playAutomatically&&this.defaultClip){var t=this.getAnimationState(this.defaultClip.name);this._animator.playState(t)}},onDisable:function(){this.setCurrentTime(0),this.stop()},play:function(t,e){this._init();var i=this.getAnimationState(t||this.defaultClip.name);return i&&(i.isPlaying?i.isPaused?this._animator.resumeState(i):(this._animator.stopState(i),this._animator.playState(i,e)):this._animator.playState(i,e),this.currentClip=i.clip),i},stop:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.stopState(e)}else this._animator.stop()},pause:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.pauseState(e)}else this._animator.pause()},resume:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.resumeState(e)}else this._animator.resume()},setCurrentTime:function(t,e){if(this._init(),e){var i=this._nameToState[e];i&&this._animator.setStateTime(i,t)}else for(var e in this._nameToState)i=this._nameToState[e],this._animator.setStateTime(i,t)},getAnimationState:function(t){this._init();var e=this._nameToState[t];return e||null},addClip:function(t,e){if(!t)return void cc.warn("Invalid clip to add");this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),e=e||t.name;var i=this._nameToState[e];if(i){if(i.clip===t)return i;this._clips.splice(this._clips.indexOf(i.clip),1)}var n=new cc.AnimationState(t,e);return this._nameToState[e]=n,n},_removeStateIfNotUsed:function(t,e){var i=t.clip!==this.defaultClip&&!cc.js.array.contains(this._clips,t.clip);(e||i)&&(t.isPlaying&&this.stop(t.name),delete this._nameToState[t.name])},removeClip:function(t,e){if(!t)return void cc.warn("Invalid clip to remove");this._init(),this._clips=this._clips.filter(function(e){return e!==t});var i;for(var n in this._nameToState){i=this._nameToState[n];var r=i.clip;r===t&&this._removeStateIfNotUsed(i,e)}},sample:function(){this._init(),this._animator.sample()},_init:function(){this._didInit||(this._didInit=!0,this._animator=new r(this.node,this),this._createStates())},_createStates:function(){for(var t=null,e=!1,i=0;i<this._clips.length;++i){var r=this._clips[i];r&&(t=new cc.AnimationState(r),this._nameToState[t.name]=t,n(this.defaultClip,r)&&(e=t))}this.defaultClip&&!e&&(t=new cc.AnimationState(this.defaultClip),this._nameToState[t.name]=t)},_updateClip:!1});cc.AnimationComponent=e.exports=o},{"../../animation/animation-animator":3,"../../animation/animation-clip":4,"./CCComponent":40}],37:[function(t,e,i){var n=cc.audioEngine,r=cc.Class({name:"cc.Audio","extends":t("./CCComponent"),editor:!1,ctor:function(){this.audio=null},properties:{_clip:{"default":"",url:cc.AudioClip},_volume:1,_mute:!1,_loop:!1,isPlaying:{get:function(){return this.audio&&this.audio.getPlaying()},visible:!1},clip:{get:function(){return this._clip},set:function(t){this._clip=t},url:cc.AudioClip},volume:{get:function(){return this._volume},set:function(t){this._volume=t,this.audio&&this.audio.setVolume(t)}},mute:{get:function(){return this._mute},set:function(t){this._mute=t,this.audio&&this.audio.setVolume(this._mute?0:this._volume)}},loop:{get:function(){return this._loop},set:function(t){this._loop=t,this.audio&&(this.audio.loop=this._loop)}},playOnLoad:!0},onLoad:function(){this.isPlaying&&this.stop()},onEnable:function(){this.playOnLoad&&this.play()},onDisable:function(){this.stop()},onDestroy:function(){this.stop()},play:function(){this._clip&&(this.audio=n.playEffect(this._clip,this._loop),this.audio.play())},stop:function(){this.audio&&this.audio.stop()},pause:function(){this.audio&&this.audio.pause()},resume:function(){this.audio&&this.audio.resume()},rewind:function(){this.audio&&(this.audio.stop(),this.audio.play())}});cc.AudioSource=e.exports=r},{"./CCComponent":40}],38:[function(t,e,i){var n=t("../event/event-target"),r=cc.Enum({NONE:0,COLOR:1,SPRITE:2}),s=cc.Class({name:"cc.ClickEvent",properties:{target:{"default":null,type:cc.Node},component:{"default":""},handler:{"default":""}}}),o=cc.Color.WHITE,a={Normal:"normal",Pressed:"pressed",Hover:"hover",Disabled:"disabled"},c="touch-down",h="touch-up",l="hover-in",d="hover-move",u="hover-out",_=cc.Class({name:"cc.Button","extends":t("./CCComponent"),ctor:function(){n.call(this),this._touchListener=null,this._mouseListener=null,this._pressed=!1,this._hovered=!1,this._sprite=null,this._fromColor=null,this._toColor=null,this._time=0,this._tarnsitionFinished=!0},editor:!1,properties:{interactable:{"default":!0,notify:function(){this._initState()}},transition:{"default":r.NONE,type:r},normalColor:{"default":o,displayName:"Normal",notify:function(){this._initState()}},pressedColor:{"default":o,displayName:"Pressed"},hoverColor:{"default":o,displayName:"Hover"},disabledColor:{"default":o,displayName:"Disabled",notify:function(){this._initState()}},duration:{"default":.1,range:[0,Number.MAX_VALUE]},normalSprite:{"default":null,type:cc.SpriteFrame,displayName:"Normal",notify:function(){this._initState()}},pressedSprite:{"default":null,type:cc.SpriteFrame,displayName:"Pressed"},hoverSprite:{"default":null,type:cc.SpriteFrame,displayName:"Hover"},disabledSprite:{"default":null,type:cc.SpriteFrame,displayName:"Disabled",notify:function(){this._initState()}},target:{"default":null,type:cc.Node,notify:function(){this._applyTarget()}},clickEvents:{"default":[],type:s}},statics:{EVENT_TOUCH_DOWN:c,EVENT_TOUCH_UP:h,EVENT_HOVER_IN:l,EVENT_HOVER_MOVE:d,EVENT_HOVER_OUT:u,Transition:r,ClickEvent:s},onLoad:function(){this.target||(this.target=this.node),this._registerEvent(),this._registerListeners()},start:function(){this._applyTarget(),this._initState()},onDestroy:function(){this._touchListener&&cc.eventManager.removeListener(this._touchListener),this._mouseListener&&cc.eventManager.removeListener(this._mouseListener)},update:function(t){var e=this.target;if(!this.transition!==r.COLOR&&e&&!this._tarnsitionFinished){this.time+=t;var i=this.time/this.duration;i>1&&(i=1,this._tarnsitionFinished=!0),e.color=this._fromColor.lerp(this._toColor,i)}},_registerEvent:function(){this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan.bind(this),onTouchEnded:this._onTouchEnded.bind(this)}),cc.eventManager.addListener(this._touchListener,this.node._sgNode),cc.sys.isMobile||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseMove:this._onMouseMove.bind(this)}),cc.eventManager.addListener(this._mouseListener,this.node._sgNode))},_registerListeners:function(){for(var t=this.clickEvents,e=0,i=t.length;i>e;e++){var n=t[e],r=n.target;if(r){var s=r.getComponent(n.component);if(s){var o=s[n.handler];o&&this.on(h,o.bind(s))}}}},_applyTarget:function(){var t=this.target;this._sprite=t?t.getComponent(cc.SpriteRenderer):null},_initState:function(){var t=this.interactable?a.Normal:a.Disabled;this._applyState(t)},_onTouchBegan:function(t){if(!this.interactable)return!1;var e=this._hitTest(t.getLocation());return e&&(this._pressed=!0,this._applyState(a.Pressed),this.emit(c)),e},_onTouchEnded:function(){this._applyState(this._hovered?a.Hover:a.Normal),this.emit(h),this._pressed=!1},_onMouseMove:function(t){if(!this._pressed&&this.interactable){var e=this._hitTest(t.getLocation());e?(this._hovered||(this._hovered=!0,this._applyState(a.Hover),this.emit(l)),this.emit(d)):this._hovered&&(this._hovered=!1,this._applyState(a.Normal),this.emit(u))}},_applyState:function(t){var e=this[t+"Color"],i=this[t+"Sprite"];this._applyTransition(e,i)},_applyTransition:function(t,e){var i=this.transition;if(i===r.COLOR){var n=this.target;this._fromColor=n.color.clone(),this._toColor=t,this.time=0,this._tarnsitionFinished=!1}else i===r.SPRITE&&this._sprite&&e&&(this._sprite.sprite=e)},_hitTest:function(t){var e=this.target;if(!e)return!1;var i=e.width,n=e.height,r=e.getAnchorPoint(),s=cc.rect(-r.x*i,-r.y*n,i,n);return cc.rectContainsPoint(s,e.convertToNodeSpace(t))}});cc.js.addon(_.prototype,n.prototype),cc.EButton=e.exports=_},{"../event/event-target":48,"./CCComponent":40}],39:[function(t,e,i){var n={getContentSize:function(){return cc.view.getDesignResolutionSize()},setContentSize:function(t){},_getWidth:function(){return this.getContentSize().width},_getHeight:function(){return this.getContentSize().height}},r=cc.Class({name:"cc.Canvas","extends":t("./CCComponent"),editor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()}},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings())}},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings())}}},ctor:function(){this._thisOnResized=this.onResized.bind(this)},onLoad:function(){return r.instance?cc.error("Can't init canvas '%s' because it conflicts with the existing '%s', the scene should only have one active canvas at the same time",this.node.name,r.instance.node.name):(r.instance=this,this.node._sizeProvider?cc.error("CCCanvas: Node can only have one size."):this.node._sizeProvider=n,cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isNative||(cc.sys.isMobile?window.addEventListener("resize",this._thisOnResized):cc.eventManager.addCustomListener("canvas-resize",this._thisOnResized)),this.onResized(),void this.applySettings())},onDestroy:function(){this.node._sizeProvider===n&&(this.node._sizeProvider=null),cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isNative||(cc.sys.isMobile?window.removeEventListener("resize",this._thisOnResized):cc.eventManager.removeCustomListeners("canvas-resize",this._thisOnResized)),r.instance===this&&(r.instance=null)},alignWithScreen:function(){var t=this.node.getAnchorPoint(),e=cc.view.getDesignResolutionSize(),i=this.fitHeight!==this.fitWidth,n=0,r=0;if(i){var s=cc.visibleRect;n=.5*(s.width-e.width),r=.5*(s.height-e.height)}this.node.setPosition(e.width*t.x+n,e.height*t.y+r)},onResized:function(){this.alignWithScreen()},applySettings:function(){var t,e=cc.ResolutionPolicy;t=this.fitHeight&&this.fitWidth?e.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?e.FIXED_WIDTH:e.FIXED_HEIGHT:e.NO_BORDER;var i=this._designResolution;cc.view.setDesignResolutionSize(i.width,i.height,t)}});cc.Canvas=e.exports=r},{"./CCComponent":40}],40:[function(t,e,i){function n(t,e){var i=t._objFlags&o;e?i||(t.onEnable&&t.onEnable(),r(t,!0),t._objFlags|=o):i&&(t.onDisable&&t.onDisable(),r(t,!1),t._objFlags&=~o)}function r(t,e){!e||!t.start||t._objFlags&c||cc.director.once(cc.Director.EVENT_BEFORE_UPDATE,m,t),t.update&&(e?cc.director.on(cc.Director.EVENT_COMPONENT_UPDATE,y,t):cc.director.off(cc.Director.EVENT_COMPONENT_UPDATE,y,t)),t.lateUpdate&&(e?cc.director.on(cc.Director.EVENT_COMPONENT_LATE_UPDATE,v,t):cc.director.off(cc.Director.EVENT_COMPONENT_LATE_UPDATE,v,t))}t("../platform/CCObject"),t("../CCNode");var s=cc.Object.Flags,o=s.IsOnEnableCalled,a=s.IsOnLoadCalled,c=s.IsOnStartCalled,h=!1,l=!1,d=!1,u=!1,_=!1,f=!1,p=!1,g=!1,m=function(){this.start(),this._objFlags|=c},y=function(t){this.update(t.detail)},v=function(t){this.lateUpdate(t.detail)},T=0,C=!1,S=!1,E=cc.Class({name:"cc.Component","extends":cc.Object,ctor:!1,properties:{node:{"default":null,visible:!1},_id:{"default":"",serializable:!1},uuid:{get:function(){var t=this._id;return t?t:void 0},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy&&n(this,t))},visible:!1},enabledInHierarchy:{get:function(){return this._enabled&&this.node._activeInHierarchy},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&a},visible:!1},__eventTargets:{"default":[],serializable:!1},localSize:{get:function(){return cc.size(0,0)},visible:!1}},update:null,lateUpdate:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditMode:null,onLostFocusInEditMode:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&n(this,!1)},__onNodeActivated:function(t){this._objFlags&a||(this.onLoad&&this.onLoad(),this._objFlags|=a),this._enabled&&n(this,t)},_onPreDestroy:function(){var t,e,i;for(n(this,!1),t=0,e=this.__eventTargets.length;e>t;++t)i=this.__eventTargets[t],i&&i.targetOff(this);this.__eventTargets.length=0,this.onDestroy&&this.onDestroy(),this.node._removeComponent(this)}});E._requireComponent=null,Object.defineProperty(E,"_registerEditorProps",{value:function(t,e){var i=e.requireComponent;i&&(t._requireComponent=i)}}),E.prototype.__scriptUuid="",cc.Component=e.exports=E},{"../CCNode":20,"../platform/CCObject":58}],41:[function(t,e,i){var n=t("../utils/scene-graph-helper"),r=cc.Class({"extends":t("./CCComponent"),editor:!1,ctor:function(){this._sgNode=null},onLoad:function(){var t=this._createSgNode();this._appendSgNode(t),this.node._sizeProvider||(this.node._sizeProvider=t)},onEnable:function(){this._sgNode&&(this._sgNode.visible=!0)},onDisable:function(){this._sgNode&&(this._sgNode.visible=!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),this._removeSgNode()},_createSgNode:null,_removeSgNode:n.removeSgNode,_appendSgNode:function(t){var e=this.node;t.setColor(e._color),e._cascadeOpacityEnabled||t.setOpacity(e._opacity),t.setAnchorPoint(e._anchorPoint),t.ignoreAnchorPointForPosition(e._ignoreAnchorPointForPosition),t.setOpacityModifyRGB(e._opacityModifyRGB),t.setLocalZOrder(-1);var i=e._sgNode;i.addChild(t),t.retain(),this._sgNode=t}});cc._ComponentInSG=e.exports=r},{"../utils/scene-graph-helper":85,"./CCComponent":40}],42:[function(t,e,i){var n=cc.TextAlignment,r=cc.VerticalTextAlignment,s=cc.Label.Overflow,o=(cc.Label.Type,cc.Class({name:"cc.Label","extends":cc._ComponentInSG,editor:!1,properties:{_useOriginalSize:!0,string:{"default":"Label",multiline:!0,notify:function(){var t=this._sgNode;t&&t.setString(this.string)}},horizontalAlign:{"default":n.LEFT,type:n,notify:function(){var t=this._sgNode;t&&t.setHorizontalAlign(this.horizontalAlign)}},verticalAlign:{"default":r.TOP,type:r,notify:function(){var t=this._sgNode;t&&t.setVerticalAlign(this.verticalAlign)}},_fontSize:40,fontSize:{get:function(){var t=this._sgNode;return t&&(this._fontSize=t.getFontSize()),this._fontSize},set:function(t){this._fontSize=t;var e=this._sgNode;e&&e.setFontSize(t)}},_lineHeight:20,lineHeight:{get:function(){var t=this._sgNode;return t&&(this._lineHeight=t.getLineHeight()),this._lineHeight},set:function(t){this._lineHeight=t;var e=this._sgNode;e&&e.setLineHeight(t)}},overflow:{"default":s.CLAMP,type:s,notify:function(){var t=this._sgNode;t&&t.setOverflow(this.overflow)}},_enableWrapText:!0,enableWrapText:{get:function(){var t=this._sgNode;return t&&(this._enableWrapText=t.isWrapTextEnabled()),this._enableWrapText},set:function(t){this._enableWrapText=t;var e=this._sgNode;e&&e.enableWrapText(t)}},file:{"default":"Arial",url:cc.Font,notify:function(){var t=this._sgNode;t&&t.setFontFileOrFamily(this.file)}},_isSystemFontUsed:!0,useSystemFont:{get:function(){var t=this._sgNode;return t&&(this._isSystemFontUsed=t.isSystemFontUsed()),this._isSystemFontUsed},set:function(t){var e=this._sgNode;this._isSystemFontUsed=t,t&&e&&(this.file="",e.setSystemFontUsed(t))}}},onLoad:function(){this._super(),this.node.on("size-changed",this._resized,this)},onDestroy:function(){this._super(),this.node.off("size-changed",this._resized,this)},_createSgNode:function(){var t=new cc.Label(this.string,this.file,cc.Label.Type.TTF);return t.setHorizontalAlign(this.horizontalAlign),t.setVerticalAlign(this.verticalAlign),t.setFontSize(this.fontSize),t.setOverflow(this.overflow),t.enableWrapText(this.enableWrapText),t.setLineHeight(this.lineHeight),this._useOriginalSize||t.setContentSize(this.node.getContentSize()),t.setColor(this.node.color),t},_resized:function(){this._useOriginalSize=!1}}));cc.ELabel=e.exports=o},{}],43:[function(t,e,i){var n=cc.Enum({HORIZONTAL:0,VERTICAL:1}),r=cc.Class({name:"cc.ProgressBar","extends":t("./CCComponent"),editor:!1,_initBarSprite:function(){if(this.barSprite){var t=this.barSprite.node,e=this.node.getContentSize(),i=this.node.getAnchorPoint(),r=t.getContentSize();t.parent===this.node&&this.node.setContentSize(r);var s=t.getContentSize();

if(this.totalLength=this.mode===n.HORIZONTAL?s.width:s.height,t.parent===this.node){var o=-e.width*i.x,a=0;t.setPosition(cc.p(o,a))}}},_updateBarStatus:function(){if(this.barSprite){var t,e,i,r=this.barSprite.node,s=r.getAnchorPoint(),o=r.getContentSize(),a=r.getPosition(),c=cc.p(0,.5),h=this.totalLength*this.progress;switch(this.mode){case n.HORIZONTAL:this.reverse&&(c=cc.p(1,.5)),t=cc.size(h,o.height),e=this.totalLength,i=o.height;break;case n.VERTICAL:c=this.reverse?cc.p(.5,1):cc.p(.5,0),t=cc.size(o.width,h),e=o.width,i=this.totalLength}var l=c.x-s.x,d=c.y-s.y,u=cc.p(e*l,i*d);r.setPosition(cc.pAdd(a,u)),r.setAnchorPoint(c),r.setContentSize(t)}},properties:{barSprite:{"default":null,type:cc.SpriteRenderer,notify:function(){this._initBarSprite()}},mode:{"default":n.HORIZONTAL,type:n,notify:function(){if(this.barSprite){var t=this.barSprite.node,e=t.getContentSize();this.mode===n.HORIZONTAL?this.totalLength=e.width:this.mode===n.VERTICAL&&(this.totalLength=e.height)}}},totalLength:{"default":1,range:[0,Number.MAX_VALUE],notify:function(t){this._updateBarStatus()}},progress:{"default":1,type:"Float",range:[0,1,.1],notify:function(){this._updateBarStatus()}},reverse:{"default":!1,notify:function(){this._updateBarStatus()}}}});cc.ProgressBar=e.exports=r},{"./CCComponent":40}],44:[function(t,e,i){var n=cc.SpriteType,r=cc.Class({name:"cc.Sprite","extends":t("./CCComponentInSG"),editor:!1,properties:{_sprite:{"default":null,type:cc.SpriteFrame},_type:n.SIMPLE,_isFlippedX:!1,_isFlippedY:!1,_useOriginalSize:!0,_atlas:{"default":"",url:cc.SpriteAtlas,editorOnly:!0,visible:!0},sprite:{get:function(){return this._sprite},set:function(t,e){var i=this._sprite;this._sprite=t,this._sgNode&&(this._applySprite(this._sgNode,i),this._sgNode.setColor(this.node._color),this._sgNode.setOpacity(this.node._opacity))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(t){this._type=t,this._sgNode.setRenderingType(this._type),this._applyCapInset()},type:n},useOriginalSize:{get:function(){return this._useOriginalSize},set:function(t){this._useOriginalSize=t,t&&this._applySpriteSize()}},localSize:{get:function(){var t=this._sgNode;return t?cc.size(t.width,t.height):cc.size(0,0)},visible:!1}},setVisible:function(t){this.enabled=t},setScale9Enabled:function(t){this.type=t?cc.SpriteType.SLICED:cc.SpriteType.SIMPLE},isScale9Enabled:function(){return this.type===cc.SpriteType.SLICED},getSprite:function(){return this._sprite},initWithFile:function(t,e,i){this._sgNode.initWithFile(t,e,i)},initWithSpriteFrame:function(t,e){this._sprite=t,this._sgNode.initWithSpriteFrame(t,e)},initWithSpriteFrameName:function(t,e){var i=this._sgNode.initWithSpriteFrame(t,e);i!==!1&&(this._sprite=this._sgNode.getSprite())},resizableSpriteWithCapInsets:function(t){return this._sgNode.resizableSpriteWithCapInsets(t)},updateWithSprite:function(t,e,i,n,r,s){return this._sprite=t,this._sgNode.updateWithSprite(t,e,i,n,r,s)},setSpriteFrame:function(t,e){this.sprite=t,this.setCapInsets(e)},getOriginalSize:function(){return this._sgNode.getOriginalSize()},setPreferredSize:function(t){this.node.setContentSize(t)},getPreferredSize:function(){return this._sgNode.getPreferredSize()},setCapInsets:function(t){this._sgNode.setCapInsets(t)},getCapInsets:function(){return this._sgNode.getCapInsets()},setInsetLeft:function(t){this._sgNode.setInsetLeft(t)},getInsetLeft:function(){return this._sgNode.getInsetLeft()},setInsetTop:function(t){this._sgNode.setInsetTop(t)},getInsetTop:function(){return this._sgNode.getInsetTop()},setInsetRight:function(t){this._sgNode.setInsetRight(t)},getInsetRight:function(){return this._sgNode.getInsetRight()},setInsetBottom:function(t){this._sgNode.setInsetBottom(t)},getInsetBottom:function(){return this._sgNode.getInsetBottom()},setFlippedX:function(t){this._isFlippedX=t,this._sgNode.setFlippedX(t)},isFlippedX:function(){return this._isFlippedX},setFlippedY:function(t){this._isFlippedY=t,this._sgNode.setFlippedY(t)},isFlippedY:function(){return this._isFlippedY},onLoad:function(){this._super(),this.node.on("size-changed",this._resized,this)},onDestroy:function(){this._super(),this.node.off("size-changed",this._resized,this)},_applyCapInset:function(t){if(this._type===n.SLICED){var t=t||this._sgNode;t.setInsetTop(this._sprite.insetTop),t.setInsetBottom(this._sprite.insetBottom),t.setInsetRight(this._sprite.insetRight),t.setInsetLeft(this._sprite.insetLeft)}},_applySpriteSize:function(t){var t=t||this._sgNode;if(this._useOriginalSize){var e=this._sprite.getRect();t.setPreferredSize(cc.size(e.width,e.height))}else t.setPreferredSize(this.node.getContentSize(!0))},_applySprite:function(t,e){if(e&&e.off&&e.off("load",this._applyCapInset,this),this._sprite){t.initWithSpriteFrame(this._sprite,cc.rect(0,0,0,0));var i=this._sprite.textureLoaded();i?(this._applyCapInset(t),this._applySpriteSize(t)):(this._useOriginalSize||t.setPreferredSize(this.node.getContentSize(!0)),this._sprite.once("load",function(){this._applyCapInset(),this._applySpriteSize()},this))}},_createSgNode:function(){var t=new cc.Scale9Sprite;return t.setRenderingType(this._type),this._applySprite(t,null),t},_resized:function(){this.useOriginalSize=!1}}),s=t("../utils/misc"),o=["atlas","capInsets","insetLeft","insetTop","insetRight","insetBottom"],a={type:[null,"setRenderingType"],sprite:["getSprite",null],flippedX:["isFlippedX","setFlippedX"],flippedY:["isFlippedY","setFlippedY"]};s.propertyDefine(r,o,a),cc.SpriteRenderer=e.exports=r},{"../utils/misc":84,"./CCComponentInSG":41}],45:[function(t,e,i){var n=1,r=2,s=4,o=8,a=16,c=32,h=n|s,l=o|c,d=cc.Class({name:"cc.Widget","extends":t("./CCComponent"),editor:!1,properties:{isAlignTop:{get:function(){return(this._alignFlags&n)>0},set:function(t){this._setAlign(n,t)}},isAlignVerticalCenter:{get:function(){return(this._alignFlags&r)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=r):this._alignFlags&=~r}},isAlignBottom:{get:function(){return(this._alignFlags&s)>0},set:function(t){this._setAlign(s,t)}},isAlignLeft:{get:function(){return(this._alignFlags&o)>0},set:function(t){this._setAlign(o,t)}},isAlignHorizontalCenter:{get:function(){return(this._alignFlags&a)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=a):this._alignFlags&=~a}},isAlignRight:{get:function(){return(this._alignFlags&c)>0},set:function(t){this._setAlign(c,t)}},isStretchWidth:{get:function(){return(this._alignFlags&l)===l},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&h)===h},visible:!1},top:{get:function(){return this._top},set:function(t){this._top=t}},bottom:{get:function(){return this._bottom},set:function(t){this._bottom=t}},left:{get:function(){return this._left},set:function(t){this._left=t}},right:{get:function(){return this._right},set:function(t){this._right=t}},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(t){this._isAbsTop=t}},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom=t}},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft=t}},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(t){this._isAbsRight=t}},_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_originalWidth:0,_originalHeight:0},onLoad:function(){cc._widgetManager.add(this)},onDestroy:function(){cc._widgetManager.remove(this)},_setAlign:function(t,e){var i=(this._alignFlags&t)>0;if(e!=i){var n=(t&l)>0;if(e){this._alignFlags|=t,n?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))}else n?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~t}}});cc.Widget=e.exports=d},{"./CCComponent":40}],46:[function(t,e,i){t("./CCComponent"),t("./CCComponentInSG"),e.exports=[t("./CCSpriteRenderer"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCELabel"),t("./CCProgressBar")]},{"./CCAnimation":36,"./CCAudioSource":37,"./CCButton":38,"./CCCanvas":39,"./CCComponent":40,"./CCComponentInSG":41,"./CCELabel":42,"./CCProgressBar":43,"./CCSpriteRenderer":44,"./CCWidget":45}],47:[function(t,e,i){function n(){s.call(this)}var r=cc.js,s=t("../platform/callbacks-invoker").CallbacksHandler;r.extend(n,s),n.prototype.invoke=function(t){var e,i,n,r,s,o,a,c=this._callbackTable[t.type];if(c&&c.length>0){if(1===c.length)return void c[0].call(t.currentTarget,t);for(i=c.length-1,e=0;i>=e&&(s=c[e],o=c[e+1],o&&"object"==typeof o?(a=!0,s.call(o,t)):(a=!1,s.call(t.currentTarget,t)),!t._propagationImmediateStopped&&e!==i);){if(n=i-(c.length-1),r=!0,2>=n)c[e]!==s&&(e-=n),i-=n;else if(0!==n)return void cc.error("Call event.stopPropagationImmediate() when you remove more than one callbacks in a event callback.");a?e+=2:++e}}},e.exports=n},{"../platform/callbacks-invoker":62}],48:[function(t,e,i){var n=t("./event-listeners"),r=t("./event"),s=r.EventCustom,o=cc.js,a=new Array(16);a.length=0;var c=function(t,e,i){var n,r;for(e.target=t,t._getCapturingTargets(e.type,a),e.eventPhase=1,r=a.length-1;r>=0;--r)if(n=a[r],n._isTargetActive(e.type)&&n._capturingListeners&&(e.currentTarget=n,n._capturingListeners.invoke(e),e._propagationStopped))return;if(a.length=0,!t._isTargetActive(e.type)||(h(t,e),!e._propagationStopped)){if(e.bubbles)for(t._getBubblingTargets(e.type,a),e.eventPhase=3,r=0;r<a.length;++r)if(n=a[r],n._isTargetActive(e.type)&&n._bubblingListeners&&(e.currentTarget=n,n._bubblingListeners.invoke(e),e._propagationStopped))return;a.length=0}},h=function(t,e){e.eventPhase=2,e.currentTarget=t,t._capturingListeners&&(t._capturingListeners.invoke(e),e._propagationStopped)||t._bubblingListeners&&t._bubblingListeners.invoke(e)},l=function(){this._capturingListeners=null,this._bubblingListeners=null};o.mixin(l.prototype,{hasEventListener:function(t){return this._bubblingListeners.has(t)||this._capturingListeners.has(t)},on:function(t,e,i,r){if("boolean"==typeof i?(r=i,i=void 0):r=!!r,!e)return void cc.error("Callback of event must be non-nil");var s=null;return s=r?this._capturingListeners=this._capturingListeners||new n:this._bubblingListeners=this._bubblingListeners||new n,s.has(t,e,i)||(s.add(t,e,i),i&&i.__eventTargets&&i.__eventTargets.push(this)),e},off:function(t,e,i,n){if("boolean"==typeof i?(n=i,i=void 0):n=!!n,e){var r=n?this._capturingListeners:this._bubblingListeners;if(r&&(r.remove(t,e,i),i&&i.__eventTargets)){var s=i.__eventTargets.indexOf(this);i.__eventTargets.splice(s,1)}}},targetOff:function(t){this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t)},once:function(t,e,i,n){var r=this,s=function(o){r.off(t,s,i,n),e.call(this,o)};this.on(t,s,i,n)},dispatchEvent:function(t){c(this,t),a.length=0;var e=!t._defaultPrevented;return e},emit:function(t,e){if("string"==typeof t){var i=new s(t);i.detail=e,h(this,i)}else cc.error("The message must be provided")},_isTargetActive:function(t){return!0},_getCapturingTargets:function(t,e){},_getBubblingTargets:function(t,e){}}),cc.EventTarget=e.exports=l},{"./event":49,"./event-listeners":47}],49:[function(t,e,i){var n=t("../platform/js");cc.Event=function(t,e){this.type=t,this.bubbles=e||!1,this.target=null,this.currentTarget=null,this.eventPhase=0,this._defaultPrevented=!1,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._defaultPrevented=!1,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},preventDefault:function(){this._defaultPrevented=!0},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;var r=function(t,e){cc.Event.call(this,t,e),this.detail=null};n.extend(r,cc.Event),n.mixin(r.prototype,{setUserData:function(t){this.detail=t},getUserData:function(){return this.detail},getEventName:cc.Event.prototype.getType}),cc.Event.EventCustom=r,e.exports=cc.Event},{"../platform/js":66}],50:[function(t,e,i){t("./event.js"),t("./event-listeners.js"),t("./event-target.js")},{"./event-listeners.js":47,"./event-target.js":48,"./event.js":49}],51:[function(t,e,i){t("./platform"),t("./assets"),t("./CCNode"),t("./CCScene"),t("./components"),t("./base-ui/CCWidgetManager")},{"./CCNode":20,"./CCScene":21,"./assets":34,"./base-ui/CCWidgetManager":35,"./components":46,"./platform":64}],52:[function(t,e,i){function n(t,e,i,n){this.readMainCache=!1,this.writeMainCache=!1;var r=!(this.readMainCache&&this.writeMainCache);this.taskIndieCache=r?{}:null,this.pendingCache={},this.assetsNeedPostLoad=i?[]:null,this.urlsNeedPreload={},this.deserializeInfo=n}var r=t("./js"),s=(t("../assets/CCAsset"),t("./utils").callInNextTick),o=t("./load-manager"),a=t("./callbacks-invoker"),c="",h={},l=new a,d=new cc.deserialize.Details;n.prototype.readCache=function(t){return this.readMainCache&&this.writeMainCache?u._uuidToAsset[t]:this.readMainCache?u._uuidToAsset[t]||this.taskIndieCache[t]:this.taskIndieCache[t]},n.prototype.writeCache=function(t,e,i){this.writeMainCache&&(u._uuidToAsset[t]=e),this.taskIndieCache&&(this.taskIndieCache[t]=e),this.assetsNeedPostLoad&&e._rawFiles&&!i&&this.assetsNeedPostLoad.push(e)};var u={loadAsset:function(t,e,i){var r,s,o="undefined"!=typeof(i&&i.readMainCache)?o:!0,a="undefined"!=typeof(i&&i.writeMainCache)?a:!0;i&&(r=i.existingAsset,s=i.deserializeInfo);var c=new n(o,a,null,s);this._loadAssetByUuid(t,e,c,r)},_LoadingHandle:n,getImportedDir:function(t){return c+t.slice(0,2)},_queryAssetInfoInEditor:function(t,e){},_getAssetInfoInRuntime:function(t){var e=h[t];if(e)return{url:cc.url._rawAssets+e.url,raw:e.raw};var i=this.getImportedDir(t)+cc.path.sep+t+".json";return{url:i,raw:!1}},queryAssetInfo:function(t,e){var i=this._getAssetInfoInRuntime(t);e(null,i.url,i.raw)},parseUuidInEditor:function(t){},_loadAssetByUuid:function(t,e,i,n){function r(r,s,o){function a(n,r,s){r&&(r._uuid=t,i.writeCache(t,r,s)),c?l.invokeAndRemove(t,n,r):e&&e(n,r)}s?u._deserializeWithDepends(s,o,t,a,i,n):a(r,null)}if("string"!=typeof t)return s(e,new Error("[AssetLibrary] uuid must be string"),null);if(!n){var a=i.readCache(t);if(a)return s(e,null,a)}var c=i.readMainCache&&!n;if(!c||l.add(t,e)){var h=i.pendingCache[t];if(h)return s(e,null,h);var d=this._getAssetInfoInRuntime(t);return d.raw?e(new Error("Should not load raw file in AssetLibrary, uuid: "+t)):void o.loadByLoader(cc.loader.loadJson.bind(cc.loader),d.url,function(t,e){r(t,e,d.url)})}},loadJson:function(t,e,i,r){var o=new n(!i,!i,r),a=!0;return this._deserializeWithDepends(t,"","",function(t,i){a?s(e,t,i):e(t,i)},o),a=!1,o},_loadDepends:function(t,e,i,n,r){var s=e.uuidList.length,a=e.rawProp;if(a){var c=cc.Class.attr(t.constructor,e.rawProp),h=c.rawType;++s,o.load(i,h,t._rawext,function(e,n){e&&cc.error("[AssetLibrary] Failed to load %s of %s. %s",h,i,e),t[a]=n,--s,0===s&&(r(),r=null)})}if(0===s)return void(r&&r());for(var l=0;l<e.uuidList.length;l++){var d=e.uuidList[l];!function(t,e,i){u.queryAssetInfo(t,function(o,a,c){if(o?cc.error('[AssetLibrary] Failed to load "%s", %s',t,o):c&&(e[i]=a,n.urlsNeedPreload[a]=!0),o||c)return--s,void(r&&0===s&&(r(),r=null));var h=function(t,n,o){e[i]=n,--s,r&&0===s&&(r(),r=null)};u._loadAssetByUuid(t,h,n)})}(d,e.uuidObjList[l],e.uuidPropList[l])}r&&0===s&&(r(),r=null)},_deserializeWithDepends:function(t,e,i,n,s,o){var a=function(t){var e=r._getClassById(t);return e?e:(cc.warn('Can not get class "%s"',t),Object)},c=s.deserializeInfo||d,h=cc.deserialize(t,c,{classFinder:a,target:o}),l=!!c.rawProp;i&&(s.pendingCache[i]=h),this._loadDepends(h,c,e,s,function(){i&&delete s.pendingCache[i],n(null,h,l)}),c.reset()},getAssetByUuid:function(t){return u._uuidToAsset[t]||null},init:function(t,e,i){t=t.replace(/\\/g,"/"),c=cc.path._setEndWithSep(t,"/"),h=i||{},cc.url._init(e)}};u._uuidToAsset={},cc.AssetLibrary=u},{"../assets/CCAsset":22,"./callbacks-invoker":62,"./js":66,"./load-manager":67,"./utils":72}],53:[function(require,module,exports){function getDefault(t){return"function"==typeof t?t():t}function instantiateProps(t,e){for(var i=e.__props__,n=0;n<i.length;n++){var r=i[n],s=Attr.attr(e,r);if(s&&s.hasOwnProperty("default")){var o=s["default"];o&&("object"==typeof o&&o?o="function"==typeof o.clone?o.clone():Array.isArray(o)?[]:{}:"function"==typeof o&&(o=getDefault(o))),t[r]=o}}}function doDefine(t,e,i,n,r){var s=_createCtor(n,e,i,t,r);for(var o in _metaClass)Object.defineProperty(s,o,{value:_metaClass[o],writable:!0});if(e&&(JS.extend(s,e),s.$super=e,s.__props__=e.__props__?e.__props__.slice():[]),i){for(var a=0;a<i.length;++a){var c=i[a];JS.mixin(s.prototype,c.prototype);for(var h in c)c.hasOwnProperty(h)&&INVALID_STATICS.indexOf(h)<0&&(s[h]=c[h]);s.__props__=s.__props__||[],c.__props__&&(s.__props__=s.__props__.concat(c.__props__.filter(function(t){return s.__props__.indexOf(t)<0})))}s.prototype.constructor=s}return s.__props__=s.__props__||[],JS.setClassName(t,s),s}function define(t,e,i,n,r){if(cc.isChildClassOf(e,cc.Component)){var s=cc._RFpeek();if(s){if(s.beh)return void cc.error("Each script can have at most one Component.");var o=s.uuid;t=t||s.script;var a=doDefine(t,e,i,n,r);return o&&JS._setClassId(o,a),s.beh=a,a}}return doDefine(t,e,i,n,r)}function _checkCtor(t){}function normalizeClassName(t){var e}function _createCtor(ctor,baseClass,mixins,className,options){for(var useTryCatch=!(className&&className.startsWith("cc.")),shouldAddProtoCtor,originCtor,superCallBounded=options&&baseClass&&boundSuperCalls(baseClass,options),ctors=[],baseOrMixins=[baseClass].concat(mixins),b=0;b<baseOrMixins.length;b++){var baseOrMixin=baseOrMixins[b];if(baseOrMixin)if(FireClass._isCCClass(baseOrMixin)){var baseCtors=baseOrMixin.__ctors__;baseCtors&&(ctors=ctors.concat(baseCtors))}else baseOrMixin&&ctors.push(baseOrMixin)}ctor&&ctors.push(ctor);var body;if(body="(function(){\n",superCallBounded&&(body+="this._super=null;\n"),body+="instantiateProps(this,fireClass);\n",ctors.length>0){if(body+="var cs=fireClass.__ctors__;\n",useTryCatch&&(body+="try{\n"),ctors.length<=5)for(var i=0;i<ctors.length;i++)body+="(cs["+i+"]).apply(this,arguments);\n";else body+="for(var i=0,l=cs.length;i<l;++i){\n",body+="(cs[i]).apply(this,arguments);\n}\n";useTryCatch&&(body+="}catch(e){\ncc._throw(e);\n}\n")}body+="})";var fireClass=eval(body);return Object.defineProperty(fireClass,"__ctors__",{value:ctors.length>0?ctors:null,writable:!1,enumerable:!1}),fireClass}function _boundSuperCall(t,e,i){var n=null,r=JS.getPropertyDescriptor(i.prototype,e);if(r)if(r.value)"function"==typeof r.value&&(n=r.value);else if(r.get){var s=r.get();"function"==typeof s&&(n=s)}if(n){var o=SuperCallReg.test(t);if(o)return function(){var e=this._super;this._super=n;var i=t.apply(this,arguments);return this._super=e,i}}return null}function boundSuperCalls(t,e){var i=!1;for(var n in e)if(BUILTIN_ENTRIES.indexOf(n)<0){var r=e[n];if("function"==typeof r){var s=_boundSuperCall(r,n,t);s&&(i=!0,e[n]=s)}}return i}function FireClass(t){if(0===arguments.length)return define();if(!t)return cc.error("cc.Class: Option must be non-nil"),define();var e,i=t.name,n=t["extends"];e=define(i,n,t.mixins,t.ctor,t),i||(i=cc.js.getClassName(e));var r=t.properties;if(r){preprocessAttrs(r,i);for(var s in r){var o=r[s],a=parseAttributes(o,i,s);if("default"in o)e.prop.apply(e,[s,o["default"]].concat(a));else{var c=o.get,h=o.set;c&&e.get.apply(e,[s,c].concat(a)),h&&e.set(s,h)}}}var l=t.statics;if(l){var d;for(d in l)e[d]=l[d]}for(var u in t)if(!(BUILTIN_ENTRIES.indexOf(u)>=0)){var _=t[u];if("function"==typeof _||null===_)e.prototype[u]=_;else;}return e}function fastDefine(t,e,i){JS.setClassName(t,e),e.__props__=i;for(var n=0;n<i.length;n++)Attr.attr(e,i[n],{visible:!1})}function parseAttributes(t,e,i){function n(e,i,n){var s=t[e];if(s&&typeof s===i)if("undefined"==typeof n){var o={};o[e]=s,r.push(o)}else r.push("function"==typeof n?n(s):n)}tmpAttrs.length=0;var r=tmpAttrs,s=t.type;if(s)switch(s){case"Integer":r.push({type:"Integer"});break;case"Float":r.push({type:"Float"});break;case"Boolean":r.push({type:"Boolean",_onAfterProp:getTypeChecker("Boolean","Boolean")});break;case"String":r.push({type:"String",_onAfterProp:getTypeChecker("String","String")});break;case"Object":break;default:if(s===Attr.ScriptUuid){var o=Attr.ObjectType(cc.ScriptAsset);o.type="Script",r.push(o)}else"object"==typeof s?Enum.isEnum(s)&&r.push({type:"Enum",enumList:Enum.getList(s)}):"function"==typeof s&&r.push(Attr.ObjectType(s))}n("rawType","string",Attr.RawType),n("editorOnly","boolean",Attr.EditorOnly),t.url&&r.push({saveUrlAsAsset:!0}),t.serializable===!1&&r.push(Attr.NonSerialized);var a=t.range;a&&Array.isArray(a)&&a.length>=2&&r.push(Attr.Range(a[0],a[1]));var c=t.nullable;if(c&&"object"==typeof c){var h=c.propName;if("string"==typeof h){var l=c["default"];"boolean"==typeof l&&r.push(Attr.Nullable(h,l))}}return r}var JS=require("./js"),Enum=require("../value-types/CCEnum"),Utils=require("./utils"),_isPlainEmptyObj_DEV=Utils.isPlainEmptyObj_DEV,_cloneable_DEV=Utils.cloneable_DEV,Attr=require("./attribute"),getTypeChecker=Attr.getTypeChecker,preprocessAttrs=require("./preprocess-attrs"),BUILTIN_ENTRIES=["name","extends","mixins","ctor","properties","statics","editor"],TYPO_TO_CORRECT=!1,INVALID_STATICS=!1,_appendProp=function(t,e){var i=t.__props__.indexOf(e);0>i&&t.__props__.push(e)},_metaClass={prop:function(t,e,i){"use strict";if(Attr.attr(this,t,{"default":e}),_appendProp(this,t),i){for(var n=null,r=2,s=r;s<arguments.length;s++){var o=arguments[s];Attr.attr(this,t,o),o._onAfterProp&&(n=n||[],n.push(o._onAfterProp))}if(n)for(var a=0;a<n.length;a++)n[a](this,t)}return this},get:function(t,e,i){"use strict";if(i)for(var n=2,r=n;r<arguments.length;r++){var s=arguments[r];Attr.attr(this,t,s)}var o=!1;return o||Attr.attr(this,t,Attr.NonSerialized),o&&_appendProp(this,t),Object.getOwnPropertyDescriptor(this.prototype,t)?Object.defineProperty(this.prototype,t,{get:e}):Object.defineProperty(this.prototype,t,{get:e,configurable:!0,enumerable:!0}),this},set:function(t,e){return Object.getOwnPropertyDescriptor(this.prototype,t)?Object.defineProperty(this.prototype,t,{set:e}):Object.defineProperty(this.prototype,t,{set:e,configurable:!0,enumerable:!0}),this},extend:function(t){return t["extends"]=this,FireClass(t)}};cc.isChildClassOf=function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;for(;t&&t.$super;t=t.$super)if(t===e)return!0;if(t===e)return!0;for(var i=Object.getPrototypeOf(t.prototype);i;){if(t=i.constructor,t===e)return!0;i=Object.getPrototypeOf(t.prototype)}}return!1};var SuperCallReg=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;FireClass._isCCClass=function(t){return!!t&&t.prop===_metaClass.prop},FireClass.attr=Attr.attr;var tmpAttrs=[];FireClass.extend=FireClass,cc.Class=FireClass,module.exports={instantiateProps:instantiateProps,isArray:function(t){return t=getDefault(t),Array.isArray(t)},fastDefine:fastDefine}},{"../value-types/CCEnum":88,"./attribute":61,"./js":66,"./preprocess-attrs":69,"./utils":72}],54:[function(t,e,i){var n=t("./CCInputManager");n.setAccelerometerEnabled=function(t){var e=this;if(e._accelEnabled!==t){e._accelEnabled=t;var i=cc.director.getScheduler();e._accelEnabled?(e._accelCurTime=0,i.scheduleUpdate(e)):(e._accelCurTime=0,i.scheduleUpdate(e))}},n.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},n._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){cc.eventManager.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc.game.canvas.addEventListener("keyup",function(t){cc.eventManager.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},n._registerAccelerometerEvent=function(){var t=window,e=this;e._acceleration=new cc.Acceleration,e._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(e._accelDeviceEvent=window.DeviceOrientationEvent);var i=e._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",n=navigator.userAgent;(/Android/.test(n)||/Adr/.test(n)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(e._minus=-1),t.addEventListener(i,e.didAccelerate.bind(e),!1)},n.didAccelerate=function(t){var e=this,i=window;if(e._accelEnabled){var n,r,s,o=e._acceleration;if(e._accelDeviceEvent===window.DeviceMotionEvent){var a=t.accelerationIncludingGravity;n=e._accelMinus*a.x*.1,r=e._accelMinus*a.y*.1,s=.1*a.z}else n=t.gamma/90*.981,r=.981*-(t.beta/90),s=t.alpha/90*.981;cc.sys.os===cc.sys.OS_ANDROID?(o.x=-n,o.y=-r):(o.x=n,o.y=r),o.z=s,o.timestamp=t.timeStamp||Date.now();var c=o.x;i.orientation===cc.UIOrientation.LANDSCAPE_RIGHT?(o.x=-o.y,o.y=c):i.orientation===cc.UIOrientation.LANDSCAPE_LEFT?(o.x=o.y,o.y=-c):i.orientation===cc.UIOrientation.PORTRAIT_UPSIDE_DOWN&&(o.x=-o.x,o.y=-o.y)}}},{"./CCInputManager":55}],55:[function(t,e,i){Enum=t("../value-types/CCEnum"),cc.UIOrientation=cc.Enum({PORTRAIT:0,LANDSCAPE_LEFT:-90,LANDSCAPE_RIGHT:90,PORTRAIT_UPSIDE_DOWN:180});var n={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=0;e<this._maxTouches;e++){if(!(1&t))return this._indexBitsUsed|=1<<e,e;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(0>t||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},_glView:null,handleTouchesBegin:function(t){for(var e,i,n,r,s=[],o=this._touchesIntegerDict,a=0,c=t.length;c>a;a++)if(e=t[a],r=e.getID(),i=o[r],null==i){var h=this._getUnUsedIndex();if(-1===h){cc.log(cc._LogInfos.inputManager.handleTouchesBegin,h);continue}n=this._touches[h]=new cc.Touch(e._point.x,e._point.y,e.getID()),n._setPrevPoint(e._prevPoint),o[r]=h,s.push(n)}if(s.length>0){this._glView._convertTouchesWithScale(s);var l=new cc.Event.EventTouch(s);l._eventCode=cc.Event.EventTouch.BEGAN,cc.eventManager.dispatchEvent(l)}},handleTouchesMove:function(t){for(var e,i,n,r=[],s=this._touches,o=0,a=t.length;a>o;o++)e=t[o],n=e.getID(),i=this._touchesIntegerDict[n],null!=i&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),r.push(s[i]));if(r.length>0){this._glView._convertTouchesWithScale(r);var c=new cc.Event.EventTouch(r);c._eventCode=cc.Event.EventTouch.MOVED,cc.eventManager.dispatchEvent(c)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.ENDED,cc.eventManager.dispatchEvent(i)}},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.CANCELLED,cc.eventManager.dispatchEvent(i)}},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],s=this._touches,o=this._touchesIntegerDict,a=0,c=t.length;c>a;a++)e=t[a],n=e.getID(),i=o[n],null!=i&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),r.push(s[i]),this._removeUsedIndexBit(i),delete o[n]);return r},getHTMLElementPosition:function(t){var e=document.documentElement,i=window,n=null;return n=cc.js.isFunction(t.getBoundingClientRect)?t.getBoundingClientRect():t instanceof HTMLCanvasElement?{left:0,top:0,width:t.width,height:t.height}:{left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)},{left:n.left+i.pageXOffset-e.clientLeft,top:n.top+i.pageYOffset-e.clientTop,width:n.width,height:n.height}},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){e=i[r];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint,r=this._glView.convertToLocationInView(t,e,i),s=new cc.Touch(r.x,r.y);return s._setPrevPoint(n.x,n.y),n.x=r.x,n.y=r.y,s},getMouseEvent:function(t,e,i){var n=this._prevMousePoint;this._glView._convertMouseToLocationInView(t,e);var r=new cc.Event.EventMouse(i);return r.setLocation(t.x,t.y),r._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,r},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,r,s=[],o=this._glView,a=this._preTouchPoint,c=t.changedTouches.length,h=0;c>h;h++)if(i=t.changedTouches[h]){var l;l=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?o.convertToLocationInView(i.pageX,i.pageY,e):o.convertToLocationInView(i.clientX,i.clientY,e),null!=i.identifier?(n=new cc.Touch(l.x,l.y,i.identifier),r=this.getPreTouch(n).getLocation(),n._setPrevPoint(r.x,r.y),this.setPreTouch(n)):(n=new cc.Touch(l.x,l.y),n._setPrevPoint(a.x,a.y)),a.x=l.x,a.y=l.y,s.push(n)}return s},registerSystemEvent:function(t){if(!this._isRegisterEvent){var e=(this._glView=cc.view,this),i="mouse"in cc.sys.capabilities,n="touches"in cc.sys.capabilities,r=!1;if(cc.sys.isMobile&&(r=!0),i&&(!r&&window.addEventListener("mousedown",function(){e._mousePressed=!0},!1),!r&&window.addEventListener("mouseup",function(i){var n=e._mousePressed;if(e._mousePressed=!1,n){var r=e.getHTMLElementPosition(t),s=e.getPointByEvent(i,r);if(!cc.rectContainsPoint(new cc.Rect(r.left,r.top,r.width,r.height),s)){e.handleTouchesEnd([e.getTouchByXY(s.x,s.y,r)]);var o=e.getMouseEvent(s,r,cc.Event.EventMouse.UP);o.setButton(i.button),cc.eventManager.dispatchEvent(o)}}},!1),!r&&t.addEventListener("mousedown",function(i){e._mousePressed=!0;var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);e.handleTouchesBegin([e.getTouchByXY(r.x,r.y,n)]);var s=e.getMouseEvent(r,n,cc.Event.EventMouse.DOWN);s.setButton(i.button),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault(),t.focus()},!1),!r&&t.addEventListener("mouseup",function(i){e._mousePressed=!1;var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);e.handleTouchesEnd([e.getTouchByXY(r.x,r.y,n)]);var s=e.getMouseEvent(r,n,cc.Event.EventMouse.UP);s.setButton(i.button),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),!r&&t.addEventListener("mousemove",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);e.handleTouchesMove([e.getTouchByXY(r.x,r.y,n)]);var s=e.getMouseEvent(r,n,cc.Event.EventMouse.MOVE);s.setButton(e._mousePressed?i.button:null),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),t.addEventListener("mousewheel",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n),s=e.getMouseEvent(r,n,cc.Event.EventMouse.SCROLL);s.setButton(i.button),s.setScrollData(0,i.wheelDelta),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),t.addEventListener("DOMMouseScroll",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n),s=e.getMouseEvent(r,n,cc.Event.EventMouse.SCROLL);s.setButton(i.button),s.setScrollData(0,-120*i.detail),
cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1)),window.navigator.msPointerEnabled){var s={MSPointerDown:e.handleTouchesBegin,MSPointerMove:e.handleTouchesMove,MSPointerUp:e.handleTouchesEnd,MSPointerCancel:e.handleTouchesCancel};for(var o in s)!function(i,n){t.addEventListener(i,function(i){var r=e.getHTMLElementPosition(t);r.left-=document.documentElement.scrollLeft,r.top-=document.documentElement.scrollTop,n.call(e,[e.getTouchByXY(i.clientX,i.clientY,r)]),i.stopPropagation()},!1)}(o,s[o])}n&&(t.addEventListener("touchstart",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesBegin(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault(),t.focus()}},!1),t.addEventListener("touchmove",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesMove(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("touchend",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesEnd(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("touchcancel",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesCancel(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1)),this._registerKeyboardEvent(),this._registerAccelerometerEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};cc.inputManager=n,e.exports=n},{"../value-types/CCEnum":88}],56:[function(t,e,i){cc.loader=cc.loader||function(){var t={},e={},i={},n={},r=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))|(?:localhost))(?::\\d{2,5})?(?:/\\S*)?$","i");return{resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},_getArgs4Js:function(t){var e=t[0],i=t[1],n=t[2],r=["",null,null];if(1===t.length)r[1]=e instanceof Array?e:[e];else if(2===t.length)"function"==typeof i?(r[1]=e instanceof Array?e:[e],r[2]=i):(r[0]=e||"",r[1]=i instanceof Array?i:[i]);else{if(3!==t.length)throw new Error("arguments error to load js!");r[0]=e||"",r[1]=i instanceof Array?i:[i],r[2]=n}return r},loadJs:function(e,i,n){var r=this,s=r._getArgs4Js(arguments),o=s[0],a=s[1],c=s[2];navigator.userAgent.indexOf("Trident/5")>-1?r._loadJs4Dependency(o,a,0,c):cc.async.map(a,function(e,i,n){var s=cc.path.join(o,e);return t[s]?n(null):void r._createScript(s,!1,n)},c)},loadJsWithImg:function(t,e,i){var n=this,r=n._loadJsImg(),s=n._getArgs4Js(arguments);this.loadJs(s[0],s[1],function(t){if(t)throw new Error(t);r.parentNode.removeChild(r),s[2]&&s[2]()})},_createScript:function(e,i,n){var r=document,s=this,o=document.createElement("script");o.async=i,t[e]=!0,o.src=cc.game.config.noCache&&"string"==typeof e?s._noCacheRex.test(e)?e+"&_t="+(new Date-0):e+"?_t="+(new Date-0):e,o.addEventListener("load",function(){o.parentNode.removeChild(o),o.removeEventListener("load",arguments.callee,!1),n()},!1),o.addEventListener("error",function(){o.parentNode.removeChild(o),n("Load "+e+" failed!")},!1),r.body.appendChild(o)},_loadJs4Dependency:function(t,e,i,n){if(i>=e.length)return void(n&&n());var r=this;r._createScript(cc.path.join(t,e[i]),!1,function(s){return s?n(s):void r._loadJs4Dependency(t,e,i+1,n)})},_loadJsImg:function(){var t=document,e=t.getElementById("cocos2d_loadJsImg");if(!e){e=document.createElement("img"),cc._loadingImage&&(e.src=cc._loadingImage);var i=t.getElementById(cc.game.config.id);i.style.backgroundColor="transparent",i.parentNode.appendChild(e);var n=getComputedStyle?getComputedStyle(i):i.currentStyle;n||(n={width:i.width,height:i.height}),e.style.left=i.offsetLeft+(parseFloat(n.width)-e.width)/2+"px",e.style.top=i.offsetTop+(parseFloat(n.height)-e.height)/2+"px",e.style.position="absolute"}return e},loadTxt:function(t,e){var i=this.getXMLHttpRequest(),n="load "+t+" failed!";i.open("GET",t,!0),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(i.setRequestHeader("Accept-Charset","utf-8"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||0===i.status?e(null,i.responseText):e({status:i.status,errorMessage:n},null))}):(i.overrideMimeType&&i.overrideMimeType("text/plain; charset=utf-8"),i.onload=function(){4===i.readyState&&(200===i.status||0===i.status?e(null,i.responseText):e({status:i.status,errorMessage:n},null))},i.onerror=function(){e({status:i.status,errorMessage:n},null)}),i.send(null)},_loadTxtSync:function(t){var e=this.getXMLHttpRequest();return e.open("GET",t,!1),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?e.setRequestHeader("Accept-Charset","utf-8"):e.overrideMimeType&&e.overrideMimeType("text/plain; charset=utf-8"),e.send(null),4===!e.readyState||200!==e.status&&0!==e.status?null:e.responseText},loadCsb:function(t,e){var i=new XMLHttpRequest,n="load "+t+" failed!";i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){var t=i.response;t&&(window.msg=t),4===i.readyState&&(200===i.status?e(null,i.response):e({status:i.status,errorMessage:n},null))},i.onerror=function(){e({status:i.status,errorMessage:n},null)},i.send(null)},loadJson:function(t,e){this.loadTxt(t,function(i,n){if(i)e(i);else{try{var r=JSON.parse(n)}catch(s){throw new Error("parse json ["+t+"] failed : "+s)}e(null,r)}})},_checkIsImageURL:function(t){var e=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(t);return null!=e},loadImg:function(t,e,i){var n={isCrossOrigin:!0};void 0!==i?n.isCrossOrigin=null===e.isCrossOrigin?n.isCrossOrigin:e.isCrossOrigin:void 0!==e&&(i=e);var r=this.getRes(t);if(r)return i&&i(null,r),r;r=new Image,n.isCrossOrigin&&"file://"!==location.origin&&(r.crossOrigin="Anonymous");var s=function(){r.removeEventListener("load",s,!1),r.removeEventListener("error",a,!1),i&&i(null,r)},o=this,a=function(){r.removeEventListener("load",s,!1),r.removeEventListener("error",a,!1),r.crossOrigin&&"anonymous"===r.crossOrigin.toLowerCase()?(n.isCrossOrigin=!1,o.release(t),cc.loader.loadImg(t,n,i)):"function"==typeof i&&i("load image failed")};return r.addEventListener("load",s),r.addEventListener("error",a),r.src=t,r},_loadResIterator:function(t,i,n){var s=this,o=null,a=t.type;a?(a="."+a.toLowerCase(),o=t.src?t.src:t.name+a):(o=t,a=cc.path.extname(o));var c=s.getRes(o);if(c)return n(null,c);var h=null;if(a&&(h=e[a.toLowerCase()]),!h)return cc.error("loader for ["+a+"] not exists!"),n();var l=o;if(!r.test(o)){var d=h.getBasePath?h.getBasePath():s.resPath;l=s.getUrl(d,o)}cc.game.config.noCache&&"string"==typeof l&&(l+=s._noCacheRex.test(l)?"&_t="+(new Date-0):"?_t="+(new Date-0)),h.load(l,o,t,function(t,e){t?(cc.log(t),s.cache[o]=null,delete s.cache[o],n({status:520,errorMessage:t},null)):(s.cache[o]=e,n(null,e))})},_noCacheRex:/\?/,getUrl:function(t,n){var r=this,s=cc.path;if(void 0!==t&&void 0===n){n=t;var o=s.extname(n);o=o?o.toLowerCase():"";var a=e[o];t=a&&a.getBasePath?a.getBasePath():r.resPath}if(n=cc.path.join(t||"",n),n.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(i[n])return i[n];var c=s.extname(n)||"";n=i[n]=n.substring(0,n.length-c.length)+"_"+cc.sys.language+c}return n},load:function(t,e,i){"use strict";var n=this,r=arguments.length;if(0===r)throw new Error("arguments error!");3===r?"function"==typeof e&&(e="function"==typeof i?{trigger:e,cb:i}:{cb:e,cbTarget:i}):2===r?"function"==typeof e&&(e={cb:e}):1===r&&(e={}),t instanceof Array||(t=[t]);var s=new cc.AsyncPool(t,0,function(t,i,r,s){n._loadResIterator(t,i,function(t,i){e.trigger&&e.trigger.call(e.triggerTarget,i,s.size,s.finishedSize),r(t,i)})},e.cb,e.cbTarget);return s.flow(),s},_handleAliases:function(t,e){var i=[];for(var r in t){var s=t[r];n[r]=s,i.push(s)}this.load(i,e)},loadAliases:function(t,e){var i=this,n=i.getRes(t);n?i._handleAliases(n.filenames,e):i.load(t,function(t,n){i._handleAliases(n[0].filenames,e)})},register:function(t,i){if(t&&i){if("string"==typeof t)return e[t.trim().toLowerCase()]=i;for(var n=0,r=t.length;r>n;n++)e["."+t[n].trim().toLowerCase()]=i}},getRes:function(t){return this.cache[t]||this.cache[n[t]]},getAliase:function(t){return n[t]},release:function(t){var e=this.cache;delete e[t],delete e[n[t]],delete n[t]},releaseAll:function(){var t=this.cache;for(var e in t)delete t[e];for(var e in n)delete n[e]}}}()},{}],57:[function(t,e,i){cc.INVALID_INDEX=-1,cc.PI=Math.PI,cc.FLT_MAX=parseFloat("3.402823466e+38F"),cc.FLT_MIN=parseFloat("1.175494351e-38F"),cc.RAD=cc.PI/180,cc.DEG=180/cc.PI,cc.UINT_MAX=4294967295,cc.swap=function(t,e,i){if(!cc.js.isObject(i)||cc.js.isUndefined(i.x)||cc.js.isUndefined(i.y))cc.log(cc._LogInfos.swap);else{var n=i[t];i[t]=i[e],i[e]=n}},cc.lerp=function(t,e,i){return t+(e-t)*i},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.RAD},cc.radiansToDegrees=function(t){return t*cc.DEG},cc.radiansToDegress=function(t){return cc.log(cc._LogInfos.radiansToDegress),t*cc.DEG},cc.REPEAT_FOREVER=Number.MAX_VALUE-1,cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.enableDefaultGLStates=function(){},cc.disableDefaultGLStates=function(){},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.FLT_EPSILON=1.192092896e-7,cc.contentScaleFactor=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.director.getContentScaleFactor()}:function(){return 1},cc.pointPointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.p(t.x*e,t.y*e)},cc.pointPixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.p(t.x/e,t.y/e)},cc._pointPixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.x=t.x/i,e.y=t.y/i},cc.sizePointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.size(t.width*e,t.height*e)},cc.sizePixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.size(t.width/e,t.height/e)},cc._sizePixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.width=t.width/i,e.height=t.height/i},cc.rectPixelsToPoints=cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=cc.contentScaleFactor();return cc.rect(t.x/e,t.y/e,t.width/e,t.height/e)}:function(t){return cc.rect(t)},cc.rectPointsToPixels=cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=cc.contentScaleFactor();return cc.rect(t.x*e,t.y*e,t.width*e,t.height*e)}:function(t){return cc.rect(t)},cc.ONE=1,cc.ZERO=0,cc.SRC_ALPHA=770,cc.SRC_ALPHA_SATURATE=776,cc.SRC_COLOR=768,cc.DST_ALPHA=772,cc.DST_COLOR=774,cc.ONE_MINUS_SRC_ALPHA=771,cc.ONE_MINUS_SRC_COLOR=769,cc.ONE_MINUS_DST_ALPHA=773,cc.ONE_MINUS_DST_COLOR=775,cc.ONE_MINUS_CONSTANT_ALPHA=32772,cc.ONE_MINUS_CONSTANT_COLOR=32770,cc.LINEAR=9729,cc.defineGetterSetter(cc,"BLEND_SRC",function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?cc.ONE:cc.SRC_ALPHA}),cc.BLEND_DST=771,cc.checkGLErrorDebug=function(){if(cc.renderMode===cc.game.RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();t&&cc.log(cc._LogInfos.checkGLErrorDebug,t)}},cc.DEVICE_ORIENTATION_PORTRAIT=0,cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT=1,cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN=2,cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT=3,cc.DEVICE_MAX_ORIENTATIONS=2,cc.VERTEX_ATTRIB_FLAG_NONE=0,cc.VERTEX_ATTRIB_FLAG_POSITION=1,cc.VERTEX_ATTRIB_FLAG_COLOR=2,cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4,cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS,cc.GL_ALL=0,cc.VERTEX_ATTRIB_POSITION=0,cc.VERTEX_ATTRIB_COLOR=1,cc.VERTEX_ATTRIB_TEX_COORDS=2,cc.VERTEX_ATTRIB_MAX=3,cc.UNIFORM_PMATRIX=0,cc.UNIFORM_MVMATRIX=1,cc.UNIFORM_MVPMATRIX=2,cc.UNIFORM_TIME=3,cc.UNIFORM_SINTIME=4,cc.UNIFORM_COSTIME=5,cc.UNIFORM_RANDOM01=6,cc.UNIFORM_SAMPLER=7,cc.UNIFORM_MAX=8,cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor",cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest",cc.SHADER_POSITION_COLOR="ShaderPositionColor",cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture",cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor",cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color",cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor",cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor",cc.UNIFORM_PMATRIX_S="CC_PMatrix",cc.UNIFORM_MVMATRIX_S="CC_MVMatrix",cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix",cc.UNIFORM_TIME_S="CC_Time",cc.UNIFORM_SINTIME_S="CC_SinTime",cc.UNIFORM_COSTIME_S="CC_CosTime",cc.UNIFORM_RANDOM01_S="CC_Random01",cc.UNIFORM_SAMPLER_S="CC_Texture0",cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value",cc.ATTRIBUTE_NAME_COLOR="a_color",cc.ATTRIBUTE_NAME_POSITION="a_position",cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord",cc.ITEM_SIZE=32,cc.CURRENT_ITEM=3233828865,cc.ZOOM_ACTION_TAG=3233828866,cc.NORMAL_TAG=8801,cc.SELECTED_TAG=8802,cc.DISABLE_TAG=8803},{}],58:[function(t,e,i){function n(){this._name="",this._objFlags=0}function r(){for(var t=T.length,e=0;t>e;++e){var i=T[e];i._objFlags&o||i._destroyImmediate()}t===T.length?T.length=0:T.splice(0,t)}var s=t("./js"),o=1,a=2,c=4,h=8,l=16,d=32,u=64,_=512,f=1024,p=4096,g=8192,m=16384,y=_|f,v=~(a|l|u|d|p|g|m);n.Flags={DontSave:c,EditorOnly:h,Dirty:l,DontDestroy:d,PersistentMask:v,Destroying:u,HideInGame:_,HideInEditor:f,Hide:y,IsOnLoadCalled:g,IsOnEnableCalled:p,IsOnStartCalled:m},t("./CCClass").fastDefine("cc.Object",n,["_name","_objFlags"]);var T=[];Object.defineProperty(n,"_deferredDestroy",{value:r});var C=n.prototype;s.getset(C,"name",function(){return this._name},function(t){this._name=t}),s.get(C,"isValid",function(){return!(this._objFlags&o)});var S=null;C.destroy=function(){return this._objFlags&o?(cc.warn("object already destroyed"),!1):this._objFlags&a?!1:(this._objFlags|=a,T.push(this),null===S&&cc.engine&&!cc.engine._isUpdating,1,!0)},C._destruct=function(){for(var t in this)if(this.hasOwnProperty(t))switch(typeof this[t]){case"string":this[t]="";break;case"object":case"function":this[t]=null}},C._onPreDestroy=null,C._destroyImmediate=function(){return this._objFlags&o?void cc.error("object already destroyed"):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),void(this._objFlags|=o))},C._deserialize=null,cc.isValid=function(t){return"object"==typeof t?!(!t||t._objFlags&o):"undefined"!=typeof t},cc.Object=n,e.exports=n},{"./CCClass":53,"./js":66}],59:[function(t,e,i){if(!cc.sys){cc.sys={};var n=cc.sys;if(n.LANGUAGE_ENGLISH="en",n.LANGUAGE_CHINESE="zh",n.LANGUAGE_FRENCH="fr",n.LANGUAGE_ITALIAN="it",n.LANGUAGE_GERMAN="de",n.LANGUAGE_SPANISH="es",n.LANGUAGE_DUTCH="du",n.LANGUAGE_RUSSIAN="ru",n.LANGUAGE_KOREAN="ko",n.LANGUAGE_JAPANESE="ja",n.LANGUAGE_HUNGARIAN="hu",n.LANGUAGE_PORTUGUESE="pt",n.LANGUAGE_ARABIC="ar",n.LANGUAGE_NORWEGIAN="no",n.LANGUAGE_POLISH="pl",n.LANGUAGE_UNKNOWN="unkonwn",n.OS_IOS="iOS",n.OS_ANDROID="Android",n.OS_WINDOWS="Windows",n.OS_MARMALADE="Marmalade",n.OS_LINUX="Linux",n.OS_BADA="Bada",n.OS_BLACKBERRY="Blackberry",n.OS_OSX="OS X",n.OS_WP8="WP8",n.OS_WINRT="WINRT",n.OS_UNKNOWN="Unknown",n.UNKNOWN=-1,n.WIN32=0,n.LINUX=1,n.MACOS=2,n.ANDROID=3,n.IPHONE=4,n.IPAD=5,n.BLACKBERRY=6,n.NACL=7,n.EMSCRIPTEN=8,n.TIZEN=9,n.WINRT=10,n.WP8=11,n.MOBILE_BROWSER=100,n.DESKTOP_BROWSER=101,n.EDITOR_PAGE=102,n.EDITOR_CORE=103,n.BROWSER_TYPE_WECHAT="wechat",n.BROWSER_TYPE_ANDROID="androidbrowser",n.BROWSER_TYPE_IE="ie",n.BROWSER_TYPE_QQ="qqbrowser",n.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",n.BROWSER_TYPE_UC="ucbrowser",n.BROWSER_TYPE_360="360browser",n.BROWSER_TYPE_BAIDU_APP="baiduboxapp",n.BROWSER_TYPE_BAIDU="baidubrowser",n.BROWSER_TYPE_MAXTHON="maxthon",n.BROWSER_TYPE_OPERA="opera",n.BROWSER_TYPE_OUPENG="oupeng",n.BROWSER_TYPE_MIUI="miuibrowser",n.BROWSER_TYPE_FIREFOX="firefox",n.BROWSER_TYPE_SAFARI="safari",n.BROWSER_TYPE_CHROME="chrome",n.BROWSER_TYPE_LIEBAO="liebao",n.BROWSER_TYPE_QZONE="qzone",n.BROWSER_TYPE_SOUGOU="sogou",n.BROWSER_TYPE_UNKNOWN="unknown",n.isNative=!1,n.isBrowser="object"==typeof window&&"object"==typeof document,"undefined"!=typeof Editor&&Editor.isCoreLevel)n.isMobile=!1,n.platform=n.EDITOR_CORE,n.language=n.LANGUAGE_UNKNOWN,n.os={darwin:n.OS_OSX,win32:n.OS_WINDOWS,linux:n.OS_LINUX}[process.platform]||n.OS_UNKNOWN,n.browserType=null,n.browserVersion=null,n.windowPixelResolution={width:0,height:0};else{var r=window,s=r.navigator,o=document,a=o.documentElement,c=s.userAgent.toLowerCase();cc.isEditor?(n.isMobile=!1,n.platform=n.EDITOR_PAGE):(n.isMobile=-1!==c.indexOf("mobile")||-1!==c.indexOf("android"),n.platform=n.isMobile?n.MOBILE_BROWSER:n.DESKTOP_BROWSER);var h=s.language;h=h?h:s.browserLanguage,h=h?h.split("-")[0]:n.LANGUAGE_ENGLISH,n.language=h;var l=c.match(/(iPad|iPhone|iPod)/i)?!0:!1,d=c.match(/android/i)||s.platform.match(/android/i)?!0:!1,u=n.OS_UNKNOWN;-1!==s.appVersion.indexOf("Win")?u=n.OS_WINDOWS:l?u=n.OS_IOS:-1!==s.appVersion.indexOf("Mac")?u=n.OS_OSX:-1!==s.appVersion.indexOf("X11")&&-1===s.appVersion.indexOf("Linux")?u=n.OS_UNIX:d?u=n.OS_ANDROID:-1!==s.appVersion.indexOf("Linux")&&(u=n.OS_LINUX),n.os=u,n.browserType=n.BROWSER_TYPE_UNKNOWN,function(){var t=/sogou|qzone|liebao|micromessenger|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i,e=/qqbrowser|chrome|safari|firefox|opr|oupeng|opera/i,i=t.exec(c);i||(i=e.exec(c));var r=i?i[0]:n.BROWSER_TYPE_UNKNOWN;"micromessenger"===r?r=n.BROWSER_TYPE_WECHAT:"safari"===r&&c.match(/android.*applewebkit/)?r=n.BROWSER_TYPE_ANDROID:"trident"===r?r=n.BROWSER_TYPE_IE:"360 aphone"===r?r=n.BROWSER_TYPE_360:"mxbrowser"===r?r=n.BROWSER_TYPE_MAXTHON:"opr"===r&&(r=n.BROWSER_TYPE_OPERA),n.browserType=r}(),n.browserVersion="",function(){var t=/(micromessenger|mx|maxthon|baidu|sogou)(mobile)?(browser)?\/?([\d.]+)/i,e=/(msie |rv:|firefox|chrome|ucbrowser|qq|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i,i=c.match(t);i||(i=c.match(e)),n.browserVersion=i?i[4]:""}();var _=window.innerWidth||document.documentElement.clientWidth,f=window.innerHeight||document.documentElement.clientHeight,p=window.devicePixelRatio||1;n.windowPixelResolution={width:p*_,height:p*f},n._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};var g=document.createElement("canvas"),m=document.createElement("canvas");if(cc.create3DContext=function(t,e){for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,r=0;r<i.length;++r){try{n=t.getContext(i[r],e)}catch(s){}if(n)break}return n},n._supportCanvasNewBlendModes=function(){var t=g;t.width=1,t.height=1;var e=t.getContext("2d");e.fillStyle="#000",e.fillRect(0,0,1,1),e.globalCompositeOperation="multiply";var i=m;i.width=1,i.height=1;var n=i.getContext("2d");return n.fillStyle="#fff",n.fillRect(0,0,1,1),e.drawImage(i,0,0,1,1),0===e.getImageData(0,0,1,1).data[0]}(),cc.sys.isMobile){var y=document.createElement("style");y.type="text/css",document.body.appendChild(y),y.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"}try{var v=n.localStorage=r.localStorage;v.setItem("storage",""),v.removeItem("storage"),v=null}catch(T){var C=function(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")};n.localStorage={getItem:C,setItem:C,removeItem:C,clear:C}}var S=!!g.getContext("2d"),E=!1,b=document.createElement("CANVAS");if(r.WebGLRenderingContext)try{var x=cc.create3DContext(b,{stencil:!0,preserveDrawingBuffer:!0});x&&(E=!0)}catch(T){}var A=n.capabilities={canvas:S,opengl:E};(void 0!==a.ontouchstart||void 0!==o.ontouchstart||s.msPointerEnabled)&&(A.touches=!0),void 0!==a.onmouseup&&(A.mouse=!0),void 0!==a.onkeyup&&(A.keyboard=!0),(r.DeviceMotionEvent||r.DeviceOrientationEvent)&&(A.accelerometer=!0),delete g,delete m}n.garbageCollect=function(){},n.dumpRoot=function(){},n.restartVM=function(){},n.cleanScript=function(t){},n.isObjectValid=function(t){return t?!0:!1},n.dump=function(){var t=this,e="";e+="isMobile : "+t.isMobile+"\r\n",e+="language : "+t.language+"\r\n",e+="browserType : "+t.browserType+"\r\n",e+="capabilities : "+JSON.stringify(t.capabilities)+"\r\n",e+="os : "+t.os+"\r\n",e+="platform : "+t.platform+"\r\n",cc.log(e)},n.openURL=function(t){window.open(t)},e.exports=n}},{}],60:[function(t,e,i){var n=cc.ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}},r=/\b_super\b/,s=function(){};s.extend=function(t){function e(){this.__instanceId=n.getNewInstanceId(),this.ctor&&this.ctor.apply(this,arguments)}var i=this.prototype,o=Object.create(i),a=n.getNewID();n[a]=i;var c={writable:!0,enumerable:!1,configurable:!0};o.__instanceId=null,e.id=a,c.value=a,Object.defineProperty(o,"__cid__",c),e.prototype=o,c.value=e,Object.defineProperty(e.prototype,"constructor",c);for(var h=0,l=arguments.length;l>h;++h){var d=arguments[h];for(var u in d){var _="function"==typeof d[u],f="function"==typeof i[u],p=r.test(d[u]);_&&f&&p?(c.value=function(t,e){return function(){var n=this._super;this._super=i[t];var r=e.apply(this,arguments);return this._super=n,r}}(u,d[u]),Object.defineProperty(o,u,c)):_?(c.value=d[u],Object.defineProperty(o,u,c)):o[u]=d[u]}}return e.extend=s.extend,e.implement=function(t){for(var e in t)o[e]=t[e]},e},cc.defineGetterSetter=function(t,e,i,n,r,s){if(t.__defineGetter__)i&&t.__defineGetter__(e,i),n&&t.__defineSetter__(e,n);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var o={enumerable:!1,configurable:!0};i&&(o.get=i),n&&(o.set=n),Object.defineProperty(t,e,o)}},cc.clone=function(t){var e=t.constructor?new t.constructor:{};for(var i in t){var n=t[i];e[i]="object"!=typeof n||!n||n instanceof _ccsg.Node||n instanceof HTMLElement?n:cc.clone(n)}return e},cc._Class=e.exports=s},{}],61:[function(t,e,i){function n(t,e,i){var n,r,s,o="_attr$"+e;if("function"==typeof t){if(n=t.prototype,r=n[o],"undefined"!=typeof i){if("object"!=typeof i)return n[o]=i,i;r||(n[o]=r={});for(s in i)"_"!==s[0]&&(r[s]=i[s])}return r}if(n=t,"undefined"!=typeof i){if("object"==typeof i){n.hasOwnProperty(o)&&(r=n[o]),r||(n[o]=r={});for(s in i)"_"!==s[0]&&(r[s]=i[s]);return l.addon({},r,n.constructor.prototype[o])}return n[o]=i,i}return r=n[o],"object"==typeof r?l.addon({},r,n.constructor.prototype[o]):r}function r(t,e,i){}function s(t){return{type:"Object",ctor:t}}function o(t){return{rawType:t,serializable:!1,_canUsedInGetter:!1,_onAfterProp:function(t,e){}}}function a(t,e){return{nullable:t,_onAfterProp:function(i,n){i.prop(t,e,{visible:!1});var r=cc.Class.attr(i,n)||{};r.serializable===!1?cc.Class.attr(i,t,d):r.editorOnly&&cc.Class.attr(i,t,u)}}}function c(t,e){return{watch:[].concat(t),watchCallback:e}}function h(t,e){return{min:t,max:e}}var l=t("./js"),d=(t("./utils").isPlainEmptyObj_DEV,{serializable:!1,_canUsedInGetter:!1}),u={editorOnly:!0,_canUsedInGetter:!1};e.exports={attr:n,getTypeChecker:r,NonSerialized:d,EditorOnly:u,ObjectType:s,RawType:o,ScriptUuid:{},Nullable:a,Watch:c,Range:h}},{"./js":66,"./utils":72}],62:[function(t,e,i){var n=t("./js"),r=function(){this._callbackTable={}};r.prototype.add=function(t,e,i){var n=this._callbackTable[t];return"undefined"!=typeof n?("function"==typeof e&&(null!==n?n.push(e):(n=[e],this._callbackTable[t]=n),"object"==typeof i&&n.push(i)),!1):(n="function"==typeof e?[e]:null,n&&"object"==typeof i&&n.push(i),this._callbackTable[t]=n,!0)},r.prototype.has=function(t,e,i){var n,r,s=this._callbackTable[t];if(s&&s.length>0){if(!e)return!0;if("function"!=typeof e)return!1;for(r=s.indexOf(e);-1!==r;){if(n=s[r+1],"object"!=typeof n&&(n=void 0),n===i)return!0;r=s.indexOf(e,r+1)}return!1}return!1},r.prototype.removeAll=function(t){if("object"==typeof t){var e,i,n,r=t;for(t in this._callbackTable)for(e=this._callbackTable[t],i=e.lastIndexOf(r);-1!==i;)n=e[i-1],"function"==typeof n?e.splice(i-1,2):e.splice(i,1),i=e.lastIndexOf(r)}else delete this._callbackTable[t]},r.prototype.remove=function(t,e,i){var n,r,s=this._callbackTable[t];if(s){for(n=s.indexOf(e);-1!==n;){if(r=s[n+1],"object"!=typeof r&&(r=void 0),r===i){s.splice(n,r?2:1);break}n=s.indexOf(e,n+1)}return!0}return!1};var s=function(){r.call(this)};n.extend(s,r),s.prototype.invoke=function(t,e,i,n,r,s){var o,a,c,h=this._callbackTable[t];if(h)for(o=0,a=h.length;a>o;)c=h[o+1],c&&"object"==typeof c?(h[o].call(c,e,i,n,r,s),o+=2):(h[o](e,i,n,r,s),++o)},s.prototype.invokeAndRemove=function(t,e,i,n,r,s){var o,a,c,h=this._callbackTable[t];if(h)for(o=0,a=h.length;a>o;)c=h[o+1],c&&"object"==typeof c?(h[o].call(c,e,i,n,r,s),o+=2):(h[o](e,i,n,r,s),++o);this.removeAll(t)},s.prototype.bindKey=function(t,e){var i=this;return function(n,r,s,o,a){var c,h,l,d=i._callbackTable[t];if(d)for(c=0,h=d.length;h>c;)l=d[c+1],l&&"object"==typeof l?(d[c].call(l,n,r,s,o,a),c+=2):(d[c](n,r,s,o,a),++c);e&&i.removeAll(t)}},s.CallbacksHandler=r,e.exports=s},{"./js":66}],63:[function(t,e,i){var n=t("./js"),r=(t("./CCObject"),!1),s=r,o=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp="",r&&(this.visitorInEditor=null,this.visitObjList=[],this.visitPropList=[])};o.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp="",r&&(this.visitorInEditor=null,this.visitObjList.length=0,this.visitPropList.length=0)},r&&(o.prototype.visitLater=function(t,e){this.visitObjList.push(t),this.visitPropList.push(e)}),o.prototype.getUuidOf=function(t,e){for(var i=0;i<this.uuidObjList.length;i++)if(this.uuidObjList[i]===t&&this.uuidPropList[i]===e)return this.uuidList[i];return""},o.prototype.assignAssetsBy=function(t){for(var e=!0,i=0,n=this.uuidList.length;n>i;i++){var r=this.uuidList[i],s=t(r);if(s){var o=this.uuidObjList[i],a=this.uuidPropList[i];o[a]=s}else cc.error("Failed to assign asset: "+r),e=!1}return e};var a=function(){function t(t,e,i,n){if(this._classFinder=n,s&&(this._target=i),this._idList=[],this._idObjList=[],this._idPropList=[],this.result=e||new o,Array.isArray(t)){var a=t,l=a.length;this.deserializedList=new Array(l);for(var d=0;l>d;d++)if(a[d]){var u;s&&(u=0===d&&i),this.deserializedList[d]=h(this,a[d],u)}this.deserializedData=l>0?this.deserializedList[0]:[]}else this.deserializedList=[null],this.deserializedData=t?h(this,t,i):null,this.deserializedList[0]=this.deserializedData;c(this),r&&this._callVisitorInEditor()}function e(t,e,i){for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];"object"!=typeof o?"__type__"!==n&&(e[n]=o,t.result.visitorInEditor&&r&&t.result.visitLater(e,n)):o?s?t._deserializeObjField(e,o,n,t._target&&e):t._deserializeObjField(e,o,n):e[n]=null}}function i(t,e,i){for(var n in e){var r=i[n];"undefined"!=typeof r&&i.hasOwnProperty(n)&&("object"!=typeof r?e[n]=r:r?s?t._deserializeObjField(e,r,n,t._target&&e):t._deserializeObjField(e,r,n):e[n]=null)}}function a(t,i,n,o,a){for(var c=o.__props__,h=0;h<c.length;h++){var l=c[h],d=cc.Class.attr(o,l),u=d.rawType;if(u)t.result.rawProp&&cc.error("not support multi raw object in a file"),t.result.rawProp=l;else{if(!r&&d.editorOnly)continue;if(d.serializable===!1)continue;var _=n[l];if("undefined"==typeof _)continue;"object"!=typeof _?i[l]=_:_?s?t._deserializeObjField(i,_,l,a&&i):t._deserializeObjField(i,_,l):i[l]=null}}"_$erialized"===c[c.length-1]&&(i._$erialized=n,e(t,i._$erialized,n))}var c=function(t){for(var e=t.deserializedList,i=0,n=t._idList.length;n>i;i++){var r=t._idPropList[i],s=t._idList[i];t._idObjList[i][r]=e[s]}};r&&(t.prototype._callVisitorInEditor=function(){var t=this.result;t.visitorInEditor&&t.visitorInEditor(t.visitObjList,t.visitPropList,this)}),t.prototype._deserializeObjField=function(t,e,i,n){var o=e.__id__;if("undefined"==typeof o){var a=e.__uuid__;a?(this.result.uuidList.push(a),this.result.uuidObjList.push(t),this.result.uuidPropList.push(i)):(t[i]=s?h(this,e,n&&n[i]):h(this,e),this.result.visitorInEditor&&r&&this.result.visitLater(t,i))}else{var c=this.deserializedList[o];c?t[i]=c:(this._idList.push(o),this._idObjList.push(t),this._idPropList.push(i)),this.result.visitorInEditor&&r&&this.result.visitLater(t,i)}};var h=function(t,o,c){var h,l=null,d=null;if(o.__type__){if(d=t._classFinder(o.__type__),!d)return cc.error("[cc.deserialize] unknown type: "+o.__type__),null;if(s&&c?(c instanceof d||cc.warn("Type of target to deserialize not matched with data: target is %s, data is %s",n.getClassName(c),d),l=c):(l=new d,cc.sys.isNative&&d===cc.SpriteFrame&&l.retain()),l._deserialize)return l._deserialize(o.content,t),l;cc.Class._isCCClass(d)?a(t,l,o,d,c):i(t,l,o)}else if(Array.isArray(o)){s&&c?(c.length=o.length,l=c):l=new Array(o.length);for(var u=0;u<o.length;u++)h=o[u],"object"==typeof h&&h?s?t._deserializeObjField(l,h,""+u,c&&l):t._deserializeObjField(l,h,""+u):(l[u]=h,t.result.visitorInEditor&&r&&t.result.visitLater(l,""+u))}else l=s&&c||{},e(t,l,o);return l};return t}();cc.deserialize=function(t,e,i){var r=i&&i.classFinder||n._getClassById,c=i&&i.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,h=s&&i&&i.target;"string"==typeof t&&(t=JSON.parse(t)),c&&!e&&(e=new o),cc.game._isCloning=!0;var l=new a(t,e,h,r);return cc.game._isCloning=!1,c&&e.assignAssetsBy(Editor.serialize.asAsset),l.deserializedData},cc.deserialize.Details=o},{"./CCObject":58,"./js":66}],64:[function(t,e,i){t("./js"),t("./CCClass"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./prefab-info"),t("./requiring-frame"),t("./CCSys"),t("./CCLoader"),t("./CCMacro"),(cc.sys.isBrowser||cc.sys.isNative)&&(t("./load-manager"),t("./CCAssetLibrary"))},{"./CCAssetLibrary":52,"./CCClass":53,"./CCLoader":56,"./CCMacro":57,"./CCObject":58,"./CCSys":59,"./callbacks-invoker":62,"./deserialize":63,"./instantiate":65,"./js":66,"./load-manager":67,"./prefab-info":68,"./requiring-frame":70,"./url":71}],65:[function(t,e,i){function n(t){if("object"!=typeof t||Array.isArray(t))return cc.error("The thing you want to instantiate must be an object"),null;if(!t)return cc.error("The thing you want to instantiate is nil"),null;if(t instanceof o&&!t.isValid)return cc.error("The thing you want to instantiate is destroyed"),null;var e;if(t instanceof o){if(t._instantiate)return cc.game._isCloning=!0,e=t._instantiate(),cc.game._isCloning=!1,e;if(t instanceof cc.Asset)return cc.error("The instantiate method for given asset do not implemented"),null}return cc.game._isCloning=!0,e=r(t),cc.game._isCloning=!1,e}function r(t,e){if(Array.isArray(t))return cc.error("Can not instantiate array"),null;if(c&&c(t))return cc.error("Can not instantiate DOM element"),null;for(var i=l(t,e),n=0,r=h.length;r>n;++n)h[n]._iN$t=null;return h.length=0,i}function s(t,e,i,n){var r=t._iN$t;if(r)return r;if(t instanceof cc.Asset)return t;if(Array.isArray(t)){var o=t.length;r=new Array(o),t._iN$t=r;for(var a=0;o>a;++a){var c=t[a],d=typeof c;r[a]="object"===d?c?s(c,e,r,""+a):c:"function"!==d?c:null}return h.push(t),r}if(t instanceof cc.ValueType)return t.clone();var u=t.constructor;if(cc.Class._isCCClass(u)){if(e)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof cc.Component&&!t.node.isChildOf(e))return t}else if(u!==Object)return t;return l(t,e)}var o=t("./CCObject"),a=o.Flags.PersistentMask,c=t("./utils").isDomNode,h=[],l=function(t,e){
var i,n,r,c=t.constructor,l=new c;if(t._iN$t=l,h.push(t),cc.Class._isCCClass(c)){for(var d=c.__props__,u=0;u<d.length;u++){r=d[u];var _=cc.Class.attr(c,r);_.serializable!==!1&&(i=t[r],n=typeof i,l[r]="object"===n?i?s(i,e,l,r):i:"function"!==n?i:null)}l instanceof cc._BaseNode,1}else for(r in t)!t.hasOwnProperty(r)||95===r.charCodeAt(0)&&95===r.charCodeAt(1)||(i=t[r],i!==l&&(n=typeof i,l[r]="object"===n?i?s(i,e,l,r):i:"function"!==n?i:null));return t instanceof o&&(l._objFlags&=a),l};n._clone=r,cc.instantiate=n,e.exports=n},{"./CCObject":58,"./utils":72}],66:[function(t,e,i){function n(t,e){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;var r=Object.getPrototypeOf(t);return r?n(r,e):null}function r(t,e,i){var r=n(e,t);Object.defineProperty(i,t,r)}function s(){return a+c++}var o={isFunction:function(t){return"function"==typeof t},isNumber:function(t){return"number"==typeof t||"[object Number]"===Object.prototype.toString.call(t)},isString:function(t){return"string"==typeof t||"[object String]"===Object.prototype.toString.call(t)},isArray:function(t){return Array.isArray(t)||"object"==typeof t&&"[object Array]"===Object.prototype.toString.call(t)},isUndefined:function(t){return"undefined"==typeof t},isObject:function(t){return"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)},addon:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;i>e;e++){var n=arguments[e];if(n){if("object"!=typeof n){cc.error("cc.js.addon called on non-object:",n);continue}for(var s in n)s in t||r(s,n,t)}}return t},mixin:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;i>e;e++){var n=arguments[e];if(n){if("object"!=typeof n){cc.error("cc.js.mixin: arguments must be type object:",n);continue}for(var s in n)r(s,n,t)}}return t},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t},clear:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)delete t[e[i]]},getPropertyDescriptor:n};o.getClassName=function(t){if("function"==typeof t){if(t.prototype.__classname__)return t.prototype.__classname__}else if(t&&t.constructor){if(t.constructor.prototype&&t.constructor.prototype.hasOwnProperty("__classname__"))return t.__classname__;var e;if(t.constructor.name&&(e=t.constructor.name),t.constructor.toString){var i,n=t.constructor.toString();i=n.match("["===n.charAt(0)?/\[\w+\s*(\w+)\]/:/function\s*(\w+)/),i&&2===i.length&&(e=i[1])}return"Object"!==e?e:""}return""};var a="cc.TmpCId.",c=0;o._isTempClassId=function(t){return!1},function(){function t(t,e){return function(i,n){if(n.prototype.hasOwnProperty(t)&&delete e[n.prototype[t]],n.prototype[t]=i,i){var r=e[i];if(r&&r!==n){var s="A Class already exists with the same "+t+' : "'+i+'".';cc.error(s)}else e[i]=n}}}var e={},i={};o._setClassId=t("__cid__",e);var n=t("__classname__",i);o.setClassName=function(t,e){if(n(t,e),!e.prototype.hasOwnProperty("__cid__")){var i=t||s();i&&o._setClassId(i,e)}},o.unregisterClass=function(t){"use strict";for(var n=0;n<arguments.length;n++){var r=arguments[n].prototype,s=r.__cid__;s&&delete e[s];var o=r.__classname__;o&&delete i[o]}},o._getClassById=function(t){return e[t]},o.getClassByName=function(t){return i[t]},o._getClassId=function(t,e){e="undefined"!=typeof e?e:!0;var i;if("function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return i=t.prototype.__cid__,!e&&o._isTempClassId(i)?"":i;if(t&&t.constructor){var n=t.constructor.prototype;if(n&&n.hasOwnProperty("__cid__"))return i=t.__cid__,!e&&o._isTempClassId(i)?"":i}return""}}(),o.getset=function(t,e,i,n,r){"function"!=typeof n&&(r=n,n=void 0),Object.defineProperty(t,e,{get:i,set:n,enumerable:!!r})},o.get=function(t,e,i,n){Object.defineProperty(t,e,{get:i,enumerable:!!n})},o.set=function(t,e,i,n){Object.defineProperty(t,e,{set:i,enumerable:!!n})},o.obsolete=function(t,e,i,n){var r=e.split(".").slice(-1);o.get(t,r,function(){return t[i]}),n&&o.set(t,r,function(e){t[i]=e})},o.obsoletes=function(t,e,i,n){for(var r in i){var s=i[r];o.obsolete(t,e+"."+r,s,n)}},o.array={remove:function(t,e){var i=t.indexOf(e);return-1!==i?(t.splice(i,1),!0):!1},removeAt:function(t,e){t.splice(e,1)},contains:function(t,e){return-1!==t.indexOf(e)},verifyType:function(t,e){if(t&&t.length>0)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.log(cc._LogInfos.Array.verifyType),!1;return!0},removeArray:function(t,e){for(var i=0,n=e.length;n>i;i++)remove(t,e[i])},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},copy:function(t){var e,i=t.length,n=new Array(i);for(e=0;i>e;e+=1)n[e]=t[e];return n}},cc.js=o,e.exports=o},{}],67:[function(t,e,i){function n(){return{image:{loader:cc.loader.loadImg.bind(cc.loader),defaultExtname:".host"},json:{loader:cc.loader.loadJson.bind(cc.loader),defaultExtname:".json"},text:{loader:cc.loader.loadTxt.bind(cc.loader),defaultExtname:".txt"}}}function r(t,e,i){h._curConcurrent+=1,t(e,function(t,e){i(t,e),h._curConcurrent=Math.max(0,h._curConcurrent-1),c()})}var s=t("./callbacks-invoker"),o=new s,a=[],c=function(){if(h._curConcurrent>=h.maxConcurrent)return void cc.error("too many concurrent requests");var t=a.pop();t&&r(t.loader,t.url,t.callback)},h={maxConcurrent:2,_curConcurrent:0,loadByLoader:function(t,e,i){if(o.add(e,i)){var n=o.bindKey(e,!0);this._curConcurrent<this.maxConcurrent?r(t,e,n):a.push({url:e,loader:t,callback:n})}},load:function(t,e,i,n){"function"==typeof i&&(n=i);var r=this._rawTypes[e];if(r){var s=i?"."+i:r.defaultExtname;if(s){var o=t+s;this.loadByLoader(r.loader,o,n)}else n(new Error("Undefined extname for the raw "+e+" file of "+t),null)}else n(new Error('Unknown raw type "'+e+'" of '+t),null)},_rawTypes:n(),registerRawTypes:function(t,e,i){return this._rawTypes[t]?void cc.error('rawType "%s" has already defined',t):(i&&"."!==i[0]&&(i="."+i),void(this._rawTypes[t]={loader:e,defaultExtname:i}))},reset:function(){},isLoading:function(t,e){}};cc._LoadManager=h,e.exports=h},{"./callbacks-invoker":62}],68:[function(t,e,i){var n=cc.Class({name:"cc.PrefabInfo",properties:{root:{"default":null},asset:{"default":null},fileId:{"default":""}}});cc._PrefabInfo=e.exports=n},{}],69:[function(t,e,i){function n(t,e,i,n){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r="_N$"+e;t.get=function(){return this[r]},t.set=function(t){var e=this[r];this[r]=t,i.call(this,e)};var s={};n[r]=s;for(var o in a){var c=a[o];t.hasOwnProperty(o)&&(s[o]=t[o],c.canUsedInGet||delete t[o])}}}function r(t,e,i,n){Array.isArray(n)&&n.length>0&&(n=n[0]),t.type=n}function s(t,e,i,n){if(Array.isArray(e)){if(!(e.length>0))return cc.error("Invalid type of %s.%s",i,n);t.type=e=e[0]}}function o(t,e,i,n){}var a=(t("./attribute"),{url:{canUsedInGet:!0},"default":{},serializable:{},editorOnly:{},rawType:{}});e.exports=function(t,e){for(var i in t){var a=t[i],c=a&&"object"==typeof a&&!Array.isArray(a),h=c&&a.constructor===Object;if(h||(t[i]=a={"default":a}),a){var l=a.notify;l&&n(a,i,l,t),"type"in a&&s(a,a.type,e,i),"url"in a&&r(a,e,i,a.url),"type"in a&&o(a,a.type,e,i)}}}},{"./CCClass":53,"./attribute":61}],70:[function(t,e,i){var n=[];cc._RFpush=function(t,e,i){2===arguments.length&&(i=e,e=""),n.push({uuid:e,script:i,module:t,exports:t.exports,beh:null})},cc._RFpop=function(){var t=n.pop(),e=t.module,i=e.exports;if(i===t.exports){for(var r in i)return;e.exports=i=t.beh}},cc._RFpeek=function(){return n[n.length-1]}},{}],71:[function(t,e,i){var n={};cc.url={_rawAssets:"",_builtinRawAssets:"",raw:function(t){return!this._rawAssets,"."===t[0]&&"/"===t[1]?t=t.slice(2):"/"===t[0]&&(t=t.slice(1)),this._rawAssets+t},builtinRaw:function(t){return!this._rawAssets,"."===t[0]&&"/"===t[1]?t=t.slice(2):"/"===t[0]&&(t=t.slice(1)),this._builtinRawAssets+t},_init:function(t){for(var e in t){var i=t[e];i=cc.path._setEndWithSep(i,"/"),n[e]=i}this._rawAssets=n.assets,this._builtinRawAssets=n.internal}},e.exports=cc.url},{}],72:[function(t,e,i){e.exports={isDomNode:"object"==typeof window&&function(t){return"object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName},callInNextTick:function(t,e,i){t&&setTimeout(function(){t(e,i)},1)}}},{}],73:[function(t,e,i){var n=t("../event/event-target");cc.SpriteFrame=cc.Class({name:"cc.SpriteFrame","extends":t("../assets/CCAsset"),mixins:[n],ctor:function(){var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4];this._rect=new cc.Rect,this._rectInPixels=new cc.Rect,this._offset=new cc.Vec2,this._offsetInPixels=new cc.Vec2,this._originalSize=new cc.Size,this._originalSizeInPixels=new cc.Size,this._rotated=!1,this.insetTop=0,this.insetBottom=0,this.insetLeft=0,this.insetRight=0,this._texture=null,this._textureFilename="",this._textureLoaded=!1,this._loadingUuid="",void 0!==t&&void 0!==e&&(void 0===i||void 0===n||void 0===r?this.initWithTexture(t,e):this.initWithTexture(t,e,i,n,r))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},getRectInPixels:function(){var t=this._rectInPixels;return cc.rect(t.x,t.y,t.width,t.height)},setRectInPixels:function(t){var e=this._rectInPixels;e||(this._rectInPixels=e=cc.rect()),e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._rect=cc.rectPixelsToPoints(t)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){var t=this._rect;return cc.rect(t.x,t.y,t.width,t.height)},setRect:function(t){this._rect||(this._rect=cc.rect(0,0,0,0)),this._rect.x=t.x,this._rect.y=t.y,this._rect.width=t.width,this._rect.height=t.height,this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels)},setOffsetInPixels:function(t){this._offsetInPixels.x=t.x,this._offsetInPixels.y=t.y,cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(t){this._originalSizeInPixels.width=t.width,this._originalSizeInPixels.height=t.height},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize.width=t.width,this._originalSize.height=t.height},getTexture:function(){if(this._texture)return this._texture;if(""!==this._textureFilename){var t=cc.textureCache.addImage(this._textureFilename);return t&&(this._textureLoaded=t.isLoaded()),t}return null},setTexture:function(t){if(this._texture!==t){var e=t.isLoaded();this._textureLoaded=e,this._texture=t,e||t.once("load",function(t){var e=t.currentTarget;if(this._textureLoaded=!0,this._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var i=e.getHtmlElementObj();i=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(i,this.getRect());var n=new cc.Texture2D;n.initWithElement(i),n.handleLoadedTexture(),this.setTexture(n);var r=this.getRect();this.setRect(cc.rect(0,0,r.width,r.height))}var s=this._rect;if(0===s.width&&0===s.height){var o=e.width,a=e.height;this._rect.width=o,this._rect.height=a,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=o,this._originalSize.height=a}this.emit("load")},this)}},getOffset:function(){return cc.p(this._offset)},setOffset:function(t){this._offset.x=t.x,this._offset.y=t.y},clone:function(){var t=new cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},initWithTexture:function(t,e,i,n,r,s){function o(t){if(t&&t.url&&t.isLoaded()){var n,r;i?(n=e.x+e.height,r=e.y+e.width):(n=e.x+e.width,r=e.y+e.height),n>t.getPixelWidth()&&cc.error(cc._LogInfos.RectWidth,t.url),r>t.getPixelHeight()&&cc.error(cc._LogInfos.RectHeight,t.url)}}return!t&&s?(this._texture=new cc.Texture2D,cc.AssetLibrary.queryAssetInfo(s,function(t,e){if(t)return void cc.error('SpriteFrame: Failed to load sprite texture "%s", %s',s,t);this._textureFilename=e,this._loadingUuid="";var i=new cc.Texture2D;i.url=e,cc.textureCache.cacheImage(e,i),cc.loader.load(e,function(t){function n(){o.removeEventListener("load",n,!1),o.removeEventListener("error",r,!1),i.handleLoadedTexture(s)}function r(){o.removeEventListener("load",n,!1),o.removeEventListener("error",r,!1)}if(t)return void cc.error('SpriteFrame: Failed to load sprite texture "%s", %s',e,t[0]);var s=cc.AUTO_PREMULTIPLIED_ALPHA_FOR_PNG&&".png"===cc.path.extname(e),o=cc.loader.getRes(e),a=o.width>0||o.height>0;a?i.handleLoadedTexture(s):(o.addEventListener("load",n),o.addEventListener("error",r))}),this.setTexture(i),i.isLoaded()&&this.emit("load"),o(i)}.bind(this))):(cc.js.isString(t)?(this._texture=null,this._textureFilename=t,this._loadingUuid=""):t instanceof cc.Texture2D&&this.setTexture(t),o(this.getTexture())),2===arguments.length&&(e=cc.rectPointsToPixels(e)),n=n||cc.p(0,0),r=r||e,i=i||!1,this._rectInPixels=e,e=this._rect=cc.rectPixelsToPoints(e),this._offsetInPixels.x=n.x,this._offsetInPixels.y=n.y,cc._pointPixelsToPointsOut(n,this._offset),this._originalSizeInPixels.width=r.width,this._originalSizeInPixels.height=r.height,cc._sizePixelsToPointsOut(r,this._originalSize),this._rotated=i,!0},_serialize:function(){},_deserialize:function(t){var e=t.rect;e=new cc.Rect(e[0],e[1],e[2],e[3]);var i=cc.rectPointsToPixels(e),n=new cc.Vec2(t.offset[0],t.offset[1]),r=cc.pointPointsToPixels(n),s=new cc.Size(t.originalSize[0],t.originalSize[1]),o=cc.sizePointsToPixels(s),a=1===t.rotated;this._name=t.name;var c=t.capInsets;c&&(this.insetLeft=c[0],this.insetTop=c[1],this.insetRight=c[2],this.insetBottom=c[3]);var h=t.texture;this._loadingUuid=h,this.initWithTexture(null,i,a,r,o,h)}});var r=cc.SpriteFrame.prototype;r.copyWithZone=r.clone,r.copy=r.clone,cc.SpriteFrame.create=function(t,e,i,n,r){return new cc.SpriteFrame(t,e,i,n,r)},cc.SpriteFrame.createWithTexture=cc.SpriteFrame.create,cc.SpriteFrame._frameWithTextureForCanvas=function(t,e,i,n,r){var s=new cc.SpriteFrame;return s._texture=t,s._rectInPixels=e,s._rect=cc.rectPixelsToPoints(e),s._offsetInPixels.x=n.x,s._offsetInPixels.y=n.y,cc._pointPixelsToPointsOut(s._offsetInPixels,s._offset),s._originalSizeInPixels.width=r.width,s._originalSizeInPixels.height=r.height,cc._sizePixelsToPointsOut(s._originalSizeInPixels,s._originalSize),s._rotated=i,s}},{"../assets/CCAsset":22,"../event/event-target":48}],74:[function(t,e,i){var n=t("../event/event-target"),r=t("../platform/CCSys"),s=t("../platform/js"),o=t("../CCGame");t("../platform/_CCClass"),t("../platform/CCClass"),cc.ALIGN_CENTER=51,cc.ALIGN_TOP=19,cc.ALIGN_TOP_RIGHT=18,cc.ALIGN_RIGHT=50,cc.ALIGN_BOTTOM_RIGHT=34,cc.ALIGN_BOTTOM=35,cc.ALIGN_BOTTOM_LEFT=33,cc.ALIGN_LEFT=49,cc.ALIGN_TOP_LEFT=17;var a=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),c=cc.Class({name:"cc.Texture2D","extends":t("../assets/CCRawAsset"),mixins:[n],ctor:function(){this.url=null,this._textureLoaded=!1,this._htmlElementObj=null,this._contentSize=cc.size(0,0),cc._renderType===o.RENDER_TYPE_CANVAS?(this._pattern="",this._grayElementObj=null,this._backupElement=null,this._isGray=!1):cc._renderType===o.RENDER_TYPE_WEBGL&&(this._hasPremultipliedAlpha=!1,this._pixelFormat=c.defaultPixelFormat,this._pixelsWide=0,this._pixelsHigh=0,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this._webTextureObj=null)},getPixelWidth:function(){return this._contentSize.width},getPixelHeight:function(){return this._contentSize.height},getContentSize:function(){var t=cc.contentScaleFactor();return cc.size(this._contentSize.width/t,this._contentSize.height/t)},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(t){t&&(this._htmlElementObj=t,this._contentSize.width=t.width,this._contentSize.height=t.height,this._textureLoaded=!0)},initWithData:function(t,e,i,n,r){return!1},initWithImage:function(t){return!1},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){var t=this;if(!t._textureLoaded){if(!t._htmlElementObj){var e=cc.loader.getRes(t.url);if(!e)return;t.initWithElement(e)}var i=t._htmlElementObj;t._contentSize.width=i.width,t._contentSize.height=i.height,t.emit("load")}},description:function(){return"<cc.Texture2D | Name = "+this.getName()+" | Dimensions = "+this.getPixelWidth()+" x "+this.getPixelHeight()+">"},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj),cc.loader.release(this.url)},getName:function(){return this._webTextureObj||null},getPixelFormat:function(){return this._pixelFormat||null},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha||!1},hasMipmaps:function(){return this._hasMipmaps||!1},setTexParameters:function(t,e,i,n){return void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),t.wrapS===a.REPEAT&&t.wrapT===a.REPEAT?void(this._pattern="repeat"):t.wrapS===a.REPEAT?void(this._pattern="repeat-x"):t.wrapT===a.REPEAT?void(this._pattern="repeat-y"):void(this._pattern="")},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(t){return-1}});c.WrapMode=a;var h=c;h.PIXEL_FORMAT_RGBA8888=2,h.PIXEL_FORMAT_RGB888=3,h.PIXEL_FORMAT_RGB565=4,h.PIXEL_FORMAT_A8=5,h.PIXEL_FORMAT_I8=6,h.PIXEL_FORMAT_AI88=7,h.PIXEL_FORMAT_RGBA4444=8,h.PIXEL_FORMAT_RGB5A1=7,h.PIXEL_FORMAT_PVRTC4=9,h.PIXEL_FORMAT_PVRTC2=10,h.PIXEL_FORMAT_DEFAULT=h.PIXEL_FORMAT_RGBA8888,h.defaultPixelFormat=h.PIXEL_FORMAT_DEFAULT;var l=c._M={};l[h.PIXEL_FORMAT_RGBA8888]="RGBA8888",l[h.PIXEL_FORMAT_RGB888]="RGB888",l[h.PIXEL_FORMAT_RGB565]="RGB565",l[h.PIXEL_FORMAT_A8]="A8",l[h.PIXEL_FORMAT_I8]="I8",l[h.PIXEL_FORMAT_AI88]="AI88",l[h.PIXEL_FORMAT_RGBA4444]="RGBA4444",l[h.PIXEL_FORMAT_RGB5A1]="RGB5A1",l[h.PIXEL_FORMAT_PVRTC4]="PVRTC4",l[h.PIXEL_FORMAT_PVRTC2]="PVRTC2";var d=c._B={};d[h.PIXEL_FORMAT_RGBA8888]=32,d[h.PIXEL_FORMAT_RGB888]=24,d[h.PIXEL_FORMAT_RGB565]=16,d[h.PIXEL_FORMAT_A8]=8,d[h.PIXEL_FORMAT_I8]=8,d[h.PIXEL_FORMAT_AI88]=16,d[h.PIXEL_FORMAT_RGBA4444]=16,d[h.PIXEL_FORMAT_RGB5A1]=16,d[h.PIXEL_FORMAT_PVRTC4]=4,d[h.PIXEL_FORMAT_PVRTC2]=3;var u=c.prototype;u.name,cc.defineGetterSetter(u,"name",u.getName),u.pixelFormat,cc.defineGetterSetter(u,"pixelFormat",u.getPixelFormat),u.pixelWidth,cc.defineGetterSetter(u,"pixelWidth",u.getPixelWidth),u.pixelHeight,cc.defineGetterSetter(u,"pixelHeight",u.getPixelHeight),u.width,cc.defineGetterSetter(u,"width",u._getWidth),u.height,cc.defineGetterSetter(u,"height",u._getHeight),o.once(o.EVENT_RENDERER_INITED,function(){if(cc._renderType===o.RENDER_TYPE_CANVAS){var t=function(t,e){var i=t.width,n=t.height;e[0].width=i,e[0].height=n,e[1].width=i,e[1].height=n,e[2].width=i,e[2].height=n,e[3].width=i,e[3].height=n;var r=e[3].getContext("2d");r.drawImage(t,0,0);for(var s,o=r.getImageData(0,0,i,n).data,a=0;4>a;a++){s=e[a].getContext("2d");for(var c=s.getImageData(0,0,i,n),h=c.data,l=0;l<o.length;l+=4)h[l]=0===a?o[l]:0,h[l+1]=1===a?o[l+1]:0,h[l+2]=2===a?o[l+2]:0,h[l+3]=o[l+3];s.putImageData(c,0,0)}t.onload=null},e=function(t,e,i){if(null===t)return null;i=i||document.createElement("canvas"),e=e||cc.rect(0,0,t.width,t.height),i.width=e.width,i.height=e.height;var n=i.getContext("2d");n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),s=r.data,o=0,a=s.length;a>o;o+=4)s[o]=s[o+1]=s[o+2]=.34*s[o]+.5*s[o+1]+.16*s[o+2];return n.putImageData(r,0,0),i};s.mixin(c.prototype,{_generateTextureCacheForColor:function(){if(this.channelCache)return this.channelCache;var e=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return t(this._htmlElementObj,e),this.channelCache=e},_switchToGray:function(t){this._textureLoaded&&this._isGray!==t&&(this._isGray=t,this._isGray?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=e(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=this._backupElement))},_generateGrayTexture:function(){if(!this._textureLoaded)return null;var t=e(this._htmlElementObj),i=new c;return i.initWithElement(t),i.handleLoadedTexture(),i},_generateColorTexture:r._supportCanvasNewBlendModes?function(t,e,i,n,r){var s=!1;r?s=!0:r=document.createElement("canvas");var o=this._htmlElementObj;n||(n=cc.rect(0,0,o.width,o.height)),r.width=n.width,r.height=n.height;var a=r.getContext("2d");if(a.globalCompositeOperation="source-over",a.fillStyle="rgb("+(0|t)+","+(0|e)+","+(0|i)+")",a.fillRect(0,0,n.width,n.height),a.globalCompositeOperation="multiply",a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height),a.globalCompositeOperation="destination-atop",a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height),s)return r;var h=new c;return h.initWithElement(r),h.handleLoadedTexture(),h}:function(t,e,i,n,r){var s=!1;r?s=!0:r=document.createElement("canvas");var o=this._htmlElementObj;n||(n=cc.rect(0,0,o.width,o.height));var a,h,l,d;if(a=n.x,h=n.y,l=n.width,d=n.height,l&&d){r.width=l,r.height=d;var u=r.getContext("2d"),_=cc.textureCache.getTextureColors(this);if(u.globalCompositeOperation="lighter",u.drawImage(_[3],a,h,l,d,0,0,l,d),t>0&&(u.globalAlpha=t/255,u.drawImage(_[0],a,h,l,d,0,0,l,d)),e>0&&(u.globalAlpha=e/255,u.drawImage(_[1],a,h,l,d,0,0,l,d)),i>0&&(u.globalAlpha=i/255,u.drawImage(_[2],a,h,l,d,0,0,l,d)),s)return r;var f=new c;return f.initWithElement(r),f.handleLoadedTexture(),f}}})}else cc._renderType===o.RENDER_TYPE_WEBGL&&s.mixin(c.prototype,{getPixelWidth:function(){return this._pixelsWide},getPixelHeight:function(){return this._pixelsHigh},initWithData:function(t,e,i,n,r){var s=this,o=c,a=cc._renderContext,h=a.RGBA,l=a.UNSIGNED_BYTE,d=c._B[e],u=i*d/8;switch(u%8===0?a.pixelStorei(a.UNPACK_ALIGNMENT,8):u%4===0?a.pixelStorei(a.UNPACK_ALIGNMENT,4):u%2===0?a.pixelStorei(a.UNPACK_ALIGNMENT,2):a.pixelStorei(a.UNPACK_ALIGNMENT,1),s._webTextureObj=a.createTexture(),cc.glBindTexture2D(s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),e){case o.PIXEL_FORMAT_RGBA8888:h=a.RGBA;break;case o.PIXEL_FORMAT_RGB888:h=a.RGB;break;case o.PIXEL_FORMAT_RGBA4444:l=a.UNSIGNED_SHORT_4_4_4_4;break;case o.PIXEL_FORMAT_RGB5A1:l=a.UNSIGNED_SHORT_5_5_5_1;break;case o.PIXEL_FORMAT_RGB565:l=a.UNSIGNED_SHORT_5_6_5;break;case o.PIXEL_FORMAT_AI88:h=a.LUMINANCE_ALPHA;break;case o.PIXEL_FORMAT_A8:h=a.ALPHA;break;case o.PIXEL_FORMAT_I8:h=a.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D.initWithData)}return a.texImage2D(a.TEXTURE_2D,0,h,i,n,0,h,l,t),s._contentSize.width=r.width,s._contentSize.height=r.height,s._pixelsWide=i,s._pixelsHigh=n,s._pixelFormat=e,s._hasPremultipliedAlpha=!1,s._hasMipmaps=!1,s._textureLoaded=!0,!0},initWithImage:function(t){if(null==t)return cc.log(cc._LogInfos.Texture2D.initWithImage),!1;var e=t.getWidth(),i=t.getHeight(),n=cc.configuration.getMaxTextureSize();return e>n||i>n?(cc.log(cc._LogInfos.Texture2D.initWithImage_2,e,i,n,n),!1):(this._textureLoaded=!0,this._initPremultipliedATextureWithImage(t,e,i))},initWithElement:function(t){t&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=t,this._textureLoaded=!0)},handleLoadedTexture:function(t){t=!!t;var e=this;if(o._rendererInitialized){if(!e._htmlElementObj){var i=cc.loader.getRes(e.url);if(!i)return;e.initWithElement(i)}if(e._htmlElementObj.width&&e._htmlElementObj.height){var n=cc._renderContext;cc.glBindTexture2D(e),n.pixelStorei(n.UNPACK_ALIGNMENT,4),t&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._htmlElementObj),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),cc.glBindTexture2D(null),t&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);var r=e._htmlElementObj.width,s=e._htmlElementObj.height;e._pixelsWide=e._contentSize.width=r,e._pixelsHigh=e._contentSize.height=s,e._pixelFormat=c.PIXEL_FORMAT_RGBA8888,e._hasPremultipliedAlpha=t,e._hasMipmaps=!1,e.emit("load")}}},setTexParameters:function(t,e,i,n){var r=this,s=cc._renderContext;void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),cc.assert(r._pixelsWide===cc.NextPOT(r._pixelsWide)&&r._pixelsHigh===cc.NextPOT(r._pixelsHigh)||t.wrapS===s.CLAMP_TO_EDGE&&t.wrapT===s.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.glBindTexture2D(r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,t.minFilter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t.magFilter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,t.wrapS),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,t.wrapT)},setAntiAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},setAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},generateMipmap:function(){var t=this;cc.assert(t._pixelsWide===cc.NextPOT(t._pixelsWide)&&t._pixelsHigh===cc.NextPOT(t._pixelsHigh),"Mimpap texture only works in POT textures"),cc.glBindTexture2D(t),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),t._hasMipmaps=!0},stringForFormat:function(){return c._M[this._pixelFormat]},bitsPerPixelForFormat:function(t){t=t||this._pixelFormat;var e=c._B[t];return null!=e?e:(cc.log(cc._LogInfos.Texture2D.bitsPerPixelForFormat,t),-1)},_initPremultipliedATextureWithImage:function(t,e,i){var n,r=c,s=t.getData(),o=null,a=null,h=t.hasAlpha(),l=cc.size(t.getWidth(),t.getHeight()),d=r.defaultPixelFormat,u=t.getBitsPerComponent();h||(u>=8?d=r.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D._initPremultipliedATextureWithImage),d=r.PIXEL_FORMAT_RGB565));var _=e*i;if(d===r.PIXEL_FORMAT_RGB565)if(h)for(s=new Uint16Array(e*i),o=t.getData(),n=0;_>n;++n)s[n]=(o[n]>>0&255)>>3<<11|(o[n]>>8&255)>>2<<5|(o[n]>>16&255)>>3<<0;else for(s=new Uint16Array(e*i),a=t.getData(),n=0;_>n;++n)s[n]=(255&a[n])>>3<<11|(255&a[n])>>2<<5|(255&a[n])>>3<<0;else if(d===r.PIXEL_FORMAT_RGBA4444)for(s=new Uint16Array(e*i),o=t.getData(),n=0;_>n;++n)s[n]=(o[n]>>0&255)>>4<<12|(o[n]>>8&255)>>4<<8|(o[n]>>16&255)>>4<<4|(o[n]>>24&255)>>4<<0;else if(d===r.PIXEL_FORMAT_RGB5A1)for(s=new Uint16Array(e*i),o=t.getData(),n=0;_>n;++n)s[n]=(o[n]>>0&255)>>3<<11|(o[n]>>8&255)>>3<<6|(o[n]>>16&255)>>3<<1|(o[n]>>24&255)>>7<<0;else if(d===r.PIXEL_FORMAT_A8)for(s=new Uint8Array(e*i),o=t.getData(),n=0;_>n;++n)s[n]=o>>24&255;if(h&&d===r.PIXEL_FORMAT_RGB888)for(o=t.getData(),s=new Uint8Array(e*i*3),n=0;_>n;++n)s[3*n]=o>>0&255,s[3*n+1]=o>>8&255,s[3*n+2]=o>>16&255;return this.initWithData(s,d,e,i,l),s!=t.getData()&&(s=null),this._hasPremultipliedAlpha=t.isPremultipliedAlpha(),!0}})}),cc.Texture2D=e.exports=c},{"../CCGame":19,"../assets/CCRawAsset":27,"../event/event-target":48,"../platform/CCClass":53,"../platform/CCSys":59,"../platform/_CCClass":60,"../platform/js":66}],75:[function(t,e,i){var n=t("../platform/_CCClass"),r=t("../platform/js"),s=t("../CCGame"),o=n.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(t,e){this._buffersVBO=[],cc.js.isString(t)?this.initWithFile(t,e):t instanceof cc.Texture2D&&this.initWithTexture(t,e)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(t){this.texture=t},setDirty:function(t){this.dirty=t},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(t){this._quads=t},_copyQuadsToTextureAtlas:function(t,e){if(t)for(var i=0;i<t.length;i++)this._setQuadToArray(t[i],e+i)},_setQuadToArray:function(t,e){var i=this._quads;return i[e]?(i[e].bl=t.bl,i[e].br=t.br,i[e].tl=t.tl,void(i[e].tr=t.tr)):void(i[e]=new cc.V3F_C4B_T2F_Quad(t.tl,t.bl,t.tr,t.br,this._quadsArrayBuffer,e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT))},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(0!==this._capacity)for(var t=this._indices,e=this._capacity,i=0;e>i;i++)cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(t[6*i+0]=4*i+0,t[6*i+1]=4*i+0,t[6*i+2]=4*i+2,t[6*i+3]=4*i+1,t[6*i+4]=4*i+3,t[6*i+5]=4*i+3):(t[6*i+0]=4*i+0,t[6*i+1]=4*i+1,t[6*i+2]=4*i+2,t[6*i+3]=4*i+3,t[6*i+4]=4*i+2,t[6*i+5]=4*i+1)},initWithFile:function(t,e){var i=cc.textureCache.addImage(t);return i?this.initWithTexture(i,e):(cc.log(cc._LogInfos.TextureAtlas.initWithFile,t),!1)},initWithTexture:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas.initWithTexture),e=0|e,this._capacity=e,this._totalQuads=0,this.texture=t,this._quads=[],this._indices=new Uint16Array(6*e);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._quadsArrayBuffer=new ArrayBuffer(i*e),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),(!this._quads||!this._indices)&&e>0)return!1;for(var n=this._quads,r=0;e>r;r++)n[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,r*i);return this._setupIndices(),this._setupVBO(),this.dirty=!0,!0},updateQuad:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas.updateQuad),cc.assert(e>=0&&e<this._capacity,cc._LogInfos.TextureAtlas.updateQuad_2),this._totalQuads=Math.max(e+1,this._totalQuads),this._setQuadToArray(t,e),this.dirty=!0},insertQuad:function(t,e){if(cc.assert(e<this._capacity,cc._LogInfos.TextureAtlas.insertQuad_2),this._totalQuads++,this._totalQuads>this._capacity)return void cc.log(cc._LogInfos.TextureAtlas.insertQuad);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=this._totalQuads-1-e,r=e*i,s=n*i;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*i),this._quadsReader.set(this._quadsReader.subarray(r,r+s),r+i),this._setQuadToArray(t,e),this.dirty=!0},insertQuads:function(t,e,i){i=i||t.length,cc.assert(e+i<=this._capacity,cc._LogInfos.TextureAtlas.insertQuads);var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads+=i,this._totalQuads>this._capacity)return void cc.log(cc._LogInfos.TextureAtlas.insertQuad);var r,s=this._totalQuads-1-e-i,o=e*n,a=s*n,c=this._totalQuads-1-i;for(r=0;i>r;r++)this._quads[c+r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*n);for(this._quadsReader.set(this._quadsReader.subarray(o,o+a),o+n*i),r=0;i>r;r++)this._setQuadToArray(t[r],e+r);this.dirty=!0},insertQuadFromIndex:function(t,e){if(t!==e){cc.assert(e>=0||e<this._totalQuads,cc._LogInfos.TextureAtlas.insertQuadFromIndex),cc.assert(t>=0||t<this._totalQuads,cc._LogInfos.TextureAtlas.insertQuadFromIndex_2);var i,n,r=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=this._quadsReader,o=s.subarray(t*r,r);t>e?(i=e*r,n=(t-e)*r,s.set(s.subarray(i,i+n),i+r),s.set(o,i)):(i=(t+1)*r,n=(e-t)*r,s.set(s.subarray(i,i+n),i-r),s.set(o,e*r)),this.dirty=!0}},removeQuadAtIndex:function(t){cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas.removeQuadAtIndex);var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads--,this._quads.length=this._totalQuads,t!==this._totalQuads){var i=(t+1)*e,n=(this._totalQuads-t)*e;

this._quadsReader.set(this._quadsReader.subarray(i,i+n),i-e)}this.dirty=!0},removeQuadsAtIndex:function(t,e){if(cc.assert(t+e<=this._totalQuads,cc._LogInfos.TextureAtlas.removeQuadsAtIndex),this._totalQuads-=e,t!==this._totalQuads){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=(t+e)*i,r=(this._totalQuads-t)*i,s=t*i;this._quadsReader.set(this._quadsReader.subarray(n,n+r),s)}this.dirty=!0},removeAllQuads:function(){this._quads.length=0,this._totalQuads=0},_setDirty:function(t){this.dirty=t},resizeCapacity:function(t){if(t===this._capacity)return!0;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=this._capacity;this._totalQuads=Math.min(this._totalQuads,t),this._capacity=0|t;var n,r=this._capacity,s=this._totalQuads;if(null===this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(e*r),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),n=0;r>n;n++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,n*e);else{var o,a,c=this._quads;if(r>i){for(o=[],a=new ArrayBuffer(e*r),n=0;s>n;n++)o[n]=new cc.V3F_C4B_T2F_Quad(c[n].tl,c[n].bl,c[n].tr,c[n].br,a,n*e);for(;r>n;n++)o[n]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,a,n*e);this._quadsReader=new Uint8Array(a),this._quads=o,this._quadsArrayBuffer=a}else{var h=Math.max(s,r);for(o=[],a=new ArrayBuffer(e*r),n=0;h>n;n++)o[n]=new cc.V3F_C4B_T2F_Quad(c[n].tl,c[n].bl,c[n].tr,c[n].br,a,n*e);this._quadsReader=new Uint8Array(a),this._quads=o,this._quadsArrayBuffer=a}}if(null===this._indices)this._indices=new Uint16Array(6*r);else if(r>i){var l=new Uint16Array(6*r);l.set(this._indices,0),this._indices=l}else this._indices=this._indices.subarray(0,6*r);return this._setupIndices(),this._mapBuffers(),this.dirty=!0,!0},increaseTotalQuadsWith:function(t){this._totalQuads+=t},moveQuadsFromIndex:function(t,e,i){if(void 0===i){if(i=e,e=this._totalQuads-t,cc.assert(i+(this._totalQuads-t)<=this._capacity,cc._LogInfos.TextureAtlas.moveQuadsFromIndex),0===e)return}else if(cc.assert(i+e<=this._totalQuads,cc._LogInfos.TextureAtlas.moveQuadsFromIndex_2),cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas.moveQuadsFromIndex_3),t===i)return;var n,r,s=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,o=t*s,a=e*s,c=this._quadsReader,h=c.subarray(o,o+a),l=i*s;t>i?(n=(t-i)*s,r=i*s,c.set(c.subarray(r,r+n),r+a)):(n=(i-t)*s,r=(t+e)*s,c.set(c.subarray(r,r+n),o)),c.set(h,l),this.dirty=!0},fillWithEmptyQuadsFromIndex:function(t,e){for(var i=e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=new Uint8Array(this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i),r=0;i>r;r++)n[r]=0},_setupVBO:function(){},_mapBuffers:function(){},drawQuads:function(){},drawNumberOfQuads:null,_releaseBuffer:function(){var t=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&t.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&t.deleteBuffer(this._buffersVBO[1])),this._quadsWebBuffer&&t.deleteBuffer(this._quadsWebBuffer)}}),a=o.prototype;a.totalQuads,cc.defineGetterSetter(a,"totalQuads",a.getTotalQuads),a.capacity,cc.defineGetterSetter(a,"capacity",a.getCapacity),a.quads,cc.defineGetterSetter(a,"quads",a.getQuads,a.setQuads),s.once(s.EVENT_RENDERER_INITED,function(){cc._renderType===s.RENDER_TYPE_WEBGL&&r.mixin(o.prototype,{_setupVBO:function(){var t=this,e=cc._renderContext;t._buffersVBO[0]=e.createBuffer(),t._buffersVBO[1]=e.createBuffer(),t._quadsWebBuffer=e.createBuffer(),t._mapBuffers()},_mapBuffers:function(){var t=this,e=cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,t._quadsWebBuffer),e.bufferData(e.ARRAY_BUFFER,t._quadsArrayBuffer,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._buffersVBO[1]),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t._indices,e.STATIC_DRAW)},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},drawNumberOfQuads:function(t,e){var i=this;if(e=e||0,0!==t&&i.texture&&i.texture.isLoaded()){var n=cc._renderContext;cc.glBindTexture2D(i.texture),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),n.bindBuffer(n.ARRAY_BUFFER,i._quadsWebBuffer),i.dirty&&(n.bufferData(n.ARRAY_BUFFER,i._quadsArrayBuffer,n.DYNAMIC_DRAW),i.dirty=!1),n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,n.FLOAT,!1,24,0),n.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,!0,24,12),n.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,24,16),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i._buffersVBO[1]),cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?n.drawElements(n.TRIANGLE_STRIP,6*t,n.UNSIGNED_SHORT,6*e*i._indices.BYTES_PER_ELEMENT):n.drawElements(n.TRIANGLES,6*t,n.UNSIGNED_SHORT,6*e*i._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++}}})}),cc.TextureAtlas=e.exports=o},{"../CCGame":19,"../platform/_CCClass":60,"../platform/js":66}],76:[function(t,e,i){var n=(t("../platform/js"),t("../CCGame")),r=t("./CCTexture2D"),s={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),_loadedTexturesBefore:{},handleLoadedTexture:null,_initializingRenderer:function(){var t,e=this._loadedTexturesBefore,i=this._textures;for(t in e){var n=e[t];n.handleLoadedTexture(),i[t]=n}this._loadedTexturesBefore={}},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.log(cc._LogInfos.textureCache.textureForKey),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]||this._textures[cc.loader.getAliase(t)]},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._htmlElementObj,i=this.getKeyByTexture(e);return i||(i=e instanceof HTMLImageElement?e.src:this._generalTextureKey(t.__instanceId)),this._textureColorsCache[i]||(this._textureColorsCache[i]=t._generateTextureCacheForColor()),this._textureColorsCache[i]},removeAllTextures:function(){var t=this._textures;for(var e in t)t[e]&&t[e].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e=this._textures;for(var i in e)e[i]===t&&(e[i].releaseTexture(),delete e[i])}},removeTextureForKey:function(t){null!=t&&this._textures[t]&&delete this._textures[t]},addImage:null,addImageAsync:null,cacheImage:function(t,e){if(e instanceof r)return void(this._textures[t]=e);var i=new r;i.initWithElement(e),i.handleLoadedTexture(),this._textures[t]=i},addUIImage:function(t,e){if(cc.assert(t,cc._LogInfos.textureCache.addUIImage_2),e&&this._textures[e])return this._textures[e];var i=new r;return i.initWithImage(t),null!=e?this._textures[e]=i:cc.log(cc._LogInfos.textureCache.addUIImage),i},dumpCachedTextureInfo:function(){var t=0,e=0,i=this._textures;for(var n in i){var r=i[n];t++,r.getHtmlElementObj()instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo,n,r.getHtmlElementObj().src,r.getPixelWidth(),r.getPixelHeight()):cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_2,n,r.getPixelWidth(),r.getPixelHeight()),e+=r.getPixelWidth()*r.getPixelHeight()*4}var s=this._textureColorsCache;for(n in s){var o=s[n];for(var a in o){var c=o[a];t++,cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_2,n,c.width,c.height),e+=c.width*c.height*4}}cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_3,t,e/1024,(e/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random(),this._loadedTexturesBefore={}}};n.once(n.EVENT_RENDERER_INITED,function(){var t=s;cc._renderType===n.RENDER_TYPE_CANVAS?(t.handleLoadedTexture=function(t){var e=this._textures,i=e[t];i||(i=e[t]=new r,i.url=t),i.handleLoadedTexture()},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D.addImage);var n=this._textures,o=n[t]||n[cc.loader.getAliase(t)];if(o)return o.isLoaded()?(e&&e.call(i,o),o):(o.once("load",function(){e&&e.call(i,o)},i),o);o=n[t]=new r,o.url=t;var a=cc.loader._checkIsImageURL(t)?cc.loader.load:cc.loader.loadImg;return a.call(cc.loader,t,function(r,o){if(r)return e&&e.call(i,r);s.handleLoadedTexture(t);var a=n[t];e&&e.call(i,a)}),o},t.addImageAsync=t.addImage):cc._renderType===n.RENDER_TYPE_WEBGL&&(t.handleLoadedTexture=function(t){var e,i,n=this._textures;cc.game._rendererInitialized||(n=this._loadedTexturesBefore),e=n[t],e||(e=n[t]=new r,e.url=t),i=cc.AUTO_PREMULTIPLIED_ALPHA_FOR_PNG&&".png"===cc.path.extname(t),e.handleLoadedTexture(i)},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D.addImage_2);var n=this._textures;cc.game._rendererInitialized||(n=this._loadedTexturesBefore);var o=n[t]||n[cc.loader.getAliase(t)];if(o)return o.isLoaded()?(e&&e.call(i,o),o):(o.once("load",function(){e&&e.call(i,o)},i),o);o=n[t]=new r,o.url=t;var a=cc.loader._checkIsImageURL(t)?cc.loader.load:cc.loader.loadImg;return a.call(cc.loader,t,function(r,o){if(r)return e&&e.call(i,r);s.handleLoadedTexture(t);var a=n[t];e&&e.call(i,a)}),o},t.addImageAsync=t.addImage)}),cc.textureCache=e.exports=s},{"../CCGame":19,"../platform/js":66,"./CCTexture2D":74}],77:[function(t,e,i){t("./CCTexture2D"),t("./CCTextureAtlas"),t("./CCTextureCache")},{"./CCTexture2D":74,"./CCTextureAtlas":75,"./CCTextureCache":76}],78:[function(t,e,i){cc.AsyncPool=function(t,e,i,n,r){var s=this;s._srcObj=t,s._limit=e,s._pool=[],s._iterator=i,s._iteratorTarget=r,s._onEnd=n,s._onEndTarget=r,s._errors=[],s._results=t instanceof Array?[]:{},cc.each(t,function(t,e){s._pool.push({index:e,value:t})}),s.size=s._pool.length,s.finishedSize=0,s._workingSize=0,s._limit=s._limit||s.size,s.onIterator=function(t,e){s._iterator=t,s._iteratorTarget=e},s.onEnd=function(t,e){s._onEnd=t,s._onEndTarget=e},s._handleItem=function(){var t=this;if(!(0===t._pool.length||t._workingSize>=t._limit)){var e=t._pool.shift(),i=e.value,n=e.index;t._workingSize++,t._iterator.call(t._iteratorTarget,i,n,function(e,i){return t.finishedSize++,t._workingSize--,e&&t._errors.push(e),t._results[this.index]=i,t.finishedSize===t.size?void(t._onEnd&&t._onEnd.call(t._onEndTarget,t._errors.length>0?t._errors:null,t._results)):void t._handleItem()}.bind(e),t)}},s.flow=function(){var t=this;if(0===t._pool.length)return void(t._onEnd&&t._onEnd.call(t._onEndTarget,null,[]));for(var e=0;e<t._limit;e++)t._handleItem()}},cc.async={series:function(t,e,i){var n=new cc.AsyncPool(t,1,function(t,e,n){t.call(i,n)},e,i);return n.flow(),n},parallel:function(t,e,i){var n=new cc.AsyncPool(t,0,function(t,e,n){t.call(i,n)},e,i);return n.flow(),n},waterfall:function(t,e,i){var n=[],r=[null],s=new cc.AsyncPool(t,1,function(e,s,o){n.push(function(e){n=Array.prototype.slice.call(arguments,1),t.length-1===s&&(r=r.concat(n)),o.apply(null,arguments)}),e.apply(i,n)},function(t){return e?t?e.call(i,t):void e.apply(i,r):void 0});return s.flow(),s},map:function(t,e,i,n){var r=e;"object"==typeof e&&(i=e.cb,n=e.iteratorTarget,r=e.iterator);var s=new cc.AsyncPool(t,0,r,i,n);return s.flow(),s},mapLimit:function(t,e,i,n,r){var s=new cc.AsyncPool(t,e,i,n,r);return s.flow(),s}}},{}],79:[function(t,e,i){t("../platform/CCSys"),cc.path={normalizeRE:/[^\.\/]+\/\.\.\//,join:function(){for(var t=arguments.length,e="",i=0;t>i;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(t);return e?e[1]:null},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");i>0&&(t=t.substring(0,i));var n=/(\/|\\\\)([^(\/|\\\\)]+)$/g,r=n.exec(t.replace(/(\/|\\\\)$/,""));if(!r)return null;var s=r[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?s.substring(0,s.length-e.length):s},dirname:function(t){return t.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";return i>0&&(n=t.substring(i),t=t.substring(0,i)),i=t.lastIndexOf("."),0>i?t+e+n:t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var n=t.indexOf("?"),r="",s=i?this.extname(t):"";return n>0&&(r=t.substring(n),t=t.substring(0,n)),n=t.lastIndexOf("/"),n=0>=n?0:n+1,t.substring(0,n)+e+s+r},_normalize:function(t){var e=t=String(t);do e=t,t=t.replace(this.normalizeRE,"");while(e.length!==t.length);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",_setEndWithSep:function(t,e){var i=cc.path.sep;"undefined"==typeof e?e=!0:"string"==typeof e&&(i=e,e=!!e);var n=t[t.length-1],r="\\"===n||"/"===n;return!r&&e?t+=i:r&&!e&&(t=t.slice(0,-1)),t}}},{"../platform/CCSys":59}],80:[function(t,e,n){cc.profiler=function(){var t=_showFPS=!1,e=_frameRate=_lastSPF=_accumDt=0,n=(_afterVisitListener=_FPSLabel=_SPFLabel=_drawsLabel=null,.6),r=10,s=[0,10,20,30],o=[0,0,0,0],a=3,c=0,h=0,l=function(){var t=0,e=cc.winSize.width,i=cc.winSize.height,n=cc.DIRECTOR_STATS_POSITION;t=e>i?0|i/320*24:0|e/320*24,_FPSLabel=new cc.LabelTTF("000.0","Arial",t),_SPFLabel=new cc.LabelTTF("0.000","Arial",t),_drawsLabel=new cc.LabelTTF("0000","Arial",t),_drawsLabel.setPosition(_drawsLabel.width/2+n.x,5*_drawsLabel.height/2+n.y),_SPFLabel.setPosition(_SPFLabel.width/2+n.x,3*_SPFLabel.height/2+n.y),_FPSLabel.setPosition(_FPSLabel.width/2+n.x,_FPSLabel.height/2+n.y)},d=function(t){var e,l=i=s.length-1,d=0;for(c++,h+=t;i>=0;i--)if(t>=s[i]){o[i]++;break}if(c>=r){for(d=h/r,i=l;i>0;i--)if(e=o[i]/r,e>=n&&d>=s[i]){i!=a&&(a=i,f.onFrameRateChange&&f.onFrameRateChange(d.toFixed(2)));break}for(_changeCount=0,c=0,h=0,i=l;i>0;i--)o[i]=0}},u=function(){_lastSPF=cc.director.getSecondsPerFrame(),e++,_accumDt+=cc.director.getDeltaTime(),_accumDt>cc.DIRECTOR_FPS_INTERVAL&&(_frameRate=e/_accumDt,e=0,_accumDt=0,f.onFrameRateChange&&d(_frameRate),_showFPS&&(_SPFLabel.string=_lastSPF.toFixed(3),_FPSLabel.string=_frameRate.toFixed(1),_drawsLabel.string=(0|cc.g_NumberOfDraws).toString())),_showFPS&&(_FPSLabel.visit(),_SPFLabel.visit(),_drawsLabel.visit())},_=function(){_FPSLabel._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),_SPFLabel._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),_drawsLabel._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},f={onFrameRateChange:null,getSecondsPerFrame:function(){return _lastSPF},getFrameRate:function(){return _frameRate},setProfileDuration:function(t){!isNaN(t)&&t>0&&(r=t/cc.DIRECTOR_FPS_INTERVAL)},resumeProfiling:function(){cc.director.on(cc.Director.EVENT_AFTER_VISIT,u),cc.director.on(cc.Director.EVENT_PROJECTION_CHANGED,_)},stopProfiling:function(){cc.director.off(cc.Director.EVENT_AFTER_VISIT,u),cc.director.off(cc.Director.EVENT_PROJECTION_CHANGED,_)},isShowingStats:function(){return _showFPS},showStats:function(){t||this.init(),cc.LabelTTF&&!_FPSLabel&&l(),_FPSLabel&&(_showFPS=!0)},hideStats:function(){_showFPS=!1},init:function(){t||(this.resumeProfiling(),t=!0)}};return f}(),e.exports=cc.profiler},{}],81:[function(t,e,i){function n(t){var e=t._parent.getChildren(),i=0;if(e.length>=2){var n=e[e.length-2];i=n.getOrderOfArrival()+1}return t.setOrderOfArrival(i),i}var r=cc.js,s=t("./scene-graph-helper"),o=t("../platform/CCObject").Flags.Destroying,a=t("./misc").DirtyFlags,c="size-changed",h="position-changed",l=cc.Class({"extends":cc.Object,properties:{_name:"",_opacity:255,_color:cc.Color.WHITE,_cascadeOpacityEnabled:!0,_parent:null,_anchorPoint:cc.p(.5,.5),_contentSize:cc.size(0,0),_children:[],_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_localZOrder:0,_globalZOrder:0,_ignoreAnchorPointForPosition:!1,_tag:cc.NODE_TAG_INVALID,_opacityModifyRGB:!1,name:{get:function(){return this._name},set:function(t){this._name=t}},parent:{get:function(){return this._parent},set:function(t){if(this._parent!==t){var e=this._sgNode;if(e._parent&&e._parent.removeChild(e,!1),t){var i=t._sgNode;i.addChild(e),n(e),t._children.push(this)}var r=this._parent;if(this._parent=t||null,r){if(!(r._objFlags&o)){var s=r._children.indexOf(this);r._children.splice(s,1),this._onHierarchyChanged(r)}}else t&&this._onHierarchyChanged(null)}}},_id:{"default":"",editorOnly:!0},uuid:{get:function(){return this._id||(this._id=Editor.uuid())}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX=t,this._sgNode.skewX=t}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY=t,this._sgNode.skewY=t}},zIndex:{get:function(){return this._localZOrder},set:function(t){this._localZOrder=t,this._sgNode.zIndex=t}},rotation:{get:function(){return this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node.getRotation),this._rotationX},set:function(t){this._rotationX=this._rotationY=t,this._sgNode.rotation=t},tooltip:"The clockwise degrees of rotation relative to the parent"},rotationX:{get:function(){return this._rotationX},set:function(t){this._rotationX=t,this._sgNode.rotationX=t}},rotationY:{get:function(){return this._rotationY},set:function(t){this._rotationY=t,this._sgNode.rotationY=t}},scaleX:{get:function(){return this._scaleX},set:function(t){this._scaleX=t,this._sgNode.scaleX=t}},scaleY:{get:function(){return this._scaleY},set:function(t){this._scaleY=t,this._sgNode.scaleY=t}},x:{get:function(){return this._position.x},set:function(t){var e=this._position;if(t!==e.x){var i=e.x;e.x=t,this._sgNode.x=t,this.emit&&this.emit(h,cc.v2(i,e.y))}}},y:{get:function(){return this._position.y},set:function(t){var e=this._position;if(t!==e.y){var i=e.y;e.y=t,this._sgNode.y=t,this.emit&&this.emit(h,cc.v2(e.x,i))}}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x=t,this._onAnchorChanged()}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y=t,this._onAnchorChanged()}},width:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getWidth();return this._contentSize.width=t,t}return this._contentSize.width},set:function(t){t!==this._contentSize.width&&(this._sizeProvider&&this._sizeProvider.setContentSize(t,this._sizeProvider._getHeight()),this._contentSize.width=t,this.emit(c))}},height:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getHeight();return this._contentSize.height=t,t}return this._contentSize.height},set:function(t){t!==this._contentSize.height&&(this._sizeProvider&&this._sizeProvider.setContentSize(this._sizeProvider._getWidth(),t),this._contentSize.height=t,this.emit(c))}},ignoreAnchor:{get:function(){return this._ignoreAnchorPointForPosition},set:function(t){this._ignoreAnchorPointForPosition=t,this._sgNode.ignoreAnchor=t,this._onAnchorChanged()}},tag:{get:function(){return this._tag},set:function(t){this._tag=t,this._sgNode.tag=t}},opacity:{get:function(){return this._opacity},set:function(t){this._opacity=t,this._sgNode.opacity=t,this._onColorChanged()},range:[0,255]},cascadeOpacity:{get:function(){return this._cascadeOpacityEnabled},set:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._sgNode.cascadeOpacity=t,this._onCascadeChanged())}},color:{get:function(){var t=this._color;return new cc.Color(t.r,t.g,t.b,t.a)},set:function(t){var e=this._color;e.r=t.r,e.g=t.g,e.b=t.b,this._onColorChanged()}}},ctor:function(){Object.defineProperty(this,"_id",{value:"",enumerable:!1});var t=this._sgNode=new _ccsg.Node;t.retain(),cc.game._isCloning||(t.cascadeOpacity=!0),this._dirtyFlags=a.ALL,this._sizeProvider=null},destroy:function(){this._sgNode.release(),this._super()},_onHierarchyChanged:null,_onColorChanged:null,_onAnchorChanged:null,_onCascadeChanged:null,_onOpacityModifyRGBChanged:null,init:function(){return!0},attr:function(t){for(var e in t)this[e]=t[e]},setGlobalZOrder:function(t){this._globalZOrder=t,this._sgNode.setGlobalZOrder(t)},getGlobalZOrder:function(){return this._globalZOrder},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node.getScale),this._scaleX},setScale:function(t,e){t instanceof cc.Vec2&&(e=t.y,t=t.x),this._scaleX=t,this._scaleY=e||0===e?e:t,this._sgNode.setScale(t,e)},getPosition:function(){return cc.p(this._position)},setPosition:function(t,e){var i=this._position,n=i.clone();if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._sgNode.setPosition(t,e),this.emit&&this.emit(h,n)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._onAnchorChanged()},getAnchorPointInPoints:function(){return this._sgNode.getAnchorPointInPoints()},getContentSize:function(t){if(this._sizeProvider&&!t){var e=this._sizeProvider.getContentSize();return this._contentSize=e,e}return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._sizeProvider&&this._sizeProvider.setContentSize(i),this.emit(c)},getBoundingBox:function(){return this._sgNode.getBoundingBox()},cleanup:function(){var t,e,i=this._children.length;for(t=0;i>t;++t)e=this._children[t],e&&e.cleanup()},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;n>i;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;cc.js.isUndefined(i)?(i=void 0,n=t._name):cc.js.isString(i)?(n=i,i=void 0):cc.js.isNumber(i)&&(r=!0,n=""),cc.assert(t,cc._LogInfos.Node.addChild_3),cc.assert(null===t._parent,"child already added. It can't be added again"),this._addChildHelper(t,e,i,n,r)},_addChildHelper:function(t,e,i,n,r){this._insertChild(t,e),r?t.setTag(i):t.setName(n)},_insertChild:function(t,e){t.parent=this,t.zIndex=e},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeChild:function(t,e){0!==this._children.length&&(void 0===e&&(e=!0),this._children.indexOf(t)>-1&&this._detachChild(t,e))},removeChildByTag:function(t,e){t===cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node.removeChildByTag);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.log(cc._LogInfos.Node.removeChildByTag_2,t)},removeAllChildren:function(t){var e=this._children;void 0===t&&(t=!0);for(var i=0;i<e.length;i++){var n=e[i];n&&(t&&n.cleanup(),n.parent=null)}this._children.length=0},_detachChild:function(t,e){e&&t.cleanup(),t.parent=null,cc.js.array.remove(this._children,t)},setNodeDirty:function(){this._sgNode.setNodeDirty()},getParentToNodeTransform:function(){return this._sgNode.getParentToNodeTransform()},getNodeToWorldTransform:function(){return this._sgNode.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return this._sgNode.getWorldToNodeTransform()},convertToNodeSpace:function(t){return this._sgNode.convertToNodeSpace(t)},convertToWorldSpace:function(t){return this._sgNode.convertToWorldSpace(t)},convertToNodeSpaceAR:function(t){return this._sgNode.convertToNodeSpaceAR(t)},convertToWorldSpaceAR:function(t){return this._sgNode.convertToWorldSpaceAR(t)},convertTouchToNodeSpace:function(t){return this._sgNode.convertTouchToNodeSpace(t)},convertTouchToNodeSpaceAR:function(t){return this._sgNode.convertTouchToNodeSpaceAR(t)},getNodeToParentTransform:function(t){return this._sgNode.getNodeToParentTransform()},getBoundingBoxToWorld:function(){return this._sgNode.getBoundingBoxToWorld()},getDisplayedOpacity:function(){return this._sgNode.getDisplayedOpacity()},_updateDisplayedOpacity:function(t){this._sgNode.updateDisplayedOpacity(t)},getDisplayedColor:function(){return this._sgNode.getDisplayedColor()},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._sgNode.setOpacityModifyRGB(t),this._onOpacityModifyRGBChanged())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(t){if(this._parent){var e=this._parent._children;t=-1!==t?t:e.length-1;var i=e.indexOf(this);if(t!==i){e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this);for(var n=this._parent._children,r=0,s=n.length;s>r;r++){var o=n[r];o._sgNode.arrivalOrder=r}cc.renderer.childrenOrderDirty=this._parent._sgNode._reorderChildDirty=!0}}},isChildOf:function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},_onBatchCreated:function(){var t=this._sgNode;t.setOpacity(this._opacity),t.setCascadeOpacityEnabled(this._cascadeOpacityEnabled),t.setRotationX(this._rotationX),t.setRotationY(this._rotationY),t.setScale(this._scaleX,this._scaleY),t.setPosition(this._position),t.setSkewX(this._skewX),t.setSkewY(this._skewY),t.setLocalZOrder(this._localZOrder),t.setGlobalZOrder(this._globalZOrder),t.ignoreAnchorPointForPosition(this._ignoreAnchorPointForPosition),t.setTag(this._tag),t.setOpacityModifyRGB(this._opacityModifyRGB),this._parent&&this._parent._sgNode.addChild(t);for(var e=this._children,i=0,n=e.length;n>i;i++)e[i]._onBatchCreated()},_removeSgNode:s.removeSgNode});!function(){for(var t,e=["name","skewX","skewY","position","rotation","rotationX","rotationY","scale","scaleX","scaleY","children","childrenCount","parent","running","scheduler","opacity","color","tag"],i={x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],zIndex:["getLocalZOrder","setLocalZOrder"],ignoreAnchor:["isIgnoreAnchorPointForPosition","ignoreAnchorPointForPosition"],opacityModifyRGB:["isOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"],cascadeColor:["isCascadeColorEnabled","setCascadeColorEnabled"]},n=l.prototype,s=0;s<e.length;s++){t=e[s];var o=t[0].toUpperCase()+t.slice(1),a=Object.getOwnPropertyDescriptor(n,t);a?(a.get&&(n["get"+o]=a.get),a.set&&(n["set"+o]=a.set)):r.getset(n,t,n["get"+o],n["set"+o])}for(t in i){var c=i[t],a=Object.getOwnPropertyDescriptor(n,t);a?(n[c[0]]=a.get,c[1]&&(n[c[1]]=a.set)):r.getset(n,t,n[c[0]],n[c[1]])}}(),cc._BaseNode=e.exports=l},{"../platform/CCObject":58,"./misc":84,"./scene-graph-helper":85}],82:[function(t,e,i){cc.find=e.exports=function(t,e){if(null==t)return cc.error("Argument must be non-nil"),null;if(!e){var i=cc.director.getScene();if(!i)return cc.warn("Can not get current scene."),null;e=i}for(var n=e,r="/"!==t[0]?0:1,s=t.split("/"),o=r;o<s.length;o++){var a,c=s[o],h="<"===c[0]&&">"===c[c.length-1];if(h){var l=c.slice(1,-1);if(a=cc.js.getClassByName(l),!a)return cc.warn("Failed to find component "+l),null}var d=n._children;n=null;for(var u=0,_=d.length;_>u;++u){var f=d[u];if(h){if(f.getComponent(a)){n=f;break}}else if(f.name===c){n=f;break}}if(!n)return null}return n}},{}],83:[function(t,e,i){t("./Async"),t("./CCPath"),t("./CCProfiler"),t("./find")},{"./Async":78,"./CCPath":79,"./CCProfiler":80,"./find":82}],84:[function(t,e,i){var n=cc.js,r={};r.propertyDefine=function(t,e,i){for(var r,s=t.prototype,o=0;o<e.length;o++){r=e[o];var a=r[0].toUpperCase()+r.slice(1),c=Object.getOwnPropertyDescriptor(s,r);c?(c.get&&(s["get"+a]=c.get),c.set&&(s["set"+a]=c.set)):n.getset(s,r,s["get"+a],s["set"+a])}for(r in i){var h=i[r],c=Object.getOwnPropertyDescriptor(s,r);c?(s[h[0]]=c.get,h[1]&&(s[h[1]]=c.set)):n.getset(s,r,s[h[0]],s[h[1]])}};var s=r.DirtyFlags={TRANSFORM:1,SIZE:2,ALL:3};s.WIDGET=s.TRANSFORM|s.SIZE,e.exports=r},{}],85:[function(t,e,i){var n={removeSgNode:function(){var t=this._sgNode;t&&(t.release(),t._parent&&t._parent.removeChild(t),this._sgNode=null)}};e.exports=n},{}],86:[function(t,e,i){cc.AffineTransform=function(t,e,i,n,r,s){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s},cc.affineTransformMake=function(t,e,i,n,r,s){return{a:t,b:e,c:i,d:n,tx:r,ty:s}},cc.affineTransformClone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},cc.pointApplyAffineTransform=function(t,e,i){var n,r;return void 0===i?(i=e,n=t.x,r=t.y):(n=t,r=e),{x:i.a*n+i.c*r+i.tx,y:i.b*n+i.d*r+i.ty}},cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)},cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),s=cc.rectGetMaxY(t),o=cc.pointApplyAffineTransform(n,i,e),a=cc.pointApplyAffineTransform(r,i,e),c=cc.pointApplyAffineTransform(n,s,e),h=cc.pointApplyAffineTransform(r,s,e),l=Math.min(o.x,a.x,c.x,h.x),d=Math.max(o.x,a.x,c.x,h.x),u=Math.min(o.y,a.y,c.y,h.y),_=Math.max(o.y,a.y,c.y,h.y);return cc.rect(l,u,d-l,_-u)},cc._rectApplyAffineTransformIn=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),s=cc.rectGetMaxY(t),o=cc.pointApplyAffineTransform(n,i,e),a=cc.pointApplyAffineTransform(r,i,e),c=cc.pointApplyAffineTransform(n,s,e),h=cc.pointApplyAffineTransform(r,s,e),l=Math.min(o.x,a.x,c.x,h.x),d=Math.max(o.x,a.x,c.x,h.x),u=Math.min(o.y,a.y,c.y,h.y),_=Math.max(o.y,a.y,c.y,h.y);return t.x=l,t.y=u,t.width=d-l,t.height=_-u,t},cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}},cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,e){var i=Math.sin(e),n=Math.cos(e);return{a:t.a*n+t.c*i,b:t.b*n+t.d*i,c:t.c*n-t.a*i,d:t.d*n-t.b*i,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}},cc.affineTransformConcatIn=function(t,e){var i=t.a,n=t.b,r=t.c,s=t.d,o=t.tx,a=t.ty;return t.a=i*e.a+n*e.c,t.b=i*e.b+n*e.d,t.c=r*e.a+s*e.c,t.d=r*e.b+s*e.d,t.tx=o*e.a+a*e.c+e.tx,t.ty=o*e.b+a*e.d+e.ty,t},cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty},cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}}},{}],87:[function(t,e,i){var n=t("./CCValueType"),r=t("../platform/js"),s=function(){function e(t,e,i,n){"object"==typeof t&&(e=t.g,i=t.b,n=t.a,t=t.r),this.r="number"==typeof t?t:0,this.g="number"==typeof e?e:0,this.b="number"==typeof i?i:0,this.a="number"==typeof n?n:255}r.extend(e,n),t("../platform/CCClass").fastDefine("cc.Color",e,["r","g","b","a"]);var i={WHITE:[255,255,255,255],BLACK:[0,0,0,255],TRANSPARENT:[0,0,0,0],GRAY:[127.5,127.5,127.5],RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,235,4],ORANGE:[255,127,0],CYAN:[0,255,255],MAGENTA:[255,0,255]};for(var s in i){var o=function(t,i,n,r){return function(){return new e(t,i,n,r)}}.apply(null,i[s]);Object.defineProperty(e,s,{get:o})}return e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},e.prototype.lerp=function(t,i,n){n=n||new e;var r=this.r,s=this.g,o=this.b,a=this.a;return n.r=r+(t.r-r)*i,n.g=s+(t.g-s)*i,n.b=o+(t.b-o)*i,n.a=a+(t.a-a)*i,n},e.prototype.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},e.prototype.setR=function(t){return this.r=t,this},e.prototype.setG=function(t){return this.g=t,this},e.prototype.setB=function(t){return this.b=t,this},e.prototype.setA=function(t){return this.a=t,this},e.prototype.toCSS=function(t){return"rgba"===t?"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")":"rgb"===t?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(t)},e.prototype.clamp=function(){this.r=cc.clampf(this.r,0,255),this.g=cc.clampf(this.g,0,255),this.b=cc.clampf(this.b,0,255),this.a=cc.clampf(this.a,0,255)},e.prototype.fromHEX=function(t){var e=parseInt(t.indexOf("#")>-1?t.substring(1):t,16);return this.r=e>>16,
this.g=(65280&e)>>8,this.b=255&e,this},e.prototype.toHEX=function(t){var e=[(0|this.r).toString(16),(0|this.g).toString(16),(0|this.b).toString(16)],i=-1;if("#rgb"===t)for(i=0;i<e.length;++i)e[i].length>1&&(e[i]=e[i][0]);else if("#rrggbb"===t)for(i=0;i<e.length;++i)1===e[i].length&&(e[i]="0"+e[i]);return e.join("")},e.prototype.toRGBValue=function(){return(cc.clampf(this.r,0,255)<<16)+(cc.clampf(this.g,0,255)<<8)+cc.clampf(this.b,0,255)},e.prototype.fromHSV=function(t,i,n){var r=e.hsv2rgb(t,i,n);return this.r=r.r,this.g=r.g,this.b=r.b,this},e.prototype.toHSV=function(){return e.rgb2hsv(this.r,this.g,this.b)},e}();s.rgb2hsv=function(t,e,i){t/=255,e/=255,i/=255;var n={h:0,s:0,v:0},r=Math.max(t,e,i),s=Math.min(t,e,i),o=0;return n.v=r,n.s=r?(r-s)/r:0,n.s?(o=r-s,n.h=t===r?(e-i)/o:e===r?2+(i-t)/o:4+(t-e)/o,n.h/=6,n.h<0&&(n.h+=1)):n.h=0,n},s.hsv2rgb=function(t,e,i){var n={r:0,g:0,b:0};if(0===e)n.r=n.g=n.b=i;else if(0===i)n.r=n.g=n.b=0;else{1===t&&(t=0),t*=6,e=e,i=i;var r=Math.floor(t),s=t-r,o=i*(1-e),a=i*(1-e*s),c=i*(1-e*(1-s));switch(r){case 0:n.r=i,n.g=c,n.b=o;break;case 1:n.r=a,n.g=i,n.b=o;break;case 2:n.r=o,n.g=i,n.b=c;break;case 3:n.r=o,n.g=a,n.b=i;break;case 4:n.r=c,n.g=o,n.b=i;break;case 5:n.r=i,n.g=o,n.b=a}}return n.r*=255,n.g*=255,n.b*=255,n},cc.Color=s,cc.color=function(t,e,i,n){if(r.isString(t)){var s=new cc.Color;return s.fromHEX(t)}return cc.js.isObject(t)?new cc.Color(t.r,t.g,t.b,t.a):new cc.Color(t,e,i,n)},cc.colorEqual=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b},cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var e=parseInt(t),i=e>>16,n=(65280&e)>>8,r=255&e;return cc.color(i,n,r)},cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),n=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+i:i)+(t.b<16?"0"+n:n)},e.exports=cc.Color},{"../platform/CCClass":53,"../platform/js":66,"./CCValueType":93}],88:[function(t,e,i){cc.Enum=function(t){var e={};Object.defineProperty(e,"__enums__",{value:void 0,writable:!0});var i=-1;for(var n in t){var r=t[n];-1===r?r=++i:i=r,e[n]=r;var s=""+r;n!==s&&Object.defineProperty(e,s,{value:n,enumerable:!1})}return e},cc.Enum.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},cc.Enum.getList=function(t){if(void 0!==t.__enums__)return t.__enums__;var e=[];for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],r="number"==typeof n&&(0|n)===n;r&&e.push({name:i,value:n})}return e.sort(function(t,e){return t.value-e.value}),t.__enums__=e,e};e.exports=cc.Enum},{}],89:[function(t,e,i){function n(t,e,i,n){"object"==typeof t&&(e=t.y,i=t.width,n=t.height,t=t.x),this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,this.width="number"==typeof i?i:0,this.height="number"==typeof n?n:0}var r=t("./CCValueType"),s=t("../platform/js");s.extend(n,r),t("../platform/CCClass").fastDefine("cc.Rect",n,["x","y","width","height"]),n.fromMinMax=function(t,e){var i=Math.min(t.x,e.x),r=Math.min(t.y,e.y),s=Math.max(t.x,e.x),o=Math.max(t.y,e.y);return new n(i,r,s-i,o-r)},n.contain=function(t,e){return t.x<=e.x&&t.x+t.width>=e.x+e.width&&t.y<=e.y&&t.y+t.height>=e.y+e.height?1:e.x<=t.x&&e.x+e.width>=t.x+t.width&&e.y<=t.y&&e.y+e.height>=t.y+t.height?-1:0};var o=n.prototype;o.clone=function(){return new n(this.x,this.y,this.width,this.height)},o.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new n;var r=this.x,s=this.y,o=this.width,a=this.height;return i.x=r+(t.x-r)*e,i.y=s+(t.y-s)*e,i.width=o+(t.width-o)*e,i.height=a+(t.height-a)*e,i},o.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},Object.defineProperty(o,"xMin",{get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}}),Object.defineProperty(o,"yMin",{get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}}),Object.defineProperty(o,"xMax",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}}),Object.defineProperty(o,"yMax",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}}),Object.defineProperty(o,"center",{get:function(){return new cc.Vec2(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}}),Object.defineProperty(o,"size",{get:function(){return new cc.Size(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}}),o.intersects=function(t){return cc.rectIntersectsRect(this,t)},o.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},o.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},cc.Rect=n,cc.rect=function(t,e,i,r){return new n(t,e,i,r)},cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,e){return t&&e?!(t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height):!1},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,e){var i=t.x+t.width,n=t.y+t.height,r=e.x+e.width,s=e.y+e.height;return!(i<e.x||r<t.x||n<e.y||s<t.y)},cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)},cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i},cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);return i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i),i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i),i},e.exports=cc.Rect},{"../platform/CCClass":53,"../platform/js":66,"./CCValueType":93}],90:[function(t,e,i){function n(t,e){"object"==typeof t&&(e=t.height,t=t.width),this.width="number"==typeof t?t:0,this.height="number"==typeof e?e:0}var r=t("./CCValueType"),s=t("../platform/js");s.extend(n,r),t("../platform/CCClass").fastDefine("cc.Size",n,["width","height"]),s.get(n,"ZERO",function(){return new n(0,0)});var o=n.prototype;o.clone=function(){return new n(this.width,this.height)},o.equals=function(t){return t&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new n;var r=this.width,s=this.height;return i.width=r+(t.width-r)*e,i.height=s+(t.height-s)*e,i},o.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},cc.size=function(t,e){return new n(t,e)},cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height},cc.Size=e.exports=n},{"../platform/CCClass":53,"../platform/js":66,"./CCValueType":93}],91:[function(t,e,i){cc.Acceleration=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=n||0},cc.BlendFunc=function(t,e){this.src=t,this.dst=e},cc.BlendFunc._disable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE)},cc.BlendFunc.DISABLE,cc.js.get(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.js.get(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive),cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.FontDefinition=function(t){var e=this;if(e.fontName="Arial",e.fontSize=12,e.textAlign=cc.TextAlignment.CENTER,e.verticalAlign=cc.VerticalTextAlignment.TOP,e.fillStyle=cc.color(255,255,255,255),e.boundingWidth=0,e.boundingHeight=0,e.strokeEnabled=!1,e.strokeStyle=cc.color(255,255,255,255),e.lineWidth=1,e.lineHeight="normal",e.fontStyle="normal",e.fontWeight="normal",e.shadowEnabled=!1,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowOpacity=1,t&&t instanceof Object)for(var i in t)e[i]=t[i]},cc.FontDefinition.prototype._getCanvasFontStr=function(){var t=this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px";return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+t+" '"+this.fontName+"'"},cc.SpriteType=cc.Enum({SIMPLE:0,SLICED:1}),cc.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),cc._Dictionary=cc.Class({ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|10*Math.random())},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(t,e){if(null!=e){var i=this.__getKey();this._keyMapTb[i]=e,this._valueMapTb[i]=t}},objectForKey:function(t){if(null==t)return null;var e=this._keyMapTb;for(var i in e)if(e[i]===t)return this._valueMapTb[i];return null},valueForKey:function(t){return this.objectForKey(t)},removeObjectForKey:function(t){if(null!=t){var e=this._keyMapTb;for(var i in e)if(e[i]===t)return delete this._valueMapTb[i],void delete e[i]}},removeObjectsForKeys:function(t){if(null!=t)for(var e=0;e<t.length;e++)this.removeObjectForKey(t[e])},allKeys:function(){var t=[],e=this._keyMapTb;for(var i in e)t.push(e[i]);return t},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}})},{}],92:[function(t,e,i){cc.WebGLColor=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.WebGLColor.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=Uint8Array.BYTES_PER_ELEMENT;this._rU8=new Uint8Array(o,a,1),this._gU8=new Uint8Array(o,a+c,1),this._bU8=new Uint8Array(o,a+2*c,1),this._aU8=new Uint8Array(o,a+3*c,1),this._rU8[0]=t||0,this._gU8[0]=e||0,this._bU8[0]=i||0,this._aU8[0]=null==n?255:n,void 0===n&&(this.a_undefined=!0)},cc.WebGLColor.BYTES_PER_ELEMENT=4;var n=cc.WebGLColor.prototype;n._getR=function(){return this._rU8[0]},n._setR=function(t){this._rU8[0]=0>t?0:t},n._getG=function(){return this._gU8[0]},n._setG=function(t){this._gU8[0]=0>t?0:t},n._getB=function(){return this._bU8[0]},n._setB=function(t){this._bU8[0]=0>t?0:t},n._getA=function(){return this._aU8[0]},n._setA=function(t){this._aU8[0]=0>t?0:t},n.r,cc.js.getset(n,"r",n._getR,n._setR),n.g,cc.js.getset(n,"g",n._getG,n._setG),n.b,cc.js.getset(n,"b",n._getB,n._setB),n.a,cc.js.getset(n,"a",n._getA,n._setA),cc.Vertex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._xF32=new Float32Array(this._arrayBuffer,this._offset,1),this._yF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._xF32[0]=t||0,this._yF32[0]=e||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,n=cc.Vertex2F.prototype,n._getX=function(){return this._xF32[0]},n._setX=function(t){this._xF32[0]=t},n._getY=function(){return this._yF32[0]},n._setY=function(t){this._yF32[0]=t},n.x,cc.js.getset(n,"x",n._getX,n._setX),n.y,cc.js.getset(n,"y",n._getY,n._setY),cc.Vertex3F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset;this._xF32=new Float32Array(s,o,1),this._xF32[0]=t||0,this._yF32=new Float32Array(s,o+Float32Array.BYTES_PER_ELEMENT,1),this._yF32[0]=e||0,this._zF32=new Float32Array(s,o+2*Float32Array.BYTES_PER_ELEMENT,1),this._zF32[0]=i||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,n=cc.Vertex3F.prototype,n._getX=function(){return this._xF32[0]},n._setX=function(t){this._xF32[0]=t},n._getY=function(){return this._yF32[0]},n._setY=function(t){this._yF32[0]=t},n._getZ=function(){return this._zF32[0]},n._setZ=function(t){this._zF32[0]=t},n.x,cc.js.getset(n,"x",n._getX,n._setX),n.y,cc.js.getset(n,"y",n._getY,n._setY),n.z,cc.js.getset(n,"z",n._getZ,n._setZ),cc.Tex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._uF32=new Float32Array(this._arrayBuffer,this._offset,1),this._vF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._uF32[0]=t||0,this._vF32[0]=e||0},cc.Tex2F.BYTES_PER_ELEMENT=8,n=cc.Tex2F.prototype,n._getU=function(){return this._uF32[0]},n._setU=function(t){this._uF32[0]=t},n._getV=function(){return this._vF32[0]},n._setV=function(t){this._vF32[0]=t},n.u,cc.js.getset(n,"u",n._getU,n._setU),n.v,cc.js.getset(n,"v",n._getV,n._setV),cc.Quad2=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,o,0):new cc.Vertex2F(0,0,o,0),this._tr=e?new cc.Vertex2F(e.x,e.y,o,a):new cc.Vertex2F(0,0,o,a),this._bl=i?new cc.Vertex2F(i.x,i.y,o,2*a):new cc.Vertex2F(0,0,o,2*a),this._br=n?new cc.Vertex2F(n.x,n.y,o,3*a):new cc.Vertex2F(0,0,o,3*a)},cc.Quad2.BYTES_PER_ELEMENT=32,n=cc.Quad2.prototype,n._getTL=function(){return this._tl},n._setTL=function(t){this._tl.x=t.x,this._tl.y=t.y},n._getTR=function(){return this._tr},n._setTR=function(t){this._tr.x=t.x,this._tr.y=t.y},n._getBL=function(){return this._bl},n._setBL=function(t){this._bl.x=t.x,this._bl.y=t.y},n._getBR=function(){return this._br},n._setBR=function(t){this._br.x=t.x,this._br.y=t.y},n.tl,cc.js.getset(n,"tl",n._getTL,n._setTL),n.tr,cc.js.getset(n,"tr",n._getTR,n._setTR),n.bl,cc.js.getset(n,"bl",n._getBL,n._setBL),n.br,cc.js.getset(n,"br",n._getBR,n._setBR),cc.Quad3=function(t,e,i,n){this.bl=t||new cc.Vertex3F(0,0,0),this.br=e||new cc.Vertex3F(0,0,0),this.tl=i||new cc.Vertex3F(0,0,0),this.tr=n||new cc.Vertex3F(0,0,0)},cc.V3F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset,a=cc.Vertex3F.BYTES_PER_ELEMENT;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,s,o):new cc.Vertex3F(0,0,0,s,o),this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,s,o+a):new cc.WebGLColor(0,0,0,0,s,o+a),this._texCoords=i?new cc.Tex2F(i.u,i.v,s,o+a+cc.WebGLColor.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,s,o+a+cc.WebGLColor.BYTES_PER_ELEMENT)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,n=cc.V3F_C4B_T2F.prototype,n._getVertices=function(){return this._vertices},n._setVertices=function(t){var e=this._vertices;e.x=t.x,e.y=t.y,e.z=t.z},n._getColor=function(){return this._colors},n._setColor=function(t){var e=this._colors;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords.u=t.u,this._texCoords.v=t.v},n.vertices,cc.js.getset(n,"vertices",n._getVertices,n._setVertices),n.colors,cc.js.getset(n,"colors",n._getColor,n._setColor),n.texCoords,cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,o,a+c):new cc.V3F_C4B_T2F(null,null,null,o,a+c),this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,o,a+2*c):new cc.V3F_C4B_T2F(null,null,null,o,a+2*c),this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,o,a+3*c):new cc.V3F_C4B_T2F(null,null,null,o,a+3*c)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,n=cc.V3F_C4B_T2F_Quad.prototype,n._getTL=function(){return this._tl},n._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getBL=function(){return this._bl},n._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getTR=function(){return this._tr},n._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getBR=function(){return this._br},n._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getArrayBuffer=function(){return this._arrayBuffer},n.tl,cc.js.getset(n,"tl",n._getTL,n._setTL),n.tr,cc.js.getset(n,"tr",n._getTR,n._setTR),n.bl,cc.js.getset(n,"bl",n._getBL,n._setBL),n.br,cc.js.getset(n,"br",n._getBR,n._setBR),n.arrayBuffer,cc.js.get(n,"arrayBuffer",n._getArrayBuffer),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var e=t.tl,i=t.bl,n=t.tr,r=t.br;return{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]));return e},cc.V2F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset,a=cc.Vertex2F.BYTES_PER_ELEMENT;this._vertices=t?new cc.Vertex2F(t.x,t.y,s,o):new cc.Vertex2F(0,0,s,o),this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,s,o+a):new cc.WebGLColor(0,0,0,0,s,o+a),this._texCoords=i?new cc.Tex2F(i.u,i.v,s,o+a+cc.WebGLColor.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,s,o+a+cc.WebGLColor.BYTES_PER_ELEMENT)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,n=cc.V2F_C4B_T2F.prototype,n._getVertices=function(){return this._vertices},n._setVertices=function(t){this._vertices.x=t.x,this._vertices.y=t.y},n._getColor=function(){return this._colors},n._setColor=function(t){var e=this._colors;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords.u=t.u,this._texCoords.v=t.v},n.vertices,cc.js.getset(n,"vertices",n._getVertices,n._setVertices),n.colors,cc.js.getset(n,"colors",n._getColor,n._setColor),n.texCoords,cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset,a=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o),this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,s,o+a):new cc.V2F_C4B_T2F(null,null,null,s,o+a),this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,s,o+2*a):new cc.V2F_C4B_T2F(null,null,null,s,o+2*a)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,n=cc.V2F_C4B_T2F_Triangle.prototype,n._getA=function(){return this._a},n._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getB=function(){return this._b},n._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getC=function(){return this._c},n._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n.a,cc.js.getset(n,"a",n._getA,n._setA),n.b,cc.js.getset(n,"b",n._getB,n._setB),n.c,cc.js.getset(n,"c",n._getC,n._setC)},{}],93:[function(t,e,i){function n(){}var r=t("../platform/js");r.setClassName("cc.ValueType",n),r.mixin(n.prototype,{clone:!1,equals:!1,toString:function(){return""+{}},lerp:!1}),cc.ValueType=n,e.exports=n},{"../platform/js":66}],94:[function(t,e,i){function n(t,e){"object"==typeof t&&(e=t.y,t=t.x),this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0}var r=t("./CCValueType"),s=t("../platform/js"),o=t("../platform/CCClass");s.extend(n,r),o.fastDefine("cc.Vec2",n,["x","y"]),s.mixin(n.prototype,{clone:function(){return new n(this.x,this.y)},set:function(t){return this.x=t.x,this.y=t.y,this},equals:function(t){return t&&this.x===t.x&&this.y===t.y},toString:function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},lerp:function(t,e,i){i=i||new n;var r=this.x,s=this.y;return i.x=r+(t.x-r)*e,i.y=s+(t.y-s)*e,i},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},add:function(t,e){return e=e||new n,e.x=this.x+t.x,e.y=this.y+t.y,e},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},sub:function(t,e){return e=e||new n,e.x=this.x-t.x,e.y=this.y-t.y,e},mulSelf:function(t){return this.x*=t,this.y*=t,this},mul:function(t,e){return e=e||new n,e.x=this.x*t,e.y=this.y*t,e},scaleSelf:function(t){return this.x*=t.x,this.y*=t.y,this},scale:function(t,e){return e=e||new n,e.x=this.x*t.x,e.y=this.y*t.y,e},divSelf:function(t){return this.x/=t,this.y/=t,this},div:function(t,e){return e=e||new n,e.x=this.x/t,e.y=this.y/t,e},negSelf:function(){return this.x=-this.x,this.y=-this.y,this},neg:function(t){return t=t||new n,t.x=-this.x,t.y=-this.y,t},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.y*t.x-this.x*t.y},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magSqr:function(){return this.x*this.x+this.y*this.y},normalizeSelf:function(){var t=this.x*this.x+this.y*this.y;if(1===t)return this;if(0===t)return console.warn("Can't normalize zero vector"),this;var e=1/Math.sqrt(t);return this.x*=e,this.y*=e,this},normalize:function(t){return t=t||new n,t.x=this.x,t.y=this.y,t.normalizeSelf(),t},angle:function(t){var e=this.magSqr(),i=t.magSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;var n=this.dot(t),r=n/Math.sqrt(e*i);return r=cc.clampf(r,-1,1),Math.acos(r)},signAngle:function(t){return Math.atan2(this.y,this.x)-Math.atan2(t.y,t.x)},rotate:function(t,e){return e=e||new n,e.x=this.x,e.y=this.y,e.rotateSelf(t)},rotateSelf:function(t){var e=Math.sin(t),i=Math.cos(t),n=this.x;return this.x=i*n-e*this.y,this.y=e*n+i*this.y,this}}),s.get(n,"ONE",function(){return new n(1,1)}),s.get(n,"ZERO",function(){return new n(0,0)}),s.get(n,"UP",function(){return new n(0,1)}),s.get(n,"RIGHT",function(){return new n(1,0)}),cc.Vec2=n;n.prototype;cc.v2=function(t,e){return new n(t,e)},cc.p=cc.v2,cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},e.exports=cc.Vec2},{"../platform/CCClass":53,"../platform/js":66,"./CCValueType":93}],95:[function(t,e,i){t("./CCValueType"),t("./CCEnum"),t("./CCVec2"),t("./CCSize"),t("./CCRect"),t("./CCColor"),t("./CCTypes"),t("./CCAffineTransform"),t("./CCTypesWebGL")},{"./CCAffineTransform":86,"./CCColor":87,"./CCEnum":88,"./CCRect":89,"./CCSize":90,"./CCTypes":91,"./CCTypesWebGL":92,"./CCValueType":93,"./CCVec2":94}],96:[function(require,module,exports){function deprecateEnum(obj,oldPath,newPath,hasTypePrefixBefore){hasTypePrefixBefore=hasTypePrefixBefore!==!1;for(var enumDef=eval(newPath),entries=cc.Enum.getList(enumDef),delimiter=hasTypePrefixBefore?"_":".",i=0;i<entries.length;i++){var entry=entries[i].name,oldPropName;if(hasTypePrefixBefore){var oldTypeName=oldPath.split(".").slice(-1)[0];oldPropName=oldTypeName+"_"+entry}else oldPropName=entry;js.get(obj,oldPropName,function(t){return cc.warn(INFO,oldPath+delimiter+t,newPath+"."+t),enumDef[t]}.bind(null,entry))}}function markAsRemoved(t,e,i){i=i||js.getClassName(t),e.forEach(function(e){function n(){cc.error("Sorry, %s.%s is removed.",i,e)}js.getset(t.prototype,e,n,n)})}function provideClearError(t,e){function i(e,i){function n(t){cc.error(r,e,t)}Array.isArray(i)||(i=i.split(",").map(function(t){return t.trim()})),js.getset(t,e,n.bind(null,i[0]),i[1]&&n.bind(null,i[1]))}var n=cc.js.getClassName(t),r="Sorry,"+n+".%s is removed, please use %s instead.";for(var s in e){var o=e[s];if("*"===s[0]){var a=s.slice(1);i("g"+a,o),i("s"+a,o)}else s.split(",").map(function(t){return t.trim()}).forEach(function(t){i(t,o)})}}function shouldNotUseNodeProp(t){var e=cc.js.getClassName(t),i="Sorry, "+e+".%s is removed, please use cc.Node.%s instead.",n=t.prototype;for(var r in cc.Node.prototype)!function(t){t in n||"_"===t[0]||js.getset(n,t,function(){cc.error(i,t,t)},function(){cc.error(i,t,t)})}(r)}var js,INFO},{}],97:[function(t,e,i){var n=cc.Enum({GRAVITY:0,RADIUS:1}),r=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2}),s={preview:{"default":!0,editorOnly:!0,notify:!1},_custom:!1,custom:{get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._sgNode&&(t?this._applyCustoms():this._applyFile(),cc.engine.repaintInEditMode()))}},_file:{"default":"",url:cc.ParticleAsset},file:{get:function(){return this._file},set:function(t,e){this._file!==t&&(this._file=t,this._sgNode&&t?(this._applyFile(),cc.engine.repaintInEditMode()):this.custom=!0)},url:cc.ParticleAsset},_texture:{"default":"",url:cc.Texture2D},texture:{get:function(){return this._texture},set:function(t){this._texture=t,this._sgNode&&(this._sgNode.texture=t?cc.textureCache.addImage(t):null)},url:cc.Texture2D},particleCount:{get:function(){return this._sgNode?this._sgNode.particleCount:0},set:function(t){this._sgNode&&(this._sgNode.particleCount=t)},visible:!1},playOnLoad:!0,_autoRemoveOnFinish:!1,autoRemoveOnFinish:{get:function(){return this._autoRemoveOnFinish},set:function(t){this._autoRemoveOnFinish!==t&&(this._autoRemoveOnFinish=t,this._applyAutoRemove())}},active:{get:function(){return this._sgNode?this._sgNode.isActive():!1},visible:!1}},o=function(){for(var t={totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,startColor:cc.Color.WHITE,startColorVar:cc.Color.BLACK,endColor:cc.color(255,255,255,0),endColorVar:cc.color(0,0,0,0),angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.p(0,0),posVar:cc.p(0,0),positionType:r.FREE,emitterMode:n.GRAVITY,gravity:cc.p(0,0),speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0},e=Object.keys(t),i=0;i<e.length;++i){var o=e[i];!function(t,e){var i="_"+t;s[i]=e;var n=e.constructor,r=s[t]={};cc.isChildClassOf(n,cc.ValueType)?(r.get=function(){return new n(this[i])},r.type=n):r.get=function(){return this[i]},r.set=cc.isChildClassOf(n,cc.ValueType)?function(e){this[i]=new n(e),this._sgNode&&(this._sgNode[t]=e)}:function(e){this[i]=e,this._sgNode&&(this._sgNode[t]=e)}}(o,t[o])}return e}();s.positionType.type=r,s.emitterMode.type=n;var a=cc.Class({name:"cc.ParticleSystem","extends":cc._ComponentInSG,editor:!1,ctor:function(){this._previewTimer=null,this._focused=!1,this._willStart=!1},properties:s,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:n,PositionType:r},onLoad:function(){this._super(),this.playOnLoad&&this.resetSystem(),this._applyAutoRemove()},onDestroy:function(){this._autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._super()},onFocusInEditor:!1,onLostFocusInEditor:!1,_createSgNode:function(){var t=this._sgNode=new cc.ParticleSystem,e=!1;if(this._file){var i=this._custom&&!this._texture;e=i,this._applyFile(e&&this._applyCustoms.bind(this))}return this._custom&&!e&&this._applyCustoms(),t.stopSystem(),t},addParticle:function(){return this._sgNode?this._sgNode.addParticle():!1},stopSystem:function(){this._sgNode&&this._sgNode.stopSystem()},resetSystem:function(){this._sgNode&&this._sgNode.resetSystem()},isFull:function(){return this.particleCount>=this._totalParticles},setDisplayFrame:function(t){if(t){var e=t.getTexture();e&&(this._texture=e.url),this._sgNode&&this._sgNode.setDisplayFrame(t)}},setTextureWithRect:function(t,e){t instanceof cc.Texture2D&&(this._texture=t.url),this._sgNode&&this._sgNode.setTextureWithRect(t,e)},_applyFile:function(t){var e=this._sgNode;if(e){var i=this._file;if(i){var n=this;cc.loader.load(i,function(r,s){if(r)throw r;e.particleCount=0;var o=e.isActive();e.initWithFile(i),o||e.stopSystem();e.getPosition();e.setPosition(0,0),e.autoRemoveOnFinish=n._autoRemoveOnFinish,t&&t()})}}},_applyCustoms:function(){var t=this._sgNode;if(t){for(var e=t.isActive(),i=0;i<o.length;i++){var n=o[i];t[n]=this["_"+n]}this._texture&&(t.texture=cc.textureCache.addImage(this._texture)),e||t.stopSystem(),t.autoRemoveOnFinish=this._autoRemoveOnFinish}},_applyAutoRemove:function(){var t=this._sgNode;if(t){var e=this._autoRemoveOnFinish;if(t.autoRemoveOnFinish=e,e){cc.assert(!t.onExit);var i=this;t.onExit=function(){_ccsg.Node.prototype.onExit.call(this),i.node.destroy()}}else t.onExit=null}}});cc.EParticleSystem=e.exports=a},{}],98:[function(t,e,i){var n=cc.Class({name:"cc.ParticleAsset","extends":cc.RawAsset});cc.ParticleAsset=e.exports=n},{}],99:[function(t,e,i){function n(){var t=cc.formatStr.apply(this,arguments);console.log(t)}t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle/CCParticleAsset"),t("./cocos2d/particle/CCEParticleSystem"),cc.sys.isNative&&(cc.log=n,cc.error=n,cc.warn=n,cc.info=n)},{"./cocos2d/animation":12,"./cocos2d/core":51,"./cocos2d/particle/CCEParticleSystem":97,"./cocos2d/particle/CCParticleAsset":98}],100:[function(t,e,i){t("./predefine");var n=!1;n?cc._initDebugSetting(1):t("./bin/modular-cocos2d"),t("./extends"),n&&(Editor.versions.cocos2d=t("./package.json").version),e.exports=cc},{"./bin/modular-cocos2d":2,"./cocos2d/deprecated":96,"./extends":99,"./package.json":void 0,"./predefine":104}],101:[function(t,e,i){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},r=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(n.prototype=this.prototype),r.prototype=new n,r})},{}],102:[function(t,e,i){t("./bind"),t("./string")},{"./bind":101,"./string":103}],103:[function(t,e,i){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.lastIndexOf(t,e)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){("undefined"==typeof e||e>this.length)&&(e=this.length),e-=t.length;var i=this.indexOf(t,e);return-1!==i&&i===e})},{}],104:[function(t,e,i){cc={},_ccsg={},cc.log=cc.warn=cc.error=cc._throw=cc.assert=function(){},t("./polyfill"),t("./cocos2d/core/platform/js"),t("./cocos2d/core/value-types"),t("./cocos2d/core/utils"),t("./cocos2d/core/platform/CCInputManager"),t("./cocos2d/core/platform/CCInputExtension"),t("./cocos2d/core/event"),t("./cocos2d/core/platform/CCSys"),t("./cocos2d/core/platform/CCLoader"),t("./CCDebugger"),t("./cocos2d/core/CCDirector"),t("./cocos2d/core/CCDirectorWebGL"),t("./cocos2d/core/CCDirectorCanvas"),t("./cocos2d/core/textures"),ccui={},ccs={},sp={},cp={}},{"./CCDebugger":1,"./cocos2d/core/CCDirector":16,"./cocos2d/core/CCDirectorCanvas":17,"./cocos2d/core/CCDirectorWebGL":18,"./cocos2d/core/event":50,"./cocos2d/core/platform/CCInputExtension":54,"./cocos2d/core/platform/CCInputManager":55,"./cocos2d/core/platform/CCLoader":56,"./cocos2d/core/platform/CCSys":59,"./cocos2d/core/platform/js":66,"./cocos2d/core/textures":77,"./cocos2d/core/utils":83,"./cocos2d/core/value-types":95,"./polyfill":102}]},{},[100]);
//# sourceMappingURL=cocos2d-js-min.js.map