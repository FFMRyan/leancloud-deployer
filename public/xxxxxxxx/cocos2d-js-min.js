!function t(e,i,r){function n(o,a){if(!i[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return n(i?i:t)},l,l.exports,t,e,i,r)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(t,e,i){cc._tmp=cc._tmp||{},cc._LogInfos=cc._LogInfos||{};var r=window;r.gl,r.WebGLRenderingContext,r.DeviceOrientationEvent,r.DeviceMotionEvent,r.AudioContext,r.AudioContext||r.webkitAudioContext,r.mozAudioContext,r=Object.prototype,r._super,r.ctor,r=null;var n;n="1.2.0",window.CocosEngine=cc.ENGINE_VERSION=n,cc._drawingUtil=null,cc._renderContext=null,cc._supportRender=!1,cc._canvas=null,cc.container=null,cc._gameDiv=null,t("./cocos2d/core/utils"),t("./cocos2d/core/platform/CCSys"),function(){function t(t){var e=cc.game.CONFIG_KEY,i=parseInt(t[e.renderMode])||0;(isNaN(i)||i>2||i<0)&&(t[e.renderMode]=0),cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!1,0===i?cc.sys.capabilities.opengl?(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0):cc.sys.capabilities.canvas&&(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):1===i&&cc.sys.capabilities.canvas?(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):2===i&&cc.sys.capabilities.opengl&&(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0)}function e(t,i,r){if(s[i])return null;r=r||"";var n=[],o=t[i];if(!o)throw new Error("can not find module ["+i+"]");for(var a=cc.path,c=0,h=o.length;c<h;c++){var l=o[c];if(!s[l]){var u=a.extname(l);if(u)".js"===u.toLowerCase()&&n.push(a.join(r,l));else{var d=e(t,l,r);d&&(n=n.concat(d))}s[l]=1}}return n}function i(t){cc._initDebugSetting(t[cc.game.CONFIG_KEY.debugMode]),cc._engineLoaded=!0,cc.log(cc.ENGINE_VERSION),a&&a()}function r(t){var r=cc.game.CONFIG_KEY,n=t[r.engineDir],s=cc.loader;if(cc._Class)i(t);else{var o=cc.path.join(n,"moduleConfig.json");s.load(o,function(r,o){if(r)throw new Error(r);var a=t.modules||[],c=o.module,h=[];cc.sys.capabilities.opengl&&a.indexOf("base4webgl")<0?a.splice(0,0,"base4webgl"):a.indexOf("core")<0&&a.splice(0,0,"core");for(var l=0,u=a.length;l<u;l++){var d=e(c,a[l],n);d&&(h=h.concat(d))}s.load(h,function(e){if(e)throw new Error(JSON.stringify(e));i(t)})})}}function n(){window.removeEventListener("load",n,!1),r(cc.game.config)}var s={},o=!1,a=null;cc._engineLoaded=!1,cc.initEngine=function(e,i){if(o){var s=a;return void(a=function(){s&&s(),i&&i()})}a=i,!cc.game.config&&e?cc.game.config=e:cc.game.config||cc.game._loadConfig(),e=cc.game.config,t(e),document.body?r(e):window.addEventListener("load",n,!1),o=!0}}()},{"./cocos2d/core/platform/CCSys":88,"./cocos2d/core/utils":119}],2:[function(t,e,i){function r(t){if("object"!=typeof t)return t;try{return JSON.stringify(t)}catch(e){return""}}cc._LogInfos={ActionManager:{addAction:"cc.ActionManager.addAction(): action must be non-null",removeAction:"cocos2d: removeAction: Target not found",removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",getActionByTag_2:"cocos2d : getActionByTag(tag = %s): Action not found"},configuration:{loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",loadConfigFile_2:"Please load the resource first : %s"},Director:{resume:"cocos2d: Director: Error in gettimeofday",setProjection:"cocos2d: Director: unrecognized projection",popToSceneStackLevel:"cocos2d: Director: unrecognized projection",popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",popScene:"running scene should not null",pushScene:"the scene should not null"},Array:{verifyType:"element type is wrong!"},deprecated:'"%s" is deprecated, please use "%s" instead.',Scheduler:{scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null"},Node:{getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",getRotation:"RotationX != RotationY. Don't know which one to return",getScale:"ScaleX != ScaleY. Don't know which one to return",addChild:"An Node can't be added as a child of itself.",addChild_2:"child already added. It can't be added again",addChild_3:"child must be non-null",removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",removeChildByTag:"argument tag is an invalid tag",removeChildByTag_2:"cocos2d: removeChildByTag(tag = %s): child not found!",removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",reumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",_arrayMakeObjectsPerformSelector:"Unknown callback function",reorderChild:"child must be non-null",runAction:"cc.Node.runAction(): action must be non-null",schedule:"callback function must be non-null",schedule_2:"interval must be positive",initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",_requestDirtyFlag:"_ccsg.Node._requestDirtyFlag: failed to satisfy the request, key (%s) for flag have already been taken"},AtlasNode:{_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",_initWithTileFile:"",_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture."},_checkEventListenerAvailable:{keyboard:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",touchOneByOne:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",touchAllAtOnce:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",acceleration:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil"},EventListener:{create:"Invalid parameter."},__getListenerID:"Don't call this method if the event is for touch.",LayerMultiplex:{initWithLayers:"parameters should not be ending with null in Javascript",switchTo:"Invalid index in MultiplexLayer switchTo message",switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",addLayer:"cc.Layer.addLayer(): layer should be non-null"},view:{setDesignResolutionSize:"Resolution not valid",setDesignResolutionSize_2:"should set resolutionPolicy"},inputManager:{handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s"},checkGLErrorDebug:"WebGL error %s",spriteFrameAnimationCache:{_addAnimationsWithDictionary:"cocos2d: cc.SpriteFrameAnimationCache: No animations were found in provided dictionary.",_addAnimationsWithDictionary_2:"cc.SpriteFrameAnimationCache. Invalid animation format",addAnimations:"cc.SpriteFrameAnimationCache.addAnimations(): File could not be found",_parseVersion1:"cocos2d: cc.SpriteFrameAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",_parseVersion1_2:"cocos2d: cc.SpriteFrameAnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",_parseVersion1_3:"cocos2d: cc.SpriteFrameAnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",_parseVersion1_4:"cocos2d: cc.SpriteFrameAnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",_parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",_parseVersion2_2:"cocos2d: cc.SpriteFrameAnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",addAnimations_2:"cc.SpriteFrameAnimationCache.addAnimations(): Invalid texture file name"},Sprite:{reorderChild:"cc.Sprite.reorderChild(): this child is not in children list",ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",_updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",initWithSpriteFrameName1:" is null, please check.",initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",reorderChild_2:"cc.Sprite.reorderChild(): child should be non-null",addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",addChild_3:"cc.Sprite.addChild(): child should be non-null",setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",setSpriteFrame:"Invalid spriteFrameName",setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null"},SpriteBatchNode:{addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",reorderChild_2:"cc.SpriteBatchNode.addChild(): child should be non-null",updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",addChild_2:"cc.Sprite.addChild(): child should be non-null",setSpriteFrame:"Invalid spriteFrameName",setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null"},spriteFrameCache:{_getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",_checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",_getFrameConfig_2:"Please load the resource first : %s",addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",addSpriteFrames_3:"Argument must be non-nil"},TextureAtlas:{initWithFile:"cocos2d: Could not open file: %s",insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex"},textureCache:{addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",addPVRImage:"addPVRImage does not support on HTML5",addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",dumpCachedTextureInfo:"cocos2d: '%s' id=%s %s x %s",dumpCachedTextureInfo_2:"cocos2d: '%s' id= HTMLCanvasElement %s x %s",dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",addUIImage_2:"cc.Texture.addUIImage(): image should be non-null",invalidKey:"TextureCache: url should be non-null"},Texture2D:{initWithETCFile:"initWithETCFile does not support on HTML5",initWithPVRFile:"initWithPVRFile does not support on HTML5",initWithPVRTCData:"initWithPVRTCData does not support on HTML5",addImage:"cc.Texture.addImage(): path should be non-null",initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",initWithString:"initWithString isn't supported on cocos2d-html5",initWithETCFile_2:"initWithETCFile does not support on HTML5",initWithPVRFile_2:"initWithPVRFile does not support on HTML5",initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",_initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",addImage_2:"cc.Texture.addImage(): path should be non-null",initWithData:"NSInternalInconsistencyException"},MissingFile:"Missing file: %s",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager:{addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",removeListeners:"Invalid listener type!",setPriority:"Can't set fixed priority with scene graph based listener.",addListener_2:"Invalid parameters.",addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",addListener_4:"The listener has been registered, please don't register it again.",_forceAddEventListener:"Invalid scene graph priority!",_updateListeners:"If program goes here, there should be event in dispatch.",_updateListeners_2:"_inDispatch should be 1 here."}},cc._logToWebPage=function(t){if(cc._canvas){var e=cc._logList,i=document;if(!e){var r=i.createElement("Div"),n=r.style;r.setAttribute("id","logInfoDiv"),cc._canvas.parentNode.appendChild(r),r.setAttribute("width","200"),r.setAttribute("height",cc._canvas.height),n.zIndex="99999",n.position="absolute",n.top="0",n.left="0",e=cc._logList=i.createElement("textarea");var s=e.style;e.setAttribute("rows","20"),e.setAttribute("cols","30"),e.setAttribute("disabled",!0),r.appendChild(e),s.backgroundColor="transparent",s.borderBottom="1px solid #cccccc",s.borderRightWidth="0px",s.borderLeftWidth="0px",s.borderTopWidth="0px",s.borderTopStyle="none",s.borderRightStyle="none",s.borderLeftStyle="none",s.padding="0px",s.margin=0}e.value=e.value+t+"\r\n",e.scrollTop=e.scrollHeight}};var n=t("./cocos2d/core/value-types/CCEnum");cc.DebugMode=n({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6});cc.log||console.log;cc._initDebugSetting=function(t){if(cc.log=cc.warn=cc.error=cc._throw=cc.assert=function(){},t!==cc.DebugMode.NONE){var e;t>cc.DebugMode.ERROR?(e=cc._logToWebPage.bind(cc),cc.error=function(){e("ERROR :  "+cc.js.formatStr.apply(cc,arguments))},cc.assert=function(t,i){"use strict";if(!t&&i){for(var n=2;n<arguments.length;n++)i=i.replace(/(%s)|(%d)/,r(arguments[n]));e("Assert: "+i)}},t!==cc.DebugMode.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){e("WARN :  "+cc.js.formatStr.apply(cc,arguments))}),t===cc.DebugMode.INFO_FOR_WEB_PAGE&&(cc.log=cc.info=function(){e(cc.js.formatStr.apply(cc,arguments))})):console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(t,e){if(!t&&e){for(var i=2;i<arguments.length;i++)e=e.replace(/(%s)|(%d)/,r(arguments[i]));throw new Error(e)}},t!==cc.DebugMode.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments)}),t===cc.DebugMode.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments)},cc.info=function(){(console.info||console.log).apply(console,arguments)})),cc._throw=function(t){cc.error(t.stack||t)}}}},{"./cocos2d/core/value-types/CCEnum":124}],3:[function(t,e,r){(function(e,r,n,s){function o(t){var e,i,r,n,s,o,a=1;for(l[0]=t;a;)if(a--,r=l[a],l[a]=null,r&&(e=r._children,e&&e.length>0))for(n=r._renderCmd,s=0,o=e.length;s<o;++s)i=e[s],l[a]=i,a++,i._renderCmd.transform(n)}function a(t,e){t.shaderProgram=e;var i=t.children;if(i)for(var r=0;r<i.length;r++)a(i[r],e)}e._tmp.PrototypeCCNode=function(){var t=_ccsg.Node.prototype;e.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),e.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),e.defineGetterSetter(t,"width",t._getWidth,t._setWidth),e.defineGetterSetter(t,"height",t._getHeight,t._setHeight),e.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),e.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),e.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),e.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),e.defineGetterSetter(t,"zIndex",t.getLocalZOrder,t.setLocalZOrder),e.defineGetterSetter(t,"vertexZ",t.getVertexZ,t.setVertexZ),e.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),e.defineGetterSetter(t,"rotationX",t.getRotationX,t.setRotationX),e.defineGetterSetter(t,"rotationY",t.getRotationY,t.setRotationY),e.defineGetterSetter(t,"scale",t.getScale,t.setScale),e.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),e.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),e.defineGetterSetter(t,"children",t.getChildren),e.defineGetterSetter(t,"childrenCount",t.getChildrenCount),e.defineGetterSetter(t,"parent",t.getParent,t.setParent),e.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),e.defineGetterSetter(t,"running",t.isRunning),e.defineGetterSetter(t,"ignoreAnchor",t.isIgnoreAnchorPointForPosition,t.ignoreAnchorPointForPosition),e.defineGetterSetter(t,"actionManager",t.getActionManager,t.setActionManager),e.defineGetterSetter(t,"scheduler",t.getScheduler,t.setScheduler),e.defineGetterSetter(t,"shaderProgram",t.getShaderProgram,t.setShaderProgram),e.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),e.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB),e.defineGetterSetter(t,"cascadeOpacity",t.isCascadeOpacityEnabled,t.setCascadeOpacityEnabled),e.defineGetterSetter(t,"color",t.getColor,t.setColor),e.defineGetterSetter(t,"cascadeColor",t.isCascadeColorEnabled,t.setCascadeColorEnabled)},e.s_globalOrderOfArrival=1,_ccsg.Node=e.Class({name:"ccsg.Node",properties:{_localZOrder:0,_globalZOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:e.p(0,0),_skewX:0,_skewY:0,_children:[],_visible:!0,_anchorPoint:e.p(0,0),_contentSize:e.size(0,0),_parent:null,_ignoreAnchorPointForPosition:!1,tag:e.macro.NODE_TAG_INVALID,_showNode:!1,_name:"",_realOpacity:255,_realColor:e.Color.WHITE,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1},ctor:function(){arguments[0];this.__instanceId=e.ClassManager.getNewInstanceId(),this._running=!1,this._reorderChildDirty=!1,this._shaderProgram=null,this.arrivalOrder=0,this._additionalTransformDirty=!1,this._isTransitionFinished=!1;var t=e.director;this._actionManager=t.getActionManager(),this._scheduler=t.getScheduler(),this._additionalTransform=e.affineTransformMakeIdentity(),this._initRendererCmd()},init:function(){return!0},_arrayMakeObjectsPerformSelector:function(t,i){if(t&&0!==t.length){var r,n,s=t.length,o=_ccsg.Node._stateCallbackType;switch(i){case o.onEnter:for(r=0;r<s;r++)n=t[r],n&&n.onEnter();break;case o.onExit:for(r=0;r<s;r++)n=t[r],n&&n.onExit();break;case o.onEnterTransitionDidFinish:for(r=0;r<s;r++)n=t[r],n&&n.onEnterTransitionDidFinish();break;case o.cleanup:for(r=0;r<s;r++)n=t[r],n&&n.cleanup();break;case o.updateTransform:for(r=0;r<s;r++)n=t[r],n&&n.updateTransform();break;case o.onExitTransitionDidStart:for(r=0;r<s;r++)n=t[r],n&&n.onExitTransitionDidStart();break;case o.sortAllChildren:for(r=0;r<s;r++)n=t[r],n&&n.sortAllChildren();break;default:e.assert(0,e._LogInfos.Node._arrayMakeObjectsPerformSelector)}}},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){this._localZOrder=t,this._parent&&this._parent.reorderChild(this,t),e.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return e.log(e._LogInfos.Node.getZOrder),this.getLocalZOrder()},setZOrder:function(t){e.log(e._LogInfos.Node.setZOrder),this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,e.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&e.log(e._LogInfos.Node.getRotation),this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&e.log(e._LogInfos.Node.getScale),this._scaleX},setScale:function(t,e){this._scaleX=t,this._scaleY=e||0===e?e:t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var i=this._position;if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPosition:function(){return e.p(this._position)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),e.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return e.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return e.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t;var e=_ccsg.Node._dirtyFlags;this._renderCmd.setDirtyFlag(e.transformDirty|e.opacityDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(t){this.arrivalOrder=t},getActionManager:function(){return this._actionManager||(this._actionManager=e.director.getActionManager()),this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this.stopAllActions(),this._actionManager=t)},getScheduler:function(){return this._scheduler||(this._scheduler=e.director.getScheduler()),this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return e.log(e._LogInfos.Node.boundingBox),this.getBoundingBox()},getBoundingBox:function(){var t=e.rect(0,0,this._contentSize.width,this._contentSize.height);return e._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),e.eventManager.removeListeners(this),this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.cleanup)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.tag===t)return r}return null},getChildByName:function(t){if(!t)return e.log("Invalid name"),null;for(var i=this._children,r=0,n=i.length;r<n;r++)if(i[r]._name===t)return i[r];return null},addChild:function(t,i,r){i=void 0===i?t._localZOrder:i;var n,s=!1;"undefined"==typeof r?(r=void 0,n=t._name):e.js.isString(r)?(n=r,r=void 0):e.js.isNumber(r)&&(s=!0,n=""),e.assert(t,e._LogInfos.Node.addChild_3),e.assert(null===t._parent,"child already added. It can't be added again"),this._addChildHelper(t,i,r,n,s)},_addChildHelper:function(t,i,r,n,s){this._children||(this._children=[]),this._insertChild(t,i),s?t.setTag(r):t.setName(n),t.setParent(this),t.setOrderOfArrival(e.s_globalOrderOfArrival++),this._running&&(t.onEnter(),this._isTransitionFinished&&t.onEnterTransitionDidFinish()),t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeFromParentAndCleanup:function(t){e.log(e._LogInfos.Node.removeFromParentAndCleanup),this.removeFromParent(t)},removeChild:function(t,i){0!==this._children.length&&(void 0===i&&(i=!0),this._children.indexOf(t)>-1&&this._detachChild(t,i),e.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,i){t===e.macro.NODE_TAG_INVALID&&e.log(e._LogInfos.Node.removeChildByTag);var r=this.getChildByTag(t);r?this.removeChild(r,i):e.log(e._LogInfos.Node.removeChildByTag_2,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var i=this._children;if(null!==i){void 0===t&&(t=!0);for(var r=0;r<i.length;r++){var n=i[r];n&&(this._running&&(n.onExitTransitionDidStart(),n.onExit()),t&&n.cleanup(),n.parent=null,n._renderCmd.detachFromParent())}this._children.length=0,e.renderer.childrenOrderDirty=!0}},_detachChild:function(t,i){this._running&&(t.onExitTransitionDidStart(),t.onExit()),i&&t.cleanup(),t.parent=null,t._renderCmd.detachFromParent(),e.js.array.remove(this._children,t)},_insertChild:function(t,i){e.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(i)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},reorderChild:function(t,i){e.assert(t,e._LogInfos.Node.reorderChild),e.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.arrivalOrder=e.s_globalOrderOfArrival,e.s_globalOrderOfArrival++,t._setLocalZOrder(i),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.orderDirty)},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,r=this._children,n=r.length;for(t=1;t<n;t++){for(i=r[t],e=t-1;e>=0;){if(i._localZOrder<r[e]._localZOrder)r[e+1]=r[e];else{if(!(i._localZOrder===r[e]._localZOrder&&i.arrivalOrder<r[e].arrivalOrder))break;r[e+1]=r[e]}e--}r[e+1]=i}this._reorderChildDirty=!1}},draw:function(t){},
transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onEnter),this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0,this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pause(),this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onExit)},runAction:function(t){return e.assert(t,e._LogInfos.Node.runAction),this.actionManager.addAction(t,this,!this._running),t},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(t){this.actionManager.removeAction(t)},stopActionByTag:function(t){return t===e.Action.TAG_INVALID?void e.log(e._LogInfos.Node.stopActionByTag):void this.actionManager.removeActionByTag(t,this)},getActionByTag:function(t){return t===e.Action.TAG_INVALID?(e.log(e._LogInfos.Node.getActionByTag),null):this.actionManager.getActionByTag(t,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,i,r,n,s){var o=arguments.length;"function"==typeof t?1===o?(i=0,r=e.macro.REPEAT_FOREVER,n=0,s=this.__instanceId):2===o?"number"==typeof i?(r=e.macro.REPEAT_FOREVER,n=0,s=this.__instanceId):(s=i,i=0,r=e.macro.REPEAT_FOREVER,n=0):3===o?("string"==typeof r?(s=r,r=e.macro.REPEAT_FOREVER):s=this.__instanceId,n=0):4===o&&(s=this.__instanceId):1===o?(i=0,r=e.macro.REPEAT_FOREVER,n=0):2===o&&(r=e.macro.REPEAT_FOREVER,n=0),e.assert(t,e._LogInfos.Node.schedule),e.assert(i>=0,e._LogInfos.Node.schedule_2),i=i||0,r=null==r?e.macro.REPEAT_FOREVER:r,n=n||0,this.scheduler.schedule(t,this,i,r,n,!this._running,s)},scheduleOnce:function(t,e,i){void 0===i&&(i=this.__instanceId),this.schedule(t,0,0,e,i)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){e.log(e._LogInfos.Node.resumeSchedulerAndActions),this.resume()},resume:function(){this.scheduler.resumeTarget(this),this.actionManager&&this.actionManager.resumeTarget(this),e.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){e.log(e._LogInfos.Node.pauseSchedulerAndActions),this.pause()},pause:function(){this.scheduler.pauseTarget(this),this.actionManager&&this.actionManager.pauseTarget(this),e.eventManager.pauseTarget(this)},setAdditionalTransform:function(t){return void 0===t?this._additionalTransformDirty=!1:(this._additionalTransform=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),void(this._additionalTransformDirty=!0))},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),i=this._parent;null!==i;i=i.parent)t=e.affineTransformConcat(t,i.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return e.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return e.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||e.v2(0,0),e.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return e.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||e.v2(0,0);var i=e.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(i)},_convertToWindowSpace:function(t){var i=this.convertToWorldSpace(t);return e.director.convertToUI(i)},convertTouchToNodeSpace:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},convertTouchToNodeSpaceAR:function(t){var i=e.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(i)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},visit:function(t){this._renderCmd.visit(t)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var i=this._renderCmd.getNodeToParentTransform();if(t){for(var r={a:i.a,b:i.b,c:i.c,d:i.d,tx:i.tx,ty:i.ty},n=this._parent;null!=n&&n!=t;n=n.getParent())e.affineTransformConcatIn(r,n.getNodeToParentTransform());return r}return i},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=e.rect(0,0,this._contentSize.width,this._contentSize.height),i=this.getNodeToWorldTransform();if(e._rectApplyAffineTransformIn(t,i),!this._children)return t;for(var r=this._children,n=0;n<r.length;n++){var s=r[n];if(s&&s._visible){var o=s._getBoundingBoxToCurrentNode(i);o&&(t=e.rectUnion(t,o))}}return t},_getBoundingBoxToCurrentNode:function(t){var i=e.rect(0,0,this._contentSize.width,this._contentSize.height),r=void 0===t?this.getNodeToParentTransform():e.affineTransformConcat(this.getNodeToParentTransform(),t);if(e._rectApplyAffineTransformIn(i,r),!this._children)return i;for(var n=this._children,s=0;s<n.length;s++){var o=n[s];if(o&&o._visible){var a=o._getBoundingBoxToCurrentNode(r);a&&(i=e.rectUnion(i,a))}}return i},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return e.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_initRendererCmd:function(){this._renderCmd=e.renderer.getRenderCmd(this)},_createRenderCmd:function(){return e._renderType===e.game.RENDER_TYPE_CANVAS?new _ccsg.Node.CanvasRenderCmd(this):new _ccsg.Node.WebGLRenderCmd(this)}}),_ccsg.Node.extend=function(t){return e._Class.extend.call(_ccsg.Node,t)},_ccsg.Node.prototype.ctor=_ccsg.Node,_ccsg.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7},e.assert("function"==typeof e._tmp.PrototypeCCNode,e._LogInfos.MissingFile,"BaseNodesPropertyDefine.js"),e._tmp.PrototypeCCNode(),delete e._tmp.PrototypeCCNode,e.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e,this.rendering=function(t,e,i){this._callback&&this._callback.call(this._target,t,e,i)}};var c=_ccsg.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,COUNT:9};e.js.get(c,"all",function(){var t=c.COUNT;return(1<<t)-1},!1),_ccsg.Node._requestDirtyFlag=function(t){e.assert(!c[t],e._LogInfos.Node._requestDirtyFlag,t);var i=c.COUNT,r=1<<i;return c[t]=r,c.COUNT++,r};var h=Math.PI/180,l=new Array(50);_ccsg.Node.RenderCmd=function(t){this._dirtyFlag=1,e.renderer.pushDirtyNode(this),this._node=t,this._needDraw=!1,this._anchorPointInPoints=new e.Vec2(0,0),this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._displayedOpacity=255,this._displayedColor=e.color(255,255,255,255),this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._curLevel=-1},_ccsg.Node.RenderCmd.prototype={constructor:_ccsg.Node.RenderCmd,getAnchorPointInPoints:function(){return e.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return e.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(c.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(c.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&c.transformDirty&&(this._inverse=e.affineTransformInvert(this.getNodeToParentTransform())),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x,t.y=e.height*i.y,this.setDirtyFlag(c.transformDirty)},setDirtyFlag:function(t){0===this._dirtyFlag&&0!==t&&e.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},transform:function(t,e){var i=this._node,r=t?t._worldTransform:null,n=this._transform,s=this._worldTransform,a=i._rotationX||i._rotationY,c=i._skewX||i._skewY,l=i._scaleX,u=i._scaleY,d=this._anchorPointInPoints.x,_=this._anchorPointInPoints.y,f=1,p=0,g=0,m=1;if(a||c){if(n.tx=i._position.x,n.ty=i._position.y,a){var v=i._rotationX*h;if(g=Math.sin(v),m=Math.cos(v),i._rotationY===i._rotationX)f=m,p=-g;else{var y=i._rotationY*h;f=Math.cos(y),p=-Math.sin(y)}}if(n.a=f*=l,n.b=p*=l,n.c=g*=u,n.d=m*=u,c){var C=Math.tan(i._skewX*h),T=Math.tan(i._skewY*h);C===1/0&&(C=99999999),T===1/0&&(T=99999999),n.a=f+p*T,n.b=p+f*T,n.c=g+m*C,n.d=m+g*C}(d||_)&&(n.tx-=n.a*d+n.c*_,n.ty-=n.b*d+n.d*_,i._ignoreAnchorPointForPosition&&(n.tx+=d,n.ty+=_)),r?(s.a=n.a*r.a+n.b*r.c,s.b=n.a*r.b+n.b*r.d,s.c=n.c*r.a+n.d*r.c,s.d=n.c*r.b+n.d*r.d,s.tx=r.a*n.tx+r.c*n.ty+r.tx,s.ty=r.d*n.ty+r.ty+r.b*n.tx):(s.a=n.a,s.b=n.b,s.c=n.c,s.d=n.d,s.tx=n.tx,s.ty=n.ty)}else n.a=l,n.b=0,n.c=0,n.d=u,n.tx=i._position.x,n.ty=i._position.y,(d||_)&&(n.tx-=n.a*d,n.ty-=n.d*_,i._ignoreAnchorPointForPosition&&(n.tx+=d,n.ty+=_)),r?(s.a=n.a*r.a+n.b*r.c,s.b=n.a*r.b+n.b*r.d,s.c=n.c*r.a+n.d*r.c,s.d=n.c*r.b+n.d*r.d,s.tx=n.tx*r.a+n.ty*r.c+r.tx,s.ty=n.tx*r.b+n.ty*r.d+r.ty):(s.a=n.a,s.b=n.b,s.c=n.c,s.d=n.d,s.tx=n.tx,s.ty=n.ty);this._currentRegion&&(this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble)),e&&o(i),this._cacheDirty=!0},getNodeToParentTransform:function(){return this._dirtyFlag&c.transformDirty&&this.transform(),this._transform},_propagateFlagsDown:function(t){var e=this._dirtyFlag,i=t?t._node:null;i&&i._cascadeColorEnabled&&t._dirtyFlag&c.colorDirty&&(e|=c.colorDirty),i&&i._cascadeOpacityEnabled&&t._dirtyFlag&c.opacityDirty&&(e|=c.opacityDirty),t&&t._dirtyFlag&c.transformDirty&&(e|=c.transformDirty),this._dirtyFlag=e},visit:function(t){var i=this._node,r=e.renderer;t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1),this._propagateFlagsDown(t),i._visible&&(isNaN(i._customZ)&&(i._vertexZ=r.assignedZ,r.assignedZ+=r.assignedZStep),this._syncStatus(t),this.visitChildren())},_updateDisplayColor:function(t){var i,r,n,s,o=this._node,a=this._displayedColor,h=o._realColor;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!o._cascadeColorEnabled){a.r=h.r,a.g=h.g,a.b=h.b;var l=new e.Color(255,255,255,255);for(n=o._children,i=0,r=n.length;i<r;i++)s=n[i],s&&s._renderCmd&&s._renderCmd._updateDisplayColor(l);this._cascadeColorEnabledDirty=!1}else{if(void 0===t){var u=o._parent;t=u&&u._cascadeColorEnabled?u.getDisplayedColor():e.Color.WHITE}if(a.r=0|h.r*t.r/255,a.g=0|h.g*t.g/255,a.b=0|h.b*t.b/255,o._cascadeColorEnabled)for(n=o._children,i=0,r=n.length;i<r;i++)s=n[i],s&&s._renderCmd&&(s._renderCmd._updateDisplayColor(a),s._renderCmd._updateColor())}this._dirtyFlag&=~c.colorDirty},_updateDisplayOpacity:function(t){var e,i,r,n,s=this._node;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!s._cascadeOpacityEnabled){for(this._displayedOpacity=s._realOpacity,r=s._children,e=0,i=r.length;e<i;e++)n=r[e],n&&n._renderCmd&&n._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t){var o=s._parent;t=255,o&&o._cascadeOpacityEnabled&&(t=o.getDisplayedOpacity())}if(this._displayedOpacity=s._realOpacity*t/255,s._cascadeOpacityEnabled)for(r=s._children,e=0,i=r.length;e<i;e++)n=r[e],n&&n._renderCmd&&(n._renderCmd._updateDisplayOpacity(this._displayedOpacity),n._renderCmd._updateColor())}this._dirtyFlag&=~c.opacityDirty},_syncDisplayColor:function(t){var i=this._node,r=this._displayedColor,n=i._realColor;if(void 0===t){var s=i._parent;t=s&&s._cascadeColorEnabled?s.getDisplayedColor():e.Color.WHITE}r.r=0|n.r*t.r/255,r.g=0|n.g*t.g/255,r.b=0|n.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(void 0===t){var i=e._parent;t=255,i&&i._cascadeOpacityEnabled&&(t=i.getDisplayedOpacity())}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=this._dirtyFlag,e=t&c.colorDirty,i=t&c.opacityDirty;t&c.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~c.contentDirty),e&&this._updateDisplayColor(),i&&this._updateDisplayOpacity(),(e||i)&&this._updateColor(),t&c.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~c.transformDirty)},_syncStatus:function(t){var e=this._dirtyFlag,i=e&c.colorDirty,r=e&c.opacityDirty,n=e&c.transformDirty;i&&this._syncDisplayColor(),r&&this._syncDisplayOpacity(),(i||r)&&this._updateColor(),n&&this.transform(t)},visitChildren:function(){var t,i,r=e.renderer,n=this._node,s=n._children,o=s.length;if(o>0){for(n.sortAllChildren(),t=0;t<o&&(i=s[t],i._localZOrder<0);t++)i._renderCmd.visit(this);for(r.pushRenderCommand(this);t<o;t++)s[t]._renderCmd.visit(this)}else r.pushRenderCommand(this);this._dirtyFlag=0}},_ccsg.Node.RenderCmd.prototype.originVisit=_ccsg.Node.RenderCmd.prototype.visit,_ccsg.Node.RenderCmd.prototype.originTransform=_ccsg.Node.RenderCmd.prototype.transform,_ccsg.Node.CanvasRenderCmd=function(t){_ccsg.Node.RenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1,this._currentRegion=new e.Region,this._oldRegion=new e.Region,this._regionFlag=0},_ccsg.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var u=_ccsg.Node.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);u.constructor=_ccsg.Node.CanvasRenderCmd,u._notifyRegionStatus=function(t){this._needDraw&&this._regionFlag<t&&(this._regionFlag=t)};var d=new e.Rect;u.getLocalBB=function(){var t=this._node;return d.x=d.y=0,d.width=t._getWidth(),d.height=t._getHeight(),d},u._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)},u.setDirtyFlag=function(t,e){_ccsg.Node.RenderCmd.prototype.setDirtyFlag.call(this,t,e),this._setCacheDirty(e),this._cachedParent&&this._cachedParent.setDirtyFlag(t,!0)},u._setCacheDirty=function(){if(this._cacheDirty===!1){this._cacheDirty=!0;var t=this._cachedParent;t&&t!==this&&t._setNodeDirtyForCache&&t._setNodeDirtyForCache()}},u._setCachedParent=function(t){if(this._cachedParent!==t){this._cachedParent=t;for(var e=this._node._children,i=0,r=e.length;i<r;i++)e[i]._renderCmd._setCachedParent(t)}},u.detachFromParent=function(){this._cachedParent=null;for(var t,e=this._node._children,i=0,r=e.length;i<r;i++)t=e[i],t&&t._renderCmd&&t._renderCmd.detachFromParent()},u.setShaderProgram=function(t){},u.getShaderProgram=function(){return null},_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){return t?t.src===e.macro.SRC_ALPHA&&t.dst===e.macro.ONE||t.src===e.macro.ONE&&t.dst===e.macro.ONE?"lighter":t.src===e.macro.ZERO&&t.dst===e.macro.SRC_ALPHA?"destination-in":t.src===e.macro.ZERO&&t.dst===e.macro.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"},_ccsg.Node.WebGLRenderCmd=function(t){_ccsg.Node.RenderCmd.call(this,t),this._shaderProgram=null};var u=_ccsg.Node.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);u.constructor=_ccsg.Node.WebGLRenderCmd,u._updateColor=function(){},u.setShaderProgram=function(t){this._shaderProgram=t},u.getShaderProgram=function(){return this._shaderProgram},_ccsg.Scene=_ccsg.Node.extend({_className:"Scene",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(e.director.getWinSize())}}),e.LoaderScene=_ccsg.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",_onProjectionChange:null,cb:null,target:null,init:function(){var t=this,i=160,r=200,n=t._bgLayer=new e.LayerColor(e.color(32,32,32,255));t.addChild(n,0);var s=24,o=-r/2+100;if(e._loaderImage){var a=new Image;a.src=e._loaderImage,i=a.width,r=a.height,t._initStage(a,e.visibleRect.center),s=14,o=-r/2-10}var c=t._label=new e.LabelTTF("Loading... 0%","Arial",s);return c.setPosition(e.pAdd(e.visibleRect.center,e.p(0,o))),c.setColor(e.color(180,180,180)),n.addChild(this._label,10),!0},_initStage:function(t,i){var r=this,n=r._texture2d=new e.Texture2D;n.initWithElement(t),n.handleLoadedTexture();var s=r._logo=new _ccsg.Sprite(n);s.x=i.x,s.y=i.y,r._bgLayer.addChild(s,10)},onEnter:function(){var t=this;_ccsg.Node.prototype.onEnter.call(t),t.schedule(t._startLoading,.3),this._onProjectionChange=function(){t._updateTransform()},e.director.on(e.Director.EVENT_PROJECTION_CHANGED,this._onProjectionChange)},onExit:function(){e.director.off(e.Director.EVENT_PROJECTION_CHANGED,this._onProjectionChange),_ccsg.Node.prototype.onExit.call(this);var t="Loading... 0%";this._label.setString(t)},initWithResources:function(t,i,r){e.js.isString(t)&&(t=[t]),this.resources=t||[],this.cb=i,this.target=r},_startLoading:function(){var t=this;t.unschedule(t._startLoading);var i=t.resources;e.loader.load(i,function(e,i){var r=e/i*100|0;r=Math.min(r,100),t._label.setString("Loading... "+r+"%")},function(e,i){t.cb&&t.cb.call(t.target,e,i)})},_updateTransform:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._bgLayer._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._label._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._logo._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)}}),e.LoaderScene.preload=function(t,i,r){var n=e;return n.loaderScene||(n.loaderScene=new e.LoaderScene,n.loaderScene.init()),n.loaderScene.initWithResources(t,i,r),e.director.runScene(n.loaderScene),n.loaderScene},e.Layer=_ccsg.Node.extend({_className:"Layer",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(e.winSize)},init:function(){var t=this;return t._ignoreAnchorPointForPosition=!0,t.setAnchorPoint(.5,.5),t.setContentSize(e.winSize),t._cascadeColorEnabled=!1,t._cascadeOpacityEnabled=!1,!0},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},addChild:function(t,e,i){_ccsg.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._bakeForAddChild(t)},_createRenderCmd:function(){return e._renderType===e.game.RENDER_TYPE_CANVAS?new e.Layer.CanvasRenderCmd(this):new e.Layer.WebGLRenderCmd(this)}}),e.LayerColor=e.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(t,e){this.width=t,this.height=e},changeWidth:function(t){this.width=t},changeHeight:function(t){this.height=t},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},ctor:function(t,i,r){e.Layer.prototype.ctor.call(this),this._blendFunc=new e.BlendFunc(e.macro.SRC_ALPHA,e.macro.ONE_MINUS_SRC_ALPHA),e.LayerColor.prototype.init.call(this,t,i,r)},init:function(t,i,r){e._renderType!==e.game.RENDER_TYPE_CANVAS&&(this.shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_POSITION_COLOR));var n=e.director.getWinSize();t=t||e.color(0,0,0,255),i=void 0===i?n.width:i,r=void 0===r?n.height:r;var s=this._realColor;return s.r=t.r,s.g=t.g,s.b=t.b,this._realOpacity=t.a,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty),e.LayerColor.prototype.setContentSize.call(this,i,r),!0},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},_createRenderCmd:function(){return e._renderType===e.game.RENDER_TYPE_CANVAS?new e.LayerColor.CanvasRenderCmd(this):new e.LayerColor.WebGLRenderCmd(this)}}),function(){var t=e.LayerColor.prototype;e.defineGetterSetter(t,"width",t._getWidth,t._setWidth),e.defineGetterSetter(t,"height",t._getHeight,t._setHeight)}(),e.LayerGradient=e.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(t,i,r,n){e.LayerColor.prototype.ctor.call(this),this._endColor=e.color(0,0,0,255),this._alongVector=e.p(0,-1),this._startOpacity=255,this._endOpacity=255,n&&n instanceof Array?(this._colorStops=n,n.splice(0,0,{p:0,color:t||e.Color.BLACK}),n.push({p:1,color:i||e.Color.BLACK})):this._colorStops=[{p:0,color:t||e.Color.BLACK},{p:1,color:i||e.Color.BLACK}],e.LayerGradient.prototype.init.call(this,t,i,r,n)},init:function(t,i,r,n){t=t||e.color(0,0,0,255),i=i||e.color(0,0,0,255),r=r||e.p(0,-1);var s=this,o=s._endColor;return s._startOpacity=t.a,o.r=i.r,o.g=i.g,o.b=i.b,s._endOpacity=i.a,s._alongVector=r,s._compressedInterpolation=!0,e.LayerColor.prototype.init.call(s,e.color(t.r,t.g,t.b,255)),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty|_ccsg.Node._dirtyFlags.gradientDirty),!0},setContentSize:function(t,i){e.LayerColor.prototype.setContentSize.call(this,t,i),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},_setWidth:function(t){e.LayerColor.prototype._setWidth.call(this,t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},_setHeight:function(t){e.LayerColor.prototype._setHeight.call(this,t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return e.color(this._realColor)},setStartColor:function(t){this.color=t;var e=this._colorStops;if(e&&e.length>0){var i=e[0].color;i.r=t.r,i.g=t.g,i.b=t.b}},setEndColor:function(t){var e=this._endColor;e.r=t.r,e.g=t.g,e.b=t.b;var i=this._colorStops;if(i&&i.length>0){var r=i[i.length-1].color;r.r=t.r,r.g=t.g,r.b=t.b}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},getEndColor:function(){return e.color(this._endColor)},setStartOpacity:function(t){this._startOpacity=t;var e=this._colorStops;e&&e.length>0&&(e[0].color.a=t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(t){this._endOpacity=t;var e=this._colorStops;e&&e.length>0&&(e[e.length-1].color.a=t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getVector:function(){return e.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(t){this._compressedInterpolation=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(t){this._colorStops=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty|_ccsg.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return e._renderType===e.game.RENDER_TYPE_CANVAS?new e.LayerGradient.CanvasRenderCmd(this):new e.LayerGradient.WebGLRenderCmd(this)}}),function(){var t=e.LayerGradient.prototype;t.startColor,e.defineGetterSetter(t,"startColor",t.getStartColor,t.setStartColor),t.endColor,e.defineGetterSetter(t,"endColor",t.getEndColor,t.setEndColor),t.startOpacity,e.defineGetterSetter(t,"startOpacity",t.getStartOpacity,t.setStartOpacity),t.endOpacity,e.defineGetterSetter(t,"endOpacity",t.getEndOpacity,t.setEndOpacity),t.vector,e.defineGetterSetter(t,"vector",t.getVector,t.setVector),t.colorStops,e.defineGetterSetter(t,"colorStops",t.getColorStops,t.setColorStops)}(),e.LayerMultiplex=e.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(t){e.Layer.prototype.ctor.call(this),t instanceof Array?e.LayerMultiplex.prototype.initWithLayers.call(this,t):e.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(t){return t.length>0&&null==t[t.length-1]&&e.log(e._LogInfos.LayerMultiplex.initWithLayers),this._layers=t,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(t){return t>=this._layers.length?void e.log(e._LogInfos.LayerMultiplex.switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=t,void this.addChild(this._layers[t]))},switchToAndReleaseMe:function(t){return t>=this._layers.length?void e.log(e._LogInfos.LayerMultiplex.switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=t,void this.addChild(this._layers[t]))},addLayer:function(t){return t?void this._layers.push(t):void e.log(e._LogInfos.LayerMultiplex.addLayer)}}),function(){e.Layer.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._isBaked=!1,this._bakeSprite=null,this._updateCache=2};var t=e.Layer.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=e.Layer.CanvasRenderCmd,t._setCacheDirty=function(t){if(t&&0===this._updateCache&&(this._updateCache=2),this._cacheDirty===!1){this._cacheDirty=!0;var e=this._cachedParent;e&&e!==this&&e._setNodeDirtyForCache&&e._setNodeDirtyForCache()}},t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag;e&t.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag&=~t.orderDirty),_ccsg.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag;i&e.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag&=~e.orderDirty),_ccsg.Node.RenderCmd.prototype._syncStatus.call(this,t)},t.transform=function(t,e){var i=this._worldTransform,r=i.a,n=i.b,s=i.c,o=i.d;_ccsg.Node.CanvasRenderCmd.prototype.transform.call(this,t,e),i.a===r&&i.b===n&&i.c===s&&i.d===o||0!==this._updateCache||(this._updateCache=2)},t.bake=function(){if(!this._isBaked){this._needDraw=!0,this._isBaked=this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var t=this._node._children,i=0,r=t.length;i<r;i++)t[i]._renderCmd._setCachedParent(this);this._bakeSprite||(this._bakeSprite=new e.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}},t.unbake=function(){if(this._isBaked){this._needDraw=!1,this._isBaked=!1,this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var t=this._node._children,e=0,i=t.length;e<i;e++)t[e]._renderCmd._setCachedParent(null)}},t.isBaked=function(){return this._isBaked},t.rendering=function(){if(this._cacheDirty){var t=this._node,i=t._children,r=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var n=this._getBoundingBoxForBake();n.width=0|n.width+.5,n.height=0|n.height+.5;var s=r.getCacheContext(),o=s.getContext();if(r.setPosition(n.x,n.y),this._updateCache>0){r.resetCanvasSize(n.width,n.height),s.setOffset(0-n.x,o.canvas.height-n.height+n.y),t.sortAllChildren(),e.renderer._turnToCacheMode(this.__instanceId);for(var a=0,c=i.length;a<c;a++)i[a].visit(this);e.renderer._renderingToCacheCanvas(s,this.__instanceId),r.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(t){if(!this._isBaked)return void this.originVisit(t);var i=this._node,r=i._children,n=r.length;this._propagateFlagsDown(t),i._visible&&0!==n&&(this._syncStatus(t),e.renderer.pushRenderCommand(this),this._bakeSprite.visit(this),this._dirtyFlag=0)},t._bakeForAddChild=function(t){t._parent===this._node&&this._isBaked&&t._renderCmd._setCachedParent(this)},t._getBoundingBoxForBake=function(){var t=null,i=this._node;if(!i._children||0===i._children.length)return e.rect(0,0,10,10);for(var r=i.getNodeToWorldTransform(),n=i._children,s=0,o=n.length;s<o;s++){var a=n[s];if(a&&a._visible)if(t){var c=a._getBoundingBoxToCurrentNode(r);c&&(t=e.rectUnion(t,c))}else t=a._getBoundingBoxToCurrentNode(r)}return t}}(),function(){e.LayerColor.CanvasRenderCmd=function(t){e.Layer.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._blendFuncStr="source-over",this._bakeRenderCmd=new e.CustomRenderCmd(this,this._bakeRendering)};var t=e.LayerColor.CanvasRenderCmd.prototype=Object.create(e.Layer.CanvasRenderCmd.prototype);t.constructor=e.LayerColor.CanvasRenderCmd,t.unbake=function(){e.Layer.CanvasRenderCmd.prototype.unbake.call(this),this._needDraw=!0},t.rendering=function(t,i,r){var n=t||e._renderContext,s=n.getContext(),o=this._node,a=this._displayedColor,c=this._displayedOpacity/255,h=o._contentSize.width,l=o._contentSize.height;0!==c&&(n.setCompositeOperation(this._blendFuncStr),n.setGlobalAlpha(c),n.setFillStyle("rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+", 1)"),n.setTransform(this._worldTransform,i,r),s.fillRect(0,0,h,-l),e.g_NumberOfDraws++)},t.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._updateSquareVertices=t._updateSquareVerticesWidth=t._updateSquareVerticesHeight=function(){},t._bakeRendering=function(){if(this._cacheDirty){var t,i=this._node,r=this._bakeSprite,n=i._children,s=n.length;this.transform(this.getParentRenderCmd(),!0);var o=this._getBoundingBoxForBake();o.width=0|o.width+.5,o.height=0|o.height+.5;var a=r.getCacheContext(),c=a.getContext();if(r.setPosition(o.x,o.y),this._updateCache>0){c.fillStyle=a._currentFillStyle,r.resetCanvasSize(o.width,o.height),a.setOffset(0-o.x,c.canvas.height-o.height+o.y);var h;if(e.renderer._turnToCacheMode(this.__instanceId),s>0){for(i.sortAllChildren(),t=0;t<s&&(h=n[t],h._localZOrder<0);t++)h._renderCmd.visit(this);for(e.renderer.pushRenderCommand(this);t<s;t++)n[t]._renderCmd.visit(this);
}else e.renderer.pushRenderCommand(this);e.renderer._renderingToCacheCanvas(a,this.__instanceId),r.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(t){if(!this._isBaked)return void this.originVisit();var i=this._node;this._propagateFlagsDown(t),i._visible&&(this._syncStatus(t),e.renderer.pushRenderCommand(this._bakeRenderCmd),this._bakeSprite._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._bakeSprite.visit(this),this._dirtyFlag=0)},t._getBoundingBoxForBake=function(){var t=this._node,i=e.rect(0,0,t._contentSize.width,t._contentSize.height),r=t.getNodeToWorldTransform();if(i=e.rectApplyAffineTransform(i,t.getNodeToWorldTransform()),!t._children||0===t._children.length)return i;for(var n=t._children,s=0;s<n.length;s++){var o=n[s];if(o&&o._visible){var a=o._getBoundingBoxToCurrentNode(r);i=e.rectUnion(i,a)}}return i}}(),function(){e.LayerGradient.CanvasRenderCmd=function(t){e.LayerColor.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._startPoint=e.p(0,0),this._endPoint=e.p(0,0),this._startStopStr=null,this._endStopStr=null};var t=e.LayerGradient.CanvasRenderCmd.prototype=Object.create(e.LayerColor.CanvasRenderCmd.prototype);t.constructor=e.LayerGradient.CanvasRenderCmd,t.rendering=function(t,i,r){var n=t||e._renderContext,s=n.getContext(),o=this._node,a=this._displayedOpacity/255;if(0!==a){var c=o._contentSize.width,h=o._contentSize.height;n.setCompositeOperation(this._blendFuncStr),n.setGlobalAlpha(a);var l=s.createLinearGradient(this._startPoint.x,this._startPoint.y,this._endPoint.x,this._endPoint.y);if(o._colorStops)for(var u=0;u<o._colorStops.length;u++){var d=o._colorStops[u];l.addColorStop(d.p,this._colorStopsStr[u])}else l.addColorStop(0,this._startStopStr),l.addColorStop(1,this._endStopStr);n.setFillStyle(l),n.setTransform(this._worldTransform,i,r),s.fillRect(0,0,c,-h),e.g_NumberOfDraws++}},t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag;e&t.gradientDirty&&(this._dirtyFlag|=t.colorDirty,this._dirtyFlag&=~t.gradientDirty),_ccsg.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag;i&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._dirtyFlag&=~e.gradientDirty),_ccsg.Node.RenderCmd.prototype._syncStatus.call(this,t)},t._updateColor=function(){var t=this._node,i=t._contentSize,r=.5*i.width,n=.5*i.height,s=e.pAngleSigned(e.p(0,-1),t._alongVector),o=e.pRotateByAngle(e.p(0,-1),e.p(0,0),s),a=Math.min(Math.abs(1/o.x),Math.abs(1/o.y));this._startPoint.x=r*(-o.x*a)+r,this._startPoint.y=n*(o.y*a)-n,this._endPoint.x=r*(o.x*a)+r,this._endPoint.y=n*(-o.y*a)-n;var c=this._displayedColor,h=t._endColor,l=t._startOpacity/255,u=t._endOpacity/255;if(this._startStopStr="rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+l.toFixed(4)+")",this._endStopStr="rgba("+Math.round(h.r)+","+Math.round(h.g)+","+Math.round(h.b)+","+u.toFixed(4)+")",t._colorStops){this._startOpacity=0,this._endOpacity=0,this._colorStopsStr=[];for(var d=0;d<t._colorStops.length;d++){var _=t._colorStops[d].color,f=null==_.a?1:_.a/255;this._colorStopsStr.push("rgba("+Math.round(_.r)+","+Math.round(_.g)+","+Math.round(_.b)+","+f.toFixed(4)+")")}}}}(),function(){e.Layer.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t)};var t=e.Layer.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=e.Layer.WebGLRenderCmd,t.bake=function(){},t.unbake=function(){},t._bakeForAddChild=function(){}}(),function(){e.LayerColor.WebGLRenderCmd=function(t){e.Layer.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new e.math.Matrix4,this._matrix.identity();var i=this;i._squareVerticesAB=new ArrayBuffer(48),i._squareColorsAB=new ArrayBuffer(16);var r=i._squareVerticesAB,n=i._squareColorsAB,s=e.Vertex3F.BYTES_PER_ELEMENT,o=e.Color.BYTES_PER_ELEMENT;i._squareVertices=[new e.Vertex3F(0,0,0,r,0),new e.Vertex3F(0,0,0,r,s),new e.Vertex3F(0,0,0,r,2*s),new e.Vertex3F(0,0,0,r,3*s)],i._squareColors=[e.color(0,0,0,255,n,0),e.color(0,0,0,255,n,o),e.color(0,0,0,255,n,2*o),e.color(0,0,0,255,n,3*o)],i._verticesFloat32Buffer=e._renderContext.createBuffer(),i._colorsUint8Buffer=e._renderContext.createBuffer(),this._shaderProgram=e.shaderCache.programForKey(e.SHADER_POSITION_COLOR)};var t=e.LayerColor.WebGLRenderCmd.prototype=Object.create(e.Layer.WebGLRenderCmd.prototype);t.constructor=e.LayerColor.WebGLRenderCmd,t.rendering=function(t){var i=t||e._renderContext,r=this._node,n=this._worldTransform,s=this._matrix.mat;s[0]=n.a,s[4]=n.c,s[12]=n.tx,s[1]=n.b,s[5]=n.d,s[13]=n.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),i.enableVertexAttribArray(e.macro.VERTEX_ATTRIB_POSITION),i.enableVertexAttribArray(e.macro.VERTEX_ATTRIB_COLOR),e.gl.blendFunc(r._blendFunc.src,r._blendFunc.dst),i.bindBuffer(i.ARRAY_BUFFER,this._verticesFloat32Buffer),i.vertexAttribPointer(e.macro.VERTEX_ATTRIB_POSITION,3,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._colorsUint8Buffer),i.vertexAttribPointer(e.macro.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,0,0),i.drawArrays(i.TRIANGLE_STRIP,0,this._squareVertices.length)},t.transform=function(t,e){this.originTransform(t,e);var i=this._node,r=i._contentSize.width,n=i._contentSize.height,s=this._squareVertices;s[1].x=r,s[2].y=n,s[3].x=r,s[3].y=n,s[0].z=s[1].z=s[2].z=s[3].z=i._vertexZ,this._bindLayerVerticesBufferData()},t._updateColor=function(){for(var t=this._displayedColor,e=this._displayedOpacity,i=this._squareColors,r=0;r<4;r++)i[r].r=t.r,i[r].g=t.g,i[r].b=t.b,i[r].a=e;this._bindLayerColorsBufferData()},t._bindLayerVerticesBufferData=function(){var t=e._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareVerticesAB,t.DYNAMIC_DRAW)},t._bindLayerColorsBufferData=function(){var t=e._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareColorsAB,t.STATIC_DRAW)},t.updateBlendFunc=function(t){}}(),function(){e.LayerGradient.WebGLRenderCmd=function(t){e.LayerColor.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._clipRect=new e.Rect,this._clippingRectDirty=!1};var t=e.LayerGradient.WebGLRenderCmd.prototype=Object.create(e.LayerColor.WebGLRenderCmd.prototype);t.constructor=e.LayerGradient.WebGLRenderCmd,t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag;e&t.gradientDirty&&(this._dirtyFlag|=t.colorDirty,this._updateVertex(),this._dirtyFlag&=~t.gradientDirty),_ccsg.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag;i&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._updateVertex(),this._dirtyFlag&=~e.gradientDirty),_ccsg.Node.RenderCmd.prototype._syncStatus.call(this,t)},t.transform=function(t,e){this.originTransform(t,e),this._updateVertex()},t._updateVertex=function(){var t=this._node,i=t._colorStops;if(i&&!(i.length<2)){this._clippingRectDirty=!0;var r,n=i.length,s=2*n,o=t._contentSize,a=this._squareVertices;if(a.length<s){this._squareVerticesAB=new ArrayBuffer(12*s),a.length=0;var c=this._squareVerticesAB,h=e.Vertex3F.BYTES_PER_ELEMENT;for(r=0;r<s;r++)a.push(new e.Vertex3F(0,0,0,c,h*r))}var l=Math.PI+e.pAngleSigned(e.p(0,-1),t._alongVector),u=e.p(o.width/2,o.height/2),d=Math.round(e.radiansToDegrees(l)),_=e.affineTransformMake(1,0,0,1,u.x,u.y);_=e.affineTransformRotate(_,l);var f,p;d<90?(f=e.p(-u.x,u.y),p=e.p(u.x,u.y)):d<180?(f=e.p(u.x,u.y),p=e.p(u.x,-u.y)):d<270?(f=e.p(u.x,-u.y),p=e.p(-u.x,-u.y)):(f=e.p(-u.x,-u.y),p=e.p(-u.x,u.y));var g=Math.sin(l),m=Math.cos(l),v=Math.abs((f.x*m-f.y*g)/u.x),y=Math.abs((p.x*g+p.y*m)/u.y);for(_=e.affineTransformScale(_,v,y),r=0;r<n;r++){var C=i[r],T=C.p*o.height,E=e.pointApplyAffineTransform(-u.x,T-u.y,_);a[2*r].x=E.x,a[2*r].y=E.y,a[2*r].z=t._vertexZ;var x=e.pointApplyAffineTransform(o.width-u.x,T-u.y,_);a[2*r+1].x=x.x,a[2*r+1].y=x.y,a[2*r+1].z=t._vertexZ}this._bindLayerVerticesBufferData()}},t._updateColor=function(){var t=this._node,r=t._colorStops;if(r&&!(r.length<2)){var n=r.length,s=this._squareColors,o=2*n;if(s.length<o){this._squareColorsAB=new ArrayBuffer(4*o),s.length=0;var a=this._squareColorsAB,c=e.Color.BYTES_PER_ELEMENT;for(i=0;i<o;i++)s.push(e.color(0,0,0,255,a,c*i))}var h=this._displayedOpacity/255;for(i=0;i<n;i++){var l=r[i].color,u=s[2*i],d=s[2*i+1];u.r=l.r,u.g=l.g,u.b=l.b,u.a=l.a*h,d.r=l.r,d.g=l.g,d.b=l.b,d.a=l.a*h}this._bindLayerColorsBufferData()}},t.rendering=function(t){var i=t||e._renderContext,r=this._node,n=this._getClippingRect();i.enable(i.SCISSOR_TEST),e.view.setScissorInPoints(n.x,n.y,n.width,n.height);var s=this._worldTransform,o=this._matrix.mat;o[0]=s.a,o[4]=s.c,o[12]=s.tx,o[1]=s.b,o[5]=s.d,o[13]=s.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),i.enableVertexAttribArray(e.macro.VERTEX_ATTRIB_POSITION),i.enableVertexAttribArray(e.macro.VERTEX_ATTRIB_COLOR),e.gl.blendFunc(r._blendFunc.src,r._blendFunc.dst),i.bindBuffer(i.ARRAY_BUFFER,this._verticesFloat32Buffer),i.vertexAttribPointer(e.macro.VERTEX_ATTRIB_POSITION,3,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._colorsUint8Buffer),i.vertexAttribPointer(e.macro.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,0,0),i.drawArrays(i.TRIANGLE_STRIP,0,this._squareVertices.length),i.disable(i.SCISSOR_TEST)},t._getClippingRect=function(){if(this._clippingRectDirty){var t=this._node,i=e.rect(0,0,t._contentSize.width,t._contentSize.height),r=t.getNodeToWorldTransform();this._clipRect=e._rectApplyAffineTransformIn(i,r)}return this._clipRect}}(),e.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=e.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=e.macro.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return this._GlExtensions.indexOf(t)>-1},getValue:function(t,e){this._inited||this._init();var i=this._valueDict;return i[t]?i[t]:e},setValue:function(t,e){this._valueDict[t]=e},gatherGPUInfo:function(){if(e._renderType!==e.game.RENDER_TYPE_CANVAS){this._inited||this._init();var t=e._renderContext,i=this._valueDict;i["gl.vendor"]=t.getParameter(t.VENDOR),i["gl.renderer"]=t.getParameter(t.RENDERER),i["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var r=t.getSupportedExtensions(),n=0;n<r.length;n++)this._GlExtensions+=r[n]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),i["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),i["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),i["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,i["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),i["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),i["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),i["gl.supports_vertex_array_object"]=this._supportsShareableVAO,e.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var i=e.loader.getRes(t);if(!i)throw new Error("Please load the resource first : "+t);e.assert(i,e._LogInfos.configuration.loadConfigFile_2,t);var r=i.data;if(!r)return void e.log(e._LogInfos.configuration.loadConfigFile,t);for(var n in r)this._valueDict[n]=r[n]}},e.DrawingPrimitiveCanvas=e._Class.extend({_cacheArray:[],_renderContext:null,ctor:function(t){this._renderContext=t},drawPoint:function(t,i){i||(i=1);var r=e.view.getScaleX(),n=e.view.getScaleY(),s=e.p(t.x*r,t.y*n),o=this._renderContext.getContext();o.beginPath(),o.arc(s.x,-s.y,i*r,0,2*Math.PI,!1),o.closePath(),o.fill()},drawPoints:function(t,i,r){if(null!=t){r||(r=1);var n=this._renderContext.getContext(),s=e.view.getScaleX(),o=e.view.getScaleY();n.beginPath();for(var a=0,c=t.length;a<c;a++)n.arc(t[a].x*s,-t[a].y*o,r*s,0,2*Math.PI,!1);n.closePath(),n.fill()}},drawLine:function(t,i){var r=this._renderContext.getContext(),n=e.view.getScaleX(),s=e.view.getScaleY();r.beginPath(),r.moveTo(t.x*n,-t.y*s),r.lineTo(i.x*n,-i.y*s),r.closePath(),r.stroke()},drawRect:function(t,i){this.drawLine(e.p(t.x,t.y),e.p(i.x,t.y)),this.drawLine(e.p(i.x,t.y),e.p(i.x,i.y)),this.drawLine(e.p(i.x,i.y),e.p(t.x,i.y)),this.drawLine(e.p(t.x,i.y),e.p(t.x,t.y))},drawSolidRect:function(t,i,r){var n=[t,e.p(i.x,t.y),i,e.p(t.x,i.y)];this.drawSolidPoly(n,4,r)},drawPoly:function(t,i,r,n){if(n=n||!1,null!=t){if(t.length<3)throw new Error("Polygon's point must greater than 2");var s=t[0],o=this._renderContext.getContext(),a=e.view.getScaleX(),c=e.view.getScaleY();o.beginPath(),o.moveTo(s.x*a,-s.y*c);for(var h=1,l=t.length;h<l;h++)o.lineTo(t[h].x*a,-t[h].y*c);r&&o.closePath(),n?o.fill():o.stroke()}},drawSolidPoly:function(t,e,i){this.setDrawColor(i.r,i.g,i.b,i.a),this.drawPoly(t,e,!0,!0)},drawCircle:function(t,i,r,n,s){s=s||!1;var o=this._renderContext.getContext(),a=e.view.getScaleX(),c=e.view.getScaleY();o.beginPath();var h=r-2*Math.PI;o.arc(0|t.x*a,0|-(t.y*c),i*a,-r,-h,!1),s&&o.lineTo(0|t.x*a,0|-(t.y*c)),o.stroke()},drawQuadBezier:function(t,i,r,n){var s=this._cacheArray;s.length=0;for(var o=0,a=0;a<n;a++){var c=Math.pow(1-o,2)*t.x+2*(1-o)*o*i.x+o*o*r.x,h=Math.pow(1-o,2)*t.y+2*(1-o)*o*i.y+o*o*r.y;s.push(e.p(c,h)),o+=1/n}s.push(e.p(r.x,r.y)),this.drawPoly(s,n+1,!1,!1)},drawCubicBezier:function(t,i,r,n,s){var o=this._cacheArray;o.length=0;for(var a=0,c=0;c<s;c++){var h=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*i.x+3*(1-a)*a*a*r.x+a*a*a*n.x,l=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*i.y+3*(1-a)*a*a*r.y+a*a*a*n.y;o.push(e.p(h,l)),a+=1/s}o.push(e.p(n.x,n.y)),this.drawPoly(o,s+1,!1,!1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,i,r){e._renderContext.setStrokeStyle("rgba(255,255,255,1)");var n=this._cacheArray;n.length=0;for(var s,o,a=1/t.length,c=0;c<r+1;c++){var h=c/r;1===h?(s=t.length-1,o=1):(s=0|h/a,o=(h-a*s)/a);var l=e.cardinalSplineAt(e.getControlPointAt(t,s-1),e.getControlPointAt(t,s-0),e.getControlPointAt(t,s+1),e.getControlPointAt(t,s+2),i,o);n.push(l)}this.drawPoly(n,r+1,!1,!1)},drawImage:function(t,e,i,r,n){var s=arguments.length,o=this._renderContext.getContext();switch(s){case 2:var a=t.height;o.drawImage(t,e.x,-(e.y+a));break;case 3:o.drawImage(t,e.x,-(e.y+i.height),i.width,i.height);break;case 5:o.drawImage(t,e.x,e.y,i.width,i.height,r.x,-(r.y+n.height),n.width,n.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(t,i,r){var n=t||this._renderContext,s=n.getContext();i*=e.view.getScaleX();var o="rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b);n.setFillStyle(o+",1)");var a=i/10;s.beginPath(),s.moveTo(-i,i),s.lineTo(0,a),s.lineTo(i,i),s.lineTo(a,0),s.lineTo(i,-i),s.lineTo(0,-a),s.lineTo(-i,-i),s.lineTo(-a,0),s.lineTo(-i,i),s.closePath(),s.fill();var c=s.createRadialGradient(0,0,a,0,0,i);c.addColorStop(0,o+", 1)"),c.addColorStop(.3,o+", 0.8)"),c.addColorStop(1,o+", 0.0)"),n.setFillStyle(c),s.beginPath();var h=0,l=e.macro.PI2;s.arc(0,0,i-a,h,l,!1),s.closePath(),s.fill()},drawColorBall:function(t,i,r){var n=t||this._renderContext,s=n.getContext();i*=e.view.getScaleX();var o="rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b),a=i/10,c=s.createRadialGradient(0,0,a,0,0,i);c.addColorStop(0,o+", 1)"),c.addColorStop(.3,o+", 0.8)"),c.addColorStop(.6,o+", 0.4)"),c.addColorStop(1,o+", 0.0)"),n.setFillStyle(c),s.beginPath();var h=0,l=e.macro.PI2;s.arc(0,0,i,h,l,!1),s.closePath(),s.fill()},fillText:function(t,e,i){this._renderContext.getContext().fillText(t,e,-i)},setDrawColor:function(t,e,i,r){this._renderContext.setFillStyle("rgba("+t+","+e+","+i+","+r/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+e+","+i+","+r/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*e.view.getScaleX()}});var _=e.macro;e.DrawingPrimitiveWebGL=e._Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:"u_color",_colorArray:null,_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(t){if(null==t&&(t=e._renderContext),!t instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var t=this;t._initialized||(t._shader=e.shaderCache.programForKey(_.SHADER_POSITION_UCOLOR),t._shader._addUniformLocation(t._colorLocation),t._shader._addUniformLocation(t._pointSizeLocation),t._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(_.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var r=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r),i.bufferData(i.ARRAY_BUFFER,new Float32Array([t.x,t.y]),i.STATIC_DRAW),i.vertexAttribPointer(_.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.POINTS,0,1),i.deleteBuffer(r),e.incrementGLDraws(1)},drawPoints:function(t,i){if(t&&0!==t.length){this.lazy_init();var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),r.enableVertexAttribArray(_.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var n=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(t),r.STATIC_DRAW),r.vertexAttribPointer(_.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),r.drawArrays(r.POINTS,0,t.length),r.deleteBuffer(n),e.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var e=new Float32Array(2*t.length),i=0;i<t.length;i++)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},drawLine:function(t,i){this.lazy_init();var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),r.enableVertexAttribArray(_.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var n=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray([t,i]),r.STATIC_DRAW),r.vertexAttribPointer(_.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),r.drawArrays(r.LINES,0,2),r.deleteBuffer(n),e.incrementGLDraws(1)},drawRect:function(t,i){this.drawLine(e.p(t.x,t.y),e.p(i.x,t.y)),this.drawLine(e.p(i.x,t.y),e.p(i.x,i.y)),this.drawLine(e.p(i.x,i.y),e.p(t.x,i.y)),this.drawLine(e.p(t.x,i.y),e.p(t.x,t.y))},drawSolidRect:function(t,i,r){var n=[t,e.p(i.x,t.y),i,e.p(t.x,i.y)];this.drawSolidPoly(n,4,r)},drawPoly:function(t,i,r){this.lazy_init();var n=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.enableVertexAttribArray(_.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW),n.vertexAttribPointer(_.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),r?n.drawArrays(n.LINE_LOOP,0,t.length):n.drawArrays(n.LINE_STRIP,0,t.length),n.deleteBuffer(s),e.incrementGLDraws(1)},drawSolidPoly:function(t,i,r){this.lazy_init(),r&&this.setDrawColor(r.r,r.g,r.b,r.a);var n=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.enableVertexAttribArray(_.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW),n.vertexAttribPointer(_.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLE_FAN,0,t.length),n.deleteBuffer(s),e.incrementGLDraws(1)},drawCircle:function(t,i,r,n,s){this.lazy_init();var o=1;s&&o++;var a=2*Math.PI/n,c=new Float32Array(2*(n+2));if(c){for(var h=0;h<=n;h++){var l=h*a,u=i*Math.cos(l+r)+t.x,d=i*Math.sin(l+r)+t.y;c[2*h]=u,c[2*h+1]=d}c[2*(n+1)]=t.x,c[2*(n+1)+1]=t.y;var f=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),f.enableVertexAttribArray(_.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var p=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,p),f.bufferData(f.ARRAY_BUFFER,c,f.STATIC_DRAW),f.vertexAttribPointer(_.VERTEX_ATTRIB_POSITION,2,f.FLOAT,!1,0,0),f.drawArrays(f.LINE_STRIP,0,n+o),f.deleteBuffer(p),e.incrementGLDraws(1)}},drawQuadBezier:function(t,i,r,n){this.lazy_init();for(var s=new Float32Array(2*(n+1)),o=0,a=0;a<n;a++)s[2*a]=Math.pow(1-o,2)*t.x+2*(1-o)*o*i.x+o*o*r.x,s[2*a+1]=Math.pow(1-o,2)*t.y+2*(1-o)*o*i.y+o*o*r.y,o+=1/n;s[2*n]=r.x,s[2*n+1]=r.y;var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),c.enableVertexAttribArray(_.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var h=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,h),c.bufferData(c.ARRAY_BUFFER,s,c.STATIC_DRAW),c.vertexAttribPointer(_.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.LINE_STRIP,0,n+1),c.deleteBuffer(h),e.incrementGLDraws(1)},drawCubicBezier:function(t,i,r,n,s){this.lazy_init();for(var o=new Float32Array(2*(s+1)),a=0,c=0;c<s;c++)o[2*c]=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*i.x+3*(1-a)*a*a*r.x+a*a*a*n.x,o[2*c+1]=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*i.y+3*(1-a)*a*a*r.y+a*a*a*n.y,a+=1/s;o[2*s]=n.x,o[2*s+1]=n.y;var h=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),h.enableVertexAttribArray(_.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var l=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,l),h.bufferData(h.ARRAY_BUFFER,o,h.STATIC_DRAW),h.vertexAttribPointer(_.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0),h.drawArrays(h.LINE_STRIP,0,s+1),h.deleteBuffer(l),e.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,i,r){this.lazy_init();for(var n,s,o=new Float32Array(2*(r+1)),a=1/t.length,c=0;c<r+1;c++){var h=c/r;1===h?(n=t.length-1,s=1):(n=0|h/a,s=(h-a*n)/a);var l=e.cardinalSplineAt(e.getControlPointAt(t,n-1),e.getControlPointAt(t,n),e.getControlPointAt(t,n+1),e.getControlPointAt(t,n+2),i,s);o[2*c]=l.x,o[2*c+1]=l.y}var u=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),u.enableVertexAttribArray(_.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var d=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,d),u.bufferData(u.ARRAY_BUFFER,o,u.STATIC_DRAW),u.vertexAttribPointer(_.VERTEX_ATTRIB_POSITION,2,u.FLOAT,!1,0,0),u.drawArrays(u.LINE_STRIP,0,r+1),u.deleteBuffer(d),e.incrementGLDraws(1)},setDrawColor:function(t,e,i,r){this._colorArray[0]=t/255,this._colorArray[1]=e/255,this._colorArray[2]=i/255,this._colorArray[3]=r/255},setPointSize:function(t){this._pointSize=t},setLineWidth:function(t){this._renderContext.lineWidth&&this._renderContext.lineWidth(t)}}),e._tmp.PrototypeSprite=function(){var t=_ccsg.Sprite.prototype;e.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB,t.setOpacityModifyRGB),e.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),e.defineGetterSetter(t,"color",t.getColor,t.setColor),t.dirty,t.flippedX,e.defineGetterSetter(t,"flippedX",t.isFlippedX,t.setFlippedX),t.flippedY,e.defineGetterSetter(t,"flippedY",t.isFlippedY,t.setFlippedY),t.offsetX,e.defineGetterSetter(t,"offsetX",t._getOffsetX),t.offsetY,e.defineGetterSetter(t,"offsetY",t._getOffsetY),t.atlasIndex,t.texture,e.defineGetterSetter(t,"texture",t.getTexture,t.setTexture),t.textureRectRotated,e.defineGetterSetter(t,"textureRectRotated",t.isTextureRectRotated),t.textureAtlas,t.batchNode,e.defineGetterSetter(t,"batchNode",t.getBatchNode,t.setBatchNode),t.quad,e.defineGetterSetter(t,"quad",t.getQuad)};var f=t("../cocos2d/core/event/event-target");_ccsg.Sprite=_ccsg.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,i,r){var n=this;_ccsg.Node.prototype.ctor.call(n),f.call(n),n._shouldBeHidden=!1,n._offsetPosition=e.p(0,0),n._unflippedOffsetPositionFromCenter=e.p(0,0),n._blendFunc={src:e.macro.BLEND_SRC,dst:e.macro.BLEND_DST},n._rect=e.rect(0,0,0,0),n._softInit(t,i,r)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return e.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t},getOffsetPosition:function(){return e.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){e.assert(t,e._LogInfos.Sprite.initWithSpriteFrame),t.textureLoaded()||(this._textureLoaded=!1,t.once("load",this._renderCmd._spriteFrameLoadedCallback,this._renderCmd));var i=e._renderType!==e.game.RENDER_TYPE_CANVAS&&t._rotated,r=this.initWithTexture(t.getTexture(),t.getRect(),i);return this.setSpriteFrame(t),r},initWithSpriteFrameName:function(t){e.assert(t,e._LogInfos.Sprite.initWithSpriteFrameName);var i=e.spriteFrameCache.getSpriteFrame(t);return e.assert(i,t+e._LogInfos.Sprite.initWithSpriteFrameName1),this.initWithSpriteFrame(i)},useBatchNode:function(t){this.textureAtlas=t.getTextureAtlas(),this._batchNode=t},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},sortAllChildren:function(){if(this._reorderChildDirty){var t=this._children;_ccsg.Node.prototype.sortAllChildren.call(this),this._batchNode&&this._arrayMakeObjectsPerformSelector(t,_ccsg.Node._stateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},reorderChild:function(t,i){return e.assert(t,e._LogInfos.Sprite.reorderChild_2),this._children.indexOf(t)===-1?void e.log(e._LogInfos.Sprite.reorderChild):void(i!==t.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),_ccsg.Node.prototype.reorderChild.call(this,t,i)))},removeChild:function(t,e){this._batchNode&&this._batchNode.removeSpriteFromAtlas(t),_ccsg.Node.prototype.removeChild.call(this,t,e)},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.setDirtyRecursively(!0)},removeAllChildren:function(t){var e=this._children,i=this._batchNode;if(i&&null!=e)for(var r=0,n=e.length;r<n;r++)i.removeSpriteFromAtlas(e[r]);_ccsg.Node.prototype.removeAllChildren.call(this,t),this._hasChildren=!1},ignoreAnchorPointForPosition:function(t){return this._batchNode?void e.log(e._LogInfos.Sprite.ignoreAnchorPointForPosition):void _ccsg.Node.prototype.ignoreAnchorPointForPosition.call(this,t)},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,i){e.assert(t,e._LogInfos.Sprite.setDisplayFrameWithAnimationName_3);var r=e.spriteFrameAnimationCache.getAnimation(t);if(!r)return void e.log(e._LogInfos.Sprite.setDisplayFrameWithAnimationName);var n=r.getFrames()[i];return n?void this.setSpriteFrame(n.getSpriteFrame()):void e.log(e._LogInfos.Sprite.setDisplayFrameWithAnimationName_2)},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var t=this._parent;t&&t!==this._batchNode;)t._setReorderChildDirtyRecursively(),t=t.parent}},getTexture:function(){return this._texture},_softInit:function(t,i,r){if(void 0===t)_ccsg.Sprite.prototype.init.call(this);else if(e.js.isString(t))if("#"===t[0]){var n=t.substr(1,t.length-1),s=e.spriteFrameCache.getSpriteFrame(n);s?this.initWithSpriteFrame(s):e.log("%s does not exist",t)}else _ccsg.Sprite.prototype.init.call(this,t,i);else if("object"==typeof t)if(t instanceof e.Texture2D)this.initWithTexture(t,i,r);else if(t instanceof e.SpriteFrame)this.initWithSpriteFrame(t);else if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var o=new e.Texture2D;o.initWithElement(t),o.handleLoadedTexture(),this.initWithTexture(o)}},getQuad:function(){return null},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},init:function(){var t=this;return arguments.length>0?t.initWithFile(arguments[0],arguments[1]):(_ccsg.Node.prototype.init.call(t),t.dirty=t._recursiveDirty=!1,t._blendFunc.src=e.macro.BLEND_SRC,t._blendFunc.dst=e.macro.BLEND_DST,t.texture=null,t._flippedX=t._flippedY=!1,t.anchorX=.5,t.anchorY=.5,t._offsetPosition.x=0,t._offsetPosition.y=0,t._hasChildren=!1,t.setTextureRect(e.rect(0,0,0,0),!1,e.size(0,0)),!0)},initWithFile:function(t,i){e.assert(t,e._LogInfos.Sprite.initWithFile);var r=e.textureCache.getTextureForKey(t);if(r){if(!i){var n=r.getContentSize();i=e.rect(0,0,n.width,n.height)}return this.initWithTexture(r,i)}return r=e.textureCache.addImage(t),this.initWithTexture(r,i||e.rect(0,0,r._contentSize.width,r._contentSize.height))},initWithTexture:function(t,i,r,n){var s=this;if(e.assert(0!==arguments.length,e._LogInfos.SpriteBatchNode.initWithTexture),r=r||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,i,r,n),!_ccsg.Node.prototype.init.call(s))return!1;s._batchNode=null,s._recursiveDirty=!1,s.dirty=!1,s._opacityModifyRGB=!0,s._blendFunc.src=e.macro.BLEND_SRC,s._blendFunc.dst=e.macro.BLEND_DST,s._flippedX=s._flippedY=!1,s.setAnchorPoint(.5,.5),s._offsetPosition.x=0,s._offsetPosition.y=0,s._hasChildren=!1;var o=t.isLoaded();return s._textureLoaded=o,o?(i||(i=e.rect(0,0,t.width,t.height)),this._renderCmd._checkTextureBoundary(t,i,r),
s.setTexture(t),s.setTextureRect(i,r),s.setBatchNode(null),this.emit("load"),!0):(s._rectRotated=r,i&&(s._rect.x=i.x,s._rect.y=i.y,s._rect.width=i.width,s._rect.height=i.height),s.texture&&s.texture.off("load",s._renderCmd._textureLoadedCallback,s._renderCmd),t.once("load",s._renderCmd._textureLoadedCallback,s._renderCmd),s.setTexture(t),!0)},setTextureRect:function(t,e,i,r){var n=this;n._rectRotated=e||!1,n.setContentSize(i||t),n.setVertexRect(t),n._renderCmd._setTextureCoords(t,r);var s=n._unflippedOffsetPositionFromCenter.x,o=n._unflippedOffsetPositionFromCenter.y;n._flippedX&&(s=-s),n._flippedY&&(o=-o);var a=n._rect;n._offsetPosition.x=s+(n._contentSize.width-a.width)/2,n._offsetPosition.y=o+(n._contentSize.height-a.height)/2},addChild:function(t,i,r){e.assert(t,e._LogInfos.SpriteBatchNode.addChild_2),null==i&&(i=t._localZOrder),null==r&&(r=t.tag),this._renderCmd._setBatchNodeForAddChild(t)&&(_ccsg.Node.prototype.addChild.call(this,t,i,r),this._hasChildren=!0)},setSpriteFrame:function(t){var i=this;e.js.isString(t)&&(t=e.spriteFrameCache.getSpriteFrame(t),e.assert(t,e._LogInfos.Sprite.setSpriteFrame)),this.setNodeDirty(!0);var r=t.getOffset();i._unflippedOffsetPositionFromCenter.x=r.x,i._unflippedOffsetPositionFromCenter.y=r.y;var n=t.getTexture(),s=t.textureLoaded();s?(i._textureLoaded=!0,n!==i._texture&&(i._setTexture(n),i.setColor(i._realColor)),i.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())):(i._textureLoaded=!1,t.once("load",function(t){var e=t.currentTarget;i._textureLoaded=!0;var r=e.getTexture();r!==i._texture&&i._setTexture(r),i.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),i.emit("load"),i.setColor(i._realColor)},i)),this._renderCmd._updateForSetSpriteFrame(n)},setDisplayFrame:function(t){e.log(e._LogInfos.Sprite.setDisplayFrame),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new e.SpriteFrame(this._texture,this._rect,this._rectRotated,this._unflippedOffsetPositionFromCenter,this._contentSize)},setBatchNode:function(t){var i=this;i._batchNode=t,i._batchNode?(i._transformToBatch=e.affineTransformIdentity(),i.textureAtlas=i._batchNode.getTextureAtlas()):(i.atlasIndex=_ccsg.Sprite.INDEX_NOT_INITIALIZED,i.textureAtlas=null,i._recursiveDirty=!1,i.dirty=!1)},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var i=e.js.isString(t);i&&(t=e.textureCache.addImage(t)),t._textureLoaded?(this._setTexture(t,i),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")):(this._renderCmd._setTexture(t),t.once("load",function(e){this._setTexture(t,i),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")},this))},_setTexture:function(t,e){this._renderCmd._setTexture(t),e&&this._changeRectWithTexture(t)},_changeRectWithTexture:function(t){var i=t._contentSize,r=e.rect(0,0,i.width,i.height);this.setTextureRect(r)},_createRenderCmd:function(){return e._renderType===e.game.RENDER_TYPE_CANVAS?new _ccsg.Sprite.CanvasRenderCmd(this):new _ccsg.Sprite.WebGLRenderCmd(this)}}),_ccsg.Sprite.INDEX_NOT_INITIALIZED=-1,e.js.addon(_ccsg.Sprite.prototype,f.prototype),e.assert("function"==typeof e._tmp.PrototypeSprite,e._LogInfos.MissingFile,"SpritesPropertyDefine.js"),e._tmp.PrototypeSprite(),delete e._tmp.PrototypeSprite;var p=_ccsg.Sprite.prototype;Object.defineProperty(p,"visible",{get:_ccsg.Node.prototype.isVisible,set:p.setVisible}),Object.defineProperty(p,"ignoreAnchor",{get:_ccsg.Node.prototype.isIgnoreAnchorPointForPosition,set:p.ignoreAnchorPointForPosition}),Object.defineProperty(p,"opacityModifyRGB",{get:p.isOpacityModifyRGB}),_ccsg.Sprite.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._textureToRender=null};var u=_ccsg.Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);u.constructor=_ccsg.Sprite.CanvasRenderCmd,u.setDirtyRecursively=function(t){},u._setTexture=function(t){var e=this._node;e._texture!==t&&(t?e._textureLoaded=t._textureLoaded:e._textureLoaded=!1,e._texture=t,this._updateColor())},u._setColorDirty=function(){this.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty)},u.isFrameDisplayed=function(t){var i=this._node;return t.getTexture()===i._texture&&e.rectEqualToRect(t.getRect(),i._rect)},u.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},u._setBatchNodeForAddChild=function(t){return!0},u._handleTextureForRotatedTexture=function(t,i,r,n){if(r&&t.isLoaded()){var s=t.getHtmlElementObj();s=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(s,i,n);var o=new e.Texture2D;o.initWithElement(s),o.handleLoadedTexture(),t=o,i.x=i.y=0,this._node._rect=e.rect(0,0,i.width,i.height)}return t},u._checkTextureBoundary=function(t,i,r){if(t&&t.url){var n=i.x+i.width,s=i.y+i.height;n>t.width&&e.error(e._LogInfos.RectWidth,t.url),s>t.height&&e.error(e._LogInfos.RectHeight,t.url)}},u.rendering=function(t,i,r){var n=this._node,s=this._textureCoord,o=this._displayedOpacity/255,a=this._textureToRender||n._texture;if((!a||0!==s.width&&0!==s.height&&a._textureLoaded)&&0!==o){var c,h=t||e._renderContext,l=h.getContext(),u=n._offsetPosition.x,d=n._rect.height,_=n._rect.width,f=-n._offsetPosition.y-d;h.setTransform(this._worldTransform,i,r),h.setCompositeOperation(this._blendFuncStr),h.setGlobalAlpha(o),(n._flippedX||n._flippedY)&&h.save(),n._flippedX&&(u=-u-_,l.scale(-1,1)),n._flippedY&&(f=n._offsetPosition.y,l.scale(1,-1));var p,g,m,v,y,C,T,E;if(this._colorized?(p=0,g=0):(p=s.renderX,g=s.renderY),m=s.width,v=s.height,y=u,C=f,T=_,E=d,a&&a._htmlElementObj)c=a._htmlElementObj,""!==a._pattern?(h.setFillStyle(l.createPattern(c,a._pattern)),l.fillRect(y,C,T,E)):l.drawImage(c,p,g,m,v,y,C,T,E);else{var x=n._contentSize;if(s.validRect){var b=this._displayedColor;h.setFillStyle("rgba("+b.r+","+b.g+","+b.b+",1)"),l.fillRect(y,C,x.width,x.height)}}(n._flippedX||n._flippedY)&&h.restore(),e.g_NumberOfDraws++}},u._updateColor=function(){var t=this._node,e=t._texture,i=this._textureCoord,r=this._displayedColor;e&&(255!==r.r||255!==r.g||255!==r.b?(this._textureToRender=e._generateColorTexture(r.r,r.g,r.b,i),this._colorized=!0):e&&(this._textureToRender=e,this._colorized=!1))},u._updateForSetSpriteFrame=function(t,e){if(this._colorized=!1,this._textureCoord.renderX=this._textureCoord.x,this._textureCoord.renderY=this._textureCoord.y,e=e||t._textureLoaded){var i=this._node.getColor();255===i.r&&255===i.g&&255===i.b||this._updateColor()}},u._spriteFrameLoadedCallback=function(t){var e=this._node,i=t.currentTarget;e.setTextureRect(i.getRect(),i.isRotated(),i.getOriginalSize()),this._updateColor(),e.emit("load")},u._textureLoadedCallback=function(t){var i=this._node,r=t.currentTarget;if(!i._textureLoaded){i._textureLoaded=!0;var n=(i._texture,i._rect);n?e._rectEqualToZero(n)&&(n.width=r.width,n.height=r.height):n=e.rect(0,0,r.width,r.height),i.texture=r,i.setTextureRect(n,i._rectRotated);var s=this._displayedColor;255===s.r&&255===s.g&&255===s.b||this._updateColor(),i.setBatchNode(i._batchNode),i.emit("load")}},u._setTextureCoords=function(t){var e=this._textureCoord;e.renderX=e.x=0|t.x,e.renderY=e.y=0|t.y,e.width=0|t.width,e.height=0|t.height,e.validRect=!(0===e.width||0===e.height||e.x<0||e.y<0)},_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,e,i){if(!t)return null;if(!e)return t;i=null==i||i;var r=document.createElement("canvas");r.width=e.width,r.height=e.height;var n=r.getContext("2d");return n.translate(r.width/2,r.height/2),i?n.rotate(-1.5707963267948966):n.rotate(1.5707963267948966),n.drawImage(t,e.x,e.y,e.height,e.width,-e.height/2,-e.width/2,e.height,e.width),r};var _=e.macro;_ccsg.Sprite.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._color=new Uint32Array(1),this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=e.shaderCache.programForKey(_.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST)};var u=_ccsg.Sprite.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);u.constructor=_ccsg.Sprite.WebGLRenderCmd,u.updateBlendFunc=function(t){},u.setDirtyFlag=function(t){_ccsg.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},u.setDirtyRecursively=function(t){this._recursiveDirty=t,this._dirty=t;for(var e,i=this._node._children,r=i?i.length:0,n=0;n<r;n++)e=i[n],e instanceof _ccsg.Sprite&&e._renderCmd.setDirtyRecursively(t)},u._setBatchNodeForAddChild=function(t){var i=this._node;if(i._batchNode){if(!(t instanceof _ccsg.Sprite))return e.log(e._LogInfos.Sprite.addChild),!1;t.texture._webTextureObj!==i.textureAtlas.texture._webTextureObj&&e.log(e._LogInfos.Sprite_addChild_2),i._batchNode.appendChild(t),i._reorderChildDirty||i._setReorderChildDirtyRecursively()}return!0},u._handleTextureForRotatedTexture=function(t){return t},u.isFrameDisplayed=function(t){var i=this._node;return e.rectEqualToRect(t.getRect(),i._rect)&&t.getTexture().getName()===i._texture.getName()&&e.pointEqualToPoint(t.getOffset(),i._unflippedOffsetPositionFromCenter)},u._updateForSetSpriteFrame=function(){},u._spriteFrameLoadedCallback=function(t){var e=t.currentTarget;this._node.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),this._node.emit("load")},u._textureLoadedCallback=function(t){var i=this._node,r=t.currentTarget;if(!i._textureLoaded){i._textureLoaded=!0;var n=i._rect;n?e._rectEqualToZero(n)&&(n.width=r.width,n.height=r.height):n=e.rect(0,0,r.width,r.height),i.texture=r,i.setTextureRect(n,i._rectRotated),i.setBatchNode(i._batchNode),i.emit("load"),e.renderer.childrenOrderDirty=!0}},u._setTextureCoords=function(t){var e=this._node,i=e._batchNode?e.textureAtlas.texture:e._texture,r=this._vertices;if(i){var n,s,o,a,c,h=i.pixelWidth,l=i.pixelHeight;e._rectRotated?(_.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(n=(2*t.x+1)/(2*h),s=n+(2*t.height-2)/(2*h),o=(2*t.y+1)/(2*l),a=o+(2*t.width-2)/(2*l)):(n=t.x/h,s=(t.x+t.height)/h,o=t.y/l,a=(t.y+t.width)/l),e._flippedX&&(c=o,o=a,a=c),e._flippedY&&(c=n,n=s,s=c),r[0].u=s,r[0].v=o,r[1].u=n,r[1].v=o,r[2].u=s,r[2].v=a,r[3].u=n,r[3].v=a):(_.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(n=(2*t.x+1)/(2*h),s=n+(2*t.width-2)/(2*h),o=(2*t.y+1)/(2*l),a=o+(2*t.height-2)/(2*l)):(n=t.x/h,s=(t.x+t.width)/h,o=t.y/l,a=(t.y+t.height)/l),e._flippedX&&(c=n,n=s,s=c),e._flippedY&&(c=o,o=a,a=c),r[0].u=n,r[0].v=o,r[1].u=n,r[1].v=a,r[2].u=s,r[2].v=o,r[3].u=s,r[3].v=a)}},u._setColorDirty=function(){},u._updateBlendFunc=function(){if(this._batchNode)return void e.log(e._LogInfos.Sprite__updateBlendFunc);var t=this._node;t._texture&&t._texture.hasPremultipliedAlpha()?(t._blendFunc.src=_.BLEND_SRC,t._blendFunc.dst=_.BLEND_DST,t.opacityModifyRGB=!0):(t._blendFunc.src=_.SRC_ALPHA,t._blendFunc.dst=_.ONE_MINUS_SRC_ALPHA,t.opacityModifyRGB=!1)},u._setTexture=function(t){var i=this._node;if(i._batchNode){if(i._batchNode.texture!==t)return void e.log(e._LogInfos.Sprite_setTexture)}else i._texture!==t&&(i._textureLoaded=!!t&&t._textureLoaded,i._texture=t,this._updateBlendFunc(),i._textureLoaded&&(e.renderer.childrenOrderDirty=!0))},u._checkTextureBoundary=function(t,i,r){if(t&&t.url){var n,s;r?(n=i.x+i.height,s=i.y+i.width):(n=i.x+i.width,s=i.y+i.height),n>t.width&&e.error(e._LogInfos.RectWidth,t.url),s>t.height&&e.error(e._LogInfos.RectHeight,t.url)}},u.transform=function(t,e){this.originTransform(t,e);var i=this._node,r=i._offsetPosition.x,n=r+i._rect.width,s=i._offsetPosition.y,o=s+i._rect.height,a=this._worldTransform,c=this._vertices;c[0].x=r*a.a+o*a.c+a.tx,c[0].y=r*a.b+o*a.d+a.ty,c[1].x=r*a.a+s*a.c+a.tx,c[1].y=r*a.b+s*a.d+a.ty,c[2].x=n*a.a+o*a.c+a.tx,c[2].y=n*a.b+o*a.d+a.ty,c[3].x=n*a.a+s*a.c+a.tx,c[3].y=n*a.b+s*a.d+a.ty},u.needDraw=function(){var t=this._node,e=t._texture;return this._needDraw&&e},u.uploadData=function(t,e,i){var r=this._node,n=r._texture;if(!(n&&n._textureLoaded&&r._rect.width&&r._rect.height&&this._displayedOpacity))return 0;var s=this._displayedOpacity,o=this._displayedColor.r,a=this._displayedColor.g,c=this._displayedColor.b;if(r._opacityModifyRGB){var h=s/255;o*=h,a*=h,c*=h}this._color[0]=s<<24|c<<16|a<<8|o;var l,u,d=r._vertexZ,_=this._vertices,f=_.length,p=i;for(l=0;l<f;++l)u=_[l],t[p]=u.x,t[p+1]=u.y,t[p+2]=d,e[p+3]=this._color[0],t[p+4]=u.u,t[p+5]=u.v,p+=6;return f},e.BakeSprite=_ccsg.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){_ccsg.Sprite.prototype.ctor.call(this);var t=document.createElement("canvas");t.width=t.height=10,this._cacheCanvas=t,this._cacheContext=new e.CanvasContextWrapper(t.getContext("2d"));var i=new e.Texture2D;i.initWithElement(t),i.handleLoadedTexture(),this.setTexture(i)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(t,i){var r=this._cacheCanvas,n=this._cacheContext,s=n._context.strokeStyle,o=n._context.fillStyle;void 0===i&&(i=t.height,t=t.width),r.width=t,r.height=i,s!==n._context.strokeStyle&&(n._context.strokeStyle=s),o!==n._context.fillStyle&&(n._context.fillStyle=o),this.getTexture().handleLoadedTexture(),this.setTextureRect(e.rect(0,0,t,i),!1,null,!1)}}),e.SpriteBatchNode=_ccsg.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(t){_ccsg.Node.prototype.ctor.call(this),this._blendFunc=new e.BlendFunc(e.macro.BLEND_SRC,e.macro.BLEND_DST);var i;e.js.isString(t)?(i=e.textureCache.getTextureForKey(t),i||(i=e.textureCache.addImage(t))):t instanceof e.Texture2D&&(i=t),i&&this.initWithTexture(i)},addSpriteWithoutQuad:function(t,e,i){return this.addChild(t,e,i),this},getTextureAtlas:function(){return null},setTextureAtlas:function(t){},getDescendants:function(){return this._children},initWithFile:function(t,i){var r=e.textureCache.getTextureForKey(t);return r||(r=e.textureCache.addImage(t)),this.initWithTexture(r,i)},init:function(t,i){var r=e.textureCache.getTextureForKey(t);return r||(r=e.textureCache.addImage(t)),this.initWithTexture(r,i)},increaseAtlasCapacity:function(){},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},rebuildIndexInOrder:function(t,e){return e},highestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.highestAtlasIndexInChild(e[e.length-1]):t.zIndex},lowestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.lowestAtlasIndexInChild(e[e.length-1]):t.zIndex},atlasIndexForChild:function(t){return t.zIndex},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,e){void 0===e?this._blendFunc=t:this._blendFunc={src:t,dst:e}},getBlendFunc:function(){return new e.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(t,i){return e.assert(t,e._LogInfos.SpriteBatchNode.updateQuadFromSprite_2),t instanceof _ccsg.Sprite?(t.dirty=!0,void t._renderCmd.transform(this._renderCmd,!0)):void e.log(e._LogInfos.SpriteBatchNode.updateQuadFromSprite)},insertQuadFromSprite:function(t,e){this.addChild(t,e)},insertChild:function(t,e){this.addChild(t,e)},appendChild:function(t){this.sortAllChildren();this._children[this._children.length-1]._localZOrder;this.addChild(t.lastLocalZOrder+1)},removeSpriteFromAtlas:function(t,e){this.removeChild(t,e)},initWithTexture:function(t){return this.setTexture(t),!0},getTexture:function(){return this._texture},setTexture:function(t){if(this._texture=t,t._textureLoaded){var e,i=this._children,r=i.length;for(e=0;e<r;++e)i[e].setTexture(t)}else t.addEventListener("load",function(){var e,i=this._children,r=i.length;for(e=0;e<r;++e)i[e].setTexture(t)},this)},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t);var e,i=this._children,r=i.length;for(e=0;e<r;++e)i[e].setShaderProgram(t)},addChild:function(t,i,r){e.assert(void 0!==t,e._LogInfos.SpriteBatchNode.addChild_3),this._isValidChild(t)&&(i=void 0===i?t.zIndex:i,r=void 0===r?t.tag:r,_ccsg.Node.prototype.addChild.call(this,t,i,r),this._renderCmd._shaderProgram&&(t.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(t){return t instanceof _ccsg.Sprite?t.texture===this._texture||(e.log(e._LogInfos.Sprite.addChild_5),!1):(e.log(e._LogInfos.Sprite.addChild_4),!1)}});var g=e.SpriteBatchNode.prototype;e.defineGetterSetter(g,"texture",g.getTexture,g.setTexture),e.defineGetterSetter(g,"shaderProgram",g.getShaderProgram,g.setShaderProgram);var m,v,y,C,T,f=t("../cocos2d/core/event/event-target"),E={_pool:{},_lengths:[],put:function(t){var e=t.length;this._pool[e]?this._pool[e].push(t):(this._pool[e]=[t],this._lengths.push(e),this._lengths.sort())},get:function(t){for(var e,i=0;i<this._lengths.length;i++)if(this._lengths[i]>=t){e=this._lengths[i];break}return e?this._pool[e].pop():void 0}},x=e.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL,b=[],S={_rebuildQuads_base:function(t,e,i,r){var n,s,o,a,c=t._vertices,h=t._renderCmd._worldTransform;if(r)n=0,s=0,o=i.width,a=i.height;else{var l=e._originalSize,u=e._rect,d=e._offset,_=i.width/l.width,f=i.height/l.height,p=d.x+(l.width-u.width)/2,g=d.x-(l.width-u.width)/2,v=d.y+(l.height-u.height)/2,y=d.y-(l.height-u.height)/2;n=p*_,s=v*f,o=i.width+g*_,a=i.height+y*f}c.length<8&&(E.put(c),c=E.get(8)||new Float32Array(8),t._vertices=c),m?(c[0]=n*h.a+s*h.c+h.tx,c[1]=n*h.b+s*h.d+h.ty,c[2]=o*h.a+s*h.c+h.tx,c[3]=o*h.b+s*h.d+h.ty,c[4]=n*h.a+a*h.c+h.tx,c[5]=n*h.b+a*h.d+h.ty,c[6]=o*h.a+a*h.c+h.tx,c[7]=o*h.b+a*h.d+h.ty):(c[0]=n,c[1]=s,c[2]=o,c[3]=s,c[4]=n,c[5]=a,c[6]=o,c[7]=a),b[0]=0,b[1]=2,b[2]=4,b[3]=6,t._uvsDirty&&this._calculateUVs(t,e),t._vertCount=4},_calculateUVs:function(t,e){var i=t._uvs,r=e._texture._pixelWidth,n=e._texture._pixelHeight,s=e._rect;i.length<8&&(E.put(i),i=E.get(8)||new Float32Array(8),t._uvs=i);var o,a,c,h,l=x?.5:0;e._rotated?(o=(s.x+l)/r,a=(s.y+s.width-l)/n,c=(s.x+s.height-l)/r,h=(s.y+l)/n,i[0]=o,i[1]=h,i[2]=o,i[3]=a,i[4]=c,i[5]=h,i[6]=c,i[7]=a):(o=(s.x+l)/r,a=(s.y+s.height-l)/n,c=(s.x+s.width-l)/r,h=(s.y+l)/n,i[0]=o,i[1]=a,i[2]=c,i[3]=a,i[4]=o,i[5]=h,i[6]=c,i[7]=h)}},A={x:new Array(4),y:new Array(4),_rebuildQuads_base:function(t,e,i,r,n,s,o){var a,c,h,l,u,d,_=t._vertices,f=t._renderCmd._worldTransform,p=e._rect;a=r,h=n,c=p.width-a-h,l=s,d=o,u=p.height-l-d;var g=i,v=g.width-a-h,y=g.height-l-d,C=g.width/(a+h),T=g.height/(l+d);C=C>1?1:C,T=T>1?1:T,v=v<0?0:v,y=y<0?0:y;var x=this.x,S=this.y;x[0]=0,x[1]=a*C,x[2]=x[1]+v,x[3]=g.width,S[0]=0,S[1]=d*T,S[2]=S[1]+y,S[3]=g.height,_.length<32&&(E.put(_),_=E.get(32)||new Float32Array(32),t._vertices=_);var A,R,O=0;if(m)for(A=0;A<4;A++)for(R=0;R<4;R++)_[O]=x[R]*f.a+S[A]*f.c+f.tx,_[O+1]=x[R]*f.b+S[A]*f.d+f.ty,O+=2;else for(A=0;A<4;A++)for(R=0;R<4;R++)_[O]=x[R],_[O+1]=S[A],O+=2;b[0]=0,b[1]=6,b[2]=24,b[3]=30,t._uvsDirty&&this._calculateUVs(t,e,r,n,s,o)},_calculateUVs:function(t,e,i,r,n,s){var o,a,c,h,l,u,d=t._uvs,_=e._rect,f=e._texture._pixelWidth,p=e._texture._pixelHeight,g=e._rect;o=i,c=r,a=_.width-o-c,h=n,u=s,l=_.height-h-u,d.length<32&&(E.put(d),d=E.get(32)||new Float32Array(32),t._uvs=d);var m,v,y=this.x,C=this.y,T=x?.5:0,b=0;if(e._rotated)for(y[0]=(g.x+T)/f,y[1]=(u+g.x)/f,y[2]=(u+l+g.x)/f,y[3]=(g.x+g.height-T)/f,C[3]=(g.y+T)/p,C[2]=(o+g.y)/p,C[1]=(o+a+g.y)/p,C[0]=(g.y+g.width-T)/p,m=0;m<4;m++)for(v=0;v<4;v++)d[b]=y[m],d[b+1]=C[3-v],b+=2;else for(y[0]=(g.x+T)/f,y[1]=(o+g.x)/f,y[2]=(o+a+g.x)/f,y[3]=(g.x+g.width-T)/f,C[3]=(g.y+T)/p,C[2]=(h+g.y)/p,C[1]=(h+l+g.y)/p,C[0]=(g.y+g.height-T)/p,m=0;m<4;m++)for(v=0;v<4;v++)d[b]=y[v],d[b+1]=C[m],b+=2}},R={_rebuildQuads_base:function(t,i,r){var n,s,o,a,c=t._vertices,h=t._renderCmd._worldTransform,l=t._uvs,u=i._texture._pixelWidth,d=i._texture._pixelHeight,_=i._rect,f=x?.5:0;i._rotated?(n=(_.x+f)/u,o=(_.x+_.height-f)/u,s=(_.y+_.width-f)/d,a=(_.y+f)/d):(n=(_.x+f)/u,o=(_.x+_.width-f)/u,s=(_.y+_.height-f)/d,a=(_.y+f)/d);var p=_.width,g=_.height,v=r.width/p,y=r.height/g,C=Math.ceil(y),T=Math.ceil(v);C*T>16384&&e.error("too many tiles, only 16384 tiles will be show");var S=C*T*4*2;c.length<S&&(E.put(c),c=E.get(S)||new Float32Array(S),t._vertices=c),l.length<S&&(E.put(l),l=E.get(S)||new Float32Array(S),t._uvs=l);var A,R,O,I,w=0;t._vertCount=0;for(var P=0;P<C;++P)for(var L=0;L<T;++L)if(A=p*L,R=g*P,O=p*Math.min(L+1,v),I=g*Math.min(P+1,y),m?(c[w]=A*h.a+R*h.c+h.tx,c[w+1]=A*h.b+R*h.d+h.ty,c[w+2]=O*h.a+R*h.c+h.tx,c[w+3]=O*h.b+R*h.d+h.ty,c[w+4]=A*h.a+I*h.c+h.tx,c[w+5]=A*h.b+I*h.d+h.ty,c[w+6]=O*h.a+I*h.c+h.tx,c[w+7]=O*h.b+I*h.d+h.ty):(c[w]=A,c[w+1]=R,c[w+2]=O,c[w+3]=R,c[w+4]=A,c[w+5]=I,c[w+6]=O,c[w+7]=I),i._rotated?(l[w]=n,l[w+1]=a,l[w+2]=n,l[w+3]=I=a+(s-a)*Math.min(1,v-L),l[w+4]=O=n+(o-n)*Math.min(1,y-P),l[w+5]=a,l[w+6]=O,l[w+7]=I):(l[w]=n,l[w+1]=s,l[w+2]=O=n+(o-n)*Math.min(1,v-L),l[w+3]=s,l[w+4]=n,l[w+5]=I=s+(a-s)*Math.min(1,y-P),l[w+6]=O,l[w+7]=I),w+=8,t._vertCount+=4,w>S)return;b[0]=0,b[1]=8*T+2,b[2]=S-8*T+4,b[3]=S-2}},O={_rebuildQuads_base:function(t,i,r,n,s,o){var a,c,h,l,u,d=t._vertices,_=t._renderCmd._worldTransform,f=t._uvs,p=0,g=0,v=r.width,y=r.height,C=i._texture._pixelWidth,T=i._texture._pixelHeight,S=i._rect,A=x?.5:0;i._rotated?(c=(S.x+A)/C,h=(S.y+S.width-A)/T,l=(S.x+S.height-A)/C,u=(S.y+A)/T):(c=(S.x+A)/C,h=(S.y+S.height-A)/T,l=(S.x+S.width-A)/C,u=(S.y+A)/T),d.length<8&&(E.put(d),d=E.get(8)||new Float32Array(8),t._vertices=d),f.length<8&&(E.put(f),f=E.get(8)||new Float32Array(8),t._uvs=f);var R=new Array(8);i._rotated?(R[0]=R[2]=c,R[4]=R[6]=l,R[3]=R[7]=h,R[1]=R[5]=u):(R[0]=R[4]=c,R[2]=R[6]=l,R[1]=R[3]=h,R[5]=R[7]=u),s=s>1?1:s,s=s<0?0:s,o=o<0?0:o,a=s+o,a=a>1?1:a;var O,I;switch(n){case P.HORIZONTAL:O=p+(v-p)*s,I=p+(v-p)*a,p=O,v=I,f[0]=R[0]+(R[2]-R[0])*s,f[1]=R[1],f[2]=R[0]+(R[2]-R[0])*a,f[3]=R[3],f[4]=R[4]+(R[6]-R[4])*s,f[5]=R[5],f[6]=R[4]+(R[6]-R[4])*a,f[7]=R[7];break;case P.VERTICAL:O=g+(y-g)*s,I=g+(y-g)*a,g=O,y=I,f[0]=R[0],f[1]=R[1]+(R[5]-R[1])*s,f[2]=R[2],f[3]=R[3]+(R[7]-R[3])*s,f[4]=R[4],f[5]=R[1]+(R[5]-R[1])*a,f[6]=R[6],f[7]=R[3]+(R[7]-R[3])*a;break;default:e.error("Unrecognized fill type in bar fill")}m?(d[0]=p*_.a+g*_.c+_.tx,d[1]=p*_.b+g*_.d+_.ty,d[2]=v*_.a+g*_.c+_.tx,d[3]=v*_.b+g*_.d+_.ty,d[4]=p*_.a+y*_.c+_.tx,d[5]=p*_.b+y*_.d+_.ty,d[6]=v*_.a+y*_.c+_.tx,d[7]=v*_.b+y*_.d+_.ty):(d[0]=p,d[1]=g,d[2]=v,d[3]=g,d[4]=p,d[5]=y,d[6]=v,d[7]=y),t._vertCount=4,b[0]=0,b[1]=2,b[2]=4,b[3]=6}},I={_vertPos:[e.v2(0,0),e.v2(0,0),e.v2(0,0),e.v2(0,0)],_vertices:[e.v2(0,0),e.v2(0,0)],_uvs:[e.v2(0,0),e.v2(0,0)],_intersectPoint_1:[e.v2(0,0),e.v2(0,0),e.v2(0,0),e.v2(0,0)],_intersectPoint_2:[e.v2(0,0),e.v2(0,0),e.v2(0,0),e.v2(0,0)],outVerts:null,outUvs:null,rawVerts:null,rawUvs:null,_rebuildQuads_base:function(t,i,r,n,s,o){for(var a=t._vertices,c=t._uvs,h=t._rawVerts,l=t._rawUvs,u=t._renderCmd._worldTransform;s>=1;)s-=1;for(;s<0;)s+=1;var d=n.x*r.width,_=n.y*r.height,f=e.v2(d,_);s*=2*Math.PI,o*=2*Math.PI;var p=s+o;this.outVerts=a,this.outUvs=c,this.rawVerts=h,this.rawUvs=l,this._calculateVertices(u,i,r),this._calculateUVs(i);var g=this._vertPos,m=this._vertices;g[0].x=g[3].x=m[0].x,g[1].x=g[2].x=m[1].x,g[0].y=g[1].y=m[0].y,g[2].y=g[3].y=m[1].y,f.x>m[1].x&&(f.x=m[1].x),f.x<m[0].x&&(f.x=m[0].x),f.y<m[0].y&&(f.y=m[0].y),f.y>m[1].y&&(f.y=m[1].y),h[0]=h[4]=this._vertices[0].x,h[2]=h[6]=this._vertices[1].x,h[1]=h[3]=this._vertices[0].y,h[5]=h[7]=this._vertices[1].y,i._rotated?(l[0]=l[2]=this._uvs[0].x,l[4]=l[6]=this._uvs[1].x,l[3]=l[7]=this._uvs[0].y,l[1]=l[5]=this._uvs[1].y):(l[0]=l[4]=this._uvs[0].x,l[2]=l[6]=this._uvs[1].x,l[1]=l[3]=this._uvs[0].y,l[5]=l[7]=this._uvs[1].y);var v=[null,null,null,null];f.x!==this._vertices[0].x&&(v[0]=[3,0]),f.x!==this._vertices[1].x&&(v[2]=[1,2]),f.y!==this._vertices[0].y&&(v[1]=[0,1]),f.y!==this._vertices[1].y&&(v[3]=[2,3]),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,f,s,this._intersectPoint_1),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,f,s+o,this._intersectPoint_2);var y=30;a.length<y&&(E.put(a),a=E.get(y)||new Float32Array(y),this.outVerts=t._vertices=a),c.length<y&&(E.put(c),c=E.get(y)||new Float32Array(y),this.outUvs=t._uvs=c);for(var C=0,T=0,x=0;x<4;++x){var S=v[x];if(null!==S)if(o>=2*Math.PI)this._generateTriangle(u,C,f,this._vertPos[S[0]],this._vertPos[S[1]]),C+=6,T+=3;else{var A=this._getVertAngle(f,this._vertPos[S[0]]),R=this._getVertAngle(f,this._vertPos[S[1]]);R<A&&(R+=2*Math.PI),A-=2*Math.PI,R-=2*Math.PI;for(var O=0;O<3;++O)A>=p||(A>=s?(R>=p?this._generateTriangle(u,C,f,this._vertPos[S[0]],this._intersectPoint_2[x]):this._generateTriangle(u,C,f,this._vertPos[S[0]],this._vertPos[S[1]]),C+=6,T+=3):R<=s||(R<=p?(this._generateTriangle(u,C,f,this._intersectPoint_1[x],this._vertPos[S[1]]),C+=6,T+=3):(this._generateTriangle(u,C,f,this._intersectPoint_1[x],this._intersectPoint_2[x]),C+=6,T+=3))),A+=2*Math.PI,R+=2*Math.PI}}t._vertCount=T,b[0]=0,b[1]=2,b[2]=4,b[3]=6},_generateTriangle:function(t,e,i,r,n){var s,o,a=this.rawVerts,c=this.rawUvs,h=this.outVerts,l=a[0],u=a[1],d=a[6],_=a[7];m?(h[e]=i.x*t.a+i.y*t.c+t.tx,h[e+1]=i.x*t.b+i.y*t.d+t.ty,h[e+2]=r.x*t.a+r.y*t.c+t.tx,h[e+3]=r.x*t.b+r.y*t.d+t.ty,h[e+4]=n.x*t.a+n.y*t.c+t.tx,h[e+5]=n.x*t.b+n.y*t.d+t.ty):(h[e]=i.x,h[e+1]=i.y,h[e+2]=r.x,h[e+3]=r.y,h[e+4]=n.x,h[e+5]=n.y),s=(i.x-l)/(d-l),o=(i.y-u)/(_-u),this._generateUV(s,o,c,e),s=(r.x-l)/(d-l),o=(r.y-u)/(_-u),this._generateUV(s,o,c,e+2),s=(n.x-l)/(d-l),o=(n.y-u)/(_-u),this._generateUV(s,o,c,e+4)},_generateUV:function(t,e,i,r){var n=this.outUvs,s=i[0]+(i[2]-i[0])*t,o=i[4]+(i[6]-i[4])*t,a=i[1]+(i[3]-i[1])*t,c=i[5]+(i[7]-i[5])*t;n[r]=s+(o-s)*e,n[r+1]=a+(c-a)*e},_isAngleIn:function(t,e,i){for(var r=2*Math.PI;t<e||t>=e+r;)t<e&&(t+=r),t>=e+r&&(t-=r);return t<=e+i},_getVertAngle:function(t,e){var i,r;if(i=e.x-t.x,r=e.y-t.y,0!==i||0!==r){if(0===i)return r>0?.5*Math.PI:1.5*Math.PI;var n=Math.atan(r/i);return i<0&&(n+=Math.PI),n}},_getInsectedPoints:function(t,e,i,r,n,s,o){var a,c,h=[null,null,null,null],l=Math.sin(s),u=Math.cos(s);if(0!==Math.cos(s)){if(a=l/u,(t-n.x)*u>0){var d=n.y+a*(t-n.x);o[0].x=t,o[0].y=d}if((e-n.x)*u>0){var _=n.y+a*(e-n.x);o[2].x=e,o[2].y=_}}if(0!==Math.sin(s)){if(c=u/l,(r-n.y)*l>0){var f=n.x+c*(r-n.y);o[3].x=f,o[3].y=r}if((i-n.y)*l>0){var p=n.x+c*(i-n.y);o[1].x=p,o[1].y=i}}return h},_calculateVertices:function(t,e,i){var r,n,s,o;r=0,s=0,n=i.width,o=i.height,this._vertices[0].x=r,this._vertices[0].y=s,this._vertices[1].x=n,this._vertices[1].y=o},_calculateUVs:function(t){var e,i,r,n,s=t._texture._pixelWidth,o=t._texture._pixelHeight,a=t._rect,c=x?.5:0;t._rotated?(e=(a.x+c)/s,i=(a.x+a.height-c)/s,r=(a.y+c)/o,n=(a.y+a.width-c)/o):(e=(a.x+c)/s,i=(a.x+a.width-c)/s,r=(a.y+c)/o,n=(a.y+a.height-c)/o),this._uvs[0].x=e,this._uvs[0].y=n,this._uvs[1].x=i,this._uvs[1].y=r}};e.Scale9Sprite=_ccsg.Node.extend({_spriteFrame:null,_insetLeft:0,_insetRight:0,_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_rawVerts:null,_rawUvs:null,_vertices:null,_uvs:null,_vertCount:0,_quadsDirty:!0,_uvsDirty:!0,_isTriangle:!1,_isTrimmedContentSize:!0,_fillType:0,_fillCenter:null,_fillStart:0,_fillRange:2*Math.PI,_distortionOffset:null,_distortionTiling:null,ctor:function(t){if(_ccsg.Node.prototype.ctor.call(this),this._renderCmd.setState(this._brightState),this._blendFunc=e.BlendFunc._alphaNonPremultiplied(),this._fillCenter=e.v2(0,0),this.setAnchorPoint(e.p(.5,.5)),this._rawVerts=null,this._rawUvs=null,this._vertices=E.get(8)||new Float32Array(8),this._uvs=E.get(8)||new Float32Array(8),"string"==typeof t){var i=e.spriteFrameCache.getSpriteFrame(t);i?this.initWithSpriteFrame(i):this.initWithTexture(t)}else t instanceof e.SpriteFrame?this.initWithSpriteFrame(t):t instanceof e.Texture2D&&this.initWithTexture(t);void 0===m&&(m=e._renderType===e.game.RENDER_TYPE_WEBGL,v=e.visibleRect.left,T=e.visibleRect.right,C=e.visibleRect.top,y=e.visibleRect.bottom)},loaded:function(){return null!==this._spriteFrame&&this._spriteFrame.textureLoaded()},initWithTexture:function(t){this.setTexture(t)},initWithSpriteFrame:function(t){this.setSpriteFrame(t)},setTexture:function(t){var i=new e.SpriteFrame(t);this.setSpriteFrame(i)},setSpriteFrame:function(t){var i;if(i=t instanceof e.SpriteFrame?t:e.spriteFrameCache.getSpriteFrame(t)){this._spriteFrame=i,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd._needDraw=!1;var r=this,n=function(){e.sizeEqualToSize(r._contentSize,e.size(0,0))&&r.setContentSize(r._spriteFrame._rect),r._renderCmd._needDraw=!0,r._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)};i.textureLoaded()?n():i.once("load",n,this)}},setBlendFunc:function(t,i){void 0===i?(this._blendFunc.src=t.src||e.macro.BLEND_SRC,this._blendFunc.dst=t.dst||e.macro.BLEND_DST):(this._blendFunc.src=t||e.macro.BLEND_SRC,this._blendFunc.dst=i||e.macro.BLEND_DST),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getBlendFunc:function(){return new e.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setContentSize:function(t,e){void 0===e&&(e=t.height,t=t.width),t===this._contentSize.width&&e===this._contentSize.height||(_ccsg.Node.prototype.setContentSize.call(this,t,e),this._quadsDirty=!0)},enableTrimmedContentSize:function(t){this._isTrimmedContentSize!==t&&(this._isTrimmedContentSize=t,this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},isTrimmedContentSizeEnabled:function(){return this._isTrimmedContentSize},setState:function(t){this._brightState=t,this._renderCmd.setState(t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getState:function(){return this._brightState},setRenderingType:function(t){this._renderingType!==t&&(this._renderingType=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},getRenderingType:function(){return this._renderingType},setInsetLeft:function(t){this._insetLeft=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(t){this._insetTop=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetTop:function(){return this._insetTop},setInsetRight:function(t){this._insetRight=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetRight:function(){return this._insetRight},setInsetBottom:function(t){this._insetBottom=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetBottom:function(){return this._insetBottom},setFillType:function(t){this._fillType!==t&&(this._fillType=t,this._renderingType===w.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillType:function(){return this._fillType},setFillCenter:function(t,i){this._fillCenter=e.v2(t,i),this._renderingType===w.FILLED&&this._fillType===P.RADIAL&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},setDistortionTiling:function(t,i){void 0===i&&(i=t.y,t=t.x),this._distortionTiling=this._distortionTiling||e.v2(0,0),this._distortionTiling.x=t,this._distortionTiling.y=i},setDistortionOffset:function(t,i){void 0===i&&(i=t.y,t=t.x),this._distortionOffset=this._distortionOffset||e.v2(0,0),this._distortionOffset.x=t,this._distortionOffset.y=i},getFillCenter:function(){return e.v2(this._fillCenter)},setFillStart:function(t){this._fillStart!==t&&(this._fillStart=t,this._renderingType===w.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillStart:function(){return this._fillStart},setFillRange:function(t){this._fillRange!==t&&(this._fillRange=t,this._renderingType===w.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillRange:function(){return this._fillRange},_rebuildQuads:function(){if(!this._spriteFrame||!this._spriteFrame._textureLoaded)return void(this._renderCmd._needDraw=!1);
switch(this._isTriangle=!1,this._renderingType){case w.SIMPLE:S._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._isTrimmedContentSize);break;case w.SLICED:A._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._insetLeft,this._insetRight,this._insetTop,this._insetBottom);break;case w.TILED:R._rebuildQuads_base(this,this._spriteFrame,this._contentSize);break;case w.FILLED:var t=this._fillStart,i=this._fillRange;i<0&&(t+=i,i=-i),this._fillType!==P.RADIAL?(i=t+i,t=t>1?1:t,t=t<0?0:t,i=i>1?1:i,i=i<0?0:i,i-=t,O._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._fillType,t,i)):(this._isTriangle=!0,this._rawVerts||(this._rawVerts=E.get(8)||new Float32Array(8),this._rawUvs=E.get(8)||new Float32Array(8)),I._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._fillCenter,t,i));break;default:return this._quadsDirty=!1,this._uvsDirty=!1,this._renderCmd._needDraw=!1,void e.error("Can not generate quad")}if(m){var r=this._isTriangle?this._rawVerts:this._vertices,n=r[b[0]],s=r[b[1]],o=r[b[2]],a=r[b[3]],c=r[b[0]+1],h=r[b[1]+1],l=r[b[2]+1],u=r[b[3]+1];(n-v.x&s-v.x&o-v.x&a-v.x)>>31||(T.x-n&T.x-s&T.x-o&T.x-a)>>31||(c-y.y&h-y.y&l-y.y&u-y.y)>>31||(C.y-c&C.y-h&C.y-l&C.y-u)>>31?this._renderCmd._needDraw=!1:this._renderCmd._needDraw=!0}else{var d=this._renderCmd._currentRegion,_=d._minX,f=d._maxX,p=d._minY,g=d._maxY;f<v.x||_>T.x||g<y.y||p>C.y?this._renderCmd._needDraw=!1:this._renderCmd._needDraw=!0}this._quadsDirty=!1,this._uvsDirty=!1},_createRenderCmd:function(){return e._renderType===e.game.RENDER_TYPE_CANVAS?new e.Scale9Sprite.CanvasRenderCmd(this):new e.Scale9Sprite.WebGLRenderCmd(this)}});var g=e.Scale9Sprite.prototype;e.js.addon(g,f.prototype),e.defineGetterSetter(g,"insetLeft",g.getInsetLeft,g.setInsetLeft),e.defineGetterSetter(g,"insetTop",g.getInsetTop,g.setInsetTop),e.defineGetterSetter(g,"insetRight",g.getInsetRight,g.setInsetRight),e.defineGetterSetter(g,"insetBottom",g.getInsetBottom,g.setInsetBottom),e.Scale9Sprite.state={NORMAL:0,GRAY:1,DISTORTION:2};var w=e.Scale9Sprite.RenderingType=e.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3}),P=e.Scale9Sprite.FillType=e.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2});e.Scale9Sprite.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this._state=e.Scale9Sprite.state.NORMAL,this._originalTexture=this._textureToRender=null};var u=e.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);u.constructor=e.Scale9Sprite.CanvasRenderCmd,u.transform=function(t,e){this.originTransform(t,e),this._node._rebuildQuads()},u._updateDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t),this._originalTexture=this._textureToRender=null},u.setState=function(t){this._state!==t&&(this._state=t,this._originalTexture=this._textureToRender=null)},u.rendering=function(t,i,r){var n=this._node,s=this._displayedOpacity,o=s/255,a=null;if(n._spriteFrame&&(a=n._spriteFrame._texture),n.loaded()&&0!==s){if(null===this._textureToRender||this._originalTexture!==a){this._textureToRender=this._originalTexture=a,e.Scale9Sprite.state.GRAY===this._state&&(this._textureToRender=this._textureToRender._generateGrayTexture());var c=n.getDisplayedColor();!a||255===c.r&&255===c.g&&255===c.b||(this._textureToRender=this._textureToRender._generateColorTexture(c.r,c.g,c.b))}var h=t||e._renderContext,l=h.getContext();if(h.setTransform(this._worldTransform,i,r),h.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(n._blendFunc)),h.setGlobalAlpha(o),this._textureToRender){n._quadsDirty&&n._rebuildQuads();var u,d,_,f,p,g,m,v,y=this._textureToRender._pixelWidth,C=this._textureToRender._pixelHeight,T=this._textureToRender._htmlElementObj,E=n._vertices,x=n._uvs,b=0,S=0;if(n._isTriangle){var A=n._rawVerts,R=n._rawUvs;p=A[0],g=A[1],m=A[6]-p,v=A[7]-g,g=-g-v,u=R[4]*y,d=R[5]*C,_=(R[6]-R[0])*y,f=(R[1]-R[7])*C,h.save(),l.beginPath();var O=Math.floor(n._vertCount/3);for(b=0,S=0;b<O;b++)l.moveTo(E[S++],-E[S++]),l.lineTo(E[S++],-E[S++]),l.lineTo(E[S++],-E[S++]);l.clip(),""!==this._textureToRender._pattern?(h.setFillStyle(l.createPattern(T,this._textureToRender._pattern)),l.fillRect(p,g,m,v)):_>0&&f>0&&m>0&&v>0&&l.drawImage(T,u,d,_,f,p,g,m,v),h.restore(),e.g_NumberOfDraws+=O}else if(n._renderingType===e.Scale9Sprite.RenderingType.SLICED){for(var I=0;I<3;++I)for(var w=0;w<3;++w)S=8*I+2*w,p=E[S],g=E[S+1],m=E[S+10]-p,v=E[S+11]-g,g=-g-v,u=x[S]*y,d=x[S+11]*C,_=(x[S+10]-x[S])*y,f=(x[S+1]-x[S+11])*C,_>0&&f>0&&m>0&&v>0&&l.drawImage(T,u,d,_,f,p,g,m,v);e.g_NumberOfDraws+=9}else{var P=Math.floor(n._vertCount/4);for(b=0,S=0;b<P;b++)p=E[S],g=E[S+1],m=E[S+6]-p,v=E[S+7]-g,g=-g-v,u=x[S]*y,d=x[S+7]*C,_=(x[S+6]-x[S])*y,f=(x[S+1]-x[S+7])*C,""!==this._textureToRender._pattern?(h.setFillStyle(l.createPattern(T,this._textureToRender._pattern)),l.fillRect(p,g,m,v)):_>0&&f>0&&m>0&&v>0&&l.drawImage(T,u,d,_,f,p,g,m,v),S+=8;e.g_NumberOfDraws+=P}}}};e.gl;e.Scale9Sprite.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this.vertexType=e.renderer.VertexType.QUAD,this._color=new Uint32Array(1),this._dirty=!1,this._shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var L=e.Scale9Sprite,u=L.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);u.constructor=L.WebGLRenderCmd,u._uploadSliced=function(t,e,i,r,n,s,o){for(var a,c=0;c<3;++c)for(var h=0;h<3;++h)a=8*c+2*h,n[o]=t[a],n[o+1]=t[a+1],n[o+2]=r,s[o+3]=i[0],n[o+4]=e[a],n[o+5]=e[a+1],o+=6,n[o]=t[a+2],n[o+1]=t[a+3],n[o+2]=r,s[o+3]=i[0],n[o+4]=e[a+2],n[o+5]=e[a+3],o+=6,n[o]=t[a+8],n[o+1]=t[a+9],n[o+2]=r,s[o+3]=i[0],n[o+4]=e[a+8],n[o+5]=e[a+9],o+=6,n[o]=t[a+10],n[o+1]=t[a+11],n[o+2]=r,s[o+3]=i[0],n[o+4]=e[a+10],n[o+5]=e[a+11],o+=6;return 36},u.transform=function(t,e){this.originTransform(t,e),this._node._rebuildQuads()},u.uploadData=function(t,i,r){var n=this._node;if(0===this._displayedOpacity)return 0;n._quadsDirty&&n._rebuildQuads(),n._distortionOffset&&this._shaderProgram===L.WebGLRenderCmd._distortionProgram&&(this._shaderProgram.setUniformLocationWith2f(L.WebGLRenderCmd._distortionOffset,n._distortionOffset.x,n._distortionOffset.y),this._shaderProgram.setUniformLocationWith2f(L.WebGLRenderCmd._distortionTiling,n._distortionTiling.x,n._distortionTiling.y));var s=this._displayedOpacity,o=this._displayedColor.r,a=this._displayedColor.g,c=this._displayedColor.b;if(n._opacityModifyRGB){var h=s/255;o*=h,a*=h,c*=h}this._color[0]=s<<24|c<<16|a<<8|o;var l=n._vertexZ,u=n._vertices,d=n._uvs,_=L.RenderingType,f=r,p=0;switch(n._renderingType){case _.SIMPLE:case _.TILED:case _.FILLED:p=this._node._vertCount;for(var g=0,m=0;g<p;g++,m+=2)t[f]=u[m],t[f+1]=u[m+1],t[f+2]=l,i[f+3]=this._color[0],t[f+4]=d[m],t[f+5]=d[m+1],f+=6;break;case _.SLICED:p=this._uploadSliced(u,d,this._color,l,t,i,f)}return n._renderingType===_.FILLED&&n._fillType===L.FillType.RADIAL?this.vertexType=e.renderer.VertexType.TRIANGLE:this.vertexType=e.renderer.VertexType.QUAD,p},u.setState=function(t){t===L.state.NORMAL?this._shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR):t===L.state.GRAY?this._shaderProgram=e.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram():t===L.state.DISTORTION&&(this._shaderProgram=e.Scale9Sprite.WebGLRenderCmd._getDistortionProgram())},L.WebGLRenderCmd._grayShaderProgram=null,L.WebGLRenderCmd._getGrayShaderProgram=function(){var t=L.WebGLRenderCmd._grayShaderProgram;return t?t:(t=new e.GLProgram,t.initWithVertexShaderByteArray(e.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,e.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),t.addAttribute(e.macro.ATTRIBUTE_NAME_POSITION,e.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(e.macro.ATTRIBUTE_NAME_COLOR,e.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(e.macro.ATTRIBUTE_NAME_TEX_COORD,e.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),L.WebGLRenderCmd._grayShaderProgram=t,t)},L.WebGLRenderCmd._grayShaderFragment="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    vec4 c = texture2D(CC_Texture0, v_texCoord); \n    gl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b); \n     gl_FragColor.w = c.w ; \n}",L.WebGLRenderCmd._distortionProgram=null,L.WebGLRenderCmd._getDistortionProgram=function(){var t=L.WebGLRenderCmd._distortionProgram;return t?t:(t=new e.GLProgram,t.initWithVertexShaderByteArray(e.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,N.fShader),t.addAttribute(e.macro.ATTRIBUTE_NAME_POSITION,e.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(e.macro.ATTRIBUTE_NAME_COLOR,e.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(e.macro.ATTRIBUTE_NAME_TEX_COORD,e.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),L.WebGLRenderCmd._distortionProgram=t,L.WebGLRenderCmd._distortionOffset=t.getUniformLocationForName("u_offset"),L.WebGLRenderCmd._distortionTiling=t.getUniformLocationForName("u_offset_tiling"),t)};var N={shaderKey:"cc.Sprite.Shader.Distortion",fShader:"precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform vec2 u_offset; \nuniform vec2 u_offset_tiling; \nconst float PI = 3.14159265359;\nvoid main() \n{ \nfloat halfPI = 0.5 * PI;\nfloat maxFactor = sin(halfPI);\nvec2 uv = v_texCoord;\nvec2 xy = 2.0 * uv.xy - 1.0;\nfloat d = length(xy);\nif (d < (2.0-maxFactor)) {\nd = length(xy * maxFactor);\nfloat z = sqrt(1.0 - d * d);\n float r = atan(d, z) / PI;\nfloat phi = atan(xy.y, xy.x);\nuv.x = r * cos(phi) + 0.5;\nuv.y = r * sin(phi) + 0.5;\n} else {\ndiscard;\n}\nuv = uv * u_offset_tiling + u_offset;\nuv = fract(uv); \ngl_FragColor = v_fragmentColor * texture2D(CC_Texture0, uv);\n}"},F=function(t){return{u:t.x,v:t.y}};e.DrawNode=_ccsg.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=null==t.a?255:t.a},getDrawColor:function(){return e.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),e.DrawNode.TYPE_DOT=0,e.DrawNode.TYPE_SEGMENT=1,e.DrawNode.TYPE_POLY=2,e.game.once(e.game.EVENT_RENDERER_INITED,function(){e._renderType===e.game.RENDER_TYPE_CANVAS?(e._DrawNodeElement=function(t,e,i,r,n,s,o,a,c){var h=this;h.type=t,h.verts=e||null,h.fillColor=i||null,h.lineWidth=r||0,h.lineColor=n||null,h.lineCap=s||"butt",h.isClosePolygon=o||!1,h.isFill=a||!1,h.isStroke=c||!1},e.js.mixin(e.DrawNode.prototype,{_className:"DrawNodeCanvas",ctor:function(){_ccsg.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=e.color(255,255,255,255),t._blendFunc=this._blendFunc=new e.BlendFunc(e.macro.SRC_ALPHA,e.macro.ONE_MINUS_SRC_ALPHA),this.init()},drawRect:function(t,i,r,n,s){n=null==n?this._lineWidth:n,s=s||this.getDrawColor(),null==s.a&&(s.a=255);var o=[t,e.p(i.x,t.y),i,e.p(t.x,i.y)],a=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);a.verts=o,a.lineWidth=n,a.lineColor=s,a.isClosePolygon=!0,a.isStroke=!0,a.lineCap="butt",a.fillColor=r,r&&(null==r.a&&(r.a=255),a.isFill=!0),this._buffer.push(a)},drawCircle:function(t,i,r,n,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);for(var c=2*Math.PI/n,h=[],l=0;l<=n;l++){var u=l*c,d=i*Math.cos(u+r)+t.x,_=i*Math.sin(u+r)+t.y;h.push(e.p(d,_))}s&&h.push(e.p(t.x,t.y));var f=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);f.verts=h,f.lineWidth=o,f.lineColor=a,f.isClosePolygon=!0,f.isStroke=!0,this._buffer.push(f)},drawQuadBezier:function(t,i,r,n,s,o){s=s||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var a=[],c=0,h=0;h<n;h++){var l=Math.pow(1-c,2)*t.x+2*(1-c)*c*i.x+c*c*r.x,u=Math.pow(1-c,2)*t.y+2*(1-c)*c*i.y+c*c*r.y;a.push(e.p(l,u)),c+=1/n}a.push(e.p(r.x,r.y));var d=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);d.verts=a,d.lineWidth=s,d.lineColor=o,d.isStroke=!0,d.lineCap="round",this._buffer.push(d)},drawCubicBezier:function(t,i,r,n,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);for(var c=[],h=0,l=0;l<s;l++){var u=Math.pow(1-h,3)*t.x+3*Math.pow(1-h,2)*h*i.x+3*(1-h)*h*h*r.x+h*h*h*n.x,d=Math.pow(1-h,3)*t.y+3*Math.pow(1-h,2)*h*i.y+3*(1-h)*h*h*r.y+h*h*h*n.y;c.push(e.p(u,d)),h+=1/s}c.push(e.p(n.x,n.y));var _=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);_.verts=c,_.lineWidth=o,_.lineColor=a,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},drawCatmullRom:function(t,e,i,r){this.drawCardinalSpline(t,.5,e,i,r)},drawCardinalSpline:function(t,i,r,n,s){n=n||this._lineWidth,s=s||this.getDrawColor(),null==s.a&&(s.a=255);for(var o,a,c=[],h=1/t.length,l=0;l<r+1;l++){var u=l/r;1===u?(o=t.length-1,a=1):(o=0|u/h,a=(u-h*o)/h);var d=e.cardinalSplineAt(e.getControlPointAt(t,o-1),e.getControlPointAt(t,o-0),e.getControlPointAt(t,o+1),e.getControlPointAt(t,o+2),i,a);c.push(d)}var _=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);_.verts=c,_.lineWidth=n,_.lineColor=s,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},drawDot:function(t,i,r){r=r||this.getDrawColor(),null==r.a&&(r.a=255);var n=new e._DrawNodeElement(e.DrawNode.TYPE_DOT);n.verts=[t],n.lineWidth=i,n.fillColor=r,this._buffer.push(n)},drawDots:function(t,e,i){if(t&&0!=t.length){i=i||this.getDrawColor(),null==i.a&&(i.a=255);for(var r=0,n=t.length;r<n;r++)this.drawDot(t[r],e,i)}},drawSegment:function(t,i,r,n){r=r||this._lineWidth,n=n||this.getDrawColor(),null==n.a&&(n.a=255);var s=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);s.verts=[t,i],s.lineWidth=2*r,s.lineColor=n,s.isStroke=!0,s.lineCap="round",this._buffer.push(s)},drawPoly_:function(t,i,r,n){r=null==r?this._lineWidth:r,n=n||this.getDrawColor(),null==n.a&&(n.a=255);var s=new e._DrawNodeElement(e.DrawNode.TYPE_POLY);s.verts=t,s.fillColor=i,s.lineWidth=r,s.lineColor=n,s.isClosePolygon=!0,s.isStroke=!0,s.lineCap="round",i&&(s.isFill=!0),this._buffer.push(s)},drawPoly:function(t,i,r,n){for(var s=[],o=0;o<t.length;o++)s.push(e.p(t[o].x,t[o].y));return this.drawPoly_(s,i,r,n)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new e.DrawNode.CanvasRenderCmd(this)}})):e._renderType===e.game.RENDER_TYPE_WEBGL&&e.js.mixin(e.DrawNode.prototype,{_bufferCapacity:0,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_dirty:!1,_className:"DrawNodeWebGL",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new e.BlendFunc(e.macro.SRC_ALPHA,e.macro.ONE_MINUS_SRC_ALPHA),this._drawColor=e.color(255,255,255,255),this.init()},init:function(){return!!_ccsg.Node.prototype.init.call(this)&&(this.shaderProgram=e.shaderCache.programForKey(e.macro.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=e._renderContext.createBuffer(),this._dirty=!0,!0)},drawRect:function(t,i,r,n,s){n=null==n?this._lineWidth:n,s=s||this.getDrawColor(),null==s.a&&(s.a=255);var o=[t,e.p(i.x,t.y),i,e.p(t.x,i.y)];null==r?this._drawSegments(o,n,s,!0):this.drawPoly(o,r,n,s)},drawCircle:function(t,i,r,n,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);var c,h,l=2*Math.PI/n,u=[];for(c=0;c<=n;c++){var d=c*l,_=i*Math.cos(d+r)+t.x,f=i*Math.sin(d+r)+t.y;u.push(e.p(_,f))}for(s&&u.push(e.p(t.x,t.y)),o*=.5,c=0,h=u.length;c<h-1;c++)this.drawSegment(u[c],u[c+1],o,a)},drawQuadBezier:function(t,i,r,n,s,o){s=s||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var a=[],c=0,h=0;h<n;h++){var l=Math.pow(1-c,2)*t.x+2*(1-c)*c*i.x+c*c*r.x,u=Math.pow(1-c,2)*t.y+2*(1-c)*c*i.y+c*c*r.y;a.push(e.p(l,u)),c+=1/n}a.push(e.p(r.x,r.y)),this._drawSegments(a,s,o,!1)},drawCubicBezier:function(t,i,r,n,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);for(var c=[],h=0,l=0;l<s;l++){var u=Math.pow(1-h,3)*t.x+3*Math.pow(1-h,2)*h*i.x+3*(1-h)*h*h*r.x+h*h*h*n.x,d=Math.pow(1-h,3)*t.y+3*Math.pow(1-h,2)*h*i.y+3*(1-h)*h*h*r.y+h*h*h*n.y;c.push(e.p(u,d)),h+=1/s}c.push(e.p(n.x,n.y)),this._drawSegments(c,o,a,!1)},drawCatmullRom:function(t,e,i,r){this.drawCardinalSpline(t,.5,e,i,r)},drawCardinalSpline:function(t,i,r,n,s){n=n||this._lineWidth,s=s||this.getDrawColor(),null==s.a&&(s.a=255);for(var o,a,c=[],h=1/t.length,l=0;l<r+1;l++){var u=l/r;1===u?(o=t.length-1,a=1):(o=0|u/h,a=(u-h*o)/h);var d=e.cardinalSplineAt(e.getControlPointAt(t,o-1),e.getControlPointAt(t,o-0),e.getControlPointAt(t,o+1),e.getControlPointAt(t,o+2),i,a);c.push(d)}n*=.5;for(var _=0,f=c.length;_<f-1;_++)this.drawSegment(c[_],c[_+1],n,s)},_render:function(){var t=e._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW),this._dirty=!1);var i=e.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.enableVertexAttribArray(e.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(e.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(e.macro.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(e.macro.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(e.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,i,8),t.vertexAttribPointer(e.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,i,12),t.drawArrays(t.TRIANGLES,0,3*this._buffer.length),e.incrementGLDraws(1)},_ensureCapacity:function(t){var i=this,r=i._buffer;if(r.length+t>i._bufferCapacity){var n=e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(i._bufferCapacity+=Math.max(i._bufferCapacity,t),null==r||0===r.length)i._buffer=[],i._trianglesArrayBuffer=new ArrayBuffer(n*i._bufferCapacity),i._trianglesReader=new Uint8Array(i._trianglesArrayBuffer);else{for(var s=[],o=new ArrayBuffer(n*i._bufferCapacity),a=0;a<r.length;a++)s[a]=new e.V2F_C4B_T2F_Triangle(r[a].a,r[a].b,r[a].c,o,a*n);i._trianglesReader=new Uint8Array(o),i._trianglesArrayBuffer=o,i._buffer=s}}},drawDot:function(t,i,r){r=r||this.getDrawColor(),null==r.a&&(r.a=255);var n={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},s={vertices:{x:t.x-i,y:t.y-i},colors:n,texCoords:{u:-1,v:-1}},o={vertices:{x:t.x-i,y:t.y+i},colors:n,texCoords:{u:-1,v:1}},a={vertices:{x:t.x+i,y:t.y+i},colors:n,texCoords:{u:1,v:1}},c={vertices:{x:t.x+i,y:t.y-i},colors:n,texCoords:{u:1,v:-1}};this._ensureCapacity(6),this._buffer.push(new e.V2F_C4B_T2F_Triangle(s,o,a,this._trianglesArrayBuffer,this._buffer.length*e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new e.V2F_C4B_T2F_Triangle(s,a,c,this._trianglesArrayBuffer,this._buffer.length*e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},drawDots:function(t,e,i){if(t&&0!==t.length){i=i||this.getDrawColor(),null==i.a&&(i.a=255);for(var r=0,n=t.length;r<n;r++)this.drawDot(t[r],e,i)}},drawSegment:function(t,i,r,n){n=n||this.getDrawColor(),null==n.a&&(n.a=255),r=r||.5*this._lineWidth;var s=18;this._ensureCapacity(s);var o={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a},a=e.v2(t),c=e.v2(i),h=e.pNormalize(e.pPerp(e.pSub(c,a))),l=e.pPerp(h),u=e.pMult(h,r),d=e.pMult(l,r),_=e.pSub(c,e.pAdd(u,d)),f=e.pAdd(c,e.pSub(u,d)),p=e.pSub(c,u),g=e.pAdd(c,u),m=e.pSub(a,u),v=e.pAdd(a,u),y=e.pSub(a,e.pSub(u,d)),C=e.pAdd(a,e.pAdd(u,d)),T=e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,E=this._trianglesArrayBuffer,x=this._buffer;x.push(new e.V2F_C4B_T2F_Triangle({vertices:_,colors:o,texCoords:F(e.pNeg(e.pAdd(h,l)))},{vertices:f,colors:o,texCoords:F(e.pSub(h,l))},{vertices:p,colors:o,texCoords:F(e.pNeg(h))},E,x.length*T)),x.push(new e.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:F(h)},{vertices:f,colors:o,texCoords:F(e.pSub(h,l))},{vertices:p,colors:o,texCoords:F(e.pNeg(h))},E,x.length*T)),x.push(new e.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:F(h)},{vertices:m,colors:o,texCoords:F(e.pNeg(h))},{vertices:p,colors:o,texCoords:F(e.pNeg(h))},E,x.length*T)),x.push(new e.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:F(h)},{vertices:m,colors:o,texCoords:F(e.pNeg(h))},{vertices:v,colors:o,texCoords:F(h)},E,x.length*T)),x.push(new e.V2F_C4B_T2F_Triangle({vertices:y,colors:o,texCoords:F(e.pSub(l,h))},{vertices:m,colors:o,texCoords:F(e.pNeg(h))},{vertices:v,colors:o,texCoords:F(h)},E,x.length*T)),x.push(new e.V2F_C4B_T2F_Triangle({vertices:y,colors:o,texCoords:F(e.pSub(l,h))},{vertices:C,colors:o,texCoords:F(e.pAdd(h,l))},{vertices:v,colors:o,texCoords:F(h)},E,x.length*T)),this._dirty=!0},drawPoly:function(t,i,r,n){if(null==i)return void this._drawSegments(t,r,n,!0);null==i.a&&(i.a=255),null==n.a&&(n.a=255),r=null==r?this._lineWidth:r,r*=.5;var s,o,a,c,h={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},l={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a},u=[],d=t.length;for(s=0;s<d;s++){o=e.v2(t[(s-1+d)%d]),a=e.v2(t[s]),c=e.v2(t[(s+1)%d]);var _=e.pNormalize(e.pPerp(e.pSub(a,o))),f=e.pNormalize(e.pPerp(e.pSub(c,a))),p=e.pMult(e.pAdd(_,f),1/(e.pDot(_,f)+1));u[s]={offset:p,n:f}}var g=r>0,m=3*d-2,v=3*m;this._ensureCapacity(v);var y=e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,C=this._trianglesArrayBuffer,T=this._buffer,E=0==g?.5:0;for(s=0;s<d-2;s++)o=e.pSub(e.v2(t[0]),e.pMult(u[0].offset,E)),a=e.pSub(e.v2(t[s+1]),e.pMult(u[s+1].offset,E)),c=e.pSub(e.v2(t[s+2]),e.pMult(u[s+2].offset,E)),T.push(new e.V2F_C4B_T2F_Triangle({vertices:o,colors:h,texCoords:F(e.v2())},{vertices:a,colors:h,texCoords:F(e.v2())},{vertices:c,colors:h,texCoords:F(e.v2())},C,T.length*y));for(s=0;s<d;s++){var x=(s+1)%d;o=e.v2(t[s]),a=e.v2(t[x]);var b=u[s].n,S=u[s].offset,A=u[x].offset,R=g?e.pSub(o,e.pMult(S,r)):e.pSub(o,e.pMult(S,.5)),O=g?e.pSub(a,e.pMult(A,r)):e.pSub(a,e.pMult(A,.5)),I=g?e.pAdd(o,e.pMult(S,r)):e.pAdd(o,e.pMult(S,.5)),w=g?e.pAdd(a,e.pMult(A,r)):e.pAdd(a,e.pMult(A,.5));g?(T.push(new e.V2F_C4B_T2F_Triangle({vertices:R,colors:l,texCoords:F(e.pNeg(b))},{vertices:O,colors:l,texCoords:F(e.pNeg(b))},{vertices:w,colors:l,texCoords:F(b)},C,T.length*y)),T.push(new e.V2F_C4B_T2F_Triangle({vertices:R,colors:l,texCoords:F(e.pNeg(b))},{vertices:I,colors:l,texCoords:F(b)},{vertices:w,colors:l,texCoords:F(b)},C,T.length*y))):(T.push(new e.V2F_C4B_T2F_Triangle({vertices:R,colors:h,texCoords:F(e.v2())},{vertices:O,colors:h,texCoords:F(e.v2())},{vertices:w,colors:h,texCoords:F(b)},C,T.length*y)),T.push(new e.V2F_C4B_T2F_Triangle({vertices:R,colors:h,texCoords:F(e.v2())},{vertices:I,colors:h,texCoords:F(b)},{vertices:w,colors:h,texCoords:F(b)},C,T.length*y)))}u=null,this._dirty=!0},_drawSegments:function(t,i,r,n){if(i=null==i?this._lineWidth:i,r=r||this._drawColor,null==r.a&&(r.a=255),i*=.5,!(i<=0)){var s,o,a,c,h={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},l=[],u=t.length;for(s=0;s<u;s++){o=e.v2(t[(s-1+u)%u]),a=e.v2(t[s]),c=e.v2(t[(s+1)%u]);var d=e.pNormalize(e.pPerp(e.pSub(a,o))),_=e.pNormalize(e.pPerp(e.pSub(c,a))),f=e.pMult(e.pAdd(d,_),1/(e.pDot(d,_)+1));l[s]={offset:f,n:_}}var p=3*u-2,g=3*p;this._ensureCapacity(g);var m=e.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,v=this._trianglesArrayBuffer,y=this._buffer,C=n?u:u-1;for(s=0;s<C;s++){var T=(s+1)%u;o=e.v2(t[s]),a=e.v2(t[T]);var E=l[s].n,x=l[s].offset,b=l[T].offset,S=e.pSub(o,e.pMult(x,i)),A=e.pSub(a,e.pMult(b,i)),R=e.pAdd(o,e.pMult(x,i)),O=e.pAdd(a,e.pMult(b,i));y.push(new e.V2F_C4B_T2F_Triangle({vertices:S,colors:h,texCoords:F(e.pNeg(E))},{vertices:A,colors:h,texCoords:F(e.pNeg(E))},{vertices:O,colors:h,texCoords:F(E)},v,y.length*m)),y.push(new e.V2F_C4B_T2F_Triangle({vertices:S,colors:h,texCoords:F(e.pNeg(E))},{vertices:R,colors:h,texCoords:F(E)},{vertices:O,colors:h,texCoords:F(E)},v,y.length*m))}l=null,this._dirty=!0}},clear:function(){this._buffer.length=0,this._dirty=!0},_createRenderCmd:function(){return new e.DrawNode.WebGLRenderCmd(this)}})}),e.DrawNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._buffer=null,this._drawColor=null,this._blendFunc=null},e.DrawNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype),e.DrawNode.CanvasRenderCmd.prototype.constructor=e.DrawNode.CanvasRenderCmd,e.js.mixin(e.DrawNode.CanvasRenderCmd.prototype,{rendering:function(t,i,r){var n=t||e._renderContext,s=(n.getContext(),this._node),o=s._displayedOpacity/255;if(0!==o){n.setTransform(this._worldTransform,i,r),n.setGlobalAlpha(o),this._blendFunc&&this._blendFunc.src===e.macro.SRC_ALPHA&&this._blendFunc.dst===e.macro.ONE&&n.setCompositeOperation("lighter");for(var a=this._buffer,c=0,h=a.length;c<h;c++){var l=a[c];switch(l.type){case e.DrawNode.TYPE_DOT:this._drawDot(n,l,i,r);break;case e.DrawNode.TYPE_SEGMENT:this._drawSegment(n,l,i,r);break;case e.DrawNode.TYPE_POLY:this._drawPoly(n,l,i,r)}}}},_drawDot:function(t,e,i,r){var n=e.fillColor,s=e.verts[0],o=e.lineWidth,a=t.getContext();t.setFillStyle("rgba("+(0|n.r)+","+(0|n.g)+","+(0|n.b)+","+n.a/255+")"),a.beginPath(),a.arc(s.x,-s.y,o,0,2*Math.PI,!1),a.closePath(),a.fill()},_drawSegment:function(t,e,i,r){var n=e.lineColor,s=e.verts[0],o=e.verts[1],a=e.lineWidth,c=e.lineCap,h=t.getContext();t.setStrokeStyle("rgba("+(0|n.r)+","+(0|n.g)+","+(0|n.b)+","+n.a/255+")"),h.lineWidth=a*i,h.beginPath(),h.lineCap=c,h.moveTo(s.x,-s.y),h.lineTo(o.x,-o.y),h.stroke()},_drawPoly:function(t,e,i,r){var n=e.verts,s=e.lineCap;if(null!=n){var o=e.fillColor,a=e.lineWidth,c=e.lineColor,h=e.isClosePolygon,l=e.isFill,u=e.isStroke,d=t.getContext(),_=n[0];d.lineCap=s,o&&t.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+","+o.a/255+")"),a&&(d.lineWidth=a*i),c&&t.setStrokeStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")"),d.beginPath(),d.moveTo(_.x,-_.y);for(var f=1,p=n.length;f<p;f++)d.lineTo(n[f].x,-n[f].y);h&&d.closePath(),l&&d.fill(),u&&d.stroke()}}}),e.DrawNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new e.math.Matrix4,this._matrix.identity()},e.DrawNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),e.DrawNode.WebGLRenderCmd.prototype.constructor=e.DrawNode.WebGLRenderCmd,e.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var i=this._node;if(i._buffer.length>0){var r=this._worldTransform,n=this._matrix.mat;n[0]=r.a,n[4]=r.c,n[12]=r.tx,n[1]=r.b,n[5]=r.d,n[13]=r.ty,e.gl.blendFunc(i._blendFunc.src,i._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),i._render()}},e.ClippingNode=_ccsg.Node.extend({alphaThreshold:0,inverted:!1,_stencil:null,_className:"ClippingNode",ctor:function(t){t=t||null,_ccsg.Node.prototype.ctor.call(this),this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},init:function(t){return this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits(),!0},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this),this._stencil.onEnter()},onEnterTransitionDidFinish:function(){_ccsg.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart(),_ccsg.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit(),_ccsg.Node.prototype.onExit.call(this)},getAlphaThreshold:function(){return this.alphaThreshold},setAlphaThreshold:function(t){this.alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&this._renderCmd.setStencil(t)},_createRenderCmd:function(){return e._renderType===e.game.RENDER_TYPE_CANVAS?new e.ClippingNode.CanvasRenderCmd(this):new e.ClippingNode.WebGLRenderCmd(this)}}),e.ClippingNode.stencilBits=-1;var g=e.ClippingNode.prototype;e.defineGetterSetter(g,"stencil",g.getStencil,g.setStencil),g.stencil,e.ClippingNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._rendererClipCmd=new e.CustomRenderCmd(this,this._drawStencilCommand),this._rendererRestoreCmd=new e.CustomRenderCmd(this,this._restoreCmdCallback)};var u=e.ClippingNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);u.constructor=e.ClippingNode.CanvasRenderCmd,u.initStencilBits=function(){},u.setStencil=function(t){null!=t&&(this._node._stencil=t,t instanceof e.DrawNode||e.error("only cc.DrawNode is accepted as stencil"))},u._restoreCmdCallback=function(t){var i=t||e._renderContext;i.restore()},u._drawStencilCommand=function(t,i,r){var n=t||e._renderContext,s=n.getContext();n.save(),s.beginPath(),n.setTransform(this._worldTransform,i,r);for(var o=this._node._stencil._buffer,a=0;a<o.length;++a){var c=o[a].verts;if(!(c.length<3)){s.moveTo(c[0].x,-c[0].y);for(var h=1;h<c.length;++h)s.lineTo(c[h].x,-c[h].y)}}s.clip()},u.visit=function(t){var i=this._node;if(this._propagateFlagsDown(t),i._visible){t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1),this._syncStatus(t),this._node._stencil&&e.renderer.pushRenderCommand(this._rendererClipCmd);var r,n=i._children,s=n.length;if(s>0)for(i.sortAllChildren(),r=0;r<s;r++)n[r]._renderCmd.visit(this);this._node._stencil&&e.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}},e.ClippingNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._beforeVisitCmd=new e.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new e.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new e.CustomRenderCmd(this,this._onAfterVisit),this._currentStencilEnabled=null,this._mask_layer_le=null};var u=e.ClippingNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);u.constructor=e.ClippingNode.WebGLRenderCmd,e.ClippingNode.WebGLRenderCmd._init_once=null,e.ClippingNode.WebGLRenderCmd._visit_once=null,e.ClippingNode.WebGLRenderCmd._layer=-1,u.initStencilBits=function(){e.ClippingNode.WebGLRenderCmd._init_once=!0,e.ClippingNode.WebGLRenderCmd._init_once&&(e.ClippingNode.stencilBits=e._renderContext.getParameter(e._renderContext.STENCIL_BITS),e.ClippingNode.stencilBits<=0&&e.log("Stencil buffer is not enabled."),e.ClippingNode.WebGLRenderCmd._init_once=!1)},u.transform=function(t,e){var i=this._node;this.originTransform(t,e),i._stencil&&i._stencil._renderCmd.transform(this,e)},u.visit=function(t){var i=this._node;if(this._propagateFlagsDown(t),i._visible){if(i._parent&&i._parent._renderCmd&&(this._curLevel=i._parent._renderCmd._curLevel+1),e.ClippingNode.stencilBits<1)return void this.originVisit(t);if(!i._stencil||!i._stencil.visible)return void(i.inverted&&this.originVisit(t));if(e.ClippingNode.WebGLRenderCmd._layer+1===e.ClippingNode.stencilBits)return e.ClippingNode.WebGLRenderCmd._visit_once=!0,e.ClippingNode.WebGLRenderCmd._visit_once&&(e.log("Nesting more than "+e.ClippingNode.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),e.ClippingNode.WebGLRenderCmd._visit_once=!1),void this.originVisit(t);e.renderer.pushRenderCommand(this._beforeVisitCmd);var r=e.current_stack;r.stack.push(r.top),this._syncStatus(t),r.top=this._stackMatrix,i._stencil._renderCmd.visit(this),e.renderer.pushRenderCommand(this._afterDrawStencilCmd);var n=i._children;if(n&&n.length>0){var s=n.length;i.sortAllChildren();for(var o=0;o<s;o++)n[o]._renderCmd.visit(this)}e.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0,r.top=r.stack.pop()}},u.setStencil=function(t){var e=this._node;e._stencil&&(e._stencil._parent=null),e._stencil=t,e._stencil&&(e._stencil._parent=e)},u._onBeforeVisit=function(t){var i=t||e._renderContext,r=this._node;e.ClippingNode.WebGLRenderCmd._layer++;var n=1<<e.ClippingNode.WebGLRenderCmd._layer,s=n-1;if(this._mask_layer_le=n|s,this._currentStencilEnabled=i.isEnabled(i.STENCIL_TEST),i.clear(i.DEPTH_BUFFER_BIT),i.enable(i.STENCIL_TEST),i.depthMask(!1),i.stencilFunc(i.NEVER,n,n),i.stencilOp(i.REPLACE,i.KEEP,i.KEEP),i.stencilMask(n),i.clear(i.STENCIL_BUFFER_BIT),r.alphaThreshold<1){var o=e.shaderCache.programForKey(e.macro.SHADER_POSITION_TEXTURECOLORALPHATEST);e.gl.useProgram(o.getProgram()),o.setUniformLocationWith1f(e.UNIFORM_ALPHA_TEST_VALUE_S,r.alphaThreshold),o.setUniformLocationWithMatrix4fv(e.UNIFORM_MVMATRIX_S,e.renderer.mat4Identity.mat),
a(r._stencil,o)}},u._onAfterDrawStencil=function(t){var i=t||e._renderContext;i.depthMask(!0),i.stencilFunc(this._node.inverted?i.NOTEQUAL:i.EQUAL,this._mask_layer_le,this._mask_layer_le),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)},u._onAfterVisit=function(t){var i=t||e._renderContext;if(e.ClippingNode.WebGLRenderCmd._layer--,this._currentStencilEnabled){var r=1<<e.ClippingNode.WebGLRenderCmd._layer,n=r-1,s=r|n;i.stencilMask(r),i.stencilFunc(i.EQUAL,s,s)}else i.disable(i.STENCIL_TEST)},_ccsg.WebView=_ccsg.Node.extend({ctor:function(){_ccsg.Node.prototype.ctor.call(this),this.setContentSize(e.size(300,200)),this._EventList={}},createDomElementIfNeeded:function(){this._renderCmd._div||this._renderCmd.createNativeControl()},setJavascriptInterfaceScheme:function(t){},loadData:function(t,e,i,r){},loadHTMLString:function(t,e){},loadURL:function(t){this._renderCmd.updateURL(t),this._dispatchEvent(_ccsg.WebView.EventType.LOADING)},stopLoading:function(){e.log("Web does not support loading")},reload:function(){var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.location.reload()}},canGoBack:function(){return e.log("Web does not support query history"),!0},canGoForward:function(){return e.log("Web does not support query history"),!0},goBack:function(){try{if(_ccsg.WebView._polyfill.closeHistory)return e.log("The current browser does not support the GoBack");var t=this._renderCmd._iframe;if(t){var i=t.contentWindow;i&&i.location&&i.history.back.call(i)}}catch(r){e.log(r)}},goForward:function(){try{if(_ccsg.WebView._polyfill.closeHistory)return e.log("The current browser does not support the GoForward");var t=this._renderCmd._iframe;if(t){var i=t.contentWindow;i&&i.location&&i.history.forward.call(i)}}catch(r){e.log(r)}},evaluateJS:function(t){var e=this._renderCmd._iframe;if(e){var i=e.contentWindow;try{i.eval(t),this._dispatchEvent(_ccsg.WebView.EventType.JS_EVALUATED)}catch(r){console.error(r)}}},setScalesPageToFit:function(){e.log("Web does not support zoom")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];e&&e.call(this,this,this._renderCmd._iframe.src)},_createRenderCmd:function(){return new _ccsg.WebView.RenderCmd(this)},setContentSize:function(t,e){void 0!==t.width&&void 0!==t.height&&(e=t.height,t=t.width),_ccsg.Node.prototype.setContentSize.call(this,t,e),this._renderCmd.updateSize(t,e)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.updateVisibility()}}),_ccsg.WebView.EventType={LOADING:0,LOADED:1,ERROR:2,JS_EVALUATED:3},function(){var t=_ccsg.WebView._polyfill={devicePixelRatio:!1,enableDiv:!1};e.sys.os===e.sys.OS_IOS&&(t.enableDiv=!0),e.sys.isMobile?e.sys.browserType===e.sys.BROWSER_TYPE_FIREFOX&&(t.enableBG=!0):e.sys.browserType===e.sys.BROWSER_TYPE_IE&&(t.closeHistory=!0)}(),function(t){var i;i=e._renderType===e.game.RENDER_TYPE_CANVAS?_ccsg.Node.CanvasRenderCmd:_ccsg.Node.WebGLRenderCmd,_ccsg.WebView.RenderCmd=function(t){i.call(this,t),this._parent=null,this._div=null,this._iframe=null,this._listener=null};var r=_ccsg.WebView.RenderCmd.prototype=Object.create(i.prototype);r.constructor=_ccsg.WebView.RenderCmd,r.transform=function(t,e){this.originTransform(t,e),this.updateMatrix()},r.updateStatus=function(){t.devicePixelRatio=e.view.isRetinaEnabled();var i=_ccsg.Node._dirtyFlags,r=this._dirtyFlag;r&i.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(),this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty^this._dirtyFlag)},r.initEvent=function(){var t=this._node;this._iframe.addEventListener("load",function(){t._dispatchEvent(_ccsg.WebView.EventType.LOADED)}),this._iframe.addEventListener("error",function(){t._dispatchEvent(_ccsg.WebView.EventType.ERROR)})},r.resize=function(t){t=t||e.view;var i=this._node,r=e.eventManager;if(i._parent&&i._visible)this.updateMatrix();else{var n=r._listenersMap[e.game.EVENT_RESIZE].getFixedPriorityListeners();r._removeListenerInVector(n,this._listener),this._listener=null}},r.updateMatrix=function(){if(this._div){var t=(this._node,e.view._scaleX),i=e.view._scaleY,r=e.view._devicePixelRatio,n=this._worldTransform;t/=r,i/=r;var s=e.game.container,o=n.a*t,a=n.b,c=n.c,h=n.d*i,l=s&&s.style.paddingLeft&&parseInt(s.style.paddingLeft),u=s&&s.style.paddingBottom&&parseInt(s.style.paddingBottom),d=n.tx*t+l,_=n.ty*i+u,f="matrix("+o+","+-a+","+-c+","+h+","+d+","+-_+")";this._div.style.transform=f,this._div.style["-webkit-transform"]=f,this._div.style["transform-origin"]="0px 100% 0px",this._div.style["-webkit-transform-origin"]="0px 100% 0px"}},r.initStyle=function(){if(this._div){var t=this._div;t.style.position="absolute",t.style.bottom="0px",t.style.left="0px"}},r.updateURL=function(t){var e=this._iframe;e.src=t;var i=this,r=function(){i._loaded=!0,i.updateVisibility(),e.removeEventListener("load",r)};e.addEventListener("load",r)},r.updateSize=function(t,e){var i=this._div;i&&(i.style.width=t+"px",i.style.height=e+"px")},r.createDom=function(){t.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._div.appendChild(this._iframe)):this._div=this._iframe=document.createElement("iframe"),t.enableBG&&(this._div.style.background="#FFF"),this._div.style.background="#FFF";var i=this._node._contentSize;this._div.style.height=i.height+"px",this._div.style.width=i.width+"px",this._div.style.overflow="scroll",this._div.style.border="none",e.game.container.appendChild(this._div)},r.createNativeControl=function(){this.createDom(),this.initStyle(),this.initEvent()},r.removeDom=function(){var t=this._div;if(t){var i=!1;i="contains"in e.game.container?e.game.container.contains(t):e.game.container.compareDocumentPosition(t)%16,i&&e.game.container.removeChild(t)}this._div=null},r.updateVisibility=function(){var t=this._node;if(this._div){var i=this._div;if(t.visible)i.style.visibility="visible",e.game.container.appendChild(i);else if(i.style.visibility="hidden",i){var r=!1;r="contains"in e.game.container?e.game.container.contains(i):e.game.container.compareDocumentPosition(i)%16,r&&e.game.container.removeChild(i)}}}}(_ccsg.WebView._polyfill)}).call(window,cc,ccui,ccs,cp)},{"../cocos2d/core/event/event-target":63}],4:[function(t,e,i){function r(t,e){a.call(this,t),this.animation=e}function n(t){var e=t.split(".");return e.shift(),e.length>0?e:null}function s(t,e){function i(t){if(!Array.isArray(t))return!1;for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!Array.isArray(r)||6!==r.length)return!1}return!0}function r(t,r,s){var a,a,u=t instanceof cc.Node&&"position"===r,d=[];a=u?new h:new c,a.target=t;var _,f,p=r.indexOf("."),g=p!==-1;g?(_=r.slice(0,p),f=t[_]):_=r,a.prop=_,a.subProps=n(r);for(var m=0,v=s.length;m<v;m++){var y=s[m],C=y.frame/e.duration;if(a.ratios.push(C),u){var T=y.motionPath;T&&!i(T)&&(cc.error("motion path of target ["+t.name+"] in prop ["+r+"] frame ["+m+"] is not valid"),T=null),d.push(T)}var E=y.value;a.values.push(E);var x=y.curve;if(x){if("string"==typeof x){a.types.push(x);continue}if(Array.isArray(x)){x[0]===x[1]&&x[2]===x[3]?a.types.push(c.Linear):a.types.push(c.Bezier(x));continue}}a.types.push(c.Linear)}return u&&l(d,a,o.duration,o.sample),a}function s(t,e){var i=e.props,n=e.comps;if(i)for(var s in i){var o=i[s],c=r(t,s,o);a.push(c)}if(n)for(var h in n){var l=t.getComponent(h);if(l){var u=n[h];for(var s in u){var o=u[s],c=r(l,s,o);a.push(c)}}}}var o=e.clip,a=e.curves;a.length=0,e.duration=o.duration,e.speed=o.speed,e.wrapMode=o.wrapMode,e.frameRate=o.sample,(e.wrapMode&_.Loop)===_.Loop?e.repeatCount=1/0:e.repeatCount=1;var p=o.curveData,g=p.paths;s(t,p);for(var m in g){var v=cc.find(m,t);if(v){var y=g[m];s(v,y)}}var C=o.events;if(C)for(var T,E=0,x=C.length;E<x;E++){T||(T=new u,T.target=t,a.push(T));var b,S=C[E],A=S.frame/e.duration,R=f(T.ratios,A);R>=0?b=T.events[R]:(b=new d,T.ratios.push(A),T.events.push(b)),b.add(S.func,S.params)}}var o=cc.js,a=t("./animators").Animator,c=t("./animation-curves").DynamicAnimCurve,h=t("./animation-curves").SampledAnimCurve,l=t("./motion-path-helper").sampleMotionPaths,u=t("./animation-curves").EventAnimCurve,d=t("./animation-curves").EventInfo,_=t("./types").WrapModeMask,f=t("./binary-search");o.extend(r,a);var p=r.prototype;p.playState=function(t,e){t.clip&&(t.curveLoaded||s(this.target,t),this.addAnimation(t),t.animator=this,t.play(),"number"==typeof e&&(t.time=e),this.play())},p.addAnimation=function(t){a.prototype.addAnimation.call(this,t);for(var e=this.animation._listeners,i=0,r=e.length;i<r;i++){var n=e[i];t.on(n[0],n[1],n[2],n[3])}},p.removeAnimation=function(t){for(var e=this.animation._listeners,i=0,r=e.length;i<r;i++){var n=e[i];t.off(n[0],n[1],n[2],n[3])}a.prototype.removeAnimation.call(this,t),t.animator=null},p.sample=function(){for(var t=this.playingAnims,e=0;e<t.length;e++){var i=t[e];i.sample()}},p.stopState=function(t){t&&t.stop()},p.pauseState=function(t){t&&t.pause()},p.resumeState=function(t){t&&t.resume(),this.isPaused&&this.resume()},p.setStateTime=function(t,e){t&&t.setTime(e)},p.onStop=function(){for(var t=this.playingAnims,e=t.length-1;e>=0;e--)t[e].stop();a.prototype.onStop.call(this)},p.onPause=function(){for(var t=this.playingAnims,e=0,i=t.length;e<i;e++)t[e].pause()},p.onResume=function(){for(var t=this.playingAnims,e=0,i=t.length;e<i;e++)t[e].resume()},p._reloadClip=function(t){s(this.target,t)},e.exports=r},{"./animation-curves":6,"./animators":9,"./binary-search":11,"./motion-path-helper":14,"./types":16}],5:[function(t,e,i){var r=cc.Class({name:"cc.AnimationClip","extends":cc.Asset,properties:{_duration:{"default":0,type:"Float"},duration:{get:function(){return this._duration}},sample:{"default":60},speed:{"default":1},wrapMode:{"default":cc.WrapMode.Normal},curveData:{"default":{},visible:!1},events:{"default":[],visible:!1}},statics:{createWithSpriteFrames:function(t,e){if(!Array.isArray(t))return cc.error("sprite frames must be an Array."),null;var i=new r;i.sample=e||i.sample,i._duration=t.length/i.sample;for(var n=[],s=1/i.sample,o=0,a=t.length;o<a;o++)n[o]={frame:o*s,value:t[o]};return i.curveData={comps:{"cc.Sprite":{spriteFrame:n}}},i}}});cc.AnimationClip=e.exports=r},{}],6:[function(t,e,i){function r(t,e){if("string"==typeof e){var i=cc.Easing[e];i?t=i(t):cc.error("Can't find easing type ["+e+"]")}else Array.isArray(e)&&(t=n(e,t));return t}var n=t("./bezier").bezierByTime,s=t("./binary-search"),o=t("./types").WrapModeMask,a=cc.Class({name:"cc.AnimCurve",sample:function(t,e,i){},onTimeChangedManually:function(){}}),c=cc.Class({name:"cc.DynamicAnimCurve","extends":a,properties:{target:null,prop:"",values:[],ratios:[],types:[],subProps:null},_calcValue:function(t,e){var i,r=this.values,n=r[t-1],s=r[t];return i="number"==typeof n?n+(s-n)*e:n&&n.lerp?n.lerp(s,e):n},_applyValue:function(t,e,i){t[e]=i},_findFrameIndex:s,sample:function(t,e,i){var n=this.values,s=this.ratios,o=s.length;if(0!==o){var a,c=this._findFrameIndex(s,e);if(c<0)if(c=~c,c<=0)a=n[0];else if(c>=o)a=n[o-1];else{var h=s[c-1],l=s[c],u=this.types[c-1],d=(e-h)/(l-h);d=r(d,u),a=this._calcValue(c,d)}else a=n[c];var _=this.subProps;if(_){for(var f=this.target[this.prop],p=f,g=0;g<_.length-1;g++){var m=_[g];if(!p)return;p=p[m]}var v=_[_.length-1];if(!p)return;this._applyValue(p,v,a),a=f}this._applyValue(this.target,this.prop,a)}}});c.Linear=null,c.Bezier=function(t){return t};var h=cc.Class({name:"cc.SampledAnimCurve","extends":c,_findFrameIndex:function(t,e){var i=t.length-1;if(0===i)return 0;var r=t[0];if(e<r)return 0;var n=t[i];if(e>n)return i;e=(e-r)/(n-r);var s=1/i,o=e/s,a=0|o,c=1e-6;return o-a<c?a:~(a+1)}}),l=function(){this.events=[]};l.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})};var u=cc.Class({name:"cc.EventAnimCurve","extends":a,properties:{target:null,ratios:[],events:[],_lastWrappedInfo:null},_wrapIterations:function(t){return t-(0|t)===0&&(t-=1),0|t},sample:function(t,e,i){var r=this.ratios.length,n=i.getWrappedInfo(i.time),a=n.direction,c=s(this.ratios,n.ratio);c<0&&(c=~c-1,a<0&&(c+=1));var h=this._lastWrappedInfo;if(n.frameIndex=c,this._lastWrappedInfo=n,!h)return void this._fireEvent(c);var l=h.frameIndex,u=i.wrapMode,d=this._wrapIterations(n.iterations),_=this._wrapIterations(h.iterations),f=_!==-1&&d!==_;if(l===c&&f&&1===r)this._fireEvent(0);else if(l!==c||f){a=h.direction;do{if(l!==c){if(a===-1&&0===l&&c>0?((u&o.PingPong)===o.PingPong?a*=-1:l=r,_++):1===a&&l===r-1&&c<r-1&&((u&o.PingPong)===o.PingPong?a*=-1:l=-1,_++),l===c)break;if(_>d)break}l+=a,this._fireEvent(l)}while(l!==c&&l>-1&&l<r)}},_fireEvent:function(t){if(!(t<0||t>=this.events.length))for(var e=this.events[t],i=e.events,r=this.target._components,n=0;n<i.length;n++)for(var s=i[n],o=s.func,a=0;a<r.length;a++){var c=r[a],h=c[o];h&&h.apply(c,s.params)}},onTimeChangedManually:function(){this._lastWrappedInfo=null}});e.exports={AnimCurve:a,DynamicAnimCurve:c,SampledAnimCurve:h,EventAnimCurve:u,EventInfo:l,computeRatioByType:r}},{"./bezier":10,"./binary-search":11,"./types":16}],7:[function(t,e,i){var r=(cc.js,cc.Class({ctor:function(){this.animators=[],this.__instanceId=cc.ClassManager.getNewInstanceId(),this._updating=!1,this._removeList=[]},update:function(t){this._updating=!0;var e,i,r=this.animators;for(e=0,i=r.length;e<i;e++){var n=r[e];n._isPlaying&&!n._isPaused&&n.update(t)}this._updating=!1;var s=this._removeList;for(e=0,i=s.length;e<i;e++)this.removeAnimator(s[e]);s.length=0},destruct:function(){},addAnimator:function(t){var e=this.animators.indexOf(t);e===-1&&this.animators.push(t),e=this._removeList.indexOf(t),e!==-1&&this._removeList.splice(e,1)},removeAnimator:function(t){var e=this.animators.indexOf(t);if(e>=0)if(this._updating){var i=this._removeList;i.indexOf(t)===-1&&i.push(t)}else this.animators.splice(e,1);else cc.error("animator not added or already removed")}}));cc.AnimationManager=e.exports=r},{}],8:[function(t,e,i){function r(t,e){s.call(this,null,null,{duration:t.length}),this._clip=t,this._name=e||t.name}var n=cc.js,s=t("./types").AnimationNode;n.extend(r,s);var o=r.prototype;n.get(o,"clip",function(){return this._clip}),n.get(o,"name",function(){return this._name}),n.obsolete(o,"AnimationState.length","duration"),n.getset(o,"curveLoaded",function(){return this.curves.length>0},function(){this.curves.length=0}),o.onPlay=function(){this.setTime(0),s.prototype.onPlay.call(this)},o.onStop=function(){s.prototype.onStop.call(this),this.animator&&this.animator.removeAnimation(this)},o.setTime=function(t){this.time=t||0,this.curves.forEach(function(t){t.onTimeChangedManually()})},cc.AnimationState=e.exports=r},{"./types":16}],9:[function(t,e,i){function r(t){this.target=t,this.playingAnims=[],this._updating=!1,this._removeList=[]}function n(t){r.call(this,t)}function s(t){for(var e=0,i=0,r=t.length,n=0;n<r;n++){var s=t[n],o=s.ratio;if(0===n&&"number"!=typeof o?s.computedRatio=o=0:n===r-1&&"number"!=typeof o&&(s.computedRatio=o=1),"number"==typeof o){if(e+1<n)for(var a=n-e,c=(o-i)/a,h=e+1;h<n;h++)i+=c,t[h].computedRatio=i;e=n,i=o}}}function o(t,e,i){for(var r,n=0;n<t.length;n++)if(r=t[n],r.target===e&&r.prop===i)return r;return null}function a(t,e,i,r,n){var s=o(t,e,i);s||(s=new u,t.push(s),s.target=e,s.prop=i),s.values.push(r),s.ratios.push(n)}var c=cc.js,h=t("./playable"),l=t("./types").AnimationNode,u=t("./animation-curves").DynamicAnimCurve;c.extend(r,h);var d=r.prototype;d.update=function(t){this._updating=!0;var e,i,r=this.playingAnims,n=0;for(e=0,i=r.length;e<i;e++){var s=r[e];s._isPlaying&&!s._isPaused&&(s.update(t),s._isPlaying||n++)}this._updating=!1,(0===r.length||n>=r.length)&&this.stop();var o=this._removeList;for(e=0,i=o.length;e<i;e++)this.removeAnimation(o[e]);o.length=0},d.onPlay=function(){cc.director.getAnimationManager().addAnimator(this)},d.onStop=function(){cc.director.getAnimationManager().removeAnimator(this)},d.addAnimation=function(t){var e=this.playingAnims.indexOf(t);e===-1&&this.playingAnims.push(t),e=this._removeList.indexOf(t),e!==-1&&this._removeList.splice(e,1)},d.removeAnimation=function(t){var e=this.playingAnims.indexOf(t);if(e>=0)if(this._updating){var i=this._removeList;i.indexOf(t)===-1&&i.push(t)}else this.playingAnims.splice(e,1);else cc.error("animation not added or already removed")},c.extend(n,r);var _=n.prototype;_.animate=function(t,e){if(!t)return cc.error("[animate] keyFrames must be non-nil"),null;s(t);var i=this._doAnimate(t,e);return this.play(),i},_._doAnimate=function(t,e){var i=new l(this,null,e);i.play();for(var r=i.curves,n=-1,s=0;s<t.length;s++){var o=t[s],c=o.ratio;if("number"!=typeof c&&(c=o.computedRatio),c<0)cc.error("[animate] ratio should >= 0!");else if(c<n)cc.error("[animate] ratio should in the order of smallest to largest!");else{n=c;for(var h in o){var u=o[h];if("props"===h)for(var d in u)a(r,this.target,d,u[d],c);else if("comps"===h)for(var _ in u){var f=this.target.getComponent(_),p=u[_];for(var d in p)a(r,f,d,p[d],c)}}}}return this.playingAnims.push(i),i},e.exports={Animator:r,EntityAnimator:n}},{"./animation-curves":6,"./playable":15,"./types":16}],10:[function(t,e,i){function r(t,e,i,r,n){var s=1-n;return t*s*s*s+3*e*s*s*n+3*i*s*n*n+r*n*n*n}function n(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function s(t,e){var i,r,s,o,l,_=e-0,f=e-t[0],p=e-t[2],g=e-1,m=3*_,v=3*f,y=3*p,C=-_+v-y+g,T=1/C,E=1/3,x=(m-6*f+y)*T,b=x*E,S=(-m+v)*T,A=_*T,R=(3*S-x*x)*E,O=R*E,I=(2*x*x*x-9*x*S+27*A)/27,w=I/2,P=w*w+O*O*O;if(P<0){var L=-R*E,N=L*L*L,F=d(N),D=-I/(2*F),M=D<-1?-1:D>1?1:D,B=c(M),U=n(F),V=2*U;return s=V*a(B*E)-b,o=V*a((B+u)*E)-b,l=V*a((B+2*u)*E)-b,0<=s&&s<=1?0<=o&&o<=1?0<=l&&l<=1?h(s,o,l):h(s,o):0<=l&&l<=1?h(s,l):s:0<=o&&o<=1?0<=l&&l<=1?h(o,l):o:l}if(0===P)return i=w<0?n(-w):-n(w),s=2*i-b,o=-i-b,0<=s&&s<=1?0<=o&&o<=1?h(s,o):s:o;var z=d(P);return i=n(-w+z),r=n(w+z),s=i-r-b}function o(t,e){var i=s(t,e),r=0,n=t[1],o=t[3],a=1,c=1-i;return r*c*c*c+3*n*i*c*c+3*o*i*i*c+a*i*i*i}var a=Math.cos,c=Math.acos,h=Math.max,l=Math.PI,u=2*l,d=Math.sqrt;e.exports={bezier:r,bezierByTime:o}},{}],11:[function(t,e,i){function r(t,e){for(var i=0,r=t.length-1;i<=r;){var s=i+r>>1;if(Math.abs(t[s]-e)<n)return s;t[s]>e?r=s-1:i=s+1}return~i}var n=1e-6;e.exports=r},{}],12:[function(t,e,i){function r(t,e){return function(i){return i<.5?e(2*i)/2:t(2*i-1)/2+.5}}var n={constant:function(){return 0},linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1,r=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=r/4):e=r*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r)))},elasticOut:function(t){var e,i=.1,r=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=r/4):e=r*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/r)+1)},elasticInOut:function(t){var e,i=.1,r=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=r/4):e=r*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r)):i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r)*.5+1)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},smooth:function(t){return t<=0?0:t>=1?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}};n.quadOutIn=r(n.quadIn,n.quadOut),n.cubicOutIn=r(n.cubicIn,n.cubicOut),n.quartOutIn=r(n.quartIn,n.quartOut),n.quintOutIn=r(n.quintIn,n.quintOut),n.sineOutIn=r(n.sineIn,n.sineOut),n.expoOutIn=r(n.expoIn,n.expoOut),n.circOutIn=r(n.circIn,n.circOut),n.backOutIn=r(n.backIn,n.backOut),n.backOutIn=r(n.backIn,n.backOut),n.bounceIn=function(t){return 1-n.bounceOut(1-t)},n.bounceInOut=function(t){return t<.5?.5*n.bounceIn(2*t):.5*n.bounceOut(2*t-1)+.5},n.bounceOutIn=r(n.bounceIn,n.bounceOut),cc.Easing=e.exports=n},{}],13:[function(t,e,i){t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animators"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")},{"./animation-animator":4,"./animation-clip":5,"./animation-curves":6,"./animation-manager":7,"./animation-state":8,"./animators":9,"./bezier":10,"./easing":12,"./motion-path-helper":14,"./types":16}],14:[function(t,e,i){function r(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function n(){this.start=l(),this.end=l(),this.startCtrlPoint=l(),this.endCtrlPoint=l()}function s(t,e,i,n){function s(t){return t instanceof cc.Vec2?{"in":t,pos:t,out:t}:Array.isArray(t)&&6===t.length?{"in":l(t[2],t[3]),pos:l(t[0],t[1]),out:l(t[4],t[5])}:{"in":cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}function c(t,e,i){f.push(t),p.push(e),g.push(i)}var u=e.values;if(0!==t.length&&0!==u.length){if(u=u.map(function(t){return l(t[0],t[1])}),1===u.length)return void(e.values=u);for(var d=e.types,_=e.ratios,f=e.values=[],p=e.types=[],g=e.ratios=[],m=0,v=1e-6,y=o.Linear,C=0,T=t.length;C<T-1;C++){var E,x=t[C],b=_[C],S=_[C+1],A=S-b,R=u[C],O=u[C+1],I=d[C],w=[],P=m/A,L=1/(A*i*n);if(x&&x.length>0){var N=[];N.push(s(R));for(var F=0,D=x.length;F<D;F++){var M=s(x[F]);N.push(M)}N.push(s(O));var B=new r(N);B.computeBeziers();for(var U=B.progresses;1-P>v;){E=P,E=a(E,I);var V,z,k,G;if(E<0)z=B.beziers[0],G=(0-E)*z.getLength(),k=z.start.sub(z.endCtrlPoint).normalize(),V=z.start.add(k.mul(G));else if(E>1)z=B.beziers[B.beziers.length-1],G=(E-1)*z.getLength(),k=z.end.sub(z.startCtrlPoint).normalize(),V=z.end.add(k.mul(G));else{var W=h(U,E);W<0&&(W=~W),E-=W>0?U[W-1]:0,E/=B.ratios[W],V=B.beziers[W].getPointAt(E)}w.push(V),P+=L}}else for(;1-P>v;)E=P,E=a(E,I),w.push(R.lerp(O,E)),P+=L;y="constant"===I?I:o.Linear;for(var F=0,D=w.length;F<D;F++){var j=b+m+L*F*A;c(w[F],y,j)}m=Math.abs(P-1)>v?(P-1)*A:0}_[_.length-1]!==g[g.length-1]&&c(u[u.length-1],y,_[_.length-1])}}var o=t("./animation-curves").DynamicAnimCurve,a=t("./animation-curves").computeRatioByType,c=t("./bezier").bezier,h=t("./binary-search"),l=cc.v2;r.prototype.computeBeziers=function(){this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var t,e=1;e<this.points.length;e++){var i=this.points[e-1],r=this.points[e];t=new n,t.start=i.pos,t.startCtrlPoint=i.out,t.end=r.pos,t.endCtrlPoint=r["in"],this.beziers.push(t),this.length+=t.getLength()}for(var s=0,e=0;e<this.beziers.length;e++)t=this.beziers[e],this.ratios[e]=t.getLength()/this.length,this.progresses[e]=s+=this.ratios[e];return this.beziers},n.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},n.prototype.getPoint=function(t){var e=c(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t),i=c(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new l(e,i)},n.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},n.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var e,i,r=[],n=this.getPoint(0),s=0;for(r.push(0),i=1;i<=t;i++)e=this.getPoint(i/t),s+=cc.pDistance(e,n),r.push(s),n=e;return this.cacheArcLengths=r,r},n.prototype.getUtoTmapping=function(t,e){var i,r=this.getLengths(),n=0,s=r.length;i=e?e:t*r[s-1];for(var o,a=0,c=s-1;a<=c;)if(n=Math.floor(a+(c-a)/2),o=r[n]-i,o<0)a=n+1;else{if(!(o>0)){c=n;break}c=n-1}if(n=c,r[n]===i){var h=n/(s-1);return h}var l=r[n],u=r[n+1],d=u-l,_=(i-l)/d,h=(n+_)/(s-1);return h},e.exports={sampleMotionPaths:s,Curve:r,Bezier:n}},{"./animation-curves":6,"./bezier":10,"./binary-search":11}],15:[function(t,e,i){function r(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var n=cc.js,s=r.prototype;n.get(s,"isPlaying",function(){return this._isPlaying},!0),n.get(s,"isPaused",function(){return this._isPaused},!0);var o=function(){};s.onPlay=o,s.onPause=o,s.onResume=o,s.onStop=o,s.onError=o,s.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError("already-playing"):(this._isPlaying=!0,this.onPlay())},s.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._isPaused=!1,this.onStop())},s.pause=function(){this._isPaused=!0,this.onPause()},s.resume=function(){this._isPaused=!1,this.onResume()},s.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.exports=r},{}],16:[function(t,e,i){function r(t,e,i){if(c.call(this),this.animator=t,this.curves=e||[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=a.Normal,i){this.delay=i.delay||this.delay;var r=i.duration;"undefined"!=typeof r&&(this.duration=r);var n=i.speed;"undefined"!=typeof n&&(this.speed=n);var s=i.wrapMode;if("undefined"!=typeof s){var h="number"==typeof s;h?this.wrapMode=s:this.wrapMode=a[s]}var l=i.repeatCount;"undefined"!=typeof l?this.repeatCount=l:this.wrapMode&o.Loop&&(this.repeatCount=1/0)}this.time=0,this._timeNoScale=0,this._firstFramePlayed=!1,this._duringDelay=!1,this.delay>0&&(this._duringDelay=!0)}var n=cc.js,s=t("./playable"),o={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},a=cc.Enum({Default:0,Normal:1,Reverse:o.Reverse,Loop:o.Loop,LoopReverse:o.Loop|o.Reverse,PingPong:o.PingPong,PingPongReverse:o.PingPong|o.Reverse});cc.WrapMode=a;var c=function(){s.call(this)};n.extend(c,s),c.prototype.update=function(t){},n.extend(r,c),n.mixin(r.prototype,{update:function(t){if(this._duringDelay){if(this._timeNoScale+=t,this._timeNoScale<this.delay)return;this._duringDelay=!1}this._firstFramePlayed?this.time+=t*this.speed:this._firstFramePlayed=!0;var e=this.sample();this._lastWrappedInfo||(this._lastWrappedInfo=e);var i=(0|e.iterations)>(0|this._lastWrappedInfo.iterations);this.repeatCount>1&&i&&((this.wrapMode&o.Reverse)===o.Reverse?this._lastWrappedInfo.direction<0&&this.emit("lastframe",this):this._lastWrappedInfo.direction>0&&this.emit("lastframe",this)),e.stopped&&(this.emit("finished",this),this.stop()),this._lastWrappedInfo=e},_needRevers:function(t){var e=this.wrapMode,i=!1;if((e&o.PingPong)===o.PingPong){var r=t-(0|t)===0;r&&t>0&&(t-=1);var n=1&t;n&&(i=!i)}return(e&o.Reverse)===o.Reverse&&(i=!i),i},getWrappedInfo:function(t){var e=!1,i=this.duration,r=0,n=this.wrapMode,s=Math.abs(t/i);s>this.repeatCount&&(s=this.repeatCount);var a=!1;n&o.ShouldWrap&&(a=this._needRevers(s));var c=a?-1:1;if(this.speed<0&&(c*=-1),s>=this.repeatCount){e=!0;var h=this.repeatCount-(0|this.repeatCount);0===h&&(h=1),t=h*i*(t>0?1:-1)}if(t>i){var l=t%i;t=0===l?i:l}else t<0&&(t%=i,0!==t&&(t+=i));return n&o.ShouldWrap&&a&&(t=i-t),r=t/i,{ratio:r,time:t,direction:c,stopped:e,iterations:s}},sample:function(){for(var t=this.getWrappedInfo(this.time),e=this.curves,i=0,r=e.length;i<r;i++){var n=e[i];n.sample(t.time,t.ratio,this)}return t},onStop:function(){this.emit("stop",this)},onPlay:function(){this.emit("play",this)},onPause:function(){this.emit("pause",this)},onResume:function(){this.emit("resume",this)}}),cc.defineGetterSetter(r.prototype,"wrapMode",function(){return this._wrapMode},function(t){this._wrapMode=t,this.time=0,t&o.Loop?this.repeatCount=1/0:this.repeatCount=1}),cc.js.mixin(r.prototype,cc.EventTarget.prototype),cc.AnimationNode=r,e.exports={WrapModeMask:o,WrapMode:a,AnimationNode:r}},{"./playable":15}],17:[function(t,e,i){var r=t("../core/platform/js");cc.Audio=function(t){this.src=t,this._element=null,this._AUDIO_TYPE="AUDIO"},cc.Audio.touchPlayList=[],cc.Audio.bindTouch=!1,cc.Audio.touchStart=function(){for(var t=cc.Audio.touchPlayList,e=null;e=t.pop();)e.audio.loop=!!e.loop,e.audio.play(e.offset)},cc.Audio.WebAudio=function(t){this.buffer=t,this.context=cc.sys.__audioSupport.context;var e=this.context.createGain();e.gain.value=1,e.connect(this.context.destination),this._volume=e,this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currextTimer=null},cc.Audio.WebAudio.prototype={constructor:cc.Audio.WebAudio,get paused(){return(!this._currentSource||!this._currentSource.loop)&&(this._startTime===-1||this.context.currentTime-this._startTime>this.buffer.duration)},get loop(){return this._loop},set loop(t){return this._loop=t},get volume(){return this._volume.gain.value},set volume(t){return this._volume.gain.value=t},get currentTime(){return this.playedLength},set currentTime(t){return this.playedLength=t},play:function(t){this._currentSource&&!this.paused&&(this._currentSource.stop(0),this.playedLength=0);var e=this.context.createBufferSource();e.buffer=this.buffer,e.connect(this._volume),e.loop=this._loop,this._startTime=this.context.currentTime,t=t||this.playedLength;var i=this.buffer.duration;if(this._loop?e.start?e.start(0):e.notoGrainOn?e.noteGrainOn(0):e.noteOn(0):e.start?e.start(0,t,i-t):e.notoGrainOn?e.noteGrainOn(0,t,i-t):e.noteOn(0,t,i-t),this._currentSource=e,0===this.context.currentTime){var r=this;clearTimeout(this._currextTimer),this._currextTimer=setTimeout(function(){0===r.context.currentTime&&cc.Audio.touchPlayList.push({offset:t,audio:r})},10)}},pause:function(){this.playedLength=this.context.currentTime-this._startTime,this.playedLength%=this.buffer.duration;var t=this._currentSource;this._currentSource=null,this._startTime=-1,t&&t.stop(0)}},r.mixin(cc.Audio.prototype,{setBuffer:function(t){this._AUDIO_TYPE="WEBAUDIO",this._element=new cc.Audio.WebAudio(t)},setElement:function(t){this._AUDIO_TYPE="AUDIO",this._element=t,t.addEventListener("ended",function(){t.loop||(t.paused=!0)})},play:function(t,e){this._element&&(this._element.loop=e,this._element.play(),"AUDIO"===this._AUDIO_TYPE&&this._element.paused&&(this.stop(),cc.Audio.touchPlayList.push({loop:e,offset:t,audio:this._element})),cc.Audio.bindTouch===!1&&(cc.Audio.bindTouch=!0,cc.game.canvas.addEventListener("touchstart",cc.Audio.touchStart)))},getPlaying:function(){return!this._element||!this._element.paused},stop:function(){if(this._element){this._element.pause();try{this._element.currentTime=0}catch(t){}}},pause:function(){this._element&&this._element.pause()},resume:function(){this._element&&this._element.play()},setVolume:function(t){this._element&&(this._element.volume=t)},getVolume:function(){if(this._element)return this._element.volume},cloneNode:function(){var t=new cc.Audio(this.src);if("AUDIO"===this._AUDIO_TYPE){for(var e=document.createElement("audio"),i=e.getElementsByTagName("source"),r=0;r<i.length;r++)e.appendChild(i[r]);e.src=this.src,t.setElement(e)}else t.setBuffer(this._element.buffer);return t}}),function(t){var e=t.WEB_AUDIO,i=t.ONLY_ONE;cc.audioEngine={_currMusic:null,_musicVolume:1,features:t,playMusic:function(t,e){var i=this._currMusic;i&&i.getPlaying()&&i.stop();
var r=cc.loader.getItem(t),n=r&&r.audio?r.audio:null;if(!n){var s=this;return cc.loader.load(t,function(i){if(!i){var r=cc.loader.getItem(t),n=r&&r.audio?r.audio:null;n.play(0,e||!1),n.setVolume(s._musicVolume),s._currMusic=n}}),r=cc.loader.getItem(t),r&&r.audio?r.audio:null}return n.play(0,e),n.setVolume(this._musicVolume),this._currMusic=n,n},stopMusic:function(t){var e=this._currMusic;e&&(e.stop(),t&&cc.loader.release(e.src))},pauseMusic:function(){var t=this._currMusic;t&&t.pause()},resumeMusic:function(){var t=this._currMusic;t&&t.resume()},rewindMusic:function(){var t=this._currMusic;t&&(t.stop(),t.play())},getMusicVolume:function(){return this._musicVolume},setMusicVolume:function(t){t-=0,isNaN(t)&&(t=1),t>1&&(t=1),t<0&&(t=0),this._musicVolume=t;var e=this._currMusic;e&&e.setVolume(t)},isMusicPlaying:function(){var t=this._currMusic;return!!t&&t.getPlaying()},_audioPool:{},_maxAudioInstance:10,_effectVolume:1,playEffect:function(t,r,n){if(n=void 0===n?this._effectVolume:n,i&&this._currMusic&&this._currMusic.getPlaying())return cc.log("Browser is only allowed to play one audio"),null;var s=this._audioPool[t];s||(s=this._audioPool[t]=[]);var o;for(o=0;o<s.length&&s[o].getPlaying();o++);if(!e&&o>this._maxAudioInstance){var a=s.shift();a.stop(),s.push(a),o=s.length-1}var c;if(s[o])return c=s[o],c.setVolume(n),c.play(0,r||!1),c;var h=cc.loader.getItem(t);return c=h&&h.audio?h.audio:null,e&&c&&"WEBAUDIO"!=c._AUDIO_TYPE&&(cc.loader.release(t),c=null),c?(c=c.cloneNode(),c.setVolume(n),c.play(0,r||!1),s.push(c),c):(cc.Audio.useWebAudio=!0,c=new cc.Audio(t),cc.loader.load(t,function(t,e){if(!t){var i=cc.loader.getItem(e),o=i&&i.audio?i.audio:null;"WEBAUDIO"===o._AUDIO_TYPE?c.setBuffer(o._element.buffer):c.setElement(o._element),c.setVolume(n),c.play(0,r||!1),s.push(c)}}),cc.Audio.useWebAudio=!1,c)},setEffectsVolume:function(t){t-=0,isNaN(t)&&(t=1),t>1&&(t=1),t<0&&(t=0),this._effectVolume=t;var e=this._audioPool;for(var i in e){var r=e[i];if(Array.isArray(r))for(var n=0;n<r.length;n++)r[n].setVolume(t)}},getEffectsVolume:function(){return this._effectVolume},pauseEffect:function(t){t&&t.pause()},pauseAllEffects:function(){var t=this._audioPool;for(var e in t)for(var i=t[e],r=0;r<t[e].length;r++)i[r].getPlaying()&&i[r].pause()},resumeEffect:function(t){t&&t.resume()},resumeAllEffects:function(){var t=this._audioPool;for(var e in t)for(var i=t[e],r=0;r<t[e].length;r++)i[r].resume()},stopEffect:function(t){t&&t.stop()},stopAllEffects:function(){var t=this._audioPool;for(var e in t)for(var i=t[e],r=0;r<t[e].length;r++)i[r].stop()},unloadEffect:function(t){if(t){cc.loader.release(t);var e=this._audioPool[t];e&&(e.length=0),delete this._audioPool[t]}},end:function(){this.stopMusic(),this.stopAllEffects()},_pauseCache:[],_pausePlaying:function(){var t=this._currMusic;t&&t.getPlaying()&&(t.pause(),this._pauseCache.push(t));var e=this._audioPool;for(var i in e)for(var r=e[i],n=0;n<e[i].length;n++)r[n].getPlaying()&&(r[n].pause(),this._pauseCache.push(r[n]))},_resumePlaying:function(){for(var t=this._pauseCache,e=0;e<t.length;e++)t[e].resume();t.length=0}}}(cc.sys.__audioSupport)},{"../core/platform/js":98}],18:[function(t,e,i){cc.Codec={name:"Jacob__Codec"},cc.Codec.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)},cc.Codec.unzipBase64=function(){var t=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);try{return cc.Codec.GZip.gunzip.call(cc.Codec.GZip,t)}catch(e){return t.slice(7)}},cc.Codec.unzipBase64AsArray=function(t,e){e=e||1;var i,r,n,s=this.unzipBase64(t),o=[];for(i=0,n=s.length/e;i<n;i++)for(o[i]=0,r=e-1;r>=0;--r)o[i]+=s.charCodeAt(i*e+r)<<8*r;return o},cc.Codec.unzipAsArray=function(t,e){e=e||1;var i,r,n,s=this.unzip(t),o=[];for(i=0,n=s.length/e;i<n;i++)for(o[i]=0,r=e-1;r>=0;--r)o[i]+=s.charCodeAt(i*e+r)<<8*r;return o}},{}],19:[function(t,e,i){cc.Codec.Base64={name:"Jacob__Codec__Base64"},cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cc.Codec.Base64.decode=function(t){var e,i,r,n,s,o,a,c=[],h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)n=this._keyStr.indexOf(t.charAt(h++)),s=this._keyStr.indexOf(t.charAt(h++)),o=this._keyStr.indexOf(t.charAt(h++)),a=this._keyStr.indexOf(t.charAt(h++)),e=n<<2|s>>4,i=(15&s)<<4|o>>2,r=(3&o)<<6|a,c.push(String.fromCharCode(e)),64!==o&&c.push(String.fromCharCode(i)),64!==a&&c.push(String.fromCharCode(r));return c=c.join("")},cc.Codec.Base64.decodeAsArray=function(t,e){var i,r,n,s=this.decode(t),o=[];for(i=0,n=s.length/e;i<n;i++)for(o[i]=0,r=e-1;r>=0;--r)o[i]+=s.charCodeAt(i*e+r)<<8*r;return o}},{}],20:[function(t,e,i){cc.Codec.GZip=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(cc.Codec.GZip.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0},cc.Codec.GZip.gunzip=function(t){t.constructor===Array||t.constructor===String;var e=new cc.Codec.GZip(t);return e.gunzip()[0][0]},cc.Codec.GZip.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},cc.Codec.GZip.LITERALS=288,cc.Codec.GZip.NAMEMAX=256,cc.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cc.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cc.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cc.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cc.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],cc.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],cc.Codec.GZip.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},cc.Codec.GZip.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},cc.Codec.GZip.prototype.byteAlign=function(){this.bb=1},cc.Codec.GZip.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},cc.Codec.GZip.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return t&&(e=cc.Codec.GZip.bitReverse[e]>>8-t),e},cc.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0},cc.Codec.GZip.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},cc.Codec.GZip.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},cc.Codec.GZip.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,t=this.IsPat(),t>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if(t=this.IsPat(),t>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},cc.Codec.GZip.prototype.CreateTree=function(t,e,i,r){var n;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,n=0;n<17;n++)this.fpos[n]=0;return this.len=0,this.Rec()?-1:0},cc.Codec.GZip.prototype.DecodeValue=function(t){for(var e,i,r,n=0,s=t[n];;)if(r=this.readBit()){if(!(32768&s.b1))return s.b1;for(s=s.jump,e=t.length,i=0;i<e;i++)if(t[i]===s){n=i;break}}else{if(!(32768&s.b0))return s.b0;n++,s=t[n]}return-1},cc.Codec.GZip.prototype.DeflateLoop=function(){var t,e,i,r,n;do if(t=this.readBit(),i=this.readBits(2),0===i){var s,o;for(this.byteAlign(),s=this.readByte(),s|=this.readByte()<<8,o=this.readByte(),o|=this.readByte()<<8,65535&(s^~o)&&document.write("BlockLen checksum mismatch\n");s--;)e=this.readByte(),this.addBuffer(e)}else if(1===i)for(var a;;)if(a=cc.Codec.GZip.bitReverse[this.readBits(7)]>>1,a>23?(a=a<<1|this.readBit(),a>199?(a-=128,a=a<<1|this.readBit()):(a-=48,a>143&&(a+=136))):a+=256,a<256)this.addBuffer(a);else{if(256===a)break;var n,c;for(a-=257,n=this.readBits(cc.Codec.GZip.cplext[a])+cc.Codec.GZip.cplens[a],a=cc.Codec.GZip.bitReverse[this.readBits(5)]>>3,cc.Codec.GZip.cpdext[a]>8?(c=this.readBits(8),c|=this.readBits(cc.Codec.GZip.cpdext[a]-8)<<8):c=this.readBits(cc.Codec.GZip.cpdext[a]),c+=cc.Codec.GZip.cpdist[a],a=0;a<n;a++){var e=this.buf32k[this.bIdx-c&32767];this.addBuffer(e)}}else if(2===i){var a,h,l,u,d,_=new Array(320);for(l=257+this.readBits(5),u=1+this.readBits(5),d=4+this.readBits(4),a=0;a<19;a++)_[a]=0;for(a=0;a<d;a++)_[cc.Codec.GZip.border[a]]=this.readBits(3);for(n=this.distanceTree.length,r=0;r<n;r++)this.distanceTree[r]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,_,0))return this.flushBuffer(),1;h=l+u,r=0;for(var f=-1;r<h;)if(f++,a=this.DecodeValue(this.distanceTree),a<16)_[r++]=a;else if(16===a){var p;if(a=3+this.readBits(2),r+a>h)return this.flushBuffer(),1;for(p=r?_[r-1]:0;a--;)_[r++]=p}else{if(a=17===a?3+this.readBits(3):11+this.readBits(7),r+a>h)return this.flushBuffer(),1;for(;a--;)_[r++]=0}for(n=this.literalTree.length,r=0;r<n;r++)this.literalTree[r]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,l,_,0))return this.flushBuffer(),1;for(n=this.literalTree.length,r=0;r<n;r++)this.distanceTree[r]=new cc.Codec.GZip.HufNode;var g=new Array;for(r=l;r<_.length;r++)g[r-l]=_[r];if(this.CreateTree(this.distanceTree,u,g,0))return this.flushBuffer(),1;for(;;)if(a=this.DecodeValue(this.literalTree),a>=256){var n,c;if(a-=256,0===a)break;for(a--,n=this.readBits(cc.Codec.GZip.cplext[a])+cc.Codec.GZip.cplens[a],a=this.DecodeValue(this.distanceTree),cc.Codec.GZip.cpdext[a]>8?(c=this.readBits(8),c|=this.readBits(cc.Codec.GZip.cpdext[a]-8)<<8):c=this.readBits(cc.Codec.GZip.cpdext[a]),c+=cc.Codec.GZip.cpdist[a];n--;){var e=this.buf32k[this.bIdx-c&32767];this.addBuffer(e)}}else this.addBuffer(a)}while(!t);return this.flushBuffer(),this.byteAlign(),0},cc.Codec.GZip.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},cc.Codec.GZip.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte();var i=this.readByte();i|=this.readByte()<<8,i|=this.readByte()<<16,i|=this.readByte()<<24;var r=this.readByte();r|=this.readByte()<<8,r|=this.readByte()<<16,r|=this.readByte()<<24;var n=this.readByte();n|=this.readByte()<<8;var s=this.readByte();for(s|=this.readByte()<<8,a=0,this.nameBuf=[];n--;){var o=this.readByte();"/"===o|":"===o?a=0:a<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[a++]=String.fromCharCode(o))}this.fileout||(this.fileout=this.nameBuf);for(var a=0;a<s;)o=this.readByte(),a++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},cc.Codec.GZip.prototype.skipdir=function(){var t,e,i,r,n,s=[];if(8&this.gpflags&&(s[0]=this.readByte(),s[1]=this.readByte(),s[2]=this.readByte(),s[3]=this.readByte(),t=this.readByte(),t|=this.readByte()<<8,t|=this.readByte()<<16,t|=this.readByte()<<24,e=this.readByte(),e|=this.readByte()<<8,e|=this.readByte()<<16,e|=this.readByte()<<24),this.modeZIP&&this.nextFile(),s[0]=this.readByte(),8!==s[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),i=this.readByte(),4&this.gpflags)for(s[0]=this.readByte(),s[2]=this.readByte(),this.len=s[0]+256*s[1],r=0;r<this.len;r++)this.readByte();if(8&this.gpflags)for(r=0,this.nameBuf=[];n=this.readByte();)"7"!==n&&":"!==n||(r=0),r<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[r++]=n);if(16&this.gpflags)for(;n=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),e=this.readByte(),e|=this.readByte()<<8,e|=this.readByte()<<16,e|=this.readByte()<<24,this.modeZIP&&this.nextFile()}},{}],21:[function(t,e,i){t("./ZipUtils"),t("./base64"),t("./gzip"),t("./zlib.min")},{"./ZipUtils":18,"./base64":19,"./gzip":20,"./zlib.min":22}],22:[function(t,e,i){(function(){"use strict";function t(t){throw t}function e(t,e){var i=t.split("."),r=C;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(var n;i.length&&(n=i.shift());)i.length||e===v?r=r[n]?r[n]:r[n]={}:r[n]=e}function i(t){if("string"==typeof t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;t=r}for(var n,s=1,o=0,a=t.length,c=0;0<a;){n=1024<a?1024:a,a-=n;do s+=t[c++],o+=s;while(--n);s%=65521,o%=65521}return(o<<16|s)>>>0}function r(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(T?Uint8Array:Array)?e:new(T?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function n(t){this.buffer=new(T?Uint16Array:Array)(2*t),this.length=0}function s(t){var e,i,r,n,s,o,a,c,h,l=t.length,u=0,d=Number.POSITIVE_INFINITY;for(c=0;c<l;++c)t[c]>u&&(u=t[c]),t[c]<d&&(d=t[c]);for(e=1<<u,i=new(T?Uint32Array:Array)(e),r=1,n=0,s=2;r<=u;){for(c=0;c<l;++c)if(t[c]===r){for(o=0,a=n,h=0;h<r;++h)o=o<<1|1&a,a>>=1;for(h=o;h<e;h+=s)i[h]=r<<16|c;++n}++r,n<<=1,s<<=1}return[i,u,d]}function o(t,e){this.h=w,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=T&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(T?Uint8Array:Array)(32768))}function a(t,e){this.length=t,this.G=e}function c(){var e=N;switch(y){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}function h(e,i){function r(e,i){var r,n=e.G,s=[],o=0;r=M[e.length],s[o++]=65535&r,s[o++]=r>>16&255,s[o++]=r>>24;var a;switch(y){case 1===n:a=[0,n-1,0];break;case 2===n:a=[1,n-2,0];break;case 3===n:a=[2,n-3,0];break;case 4===n:a=[3,n-4,0];break;case 6>=n:a=[4,n-5,1];break;case 8>=n:a=[5,n-7,1];break;case 12>=n:a=[6,n-9,2];break;case 16>=n:a=[7,n-13,2];break;case 24>=n:a=[8,n-17,3];break;case 32>=n:a=[9,n-25,3];break;case 48>=n:a=[10,n-33,4];break;case 64>=n:a=[11,n-49,4];break;case 96>=n:a=[12,n-65,5];break;case 128>=n:a=[13,n-97,5];break;case 192>=n:a=[14,n-129,6];break;case 256>=n:a=[15,n-193,6];break;case 384>=n:a=[16,n-257,7];break;case 512>=n:a=[17,n-385,7];break;case 768>=n:a=[18,n-513,8];break;case 1024>=n:a=[19,n-769,8];break;case 1536>=n:a=[20,n-1025,9];break;case 2048>=n:a=[21,n-1537,9];break;case 3072>=n:a=[22,n-2049,10];break;case 4096>=n:a=[23,n-3073,10];break;case 6144>=n:a=[24,n-4097,11];break;case 8192>=n:a=[25,n-6145,11];break;case 12288>=n:a=[26,n-8193,12];break;case 16384>=n:a=[27,n-12289,12];break;case 24576>=n:a=[28,n-16385,13];break;case 32768>=n:a=[29,n-24577,13];break;default:t("invalid distance")}r=a,s[o++]=r[0],s[o++]=r[1],s[o++]=r[2];var c,h;for(c=0,h=s.length;c<h;++c)p[g++]=s[c];C[s[0]]++,E[s[3]]++,m=e.length+i-1,d=null}var n,s,o,c,h,l,u,d,_,f={},p=T?new Uint16Array(2*i.length):[],g=0,m=0,C=new(T?Uint32Array:Array)(286),E=new(T?Uint32Array:Array)(30),x=e.w;if(!T){for(o=0;285>=o;)C[o++]=0;for(o=0;29>=o;)E[o++]=0}for(C[256]=1,n=0,s=i.length;n<s;++n){for(o=h=0,c=3;o<c&&n+o!==s;++o)h=h<<8|i[n+o];if(f[h]===v&&(f[h]=[]),l=f[h],!(0<m--)){for(;0<l.length&&32768<n-l[0];)l.shift();if(n+3>=s){for(d&&r(d,-1),o=0,c=s-n;o<c;++o)_=i[n+o],p[g++]=_,++C[_];break}if(0<l.length){var b=v,S=v,A=0,R=v,O=v,I=v,w=v,P=i.length,O=0,w=l.length;t:for(;O<w;O++){if(b=l[w-O-1],R=3,3<A){for(I=A;3<I;I--)if(i[b+I-1]!==i[n+I-1])continue t;R=A}for(;258>R&&n+R<P&&i[b+R]===i[n+R];)++R;if(R>A&&(S=b,A=R),258===R)break}u=new a(A,n-S),d?d.length<u.length?(_=i[n-1],p[g++]=_,++C[_],r(u,0)):r(d,-1):u.length<x?d=u:r(u,0)}else d?r(d,-1):(_=i[n],p[g++]=_,++C[_])}l.push(n)}return p[g++]=256,C[256]++,e.L=C,e.K=E,T?p.subarray(0,g):p}function l(t,e){function i(t){var e=x[t][b[t]];e===m?(i(t+1),i(t+1)):--C[e],++b[t]}var r,s,o,a,c,h=t.length,l=new n(572),u=new(T?Uint8Array:Array)(h);if(!T)for(a=0;a<h;a++)u[a]=0;for(a=0;a<h;++a)0<t[a]&&l.push(a,t[a]);if(r=Array(l.length/2),s=new(T?Uint32Array:Array)(l.length/2),1===r.length)return u[l.pop().index]=1,u;for(a=0,c=l.length/2;a<c;++a)r[a]=l.pop(),s[a]=r[a].value;var d,_,f,p,g,m=s.length,v=new(T?Uint16Array:Array)(e),y=new(T?Uint8Array:Array)(e),C=new(T?Uint8Array:Array)(m),E=Array(e),x=Array(e),b=Array(e),S=(1<<e)-m,A=1<<e-1;for(v[e-1]=m,_=0;_<e;++_)S<A?y[_]=0:(y[_]=1,S-=A),S<<=1,v[e-2-_]=(v[e-1-_]/2|0)+m;for(v[0]=y[0],E[0]=Array(v[0]),x[0]=Array(v[0]),_=1;_<e;++_)v[_]>2*v[_-1]+y[_]&&(v[_]=2*v[_-1]+y[_]),E[_]=Array(v[_]),x[_]=Array(v[_]);for(d=0;d<m;++d)C[d]=e;for(f=0;f<v[e-1];++f)E[e-1][f]=s[f],x[e-1][f]=f;for(d=0;d<e;++d)b[d]=0;for(1===y[e-1]&&(--C[0],++b[e-1]),_=e-2;0<=_;--_){for(p=d=0,g=b[_+1],f=0;f<v[_];f++)p=E[_+1][g]+E[_+1][g+1],p>s[d]?(E[_][f]=p,x[_][f]=m,g+=2):(E[_][f]=s[d],x[_][f]=d,++d);b[_]=0,1===y[_]&&i(_)}for(o=C,a=0,c=r.length;a<c;++a)u[r[a].index]=o[a];return u}function u(e){var i,r,n,s,o=new(T?Uint16Array:Array)(e.length),a=[],c=[],h=0;for(i=0,r=e.length;i<r;i++)a[e[i]]=(0|a[e[i]])+1;for(i=1,r=16;i<=r;i++)c[i]=h,h+=0|a[i],h>1<<i&&t("overcommitted"),h<<=1;for(65536>h&&t("undercommitted"),i=0,r=e.length;i<r;i++)for(h=c[e[i]],c[e[i]]+=1,n=o[i]=0,s=e[i];n<s;n++)o[i]=o[i]<<1|1&h,h>>>=1;return o}function d(t,e){this.input=t,this.a=new(T?Uint8Array:Array)(32768),this.h=B.j;var i,r={};!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType);for(i in e)r[i]=e[i];r.outputBuffer=this.a,this.z=new o(this.input,r)}function _(e,i){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=T?new Uint8Array(e):e,this.s=!1,this.m=V,this.B=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize)),this.m){case U:this.b=32768,this.a=new(T?Uint8Array:Array)(32768+this.l+258);break;case V:this.b=0,this.a=new(T?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}function f(e,i){for(var r,n=e.g,s=e.e,o=e.input,a=e.c;s<i;)r=o[a++],r===v&&t(Error("input buffer is broken")),n|=r<<s,s+=8;return r=n&(1<<i)-1,e.g=n>>>i,e.e=s-i,e.c=a,r}function p(e,i){for(var r,n,s,o=e.g,a=e.e,c=e.input,h=e.c,l=i[0],u=i[1];a<u;)r=c[h++],r===v&&t(Error("input buffer is broken")),o|=r<<a,a+=8;return n=l[o&(1<<u)-1],s=n>>>16,e.g=o>>s,e.e=a-s,e.c=h,65535&n}function g(t){function e(t,e,i){var r,n,s,o;for(o=0;o<t;)switch(r=p(this,e)){case 16:for(s=3+f(this,2);s--;)i[o++]=n;break;case 17:for(s=3+f(this,3);s--;)i[o++]=0;n=0;break;case 18:for(s=11+f(this,7);s--;)i[o++]=0;n=0;break;default:n=i[o++]=r}return i}var i,r,n,o,a=f(t,5)+257,c=f(t,5)+1,h=f(t,4)+4,l=new(T?Uint8Array:Array)(j.length);for(o=0;o<h;++o)l[j[o]]=f(t,3);i=s(l),r=new(T?Uint8Array:Array)(a),n=new(T?Uint8Array:Array)(c),t.o(s(e.call(t,a,i,r)),s(e.call(t,c,i,n)))}function m(e,i){var r,n;switch(this.input=e,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.M=i.verify)),r=e[this.c++],n=e[this.c++],15&r){case gt:this.method=gt;break;default:t(Error("unsupported compression method"))}0!==((r<<8)+n)%31&&t(Error("invalid fcheck flag:"+((r<<8)+n)%31)),32&n&&t(Error("fdict flag is not supported")),this.A=new _(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}var v=void 0,y=!0,C=this,T="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;r.prototype.f=function(){var t,e=this.buffer,i=e.length,r=new(T?Uint8Array:Array)(i<<1);if(T)r.set(e);else for(t=0;t<i;++t)r[t]=e[t];return this.buffer=r},r.prototype.d=function(t,e,i){var r,n=this.buffer,s=this.index,o=this.i,a=n[s];if(i&&1<e&&(t=8<e?(R[255&t]<<24|R[t>>>8&255]<<16|R[t>>>16&255]<<8|R[t>>>24&255])>>32-e:R[t]>>8-e),8>e+o)a=a<<e|t,o+=e;else for(r=0;r<e;++r)a=a<<1|t>>e-r-1&1,8===++o&&(o=0,n[s++]=R[a],a=0,s===n.length&&(n=this.f()));n[s]=a,this.buffer=n,this.i=o,this.index=s},r.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=R[e[i]],i++),T?t=e.subarray(0,i):(e.length=i,t=e),t};var E,x=new(T?Uint8Array:Array)(256);for(E=0;256>E;++E){for(var b=E,S=b,A=7,b=b>>>1;b;b>>>=1)S<<=1,S|=1&b,--A;x[E]=(S<<A&255)>>>0}var R=x,O=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];T&&new Uint32Array(O),n.prototype.getParent=function(t){return 2*((t-2)/4|0)},n.prototype.push=function(t,e){var i,r,n,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;0<i&&(r=this.getParent(i),s[i]>s[r]);)n=s[i],s[i]=s[r],s[r]=n,n=s[i+1],s[i+1]=s[r+1],s[r+1]=n,i=r;return this.length},n.prototype.pop=function(){var t,e,i,r,n,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],n=0;(r=2*n+2,!(r>=this.length))&&(r+2<this.length&&s[r+2]>s[r]&&(r+=2),s[r]>s[n]);)i=s[n],s[n]=s[r],s[r]=i,i=s[n+1],s[n+1]=s[r+1],s[r+1]=i,n=r;return{index:t,value:e,length:this.length}};var I,w=2,P={NONE:0,r:1,j:w,N:3},L=[];for(I=0;288>I;I++)switch(y){case 143>=I:L.push([I+48,8]);break;case 255>=I:L.push([I-144+400,9]);break;case 279>=I:L.push([I-256+0,7]);break;case 287>=I:L.push([I-280+192,8]);break;default:t("invalid literal: "+I)}o.prototype.n=function(){var e,i,n,s,o=this.input;switch(this.h){case 0:for(n=0,s=o.length;n<s;){i=T?o.subarray(n,n+65535):o.slice(n,n+65535),n+=i.length;var a=i,c=n===s,d=v,_=v,f=v,p=v,g=v,m=this.a,C=this.b;if(T){for(m=new Uint8Array(this.a.buffer);m.length<=C+a.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}if(d=c?1:0,m[C++]=0|d,_=a.length,f=~_+65536&65535,m[C++]=255&_,m[C++]=_>>>8&255,m[C++]=255&f,m[C++]=f>>>8&255,T)m.set(a,C),C+=a.length,m=m.subarray(0,C);else{for(p=0,g=a.length;p<g;++p)m[C++]=a[p];m.length=C}this.b=C,this.a=m}break;case 1:var E=new r(new Uint8Array(this.a.buffer),this.b);E.d(1,1,y),E.d(1,2,y);var x,b,S,A=h(this,o);for(x=0,b=A.length;x<b;x++)if(S=A[x],r.prototype.d.apply(E,L[S]),256<S)E.d(A[++x],A[++x],y),E.d(A[++x],5),E.d(A[++x],A[++x],y);else if(256===S)break;this.a=E.finish(),this.b=this.a.length;break;case w:var R,O,I,P,N,F,D,M,B,U,V,z,k,G,W,j=new r(new Uint8Array(this.a),this.b),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=Array(19);for(R=w,j.d(1,1,y),j.d(R,2,y),O=h(this,o),F=l(this.L,15),D=u(F),M=l(this.K,7),B=u(M),I=286;257<I&&0===F[I-1];I--);for(P=30;1<P&&0===M[P-1];P--);var H,q,Q,Z,K,J,$=I,tt=P,et=new(T?Uint32Array:Array)($+tt),it=new(T?Uint32Array:Array)(316),rt=new(T?Uint8Array:Array)(19);for(H=q=0;H<$;H++)et[q++]=F[H];for(H=0;H<tt;H++)et[q++]=M[H];if(!T)for(H=0,Z=rt.length;H<Z;++H)rt[H]=0;for(H=K=0,Z=et.length;H<Z;H+=q){for(q=1;H+q<Z&&et[H+q]===et[H];++q);if(Q=q,0===et[H])if(3>Q)for(;0<Q--;)it[K++]=0,rt[0]++;else for(;0<Q;)J=138>Q?Q:138,J>Q-3&&J<Q&&(J=Q-3),10>=J?(it[K++]=17,it[K++]=J-3,rt[17]++):(it[K++]=18,it[K++]=J-11,rt[18]++),Q-=J;else if(it[K++]=et[H],rt[et[H]]++,Q--,3>Q)for(;0<Q--;)it[K++]=et[H],rt[et[H]]++;else for(;0<Q;)J=6>Q?Q:6,J>Q-3&&J<Q&&(J=Q-3),it[K++]=16,it[K++]=J-3,rt[16]++,Q-=J}for(e=T?it.subarray(0,K):it.slice(0,K),U=l(rt,7),G=0;19>G;G++)Y[G]=U[X[G]];for(N=19;4<N&&0===Y[N-1];N--);for(V=u(U),j.d(I-257,5,y),j.d(P-1,5,y),j.d(N-4,4,y),G=0;G<N;G++)j.d(Y[G],3,y);for(G=0,W=e.length;G<W;G++)if(z=e[G],j.d(V[z],U[z],y),16<=z){switch(G++,z){case 16:k=2;break;case 17:k=3;break;case 18:k=7;break;default:t("invalid code: "+z)}j.d(e[G],k,y)}var nt,st,ot,at,ct,ht,lt,ut,dt=[D,F],_t=[B,M];for(ct=dt[0],ht=dt[1],lt=_t[0],ut=_t[1],nt=0,st=O.length;nt<st;++nt)if(ot=O[nt],j.d(ct[ot],ht[ot],y),256<ot)j.d(O[++nt],O[++nt],y),at=O[++nt],j.d(lt[at],ut[at],y),j.d(O[++nt],O[++nt],y);else if(256===ot)break;this.a=j.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var N,F,D=[];for(N=3;258>=N;N++)F=c(),D[N]=F[2]<<24|F[1]<<16|F[0];var M=T?new Uint32Array(D):D,B=P;d.prototype.n=function(){var e,r,n,s,o,a,c,h=0;switch(c=this.a,e=gt){case gt:r=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(n=r<<4|e,c[h++]=n,e){case gt:switch(this.h){case B.NONE:o=0;break;case B.r:o=1;break;case B.j:o=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return s=o<<6|0,c[h++]=s|31-(256*n+s)%31,a=i(this.input),this.z.b=h,c=this.z.n(),h=c.length,T&&(c=new Uint8Array(c.buffer),c.length<=h+4&&(this.a=new Uint8Array(c.length+4),this.a.set(c),c=this.a),c=c.subarray(0,h+4)),c[h++]=a>>24&255,c[h++]=a>>16&255,c[h++]=a>>8&255,c[h++]=255&a,c},e("Zlib.Deflate",d),e("Zlib.Deflate.compress",function(t,e){return new d(t,e).n()}),e("Zlib.Deflate.CompressionType",B),e("Zlib.Deflate.CompressionType.NONE",B.NONE),e("Zlib.Deflate.CompressionType.FIXED",B.r),e("Zlib.Deflate.CompressionType.DYNAMIC",B.j);var U=0,V=1,z={D:U,C:V};_.prototype.p=function(){for(;!this.s;){var e=f(this,3);switch(1&e&&(this.s=y),e>>>=1){case 0:var i=this.input,r=this.c,n=this.a,s=this.b,o=v,a=v,c=v,h=n.length,l=v;switch(this.e=this.g=0,o=i[r++],o===v&&t(Error("invalid uncompressed block header: LEN (first byte)")),a=o,o=i[r++],o===v&&t(Error("invalid uncompressed block header: LEN (second byte)")),a|=o<<8,o=i[r++],o===v&&t(Error("invalid uncompressed block header: NLEN (first byte)")),c=o,o=i[r++],o===v&&t(Error("invalid uncompressed block header: NLEN (second byte)")),c|=o<<8,a===~c&&t(Error("invalid uncompressed block header: length verify")),r+a>i.length&&t(Error("input buffer is broken")),this.m){case U:for(;s+a>n.length;){if(l=h-s,a-=l,T)n.set(i.subarray(r,r+l),s),s+=l,r+=l;else for(;l--;)n[s++]=i[r++];this.b=s,n=this.f(),s=this.b}break;case V:for(;s+a>n.length;)n=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(T)n.set(i.subarray(r,r+a),s),s+=a,r+=a;else for(;a--;)n[s++]=i[r++];this.c=r,this.b=s,this.a=n;break;case 1:this.o(it,nt);break;case 2:g(this);break;default:t(Error("unknown BTYPE: "+e))}}return this.t()};var k,G,W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=T?new Uint16Array(W):W,X=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],Y=T?new Uint16Array(X):X,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],q=T?new Uint8Array(H):H,Q=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Z=T?new Uint16Array(Q):Q,K=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=T?new Uint8Array(K):K,$=new(T?Uint8Array:Array)(288);for(k=0,G=$.length;k<G;++k)$[k]=143>=k?8:255>=k?9:279>=k?7:8;var tt,et,it=s($),rt=new(T?Uint8Array:Array)(30);for(tt=0,et=rt.length;tt<et;++tt)rt[tt]=5;var nt=s(rt);_.prototype.o=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,s,o,a,c=i.length-258;256!==(n=p(this,t));)if(256>n)r>=c&&(this.b=r,i=this.f(),r=this.b),i[r++]=n;else for(s=n-257,a=Y[s],0<q[s]&&(a+=f(this,q[s])),n=p(this,e),o=Z[n],0<J[n]&&(o+=f(this,J[n])),r>=c&&(this.b=r,i=this.f(),r=this.b);a--;)i[r]=i[r++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},_.prototype.I=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,s,o,a,c=i.length;256!==(n=p(this,t));)if(256>n)r>=c&&(i=this.f(),
c=i.length),i[r++]=n;else for(s=n-257,a=Y[s],0<q[s]&&(a+=f(this,q[s])),n=p(this,e),o=Z[n],0<J[n]&&(o+=f(this,J[n])),r+a>c&&(i=this.f(),c=i.length);a--;)i[r]=i[r++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},_.prototype.f=function(){var t,e,i=new(T?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.a;if(T)i.set(n.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=n[t+32768];if(this.k.push(i),this.q+=i.length,T)n.set(n.subarray(r,r+32768));else for(t=0;32768>t;++t)n[t]=n[r+t];return this.b=32768,n},_.prototype.J=function(t){var e,i,r,n,s=this.input.length/this.c+1|0,o=this.input,a=this.a;return t&&("number"==typeof t.v&&(s=t.v),"number"==typeof t.F&&(s+=t.F)),2>s?(i=(o.length-this.c)/this.u[2],n=258*(i/2)|0,r=n<a.length?a.length+n:a.length<<1):r=a.length*s,T?(e=new Uint8Array(r),e.set(a)):e=a,this.a=e},_.prototype.t=function(){var t,e,i,r,n,s=0,o=this.a,a=this.k,c=new(T?Uint8Array:Array)(this.q+(this.b-32768));if(0===a.length)return T?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=a.length;e<i;++e)for(t=a[e],r=0,n=t.length;r<n;++r)c[s++]=t[r];for(e=32768,i=this.b;e<i;++e)c[s++]=o[e];return this.k=[],this.buffer=c},_.prototype.H=function(){var t,e=this.b;return T?this.B?(t=new Uint8Array(e),t.set(this.a.subarray(0,e))):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},m.prototype.p=function(){var e,r,n=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(r=(n[this.c++]<<24|n[this.c++]<<16|n[this.c++]<<8|n[this.c++])>>>0,r!==i(e)&&t(Error("invalid adler-32 checksum"))),e},e("Zlib.Inflate",m),e("Zlib.Inflate.BufferType",z),z.ADAPTIVE=z.C,z.BLOCK=z.D,e("Zlib.Inflate.prototype.decompress",m.prototype.p);var st=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];T&&new Uint16Array(st);var ot=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];T&&new Uint16Array(ot);var at=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];T&&new Uint8Array(at);var ct=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];T&&new Uint16Array(ct);var ht=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];T&&new Uint8Array(ht);var lt,ut,dt=new(T?Uint8Array:Array)(288);for(lt=0,ut=dt.length;lt<ut;++lt)dt[lt]=143>=lt?8:255>=lt?9:279>=lt?7:8;s(dt);var _t,ft,pt=new(T?Uint8Array:Array)(30);for(_t=0,ft=pt.length;_t<ft;++_t)pt[_t]=5;s(pt);var gt=8}).call(window);var r=window;r=window.Zlib=r.Zlib,r.Deflate=r.Deflate,r.Deflate.compress=r.Deflate.compress,r.Inflate=r.Inflate,r.Inflate.BufferType=r.Inflate.BufferType,r.Inflate.prototype.decompress=r.Inflate.prototype.decompress},{}],23:[function(t,e,i){var r=cc._Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.currentActionSalvaged=!1,this.paused=!1,this.hh=null}});cc.ActionManager=cc._Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null,this._currentTargetSalvaged=!1},addAction:function(t,e,i){if(!t)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!e)throw new Error("cc.ActionManager.addAction(): action must be non-null");var n=this._hashTargets[e.__instanceId];n||(n=new r,n.paused=i,n.target=e,this._hashTargets[e.__instanceId]=n,this._arrayTargets.push(n)),this._actionAllocWithHashElement(n),n.actions.push(t),t.startWithTarget(e)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this.removeAllActionsFromTarget(i.target,!0)}},removeAllActionsFromTarget:function(t,e){if(null!=t){var i=this._hashTargets[t.__instanceId];i&&(i.actions.indexOf(i.currentAction)===-1||i.currentActionSalvaged||(i.currentActionSalvaged=!0),i.actions.length=0,this._currentTarget!==i||e?this._deleteHashElement(i):this._currentTargetSalvaged=!0)}},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets[e.__instanceId];if(i){for(var r=0;r<i.actions.length;r++)if(i.actions[r]===t){i.actions.splice(r,1);break}}else cc.log(cc._LogInfos.ActionManager.removeAction)}},removeActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.log(cc._LogInfos.ActionManager.addAction),cc.assert(e,cc._LogInfos.ActionManager.addAction);var i=this._hashTargets[e.__instanceId];if(i)for(var r=i.actions.length,n=0;n<r;++n){var s=i.actions[n];if(s&&s.getTag()===t&&s.getOriginalTarget()===e){this._removeActionAtIndex(n,i);break}}},getActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.log(cc._LogInfos.ActionManager.getActionByTag);var i=this._hashTargets[e.__instanceId];if(i){if(null!=i.actions)for(var r=0;r<i.actions.length;++r){var n=i.actions[r];if(n&&n.getTag()===t)return n}cc.log(cc._LogInfos.ActionManager.getActionByTag_2,t)}return null},numberOfRunningActionsInTarget:function(t){var e=this._hashTargets[t.__instanceId];return e&&e.actions?e.actions.length:0},pauseTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!0)},resumeTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var r=e[i];r&&!r.paused&&(r.paused=!0,t.push(r.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},pauseTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){var i=e.actions[t];i!==e.currentAction||e.currentActionSalvaged||(e.currentActionSalvaged=!0),e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&(this._currentTarget===e?this._currentTargetSalvaged=!0:this._deleteHashElement(e))},_deleteHashElement:function(t){var e=!1;return t&&(this._hashTargets[t.target.__instanceId]&&(delete this._hashTargets[t.target.__instanceId],cc.js.array.remove(this._arrayTargets,t),e=!0),t.actions=null,t.target=null),e},_actionAllocWithHashElement:function(t){null==t.actions&&(t.actions=[])},update:function(t){for(var e,i=this._arrayTargets,r=0;r<i.length;r++){if(this._currentTarget=i[r],e=this._currentTarget,!e.paused)for(e.actionIndex=0;e.actionIndex<(e.actions?e.actions.length:0);e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentActionSalvaged=!1,e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentActionSalvaged)e.currentAction=null;else if(e.currentAction.isDone()){e.currentAction.stop();var n=e.currentAction;e.currentAction=null,this.removeAction(n)}e.currentAction=null}this._currentTargetSalvaged&&0===e.actions.length&&this._deleteHashElement(e)&&r--}}})},{}],24:[function(t,e,i){var r=t("./event/event-target"),n=t("./platform/_CCClass");cc.g_NumberOfDraws=0,cc.Director=n.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_loadingScene:"",_runningScene:null,_scene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,ctor:function(){var t=this;r.call(t),t._lastUpdate=Date.now(),cc.game.on(cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc._widgetManager&&cc._widgetManager.init(this)},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):(this._deltaTime=(t-this._lastUpdate)/1e3,cc.game.config[cc.game.CONFIG_KEY.debugMode]>0&&this._deltaTime>1&&(this._deltaTime=1/60)),this._lastUpdate=t},convertToGL:null,convertToUI:null,engineUpdate:function(t){this._scheduler.update(t)},_visitScene:function(){if(this._runningScene){var t=cc.renderer;t.childrenOrderDirty?(t.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene._renderCmd.visit(),t.resetFlag()):t.transformDirty()&&t.transform()}},visit:function(t){this.emit(cc.Director.EVENT_BEFORE_VISIT,this),this._beforeVisitScene&&this._beforeVisitScene(),this._visitScene(),this._notificationNode&&this._notificationNode.visit(),this.emit(cc.Director.EVENT_AFTER_VISIT,this),this._afterVisitScene&&this._afterVisitScene()},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director.popScene),this._scenesStack.pop();var t=this._scenesStack.length;0===t?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){cc.spriteFrameCache._clear(),cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll(),cc.eventManager&&cc.eventManager.setEnabled(!1),this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup(),cc.renderer.clearRenderCommands()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData(),cc.checkGLErrorDebug()},reset:function(){this.purgeDirector(),cc.eventManager&&cc.eventManager.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this.startAnimation()},pushScene:function(t){cc.assert(t,cc._LogInfos.Director.pushScene),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runSceneImmediate:function(t,e,i){var r,n,s=cc.game,o=s._persistRootNodes;t instanceof cc.Scene&&t._load();for(r in o)n=o[r],s._ignoreRemovePersistNode=n,n.parent=null,s._ignoreRemovePersistNode=null;var a=this._scene;cc.isValid(a)&&a.destroy(),this._scene=null,cc.Object._deferredDestroy(),e&&e(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t);var c=t;if(t instanceof cc.Scene){this._scene=t,c=t._sgNode;for(r in o){n=o[r];var h=t.getChildByUuid(r);if(h){var l=h.getSiblingIndex();h._destroyImmediate(),n.parent=t,n.setSiblingIndex(l)}else n.parent=t}t._activate()}if(this._runningScene){var u=this._scenesStack.length;this._scenesStack[Math.max(u-1,0)]=c,this._sendCleanupToScene=!0,this._nextScene=c}else this.pushScene(c),this.startAnimation();this._nextScene&&this.setNextScene(),i&&i(null,t),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t)},runScene:function(t,e,i){cc.assert(t,cc._LogInfos.Director.pushScene),t instanceof cc.Scene&&t._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,function(){this.runSceneImmediate(t,e,i)})},_getSceneUuid:function(t){var e=cc.game._sceneInfos;if("string"==typeof t){t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://assets/")||(t="/"+t);for(var i=0;i<e.length;i++){var r=e[i];if(r.url.endsWith(t))return r}}else if("number"==typeof t){if(0<=t&&t<e.length)return e[t];cc.error("loadScene: The scene index to load (%s) is out of range.",t)}else cc.error('loadScene: Unknown name type to load: "%s"',t);return null},loadScene:function(t,e,i){if(this._loadingScene)return cc.error('loadScene: Failed to load scene "%s" because "%s" is already loading',t,this._loadingScene),!1;var r=this._getSceneUuid(t);if(r){var n=r.uuid;this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t;return this._loadSceneByUuid(n,e,i),!0}return cc.error('loadScene: Can not load the scene "%s" because it was not in the build settings before playing.',t),!1},preloadScene:function(t,e){var i=this._getSceneUuid(t);if(i)this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),cc.loader.load({id:i.uuid,type:"uuid"},function(i,r){i&&cc.error('Failed to preload "%s", %s',t,i.message),e&&e(i,r)});else{var r='Can not preload the scene "'+t+'" because it is not in the build settings.';e(new Error(r)),cc.error("preloadScene: "+r)}},_loadSceneByUuid:function(t,e,i){cc.AssetLibrary.loadAsset(t,function(r,n){var s=cc.director;s._loadingScene="";var o;r?(r="Failed to load scene: "+r,cc.error(r)):n instanceof cc.SceneAsset?(o=n.scene,o._id=n._uuid,o._name=n._name,s.runSceneImmediate(o,i,e)):(r="The asset "+t+" is not a scene",cc.error(r),o=null),r&&e&&e(r)})},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.log(cc._LogInfos.Director.resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;if(cc.TransitionScene&&(t=!!this._runningScene&&this._runningScene instanceof cc.TransitionScene,e=!!this._nextScene&&this._nextScene instanceof cc.TransitionScene),!e){var i=this._runningScene;i&&(i.onExitTransitionDidStart(),i.onExit()),this._sendCleanupToScene&&i&&i.cleanup()}this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,t||null===this._runningScene||(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(t){cc.renderer.childrenOrderDirty=!0,this._notificationNode&&(this._notificationNode.onExitTransitionDidStart(),this._notificationNode.onExit(),this._notificationNode.cleanup()),this._notificationNode=t,t&&(this._notificationNode.onEnter(),this._notificationNode.onEnterTransitionDidFinish())},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getScene:function(){return this._scene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(t){cc.profiler&&(t?cc.profiler.showStats():cc.profiler.hideStats())},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assert(this._runningScene,cc._LogInfos.Director.popToSceneStackLevel_2);var e=this._scenesStack,i=e.length;if(0===i)return void this.end();if(!(t>i)){for(;i>t;){var r=e.pop();r.running&&(r.onExitTransitionDidStart(),r.onExit()),r.cleanup(),i--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!1}},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager=t)},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){var t=Date.now();this._secondsPerFrame=(t-this._lastUpdate)/1e3}}),cc.js.addon(cc.Director.prototype,r.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_COMPONENT_UPDATE="director_component_update",cc.Director.EVENT_COMPONENT_LATE_UPDATE="director_component_late_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_visit",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||(this.calculateDeltaTime(),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this.emit(cc.Director.EVENT_COMPONENT_UPDATE,this._deltaTime),this.engineUpdate(this._deltaTime),this.emit(cc.Director.EVENT_COMPONENT_LATE_UPDATE,this._deltaTime),this.emit(cc.Director.EVENT_AFTER_UPDATE),cc.Object._deferredDestroy()),this._nextScene&&this.setNextScene(),this.visit(this._deltaTime),cc.g_NumberOfDraws=0,cc.renderer.clear(),cc.renderer.rendering(cc._renderContext),this._totalFrames++,this.emit(cc.Director.EVENT_AFTER_DRAW),this._calculateMPF())},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D},{"./event/event-target":63,"./platform/_CCClass":91}],25:[function(t,e,i){t("./CCDirector"),t("./CCGame"),cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.Director.prototype;t.getProjection=function(t){return this._projection},t.setProjection=function(t){this._projection=t,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this)},t.setDepthTest=function(){},t.setClearColor=function(t){cc.renderer._clearColor=t,cc.renderer._clearFillStyle="rgb("+t.r+","+t.g+","+t.b+")"},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,cc.eventManager&&cc.eventManager.setEnabled(!0)},t.getVisibleSize=function(){return this.getWinSize()},t.getVisibleOrigin=function(){return cc.p(0,0)}}})},{"./CCDirector":24,"./CCGame":27}],26:[function(t,e,i){t("./CCDirector"),t("./CCGame"),t("../kazmath");var r=cc.math;cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc._Class.extend({updateProjection:function(){}});var t=cc.Director.prototype,e=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty);var i,r=t._children;for(i=0;i<r.length;i++)e(r[i])}};cc.Director._getInstance().on(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var t=(cc.director,cc.director._scenesStack),i=0;i<t.length;i++)e(t[i])}),t.setProjection=function(t){var e=this,i=e._winSizeInPoints;e.setViewport();var n=e._openGLView,s=n._viewPortRect.x/n._scaleX,o=n._viewPortRect.y/n._scaleY;switch(t){case cc.Director.PROJECTION_2D:r.glMatrixMode(r.KM_GL_PROJECTION),r.glLoadIdentity();var a=r.Matrix4.createOrthographicProjection(0,i.width,0,i.height,-1024,1024);r.glMultMatrix(a),r.glMatrixMode(r.KM_GL_MODELVIEW),r.glLoadIdentity();break;case cc.Director.PROJECTION_3D:var c=e.getZEye(),h=new r.Matrix4,l=new r.Matrix4;r.glMatrixMode(r.KM_GL_PROJECTION),r.glLoadIdentity(),h=r.Matrix4.createPerspectiveProjection(60,i.width/i.height,.1,2*c),r.glMultMatrix(h),r.glMatrixMode(r.KM_GL_MODELVIEW),r.glLoadIdentity();var u=new r.Vec3(-s+i.width/2,-o+i.height/2,c),d=new r.Vec3(-s+i.width/2,-o+i.height/2,0),_=new r.Vec3(0,1,0);l.lookAt(u,d,_),r.glMultMatrix(l);break;case cc.Director.PROJECTION_CUSTOM:e._projectionDelegate&&e._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director.setProjection)}e._projection=t,e.emit(cc.Director.EVENT_PROJECTION_CHANGED,e),cc.gl.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){cc.renderer.setDepthTest(t)},t.setClearColor=function(t){var e=cc.renderer._clearColor;e.r=t.r/255,e.g=t.g/255,e.b=t.b/255,e.a=t.a/255},t.setOpenGLView=function(t){var e=this;e._winSizeInPoints.width=cc._canvas.width,e._winSizeInPoints.height=cc._canvas.height,e._openGLView=t||cc.view;var i=cc.configuration;i.gatherGPUInfo(),e.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},t._clear=function(){var t=cc._renderContext;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var t=this._openGLView;if(t){var e=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,e.width,e.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){t?cc.gl.blendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST):cc.gl.blendFunc(cc.macro.ONE,cc.macro.ZERO)},t.setGLDefaultValues=function(){var t=this;t.setAlphaBlending(!0),t.setProjection(t._projection),cc._renderContext.clearColor(0,0,0,0)}}})},{"../kazmath":137,"./CCDirector":24,"./CCGame":27}],27:[function(t,e,i){var r,n=t("./event/event-target");r=t("./platform/CCView");var s=!1,o={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_GAME_INITED:"game_inited",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_ignoreRemovePersistNode:null,CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",registerSystemEvent:"registerSystemEvent",jsList:"jsList",scenes:"scenes"},_paused:!0,_isCloning:!1,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(t){var e=this,i=e.config,r=e.CONFIG_KEY;i[r.frameRate]=t,e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._intervalId=0,e._paused=!0,e._setAnimFrame(),e._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){if(!this._paused){this._paused=!0,cc.audioEngine&&(s=cc.audioEngine.isMusicPlaying(),cc.audioEngine.stopAllEffects(),cc.audioEngine.pauseMusic());var t=cc.director.getScene()||cc.director.getRunningScene();t&&cc.eventManager.pauseTarget(t,!0),this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._intervalId=0}},resume:function(){if(this._paused){this._paused=!1,cc.audioEngine&&s&&cc.audioEngine.resumeMusic();var t=cc.director.getScene()||cc.director.getRunningScene();t&&cc.eventManager.resumeTarget(t,!0),this._runMainLoop()}},isPaused:function(){return this._paused},restart:function(){cc.director.popToSceneStackLevel(0),cc.audioEngine&&cc.audioEngine.end(),o.onStart()},end:function(){close()},prepare:function(t){var e=this,i=e.config,n=e.CONFIG_KEY;if(this._loadConfig(),this._prepared)return void(t&&t());if(!this._prepareCalled){if(cc._engineLoaded){this._prepareCalled=!0,this._initRenderer(i[n.width],i[n.height]),cc.view=r?r._getInstance():null,cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop();var s=i[n.jsList];return void(s&&s.length>0?cc.loader.load(s,function(i){if(i)throw new Error(JSON.stringify(i));e._prepared=!0,e.emit(e.EVENT_GAME_INITED),t&&t()}):(e.emit(e.EVENT_GAME_INITED),t&&t()))}cc.initEngine(this.config,function(){e.prepare(t)})}},run:function(t,e){"function"==typeof t?o.onStart=t:(t&&(o.config=t),"function"==typeof e&&(o.onStart=e)),this.prepare(o.onStart&&o.onStart.bind(o))},addPersistRootNode:function(t){if(!(t instanceof cc.Node&&t.uuid))return void cc.warn("The target can not be made persist because it's not a cc.Node or it doesn't have _id property.");var e=t.uuid;if(!this._persistRootNodes[e]){var i=cc.director._scene;if(cc.isValid(i)){if(t.parent){if(!(t.parent instanceof cc.Scene))return void cc.warn("The node can not be made persist because it's not under root node.");if(t.parent!==i)return void cc.warn("The node can not be made persist because it's not in current scene.")}else t.parent=i;this._persistRootNodes[e]=t,t._persistNode=!0}}},removePersistRootNode:function(t){if(t!==this._ignoreRemovePersistNode){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1)}},isPersistRootNode:function(t){return t._persistNode},_setAnimFrame:function(){this._lastTime=new Date,this._frameTime=1e3/o.config[o.CONFIG_KEY.frameRate],cc.sys.os===cc.sys.OS_IOS&&cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT||60!==o.config[o.CONFIG_KEY.frameRate]?(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=(new Date).getTime(),i=Math.max(0,o._frameTime-(e-o._lastTime)),r=window.setTimeout(function(){t()},i);return o._lastTime=e+i,r},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t,e=this,i=e.config,r=e.CONFIG_KEY,n=cc.director;n.setDisplayStats(i[r.showFPS]),t=function(){e._paused||(n.mainLoop(),e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._intervalId=window.requestAnimFrame(t))},window.requestAnimFrame(t),e._paused=!1},_loadConfig:function(){if(this.config)return void this._initConfig(this.config);if(document.ccConfig)this._initConfig(document.ccConfig);else{var t={};try{for(var e=document.getElementsByTagName("script"),i=0;i<e.length;i++){var r=e[i].getAttribute("cocos");if(""===r||r)break}var n,s,o;i<e.length&&(n=e[i].src,n&&(o=/(.*)\//.exec(n)[0],cc.loader.resPath=o,n=cc.path.join(o,"project.json")),s=cc.loader._loadTxtSync(n)),s||(s=cc.loader._loadTxtSync("project.json")),t=JSON.parse(s)}catch(a){cc.log("Failed to read or parse project.json")}this._initConfig(t||{})}},_initConfig:function(t){var e=this.CONFIG_KEY,i=t[e.modules];"number"!=typeof t[e.debugMode]&&(t[e.debugMode]=0),"number"!=typeof t[e.frameRate]&&(t[e.frameRate]=60),"number"!=typeof t[e.renderMode]&&(t[e.renderMode]=0),"boolean"!=typeof t[e.registerSystemEvent]&&(t[e.registerSystemEvent]=!0),t[e.showFPS]=!(e.showFPS in t)||!!t[e.showFPS],t[e.engineDir]=t[e.engineDir]||"frameworks/cocos2d-html5",i&&i.indexOf("core")<0&&i.splice(0,0,"core"),i&&(t[e.modules]=i),this._sceneInfos=this._sceneInfos.concat(t[e.scenes]),this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],this.config=t},_initRenderer:function(t,e){if(!this._rendererInitialized){if(!cc._supportRender)throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var i,r,n=this.config[o.CONFIG_KEY.id],s=window,a=cc.$(n)||cc.$("#"+n);"CANVAS"===a.tagName?(t=t||a.width,e=e||a.height,this.canvas=cc._canvas=i=a,this.container=cc.container=r=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(r,i)):("DIV"!==a.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),t=t||a.clientWidth,e=e||a.clientHeight,this.canvas=cc._canvas=i=document.createElement("CANVAS"),this.container=cc.container=r=document.createElement("DIV"),a.appendChild(r)),r.setAttribute("id","Cocos2dGameContainer"),r.appendChild(i),this.frame=r.parentNode===document.body?document.documentElement:r.parentNode,i.addClass("gameCanvas"),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99),cc._renderType===o.RENDER_TYPE_WEBGL&&(this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(i,{stencil:!0,antialias:!cc.sys.isMobile,alpha:!0})),this._renderContext?(cc.renderer=cc.rendererWebGL,s.gl=this._renderContext,cc.renderer.init(),cc.shaderCache._init(),cc._drawingUtil=new cc.DrawingPrimitiveWebGL(this._renderContext),cc.textureCache._initializingRenderer(),cc.glExt={},cc.glExt.instanced_arrays=s.gl.getExtension("ANGLE_instanced_arrays"),cc.glExt.element_uint=s.gl.getExtension("OES_element_index_uint")):(cc._renderType=o.RENDER_TYPE_CANVAS,cc.renderer=cc.rendererCanvas,this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(i.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(this._renderContext):null),cc._gameDiv=r,o.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this.emit(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){var t,e,i=window;this.config[this.CONFIG_KEY.registerSystemEvent]&&cc.inputManager.registerSystemEvent(this.canvas),"undefined"!=typeof document.hidden?(t="hidden",e="visibilitychange"):"undefined"!=typeof document.mozHidden?(t="mozHidden",e="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(t="msHidden",e="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange");var r=function(){o.emit(o.EVENT_HIDE,o)},n=function(){o.emit(o.EVENT_SHOW,o)};t?document.addEventListener(e,function(){document[t]?r():n()},!1):(i.addEventListener("blur",r,!1),i.addEventListener("focus",n,!1)),navigator.userAgent.indexOf("MicroMessenger")>-1&&(i.onfocus=function(){n()}),"onpageshow"in window&&"onpagehide"in window&&(i.addEventListener("pagehide",r,!1),
i.addEventListener("pageshow",n,!1)),this.on(o.EVENT_HIDE,function(){o.pause()}),this.on(o.EVENT_SHOW,function(){o.resume()})}};n.call(o),cc.js.addon(o,n.prototype),cc.game=e.exports=o},{"./event/event-target":63,"./platform/CCView":89}],28:[function(t,e,i){"use strict";function r(t){return t?"string"==typeof t?h.getClassByName(t):t:(cc.error("getComponent: Type must be non-nil"),null)}function n(t,e){for(var i=0;i<t._components.length;++i){var r=t._components[i];if(r instanceof e)return r}return null}function s(t,e,i){for(var r=0;r<t._components.length;++r){var n=t._components[r];n instanceof e&&i.push(n)}}function o(t,e){for(var i=0;i<t.length;++i){var r=t[i],s=n(r,e);if(s)return s;if(r.children.length>0&&(s=o(r.children,e)))return s}return null}function a(t,e,i){for(var r=0;r<t.length;++r){var n=t[r];s(n,e,i),n._children.length>0&&a(n._children,e,i)}}var c=t("./event/event-target"),h=cc.js,l=cc.Object.Flags,u=l.Destroying,d=l.DontDestroy,_=l.Activating,f=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel"}),p=[f.TOUCH_START,f.TOUCH_MOVE,f.TOUCH_END,f.TOUCH_CANCEL],g=[f.MOUSE_DOWN,f.MOUSE_ENTER,f.MOUSE_MOVE,f.MOUSE_LEAVE,f.MOUSE_UP,f.MOUSE_WHEEL],m=null,v=function(t,e){var i=t.getLocation(),r=this.owner;return!!r._hitTest(i,this)&&(e.type=f.TOUCH_START,e.touch=t,e.bubbles=!0,r.dispatchEvent(e),!0)},y=function(t,e){var i=this.owner;e.type=f.TOUCH_MOVE,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)},C=function(t,e){var i=t.getLocation(),r=this.owner;r._hitTest(i,this)?e.type=f.TOUCH_END:e.type=f.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,r.dispatchEvent(e)},T=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=f.MOUSE_DOWN,i.dispatchEvent(t),t.stopPropagation())},E=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)?(t.stopPropagation(),this._previousIn||(m&&(t.type=f.MOUSE_LEAVE,m.owner.dispatchEvent(t),m._previousIn=!1),m=this,t.type=f.MOUSE_ENTER,i.dispatchEvent(t),this._previousIn=!0),t.type=f.MOUSE_MOVE,i.dispatchEvent(t)):this._previousIn&&(t.type=f.MOUSE_LEAVE,i.dispatchEvent(t),this._previousIn=!1,m=null)},x=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=f.MOUSE_UP,i.dispatchEvent(t),t.stopPropagation())},b=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=f.MOUSE_WHEEL,i.dispatchEvent(t))},S=function(t){if(cc.Mask)for(var e=0,i=null,r=t;r&&r instanceof cc.Node;r=r.parent,++e)if(i=r.getComponent(cc.Mask))return{index:e,node:r};return null},A=cc.Class({name:"cc.Node","extends":t("./utils/base-node"),mixins:[c],properties:{active:{get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent&&this._parent._activeInHierarchy;e&&(this._onActivatedInHierarchy(t),this.emit("active-in-hierarchy-changed",this))}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}},_active:!0,_components:[],_prefab:{"default":null,editorOnly:!0},_persistNode:{get:function(){return(this._objFlags&d)>0},set:function(t){t?this._objFlags|=d:this._objFlags&=~d}},groupIndex:{"default":0,type:cc.Integer},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(t){this.groupIndex=cc.game.groupList.indexOf(t),this.emit("group-changed")}}},ctor:function(){var t=arguments[0];this._name="undefined"!=typeof t?t:"New Node",this._activeInHierarchy=!1,this._widget=null,this._touchListener=null,this._mouseListener=null},destroy:function(){cc.Object.prototype.destroy.call(this)&&this._activeInHierarchy&&this._deactivateChildComponents()},_onPreDestroy:function(){var t,e;this._objFlags|=u;var i=this._parent,r=i&&i._objFlags&u,n=this._children;for(t=0,e=n.length;t<e;++t)n[t]._destroyImmediate();for(t=0,e=this._components.length;t<e;++t){var s=this._components[t];s._destroyImmediate()}for(this.stopAllActions(),this._releaseAllActions(),cc.eventManager.removeListeners(this),t=0,e=this.__eventTargets.length;t<e;++t){var o=this.__eventTargets[t];o&&o.targetOff(this)}if(this.__eventTargets.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!r){if(i){var a=i._children.indexOf(this);i._children.splice(a,1),i.emit("child-removed",this)}this._removeSgNode()}},getComponent:function(t){var e=r(t);return e?n(this,e):null},getComponents:function(t){var e=r(t),i=[];return e&&s(this,e,i),i},getComponentInChildren:function(t){var e=r(t);return e?o(this._children,e):null},getComponentsInChildren:function(t){var e=r(t),i=[];return e&&(s(this,e,i),a(this._children,e,i)),i},_checkMultipleComp:!1,addComponent:function(t){var e;if("string"==typeof t){if(e=h.getClassByName(t),!e)return cc.error('addComponent: Failed to get class "%s"',t),cc._RFpeek()&&cc.error('addComponent: Should not add component ("%s") when the scripts are still loading.',t),null}else{if(!t)return cc.error("addComponent: Type must be non-nil"),null;e=t}if("function"!=typeof e)return cc.error("addComponent: The component to add must be a constructor"),null;if(!cc.isChildClassOf(e,cc.Component))return cc.error("addComponent: The component to add must be child class of cc.Component"),null;var i=e._requireComponent;if(i&&!this.getComponent(i)){var r=this.addComponent(i);if(!r)return null}var n=new e;return n.node=this,this._components.push(n),this._activeInHierarchy&&("function"==typeof n.__preload&&cc.Component._callPreloadOnComponent(n),n.__onNodeActivated(!0)),n},_addComponentAt:!1,removeComponent:function(t){return t?("object"!=typeof t&&(t=this.getComponent(t)),void(t&&t.destroy())):void cc.error("removeComponent: Component must be non-nil")},_getDependComponent:!1,_removeComponent:function(t){if(!t)return void cc.error("Argument must be non-nil");if(!(this._objFlags&u)){var e=this._components.indexOf(t);e!==-1?this._components.splice(e,1):t.node!==this&&cc.error("Component not owned by this entity")}},_registerIfAttached:!1,_activeRecursively:function(t){var e=!1;if(this._objFlags&_){if(t)return void cc.error('Node "%s" is already activating',this.name);e=!0}else t&&(this._objFlags|=_);this._activeInHierarchy=t;for(var i=this._components.length,r=0;r<i;++r){var n=this._components[r];if(n instanceof cc.Component){if(n.__onNodeActivated(t),t&&!this._activeInHierarchy)return void(this._objFlags&=~_)}else n?this._removeComponent(n):h.array.removeAt(this._components,r),--r,--i}for(var s=0,o=this._children.length;s<o;++s){var a=this._children[s];if(a._active&&(a._activeRecursively(t),t&&!this._activeInHierarchy))return void(this._objFlags&=~_)}return e?void(this._objFlags&=~_):(t?(cc.director.getActionManager().resumeTarget(this),cc.eventManager.resumeTarget(this)):(cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this)),void(this._objFlags&=~_))},_onActivatedInHierarchy:function(t){t&&cc.Component._callPreloadOnNode(this),this._activeRecursively(t)},_onHierarchyChanged:function(t){var e=this._parent;!this._persistNode||e instanceof cc.Scene||cc.game.removePersistRootNode(this);var i=this._active&&!(!t||!t._activeInHierarchy),r=this._active&&!(!e||!e._activeInHierarchy);i!==r&&this._onActivatedInHierarchy(r),cc._widgetManager._nodesOrderDirty=!0},_deactivateChildComponents:function(){for(var t=this._components.length,e=0;e<t;++e){var i=this._components[e];i.__onNodeActivated(!1)}for(var r=0,n=this.childrenCount;r<n;++r){var s=this._children[r];s._active&&s._deactivateChildComponents()}},_instantiate:function(){var t=cc.instantiate._clone(this,this);return t._parent=null,t._onBatchCreated(),t},on:function(t,e,i,r){p.indexOf(t)!==-1?this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:S(this),onTouchBegan:v,onTouchMoved:y,onTouchEnded:C}),cc.eventManager.addListener(this._touchListener,this)):g.indexOf(t)!==-1&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:S(this),onMouseDown:T,onMouseMove:E,onMouseUp:x,onMouseScroll:b}),cc.eventManager.addListener(this._mouseListener,this))),this._EventTargetOn(t,e,i,r)},off:function(t,e,i,r){this._EventTargetOff(t,e,i,r),p.indexOf(t)!==-1?this._checkTouchListeners():g.indexOf(t)!==-1&&this._checkMouseListeners()},targetOff:function(t){this._EventTargetTargetOff(t),this._checkTouchListeners(),this._checkMouseListeners()},_checkTouchListeners:function(){if(!(this._objFlags&u)&&this._bubblingListeners&&this._touchListener){for(var t=0;t<p.length;++t)if(this._bubblingListeners.has(p[t]))return;cc.eventManager.removeListener(this._touchListener),this._touchListener=null}},_checkMouseListeners:function(){if(!(this._objFlags&u)&&this._bubblingListeners&&this._mouseListener){for(var t=0;t<g.length;++t)if(this._bubblingListeners.has(g[t]))return;cc.eventManager.removeListener(this._mouseListener),this._mouseListener=null}},_hitTest:function(t,e){var i=this.width,r=this.height,n=cc.rect(0,0,i,r),s=this.getNodeToWorldTransform();cc._rectApplyAffineTransformIn(n,s);var o=t.x-n.x,a=n.x+n.width-t.x,c=t.y-n.y,h=n.y+n.height-t.y;if(o>=0&&a>=0&&h>=0&&c>=0){if(e&&e.mask){for(var l=e.mask,u=this,d=0;u&&d<l.index;++d,u=u.parent);if(u===l.node){var _=u.getComponent(cc.Mask);return!_||!_.enabledInHierarchy||_._hitTest(t)}return e.mask=null,!0}return!0}return!1},_getCapturingTargets:function(t,e){for(var i=this.parent;i;)i.hasEventListener(t,!0)&&e.push(i),i=i.parent},_getBubblingTargets:function(t,e){for(var i=this.parent;i;)i.hasEventListener(t)&&e.push(i),i=i.parent},isRunning:function(){return this._activeInHierarchy},runAction:function(t){if(this.active)return cc.assert(t,cc._LogInfos.Node.runAction),cc.director.getActionManager().addAction(t,this,!1),t},stopAllActions:function(){cc.director.getActionManager().removeAllActionsFromTarget(this)},stopAction:function(t){cc.director.getActionManager().removeAction(t)},stopActionByTag:function(t){return t===cc.Action.TAG_INVALID?void cc.log(cc._LogInfos.Node.stopActionByTag):void cc.director.getActionManager().removeActionByTag(t,this)},getActionByTag:function(t){return t===cc.Action.TAG_INVALID?(cc.log(cc._LogInfos.Node.getActionByTag),null):void cc.director.getActionManager().getActionByTag(t,this)},getNumberOfRunningActions:function(){cc.director.getActionManager().numberOfRunningActionsInTarget(this)},_retainAction:function(t){},_releaseAllActions:function(){}});A.EventType=f,cc.Node=e.exports=A},{"./event/event-target":63,"./utils/base-node":117}],29:[function(t,e,i){var r=function(){};cc.Scene=cc.Class({name:"cc.Scene","extends":t("./utils/base-node"),ctor:function(){var t=this._sgNode=new _ccsg.Scene;t.setAnchorPoint(0,0),this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning},destroy:function(){for(var t=this._children,e=cc.Object.Flags.DontDestroy,i=0,r=t.length;i<r;++i){var n=t[i];n.isValid&&(n._objFlags&e||n.destroy())}this._super(),this._activeInHierarchy=!1},_onHierarchyChanged:r,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0)},_activate:function(t){t=t!==!1;var e,i,r=this._children,n=r.length;for(this._activeInHierarchy=t,e=0;e<n;++e)i=r[e],i._active&&i._onActivatedInHierarchy(t)}}),e.exports=cc.Scene},{"./utils/base-node":117}],30:[function(t,e,i){var r=function(t,e,i,r,n,s,o){this.prev=t,this.next=e,this.callback=i,this.target=r,this.priority=n,this.paused=s,this.markedForDeletion=o};r.prototype.trigger=function(t){this.callback.call(this.target,t)};var n=function(t,e,i,r,n){this.list=t,this.entry=e,this.target=i,this.callback=r,this.hh=n},s=function(t,e,i,r,n,s,o){var a=this;a.timers=t,a.target=e,a.timerIndex=i,a.currentTimer=r,a.currentTimerSalvaged=n,a.paused=s,a.hh=o},o=cc._Class.extend({getInterval:function(){return this._interval},setInterval:function(t){this._interval=t},setupTimerWithInterval:function(t,e,i){this._elapsed=-1,this._interval=t,this._delay=i,this._useDelay=this._delay>0,this._repeat=e,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0},update:function(t){this._elapsed===-1?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}}),a=o.extend({ctor:function(){this._target=null,this._selector=null},initWithSelector:function(t,e,i,r,n,s){return this._scheduler=t,this._target=e,this._selector=i,this.setupTimerWithInterval(r,n,s),!0},getSelector:function(){return this._selector},trigger:function(){this._selector&&this._target&&this._selector.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}}),c=function(t){return t.__instanceId||t.uuid};cc.Scheduler=cc._Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_schedulePerFrame:function(t,e,i,r){var n=this._hashForUpdates[c(e)];if(n&&n.entry){if(n.entry.priority===i)return n.entry.markedForDeletion=!1,void(n.entry.paused=r);if(this._updateHashLocked)return cc.log("warning: you CANNOT change update priority in scheduled function"),n.entry.markedForDeletion=!1,void(n.entry.paused=r);this.unscheduleUpdate(e)}0===i?this._appendIn(this._updates0List,t,e,r):i<0?this._priorityIn(this._updatesNegList,t,e,i,r):this._priorityIn(this._updatesPosList,t,e,i,r)},_removeHashElement:function(t){delete this._hashForTimers[c(t.target)],cc.js.array.remove(this._arrayForTimers,t),t.Timer=null,t.target=null,t=null},_removeUpdateFromHash:function(t){var e=this,i=e._hashForUpdates[c(t.target)];i&&(cc.js.array.remove(i.list,i.entry),delete e._hashForUpdates[c(i.target)],i.entry=null,i.target=null)},_priorityIn:function(t,e,i,s,o){var a=this,h=new r(null,null,e,i,s,o,(!1));if(t){for(var l=t.length-1,u=0;u<=l;u++)if(s<t[u].priority){l=u;break}t.splice(u,0,h)}else t=[],t.push(h);return a._hashForUpdates[c(i)]=new n(t,h,i,null),t},_appendIn:function(t,e,i,s){var o=this,a=new r(null,null,e,i,0,s,(!1));t.push(a),o._hashForUpdates[c(i)]=new n(t,a,i,null,null)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale);var e,i,r,n;for(e=0,i=this._updatesNegList,r=i.length;e<r;e++)n=i[e],n.paused||n.markedForDeletion||n.trigger(t);for(e=0,i=this._updates0List,r=i.length;e<r;e++)n=i[e],n.paused||n.markedForDeletion||n.trigger(t);for(e=0,i=this._updatesPosList,r=i.length;e<r;e++)n=i[e],n.paused||n.markedForDeletion||n.trigger(t);var s,o=this._arrayForTimers;for(e=0;e<o.length;e++){if(s=o[e],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(t),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&this._removeHashElement(this._currentTarget)}for(e=0,i=this._updatesNegList;e<i.length;)n=i[e],n.markedForDeletion?this._removeUpdateFromHash(n):e++;for(e=0,i=this._updates0List;e<i.length;)n=i[e],n.markedForDeletion?this._removeUpdateFromHash(n):e++;for(e=0,i=this._updatesPosList;e<i.length;)n=i[e],n.markedForDeletion?this._removeUpdateFromHash(n):e++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,r,n,s){this.schedule(e,t,i,r,n,s)},schedule:function(t,e,i,r,n,o){"use strict";if("function"!=typeof t){var h=t;t=e,e=h}4!==arguments.length&&5!==arguments.length||(o=r,r=cc.macro.REPEAT_FOREVER,n=0),cc.assert(e,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);var l=c(e),u=this._hashForTimers[l];u?cc.assert(u.paused===o,""):(u=new s(null,e,0,null,null,o,null),this._arrayForTimers.push(u),this._hashForTimers[l]=u);var d,_;if(null==u.timers)u.timers=[];else for(_=0;_<u.timers.length;++_)if(d=u.timers[_],d&&t===d.getSelector())return cc.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",d.getInterval(),i),void d.setInterval(i);d=new a,d.initWithSelector(this,e,t,i,r,n),u.timers.push(d)},scheduleUpdate:function(t,e,i,r){r=r||t.update,this._schedulePerFrame(r,t,e,i)},_getUnscheduleMark:function(t,e){switch(typeof t){case"number":case"string":return t===e.getKey();case"function":return t===e._callback||t===e.getSelector()}},unschedule:function(t,e){if(e&&t){var i=this,r=i._hashForTimers[c(e)];if(r)for(var n=r.timers,s=0,o=n.length;s<o;s++){var a=n[s];if(this._getUnscheduleMark(t,a))return a!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),n.splice(s,1),r.timerIndex>=s&&r.timerIndex--,void(0===n.length&&(i._currentTarget===r?i._currentTargetSalvaged=!0:i._removeHashElement(r)))}}},unscheduleUpdate:function(t){if(null!=t){var e=this._hashForUpdates[c(t)];e&&(this._updateHashLocked?e.entry.markedForDeletion=!0:this._removeUpdateFromHash(e.entry))}},unscheduleAllForTarget:function(t){if(null!=t){var e=this._hashForTimers[c(t)];e&&(e.timers.indexOf(e.currentTimer)>-1&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0),e.timers.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e)),this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,r=this._arrayForTimers;for(e=r.length-1;e>=0;e--)i=r[e],this.unscheduleAllForTarget(i.target);var n,s=0;if(t<0)for(e=0;e<this._updatesNegList.length;)s=this._updatesNegList.length,n=this._updatesNegList[e],n&&n.priority>=t&&this.unscheduleUpdate(n.target),s==this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)s=this._updates0List.length,n=this._updates0List[e],n&&this.unscheduleUpdate(n.target),s==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)s=this._updatesPosList.length,n=this._updatesPosList[e],n&&n.priority>=t&&this.unscheduleUpdate(n.target),s==this._updatesPosList.length&&e++},isScheduled:function(t,e){cc.assert(t,"Argument callback must not be empty"),cc.assert(e,"Argument target must be non-nullptr");var i=this._hashForUpdates[c(e)];if(!i)return!1;if(null==i.timers)return!1;for(var r=i.timers,n=0;n<r.length;++n){var s=r[n];if(t===s.getKey())return!0}return!1},pauseAllTargets:function(){this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,i,r,n=this,s=n._arrayForTimers;for(i=0,r=s.length;i<r;i++)e=s[i],e&&(e.paused=!0);var o;if(t<0)for(i=0;i<this._updatesNegList.length;i++)o=this._updatesNegList[i],o&&o.priority>=t&&(o.paused=!0);if(t<=0)for(i=0;i<this._updates0List.length;i++)o=this._updates0List[i],o&&(o.paused=!0);for(i=0;i<this._updatesPosList.length;i++)o=this._updatesPosList[i],o&&o.priority>=t&&(o.paused=!0)},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler.pauseTarget);var e=this,i=c(t),r=e._hashForTimers[i];r&&(r.paused=!0);var n=e._hashForUpdates[i];n&&(n.entry.paused=!0)},resumeTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler.resumeTarget);var e=this,i=c(t),r=e._hashForTimers[i];r&&(r.paused=!1);var n=e._hashForUpdates[i];n&&(n.entry.paused=!1)},isTargetPaused:function(t){cc.assert(t,cc._LogInfos.Scheduler.isTargetPaused);var e=c(t),i=this._hashForTimers[e];if(i)return i.paused;var r=this._hashForUpdates[e];return!!r&&r.entry.paused},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unscheduleAllForTarget(t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),cc.Scheduler.PRIORITY_SYSTEM=-2147483648,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1},{}],31:[function(t,e,i){var r=t("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset","extends":r,properties:{rawUrl:{get:function(){if(this._rawFiles){if(cc.AssetLibrary)return cc.AssetLibrary.getImportedDir(this._uuid)+"/"+this._uuid+"/"+this._rawFiles[0];cc.error("asset.url is not usable in core process")}return""},visible:!1},rawUrls:{get:function(){if(this._rawFiles){if(cc.AssetLibrary){var t=cc.AssetLibrary.getImportedDir(this._uuid)+"/"+this._uuid+"/";return this._rawFiles.map(function(e){return t+e})}cc.error("asset.urls is not usable in core process")}return[]},visible:!1},_rawFiles:null},statics:{deserialize:function(t){return cc.deserialize(t)},preventDeferredLoadDependents:!1},serialize:function(){return Editor.serialize(this)},createNode:null,_setRawFiles:function(t){this._rawFiles=t.length>0?t:null}}),e.exports=cc.Asset},{"./CCRawAsset":36}],32:[function(t,e,i){var r=cc.Class({name:"cc.AudioClip","extends":cc.RawAsset});cc.AudioClip=r,e.exports=r},{}],33:[function(t,e,i){var r=cc.Class({name:"cc.BitmapFont","extends":cc.Font,properties:{texture:{"default":"",url:cc.Texture2D},fontSize:{"default":-1}}});cc.BitmapFont=r,e.exports=r},{}],34:[function(t,e,i){var r=cc.Class({name:"cc.Font","extends":cc.Asset});cc.Font=r,e.exports=r},{}],35:[function(t,e,i){var r=cc.Class({name:"cc.Prefab","extends":cc.Asset,properties:{data:null},createNode:function(t){},_instantiate:function(){var t=cc.instantiate(this.data);return t}});cc.Prefab=e.exports=r,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{}],36:[function(t,e,i){var r=t("../platform/CCObject");cc.RawAsset=cc.Class({name:"cc.RawAsset","extends":r,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0})},statics:{createNodeByInfo:null}}),Object.defineProperty(cc.RawAsset,"isRawAssetType",{value:function(t){return cc.isChildClassOf(t,cc.RawAsset)&&!cc.isChildClassOf(t,cc.Asset)}}),e.exports=cc.RawAsset},{"../platform/CCObject":85}],37:[function(t,e,i){var r=cc.Class({name:"cc.SceneAsset","extends":cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=r,e.exports=r},{}],38:[function(t,e,i){var r=cc.Class({name:"cc.Script","extends":cc.Asset});cc._Script=r;var n=cc.Class({name:"cc.JavaScript","extends":r});cc._JavaScript=n;var s=cc.Class({name:"cc.CoffeeScript","extends":r});cc._CoffeeScript=s},{}],39:[function(t,e,i){var r=cc.Class({name:"cc.SpriteAtlas","extends":cc.Asset,properties:{_spriteFrames:{"default":{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);if(t.length>0){var e=this._spriteFrames[t[0]];return e?e.getTexture():null}return null},getSpriteFrame:function(t){return this._spriteFrames[t]},getSpriteFrames:function(){var t=[],e=this._spriteFrames;for(var i in e)t.push(e[i]);return t}});cc.SpriteAtlas=r,e.exports=r},{}],40:[function(t,e,i){var r=cc.Class({name:"cc.TTFFont","extends":cc.Font});cc.TTFFont=r,e.exports=r},{}],41:[function(t,e,i){t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCBitmapFont"),t("./CCScripts"),t("./CCSceneAsset"),t("../sprites/CCSpriteFrame"),t("../textures/CCTexture2D"),t("./CCTTFFont"),t("./CCSpriteAtlas")},{"../sprites/CCSpriteFrame":109,"../textures/CCTexture2D":111,"./CCAsset":31,"./CCAudioClip":32,"./CCBitmapFont":33,"./CCFont":34,"./CCPrefab":35,"./CCRawAsset":36,"./CCSceneAsset":37,"./CCScripts":38,"./CCSpriteAtlas":39,"./CCTTFFont":40}],42:[function(t,e,i){function r(t){return t instanceof cc.Scene?cc.visibleRect:!t._sizeProvider||t._sizeProvider instanceof _ccsg.Node?t._contentSize:t.getContentSize()}function n(t,e){var i,n=t._parent,s=r(n),o=n._anchorPoint,a=n instanceof cc.Scene,c=t._position.x,h=t._position.y,l=t.getAnchorPoint();if(e._alignFlags&_){var u,d,p=s.width;a?(i=cc.visibleRect,u=i.left.x,d=i.right.x):(u=-o.x*p,d=u+p),u+=e._isAbsLeft?e._left:e._left*p,d-=e._isAbsRight?e._right:e._right*p;var g,m=l.x,v=t._scaleX;if(v<0&&(m=1-m,v=-v),e.isStretchWidth)g=d-u,t.width=g/v,c=u+m*g;else if(g=t.width*v,e.isAlignHorizontalCenter){var y=(.5-o.x)*p;c=y+(m-.5)*g}else c=e.isAlignLeft?u+m*g:d+(m-1)*g}if(e._alignFlags&f){var C,T,E=s.height;a?(i=cc.visibleRect,T=i.bottom.y,C=i.top.y):(T=-o.y*E,C=T+E),T+=e._isAbsBottom?e._bottom:e._bottom*E,C-=e._isAbsTop?e._top:e._top*E;var x,b=l.y,S=t._scaleY;if(S<0&&(b=1-b,S=-S),e.isStretchHeight)x=C-T,t.height=x/S,h=T+b*x;else if(x=t.height*S,e.isAlignVerticalCenter){var A=(.5-o.y)*E;h=A+(b-.5)*x}else h=e.isAlignBottom?T+b*x:C+(b-1)*x}t.setPosition(c,h)}function s(t){var e=t._widget;e&&(n(t,e),e.isAlignOnce?e.enabled=!1:p._nodesWithWidget.push(t));for(var i=t._children,r=0;r<i.length;r++){var o=i[r];o._active&&s(o)}}function o(){var t=cc.director.getScene();if(t){if(p.isAligning=!0,p._nodesOrderDirty)p._nodesWithWidget.length=0,s(t),p._nodesOrderDirty=!1;else{var e,i,r=p._nodesWithWidget,o=r.length;for(e=0;e<o;e++)i=r[e],n(i,i._widget)}p.isAligning=!1}}var a=1,c=2,h=4,l=8,u=16,d=32,_=l|u|d,f=a|c|h,p=cc._widgetManager=e.exports={_AlignFlags:{TOP:a,MID:c,BOT:h,LEFT:l,CENTER:u,RIGHT:d},isAligning:!1,_nodesOrderDirty:!1,_nodesWithWidget:[],init:function(t){t.on(cc.Director.EVENT_BEFORE_VISIT,o)},add:function(t){t.node._widget=t,this._nodesOrderDirty=!0},remove:function(t){t.node._widget=null;var e=this._nodesWithWidget.indexOf(t.node);e>-1&&this._nodesWithWidget.splice(e,1)},_getParentSize:r}},{}],43:[function(t,e,i){function r(t,e){return t===e||t&&e&&(t.name===e.name||t._uuid===e._uuid)}var n=t("../../animation/animation-animator"),s=t("../../animation/animation-clip"),o=cc.Class({name:"cc.Animation","extends":t("./CCComponent"),editor:!1,ctor:function(){this._animator=null,this._nameToState={},this._didInit=!1,this._currentClip=null,this._listeners=[]},properties:{_defaultClip:{"default":null,type:s},defaultClip:{type:s,get:function(){return this._defaultClip},set:function(t){return},tooltip:"i18n:COMPONENT.animation.default_clip"},currentClip:{get:function(){return this._currentClip},set:function(t){this._currentClip=t},type:s,visible:!1},_clips:{"default":[],type:[s],tooltip:"i18n:COMPONENT.animation.clips",visible:!0},playOnLoad:{"default":!1,tooltip:"i18n:COMPONENT.animation.play_on_load"}},__preload:function(){if(this.enabled&&this.playOnLoad&&this._defaultClip){var t=this.getAnimationState(this._defaultClip.name);this._animator.playState(t)}},onEnable:function(){this.resume()},onDisable:function(){this.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(t,e){for(var i=this.playAdditive(t,e),r=this._animator.playingAnims,n=r.length;n>=0;n--)r[n]!==i&&this._animator.stopState(r[n]);return i},playAdditive:function(t,e){this._init();var i=this.getAnimationState(t||this._defaultClip.name);if(i){var r=this._animator;r.isPlaying&&i.isPlaying?i.isPaused?r.resumeState(i):(r.stopState(i),r.playState(i,e)):r.playState(i,e),this.currentClip=i.clip}return i},stop:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.stopState(e)}else this._animator.stop()},pause:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.pauseState(e)}else this._animator.pause()},resume:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.resumeState(e)}else this._animator.resume()},setCurrentTime:function(t,e){if(this._init(),e){var i=this._nameToState[e];i&&this._animator.setStateTime(i,t)}else for(var e in this._nameToState)i=this._nameToState[e],this._animator.setStateTime(i,t)},getAnimationState:function(t){this._init();var e=this._nameToState[t];return e&&!e.curveLoaded&&this._animator._reloadClip(e),e||null},addClip:function(t,e){if(!t)return void cc.warn("Invalid clip to add");this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),e=e||t.name;var i=this._nameToState[e];if(i){if(i.clip===t)return i;var r=this._clips.indexOf(i.clip);r!==-1&&this._clips.splice(r,1)}var n=new cc.AnimationState(t,e);return this._nameToState[e]=n,n},removeClip:function(t,e){if(!t)return void cc.warn("Invalid clip to remove");this._init();var i;for(var r in this._nameToState){i=this._nameToState[r];var n=i.clip;if(n===t)break}if(t===this._defaultClip){if(!e)return void cc.warn("clip is defaultClip, set force to true to force remove clip and animation state");this._defaultClip=null}if(i&&i.isPlaying){if(!e)return void cc.warn("animation state is playing, set force to true to force stop and remove clip and animation state");this.stop(i.name)}this._clips=this._clips.filter(function(e){return e!==t}),i&&delete this._nameToState[i.name]},sample:function(){this._init(),this._animator.sample()},on:function(t,e,i,r){this._init();for(var n=this._listeners,s=0,o=n.length;s<o;s++){var a=n[s];if(a[0]===t&&a[1]===e&&a[2]===i&&a[3]===r)return}for(var c=this._animator.playingAnims,h=0,l=c.length;h<l;h++)c[h].on(t,e,i,r);n.push([t,e,i,r])},off:function(t,e,i,r){this._init();for(var n=this._listeners,s=n.length-1;s>=0;s--){var o=n[s];if(o[0]===t&&o[1]===e&&o[2]===i&&o[3]===r){for(var a=this._animator.playingAnims,c=0,h=a.length;c<h;c++)a[c].off(t,e,i,r);n.splice(s,1)}}},_init:function(){this._didInit||(this._didInit=!0,this._animator=new n(this.node,this),this._createStates())},_createStates:function(){this._nameToState={};for(var t=null,e=!1,i=0;i<this._clips.length;++i){var n=this._clips[i];n&&(t=new cc.AnimationState(n),this._nameToState[t.name]=t,r(this._defaultClip,n)&&(e=t))}this._defaultClip&&!e&&(t=new cc.AnimationState(this._defaultClip),this._nameToState[t.name]=t)}});cc.Animation=e.exports=o},{"../../animation/animation-animator":4,"../../animation/animation-clip":5,"./CCComponent":46}],44:[function(t,e,i){var r=cc.audioEngine,n=cc.Class({name:"cc.AudioSource","extends":t("./CCComponent"),editor:!1,ctor:function(){this.audio=null},properties:{_clip:{"default":"",url:cc.AudioClip},_volume:1,_mute:!1,_loop:!1,isPlaying:{get:function(){return!cc.sys.isNative&&this.audio&&this.audio.getPlaying()},visible:!1},clip:{get:function(){return this._clip},set:function(t){this._clip=t},url:cc.AudioClip,tooltip:"i18n:COMPONENT.audio.clip",animatable:!1},volume:{get:function(){return this._volume},set:function(t){this._volume=t,this.audio&&(cc.sys.isNative?cc.audioEngine.setEffectsVolume(t):this.audio.setVolume(t))},tooltip:"i18n:COMPONENT.audio.volume"},mute:{get:function(){return this._mute},set:function(t){this._mute=t,this.audio&&(this._mute?this.audio.setVolume(0):this.audio.setVolume(this._volume))},animatable:!1,tooltip:"i18n:COMPONENT.audio.mute"},loop:{get:function(){return this._loop},set:function(t){this._loop=t,this.audio&&(this.audio.loop=this._loop)},animatable:!1,tooltip:"i18n:COMPONENT.audio.loop"},playOnLoad:{"default":!1,tooltip:"i18n:COMPONENT.audio.play_on_load",animatable:!1}},onEnable:function(){this.playOnLoad&&this.play()},onDisable:function(){this.stop()},onDestroy:function(){this.stop()},play:function(){if(this._clip){var t=this._mute?0:this._volume;this.audio=r.playEffect(this._clip,this._loop,t)}},stop:function(){this.audio&&cc.audioEngine.stopEffect(this.audio)},pause:function(){this.audio&&cc.audioEngine.pauseEffect(this.audio)},resume:function(){this.audio&&cc.audioEngine.resumeEffect(this.audio);
},rewind:function(){this.audio&&(this.stop(),this.play())}});cc.AudioSource=e.exports=n},{"./CCComponent":46}],45:[function(t,e,i){var r={getContentSize:function(){return cc.visibleRect},setContentSize:function(t){},_getWidth:function(){return this.getContentSize().width},_getHeight:function(){return this.getContentSize().height}},n=cc.Class({name:"cc.Canvas","extends":t("./CCComponent"),editor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()},tooltip:"i18n:COMPONENT.canvas.design_resolution"},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings())},tooltip:"i18n:COMPONENT.canvas.fit_height"},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings())},tooltip:"i18n:COMPONENT.canvas.fit_width"}},ctor:function(){this._thisOnResized=this.onResized.bind(this)},__preload:function(){if(n.instance)return cc.error("Can't init canvas '%s' because it conflicts with the existing '%s', the scene should only have one active canvas at the same time",this.node.name,n.instance.node.name);if(n.instance=this,this.node._sizeProvider);else this.node._sizeProvider=r;cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.addEventListener("resize",this._thisOnResized):cc.eventManager.addCustomListener("canvas-resize",this._thisOnResized),this.applySettings(),this.onResized()},onDestroy:function(){this.node._sizeProvider===r&&(this.node._sizeProvider=null),cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.removeEventListener("resize",this._thisOnResized):cc.eventManager.removeCustomListeners("canvas-resize",this._thisOnResized),n.instance===this&&(n.instance=null)},alignWithScreen:function(){var t,e=cc.visibleRect,i=!this.fitHeight&&!this.fitWidth,r=0,n=0;i&&(t=cc.view.getDesignResolutionSize(),r=.5*(t.width-e.width),n=.5*(t.height-e.height)),this.node.setPosition(.5*e.width+r,.5*e.height+n)},onResized:function(){this.alignWithScreen()},applySettings:function(){var t,e=cc.ResolutionPolicy;t=this.fitHeight&&this.fitWidth?e.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?e.FIXED_WIDTH:e.FIXED_HEIGHT:e.NO_BORDER;var i=this._designResolution;cc.view.setDesignResolutionSize(i.width,i.height,t)}});cc.Canvas=e.exports=n},{"./CCComponent":46}],46:[function(t,e,i){function r(t,e){var i=t._objFlags&l;if(e){if(!i){t.onEnable&&t.onEnable();var r=!t.node._activeInHierarchy;if(r)return;cc.director.getScheduler().resumeTarget(t),n(t,!0),t._objFlags|=l}}else i&&(t.onDisable&&t.onDisable(),cc.director.getScheduler().pauseTarget(t),n(t,!1),t._objFlags&=~l)}function n(t,e){!t.start||t._objFlags&p||(e?cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,A,t):cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,A,t)),(t.update||t.lateUpdate)&&(e?cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,S,t):(cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,S,t),cc.director.off(cc.Director.EVENT_COMPONENT_UPDATE,R,t),cc.director.off(cc.Director.EVENT_COMPONENT_LATE_UPDATE,O,t)))}function s(t){t._activeInHierarchy=!0;for(var e=t._components,i=0,r=e.length;i<r;++i){var n=e[i];!n||n._objFlags&d||"function"!=typeof n.__preload||(n.__preload(),n._objFlags|=d)}var o=t._children;for(i=0,r=o.length;i<r;++i){var a=o[i];a._active&&s(a)}}function o(t){t.__preload()}t("../platform/CCObject"),t("../CCNode");var a=new(t("../platform/id-generater"))("Comp"),c=t("../utils/misc"),h=cc.Object.Flags,l=h.IsOnEnableCalled,u=h.IsEditorOnEnableCalled,d=h.IsPreloadCalled,_=h.IsOnLoadStarted,f=h.IsOnLoadCalled,p=h.IsStartCalled,g=!1,m=!1,v=!1,y=!1,C=!1,T=!1,E=!1,x=!1,b=!1,S=function(){cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,S,this),this.update&&cc.director.on(cc.Director.EVENT_COMPONENT_UPDATE,R,this),this.lateUpdate&&cc.director.on(cc.Director.EVENT_COMPONENT_LATE_UPDATE,O,this)},A=function(){cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,A,this),this.start(),this._objFlags|=p},R=function(t){this.update(t.detail)},O=function(t){this.lateUpdate(t.detail)},I=cc.Class({name:"cc.Component","extends":cc.Object,ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId()},properties:{node:{"default":null,visible:!1},name:{get:function(){if(this._name)return this._name;var t=cc.js.getClassName(this),e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t},visible:!1},_id:{"default":"",serializable:!1},uuid:{get:function(){var t=this._id;return t||(t=this._id=a.getNewId()),t},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy&&r(this,t))},visible:!1},enabledInHierarchy:{get:function(){return(this._objFlags&l)>0},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&f}},__eventTargets:{"default":[],serializable:!1}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},getComponents:function(t){return this.node.getComponents(t)},getComponentInChildren:function(t){return this.node.getComponentInChildren(t)},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&r(this,!1)},__onNodeActivated:function(t){if(!t||this._objFlags&_||(this._objFlags|=_,this.onLoad&&this.onLoad(),this._objFlags|=f),this._enabled){if(t){var e=!this.node._activeInHierarchy;if(e)return}r(this,t)}},_onPreDestroy:function(){var t,e,i;for(r(this,!1),this.unscheduleAllCallbacks(),t=0,e=this.__eventTargets.length;t<e;++t)i=this.__eventTargets[t],i&&i.targetOff(this);this.__eventTargets.length=0,cc.eventManager.removeListeners(this),this.onDestroy&&this._objFlags&f&&this.onDestroy(),this.node._removeComponent(this)},_destruct:c.destructIgnoreId,_instantiate:function(){var t=cc.instantiate._clone(this,this);return t.node=null,t},isRunning:function(){return this.enabledInHierarchy},schedule:function(t,e,i,r){cc.assert(t,cc._LogInfos.Node.schedule),cc.assert(e>=0,cc._LogInfos.Node.schedule_2),e=e||0,i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,r=r||0,cc.director.getScheduler().schedule(t,this,e,i,r,!this.enabledInHierarchy)},scheduleOnce:function(t,e){this.schedule(t,0,0,e)},unschedule:function(t){t&&cc.director.getScheduler().unschedule(t,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});I._requireComponent=null,Object.defineProperty(I,"_registerEditorProps",{value:function(t,e){var i=e.requireComponent;i&&(t._requireComponent=i)}}),Object.defineProperties(I,{_callPreloadOnNode:{value:s},_callPreloadOnComponent:{value:o}}),I.prototype.__scriptUuid="",cc.Component=e.exports=I},{"../CCNode":28,"../platform/CCObject":85,"../platform/id-generater":95,"../utils/misc":120}],47:[function(t,e,i){cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{"default":null,type:cc.Node},component:{"default":""},handler:{"default":""}},statics:{emitEvents:function(t){"use strict";for(var e=0,i=t.length;e<i;e++){var r=t[e];!r instanceof cc.Component.EventHandler||r.emit(Array.prototype.slice.call(arguments,1))}}},emit:function(t){var e=this.target;if(cc.isValid(e)){var i=e.getComponent(this.component);if(cc.isValid(i)){var r=i[this.handler];"function"==typeof r&&r.apply(i,t)}}}})},{}],48:[function(t,e,i){var r=cc.Enum({RECT:0,ELLIPSE:1}),n=cc.Class({name:"cc.Mask","extends":cc._RendererInSG,editor:!1,properties:{_clippingStencil:{"default":null,serializable:!1},_type:0,_segements:64,type:{get:function(){return this._type},set:function(t){this._type=t,this._refreshStencil()},type:r},segements:{get:function(){return this._segements},set:function(t){t<3&&(t=3),this._segements=t,this._refreshStencil()},type:cc.Integer}},statics:{Type:r},_createSgNode:function(){return this._clippingStencil=new cc.DrawNode,new cc.ClippingNode(this._clippingStencil)},_initSgNode:function(){},_hitTest:function(t){var e=this.node.getContentSize(),i=e.width,n=e.height,s=this.node.getNodeToWorldTransform();if(this._type===r.RECT){var o=cc.rect(0,0,i,n);cc._rectApplyAffineTransformIn(o,s);var a=t.x-o.x,c=o.x+o.width-t.x,h=t.y-o.y,l=o.y+o.height-t.y;return a>=0&&c>=0&&l>=0&&h>=0}var u=i/2,d=n/2,_=s.a*u+s.c*d+s.tx,f=s.b*u+s.d*d+s.ty,p=t.x-_,g=t.y-f;return p*p/(u*u)+g*g/(d*d)<1},onEnable:function(){this._refreshStencil(),this._super(),this.node.on("size-changed",this._refreshStencil,this),this.node.on("anchor-changed",this._refreshStencil,this)},onDisable:function(){this._super(),this.node.off("size-changed",this._refreshStencil,this),this.node.off("anchor-changed",this._refreshStencil,this)},onDestroy:!1,_calculateCircle:function(t,e,i){for(var r=[],n=2*Math.PI/i,s=0;s<i;++s)r.push(cc.v2(e.x*Math.cos(n*s)+t.x,e.y*Math.sin(n*s)+t.y));return r},_refreshStencil:function(){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),i=t.width,n=t.height,s=-i*e.x,o=-n*e.y,a=cc.color(255,255,255,0);if(this._clippingStencil.clear(),this._type===r.RECT){var c=[cc.v2(s,o),cc.v2(s+i,o),cc.v2(s+i,o+n),cc.v2(s,o+n)];this._clippingStencil.drawPoly(c,a,0,a)}else{var h=cc.v2(s+i/2,o+n/2),l={x:i/2,y:n/2},u=this._segements;this._clippingStencil.drawPoly(this._calculateCircle(h,l,u),a,0,a)}}});cc.Mask=e.exports=n},{}],49:[function(t,e,i){var r=cc.Class({"extends":t("./CCSGComponent"),ctor:function(){var t=this._sgNode=this._createSgNode();t.setVisible(!1),this._plainNode=new _ccsg.Node},__preload:function(){this._initSgNode()},onEnable:function(){this._replaceSgNode(this._sgNode)},onDisable:function(){this._replaceSgNode(this._plainNode)},onDestroy:function(){this._removeSgNode()},_replaceSgNode:function(t){var e=this.node,i=e._sgNode;i._entity=null;var r=i.getChildren().slice();i.removeAllChildren(!1),t.getChildrenCount()>0&&t.removeAllChildren(!1);for(var n=0,s=r.length;n<s;++n)t.addChild(r[n]);var o=i.getParent();o&&(o.removeChild(i),o.addChild(t),t.arrivalOrder=i.arrivalOrder,cc.renderer.childrenOrderDirty=o._reorderChildDirty=!0),e._sgNode=t,e._sgNode._entity=e,e._updateSgNode()}});cc._RendererInSG=e.exports=r},{"./CCSGComponent":51}],50:[function(t,e,i){var r=cc.Class({"extends":t("./CCSGComponent"),ctor:function(){var t=this._sgNode=this._createSgNode();t&&t.setVisible(!1)},__preload:function(){this._initSgNode(),this._registSizeProvider(),this._appendSgNode(this._sgNode)},onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),this._removeSgNode()},_appendSgNode:function(t){if(t){var e=this.node;t.setColor(e._color),e._cascadeOpacityEnabled||t.setOpacity(e._opacity),t.setAnchorPoint(e._anchorPoint),t.ignoreAnchorPointForPosition(e.__ignoreAnchor),t.setOpacityModifyRGB(e._opacityModifyRGB),t.setLocalZOrder(-1);var i=e._sgNode;i.addChild(t)}}});cc._RendererUnderSG=e.exports=r},{"./CCSGComponent":51}],51:[function(t,e,i){var r=t("../utils/scene-graph-helper"),n=cc.Class({"extends":t("./CCComponent"),editor:!1,properties:{_sgNode:{"default":null,serializable:!1}},_createSgNode:null,_initSgNode:null,_removeSgNode:r.removeSgNode,_registSizeProvider:function(){if(this.node._sizeProvider);else this.node._sizeProvider=this._sgNode}});cc._SGComponent=e.exports=n},{"../utils/scene-graph-helper":121,"./CCComponent":46}],52:[function(t,e,i){var r=cc.Scale9Sprite.RenderingType,n=cc.Scale9Sprite.FillType,s=cc.BlendFunc.BlendFactor,o=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),a=cc.Class({name:"cc.Sprite","extends":t("./CCRendererUnderSG"),editor:!1,ctor:function(){this._blendFunc=new cc.BlendFunc(this._srcBlendFactor,this._dstBlendFactor)},properties:{_spriteFrame:{"default":null,type:cc.SpriteFrame},_type:r.SIMPLE,_sizeMode:o.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_srcBlendFactor:s.SRC_ALPHA,_dstBlendFactor:s.ONE_MINUS_SRC_ALPHA,_atlas:{"default":null,type:cc.SpriteAtlas,tooltip:"i18n:COMPONENT.sprite.atlas",editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(t,e){if(this._spriteFrame!==t){var i=this._spriteFrame;this._spriteFrame=t,this._applySpriteFrame(i)}},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(t){this._type=t,this._sgNode.setRenderingType(this._type),this._applyCapInset()},type:r,animatable:!1,tooltip:"i18n:COMPONENT.sprite.type"},fillType:{get:function(){return this._fillType},set:function(t){this._fillType=t,this._sgNode&&this._sgNode.setFillType(t)},type:n,tooltip:"i18n:COMPONENT.sprite.fill_type"},fillCenter:{get:function(){return this._fillCenter},set:function(t){this._fillCenter=cc.v2(t),this._sgNode&&this._sgNode.setFillCenter(this._fillCenter)},tooltip:"i18n:COMPONENT.sprite.fill_center"},fillStart:{get:function(){return this._fillStart},set:function(t){this._fillStart=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillStart(t)},tooltip:"i18n:COMPONENT.sprite.fill_start"},fillRange:{get:function(){return this._fillRange},set:function(t){this._fillRange=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillRange(t)},tooltip:"i18n:COMPONENT.sprite.fill_range"},trim:{get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._sgNode.enableTrimmedContentSize(t))},animatable:!1,tooltip:"i18n:COMPONENT.sprite.trim"},srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t,this._blendFunc.src=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:s,tooltip:"i18n:COMPONENT.sprite.src_blend_factor"},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor=t,this._blendFunc.dst=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:s,tooltip:"i18n:COMPONENT.sprite.dst_blend_factor"},sizeMode:{get:function(){return this._sizeMode},set:function(t){this._sizeMode=t,t!==o.CUSTOM&&this._applySpriteSize()},animatable:!1,type:o,tooltip:"i18n:COMPONENT.sprite.size_mode"}},statics:{FillType:n,Type:r,SizeMode:o},setVisible:function(t){this.enabled=t},setInsetLeft:function(t){this._sgNode.setInsetLeft(t)},getInsetLeft:function(){return this._sgNode.getInsetLeft()},setInsetTop:function(t){this._sgNode.setInsetTop(t)},getInsetTop:function(){return this._sgNode.getInsetTop()},setInsetRight:function(t){this._sgNode.setInsetRight(t)},getInsetRight:function(){return this._sgNode.getInsetRight()},setInsetBottom:function(t){this._sgNode.setInsetBottom(t)},getInsetBottom:function(){return this._sgNode.getInsetBottom()},__preload:!1,onEnable:function(){this._sgNode&&this._spriteFrame&&this._spriteFrame.textureLoaded()&&this._sgNode.setVisible(!0)},onDestroy:!1,_applyAtlas:!1,_applyCapInset:function(){if(this._type===r.SLICED&&this._spriteFrame){var t=this._sgNode;t.setInsetTop(this._spriteFrame.insetTop),t.setInsetBottom(this._spriteFrame.insetBottom),t.setInsetRight(this._spriteFrame.insetRight),t.setInsetLeft(this._spriteFrame.insetLeft)}},_applySpriteSize:function(){if(o.CUSTOM!==this._sizeMode&&this._spriteFrame)if(o.RAW===this._sizeMode){var t=this._spriteFrame.getOriginalSize();this.node.setContentSize(t)}else if(o.TRIMMED===this._sizeMode){var e=this._spriteFrame.getRect();this.node.setContentSize(cc.size(e.width,e.height))}else this.node.setContentSize(this.node.getContentSize(!0));else this.node.setContentSize(this.node.getContentSize(!0))},_onSpriteFrameLoaded:function(t){var e=this,i=this._sgNode;i.setSpriteFrame(e._spriteFrame),e._applyCapInset(),e._applySpriteSize(),e.enabledInHierarchy&&!i.isVisible()&&i.setVisible(!0)},_applySpriteFrame:function(t){var e=this._sgNode;t&&t.off&&t.off("load",this._onSpriteFrameLoaded,this);var i=this._spriteFrame;i?i.textureLoaded()?this._onSpriteFrameLoaded(null):(i.once("load",this._onSpriteFrameLoaded,this),i.ensureLoadTexture()):e.setVisible(!1)},_createSgNode:function(){return new cc.Scale9Sprite},_initSgNode:function(){this._applySpriteFrame(null);var t=this._sgNode;t.setContentSize(this.node.getContentSize(!0)),this._applySpriteSize(),t.setRenderingType(this._type),t.setFillType(this._fillType),t.setFillCenter(this._fillCenter),t.setFillStart(this._fillStart),t.setFillRange(this._fillRange),t.enableTrimmedContentSize(this._isTrimmedMode),this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,t.setBlendFunc(this._blendFunc)},_resized:!1}),c=t("../utils/misc"),h=["atlas","capInsets","insetLeft","insetTop","insetRight","insetBottom"],l={type:[null,"setRenderingType"]};c.propertyDefine(a,h,l),cc.Sprite=e.exports=a},{"../utils/misc":120,"./CCRendererUnderSG":50}],53:[function(t,e,i){var r=_ccsg.WebView.EventType,n=cc.Class({name:"cc.WebView","extends":cc._RendererUnderSG,editor:!1,properties:{_useOriginalSize:!0,_url:"",url:{type:String,tooltip:"i18n:COMPONENT.webview.url",get:function(){return this._url},set:function(t){this._url=t;var e=this._sgNode;e&&e.loadURL(t)}},webviewEvents:{"default":[],type:cc.Component.EventHandler}},statics:{EventType:r},onLoad:!1,_createSgNode:function(){return new _ccsg.WebView},_initSgNode:function(){var t=this._sgNode;t&&(t.createDomElementIfNeeded(),t.setEventListener(r.LOADED,this._onWebViewLoaded.bind(this)),t.setEventListener(r.LOADING,this._onWebViewLoading.bind(this)),t.setEventListener(r.ERROR,this._onWebViewLoadError.bind(this)),t.loadURL(this._url),t.setContentSize(this.node.getContentSize()))},_onWebViewLoaded:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,r.LOADED)},_onWebViewLoading:function(){return cc.Component.EventHandler.emitEvents(this.webviewEvents,this,r.LOADING),!0},_onWebViewLoadError:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,r.ERROR)}});cc.WebView=e.exports=n},{}],54:[function(t,e,i){var r=t("../base-ui/CCWidgetManager"),n=r._AlignFlags,s=n.TOP,o=n.MID,a=n.BOT,c=n.LEFT,h=n.CENTER,l=n.RIGHT,u=s|a,d=c|l,_=cc.Class({name:"cc.Widget","extends":t("./CCComponent"),editor:!1,properties:{isAlignTop:{get:function(){return(this._alignFlags&s)>0},set:function(t){this._setAlign(s,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_top"},isAlignVerticalCenter:{get:function(){return(this._alignFlags&o)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=o):this._alignFlags&=~o},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_v_center"},isAlignBottom:{get:function(){return(this._alignFlags&a)>0},set:function(t){this._setAlign(a,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_bottom"},isAlignLeft:{get:function(){return(this._alignFlags&c)>0},set:function(t){this._setAlign(c,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_left"},isAlignHorizontalCenter:{get:function(){return(this._alignFlags&h)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=h):this._alignFlags&=~h},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_h_center"},isAlignRight:{get:function(){return(this._alignFlags&l)>0},set:function(t){this._setAlign(l,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_right"},isStretchWidth:{get:function(){return(this._alignFlags&d)===d},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&u)===u},visible:!1},top:{get:function(){return this._top},set:function(t){this._top=t},tooltip:"i18n:COMPONENT.widget.top"},bottom:{get:function(){return this._bottom},set:function(t){this._bottom=t},tooltip:"i18n:COMPONENT.widget.bottom"},left:{get:function(){return this._left},set:function(t){this._left=t},tooltip:"i18n:COMPONENT.widget.left"},right:{get:function(){return this._right},set:function(t){this._right=t},tooltip:"i18n:COMPONENT.widget.right"},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(t){this._isAbsTop=t},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom=t},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft=t},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(t){this._isAbsRight=t},animatable:!1},isAlignOnce:{"default":!0,tooltip:"i18n:COMPONENT.widget.align_once",displayName:"AlignOnce"},_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_originalWidth:0,_originalHeight:0},onEnable:function(){r.add(this)},onDisable:function(){r.remove(this)},_setAlign:function(t,e){var i=(this._alignFlags&t)>0;if(e!=i){var r=(t&d)>0;e?(this._alignFlags|=t,r?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(r?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~t)}}});cc.Widget=e.exports=_},{"../base-ui/CCWidgetManager":42,"./CCComponent":46}],55:[function(t,e,i){t("./CCComponent"),t("./CCRendererInSG"),t("./CCRendererUnderSG"),t("./CCComponentEventHandler"),t("./missing-script"),e.exports=[t("./CCSprite"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCLabel"),t("./CCProgressBar"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCLayout"),t("./CCEditBox"),t("./CCVideoPlayer"),t("./CCWebView"),t("./CCSpriteDistortion"),t("./CCLabelOutline")]},{"./CCAnimation":43,"./CCAudioSource":44,"./CCButton":165,"./CCCanvas":45,"./CCComponent":46,"./CCComponentEventHandler":47,"./CCEditBox":165,"./CCLabel":165,"./CCLabelOutline":165,"./CCLayout":165,"./CCMask":48,"./CCProgressBar":165,"./CCRendererInSG":49,"./CCRendererUnderSG":50,"./CCScrollBar":165,"./CCScrollView":165,"./CCSprite":52,"./CCSpriteDistortion":165,"./CCVideoPlayer":165,"./CCWebView":53,"./CCWidget":54,"./missing-script":56}],56:[function(t,e,i){var r=cc.js,n=cc.Class({name:"cc.MissingClass",properties:{_$erialized:{"default":null,visible:!1,editorOnly:!0}}}),s=cc.Class({name:"cc.MissingScript","extends":cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{"default":!1,serializable:!1},_$erialized:{"default":null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(t,e){var i=r._getClassById(t);return i?i:t?(cc.deserialize.reportMissingClass(t),e.node,n):null}},onLoad:function(){cc.warn('Script attached to "%s" is missing or invalid.',this.node.name)}});cc._MissingScript=e.exports=s},{}],57:[function(t,e,i){cc.EventListener=cc._Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_target:null,_paused:!0,_isEnabled:!0,ctor:function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||""},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._target=t,this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.FOCUS=7,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e;var i=this,r=function(t){null!==i._onCustomEvent&&i._onCustomEvent(t)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,r)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var t=this,e=function(e){var i=cc.Event.EventMouse;switch(e._eventType){case i.DOWN:t.onMouseDown&&t.onMouseDown(e);break;case i.UP:t.onMouseUp&&t.onMouseUp(e);break;case i.MOVE:t.onMouseMove&&t.onMouseMove(e);break;case i.SCROLL:t.onMouseScroll&&t.onMouseScroll(e)}};cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,e)},clone:function(){var t=new cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.log(cc._LogInfos._checkEventListenerAvailable.touchOneByOne),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.log(cc._LogInfos._checkEventListenerAvailable.touchAllAtOnce),!1)}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc.EventListener.create=function(t){cc.assert(t&&t.event,cc._LogInfos.EventListener.create);var e=t.event;delete t.event;var i=null;e===cc.EventListener.TOUCH_ONE_BY_ONE?i=new cc._EventListenerTouchOneByOne:e===cc.EventListener.TOUCH_ALL_AT_ONCE?i=new cc._EventListenerTouchAllAtOnce:e===cc.EventListener.MOUSE?i=new cc._EventListenerMouse:e===cc.EventListener.CUSTOM?(i=new cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):e===cc.EventListener.KEYBOARD?i=new cc._EventListenerKeyboard:e===cc.EventListener.ACCELERATION?(i=new cc._EventListenerAcceleration(t.callback),delete t.callback):e===cc.EventListener.FOCUS&&(i=new cc._EventListenerFocus);for(var r in t)i[r]=t[r];return i},cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var t=new cc._EventListenerFocus;return t.onFocusChanged=this.onFocusChanged,t},checkAvailable:function(){return!!this.onFocusChanged||(cc.log("Invalid EventListenerFocus!"),!1)},onFocusChanged:null,ctor:function(){var t=function(t){this.onFocusChanged&&this.onFocusChanged(t._widgetLoseFocus,t._widgetGetFocus)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,t)}}),cc._EventListenerFocus.LISTENER_ID="__cc_focus_event",cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t;var e=this,i=function(t){e._onAccelerationEvent(t._acc,t)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,i)},checkAvailable:function(){return cc.assert(this._onAccelerationEvent,cc._LogInfos._checkEventListenerAvailable.acceleration),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var t=this,e=function(e){e._isPressed?t.onKeyPressed&&t.onKeyPressed(e._keyCode,e):t.onKeyReleased&&t.onKeyReleased(e._keyCode,e)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,e)},clone:function(){var t=new cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.log(cc._LogInfos._checkEventListenerAvailable.keyboard),!1)}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard"},{}],58:[function(t,e,i){var r=cc._Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),n=function(t){var e=cc.Event,i=t.getType();return i===e.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:i===e.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:i.startsWith(e.MOUSE)?cc._EventListenerMouse.LISTENER_ID:i===e.FOCUS?cc._EventListenerFocus.LISTENER_ID:(i.startsWith(e.TOUCH)&&cc.log(cc._LogInfos._getListenerID),i)};cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[],_setDirtyForNode:function(t){if(void 0!==this._nodeListenersMap[t.__instanceId]&&this._dirtyNodes.push(t),t.getChildren)for(var e=t.getChildren(),i=0,r=e.length;i<r;i++)this._setDirtyForNode(e[i])},pauseTarget:function(t,e){var i,r,n=this._nodeListenersMap[t.__instanceId];if(n)for(i=0,r=n.length;i<r;i++)n[i]._setPaused(!0);if(e===!0){var s=t.getChildren();for(i=0,r=s.length;i<r;i++)this.pauseTarget(s[i],!0)}},resumeTarget:function(t,e){var i,r,n=this._nodeListenersMap[t.__instanceId];if(n)for(i=0,r=n.length;i<r;i++)n[i]._setPaused(!1);if(this._setDirtyForNode(t),e===!0&&t.getChildren){var s=t.getChildren();for(i=0,r=s.length;i<r;i++)this.resumeTarget(s[i],!0)}},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];if(i||(i=new r,this._listenersMap[e]=i),
i.push(t),0===t._getFixedPriority()){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var n=t._getSceneGraphPriority();null===n&&cc.log(cc._LogInfos.EventManager._forceAddEventListener),this._associateNodeAndEventListener(n,t),n.isRunning()&&this.resumeTarget(n)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,e,i=this._dirtyNodes,r=this._nodeListenersMap,n=0,s=i.length;n<s;n++)if(t=r[i[n].__instanceId])for(var o=0,a=t.length;o<a;o++)e=t[o],e&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,i=0;i<t.length;)e=t[i],e._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,e):++i},_removeListenersForListenerID:function(t){var e,i=this._listenersMap[t];if(i){var r=i.getFixedPriorityListeners(),n=i.getSceneGraphPriorityListeners();this._removeAllListenersInVector(n),this._removeAllListenersInVector(r),delete this._priorityDirtyFlagMap[t],this._inDispatch||(i.clear(),delete this._listenersMap[t])}var s,o=this._toAddedListeners;for(e=0;e<o.length;)s=o[e],s&&s._getListenerID()===t?cc.js.array.remove(o,s):++e},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;if(i[t]&&(e=i[t]),e!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY)){var r=cc.director.getScene();r&&this._sortListenersOfSceneGraphPriority(t,r)}},_sortListenersOfSceneGraphPriority:function(t,e){var i=this._getListeners(t);if(i){var r=i.getSceneGraphPriorityListeners();r&&0!==r.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),i.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=cc.eventManager._nodePriorityMap,r=t._getSceneGraphPriority(),n=e._getSceneGraphPriority();return e&&n&&i[n.__instanceId]?t&&r&&i[r.__instanceId]?i[n.__instanceId]-i[r.__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners();if(i&&0!==i.length){i.sort(this._sortListenersOfFixedPriorityAsc);for(var r=0,n=i.length;r<n&&!(i[r]._getFixedPriority()>=0);)++r;e.gt0Index=r}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e=this._listenersMap[t];if(e){var i,r,n,s=e.getFixedPriorityListeners(),o=e.getSceneGraphPriorityListeners(),a=this._toRemovedListeners;if(o)for(i=0;i<o.length;)r=o[i],r._isRegistered()?++i:(cc.js.array.remove(o,r),n=a.indexOf(r),n!==-1&&a.splice(n,1));if(s)for(i=0;i<s.length;)r=s[i],r._isRegistered()?++i:(cc.js.array.remove(s,r),n=a.indexOf(r),n!==-1&&a.splice(n,1));o&&0===o.length&&e.clearSceneGraphListeners(),s&&0===s.length&&e.clearFixedListeners()}},_updateListeners:function(t){var e=this._inDispatch;if(cc.assert(e>0,cc._LogInfos.EventManager._updateListeners),!(e>1)){t.getType().startsWith(cc.Event.TOUCH)?(this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(n(t)),cc.assert(1===e,cc._LogInfos.EventManager._updateListeners_2);var i=this._listenersMap,r=this._priorityDirtyFlagMap;for(var s in i)i[s].empty()&&(delete r[s],delete i[s]);var o=this._toAddedListeners;if(0!==o.length){for(var a=0,c=o.length;a<c;a++)this._forceAddEventListener(o[a]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var i=t[e],r=this._listenersMap[i._getListenerID()];if(r){var n,s=r.getFixedPriorityListeners(),o=r.getSceneGraphPriorityListeners();o&&(n=o.indexOf(i),o.splice(n,1)),s&&(n=s.indexOf(i),s.splice(n,1))}}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var i=e.event,r=i.currentTouch;i.currentTarget=t._node;var n,s=!1,o=i.getEventCode(),a=cc.Event.EventTouch;return o===a.BEGAN?t.onTouchBegan&&(s=t.onTouchBegan(r,i),s&&t._registered&&t._claimedTouches.push(r)):t._claimedTouches.length>0&&(n=t._claimedTouches.indexOf(r))!==-1&&(s=!0,o===a.MOVED&&t.onTouchMoved?t.onTouchMoved(r,i):o===a.ENDED?(t.onTouchEnded&&t.onTouchEnded(r,i),t._registered&&t._claimedTouches.splice(n,1)):o===a.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(r,i),t._registered&&t._claimedTouches.splice(n,1))),i.isStopped()?(cc.eventManager._updateListeners(i),!0):!!(s&&t._registered&&t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(r,1),!0)},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),i=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==e||null!==i){var r=t.getTouches(),n=cc.js.array.copy(r),s={event:t,needsMutableSet:e&&i,touches:n,selTouch:null};if(e)for(var o=0;o<r.length;o++)if(t.currentTouch=r[o],this._dispatchEventToListeners(e,this._onTouchEventCallback,s),t.isStopped())return;i&&n.length>0&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:n}),t.isStopped())||this._updateListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.Event.EventTouch,r=e.event,n=e.touches,s=r.getEventCode();return r.currentTarget=t._node,s===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(n,r):s===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(n,r):s===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(n,r):s===i.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(n,r),!!r.isStopped()&&(cc.eventManager._updateListeners(r),!0)},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i||(i=[],this._nodeListenersMap[t.__instanceId]=i),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i&&(cc.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,e,i){var r,n,s=!1,o=t.getFixedPriorityListeners(),a=t.getSceneGraphPriorityListeners(),c=0;if(o&&0!==o.length)for(;c<t.gt0Index;++c)if(n=o[c],n.isEnabled()&&!n._isPaused()&&n._isRegistered()&&e(n,i)){s=!0;break}if(a&&!s)for(r=0;r<a.length;r++)if(n=a[r],n.isEnabled()&&!n._isPaused()&&n._isRegistered()&&e(n,i)){s=!0;break}if(o&&!s)for(;c<o.length;++c)if(n=o[c],n.isEnabled()&&!n._isPaused()&&n._isRegistered()&&e(n,i)){s=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t]},_visitTarget:function(t,e){t._reorderChildDirty&&t.sortAllChildren();var i=t.getChildren(),r=0,n=i.length,s=this._globalZOrderNodeMap,o=this._nodeListenersMap;if(n>0){for(var a;r<n&&(a=i[r],a&&a.getLocalZOrder()<0);r++)this._visitTarget(a,!1);for(void 0!==o[t.__instanceId]&&(s[t.getGlobalZOrder()]||(s[t.getGlobalZOrder()]=[]),s[t.getGlobalZOrder()].push(t.__instanceId));r<n;r++)a=i[r],a&&this._visitTarget(a,!1)}else void 0!==o[t.__instanceId]&&(s[t.getGlobalZOrder()]||(s[t.getGlobalZOrder()]=[]),s[t.getGlobalZOrder()].push(t.__instanceId));if(e){var c=[];for(var h in s)c.push(h);c.sort(this._sortNumberAsc);var l,u,d=c.length,_=this._nodePriorityMap;for(r=0;r<d;r++)for(l=s[c[r]],u=0;u<l.length;u++)_[l[u]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},addListener:function(t,e){if(cc.assert(t&&e,cc._LogInfos.EventManager.addListener_2),t instanceof cc.EventListener){if(t._isRegistered())return void cc.log(cc._LogInfos.EventManager.addListener_4)}else cc.assert(!cc.js.isNumber(e),cc._LogInfos.EventManager.addListener_3),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(0===e)return void cc.log(cc._LogInfos.EventManager.addListener);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}},addCustomListener:function(t,e){var i=new cc._EventListenerCustom(t,e);return this.addListener(i,1),i},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(var r in i){var n=i[r],s=n.getFixedPriorityListeners(),o=n.getSceneGraphPriorityListeners();if(e=this._removeListenerInVector(o,t),e?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(s,t),e&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)),n.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[r]),e)break}if(!e)for(var a=this._toAddedListeners,c=0,h=a.length;c<h;c++){var l=a[c];if(l===t){cc.js.array.remove(a,l),l._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=0,r=t.length;i<r;i++){var n=t[i];if(n._onCustomEvent===e||n._onEvent===e)return n._setRegistered(!1),null!=n._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(n._getSceneGraphPriority(),n),n._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,n):this._toRemovedListeners.push(n),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=0,r=t.length;i<r;i++){var n=t[i];if(n===e)return n._setRegistered(!1),null!=n._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(n._getSceneGraphPriority(),n),n._setSceneGraphPriority(null)),0===this._inDispatch&&cc.js.array.remove(t,n),!0}return!1},removeListeners:function(t,e){var i,r=this;if(void 0!==t.__instanceId){delete r._nodePriorityMap[t.__instanceId],cc.js.array.remove(r._dirtyNodes,t);var i,n=r._nodeListenersMap[t.__instanceId];if(n){var s=cc.js.array.copy(n);for(i=0;i<s.length;i++)r.removeListener(s[i]);delete r._nodeListenersMap[t.__instanceId]}var o=r._toAddedListeners;for(i=0;i<o.length;){var a=o[i];a._getSceneGraphPriority()===t?(a._setSceneGraphPriority(null),a._setRegistered(!1),o.splice(i,1)):++i}if(e===!0){var c,h=t.getChildren();for(i=0,c=h.length;i<c;i++)r.removeListeners(h[i],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?r._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):t===cc.EventListener.TOUCH_ALL_AT_ONCE?r._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===cc.EventListener.MOUSE?r._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):t===cc.EventListener.ACCELERATION?r._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):t===cc.EventListener.KEYBOARD?r._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.EventManager.removeListeners)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)e.indexOf(i)===-1&&this._removeListenersForListenerID(i)},setPriority:function(t,e){if(null!=t){var i=this._listenersMap;for(var r in i){var n=i[r],s=n.getFixedPriorityListeners();if(s){var o=s.indexOf(t);if(o!==-1)return null!=t._getSceneGraphPriority()&&cc.log(cc._LogInfos.EventManager.setPriority),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;var e=n(t);this._sortEventListeners(e);var i=this._listenersMap[e];null!=i&&this._dispatchEventToListeners(i,this._onListenerCallback,t),this._updateListeners(t),this._inDispatch--}},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var i=new cc.Event.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)}}},{}],59:[function(t,e,i){var r=cc.js,n=cc.Event;cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration";var s=function(t,e){cc.Event.call(this,cc.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0};r.extend(s,cc.Event),r.mixin(s.prototype,{setScrollData:function(t,e){this._scrollX=t,this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(t,e){this._x=t,this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(t,e){this._prevX=t,this._prevY=e},getPreviousLocation:function(){return{x:this._prevX,y:this._prevY}},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(t){this._button=t},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}}),s.NONE=0,s.DOWN=1,s.UP=2,s.MOVE=3,s.SCROLL=4,s.BUTTON_LEFT=0,s.BUTTON_RIGHT=2,s.BUTTON_MIDDLE=1,s.BUTTON_4=3,s.BUTTON_5=4,s.BUTTON_6=5,s.BUTTON_7=6,s.BUTTON_8=7;var o=function(t,e){cc.Event.call(this,cc.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.currentTouch=null};r.extend(o,cc.Event),r.mixin(o.prototype,{getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(t){this._eventCode=t},_setTouches:function(t){this._touches=t},setLocation:function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},getLocation:function(){return this.touch?this.touch.getLocation():cc.v2()},getLocationInView:function(){return this.touch?this.touch.getLocationInView():cc.v2()},getPreviousLocation:function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},getStartLocation:function(){return this.touch?this.touch.getStartLocation():cc.v2()},getID:function(){return this.touch?this.touch.getID():null},getDelta:function(){return this.touch?this.touch.getDelta():cc.v2()},getDeltaX:function(){return this.touch?this.touch.getDelta().x:0},getDeltaY:function(){return this.touch?this.touch.getDelta().y:0},getLocationX:function(){return this.touch?this.touch.getLocationX():0},getLocationY:function(){return this.touch?this.touch.getLocationY():0}}),o.MAX_TOUCHES=5,o.BEGAN=0,o.MOVED=1,o.ENDED=2,o.CANCELED=3;var a=function(t,e){cc.Event.call(this,n.ACCELERATION,e),this._acc=t};r.extend(a,cc.Event);var c=function(t,e,i){cc.Event.call(this,n.KEYBOARD,i),this._keyCode=t,this._isPressed=e};r.extend(c,cc.Event),cc.Event.EventMouse=s,cc.Event.EventTouch=o,cc.Event.EventAcceleration=a,cc.Event.EventKeyboard=c,e.exports=n},{}],60:[function(t,e,i){cc.Touch=cc._Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(t,e,i){this.setTouchInfo(i,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:cc.view._designResolutionSize.height-this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:cc.view._designResolutionSize.height-this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:cc.view._designResolutionSize.height-this._startPoint.y}},getID:function(){return this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.p(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){void 0===e?this._prevPoint=cc.p(t.x,t.y):this._prevPoint=cc.p(t||0,e||0)}})},{}],61:[function(t,e,i){t("./CCTouch"),t("./CCSystemEvent"),t("./CCEventListener"),t("./CCEventManager")},{"./CCEventListener":57,"./CCEventManager":58,"./CCSystemEvent":59,"./CCTouch":60}],62:[function(t,e,i){function r(){s.call(this),this._invoking={},this._toRemove={},this._toRemoveAll=null}var n=cc.js,s=t("../platform/callbacks-invoker").CallbacksHandler,o=s.REMOVE_PLACEHOLDER;n.extend(r,s),r.prototype.invoke=function(t){var e,i,r,n,s,a=t.type,c=this._callbackTable[a];if(this._invoking[a]=!0,c)if(1===c.length)r=c[0],r!==o&&r.call(t.currentTarget,t);else if(i=c.length-1,a===cc.Director.EVENT_COMPONENT_UPDATE){var h=t.detail;for(e=1;e<=i;e+=2)n=c[e],n!==o&&n.update(h)}else for(e=0;e<=i;){r=c[e];var l=1;if(r!==o&&(n=c[e+1],s=n&&"object"==typeof n,s?(r.call(n,t),l=2):r.call(t.currentTarget,t),t._propagationImmediateStopped||e+l>i))break;e+=l}this._invoking[a]=!1,this._clearToRemove(a)},e.exports=r},{"../platform/callbacks-invoker":93}],63:[function(t,e,i){var r=t("./event-listeners");t("./event");var n=cc.js,s=new Array(16);s.length=0;var o=function(t,e){var i,r;for(e.target=t,s.length=0,t._getCapturingTargets(e.type,s),e.eventPhase=1,r=s.length-1;r>=0;--r)if(i=s[r],i._isTargetActive(e.type)&&i._capturingListeners&&(e.currentTarget=i,i._capturingListeners.invoke(e),e._propagationStopped))return void(s.length=0);if(s.length=0,t._isTargetActive(e.type)&&(e.eventPhase=2,e.currentTarget=t,t._capturingListeners&&t._capturingListeners.invoke(e),!e._propagationImmediateStopped&&t._bubblingListeners&&t._bubblingListeners.invoke(e)),!e._propagationStopped&&e.bubbles)for(t._getBubblingTargets(e.type,s),e.eventPhase=3,r=0;r<s.length;++r)if(i=s[r],i._isTargetActive(e.type)&&i._bubblingListeners&&(e.currentTarget=i,i._bubblingListeners.invoke(e),e._propagationStopped))return void(s.length=0);s.length=0},a=function(){this._capturingListeners=null,this._bubblingListeners=null};n.mixin(a.prototype,{hasEventListener:function(t,e){return!!(e&&this._capturingListeners&&this._capturingListeners.has(t))||!(e||!this._bubblingListeners||!this._bubblingListeners.has(t))},on:function(t,e,i,n){if("boolean"==typeof i?(n=i,i=void 0):n=!!n,!e)return void cc.error("Callback of event must be non-nil");var s=null;return s=n?this._capturingListeners=this._capturingListeners||new r:this._bubblingListeners=this._bubblingListeners||new r,s.has(t,e,i)||(s.add(t,e,i),i&&i.__eventTargets&&i.__eventTargets.push(this)),e},off:function(t,e,i,r){if("boolean"==typeof i?(r=i,i=void 0):r=!!r,e){var n=r?this._capturingListeners:this._bubblingListeners;if(n&&(n.remove(t,e,i),i&&i.__eventTargets)){var s=i.__eventTargets.indexOf(this);i.__eventTargets.splice(s,1)}}},targetOff:function(t){this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t)},once:function(t,e,i,r){var n=this,s=function(o){n.off(t,s,i,r),e.call(this,o)};this.on(t,s,i,r)},dispatchEvent:function(t){o(this,t),s.length=0},emit:function(t,e){var i=this._capturingListeners&&this._capturingListeners._callbackTable[t],r=this._bubblingListeners&&this._bubblingListeners._callbackTable[t];if(i&&0!==i.length||r&&0!==r.length){var n=new cc.Event.EventCustom(t);n.detail=e,n.eventPhase=2,n.currentTarget=this,i&&this._capturingListeners.invoke(n),r&&!n._propagationImmediateStopped&&this._bubblingListeners.invoke(n)}},_isTargetActive:function(t){return!0},_getCapturingTargets:function(t,e){},_getBubblingTargets:function(t,e){}}),a.prototype._EventTargetOn=a.prototype.on,a.prototype._EventTargetOnce=a.prototype.once,a.prototype._EventTargetOff=a.prototype.off,a.prototype._EventTargetTargetOff=a.prototype.targetOff,cc.EventTarget=e.exports=a},{"./event":64,"./event-listeners":62}],64:[function(t,e,i){var r=t("../platform/js");cc.Event=function(t,e){this.type=t,this.bubbles=!!e,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;var n=function(t,e){cc.Event.call(this,t,e),this.detail=null};r.extend(n,cc.Event),r.mixin(n.prototype,{setUserData:function(t){this.detail=t},getUserData:function(){return this.detail},getEventName:cc.Event.prototype.getType}),cc.Event.EventCustom=n,e.exports=cc.Event},{"../platform/js":98}],65:[function(t,e,i){t("./event.js"),t("./event-listeners.js"),t("./event-target.js")},{"./event-listeners.js":62,"./event-target.js":63,"./event.js":64}],66:[function(t,e,i){t("./platform"),t("./assets"),t("./sprites/CCSpriteFrameCache"),t("./CCNode"),t("./CCScene"),t("./components"),t("./graphics"),t("./collider"),t("./base-ui/CCWidgetManager")},{"./CCNode":28,"./CCScene":29,"./assets":41,"./base-ui/CCWidgetManager":42,"./collider":165,"./components":55,"./graphics":165,"./platform":96,"./sprites/CCSpriteFrameCache":110}],67:[function(t,e,i){var r=t("../platform/js"),n=t("./pipeline"),s=t("./downloader"),o=t("./loader"),a=t("./asset-table"),c=t("../platform/utils").callInNextTick,h=new s,l=new o,u=new a;cc.loader=new n([h,l]),r.mixin(cc.loader,{downloader:h,loader:l,getXMLHttpRequest:n.getXMLHttpRequest,addDownloadHandlers:function(t){h.addHandlers(t)},addLoadHandlers:function(t){l.addHandlers(t)},load:function(t,e,i){function r(t){a[t.id]=t,t.error&&(o=o||[],o.push(t.id)),l++,e&&e.call(n,l,h,t);for(var r in a)if(!a[r])return;i&&c(function(){s?i.call(n,t.error,t.content):i.call(n,o,n._items),i=null})}void 0===i&&(i=e,e=null);var n=this,s=!1;if(t instanceof Array||(t=t?[t]:[],s=!0),0===t.length)return void(i&&c(function(){i.call(n,null,n._items),i=null}));for(var o=null,a={},h=0,l=0,u=0;u<t.length;++u){var d=t[u].id||t[u];if("string"==typeof d){var _=this.getItem(d);!_||_&&!_.complete?(this._items.addListener(d,r),a[d]=null,h++):_&&_.complete&&(a[d]=_,h++,l++)}}if(h===l){var f=t[0].id||t[0],p=this._items.getContent(f),o=this._items.getError(f);i&&c(function(){s?i.call(n,o,p):i.call(n,null,n._items),i=null})}else this.flowIn(t)},_resources:u,_getResUuid:function(t,e){var i=u.getUuid(t,e);if(!i){var r=cc.path.extname(t);r&&(t=t.slice(0,-r.length),i=u.getUuid(t,e),i&&cc.warn("loadRes: should not specify the extname in "+t+r))}return i},loadRes:function(t,e,i){i||!e||cc.isChildClassOf(e,cc.RawAsset)||(i=e,e=null);var r=this._getResUuid(t,e);r?this.load({id:r,type:"uuid",uuid:r},i):c(function(){var r;r=e?cc.js.getClassName(e)+' in "'+t+'" does not exist.':'Resources url "'+t+'" does not exist.',i(new Error(r),null)})},loadResAll:function(t,e,i){function r(t,e){if(!a){if(t)return a=!0,void i(t,null);o.push(e),--s,0===s&&i(null,o)}}i||!e||cc.isChildClassOf(e,cc.RawAsset)||(i=e,e=null);var n=u.getUuidArray(t,e),s=n.length;if(s>0)for(var o=[],a=!1,h=0,l=s;h<l;++h){var d=n[h];this.load({id:d,type:"uuid",uuid:d},r)}else c(function(){i(null,[])})},getRes:function(t){var e=this._items.getContent(t);if(!e){var i=this._getResUuid(t);e=this._items.getContent(i)}return e},getResCount:function(){return this._items.totalCount},getItem:function(t){var e=this._items.map[t];return e?(e.alias&&(e=this._items.map[e.alias]),e):e},release:function(t){this.removeItem(t)},releaseAsset:function(t){var e=t._uuid;e&&this.removeItem(e)},releaseRes:function(t){var e=this._getResUuid(t);e?this.removeItem(e):cc.error('Resources url "%s" does not exist.',t)},releaseAll:function(){this.clear()}}),e.exports=cc.loader},{"../platform/js":98,"../platform/utils":104,"./asset-table":68,"./downloader":70,"./loader":73,"./pipeline":76}],68:[function(t,e,i){function r(t,e){this.uuid=t,this.type=e}function n(){this._pathToUuid={}}function s(t,e){if(t.length>e.length){var i=t.charCodeAt(e.length);return 46===i||47===i}return!0}cc.js.mixin(n.prototype,{getUuid:function(t,e){t=cc.url.normalize(t);var i=this._pathToUuid[t];if(i)if(Array.isArray(i)){if(!e)return i[0].uuid;for(var r=0;r<i.length;r++){var n=i[r];if(cc.isChildClassOf(n.type,e))return n.uuid}}else if(!e||cc.isChildClassOf(i.type,e))return i.uuid;return""},getUuidArray:function(t,e){t=cc.url.normalize(t),"/"===t[t.length-1]&&(t=t.slice(0,-1));var i,r,n=this._pathToUuid,o=[];if(e){var a=cc.isChildClassOf;for(i in n)if(i.startsWith(t)&&s(i,t)){var c=n[i];if(Array.isArray(c))for(r=0;r<c.length;r++){var h=c[r];a(h.type,e)&&o.push(h.uuid)}else a(c.type,e)&&o.push(c.uuid)}}else for(i in n)if(i.startsWith(t)&&s(i,t)){var c=n[i];if(Array.isArray(c))for(r=0;r<c.length;r++)o.push(c[r].uuid);else o.push(c.uuid)}return o},getAllPaths:function(){return Object.keys(this._pathToUuid)},add:function(t,e,i,n){t=t.substring(0,t.length-cc.path.extname(t).length);var s=new r(e,i),o=this._pathToUuid,a=o[t];a?Array.isArray(a)?n?a.unshift(s):a.push(s):n?o[t]=[s,a]:o[t]=[a,s]:o[t]=s},reset:function(){this._pathToUuid={}}}),e.exports=n},{}],69:[function(t,e,i){function r(t,e,i,r){if(0===e.length){var o="can not found the resource of audio! Last match url is : ";return o+=t.replace(/\.(.*)?$/,"("),u.forEach(function(t){o+=t+"|"}),o=o.replace(/\|$/,")"),r({status:520,errorMessage:o},null)}l.WEB_AUDIO&&cc.Audio.useWebAudio?s(t,e,i,r):n(t,e,i,r)}function n(t,e,i,r){for(var n=l.ONE_SOURCE?1:e.length,s=document.createElement("audio"),o=0;o<n;o++){var a=document.createElement("source");a.src=cc.path.changeExtname(t,e[o]),s.appendChild(a)}i.setElement(s);var c=setTimeout(function(){0===s.readyState?u():h()},8e3),h=function(){s.removeEventListener("canplaythrough",h,!1),s.removeEventListener("error",u,!1),s.removeEventListener("emptied",h,!1),l.USE_LOADER_EVENT&&s.removeEventListener(l.USE_LOADER_EVENT,h,!1),clearTimeout(c),r(null,t)},u=function(){cc.log("load audio failure - "+t),h()};s.addEventListener("canplaythrough",h,!1),s.addEventListener("error",u,!1),l.USE_LOADER_EVENT&&s.addEventListener(l.USE_LOADER_EVENT,h,!1)}function s(t,e,i,r){if(d){var n=h.getXMLHttpRequest();n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){d.decodeAudioData(n.response,function(e){i.setBuffer(e),r(null,t)},function(){r("decode error - "+t,t)})},n.onerror=function(){r("request error - "+t,t)},n.send()}}function o(t,e){if(0===u.length)return e(new Error("Audio Downloader: audio not supported on this browser!"));var i,n,s=t.url,o=a.extname(s),c=[o];for(i=0;i<u.length;i++)o!==u[i]&&c.push(u[i]);n=new cc.Audio(s),t.content=s,t.audio=n,r(s,c,n,e)}var a=t("../utils/CCPath"),c=t("../platform/CCSys"),h=t("./pipeline");t("../../audio/CCAudio");var l=c.__audioSupport,u=l.format,d=l.context;e.exports=o},{"../../audio/CCAudio":17,"../platform/CCSys":88,"../utils/CCPath":115,"./pipeline":76}],70:[function(t,e,i){function r(t,e,i){function r(){a.parentNode.removeChild(a),a.removeEventListener("load",r,!1),a.removeEventListener("error",n,!1),e(null,s)}function n(){a.parentNode.removeChild(a),a.removeEventListener("load",r,!1),a.removeEventListener("error",n,!1),e(new Error("Load "+s+" failed!"),s)}var s=t.url,o=document,a=document.createElement("script");a.async=i,a.src=f(s),a.addEventListener("load",r,!1),a.addEventListener("error",n,!1),o.body.appendChild(a)}function n(t,e,i){function r(){a.removeEventListener("load",r),a.removeEventListener("error",s),e&&e(null,a)}function s(){a.removeEventListener("load",r),a.removeEventListener("error",s),a.crossOrigin&&"anonymous"===a.crossOrigin.toLowerCase()?n(t,e,!1):e("Load image ("+o+") failed")}void 0===i&&(i=!0);var o=f(t.url),a=new Image;i&&"file://"!==window.location.origin&&(a.crossOrigin="anonymous"),a.complete&&a.naturalWidth>0?e(null,a):(a.addEventListener("load",r),a.addEventListener("error",s)),a.src=o}function s(t,e,i){var r=document,n=cc.path,s=document.createElement("style");s.type="text/css",r.body.appendChild(s);var o="";if(o+=isNaN(t-0)?"@font-face { font-family:"+t+"; src:":"@font-face { font-family:'"+t+"'; src:",e instanceof Array)for(var a=0,c=e.length;a<c;a++){var h=e[a];i=n.extname(h).toLowerCase(),o+="url('"+e[a]+"') format('"+p[i]+"')",o+=a===c-1?";":","}else i=i.toLowerCase(),o+="url('"+e+"') format('"+p[i]+"');";s.textContent+=o+"}";var l=document.createElement("div"),u=l.style;u.fontFamily=t,l.innerHTML=".",u.position="absolute",u.left="-100px",u.top="-100px",r.body.appendChild(l)}function o(t,e){var i=t.url,r=t.type,n=t.name,o=t.srcs;n&&o?(o.indexOf(i)===-1&&o.push(i),s(n,o)):(r=cc.path.extname(i),n=cc.path.basename(i,r),s(n,i,r)),document.fonts?document.fonts.load("1em "+n).then(function(){e(null,null)},function(t){e(t)}):e(null,null)}function a(t,e){var i=t.id,r=this;cc.AssetLibrary.queryAssetInfo(i,function(n,s,o){if(n)e(n);else if(t.url=s,t.isRawAsset=o,o){var a=l.extname(s).toLowerCase();if(!a)return void e(new Error("Download Uuid: can not find type of raw asset["+i+"]: "+s));a=a.substr(1),r.pipeline._items.map[s]={id:s,url:s,type:a,error:null,alias:t.id,complete:!0};var c=r.extMap[a]||r.extMap["default"];t.type=a,c(t,e)}else{var h=d.load(t,e);h||r.extMap.json(t,e)}})}var c,h=t("../platform/js"),l=t("../utils/CCPath"),u=t("./pipeline"),d=t("./pack-downloader"),_=t("./text-downloader"),f=t("./utils").urlAppendTimestamp;c=t("./audio-downloader");var p={".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},g={js:r,png:n,jpg:n,bmp:n,jpeg:n,gif:n,ico:n,tiff:n,webp:n,image:n,mp3:c,ogg:c,wav:c,mp4:c,m4a:c,txt:_,xml:_,vsh:_,fsh:_,atlas:_,tmx:_,tsx:_,json:_,ExportJson:_,plist:_,fnt:_,font:o,eot:o,ttf:o,woff:o,svg:o,ttc:o,uuid:a,"default":_},m="Downloader",v=function(t){this.id=m,this.async=!0,this.pipeline=null,this.maxConcurrent=cc.sys.isMobile?2:512,this._curConcurrent=0,this._loadQueue=[],this.extMap=h.mixin(t,g)};v.ID=m,h.mixin(v.prototype,{addHandlers:function(t){h.mixin(this.extMap,t)},handle:function(t,e){var i=this,r=this.extMap[t.type]||this.extMap["default"];this._curConcurrent<this.maxConcurrent?(this._curConcurrent++,r.call(this,t,function(t,r){for(i._curConcurrent=Math.max(0,i._curConcurrent-1);i._curConcurrent<i.maxConcurrent;){var n=i._loadQueue.shift();if(!n)break;i.handle(n.item,n.callback)}e&&e(t,r)})):this._loadQueue.push({item:t,callback:e})}}),u.Downloader=e.exports=v},{"../platform/js":98,"../utils/CCPath":115,"./audio-downloader":69,"./pack-downloader":75,"./pipeline":76,"./text-downloader":77,"./utils":78}],71:[function(t,e,i){t("./downloader"),t("./loader"),t("./json-unpacker"),t("./loading-items"),t("./pipeline"),t("./CCLoader")},{"./CCLoader":67,"./downloader":70,"./json-unpacker":72,"./loader":73,"./loading-items":74,"./pipeline":76}],72:[function(t,e,i){function r(){this.jsons={}}r.prototype.read=function(t,e){var i="string"==typeof e?JSON.parse(e):e;i.length!==t.length&&cc.error("Pack indices and data do not match in size");for(var r=0;r<t.length;r++){var n=t[r],s=i[r];this.jsons[n]=s}},r.prototype.retrieve=function(t){return this.jsons[t]||null},e.exports=r},{}],73:[function(t,e,i){function r(t,e){e(null,null)}function n(t,e){"string"!=typeof t.content&&e(new Error("JSON Loader: Input item doesn't contain string content"));
try{var i=JSON.parse(t.content);e(null,i)}catch(r){e(new Error("JSON Loader: Parse json ["+t.id+"] failed : "+r))}}function s(t,e){t.content instanceof Image||e(new Error("Image Loader: Input item doesn't contain Image content"));var i=t.url,r=cc.textureCache.getTextureForKey(i)||new u;r.url=i,r.initWithElement(t.content),r.handleLoadedTexture(),cc.textureCache.cacheImage(i,r),e(null,r)}function o(t,e){"string"!=typeof t.content&&e(new Error("Plist Loader: Input item doesn't contain string content"));var i=cc.plistParser.parse(t.content);i?e(null,i):e(new Error("Plist Loader: Parse ["+t.id+"] failed"))}function a(t){var e=t.match(_.ITEM_EXP),i={};if(e)for(var r=0,n=e.length;r<n;r++){var s=e[r],o=s.indexOf("="),a=s.substring(0,o),c=s.substring(o+1);c.match(_.INT_EXP)?c=parseInt(c):'"'===c[0]&&(c=c.substring(1,c.length-1)),i[a]=c}return i}function c(t,e){var i,r,n=t.content,s=t.url,o={},c=a(n.match(_.INFO_EXP)[0]),h=c.padding.split(","),l=({left:parseInt(h[0]),top:parseInt(h[1]),right:parseInt(h[2]),bottom:parseInt(h[3])},a(n.match(_.COMMON_EXP)[0]));if(o.commonHeight=l.lineHeight,o.fontSize=c.size,cc._renderType===cc.game.RENDER_TYPE_WEBGL){var u=cc.configuration.getMaxTextureSize();(l.scaleW>u.width||l.scaleH>u.height)&&cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}1!==l.pages&&cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page");var d=a(n.match(_.PAGE_EXP)[0]);0!==d.id&&cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found"),o.atlasName=cc.path.changeBasename(s,d.file);var f=n.match(_.CHAR_EXP),p=o.fontDefDictionary={};for(i=0,r=f.length;i<r;i++){var g=a(f[i]),m=g.id;p[m]={rect:{x:g.x,y:g.y,width:g.width,height:g.height},xOffset:g.xoffset,yOffset:g.yoffset,xAdvance:g.xadvance}}var v=o.kerningDict={},y=n.match(_.KERNING_EXP);if(y)for(i=0,r=y.length;i<r;i++){var C=a(y[i]);v[C.first<<16|65535&C.second]=C.amount}e(null,o)}var h=t("../platform/js"),l=t("./pipeline"),u=t("../textures/CCTexture2D"),d=t("./uuid-loader"),_={INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/},f={png:s,jpg:s,bmp:s,jpeg:s,gif:s,ico:s,tiff:s,webp:s,image:s,json:n,ExportJson:n,plist:o,fnt:c,uuid:d,prefab:d,fire:d,scene:d,"default":r},p="Loader",g=function(t){this.id=p,this.async=!0,this.pipeline=null,this.extMap=h.mixin(t,f)};g.ID=p,h.mixin(g.prototype,{addHandlers:function(t){this.extMap=h.mixin(this.extMap,t)},handle:function(t,e){var i=this.extMap[t.type]||this.extMap["default"];i.call(this,t,function(t,i){t?e&&e(t):e&&e(null,i)})}}),l.Loader=e.exports=g},{"../platform/js":98,"../textures/CCTexture2D":111,"./pipeline":76,"./uuid-loader":79}],74:[function(t,e,i){var r=t("../platform/callbacks-invoker"),n=t("../platform/js"),s=function(){r.call(this),this.map={},this.completed={},this.totalCount=0,this.completedCount=0};n.mixin(s.prototype,r.prototype,{append:function(t){for(var e=[],i=0;i<t.length;++i){var r=t[i],n=r.id;this.map[n]||(this.map[r.id]=r,e.push(r))}return this.totalCount+=e.length,e},isCompleted:function(){return this.completedCount>=this.totalCount},isItemCompleted:function(t){return!!this.completed[t]},exists:function(t){return!!this.map[t]},getContent:function(t){var e=this.map[t],i=null;return e&&(e.content?i=e.content:e.alias&&(i=this.getContent(e.alias))),i},getError:function(t){var e=this.map[t],i=null;return e&&(e.error?i=e.error:e.alias&&(i=this.getError(e.alias))),i},addListener:r.prototype.add,hasListener:r.prototype.has,removeListener:r.prototype.remove,removeAllListeners:r.prototype.removeAll,removeItem:function(t){var e=this.map[t];e&&this.completed[e.alias||t]&&(delete this.completed[t],delete this.map[t],e.alias&&(delete this.completed[e.alias],delete this.map[e.alias]),this.completedCount--,this.totalCount--)},complete:function(t){if(this.map[t]&&!this.completed[t]){var e=this.map[t];e.complete=!0,this.completed[t]=e,this.completedCount++}}}),e.exports=s},{"../platform/callbacks-invoker":93,"../platform/js":98}],75:[function(t,e,i){function r(t,e,i){t(new Error("Can not retrieve "+e+" from packer "+i))}var n=t("./json-unpacker"),s=t("./text-downloader"),o={},a={},c={};e.exports={initPacks:function(t){a=t;for(var e in t)for(var i=t[e],r=0;r<i.length;r++){var n=i[r];o[n]=e}},_loadNewPack:function(t,e,i){var o=cc.AssetLibrary.getImportedDir(e)+"/"+e+".json";s({url:o},function(s,o){if(s)return cc.error("Failed to download package for "+t),i(s);var h=c[e];h||(console.log("Load pack %s for %s",e,t),h=c[e]=new n),h.read(a[e],o);var l=h.retrieve(t);l?i(null,l):r(i,t,e)})},load:function(t,e){var i=t.id,n=o[i];if(!n)return!1;var s=c[n];return s?setTimeout(function(){var t=s.retrieve(i);t?e(null,t):r(e,i,n)},0):this._loadNewPack(i,n,e),!0}}},{"./json-unpacker":72,"./text-downloader":77}],76:[function(t,e,i){function r(t){var e=this.id,i=t.states[e],r=this.next;if(!t.error&&i!==u.WORKING&&i!==u.ERROR)if(i===u.COMPLETE)r?r.flowIn(t):this.pipeline.flowOut(t);else{t.states[e]=u.WORKING;var n=this;this.handle(t,function(i,s){i?(t.error=i,t.states[e]=u.ERROR,n.pipeline.flowOut(t)):(s&&(t.content=s),t.states[e]=u.COMPLETE,r?r.flowIn(t):n.pipeline.flowOut(t))})}}function n(t){var e=this.id,i=t.states[e],r=this.next;if(!t.error&&i!==u.WORKING&&i!==u.ERROR)if(i===u.COMPLETE)r?r.flowIn(t):this.pipeline.flowOut(t);else{t.states[e]=u.WORKING;var n=this.handle(t);n instanceof Error?(t.error=n,t.states[e]=u.ERROR,this.pipeline.flowOut(t)):(n&&(t.content=n),t.states[e]=u.COMPLETE,r?r.flowIn(t):this.pipeline.flowOut(t))}}function s(t){var e=t.id||t;return"string"==typeof e}function o(t){var e;if("object"==typeof t&&t.id?(t.type||(t.type=h.extname(t.id).toLowerCase().substr(1)),e={url:t.url||t.id,error:null,content:null,complete:!1,states:{}},c.mixin(e,t)):"string"==typeof t&&(e={id:t,url:t,type:h.extname(t).toLowerCase().substr(1),error:null,content:null,complete:!1,states:{}}),e.skips)for(var i=0,r=e.skips.length;i<r;i++){var n=e.skips[i];e.states[n]=u.COMPLETE}return e}function a(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")}var c=t("../platform/js"),h=t("../utils/CCPath"),l=t("./loading-items"),u={WORKING:1,COMPLETE:2,ERROR:3},d=function(t){this._pipes=t,this._items=new l,this._errorUrls=[],this._flowing=!1;for(var e=0;e<t.length;++e){var i=t[e];i.handle&&i.id&&(i.pipeline=this,i.next=e<t.length-1?t[e+1]:null,i.flowIn=i.async?r:n)}};d.ItemState=new cc.Enum(u),d.getXMLHttpRequest=a,c.mixin(d.prototype,{insertPipe:function(t,e){t.handle&&t.id&&(t.pipeline=this,t.flowIn=t.async?r:n,e<this._pipes.length?(t.next=this._pipes[e],this._pipes.splice(e,0,t)):(t.next=null,this._pipes.push(t)))},appendPipe:function(t){t.handle&&t.id&&(t.pipeline=this,t.next=null,t.flowIn=t.async?r:n,this._pipes.push(t))},flowIn:function(t){var e,i,r,n=[];for(e=0;e<t.length;++e){if(i=t[e],!s(i))throw new Error("Pipeline flowIn: Invalid url: "+(i.id||i));r=o(i),n.push(r)}var a=this._items.append(n);if(0===this._pipes.length||0===a.length)return this.complete(),a;this._flowing=!0;var c=this._pipes[0];if(c)for(e=0;e<a.length;e++)c.flowIn(a[e]);return a},flowInDeps:function(t,e){function i(t){r[t.id]=t;for(var i in r)if(!r[i])return;e&&e.call(this,r),e=null}for(var r={},n=this._items,s=0;s<t.length;++s){var o=t[s].id||t[s];if("string"==typeof o&&!r[o]){var a=n.map[o];a?r[o]=a:(n.addListener(o,i),r[o]=null)}}var c=this.flowIn(t);return 0===c.length&&(e&&e.call(this,r),e=null),c},complete:function(){if(this._items.isCompleted()){this._flowing=!1;var t=0===this._errorUrls.length?null:this._errorUrls;this.onComplete&&this.onComplete(t,this._items);for(var e=0;e<this._errorUrls.length;++e){var i=this._errorUrls[e];this._items.removeItem(i)}this._errorUrls=[]}},flowOut:function(t){var e=t.id,i=this._items,r=i.map[e];if(r&&!r.complete){var n=this._errorUrls.indexOf(e);t.error&&n===-1?this._errorUrls.push(e):t.error||n===-1||this._errorUrls.splice(n,1),i.complete(t.id),this.onProgress&&this.onProgress(i.completedCount,i.totalCount,t),this.complete(),i.invokeAndRemove(e,t)}},copyItemStates:function(t,e){if(!(e instanceof Array))return void(e.states=t.states);for(var i=0;i<e.length;++i)e[i].states=t.states},isFlowing:function(){return this._flowing},getItems:function(){return this._items},getItem:function(t){return this._items.map[t]},removeItem:function(t){var e=this._items.map[t];return!!e&&(e.complete||(e.error=new Error("Canceled manually"),this.flowOut(e)),void this._items.removeItem(t))},clear:function(){if(this._flowing){var t=this._items.map;for(var e in t){var i=t[e];i.complete||(i.error=new Error("Canceled manually"),this.flowOut(i))}}this._items=new l,this._errorUrls=[],this._flowing=!1},onProgress:null,onComplete:null}),cc.Pipeline=e.exports=d},{"../platform/js":98,"../utils/CCPath":115,"./loading-items":74}],77:[function(t,e,i){var r=t("./pipeline"),n=t("./utils").urlAppendTimestamp;e.exports=function(t,e){var i=t.url,s=r.getXMLHttpRequest(),o="Load "+i+" failed!",a=window.navigator;i=n(i),s.open("GET",i,!0),/msie/i.test(a.userAgent)&&!/opera/i.test(a.userAgent)?(s.setRequestHeader("Accept-Charset","utf-8"),s.onreadystatechange=function(){4===s.readyState&&(200===s.status||0===s.status?e(null,s.responseText):e({status:s.status,errorMessage:o}))}):(s.overrideMimeType&&s.overrideMimeType("text/plain; charset=utf-8"),s.onload=function(){4===s.readyState&&(200===s.status||0===s.status?e(null,s.responseText):e({status:s.status,errorMessage:o}))},s.onerror=function(){e({status:s.status,errorMessage:o})}),s.send(null)}},{"./pipeline":76,"./utils":78}],78:[function(t,e,i){var r=/\?/;e.exports={urlAppendTimestamp:function(t){return cc.game.config.noCache&&"string"==typeof t&&(t+=r.test(t)?"&_t="+(new Date-0):"?_t="+(new Date-0)),t}}},{}],79:[function(t,e,i){function r(t){var e="cc.Scene",i="cc.Prefab";return t&&(t[0]&&t[0].__type__===e||t[1]&&t[1].__type__===e||t[0]&&t[0].__type__===i)}function n(t,e,i,r,n,s){var o,c,h,l,u,d=e.id,_=r.uuidList;if(n)for(o=[],c=[],h=[],l=0;l<_.length;l++){u=_[l];var f=r.uuidObjList[l],p=r.uuidPropList[l],g=cc.AssetLibrary._getAssetInfoInRuntime(u);if(g.raw){var m=g.url;f[p]=m}else o.push(f),c.push(p),h.push({id:u,type:"uuid",uuid:u,deferredLoadRaw:!0})}else for(o=a.array.copy(r.uuidObjList),c=a.array.copy(r.uuidPropList),h=new Array(_.length),l=0;l<_.length;l++)u=_[l],h[l]={id:u,type:"uuid",uuid:u};return r.rawProp&&(o.push(i),c.push(r.rawProp),h.push(e.url)),0===h.length?(i._uuid=d,s(null,i)):void t.flowInDeps(h,function(e){var r;for(var n in e)r=e[n],r.uuid&&r.content&&(r.content._uuid=r.uuid);for(var a=0;a<h.length;a++){var l=h[a].uuid,u=o[a],_=c[a];if(r=e[l])if(r.complete){var f=r.isRawAsset?r.url:r.content;u[_]=f}else{var p=function(t){var e=t.isRawAsset?t.url:t.content;this.obj[this.prop]=e},g={obj:u,prop:_},m=t.getItems()._callbackTable[l];m?m.unshift(p,g):t.getItems().add(l,p,g)}}i._uuid=d,s(null,i)})}function s(t,e,i){var r=e.deferredLoadRaw;return r?t instanceof cc.Asset&&t.constructor.preventDeferredLoadDependents&&(r=!1):i&&t instanceof cc.SceneAsset&&(r=t.asyncLoadAssets,r&&cc.log("deferred load raw assets for "+e.id)),r}function o(t,e){var i;if("string"==typeof t.content)try{i=JSON.parse(t.content)}catch(o){return void e(new Error("Uuid Loader: Parse asset ["+t.id+"] failed : "+o.stack))}else{if("object"!=typeof t.content)return void e(new Error("JSON Loader: Input item doesn't contain string content"));i=t.content}var h,l=r(i),u=l?cc._MissingScript.safeFindClass:function(t){var e=a._getClassById(t);return e?e:(cc.warn('Can not get class "%s"',t),Object)},d=t.deserializeInfo||c;try{h=cc.deserialize(i,d,{classFinder:u,target:t.existingAsset,customEnv:t})}catch(o){return void e(new Error("Uuid Loader: Deserialize asset ["+t.id+"] failed : "+o.stack))}var _=s(h,t,l);n(this.pipeline,t,h,d,_,e),d.reset()}var a=t("../platform/js");t("../platform/deserialize");var c=new cc.deserialize.Details;e.exports=o,o.isSceneObj=r},{"../platform/deserialize":94,"../platform/js":98}],80:[function(t,e,i){function r(t){return t&&(t.constructor===cc.SceneAsset||t instanceof cc.Scene)}var n=t("../assets/CCAsset"),s=t("./utils").callInNextTick,o=t("../load-pipeline/CCLoader"),a=t("../load-pipeline/pack-downloader"),c="",h="",l={},u={loadAsset:function(t,e,i){var r={id:t,type:"uuid"};i&&i.deserializeInfo&&(r.deserializeInfo=i.deserializeInfo),i&&i.existingAsset&&(r.existingAsset=i.existingAsset),this._loadAssetByUuid(r,e)},getImportedDir:function(t){return c+t.slice(0,2)},_queryAssetInfoInEditor:function(t,e){},_getAssetInfoInRuntime:function(t){var e=l[t];if(e&&!cc.isChildClassOf(e.type,cc.Asset))return{url:h+e.url,raw:!0};var i=this.getImportedDir(t)+"/"+t+".json";return{url:i,raw:!1}},queryAssetInfo:function(t,e){var i=this._getAssetInfoInRuntime(t);e(null,i.url,i.raw)},parseUuidInEditor:function(t){},_loadAssetByUuid:function(t,e){var i=t.id;return"string"!=typeof i?s(e,new Error("[AssetLibrary] uuid must be string"),null):void o.load(t,function(t,n){t||!n?t=new Error("[AssetLibrary] loading JSON or dependencies failed: "+t.message):r(n)&&o.removeItem(i),e&&e(t,n)})},loadJson:function(t,e){var i=""+((new Date).getTime()+Math.random()),n={id:i,type:"uuid",content:t,skips:[o.downloader.id]};o.load(n,function(t,n){t?t=new Error("[AssetLibrary] loading JSON or dependencies failed: "+t.message):r(n)&&o.removeItem(i),n._uuid="",e&&e(t,n)})},getAssetByUuid:function(t){return u._uuidToAsset[t]||null},init:function(t){var e=t.libraryPath;e=e.replace(/\\/g,"/"),c=cc.path._setEndWithSep(e,"/"),h=t.rawAssetsBase;var i=o._resources;i.reset();var r=t.rawAssets;if(r){var s="resources/";for(var u in r){var d=r[u];for(var _ in d){var f=d[_],p=f[0],g=f[1],m=cc.js._getClassById(g);if(m){if(l[_]={url:u+"/"+p,type:m},"assets"===u&&p.startsWith(s)){if(cc.isChildClassOf(m,n)){var v=cc.path.extname(p);p=v?p.slice(s.length,-v.length):p.slice(s.length)}else p=p.slice(s.length);var y=1===f[2];i.add(p,_,m,!y)}}else cc.error("Cannot get",g)}}}t.packedAssets&&a.initPacks(t.packedAssets);var C=t.mountPaths;C||(C={assets:h+"assets",internal:h+"internal"}),cc.url._init(C)}};u._uuidToAsset={},cc.AssetLibrary=u},{"../assets/CCAsset":31,"../load-pipeline/CCLoader":67,"../load-pipeline/pack-downloader":75,"./utils":104}],81:[function(require,module,exports){function appendProp(t,e){var i=t.__props__.indexOf(e);i<0&&t.__props__.push(e)}function defineProp(t,e,i,r,n){if(Attr.setClassAttr(t,i,"default",r),appendProp(t,i),n){for(var s=null,o=0;o<n.length;o++){var a=n[o];Attr.attr(t,i,a),a._onAfterProp&&(s=s||[],s.push(a._onAfterProp))}if(s)for(var c=0;c<s.length;c++)s[c](t,i)}}function defineGetSet(t,e,i,r,n){var s=r.get,o=r.set,a=t.prototype,c=Object.getOwnPropertyDescriptor(a,i);if(s){if(n)for(var h=0;h<n.length;++h){var l=n[h];Attr.attr(t,i,l)}var u=!1;u||Attr.attr(t,i,Attr.NonSerialized),u&&appendProp(t,i),c?Object.defineProperty(a,i,{get:s}):Object.defineProperty(a,i,{get:s,configurable:!0,enumerable:!0})}o&&(c?Object.defineProperty(a,i,{set:o}):Object.defineProperty(a,i,{set:o,configurable:!0,enumerable:!0}))}function getDefault(t){return"function"==typeof t?t():t}function instantiateProps(t,e){var i=Attr.getClassAttrs(e),r=e.__props__;null===r&&(deferredInitializer.init(),r=e.__props__);for(var n=0;n<r.length;n++){var s=r[n],o=s+DELIMETER+"default";if(o in i){var a=i[o];a&&("object"==typeof a&&a?a="function"==typeof a.clone?a.clone():Array.isArray(a)?[]:{}:"function"==typeof a&&(a=getDefault(a))),t[s]=a}}}function getInheritanceChain(t){for(var e=[];;){var i=Object.getPrototypeOf(t.prototype);if(t=i&&i.constructor,!t)break;t!==Object&&e.push(t)}return e}function doDefine(t,e,i,r,n){var s=_createCtor(r,e,i,t,n);if(Object.defineProperty(s,"extend",{value:function(t){return t["extends"]=this,CCClass(t)},writable:!0,configurable:!0}),e&&(JS.extend(s,e),s.$super=e),i){for(var o=0;o<i.length;++o){var a=i[o];JS.mixin(s.prototype,a.prototype);for(var c in a)a.hasOwnProperty(c)&&INVALID_STATICS.indexOf(c)<0&&(s[c]=a[c]);CCClass._isCCClass(a)&&JS.mixin(Attr.getClassAttrs(s).constructor.prototype,Attr.getClassAttrs(a).constructor.prototype)}s.prototype.constructor=s}return JS.setClassName(t,s),s}function define(t,e,i,r,n){if(cc.isChildClassOf(e,cc.Component)){var s=cc._RFpeek();if(s){if(s.beh)return cc.error("Each script can have at most one Component."),a;var o=s.uuid;t=t||s.script;var a=doDefine(t,e,i,r,n);return o&&JS._setClassId(o,a),s.beh=a,a}}return doDefine(t,e,i,r,n)}function _checkCtor(t){}function normalizeClassName(t){var e}function _createCtor(ctor,baseClass,mixins,className,options){for(var useTryCatch=!(className&&className.startsWith("cc.")),shouldAddProtoCtor,originCtor,superCallBounded=options&&baseClass&&boundSuperCalls(baseClass,options),ctors=[],baseOrMixins=[baseClass].concat(mixins),b=0;b<baseOrMixins.length;b++){var baseOrMixin=baseOrMixins[b];if(baseOrMixin)if(CCClass._isCCClass(baseOrMixin)){var baseCtors=baseOrMixin.__ctors__;baseCtors&&(ctors=ctors.concat(baseCtors))}else baseOrMixin&&ctors.push(baseOrMixin)}ctor&&ctors.push(ctor);var body;if(body="(function(){\n",superCallBounded&&(body+="this._super=null;\n"),body+="instantiateProps(this,fireClass);\n",ctors.length>0){if(body+="var cs=fireClass.__ctors__;\n",useTryCatch&&(body+="try{\n"),ctors.length<=5)for(var i=0;i<ctors.length;i++)body+="(cs["+i+"]).apply(this,arguments);\n";else body+="for(var i=0,l=cs.length;i<l;++i){\n",body+="(cs[i]).apply(this,arguments);\n}\n";useTryCatch&&(body+="}catch(e){\ncc._throw(e);\n}\n")}body+="})";var fireClass=eval(body);return Object.defineProperty(fireClass,"__ctors__",{value:ctors.length>0?ctors:null}),fireClass}function _boundSuperCall(t,e,i){var r=null,n=JS.getPropertyDescriptor(i.prototype,e);if(n&&(r=n.value,"function"==typeof r)){var s=SuperCallReg.test(t);if(s)return function(){var e=this._super;this._super=r;var i=t.apply(this,arguments);return this._super=e,i}}return null}function boundSuperCalls(t,e){var i=!1;for(var r in e)if(BUILTIN_ENTRIES.indexOf(r)<0){var n=e[r];if("function"==typeof n){var s=_boundSuperCall(n,r,t);s&&(i=!0,e[r]=s)}}return i}function declareProperties(t,e,i,r,n){if(t.__props__=[],r&&r.__props__&&(t.__props__=r.__props__.slice()),n)for(var s=0;s<n.length;++s){var o=n[s];o.__props__&&(t.__props__=t.__props__.concat(o.__props__.filter(function(e){return t.__props__.indexOf(e)<0})))}if(i){preprocessAttrs(i,e,t);for(var a in i){var c=i[a],h=parseAttributes(c,e,a);"default"in c?defineProp(t,e,a,c["default"],h):defineGetSet(t,e,a,c,h)}}}function CCClass(t){if(0===arguments.length)return define();if(!t)return cc.error("cc.Class: Option must be non-nil"),define();var e,i=t.name,r=t["extends"],n=t.mixins;e=define(i,r,n,t.ctor,t),i||(i=cc.js.getClassName(e));var s=t.properties;"function"==typeof s||r&&null===r.__props__||n&&n.some(function(t){return null===t.__props__})?(deferredInitializer.push({cls:e,props:s,mixins:n}),e.__props__=null):declareProperties(e,i,s,r,t.mixins);var o=t.statics;if(o){var a;for(a in o)e[a]=o[a]}for(var c in t)if(!(BUILTIN_ENTRIES.indexOf(c)>=0)){var h=t[c];if("function"==typeof h||null===h)Object.defineProperty(e.prototype,c,{value:h,enumerable:!0,configurable:!0,writable:!0});else;}return e}function parseAttributes(t,e,i){function r(e,i,r){var s=t[e];if(s&&typeof s===i)if("undefined"==typeof r){var o={};o[e]=s,n.push(o)}else n.push("function"==typeof r?r(s):r)}tmpAttrs.length=0;var n=tmpAttrs,s=t.type;if(s){var o=PrimitiveTypes[s];if(o)n.push({type:s,_onAfterProp:getTypeChecker(o,"cc."+s)});else if("Object"===s);else if(s===Attr.ScriptUuid){var a=Attr.ObjectType(cc.ScriptAsset);a.type="Script",n.push(a)}else"object"==typeof s?Enum.isEnum(s)&&n.push({type:"Enum",enumList:Enum.getList(s)}):"function"==typeof s&&(t.url?n.push({type:"Object",ctor:s,_onAfterProp:getTypeChecker("String","cc.String")}):n.push(Attr.ObjectType(s)))}r("rawType","string",Attr.RawType),r("editorOnly","boolean",Attr.EditorOnly),t.url&&n.push({saveUrlAsAsset:!0}),t.serializable===!1&&n.push(Attr.NonSerialized);var c=t.range;return c&&Array.isArray(c)&&c.length>=2&&n.push({min:c[0],max:c[1],step:c[2]}),n}var JS=require("./js"),Enum=require("../value-types/CCEnum"),Utils=require("./utils"),_isPlainEmptyObj_DEV=Utils.isPlainEmptyObj_DEV,_cloneable_DEV=Utils.cloneable_DEV,Attr=require("./attribute"),getTypeChecker=Attr.getTypeChecker,preprocessAttrs=require("./preprocess-attrs"),BUILTIN_ENTRIES=["name","extends","mixins","ctor","properties","statics","editor"],TYPO_TO_CORRECT=!1,INVALID_STATICS=!1,deferredInitializer={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout(function(){e.init()},0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var i=t[e],r=i.cls,n=i.props;"function"==typeof n&&(n=n());var s=JS.getClassName(r);n?declareProperties(r,s,n,r.$super,i.mixins):cc.error('Properties function of "%s" should return an object!',s)}this.datas=null}}},DELIMETER=Attr.DELIMETER;cc.isChildClassOf=function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){var i=t.prototype,r=i&&Object.getPrototypeOf(i);if(t=r&&r.constructor,!t)return!1;if(t===e)return!0}}return!1};var SuperCallReg=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;CCClass._isCCClass=function(t){return!!t&&"undefined"!=typeof t.__ctors__},CCClass._fastDefine=function(t,e,i){JS.setClassName(t,e);for(var r=e.__props__=Object.keys(i),n=0;n<r.length;n++){var s=r[n],o=i[s];Attr.setClassAttr(e,s,"visible",!1),Attr.setClassAttr(e,s,"default",o)}},CCClass.Attr=Attr,CCClass.attr=Attr.attr,CCClass.getInheritanceChain=getInheritanceChain;var PrimitiveTypes={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"},tmpAttrs=[];cc.Class=CCClass,module.exports={instantiateProps:instantiateProps,isArray:function(t){return t=getDefault(t),Array.isArray(t)},fastDefine:CCClass._fastDefine}},{"../value-types/CCEnum":124,"./attribute":92,"./js":98,"./preprocess-attrs":101,"./utils":104}],82:[function(t,e,i){var r=t("./CCInputManager");r.setAccelerometerEnabled=function(t){var e=this;if(e._accelEnabled!==t){e._accelEnabled=t;var i=cc.director.getScheduler();e._accelEnabled?(e._accelCurTime=0,i.scheduleUpdate(e)):(e._accelCurTime=0,i.scheduleUpdate(e))}},r.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},r._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){cc.eventManager.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,(!0))),t.stopPropagation(),t.preventDefault()},!1),cc.game.canvas.addEventListener("keyup",function(t){cc.eventManager.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,(!1))),t.stopPropagation(),t.preventDefault()},!1)},r._registerAccelerometerEvent=function(){var t=window,e=this;e._acceleration=new cc.Acceleration,e._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(e._accelDeviceEvent=window.DeviceOrientationEvent);var i=e._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",r=navigator.userAgent;(/Android/.test(r)||/Adr/.test(r)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(e._minus=-1),t.addEventListener(i,e.didAccelerate.bind(e),!1)},r.didAccelerate=function(t){var e=this,i=window;if(e._accelEnabled){var r,n,s,o=e._acceleration;if(e._accelDeviceEvent===window.DeviceMotionEvent){var a=t.accelerationIncludingGravity;r=e._accelMinus*a.x*.1,n=e._accelMinus*a.y*.1,s=.1*a.z}else r=t.gamma/90*.981,n=.981*-(t.beta/90),s=t.alpha/90*.981;o.x=r,o.y=n,o.z=s,o.timestamp=t.timeStamp||Date.now();var c=o.x;i.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_RIGHT?(o.x=-o.y,o.y=c):i.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_LEFT?(o.x=o.y,o.y=-c):i.orientation===cc.macro.WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN&&(o.x=-o.x,o.y=-o.y)}}},{"./CCInputManager":83}],83:[function(t,e,i){var r={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=0;e<this._maxTouches;e++){if(!(1&t))return this._indexBitsUsed|=1<<e,e;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(t<0||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},_glView:null,handleTouchesBegin:function(t){for(var e,i,r,n,s=[],o=this._touchesIntegerDict,a=0,c=t.length;a<c;a++)if(e=t[a],n=e.getID(),i=o[n],null==i){var h=this._getUnUsedIndex();if(h===-1){cc.log(cc._LogInfos.inputManager.handleTouchesBegin,h);continue}r=this._touches[h]=new cc.Touch(e._point.x,e._point.y,e.getID()),r._setPrevPoint(e._prevPoint),o[n]=h,s.push(r)}if(s.length>0){this._glView._convertTouchesWithScale(s);var l=new cc.Event.EventTouch(s);l._eventCode=cc.Event.EventTouch.BEGAN,cc.eventManager.dispatchEvent(l)}},handleTouchesMove:function(t){for(var e,i,r,n=[],s=this._touches,o=0,a=t.length;o<a;o++)e=t[o],r=e.getID(),i=this._touchesIntegerDict[r],null!=i&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),n.push(s[i]));if(n.length>0){this._glView._convertTouchesWithScale(n);var c=new cc.Event.EventTouch(n);c._eventCode=cc.Event.EventTouch.MOVED,cc.eventManager.dispatchEvent(c)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.ENDED,cc.eventManager.dispatchEvent(i)}},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.CANCELLED,cc.eventManager.dispatchEvent(i)}},getSetOfTouchesEndOrCancel:function(t){for(var e,i,r,n=[],s=this._touches,o=this._touchesIntegerDict,a=0,c=t.length;a<c;a++)e=t[a],r=e.getID(),i=o[r],null!=i&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),n.push(s[i]),this._removeUsedIndexBit(i),delete o[r]);return n},getHTMLElementPosition:function(t){var e=document.documentElement,i=window,r=null;return r="function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():t instanceof HTMLCanvasElement?{left:0,top:0,width:t.width,height:t.height}:{left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)},{left:r.left+i.pageXOffset-e.clientLeft,top:r.top+i.pageYOffset-e.clientTop,width:r.width,height:r.height}},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,r=t.getID(),n=i.length-1;n>=0;n--)if(i[n].getID()===r){e=i[n];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,r=t.getID(),n=i.length-1;n>=0;n--)if(i[n].getID()===r){i[n]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var r=this._preTouchPoint,n=this._glView.convertToLocationInView(t,e,i),s=new cc.Touch(n.x,n.y);return s._setPrevPoint(r.x,r.y),r.x=n.x,r.y=n.y,s},getMouseEvent:function(t,e,i){var r=this._prevMousePoint;this._glView._convertMouseToLocationInView(t,e);var n=new cc.Event.EventMouse(i);return n.setLocation(t.x,t.y),n._setPrevCursor(r.x,r.y),r.x=t.x,r.y=t.y,n},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,r,n,s=[],o=this._glView,a=this._preTouchPoint,c=t.changedTouches.length,h=0;h<c;h++)if(i=t.changedTouches[h]){var l;l=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?o.convertToLocationInView(i.pageX,i.pageY,e):o.convertToLocationInView(i.clientX,i.clientY,e),null!=i.identifier?(r=new cc.Touch(l.x,l.y,i.identifier),n=this.getPreTouch(r).getLocation(),r._setPrevPoint(n.x,n.y),this.setPreTouch(r)):(r=new cc.Touch(l.x,l.y),r._setPrevPoint(a.x,a.y)),a.x=l.x,a.y=l.y,s.push(r)}return s},registerSystemEvent:function(t){if(!this._isRegisterEvent){var e=(this._glView=cc.view,this),i="mouse"in cc.sys.capabilities,r="touches"in cc.sys.capabilities,n=!1;if(cc.sys.isMobile&&(n=!0),i&&(!n&&window.addEventListener("mousedown",function(){e._mousePressed=!0},!1),!n&&window.addEventListener("mouseup",function(i){var r=e._mousePressed;if(e._mousePressed=!1,r){var n=e.getHTMLElementPosition(t),s=e.getPointByEvent(i,n);if(!cc.rectContainsPoint(new cc.Rect(n.left,n.top,n.width,n.height),s)){e.handleTouchesEnd([e.getTouchByXY(s.x,s.y,n)]);var o=e.getMouseEvent(s,n,cc.Event.EventMouse.UP);o.setButton(i.button),cc.eventManager.dispatchEvent(o)}}},!1),!n&&t.addEventListener("mousedown",function(i){e._mousePressed=!0;var r=e.getHTMLElementPosition(t),n=e.getPointByEvent(i,r);e.handleTouchesBegin([e.getTouchByXY(n.x,n.y,r)]);var s=e.getMouseEvent(n,r,cc.Event.EventMouse.DOWN);s.setButton(i.button),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault(),t.focus()},!1),!n&&t.addEventListener("mouseup",function(i){e._mousePressed=!1;var r=e.getHTMLElementPosition(t),n=e.getPointByEvent(i,r);e.handleTouchesEnd([e.getTouchByXY(n.x,n.y,r)]);var s=e.getMouseEvent(n,r,cc.Event.EventMouse.UP);s.setButton(i.button),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),!n&&t.addEventListener("mousemove",function(i){var r=e.getHTMLElementPosition(t),n=e.getPointByEvent(i,r);e.handleTouchesMove([e.getTouchByXY(n.x,n.y,r)]);var s=e.getMouseEvent(n,r,cc.Event.EventMouse.MOVE);e._mousePressed?s.setButton(i.button):s.setButton(null),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),t.addEventListener("mousewheel",function(i){var r=e.getHTMLElementPosition(t),n=e.getPointByEvent(i,r),s=e.getMouseEvent(n,r,cc.Event.EventMouse.SCROLL);s.setButton(i.button),s.setScrollData(0,i.wheelDelta),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),t.addEventListener("DOMMouseScroll",function(i){var r=e.getHTMLElementPosition(t),n=e.getPointByEvent(i,r),s=e.getMouseEvent(n,r,cc.Event.EventMouse.SCROLL);s.setButton(i.button),s.setScrollData(0,i.detail*-120),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1)),window.navigator.msPointerEnabled){var s={MSPointerDown:e.handleTouchesBegin,MSPointerMove:e.handleTouchesMove,MSPointerUp:e.handleTouchesEnd,MSPointerCancel:e.handleTouchesCancel};for(var o in s)!function(i,r){t.addEventListener(i,function(i){var n=e.getHTMLElementPosition(t);n.left-=document.documentElement.scrollLeft,n.top-=document.documentElement.scrollTop,r.call(e,[e.getTouchByXY(i.clientX,i.clientY,n)]),i.stopPropagation()},!1)}(o,s[o])}r&&(t.addEventListener("touchstart",function(i){if(i.changedTouches){var r=e.getHTMLElementPosition(t);r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop,e.handleTouchesBegin(e.getTouchesByEvent(i,r)),i.stopPropagation(),i.preventDefault(),t.focus()}},!1),t.addEventListener("touchmove",function(i){if(i.changedTouches){var r=e.getHTMLElementPosition(t);r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop,e.handleTouchesMove(e.getTouchesByEvent(i,r)),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("touchend",function(i){if(i.changedTouches){var r=e.getHTMLElementPosition(t);r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop,e.handleTouchesEnd(e.getTouchesByEvent(i,r)),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("touchcancel",function(i){if(i.changedTouches){var r=e.getHTMLElementPosition(t);r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop,e.handleTouchesCancel(e.getTouchesByEvent(i,r)),i.stopPropagation(),i.preventDefault()}},!1)),this._registerKeyboardEvent(),this._registerAccelerometerEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,
cc.eventManager.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};cc.inputManager=r,e.exports=r},{}],84:[function(t,e,i){t("./_CCClass"),cc._tmp=cc._tmp||{},cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.getImageFormatByData=function(t){return t.length>8&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?cc.ImageFormat.PNG:t.length>2&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?cc.ImageFormat.TIFF:cc.ImageFormat.UNKNOWN},cc.macro={INVALID_INDEX:-1,NODE_TAG_INVALID:-1,PI:Math.PI,PI2:2*Math.PI,FLT_MAX:parseFloat("3.402823466e+38F"),FLT_MIN:parseFloat("1.175494351e-38F"),RAD:Math.PI/180,DEG:180/Math.PI,UINT_MAX:4294967295,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,LINEAR:9729,BLEND_DST:771,WEB_ORIENTATION_PORTRAIT:0,WEB_ORIENTATION_LANDSCAPE_LEFT:-90,WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN:180,WEB_ORIENTATION_LANDSCAPE_RIGHT:90,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",VERTEX_ATTRIB_FLAG_NONE:0,VERTEX_ATTRIB_FLAG_POSITION:1,VERTEX_ATTRIB_FLAG_COLOR:2,VERTEX_ATTRIB_FLAG_TEX_COORDS:4,VERTEX_ATTRIB_FLAG_POS_COLOR_TEX:7,GL_ALL:0,VERTEX_ATTRIB_POSITION:0,VERTEX_ATTRIB_COLOR:1,VERTEX_ATTRIB_TEX_COORDS:2,VERTEX_ATTRIB_MAX:3,UNIFORM_PMATRIX:0,UNIFORM_MVMATRIX:1,UNIFORM_MVPMATRIX:2,UNIFORM_TIME:3,UNIFORM_SINTIME:4,UNIFORM_COSTIME:5,UNIFORM_RANDOM01:6,UNIFORM_SAMPLER:7,UNIFORM_MAX:8,SHADER_POSITION_TEXTURECOLOR:"ShaderPositionTextureColor",SHADER_SPRITE_POSITION_TEXTURECOLOR:"ShaderSpritePositionTextureColor",SHADER_POSITION_TEXTURECOLORALPHATEST:"ShaderPositionTextureColorAlphaTest",SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:"ShaderSpritePositionTextureColorAlphaTest",SHADER_POSITION_COLOR:"ShaderPositionColor",SHADER_SPRITE_POSITION_COLOR:"ShaderSpritePositionColor",SHADER_POSITION_TEXTURE:"ShaderPositionTexture",SHADER_POSITION_TEXTURE_UCOLOR:"ShaderPositionTexture_uColor",SHADER_POSITION_TEXTUREA8COLOR:"ShaderPositionTextureA8Color",SHADER_POSITION_UCOLOR:"ShaderPosition_uColor",SHADER_POSITION_LENGTHTEXTURECOLOR:"ShaderPositionLengthTextureColor",UNIFORM_PMATRIX_S:"CC_PMatrix",UNIFORM_MVMATRIX_S:"CC_MVMatrix",UNIFORM_MVPMATRIX_S:"CC_MVPMatrix",UNIFORM_TIME_S:"CC_Time",UNIFORM_SINTIME_S:"CC_SinTime",UNIFORM_COSTIME_S:"CC_CosTime",UNIFORM_RANDOM01_S:"CC_Random01",UNIFORM_SAMPLER_S:"CC_Texture0",UNIFORM_ALPHA_TEST_VALUE_S:"CC_alpha_value",ATTRIBUTE_NAME_COLOR:"a_color",ATTRIBUTE_NAME_POSITION:"a_position",ATTRIBUTE_NAME_TEX_COORD:"a_texCoord",ITEM_SIZE:32,CURRENT_ITEM:3233828865,ZOOM_ACTION_TAG:3233828866,NORMAL_TAG:8801,SELECTED_TAG:8802,DISABLE_TAG:8803,FIX_ARTIFACTS_BY_STRECHING_TEXEL:1,DIRECTOR_STATS_POSITION:cc.p(0,0),DIRECTOR_FPS_INTERVAL:.5,COCOSNODE_RENDER_SUBPIXEL:1,SPRITEBATCHNODE_RENDER_SUBPIXEL:1,AUTO_PREMULTIPLIED_ALPHA_FOR_PNG:0,OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA:0,TEXTURE_ATLAS_USE_TRIANGLE_STRIP:0,TEXTURE_ATLAS_USE_VAO:0,TEXTURE_NPOT_SUPPORT:0,USE_LA88_LABELS:1,SPRITE_DEBUG_DRAW:0,LABELBMFONT_DEBUG_DRAW:0,LABELATLAS_DEBUG_DRAW:0,ENABLE_STACKABLE_ACTIONS:1,ENABLE_GL_STATE_CACHE:1},cc.defineGetterSetter(cc.macro,"BLEND_SRC",function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.macro.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?cc.macro.ONE:cc.macro.SRC_ALPHA}),cc.lerp=function(t,e,i){return t+(e-t)*i},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.macro.RAD},cc.radiansToDegrees=function(t){return t*cc.macro.DEG},cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.checkGLErrorDebug=function(){if(cc.renderMode===cc.game.RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();t&&cc.log(cc._LogInfos.checkGLErrorDebug,t)}}},{"./_CCClass":91}],85:[function(t,e,i){function r(){this._name="",this._objFlags=0}function n(){for(var t=A.length,e=0;e<t;++e){var i=A[e];i._objFlags&o||i._destroyImmediate()}t===A.length?A.length=0:A.splice(0,t)}var s=t("./js"),o=1,a=4,c=8,h=16,l=32,u=64,d=128,_=256,f=2048,p=4096,g=8192,m=16384,v=32768,y=65536,C=1<<17,T=1<<18,E=1<<19,x=1<<20,b=1<<21,S=~(a|l|d|u|_|g|v|m|y|f|p|C|T|E|x|b);r.Flags={Destroyed:o,DontSave:c,EditorOnly:h,Dirty:l,DontDestroy:u,PersistentMask:S,Destroying:d,Activating:_,IsPreloadCalled:g,IsOnLoadCalled:m,IsOnLoadStarted:v,IsOnEnableCalled:f,IsStartCalled:y,IsEditorOnEnableCalled:p,IsPositionLocked:b,IsRotationLocked:C,IsScaleLocked:T,IsAnchorLocked:E,IsSizeLocked:x},t("./CCClass").fastDefine("cc.Object",r,{_name:"",_objFlags:0});var A=[];Object.defineProperty(r,"_deferredDestroy",{value:n});var R=r.prototype;s.getset(R,"name",function(){return this._name},function(t){this._name=t}),s.get(R,"isValid",function(){return!(this._objFlags&o)});R.destroy=function(){return this._objFlags&o?(cc.warn("object already destroyed"),!1):!(this._objFlags&a)&&(this._objFlags|=a,A.push(this),!0)},R._destruct=function(){for(var t in this)if(this.hasOwnProperty(t))switch(typeof this[t]){case"string":this[t]="";break;case"object":case"function":this[t]=null}},R._onPreDestroy=null,R._destroyImmediate=function(){return this._objFlags&o?void cc.error("object already destroyed"):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),void(this._objFlags|=o))},R._deserialize=null,cc.isValid=function(t){return"object"==typeof t?!(!t||t._objFlags&o):"undefined"!=typeof t},cc.Object=r,e.exports=r},{"./CCClass":81,"./js":98}],86:[function(t,e,i){cc.SAXParser=cc._Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)),e}}),cc.PlistParser=cc.SAXParser.extend({parse:function(t){var e=this._parseXML(t),i=e.documentElement;if("plist"!==i.tagName)return cc.warn("Not a plist file!"),{};for(var r=null,n=0,s=i.childNodes.length;n<s&&(r=i.childNodes[n],1!==r.nodeType);n++);return e=null,this._parseNode(r)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var r=0;r<t.childNodes.length;r++)e+=t.childNodes[r].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],i=0,r=t.childNodes.length;i<r;i++){var n=t.childNodes[i];1===n.nodeType&&e.push(this._parseNode(n))}return e},_parseDict:function(t){for(var e={},i=null,r=0,n=t.childNodes.length;r<n;r++){var s=t.childNodes[r];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:e[i]=this._parseNode(s))}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser},{}],87:[function(t,e,i){cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i,r,n=this._fnMap;for(t=0,e=n.length;t<e;t++)if(i=n[t],i&&i[1]in document){for(t=0,r=i.length;t<r;t++)this._fn[n[0][t]]=i[t];break}this._supportsFullScreen="undefined"!=typeof this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&(void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement])},requestFullScreen:function(t,e){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var i=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(i,this._preOnFullScreenChange),this._preOnFullScreenChange=e,document.addEventListener(i,e,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(t,e){function i(){r.removeEventListener(n._touchEvent,i),n.requestFullScreen(t,e)}t=t||document.body;var r=cc.game.canvas||t,n=this;this.requestFullScreen(t,e),r.addEventListener(this._touchEvent,i)}},cc.screen.init()},{}],88:[function(t,e,i){if(!cc.sys){cc.sys={};var r=cc.sys;r.LANGUAGE_ENGLISH="en",r.LANGUAGE_CHINESE="zh",r.LANGUAGE_FRENCH="fr",r.LANGUAGE_ITALIAN="it",r.LANGUAGE_GERMAN="de",r.LANGUAGE_SPANISH="es",r.LANGUAGE_DUTCH="du",r.LANGUAGE_RUSSIAN="ru",r.LANGUAGE_KOREAN="ko",r.LANGUAGE_JAPANESE="ja",r.LANGUAGE_HUNGARIAN="hu",r.LANGUAGE_PORTUGUESE="pt",r.LANGUAGE_ARABIC="ar",r.LANGUAGE_NORWEGIAN="no",r.LANGUAGE_POLISH="pl",r.LANGUAGE_UNKNOWN="unknown",r.OS_IOS="iOS",r.OS_ANDROID="Android",r.OS_WINDOWS="Windows",r.OS_MARMALADE="Marmalade",r.OS_LINUX="Linux",r.OS_BADA="Bada",r.OS_BLACKBERRY="Blackberry",r.OS_OSX="OS X",r.OS_WP8="WP8",r.OS_WINRT="WINRT",r.OS_UNKNOWN="Unknown",r.UNKNOWN=-1,r.WIN32=0,r.LINUX=1,r.MACOS=2,r.ANDROID=3,r.IPHONE=4,r.IPAD=5,r.BLACKBERRY=6,r.NACL=7,r.EMSCRIPTEN=8,r.TIZEN=9,r.WINRT=10,r.WP8=11,r.MOBILE_BROWSER=100,r.DESKTOP_BROWSER=101,r.EDITOR_PAGE=102,r.EDITOR_CORE=103,r.BROWSER_TYPE_WECHAT="wechat",r.BROWSER_TYPE_ANDROID="androidbrowser",r.BROWSER_TYPE_IE="ie",r.BROWSER_TYPE_QQ="qqbrowser",r.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",r.BROWSER_TYPE_UC="ucbrowser",r.BROWSER_TYPE_360="360browser",r.BROWSER_TYPE_BAIDU_APP="baiduboxapp",r.BROWSER_TYPE_BAIDU="baidubrowser",r.BROWSER_TYPE_MAXTHON="maxthon",r.BROWSER_TYPE_OPERA="opera",r.BROWSER_TYPE_OUPENG="oupeng",r.BROWSER_TYPE_MIUI="miuibrowser",r.BROWSER_TYPE_FIREFOX="firefox",r.BROWSER_TYPE_SAFARI="safari",r.BROWSER_TYPE_CHROME="chrome",r.BROWSER_TYPE_LIEBAO="liebao",r.BROWSER_TYPE_QZONE="qzone",r.BROWSER_TYPE_SOUGOU="sogou",r.BROWSER_TYPE_UNKNOWN="unknown",r.isNative=!1,r.isBrowser="object"==typeof window&&"object"==typeof document;var n=window,s=n.navigator,o=document,a=o.documentElement,c=s.userAgent.toLowerCase();r.isMobile=/mobile|android|mqqbrowser|micromessenger|miuibrowser/.test(c),r.platform=r.isMobile?r.MOBILE_BROWSER:r.DESKTOP_BROWSER;var h=s.language;h=h?h:s.browserLanguage,h=h?h.split("-")[0]:r.LANGUAGE_ENGLISH,r.language=h;var l=!1,u=!1,d="",_=0,f=/android (\d+(?:\.\d+)+)/i.exec(c)||/android (\d+(?:\.\d+)+)/i.exec(s.platform);f&&(l=!0,d=f[1]||"",_=parseInt(d)||0),f=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(c),f&&(u=!0,d=f[2]||"",_=parseInt(d)||0);var p=r.OS_UNKNOWN;s.appVersion.indexOf("Win")!==-1?p=r.OS_WINDOWS:u?p=r.OS_IOS:s.appVersion.indexOf("Mac")!==-1?p=r.OS_OSX:s.appVersion.indexOf("X11")!==-1&&s.appVersion.indexOf("Linux")===-1?p=r.OS_UNIX:l?p=r.OS_ANDROID:s.appVersion.indexOf("Linux")!==-1&&(p=r.OS_LINUX),r.os=p,r.osVersion=d,r.osMainVersion=_,r.browserType=r.BROWSER_TYPE_UNKNOWN,function(){var t=/mqqbrowser|sogou|qzone|liebao|micromessenger|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i,e=/qqbrowser|chrome|safari|firefox|opr|oupeng|opera/i,i=t.exec(c);i||(i=e.exec(c));var n=i?i[0]:r.BROWSER_TYPE_UNKNOWN;"micromessenger"===n?n=r.BROWSER_TYPE_WECHAT:"safari"===n&&c.match(/android.*applewebkit/)?n=r.BROWSER_TYPE_ANDROID:"trident"===n?n=r.BROWSER_TYPE_IE:"360 aphone"===n?n=r.BROWSER_TYPE_360:"mxbrowser"===n?n=r.BROWSER_TYPE_MAXTHON:"opr"===n&&(n=r.BROWSER_TYPE_OPERA),r.browserType=n}(),r.browserVersion="",function(){var t=/(micromessenger|qq|mx|maxthon|baidu|sogou)(mobile)?(browser)?\/?([\d.]+)/i,e=/(msie |rv:|firefox|chrome|ucbrowser|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i,i=c.match(t);i||(i=c.match(e)),r.browserVersion=i?i[4]:""}();var g=window.innerWidth||document.documentElement.clientWidth,m=window.innerHeight||document.documentElement.clientHeight,v=window.devicePixelRatio||1;r.windowPixelResolution={width:v*g,height:v*m},r._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};var y=document.createElement("canvas"),C=document.createElement("canvas");if(cc.create3DContext=function(t,e){for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null,n=0;n<i.length;++n){try{r=t.getContext(i[n],e)}catch(s){}if(r)break}return r},r._supportCanvasNewBlendModes=function(){var t,e,i=y;i.width=1,i.height=1;var r=i.getContext("2d");r.fillStyle="#000",r.fillRect(0,0,1,1),r.globalCompositeOperation="multiply";var n=C;n.width=1,n.height=1;var s=n.getContext("2d");s.fillStyle="#fff",s.fillRect(0,0,1,1),r.drawImage(n,0,0,1,1),t=r.getImageData(0,0,1,1).data[0],i=y,i.width=1,i.height=1;var r=i.getContext("2d");r.fillStyle="#fff",r.fillRect(0,0,1,1),r.globalCompositeOperation="destination-atop",n=C,n.width=1,n.height=1;var s=n.getContext("2d");return s.fillStyle="#000",s.fillRect(0,0,1,1),r.drawImage(n,0,0,1,1),e=r.getImageData(0,0,1,1).data[0],0===t&&0===e}(),cc.sys.isMobile){var T=document.createElement("style");T.type="text/css",document.body.appendChild(T),T.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"}try{var E=r.localStorage=n.localStorage;E.setItem("storage",""),E.removeItem("storage"),E=null}catch(x){var b=function(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")};r.localStorage={getItem:b,setItem:b,removeItem:b,clear:b}}var S=!!y.getContext("2d"),A=!1;if(n.WebGLRenderingContext){var R=document.createElement("CANVAS");try{var O=cc.create3DContext(R,{stencil:!0});if(O&&(A=!0),A&&r.os===r.OS_ANDROID){var I=parseFloat(r.browserVersion);switch(r.browserType){case r.BROWSER_TYPE_MOBILE_QQ:case r.BROWSER_TYPE_BAIDU:case r.BROWSER_TYPE_BAIDU_APP:A=I>=6.2;break;case r.BROWSER_TYPE_ANDROID:r.osMainVersion&&r.osMainVersion>=5&&(A=!0);break;case r.BROWSER_TYPE_CHROME:A=I>=30;break;case r.BROWSER_TYPE_UNKNOWN:case r.BROWSER_TYPE_360:case r.BROWSER_TYPE_MIUI:case r.BROWSER_TYPE_UC:A=!1}}}catch(x){}R=null}var w=r.capabilities={canvas:S,opengl:A};(void 0!==a.ontouchstart||void 0!==o.ontouchstart||s.msPointerEnabled)&&(w.touches=!0),void 0!==a.onmouseup&&(w.mouse=!0),void 0!==a.onkeyup&&(w.keyboard=!0),(n.DeviceMotionEvent||n.DeviceOrientationEvent)&&(w.accelerometer=!0);var P;!function(){var t=!1,e=r.browserVersion,i=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);P={ONLY_ONE:!1,WEB_AUDIO:i,DELAY_CREATE_CTX:!1},r.os===r.OS_IOS&&(P.USE_LOADER_EVENT="loadedmetadata"),r.browserType===r.BROWSER_TYPE_FIREFOX&&(P.DELAY_CREATE_CTX=!0,P.USE_LOADER_EVENT="canplay"),r.os===r.OS_ANDROID&&r.browserType===r.BROWSER_TYPE_UC&&(P.ONE_SOURCE=!0),t&&setTimeout(function(){cc.log("browse type: "+r.browserType),cc.log("browse version: "+e),cc.log("MULTI_CHANNEL: "+P.MULTI_CHANNEL),cc.log("WEB_AUDIO: "+P.WEB_AUDIO),cc.log("AUTOPLAY: "+P.AUTOPLAY)},0)}();try{P.WEB_AUDIO&&(P.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),P.DELAY_CREATE_CTX&&setTimeout(function(){P.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0))}catch(L){P.WEB_AUDIO=!1,cc.log("browser don't support web audio")}var N=[];!function(){var t=document.createElement("audio");if(t.canPlayType){var e=t.canPlayType('audio/ogg; codecs="vorbis"');e&&N.push(".ogg");var i=t.canPlayType("audio/mpeg");i&&N.push(".mp3");var r=t.canPlayType('audio/wav; codecs="1"');r&&N.push(".wav");var n=t.canPlayType("audio/mp4");n&&N.push(".mp4");var s=t.canPlayType("audio/x-m4a");s&&N.push(".m4a")}}(),P.format=N,r.__audioSupport=P,r.garbageCollect=function(){},r.dumpRoot=function(){},r.restartVM=function(){},r.cleanScript=function(t){},r.isObjectValid=function(t){return!!t},r.dump=function(){var t=this,e="";e+="isMobile : "+t.isMobile+"\r\n",e+="language : "+t.language+"\r\n",e+="browserType : "+t.browserType+"\r\n",e+="browserVersion : "+t.browserVersion+"\r\n",e+="capabilities : "+JSON.stringify(t.capabilities)+"\r\n",e+="os : "+t.os+"\r\n",e+="osVersion : "+t.osVersion+"\r\n",e+="platform : "+t.platform+"\r\n",e+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(e)},r.openURL=function(t){window.open(t)},e.exports=r}},{}],89:[function(t,e,i){var r={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(window.navigator.userAgent.indexOf("OS 8_1_")>-1&&(r.adaptationType=cc.sys.BROWSER_TYPE_MIUI),cc.sys.os===cc.sys.OS_IOS&&(r.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),r.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:r.meta["minimal-ui"]="true",r.availWidth=function(t){return t.clientWidth},r.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:r.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:r.availWidth=function(t){return t.clientWidth},r.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:r.init=function(t){if(!t.__resizeWithBrowserSize){var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}}}var n=cc.rect(),s=cc._Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!1,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_isRotated:!1,_orientation:3,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_contentTranslateLeftTop:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var t=this,e=(document,cc.ContainerStrategy),i=cc.ContentStrategy;r.init(this),t._frameSize=cc.size(0,0),t._initFrameSize();var n=cc.game.canvas.width,s=cc.game.canvas.height;t._designResolutionSize=cc.size(n,s),t._originalDesignResolutionSize=cc.size(n,s),t._viewPortRect=cc.rect(0,0,n,s),t._visibleRect=cc.rect(0,0,n,s),t._contentTranslateLeftTop={left:0,top:0},t._viewName="Cocos2dHTML5";var o=cc.sys;t.enableRetina(o.os===o.OS_IOS||o.os===o.OS_OSX),cc.visibleRect&&cc.visibleRect.init(t._visibleRect),t._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(e.PROPORTION_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_WIDTH),t._targetDensityDPI=cc.macro.DENSITYDPI_HIGH},_resizeEvent:function(){var t;t=this.setDesignResolutionSize?this:cc.view;var e=t._frameSize.width,i=t._frameSize.height,r=t._isRotated;if(t._initFrameSize(),t._isRotated!==r||t._frameSize.width!==e||t._frameSize.height!==i){var n=t._originalDesignResolutionSize.width,s=t._originalDesignResolutionSize.height;n>0&&t.setDesignResolutionSize(n,s,t._resolutionPolicy),cc.eventManager.dispatchCustomEvent("canvas-resize"),t._resizeCallback&&t._resizeCallback.call()}},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._resizeEvent)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._resizeEvent))},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){t&=cc.macro.ORIENTATION_AUTO,t&&(this._orientation=t)},_initFrameSize:function(){var t=this._frameSize,e=r.availWidth(cc.game.frame),i=r.availHeight(cc.game.frame),n=e>=i;!cc.sys.isMobile||n&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!n&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;t>0&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var r,n,s,o=document.getElementsByName("viewport"),a=o?o[0]:null;r=a?a.content:"",i=i||document.createElement("meta"),i.id="cocosMetaElement",i.name="viewport",i.content="";for(n in t)r.indexOf(n)==-1?r+=","+n+"="+t[n]:e&&(s=new RegExp(n+"s*=s*[^,]+"),r.replace(s,n+"="+t[n]));/^,/.test(r)&&(r=r.substr(1)),i.content=r,a&&(a.content=r),document.head.appendChild(i)},_adjustViewportMeta:function(){this._isAdjustViewPort&&(this._setViewportMeta(r.meta,!1),this._isAdjustViewPort=!1)},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile&&cc.game.frame===document.documentElement?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},isViewReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(t){this._frameZoomFactor=t,this.centerWindow(),cc.director.setProjection(cc.director.getProjection())},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},setCanvasSize:function(t,e){var i=cc.game.canvas,r=cc.game.container;i.width=t*this._devicePixelRatio,i.height=e*this._devicePixelRatio,i.style.width=t+"px",i.style.height=e+"px",r.style.width=t+"px",r.style.height=e+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=e+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e=this;if(t instanceof cc.ResolutionPolicy)e._resolutionPolicy=t;else{var i=cc.ResolutionPolicy;t===i.EXACT_FIT&&(e._resolutionPolicy=e._rpExactFit),t===i.SHOW_ALL&&(e._resolutionPolicy=e._rpShowAll),t===i.NO_BORDER&&(e._resolutionPolicy=e._rpNoBorder),t===i.FIXED_HEIGHT&&(e._resolutionPolicy=e._rpFixedHeight),t===i.FIXED_WIDTH&&(e._resolutionPolicy=e._rpFixedWidth)}},setDesignResolutionSize:function(t,e,i){if(!(t>0||e>0))return void cc.log(cc._LogInfos.view.setDesignResolutionSize);this.setResolutionPolicy(i);var r=this._resolutionPolicy;if(!r)return void cc.log(cc._LogInfos.view.setDesignResolutionSize_2);r.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._initFrameSize(),this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var n=r.apply(this,this._designResolutionSize);if(n.scale&&2===n.scale.length&&(this._scaleX=n.scale[0],this._scaleY=n.scale[1]),n.viewport){var s=this._viewPortRect,o=this._visibleRect,a=n.viewport;s.x=a.x,s.y=a.y,s.width=a.width,s.height=a.height,o.x=-s.x/this._scaleX,o.y=-s.y/this._scaleY,o.width=cc.game.canvas.width/this._scaleX,o.height=cc.game.canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(s.x,-s.y)}var c=cc.director;c._winSizeInPoints.width=this._designResolutionSize.width,c._winSizeInPoints.height=this._designResolutionSize.height,r.postApply(this),cc.winSize.width=c._winSizeInPoints.width,cc.winSize.height=c._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL&&c.setGLDefaultValues(),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.DOM&&cc.DOM._resetEGLViewDiv(),cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t},!0),document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},setViewPortInPoints:function(t,e,i,r){var n=this._frameZoomFactor,s=this._scaleX,o=this._scaleY;cc._renderContext.viewport(t*s*n+this._viewPortRect.x*n,e*o*n+this._viewPortRect.y*n,i*s*n,r*o*n)},setScissorInPoints:function(t,e,i,r){var s=this._frameZoomFactor,o=this._scaleX,a=this._scaleY;n.x=t,n.y=e,n.width=i,n.height=r,cc._renderContext.scissor(t*o*s+this._viewPortRect.x*s,e*a*s+this._viewPortRect.y*s,i*o*s,r*a*s)},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){return cc.rect(n)},setViewName:function(t){null!=t&&t.length>0&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){var r=this._devicePixelRatio*(t-i.left),n=this._devicePixelRatio*(i.top+i.height-e);return this._isRotated?{x:this._viewPortRect.width-n,y:r}:{x:r,y:n}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect,r=this;t.x=(r._devicePixelRatio*(t.x-e.left)-i.x)/r._scaleX,t.y=(r._devicePixelRatio*(e.top+e.height-t.y)-i.y)/r._scaleY},_convertPointWithScale:function(t){var e=this._viewPortRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,r,n=this._viewPortRect,s=this._scaleX,o=this._scaleY,a=0;a<t.length;a++)e=t[a],i=e._point,r=e._prevPoint,i.x=(i.x-n.x)/s,i.y=(i.y-n.y)/o,r.x=(r.x-n.x)/s,r.y=(r.y-n.y)/o}});s._getInstance=function(){return this._instance||(this._instance=this._instance||new s,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc._Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var r=cc.game.canvas,n=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),n.style.width=r.style.width=e+"px",n.style.height=r.style.height=i+"px";var s=t._devicePixelRatio=1;t.isRetinaEnabled()&&(s=t._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),r.width=e*s,r.height=i*s,cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden",cc.container.style.position="fixed",document.body.scrollTop=0}}),cc.ContentStrategy=cc._Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,r,n,s){Math.abs(t-i)<2&&(i=t),Math.abs(e-r)<2&&(r=e);var o=cc.rect(Math.round((t-i)/2),Math.round((e-r)/2),i,r);return cc._renderType===cc.game.RENDER_TYPE_CANVAS,this._result.scale=[n,s],this._result.viewport=o,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),function(){var t=cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,t._frameSize.width,t._frameSize.height)}}),e=cc.ContainerStrategy.extend({apply:function(t,e){var i,r,n=t._frameSize.width,s=t._frameSize.height,o=cc.container.style,a=e.width,c=e.height,h=n/a,l=s/c;h<l?(i=n,r=c*h):(i=a*l,r=s);var u=Math.round((n-i)/2),d=Math.round((s-r)/2);i=n-2*u,r=s-2*d,this._setupContainer(t,i,r),t._isRotated?o.marginLeft=s+"px":o.margin="0px",o.paddingLeft=u+"px",o.paddingRight=u+"px",o.paddingTop=d+"px",o.paddingBottom=d+"px"}}),i=(t.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),e.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height)}}));cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i;var r=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,r=cc.game.canvas.height,n=i/e.width,s=r/e.height;return this._buildResult(i,r,i,r,n,s);
}}),n=cc.ContentStrategy.extend({apply:function(t,e){var i,r,n=cc.game.canvas.width,s=cc.game.canvas.height,o=e.width,a=e.height,c=n/o,h=s/a,l=0;return c<h?(l=c,i=n,r=a*l):(l=h,i=o*l,r=s),this._buildResult(n,s,i,r,l,l)}}),s=cc.ContentStrategy.extend({apply:function(t,e){var i,r,n,s=cc.game.canvas.width,o=cc.game.canvas.height,a=e.width,c=e.height,h=s/a,l=o/c;return h<l?(i=l,r=a*i,n=o):(i=h,r=s,n=c*i),this._buildResult(s,o,r,n,i,i)}}),o=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,r=cc.game.canvas.height,n=e.height,s=r/n,o=i,a=r;return this._buildResult(i,r,o,a,s,s)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}}),a=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,r=cc.game.canvas.height,n=e.width,s=i/n,o=i,a=r;return this._buildResult(i,r,o,a,s,s)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new r,cc.ContentStrategy.SHOW_ALL=new n,cc.ContentStrategy.NO_BORDER=new s,cc.ContentStrategy.FIXED_HEIGHT=new o,cc.ContentStrategy.FIXED_WIDTH=new a}(),cc.ResolutionPolicy=cc._Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),cc.js.get(cc.ResolutionPolicy.prototype,"canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,e.exports=s},{}],90:[function(t,e,i){cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,r=t.x,n=t.y,s=n+i,o=r+e;this.topLeft.x=r,this.topLeft.y=s,this.topRight.x=o,this.topRight.y=s,this.top.x=r+e/2,this.top.y=s,this.bottomLeft.x=r,this.bottomLeft.y=n,this.bottomRight.x=o,this.bottomRight.y=n,this.bottom.x=r+e/2,this.bottom.y=n,this.center.x=r+e/2,this.center.y=n+i/2,this.left.x=r,this.left.y=n+i/2,this.right.x=o,this.right.y=n+i/2}}},{}],91:[function(t,e,i){var r=cc.ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}},n=/\b_super\b/,s=function(){};s.extend=function(t){function e(){this.__instanceId=r.getNewInstanceId(),this.ctor&&this.ctor.apply(this,arguments)}var i=this.prototype,o=Object.create(i),a=r.getNewID();r[a]=i;var c={writable:!0,configurable:!0};o.__instanceId=null,e.id=a,c.value=a,Object.defineProperty(o,"__cid__",c),e.prototype=o,c.value=e,Object.defineProperty(e.prototype,"constructor",c);for(var h=0,l=arguments.length;h<l;++h){var u=arguments[h];for(var d in u){var _="function"==typeof u[d],f="function"==typeof i[d],p=n.test(u[d]);_&&f&&p?(c.value=function(t,e){return function(){var r=this._super;this._super=i[t];var n=e.apply(this,arguments);return this._super=r,n}}(d,u[d]),Object.defineProperty(o,d,c)):_?(c.value=u[d],Object.defineProperty(o,d,c)):o[d]=u[d]}}return e.extend=s.extend,e.implement=function(t){for(var e in t)o[e]=t[e]},e},cc.defineGetterSetter=function(t,e,i,r,n,s){if(t.__defineGetter__)i&&t.__defineGetter__(e,i),r&&t.__defineSetter__(e,r);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var o={configurable:!0};i&&(o.get=i),r&&(o.set=r),Object.defineProperty(t,e,o)}},cc.clone=function(t){var e=t.constructor?new t.constructor:{};for(var i in t){var r=t[i];"object"!=typeof r||!r||r instanceof _ccsg.Node||r instanceof HTMLElement?e[i]=r:e[i]=cc.clone(r)}return e},cc._Class=e.exports=s},{}],92:[function(t,e,i){function r(t,e,i){var r,n;r=function(){},i&&u.extend(r,i.constructor);var s=new r;return Object.defineProperty(t,"__attrs__",{value:s}),s}function n(t){for(var e,i=cc.Class.getInheritanceChain(t),n=i.length-1;n>=0;n--){var s=i[n],o=s.__attrs__;o||(e=i[n+1],r(s,s,e&&e.__attrs__))}return e=i[0],r(t,t,e&&e.__attrs__),t.__attrs__}function s(t,e,i){var s,o,a;if("function"==typeof t)s=t.__attrs__||n(t),o=s.constructor.prototype;else{var c=t;if(s=c.__attrs__,!s){t=c.constructor;var h=t.__attrs__||n(t);s=r(c,t,h)}o=s}if("undefined"==typeof i){var l=e+_,u={};for(a in s)a.startsWith(l)&&(u[a.slice(l.length)]=s[a]);return u}if("object"==typeof i)for(a in i)95!==a.charCodeAt(0)&&(o[e+_+a]=i[a])}function o(t){return t.__attrs__||n(t)}function a(t,e,i,r){var s=t.__attrs__||n(t);s.constructor.prototype[e+_+i]=r}function c(t,e){}function h(t){return{type:"Object",ctor:t,_onAfterProp:!1}}function l(t){return{rawType:t,serializable:!1,_canUsedInGetter:!1,_onAfterProp:function(t,e){}}}var u=t("./js"),d=t("./utils").isPlainEmptyObj_DEV,_="$_$";cc.Integer="Integer",cc.Float="Float",cc.Boolean="Boolean",cc.String="String";var f={serializable:!1,_canUsedInGetter:!1},p={editorOnly:!0,_canUsedInGetter:!1};e.exports={attr:s,getClassAttrs:o,setClassAttr:a,DELIMETER:_,getTypeChecker:c,NonSerialized:f,EditorOnly:p,ObjectType:h,RawType:l,ScriptUuid:{}}},{"./js":98,"./utils":104}],93:[function(t,e,i){var r=t("./js"),n=function(){this._callbackTable={}},s=Number.POSITIVE_INFINITY;n.REMOVE_PLACEHOLDER=s,n.prototype._clearToRemove=function(t){var e=this._callbackTable[t];if(this._toRemove[t]&&e){var i,r;for(r=e.length-1;r>=0;){for(i=0;e[r]===s;)r--,i++;i>0?e.splice(r+1,i):r--}delete this._toRemove[t]}this._toRemoveAll&&(this.removeAll(this._toRemoveAll),this._toRemoveAll=null)},n.prototype.add=function(t,e,i){var r=this._callbackTable[t];return"undefined"!=typeof r?(r.push(e),"object"==typeof i&&r.push(i),!1):(r="object"==typeof i?[e,i]:[e],this._callbackTable[t]=r,!0)},n.prototype.has=function(t,e,i){var r,n,s=this._callbackTable[t];if(s&&s.length>0){if(!e)return!0;if("function"!=typeof e)return!1;for(n=s.indexOf(e);n!==-1;){if(r=s[n+1],"object"!=typeof r&&(r=void 0),r===i)return!0;n=cc.js.array.indexOf.call(s,e,n+1)}return!1}return!1},n.prototype.removeAll=function(t){if(this._invoking[t])return void(this._toRemoveAll=t);if("object"==typeof t){var e,i,r,n=t;for(t in this._callbackTable)for(e=this._callbackTable[t],i=e.lastIndexOf(n);i!==-1;)r=e[i-1],"function"==typeof r?e.splice(i-1,2):e.splice(i,1),i=e.lastIndexOf(n)}else delete this._callbackTable[t]},n.prototype.remove=function(t,e,i){var r,n,o=this._callbackTable[t];if(o){for(r=o.indexOf(e);r!==-1;){if(n=o[r+1],"object"!=typeof n&&(n=void 0),n===i){this._invoking[t]?(o[r]=s,n&&(o[r+1]=s),this._toRemove[t]=!0):o.splice(r,n?2:1);break}r=cc.js.array.indexOf.call(o,e,r+1)}return!0}return!1};var o=function(){n.call(this),this._invoking={},this._toRemove={},this._toRemoveAll=null};r.extend(o,n),o.prototype.invoke=function(t,e,i,r,n,o){this._invoking[t]=!0;var a=this._callbackTable[t];if(a){var c,h=a.length-1;for(c=0;c<=h;){var l=a[c],u=1;if(l!==s){var d=a[c+1],_=d&&"object"==typeof d;_?(l.call(d,e,i,r,n,o),u=2):l(e,i,r,n,o)}c+=u}}this._invoking[t]=!1,this._clearToRemove(t)},o.prototype.invokeAndRemove=function(t,e,i,r,n,o){this._invoking[t]=!0;var a,c,h,l,u,d=this._callbackTable[t];if(d)for(a=0,c=d.length;a<c;)l=d[a],h=1,l!==s&&(u=d[a+1],u&&"object"==typeof u?(l.call(u,e,i,r,n,o),h=2):l(e,i,r,n,o)),a+=h;this._invoking[t]=!1,delete this._toRemove[t],this.removeAll(t)},o.prototype.bindKey=function(t,e){var i=this;return function(r,n,s,o,a){var c,h,l,u=i._callbackTable[t];if(u)for(c=0,h=u.length;c<h;)l=u[c+1],l&&"object"==typeof l?(u[c].call(l,r,n,s,o,a),c+=2):(u[c](r,n,s,o,a),++c);e&&i.removeAll(t)}},o.CallbacksHandler=n,e.exports=o},{"./js":98}],94:[function(t,e,i){var r=t("./js"),n=(t("./CCObject"),t("./attribute")),s=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp=""};s.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp=""},s.prototype.getUuidOf=function(t,e){for(var i=0;i<this.uuidObjList.length;i++)if(this.uuidObjList[i]===t&&this.uuidPropList[i]===e)return this.uuidList[i];return""},s.prototype.push=function(t,e,i){this.uuidList.push(i),this.uuidObjList.push(t),this.uuidPropList.push(e)};var o=function(){function t(t,i,r,n,o,a){if(this._classFinder=n,this._idList=[],this._idObjList=[],this._idPropList=[],this.result=i||new s,this.customEnv=o,Array.isArray(t)){var h=t,l=h.length;this.deserializedList=new Array(l);for(var u=0;u<l;u++)if(h[u]){var d;this.deserializedList[u]=c(this,h[u],d)}this.deserializedData=l>0?this.deserializedList[0]:[]}else this.deserializedList=[null],this.deserializedData=t?c(this,t,r):null,this.deserializedList[0]=this.deserializedData;e(this)}function e(t){for(var e=t.deserializedList,i=t._idPropList,r=t._idList,n=t._idObjList,s=0,o=t._idList.length;s<o;s++){var a=i[s],c=r[s];n[s][a]=e[c]}}function i(t,e,i){for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];"object"!=typeof n?"__type__"!==r&&(e[r]=n):n?t._deserializeObjField(e,n,r):e[r]=null}}function o(t,e,i){for(var r in e){var n=i[r];"undefined"!=typeof n&&i.hasOwnProperty(r)&&("object"!=typeof n?e[r]=n:n?t._deserializeObjField(e,n,r):e[r]=null)}}function a(t,e,r,s,o){for(var a=s.__props__,c=n.getClassAttrs(s),u=0;u<a.length;u++){var d=a[u],_=c[d+h];if(_)t.result.rawProp&&cc.error("not support multi raw object in a file"),t.result.rawProp=d;else{if(c[d+l]===!1)continue;var f=r[d];if("undefined"==typeof f)continue;"object"!=typeof f?e[d]=f:f?t._deserializeObjField(e,f,d):e[d]=null}}"_$erialized"===a[a.length-1]&&(e._$erialized=JSON.parse(JSON.stringify(r)),i(t,e._$erialized,r))}function c(t,e,n){var s,c=null,h=null;if(e.__type__){var l=e.__type__;if(h=t._classFinder(l,e),!h){var u=t._classFinder===r._getClassById;return u&&cc.deserialize.reportMissingClass(l),null}if(c=new h,c._deserialize)return c._deserialize(e.content,t),c;cc.Class._isCCClass(h)?a(t,c,e,h,n):o(t,c,e)}else if(Array.isArray(e)){c=new Array(e.length);for(var d=0;d<e.length;d++)s=e[d],"object"==typeof s&&s?t._deserializeObjField(c,s,""+d):c[d]=s}else c={},i(t,c,e);return c}t.prototype._deserializeObjField=function(t,e,i,r){var n=e.__id__;if("undefined"==typeof n){var s=e.__uuid__;s?(this.result.uuidList.push(s),this.result.uuidObjList.push(t),this.result.uuidPropList.push(i)):t[i]=c(this,e)}else{var o=this.deserializedList[n];o?t[i]=o:(this._idList.push(n),this._idObjList.push(t),this._idPropList.push(i))}};var h=n.DELIMETER+"rawType",l=(n.DELIMETER+"editorOnly",n.DELIMETER+"serializable");return t}();cc.deserialize=function(t,e,i){i=i||{};var n=i.classFinder||r._getClassById,a=i.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,c=!1,h=i.customEnv,l=i.ignoreEditorOnly;"string"==typeof t&&(t=JSON.parse(t)),a&&!e&&(e=new s),cc.game._isCloning=!0;var u=new o(t,e,c,n,h,l);return cc.game._isCloning=!1,a&&e.assignAssetsBy(Editor.serialize.asAsset),u.deserializedData},cc.deserialize.Details=s,cc.deserialize.reportMissingClass=function(t){cc.warn('Can not find class "%s"',t)}},{"./CCObject":85,"./attribute":92,"./js":98}],95:[function(t,e,i){function r(t){this.id=0|998*Math.random(),this.prefix=t?""+t+n:""}var n=".";r.prototype.getNewId=function(){return this.prefix+ ++this.id},r.global=new r("global"),e.exports=r},{}],96:[function(t,e,i){t("./js"),t("./CCClass"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./prefab-info"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),cc.sys.isBrowser&&t("./CCAssetLibrary"),t("./miniFramework"),t("./CCVisibleRect")},{"./CCAssetLibrary":80,"./CCClass":81,"./CCMacro":84,"./CCObject":85,"./CCSys":88,"./CCVisibleRect":90,"./callbacks-invoker":93,"./deserialize":94,"./instantiate":97,"./js":98,"./miniFramework":99,"./prefab-info":100,"./requiring-frame":102,"./url":103}],97:[function(t,e,i){function r(t){if("object"!=typeof t||Array.isArray(t))return cc.error("The thing you want to instantiate must be an object"),null;if(!t)return cc.error("The thing you want to instantiate is nil"),null;if(t instanceof o&&!t.isValid)return cc.error("The thing you want to instantiate is destroyed"),null;var e;if(t instanceof o){if(t._instantiate)return cc.game._isCloning=!0,e=t._instantiate(),cc.game._isCloning=!1,e;if(t instanceof cc.Asset)return cc.error("The instantiate method for given asset do not implemented"),null}return cc.game._isCloning=!0,e=n(t),cc.game._isCloning=!1,e}function n(t,e){if(Array.isArray(t))return cc.error("Can not instantiate array"),null;if(h&&h(t))return cc.error("Can not instantiate DOM element"),null;for(var i=u(t,e),r=0,n=l.length;r<n;++r)l[r]._iN$t=null;return l.length=0,i}function s(t,e,i,r){var n=t._iN$t;if(n)return n;if(!cc.isValid(t))return null;if(t instanceof cc.Asset)return t;if(Array.isArray(t)){var o=t.length;n=new Array(o),t._iN$t=n;for(var a=0;a<o;++a){var c=t[a],h=typeof c;"object"===h?n[a]=c?s(c,e,n,""+a):c:n[a]="function"!==h?c:null}return l.push(t),n}if(t instanceof cc.ValueType)return t.clone();var d=t.constructor;if(cc.Class._isCCClass(d)){if(e)if(e instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return t}else if(e instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof cc.Component&&!t.node.isChildOf(e))return t}else if(d!==Object)return t;return u(t,e)}var o=t("./CCObject"),a=o.Flags.PersistentMask,c=t("./attribute"),h=t("./utils").isDomNode,l=[],u=function(t,e){var i,r,n,h=t.constructor,u=new h;if(t._iN$t=u,l.push(t),cc.Class._isCCClass(h))for(var d=c.DELIMETER,_=h.__props__,f=c.getClassAttrs(h),p=0;p<_.length;p++)n=_[p],f[n+d+"serializable"]!==!1&&(i=t[n],r=typeof i,"object"===r?u[n]=i?s(i,e,u,n):i:u[n]="function"!==r?i:null);else for(n in t)!t.hasOwnProperty(n)||95===n.charCodeAt(0)&&95===n.charCodeAt(1)&&"__type__"!==n||(i=t[n],i!==u&&(r=typeof i,"object"===r?u[n]=i?s(i,e,u,n):i:u[n]="function"!==r?i:null));return t instanceof o&&(u._objFlags&=a),u};r._clone=n,cc.instantiate=r,e.exports=r},{"./CCObject":85,"./attribute":92,"./utils":104}],98:[function(t,e,i){function r(t,e){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;var n=Object.getPrototypeOf(t);return n?r(n,e):null}function n(t,e,i){var n=r(e,t);Object.defineProperty(i,t,n)}function s(){return a+c++}var o={isNumber:function(t){return"number"==typeof t||t instanceof Number},isString:function(t){return"string"==typeof t||t instanceof String},addon:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;e<i;e++){var r=arguments[e];if(r){if("object"!=typeof r){cc.error("cc.js.addon called on non-object:",r);continue}for(var s in r)s in t||n(s,r,t)}}return t},mixin:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;e<i;e++){var r=arguments[e];if(r){if("object"!=typeof r){cc.error("cc.js.mixin: arguments must be type object:",r);continue}for(var s in r)n(s,r,t)}}return t},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t},clear:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)delete t[e[i]]},getPropertyDescriptor:r};o.getClassName=function(t){if("function"==typeof t){if(t.prototype.__classname__)return t.prototype.__classname__}else if(t&&t.constructor){if(t.constructor.prototype&&t.constructor.prototype.hasOwnProperty("__classname__"))return t.__classname__;var e;if(t.constructor.name&&(e=t.constructor.name),t.constructor.toString){var i,r=t.constructor.toString();i="["===r.charAt(0)?r.match(/\[\w+\s*(\w+)\]/):r.match(/function\s*(\w+)/),i&&2===i.length&&(e=i[1])}return"Object"!==e?e:""}return""};var a="cc.TmpCId.",c=0;!function(){function t(t,e){return function(i,r){if(r.prototype.hasOwnProperty(t)&&delete e[r.prototype[t]],r.prototype[t]=i,i){var n=e[i];if(n&&n!==r){var s="A Class already exists with the same "+t+' : "'+i+'".';cc.error(s)}else e[i]=r}}}var e={},i={};o._setClassId=t("__cid__",e);var r=t("__classname__",i);o.setClassName=function(t,e){if(r(t,e),!e.prototype.hasOwnProperty("__cid__")){var i=t||s();i&&o._setClassId(i,e)}},o.unregisterClass=function(t){"use strict";for(var r=0;r<arguments.length;r++){var n=arguments[r].prototype,s=n.__cid__;s&&delete e[s];var o=n.__classname__;o&&delete i[o]}},o._getClassById=function(t){return e[t]},o.getClassByName=function(t){return i[t]},o._getClassId=function(t,e){e="undefined"==typeof e||e;var i;if("function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return i=t.prototype.__cid__;if(t&&t.constructor){var r=t.constructor.prototype;if(r&&r.hasOwnProperty("__cid__"))return i=t.__cid__}return""}}(),o.getset=function(t,e,i,r,n){"function"!=typeof r&&(n=r,r=void 0),Object.defineProperty(t,e,{get:i,set:r,enumerable:!!n})},o.get=function(t,e,i,r){Object.defineProperty(t,e,{get:i,enumerable:!!r})},o.set=function(t,e,i,r){Object.defineProperty(t,e,{set:i,enumerable:!!r})},o.obsolete=function(t,e,i,r){function n(){return this[i]}var s=e.split(".").slice(-1);r?o.getset(t,s,n,function(t){this[i]=t}):o.get(t,s,n)},o.obsoletes=function(t,e,i,r){for(var n in i){var s=i[n];o.obsolete(t,e+"."+n,s,r)}},o.formatStr=function(){var t=arguments,e=t.length;if(e<1)return"";var i=/(%d)|(%s)/,r=1,n=t[0],s="string"==typeof n&&i.test(n);if(s)for(var o=/%s/;r<e;++r){var a=t[r],c="number"==typeof a?i:o;c.test(n)?n=n.replace(c,a):n+=" "+a}else if(e>1)for(;r<e;++r)n+=" "+t[r];else n=""+n;return n},o.array={remove:function(t,e){var i=t.indexOf(e);return i!==-1&&(t.splice(i,1),!0)},removeAt:function(t,e){t.splice(e,1)},contains:function(t,e){return t.indexOf(e)!==-1},verifyType:function(t,e){if(t&&t.length>0)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.log(cc._LogInfos.Array.verifyType),!1;return!0},removeArray:function(t,e){for(var i=0,r=e.length;i<r;i++)remove(t,e[i])},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},copy:function(t){var e,i=t.length,r=new Array(i);for(e=0;e<i;e+=1)r[e]=t[e];return r},indexOf:Array.prototype.indexOf},cc.js=o,e.exports=o},{}],99:[function(t,e,i){switch(cc.$=function(t){var e=this===cc?document:this,i=t instanceof HTMLElement?t:e.querySelector(t);return i&&(i.find=i.find||cc.$,i.hasClass=i.hasClass||function(t){return this.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},i.addClass=i.addClass||function(t){return this.hasClass(t)||(this.className&&(this.className+=" "),this.className+=t),this},i.removeClass=i.removeClass||function(t){return this.hasClass(t)&&(this.className=this.className.replace(t,"")),this},i.remove=i.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},i.appendTo=i.appendTo||function(t){return t.appendChild(this),this},i.prependTo=i.prependTo||function(t){return t.childNodes[0]?t.insertBefore(this,t.childNodes[0]):t.appendChild(this),this},i.transforms=i.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},i.position=i.position||{x:0,y:0},i.rotation=i.rotation||0,i.scale=i.scale||{x:1,y:1},i.skew=i.skew||{x:0,y:0},i.translates=function(t,e){return this.position.x=t,this.position.y=e,this.transforms(),this},i.rotate=function(t){return this.rotation=t,this.transforms(),this},i.resize=function(t,e){return this.scale.x=t,this.scale.y=e,this.transforms(),this},i.setSkew=function(t,e){return this.skew.x=t,this.skew.y=e,this.transforms(),this}),i},cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O",cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms",cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "},cc.$.rotate=cc.$.hd?function(t){return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "},cc.$.scale=function(t){return"scale("+t.x+", "+t.y+") "},cc.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"},cc.$new=function(t){return cc.$(document.createElement(t))},cc.$.findpos=function(t){var e=0,i=0;do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:i}}},{}],100:[function(t,e,i){var r=cc.Class({name:"cc.PrefabInfo",properties:{root:{"default":null},asset:{"default":null},fileId:{"default":""}}});cc._PrefabInfo=e.exports=r},{}],101:[function(t,e,i){function r(t,e,i,r){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var n="_N$"+e;t.get=function(){return this[n]},t.set=function(t){var e=this[n];this[n]=t,i.call(this,e)};var s={};r[n]=s;for(var o in a){var c=a[o];t.hasOwnProperty(o)&&(s[o]=t[o],c.canUsedInGet||delete t[o])}}}function n(t,e,i,r){Array.isArray(r)&&r.length>0&&(r=r[0]),t.type=r}function s(t,e,i,r){if(Array.isArray(e)){if(!(e.length>0))return cc.error("Invalid type of %s.%s",i,r);t.type=e=e[0]}}function o(t,e,i,r){}var a={url:{canUsedInGet:!0},"default":{},serializable:{},editorOnly:{},rawType:{}};e.exports=function(t,e,i){for(var a in t){var c=t[a],h=c&&c.constructor===Object;if(!h){if(Array.isArray(c)&&c.length>0)c={"default":[],type:c};else if("function"==typeof c){var l=c;c=cc.RawAsset.isRawAssetType(l)?{"default":"",url:l}:cc.isChildClassOf(l,cc.ValueType)?{"default":new l}:{"default":null,type:c}}else c={"default":c};t[a]=c}if(c){var u=c.notify;u&&r(c,a,u,t),"type"in c&&s(c,c.type,e,a),"url"in c&&n(c,e,a,c.url),"type"in c&&o(c,c.type,e,a)}}}},{"./CCClass":81}],102:[function(t,e,i){var r=[];cc._RFpush=function(t,e,i){2===arguments.length&&(i=e,e=""),r.push({uuid:e,script:i,module:t,exports:t.exports,beh:null})},cc._RFpop=function(){var t=r.pop(),e=t.module,i=e.exports;if(i===t.exports){for(var n in i)return;e.exports=i=t.beh}},cc._RFpeek=function(){return r[r.length-1]}},{}],103:[function(t,e,i){var r={};cc.url={_rawAssets:"",_builtinRawAssets:"",normalize:function(t){return 46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1)),t},raw:function(t){return t=this.normalize(t),t.startsWith("resources/")||cc.error('Sorry can not load "%s" because it is not placed in the "resources" folder.',t),this._rawAssets+t},builtinRaw:!1,_init:function(t){for(var e in t){var i=t[e];i=cc.path._setEndWithSep(i,"/"),r[e]=i}this._rawAssets=r.assets,this._builtinRawAssets=r.internal}},e.exports=cc.url},{}],104:[function(t,e,i){e.exports={isDomNode:"object"==typeof window&&function(t){return"object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName},callInNextTick:function(t,e,i){t&&setTimeout(function(){t(e,i)},0)}}},{}],105:[function(t,e,i){function r(){var t=c.pop();return t||(t=new o),t}function n(t){c.push(t)}function s(t,e){var i=t._minX<e._minX?t._minX:e._minX,r=t._minY<e._minY?t._minY:e._minY,n=t._maxX>e._maxX?t._maxX:e._maxX,s=t._maxY>e._maxY?t._maxY:e._maxY;return(n-i)*(s-r)}var o=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},a=o.prototype,c=[];a.setTo=function(t,e,i,r){return this._minX=t,this._minY=e,this._maxX=i,this._maxY=r,this.updateArea(),this},a.intValues=function(){this._minX=Math.floor(this._minX),this._minY=Math.floor(this._minY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this.updateArea()},a.updateArea=function(){this._width=this._maxX-this._minX,this._height=this._maxY-this._minY,this._area=this._width*this._height},a.union=function(t){return this.isEmpty()?void this.setTo(t._minX,t._minY,t._maxX,t._maxY):(this._minX>t._minX&&(this._minX=t._minX),this._minY>t._minY&&(this._minY=t._minY),this._maxX<t._maxX&&(this._maxX=t._maxX),this._maxY<t._maxY&&(this._maxY=t._maxY),void this.updateArea())},a.setEmpty=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},a.isEmpty=function(){return this._width<=0||this._height<=0},a.intersects=function(t){if(this.isEmpty()||t.isEmpty())return!1;var e=this._minX>t._minX?this._minX:t._minX,i=this._maxX<t._maxX?this._maxX:t._maxX;return!(e>i)&&(e=this._minY>t._minY?this._minY:t._minY,i=this._maxY<t._maxY?this._maxY:t._maxY,e<=i)},a.updateRegion=function(t,e){if(0===t.width||0===t.height)return void this.setEmpty();var i,r,n,s,o=e,a=o.a,c=o.b,h=o.c,l=o.d,u=o.tx,d=o.ty,_=t.x,f=t.y,p=_+t.width,g=f+t.height;if(1===a&&0===c&&0===h&&1===l)i=_+u-1,r=f+d-1,n=p+u+1,s=g+d+1;else{var m=a*_+h*f+u,v=c*_+l*f+d,y=a*p+h*f+u,C=c*p+l*f+d,T=a*p+h*g+u,E=c*p+l*g+d,x=a*_+h*g+u,b=c*_+l*g+d,S=0;m>y&&(S=m,m=y,y=S),T>x&&(S=T,T=x,x=S),i=(m<T?m:T)-1,n=(y>x?y:x)+1,v>C&&(S=v,v=C,C=S),E>b&&(S=E,E=b,b=S),r=(v<E?v:E)-1,s=(C>b?C:b)+1}this._minX=i,this._minY=r,this._maxX=n,this._maxY=s,this._width=n-i,this._height=s-r,this._area=this._width*this._height};var h=function(){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1},l=h.prototype;l.setClipRect=function(t,e){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(e),this.clipArea=this.clipWidth*this.clipHeight},l.addRegion=function(t){var e=t._minX,i=t._minY,n=t._maxX,s=t._maxY;if(this.hasClipRect&&(e<0&&(e=0),i<0&&(i=0),n>this.clipWidth&&(n=this.clipWidth),s>this.clipHeight&&(s=this.clipHeight)),e>=n||i>=s)return!1;if(this.clipRectChanged)return!0;var o=this.dirtyList,a=r();return o.push(a.setTo(e,i,n,s)),this.mergeDirtyList(o),!0},l.clear=function(){for(var t=this.dirtyList,e=t.length,i=0;i<e;i++)n(t[i]);t.length=0},l.getDirtyRegions=function(){var t=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var e=r();t.push(e.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(t););var i=this.dirtyList.length;if(i>0)for(var n=0;n<i;n++)this.dirtyList[n].intValues();return this.dirtyList},l.mergeDirtyList=function(t){var e=t.length;if(e<2)return!1;for(var i=this.hasClipRect,r=e>3?Number.POSITIVE_INFINITY:0,o=0,a=0,c=0,h=0;h<e-1;h++){var l=t[h];i&&(c+=l.area);for(var u=h+1;u<e;u++){var d=t[u],_=s(l,d)-l.area-d.area;r>_&&(o=h,a=u,r=_)}}if(i&&c/this.clipArea>.95&&(this.clipRectChanged=!0),o!==a){var f=t[a];return t[o].union(f),n(f),t.splice(a,1),!0}return!1},cc.Region=o,cc.DirtyRegion=h},{}],106:[function(t,e,i){cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1e-4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!0,_debugDirtyRegion:!1,_dirtyRegionCountThreshold:10,getRenderCmd:function(t){return t._createRenderCmd()},enableDirtyRegion:function(t){this._enableDirtyRegion=t},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},setDirtyRegionCountThreshold:function(t){this._dirtyRegionCountThreshold=t},_collectDirtyRegion:function(){var t,e,i=this._renderCmds,r=this._dirtyRegion,n=_ccsg.Node.CanvasRenderCmd.RegionStatus,s=0,o=!0;for(t=0,e=i.length;t<e;t++){var a=i[t],c=a._regionFlag,h=a._oldRegion,l=a._currentRegion;c>n.NotDirty&&(++s,s>this._dirtyRegionCountThreshold&&(o=!1),o&&(!l.isEmpty()&&r.addRegion(l),a._regionFlag>n.Dirty&&!h.isEmpty()&&r.addRegion(h)),a._regionFlag=n.NotDirty)}return o},_beginDrawDirtyRegion:function(t){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions();e.save();var r=t._scaleX,n=t._scaleY;t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},r,n),e.beginPath();for(var s=0,o=i.length;s<o;++s){var a=i[s];e.rect(a._minX,-a._maxY,a._width,a._height)}e.clip()},_endDrawDirtyRegion:function(t){t.restore()},_debugDrawDirtyRegion:function(t){if(this._debugDirtyRegion){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions(),r=t._scaleX,n=t._scaleY;t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},r,n),e.beginPath();for(var s=0,o=i.length;s<o;++s){var a=i[s];e.rect(a._minX,-a._maxY,a._width,a._height)}var c=e.fillStyle;e.fillStyle="green",e.fill(),e.fillStyle=c}},rendering:function(t){var e=this._dirtyRegion=this._dirtyRegion||new cc.DirtyRegion,i=cc._canvas,r=t||cc._renderContext,n=r.getContext(),s=cc.view.getScaleX(),o=cc.view.getScaleY();r.setViewScale(s,o),r.computeRealOffsetY();var a,c,h=this._dirtyRegion.getDirtyRegions(),l=this._renderCmds,u=this._allNeedDraw||!this._enableDirtyRegion;for(u||(u=u||!this._collectDirtyRegion()),u||this._beginDrawDirtyRegion(r),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,i.width,i.height),0===this._clearColor.r&&0===this._clearColor.g&&0===this._clearColor.b||(r.setFillStyle(this._clearFillStyle),r.setGlobalAlpha(this._clearColor.a),n.fillRect(0,0,i.width,i.height)),a=0,c=l.length;a<c;a++){var d=l[a];if(d._needDraw){var _=!1,f=d._currentRegion;if(!f||u)_=!0;else for(var p=0,g=h.length;p<g;++p)if(h[p].intersects(f)){_=!0;break}_&&d.rendering(r,s,o)}}u||(this._debugDrawDirtyRegion(r),this._endDrawDirtyRegion(n)),e.clear(),this._allNeedDraw=!1},_renderingToCacheCanvas:function(t,e,i,r){t||cc.log("The context of RenderTexture is invalid."),i=void 0===i?1:i,r=void 0===r?1:r,e=e||this._currentID;var n,s,o=this._cacheToCanvasCmds[e];for(t.computeRealOffsetY(),n=0,s=o.length;n<s;n++)o[n].rendering(t,i,r);this._removeCache(e);var a=this._cacheInstanceIds;0===a.length?this._isCacheToCanvasOn=!1:this._currentID=a[a.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],this._cacheInstanceIds.indexOf(t)===-1&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToCanvasCmds[t];e&&(e.length=0,delete this._cacheToCanvasCmds[t]);var i=this._cacheInstanceIds;cc.js.array.remove(i,t)},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;e<i;e++)t[e].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1,this._allNeedDraw=!0},pushRenderCommand:function(t){if(t.rendering)if(this._isCacheToCanvasOn){var e=this._currentID,i=this._cacheToCanvasCmds,r=i[e];r.indexOf(t)===-1&&r.push(t)}else this._renderCmds.indexOf(t)===-1&&this._renderCmds.push(t)}},function(){cc.CanvasContextWrapper=function(t){this._context=t,this._saveCount=0,this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var t=cc.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(t,e){this._offsetX=t,this._offsetY=e,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(t,e){this._scaleX=t,this._scaleY=e},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._saveCount--;
},t.setGlobalAlpha=function(t){this._saveCount>0?this._context.globalAlpha=t:this._currentAlpha!==t&&(this._currentAlpha=t,this._context.globalAlpha=t)},t.setCompositeOperation=function(t){this._saveCount>0?this._context.globalCompositeOperation=t:this._currentCompositeOperation!==t&&(this._currentCompositeOperation=t,this._context.globalCompositeOperation=t)},t.setFillStyle=function(t){this._context.fillStyle=t},t.setStrokeStyle=function(t){this._saveCount>0?this._context.strokeStyle=t:this._currentStrokeStyle!==t&&(this._currentStrokeStyle=t,this._context.strokeStyle=t)},t.setTransform=function(t,e,i){this._armatureMode>0?(this.restore(),this.save(),this._context.transform(t.a,-t.b,-t.c,t.d,t.tx*e,-(t.ty*i))):this._context.setTransform(t.a*e,-t.b*i,-t.c*e,t.d*i,this._offsetX+t.tx*e,this._realOffsetY-t.ty*i)},t._switchToArmatureMode=function(t,e,i,r){t?(this._armatureMode++,this._context.setTransform(e.a,e.c,e.b,e.d,this._offsetX+e.tx*i,this._realOffsetY-e.ty*r),this.save()):(this._armatureMode--,this.restore())}}()},{}],107:[function(t,e,i){function r(t){var e=cc._renderContext;if(a){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),m=new Uint16Array(6*t);for(var i=0,r=0,n=6*t;r<n;r+=6)m[r]=i+0,m[r+1]=i+1,m[r+2]=i+2,m[r+3]=i+1,m[r+4]=i+2,m[r+5]=i+3,i+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,m,e.DYNAMIC_DRAW)}if(c){f=4*t*d;var s=4*f;_=new ArrayBuffer(s),p=new Float32Array(_),g=new Uint32Array(_),e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,p,e.DYNAMIC_DRAW)}h=4*t}function n(t){var e=cc._renderContext;null===a&&(c=e.createBuffer(),a=e.createBuffer()),r(t)}var s=2e3,o={texture:null,blendSrc:null,blendDst:null,shader:null},a=null,c=null,h=0,l=0,u=0,d=6,_=null,f=0,p=null,g=null,m=null,v=0,y=!0,C=!1,T=cc.Enum({QUAD:0,TRIANGLE:1});cc.rendererWebGL={mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,VertexType:T,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),init:function(){var t=cc._renderContext;t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),n(s),cc.sys.os===cc.sys.OS_IOS&&(C=!0)},getVertexSize:function(){return h},getRenderCmd:function(t){return t._createRenderCmd()},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,t=t||0,this._cacheToBufferCmds[t]?this._cacheToBufferCmds[t].length=0:this._cacheToBufferCmds[t]=[],this._cacheInstanceIds.indexOf(t)===-1&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t];e&&(e.length=0,delete this._cacheToBufferCmds[t]);var i=this._cacheInstanceIds;cc.arrayRemoveObject(i,t)},_renderingToBuffer:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t],i=cc._renderContext;this.rendering(i,e),this._removeCache(t);var r=this._cacheInstanceIds;0===r.length?this._isCacheToBufferOn=!1:this._currentID=r[r.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);var e,i,r;for(e=0,i=t.length;e<i;e++)r=t[e],r.updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=cc._renderContext;t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var e=cc._renderContext;t?(e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},pushRenderCommand:function(t){if(t.rendering||t.uploadData)if(this._isCacheToBufferOn){var e=this._currentID,i=this._cacheToBufferCmds,r=i[e];r.indexOf(t)===-1&&r.push(t)}else this._renderCmds.indexOf(t)===-1&&this._renderCmds.push(t)},_increaseBatchingSize:function(t,e){e=e||T.QUAD;var i,r;switch(e){case T.QUAD:for(i=0;i<t;i+=4)r=l+i,m[u++]=r+0,m[u++]=r+1,m[u++]=r+2,m[u++]=r+1,m[u++]=r+2,m[u++]=r+3;break;case T.TRIANGLE:for(y=!1,i=0;i<t;i+=3)r=l+i,m[u++]=r+0,m[u++]=r+1,m[u++]=r+2;break;default:return}l+=t},_uploadBufferData:function(t){l>=h&&this._batchRendering();var e=t._node,i=t._texture||e._texture||e._spriteFrame._texture,r=t._node._blendFunc.src,n=t._node._blendFunc.dst,s=t._shaderProgram;o.texture===i&&o.blendSrc===r&&o.blendDst===n&&o.shader===s||(this._batchRendering(),o.texture=i,o.blendSrc=r,o.blendDst=n,o.shader=s);var a=t.uploadData(p,g,l*d);if(a>0){var c,_,f=t.vertexType||T.QUAD;switch(f){case T.QUAD:for(c=0;c<a;c+=4)_=l+c,m[u++]=_+0,m[u++]=_+1,m[u++]=_+2,m[u++]=_+1,m[u++]=_+2,m[u++]=_+3;break;case T.TRIANGLE:for(y=!1,c=0;c<a;c+=3)_=l+c,m[u++]=_+0,m[u++]=_+1,m[u++]=_+2;break;default:return}l+=a}},_batchRendering:function(){if(0!==l&&o.texture){var t=cc._renderContext,e=o.texture,i=o.shader,r=l>.5*h;i&&(i.use(),i._updateProjectionUniform()),cc.gl.blendFunc(o.blendSrc,o.blendDst),cc.gl.bindTexture2DN(0,e);var n=!t.bindBuffer(t.ARRAY_BUFFER,c);if(r)t.bufferData(t.ARRAY_BUFFER,p,t.DYNAMIC_DRAW);else{var s=p.subarray(0,l*d);t.bufferData(t.ARRAY_BUFFER,s,t.DYNAMIC_DRAW)}n&&(t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16)),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),(!v||!y||u>v)&&(r?t.bufferData(t.ELEMENT_ARRAY_BUFFER,m,t.DYNAMIC_DRAW):t.bufferData(t.ELEMENT_ARRAY_BUFFER,m.subarray(0,u),t.DYNAMIC_DRAW)),t.drawElements(t.TRIANGLES,u,t.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,y?v=u:(v=0,y=!0),l=0,u=0}},rendering:function(t,e){var i,r,n,s=e||this._renderCmds,a=t||cc._renderContext;for(a.bindBuffer(a.ARRAY_BUFFER,null),i=0,r=s.length;i<r;++i)n=s[i],n._needDraw&&(n.uploadData?this._uploadBufferData(n):(l>0&&this._batchRendering(),n.rendering(a)));this._batchRendering(),o.texture=null}}},{}],108:[function(t,e,i){t("./RendererCanvas"),t("./RendererWebGL"),t("./DirtyRegion")},{"./DirtyRegion":105,"./RendererCanvas":106,"./RendererWebGL":107}],109:[function(t,e,i){var r=t("../event/event-target");cc.SpriteFrame=cc.Class({name:"cc.SpriteFrame","extends":t("../assets/CCAsset"),mixins:[r],properties:{_textureFilenameSetter:{set:function(t){this._textureFilename=t,t&&this._loadTexture()}}},ctor:function(){var t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],n=arguments[4];this._rect=null,this._offset=null,this._originalSize=null,this._rotated=!1,this.insetTop=0,this.insetBottom=0,this.insetLeft=0,this.insetRight=0,this._texture=null,this._textureFilename="",this._textureLoaded=!1,void 0!==t&&this.initWithTexture(t,e,i,r,n)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize?(this._originalSize.width=t.width,this._originalSize.height=t.height):this._originalSize=cc.size(t)},getTexture:function(){return this._texture},_refreshTexture:function(t){function e(){i._textureLoaded=!0;var e=t.width,r=t.height;if(i._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var n=t.getHtmlElementObj();n=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(n,i.getRect());var s=new cc.Texture2D;s.initWithElement(n),s.handleLoadedTexture(),i._texture=s,i._rotated=!1,e=i._texture.width,r=i._texture.height,i.setRect(cc.rect(0,0,e,r))}i._rect?i._checkRect(i._texture):i.setRect(cc.rect(0,0,e,r)),i._originalSize||i.setOriginalSize(cc.size(e,r)),i._offset||i.setOffset(cc.v2(0,0)),i.emit("load")}var i=this;if(i._texture!==t){var r=t.isLoaded();this._textureLoaded=r,this._texture=t,r?e():t.once("load",e)}},getOffset:function(){return cc.v2(this._offset)},setOffset:function(t){this._offset=cc.v2(t)},clone:function(){return new cc.SpriteFrame(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},setTexture:function(t,e,i,r,n){e?this.setRect(e):this._rect=null,r?this.setOffset(r):this._offset=null,n?this.setOriginalSize(n):this._originalSize=null,this._rotated=i||!1;var s=t;return cc.js.isString(s)?(this._textureFilename=s,this._loadTexture()):s instanceof cc.Texture2D&&this._refreshTexture(s),!0},_loadTexture:function(){if(this._textureFilename){var t=cc.textureCache.addImage(this._textureFilename);this._refreshTexture(t)}},ensureLoadTexture:function(){this._texture||this._loadTexture()},_checkRect:function(t){var e=this._rect,i=e.x,r=e.y;this._rotated?(i+=e.height,r+=e.width):(i+=e.width,r+=e.height),i>t.getPixelWidth()&&cc.error(cc._LogInfos.RectWidth,t.url+"/"+this.name),r>t.getPixelHeight()&&cc.error(cc._LogInfos.RectHeight,t.url+"/"+this.name)},_serialize:!1,_deserialize:function(t,e){var i=t.rect;i&&this.setRect(new cc.Rect(i[0],i[1],i[2],i[3])),t.offset&&this.setOffset(new cc.Vec2(t.offset[0],t.offset[1])),t.originalSize&&this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1])),this._rotated=1===t.rotated,this._name=t.name;var r=t.capInsets;r&&(this.insetLeft=r[0],this.insetTop=r[1],this.insetRight=r[2],this.insetBottom=r[3]);var n=t.texture;if(n){var s=e.customEnv&&e.customEnv.deferredLoadRaw,o=s?"_textureFilename":"_textureFilenameSetter";e.result.push(this,o,n)}}});var n=cc.SpriteFrame.prototype;n.copyWithZone=n.clone,n.copy=n.clone,n.initWithTexture=n.setTexture},{"../assets/CCAsset":31,"../event/event-target":63}],110:[function(t,e,i){t("./CCSpriteFrame"),cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(t){var e=this._CCNS_REG2.exec(t);return e?cc.rect(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])):cc.rect(0,0,0,0)},_pointFromString:function(t){var e=this._CCNS_REG1.exec(t);return e?cc.p(parseFloat(e[1]),parseFloat(e[2])):cc.p(0,0)},_sizeFromString:function(t){var e=this._CCNS_REG1.exec(t);return e?cc.size(parseFloat(e[1]),parseFloat(e[2])):cc.size(0,0)},_getFrameConfig:function(t){var e=cc.loader.getRes(t);return cc.assert(e,cc._LogInfos.spriteFrameCache._getFrameConfig_2,t),cc.loader.release(t),e._inited?(this._frameConfigCache[t]=e,e):(this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t])},_getFrameConfigByJsonObject:function(t,e){return cc.assert(e,cc._LogInfos.spriteFrameCache._getFrameConfig_2,t),this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t]},_parseFrameConfig:function(t){var e=t.frames,i=t.metadata||t.meta,r={},n={},s=0;if(i){var o=i.format;s=o.length<=1?parseInt(o):o,n.image=i.textureFileName||i.textureFileName||i.image}for(var a in e){var c=e[a];if(c){var h={};if(0==s){h.rect=cc.rect(c.x,c.y,c.width,c.height),h.rotated=!1,h.offset=cc.p(c.offsetX,c.offsetY);var l=c.originalWidth,u=c.originalHeight;l&&u||cc.log(cc._LogInfos.spriteFrameCache._getFrameConfig),l=Math.abs(l),u=Math.abs(u),h.size=cc.size(l,u)}else if(1==s||2==s)h.rect=this._rectFromString(c.frame),h.rotated=c.rotated||!1,h.offset=this._pointFromString(c.offset),h.size=this._sizeFromString(c.sourceSize);else if(3==s){var d=this._sizeFromString(c.spriteSize),_=this._rectFromString(c.textureRect);d&&(_=cc.rect(_.x,_.y,d.width,d.height)),h.rect=_,h.rotated=c.textureRotated||!1,h.offset=this._pointFromString(c.spriteOffset),h.size=this._sizeFromString(c.spriteSourceSize),h.aliases=c.aliases}else{var f=c.frame,p=c.sourceSize;a=c.filename||a,h.rect=cc.rect(f.x,f.y,f.w,f.h),h.rotated=c.rotated||!1,h.offset=cc.p(0,0),h.size=cc.size(p.w,p.h)}r[a]=h}}return{_inited:!0,frames:r,meta:n}},_addSpriteFramesByObject:function(t,e,i){if(cc.assert(t,cc._LogInfos.spriteFrameCache.addSpriteFrames_2),e&&e.frames){var r=this._frameConfigCache[t]||this._getFrameConfigByJsonObject(t,e);this._createSpriteFrames(t,r,i)}},_createSpriteFrames:function(t,e,i){var r=e.frames,n=e.meta;if(i)i instanceof cc.Texture2D||(cc.js.isString(i)?i=cc.textureCache.addImage(i):cc.assert(0,cc._LogInfos.spriteFrameCache.addSpriteFrames_3));else{var s=cc.path.changeBasename(t,n.image||".png");i=cc.textureCache.addImage(s)}var o=this._spriteFramesAliases,a=this._spriteFrames;for(var c in r){var h=r[c],l=a[c];if(!l){l=new cc.SpriteFrame(i,h.rect,h.rotated,h.offset,h.size);var u=h.aliases;if(u)for(var d=0,_=u.length;d<_;d++){var f=u[d];o[f]&&cc.log(cc._LogInfos.spriteFrameCache.addSpriteFrames,f),o[f]=c}if(cc._renderType===cc.game.RENDER_TYPE_CANVAS&&l.isRotated()){var p=l.getTexture();if(p.isLoaded()){var g=l.getTexture().getHtmlElementObj();g=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(g,l.getRect());var m=new cc.Texture2D;m.initWithElement(g),m.handleLoadedTexture(),l.setTexture(m);var v=l._rect;l.setRect(cc.rect(0,0,v.width,v.height))}}a[c]=l}}},addSpriteFrames:function(t,e){cc.assert(t,cc._LogInfos.spriteFrameCache.addSpriteFrames_2);var i=this._frameConfigCache[t]||cc.loader.getRes(t);if(i&&i.frames){var r=this._frameConfigCache[t]||this._getFrameConfig(t);this._createSpriteFrames(t,r,e)}},_checkConflict:function(t){var e=t.frames;for(var i in e)this._spriteFrames[i]&&cc.log(cc._LogInfos.spriteFrameCache._checkConflict,i)},addSpriteFrame:function(t,e){this._spriteFrames[e]=t},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={}},removeSpriteFrameByName:function(t){t&&(this._spriteFramesAliases[t]&&delete this._spriteFramesAliases[t],this._spriteFrames[t]&&delete this._spriteFrames[t])},removeSpriteFramesFromFile:function(t){var e=this,i=e._spriteFrames,r=e._spriteFramesAliases,n=e._frameConfigCache[t];if(n){var s=n.frames;for(var o in s)if(i[o]){delete i[o];for(var a in r)r[a]===o&&delete r[a]}}},removeSpriteFramesFromTexture:function(t){var e=this,i=e._spriteFrames,r=e._spriteFramesAliases;for(var n in i){var s=i[n];if(s&&s.getTexture()===t){delete i[n];for(var o in r)r[o]===n&&delete r[o]}}},getSpriteFrame:function(t){var e=this,i=e._spriteFrames[t];if(!i){var r=e._spriteFramesAliases[t];r&&(i=e._spriteFrames[r.toString()],i||delete e._spriteFramesAliases[t])}return i},_clear:function(){this._spriteFrames={},this._spriteFramesAliases={},this._frameConfigCache={}}}},{"./CCSpriteFrame":109}],111:[function(t,e,i){var r=t("../event/event-target"),n=t("../platform/CCSys"),s=t("../platform/js"),o=t("../utils/misc"),a=t("../CCGame");t("../platform/_CCClass"),t("../platform/CCClass");var c=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),h=cc.Class({name:"cc.Texture2D","extends":t("../assets/CCRawAsset"),mixins:[r],statics:{WrapMode:c},ctor:function(){this.url=null,this._textureLoaded=!1,this._htmlElementObj=null,this._contentSize=cc.size(0,0),this._pixelWidth=0,this._pixelHeight=0,cc._renderType===a.RENDER_TYPE_CANVAS?(this._pattern="",this._grayElementObj=null,this._backupElement=null,this._isGray=!1):cc._renderType===a.RENDER_TYPE_WEBGL&&(this._hasPremultipliedAlpha=!1,this._pixelFormat=h.defaultPixelFormat,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this._webTextureObj=null)},getPixelWidth:function(){return this._pixelWidth},getPixelHeight:function(){return this._pixelHeight},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},_getWidth:function(){return this._contentSize.width},_getHeight:function(){return this._contentSize.height},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(t){t&&(this._htmlElementObj=t,this._pixelWidth=this._contentSize.width=t.width,this._pixelHeight=this._contentSize.height=t.height,this._textureLoaded=!0)},initWithData:function(t,e,i,r,n){return!1},initWithImage:function(t){return!1},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){var t=this;if(!t._htmlElementObj){var e=cc.loader.getRes(t.url);if(!e)return;t.initWithElement(e)}if(t._htmlElementObj.width&&t._htmlElementObj.height){var i=t._htmlElementObj;t._pixelWidth=t._contentSize.width=i.width,t._pixelHeight=t._contentSize.height=i.height,t._textureLoaded=!0,t.emit("load")}},description:function(){return"<cc.Texture2D | Name = "+this.getName()+" | Dimensions = "+this.getPixelWidth()+" x "+this.getPixelHeight()+">"},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj),cc.loader.release(this._uuid||this.url)},getName:function(){return this._webTextureObj||null},getPixelFormat:function(){return this._pixelFormat||null},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha||!1},hasMipmaps:function(){return this._hasMipmaps||!1},setTexParameters:function(t,e,i,r){return void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:r}),t.wrapS===c.REPEAT&&t.wrapT===c.REPEAT?void(this._pattern="repeat"):t.wrapS===c.REPEAT?void(this._pattern="repeat-x"):t.wrapT===c.REPEAT?void(this._pattern="repeat-y"):void(this._pattern="")},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(t){return-1}});h.WrapMode=c;var l=h;l.PIXEL_FORMAT_RGBA8888=2,l.PIXEL_FORMAT_RGB888=3,l.PIXEL_FORMAT_RGB565=4,l.PIXEL_FORMAT_A8=5,l.PIXEL_FORMAT_I8=6,l.PIXEL_FORMAT_AI88=7,l.PIXEL_FORMAT_RGBA4444=8,l.PIXEL_FORMAT_RGB5A1=7,l.PIXEL_FORMAT_PVRTC4=9,l.PIXEL_FORMAT_PVRTC2=10,l.PIXEL_FORMAT_DEFAULT=l.PIXEL_FORMAT_RGBA8888,l.defaultPixelFormat=l.PIXEL_FORMAT_DEFAULT;var u=h._M={};u[l.PIXEL_FORMAT_RGBA8888]="RGBA8888",u[l.PIXEL_FORMAT_RGB888]="RGB888",u[l.PIXEL_FORMAT_RGB565]="RGB565",u[l.PIXEL_FORMAT_A8]="A8",u[l.PIXEL_FORMAT_I8]="I8",u[l.PIXEL_FORMAT_AI88]="AI88",u[l.PIXEL_FORMAT_RGBA4444]="RGBA4444",u[l.PIXEL_FORMAT_RGB5A1]="RGB5A1",u[l.PIXEL_FORMAT_PVRTC4]="PVRTC4",u[l.PIXEL_FORMAT_PVRTC2]="PVRTC2";var d=h._B={};d[l.PIXEL_FORMAT_RGBA8888]=32,d[l.PIXEL_FORMAT_RGB888]=24,d[l.PIXEL_FORMAT_RGB565]=16,d[l.PIXEL_FORMAT_A8]=8,d[l.PIXEL_FORMAT_I8]=8,d[l.PIXEL_FORMAT_AI88]=16,d[l.PIXEL_FORMAT_RGBA4444]=16,d[l.PIXEL_FORMAT_RGB5A1]=16,d[l.PIXEL_FORMAT_PVRTC4]=4,d[l.PIXEL_FORMAT_PVRTC2]=3;var _=h.prototype;_.name,cc.defineGetterSetter(_,"name",_.getName),_.pixelFormat,cc.defineGetterSetter(_,"pixelFormat",_.getPixelFormat),_.pixelWidth,cc.defineGetterSetter(_,"pixelWidth",_.getPixelWidth),_.pixelHeight,cc.defineGetterSetter(_,"pixelHeight",_.getPixelHeight),_.width,cc.defineGetterSetter(_,"width",_._getWidth),_.height,cc.defineGetterSetter(_,"height",_._getHeight),a.once(a.EVENT_RENDERER_INITED,function(){if(cc._renderType===a.RENDER_TYPE_CANVAS){var t=function(t,e){var i=t.width,r=t.height;e[0].width=i,e[0].height=r,e[1].width=i,e[1].height=r,e[2].width=i,e[2].height=r,e[3].width=i,e[3].height=r;var n=e[3].getContext("2d");n.drawImage(t,0,0);for(var s,o=n.getImageData(0,0,i,r).data,a=0;a<4;a++){s=e[a].getContext("2d");for(var c=s.getImageData(0,0,i,r),h=c.data,l=0;l<o.length;l+=4)h[l]=0===a?o[l]:0,h[l+1]=1===a?o[l+1]:0,h[l+2]=2===a?o[l+2]:0,h[l+3]=o[l+3];s.putImageData(c,0,0)}t.onload=null},e=function(t,e,i){if(null===t)return null;i=i||document.createElement("canvas"),e=e||cc.rect(0,0,t.width,t.height),i.width=e.width,i.height=e.height;var r=i.getContext("2d");r.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);for(var n=r.getImageData(0,0,e.width,e.height),s=n.data,o=0,a=s.length;o<a;o+=4)s[o]=s[o+1]=s[o+2]=.34*s[o]+.5*s[o+1]+.16*s[o+2];return r.putImageData(n,0,0),i};s.mixin(h.prototype,{_generateTextureCacheForColor:function(){if(this.channelCache)return this.channelCache;var e=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return t(this._htmlElementObj,e),this.channelCache=e},_switchToGray:function(t){this._textureLoaded&&this._isGray!==t&&(this._isGray=t,this._isGray?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=e(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=this._backupElement))},_generateGrayTexture:function(){if(!this._textureLoaded)return null;var t=e(this._htmlElementObj),i=new h;return i.initWithElement(t),i.handleLoadedTexture(),i},_generateColorTexture:n._supportCanvasNewBlendModes?function(t,e,i,r,n){var s=!1;n?s=!0:n=document.createElement("canvas");var o=this._htmlElementObj;if(r||(r=cc.rect(0,0,o.width,o.height)),n.width=r.width,n.height=r.height,r.width&&r.height){var a=n.getContext("2d");a.globalCompositeOperation="source-over",a.fillStyle="rgb("+(0|t)+","+(0|e)+","+(0|i)+")",a.fillRect(0,0,r.width,r.height),a.globalCompositeOperation="multiply",a.drawImage(o,r.x,r.y,r.width,r.height,0,0,r.width,r.height),a.globalCompositeOperation="destination-atop",a.drawImage(o,r.x,r.y,r.width,r.height,0,0,r.width,r.height)}if(s)return n;var c=new h;return c.initWithElement(n),c.handleLoadedTexture(),c}:function(t,e,i,r,n){var s=!1;n?s=!0:n=document.createElement("canvas");var o=this._htmlElementObj;if(r||(r=cc.rect(0,0,o.width,o.height)),n.width=r.width,n.height=r.height,r.width&&r.height){var a=n.getContext("2d");a.drawImage(o,r.x,r.y,r.width,r.height,0,0,r.width,r.height);var c=a.getImageData(0,0,n.width,n.height),l=c.data;t/=255,e/=255,i/=255;for(var u=0;u<l.length;u+=4)l[u]=l[u]*t,l[u+1]=l[u+1]*e,l[u+2]=l[u+2]*i;a.putImageData(c,0,0)}if(s)return n;var d=new h;return d.initWithElement(n),d.handleLoadedTexture(),d}})}else cc._renderType===a.RENDER_TYPE_WEBGL&&s.mixin(h.prototype,{initWithData:function(t,e,i,r,n){var s=this,o=h,a=cc._renderContext,c=a.RGBA,l=a.UNSIGNED_BYTE,u=h._B[e],d=i*u/8;switch(d%8===0?a.pixelStorei(a.UNPACK_ALIGNMENT,8):d%4===0?a.pixelStorei(a.UNPACK_ALIGNMENT,4):d%2===0?a.pixelStorei(a.UNPACK_ALIGNMENT,2):a.pixelStorei(a.UNPACK_ALIGNMENT,1),s._webTextureObj=a.createTexture(),cc.gl.bindTexture2D(s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),e){case o.PIXEL_FORMAT_RGBA8888:c=a.RGBA;break;case o.PIXEL_FORMAT_RGB888:c=a.RGB;break;case o.PIXEL_FORMAT_RGBA4444:l=a.UNSIGNED_SHORT_4_4_4_4;break;case o.PIXEL_FORMAT_RGB5A1:l=a.UNSIGNED_SHORT_5_5_5_1;break;case o.PIXEL_FORMAT_RGB565:l=a.UNSIGNED_SHORT_5_6_5;break;case o.PIXEL_FORMAT_AI88:c=a.LUMINANCE_ALPHA;break;case o.PIXEL_FORMAT_A8:c=a.ALPHA;break;case o.PIXEL_FORMAT_I8:c=a.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D.initWithData)}return a.texImage2D(a.TEXTURE_2D,0,c,i,r,0,c,l,t),s._contentSize.width=n.width,s._contentSize.height=n.height,s._pixelWidth=i,s._pixelHeight=r,s._pixelFormat=e,s._hasPremultipliedAlpha=!1,s._hasMipmaps=!1,s._textureLoaded=!0,!0},initWithImage:function(t){if(null==t)return cc.log(cc._LogInfos.Texture2D.initWithImage),!1;var e=t.getWidth(),i=t.getHeight(),r=cc.configuration.getMaxTextureSize();return e>r||i>r?(cc.log(cc._LogInfos.Texture2D.initWithImage_2,e,i,r,r),!1):(this._textureLoaded=!0,this._initPremultipliedATextureWithImage(t,e,i))},initWithElement:function(t){t&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=t,this._textureLoaded=!0)},handleLoadedTexture:function(t){t=!!t;var e=this;if(a._rendererInitialized){if(!e._htmlElementObj){var i=cc.loader.getRes(e.url);if(!i)return;e.initWithElement(i)}if(e._htmlElementObj.width&&e._htmlElementObj.height){var r=cc._renderContext;cc.gl.bindTexture2D(e),r.pixelStorei(r.UNPACK_ALIGNMENT,4),t&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e._htmlElementObj),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),cc.gl.bindTexture2D(null),t&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);var n=e._htmlElementObj.width,s=e._htmlElementObj.height;e._pixelWidth=e._contentSize.width=n,e._pixelHeight=e._contentSize.height=s,e._pixelFormat=h.PIXEL_FORMAT_RGBA8888,e._hasPremultipliedAlpha=t,e._hasMipmaps=!1,e._textureLoaded=!0,e.emit("load")}}},setTexParameters:function(t,e,i,r){var n=this,s=cc._renderContext;void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:r}),cc.assert(n._pixelWidth===o.NextPOT(n._pixelWidth)&&n._pixelHeight===o.NextPOT(n._pixelHeight)||t.wrapS===s.CLAMP_TO_EDGE&&t.wrapT===s.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.gl.bindTexture2D(n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,t.minFilter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t.magFilter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,t.wrapS),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,t.wrapT)},setAntiAliasTexParameters:function(){var t=cc._renderContext;cc.gl.bindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},setAliasTexParameters:function(){var t=cc._renderContext;cc.gl.bindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},generateMipmap:function(){var t=this;cc.assert(t._pixelWidth===o.NextPOT(t._pixelWidth)&&t._pixelHeight===o.NextPOT(t._pixelHeight),"Mimpap texture only works in POT textures"),cc.gl.bindTexture2D(t),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),t._hasMipmaps=!0},stringForFormat:function(){return h._M[this._pixelFormat]},bitsPerPixelForFormat:function(t){t=t||this._pixelFormat;var e=h._B[t];return null!=e?e:(cc.log(cc._LogInfos.Texture2D.bitsPerPixelForFormat,t),-1)},_initPremultipliedATextureWithImage:function(t,e,i){var r,n=h,s=t.getData(),o=null,a=null,c=t.hasAlpha(),l=cc.size(t.getWidth(),t.getHeight()),u=n.defaultPixelFormat,d=t.getBitsPerComponent();c||(d>=8?u=n.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D._initPremultipliedATextureWithImage),u=n.PIXEL_FORMAT_RGB565));var _=e*i;if(u===n.PIXEL_FORMAT_RGB565)if(c)for(s=new Uint16Array(e*i),o=t.getData(),r=0;r<_;++r)s[r]=(o[r]>>0&255)>>3<<11|(o[r]>>8&255)>>2<<5|(o[r]>>16&255)>>3<<0;else for(s=new Uint16Array(e*i),a=t.getData(),r=0;r<_;++r)s[r]=(255&a[r])>>3<<11|(255&a[r])>>2<<5|(255&a[r])>>3<<0;else if(u===n.PIXEL_FORMAT_RGBA4444)for(s=new Uint16Array(e*i),o=t.getData(),r=0;r<_;++r)s[r]=(o[r]>>0&255)>>4<<12|(o[r]>>8&255)>>4<<8|(o[r]>>16&255)>>4<<4|(o[r]>>24&255)>>4<<0;else if(u===n.PIXEL_FORMAT_RGB5A1)for(s=new Uint16Array(e*i),o=t.getData(),r=0;r<_;++r)s[r]=(o[r]>>0&255)>>3<<11|(o[r]>>8&255)>>3<<6|(o[r]>>16&255)>>3<<1|(o[r]>>24&255)>>7<<0;else if(u===n.PIXEL_FORMAT_A8)for(s=new Uint8Array(e*i),o=t.getData(),r=0;r<_;++r)s[r]=o>>24&255;if(c&&u===n.PIXEL_FORMAT_RGB888)for(o=t.getData(),s=new Uint8Array(e*i*3),r=0;r<_;++r)s[3*r]=o>>0&255,s[3*r+1]=o>>8&255,s[3*r+2]=o>>16&255;return this.initWithData(s,u,e,i,l),s!=t.getData()&&(s=null),this._hasPremultipliedAlpha=t.isPremultipliedAlpha(),!0}})}),cc.Texture2D=e.exports=h},{"../CCGame":27,"../assets/CCRawAsset":36,"../event/event-target":63,"../platform/CCClass":81,"../platform/CCSys":88,"../platform/_CCClass":91,"../platform/js":98,"../utils/misc":120}],112:[function(t,e,i){var r=t("../platform/_CCClass"),n=t("../platform/js"),s=t("../CCGame"),o=r.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(t,e){this._buffersVBO=[],cc.js.isString(t)?this.initWithFile(t,e):t instanceof cc.Texture2D&&this.initWithTexture(t,e)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(t){this.texture=t},setDirty:function(t){this.dirty=t},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(t){this._quads=t},_copyQuadsToTextureAtlas:function(t,e){if(t)for(var i=0;i<t.length;i++)this._setQuadToArray(t[i],e+i)},_setQuadToArray:function(t,e){var i=this._quads;return i[e]?(i[e].bl=t.bl,i[e].br=t.br,i[e].tl=t.tl,void(i[e].tr=t.tr)):void(i[e]=new cc.V3F_C4B_T2F_Quad(t.tl,t.bl,t.tr,t.br,this._quadsArrayBuffer,e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT))},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(0!==this._capacity)for(var t=this._indices,e=this._capacity,i=0;i<e;i++)cc.macro.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(t[6*i+0]=4*i+0,t[6*i+1]=4*i+0,t[6*i+2]=4*i+2,t[6*i+3]=4*i+1,t[6*i+4]=4*i+3,t[6*i+5]=4*i+3):(t[6*i+0]=4*i+0,t[6*i+1]=4*i+1,t[6*i+2]=4*i+2,t[6*i+3]=4*i+3,t[6*i+4]=4*i+2,t[6*i+5]=4*i+1)},initWithFile:function(t,e){var i=cc.textureCache.addImage(t);return i?this.initWithTexture(i,e):(cc.log(cc._LogInfos.TextureAtlas.initWithFile,t),!1)},initWithTexture:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas.initWithTexture),e=0|e,this._capacity=e,this._totalQuads=0,this.texture=t,this._quads=[],this._indices=new Uint16Array(6*e);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._quadsArrayBuffer=new ArrayBuffer(i*e),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),(!this._quads||!this._indices)&&e>0)return!1;for(var r=this._quads,n=0;n<e;n++)r[n]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,n*i);return this._setupIndices(),this._setupVBO(),this.dirty=!0,!0},updateQuad:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas.updateQuad),cc.assert(e>=0&&e<this._capacity,cc._LogInfos.TextureAtlas.updateQuad_2),this._totalQuads=Math.max(e+1,this._totalQuads),this._setQuadToArray(t,e),this.dirty=!0},insertQuad:function(t,e){if(cc.assert(e<this._capacity,cc._LogInfos.TextureAtlas.insertQuad_2),this._totalQuads++,this._totalQuads>this._capacity)return void cc.log(cc._LogInfos.TextureAtlas.insertQuad);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=this._totalQuads-1-e,n=e*i,s=r*i;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*i),this._quadsReader.set(this._quadsReader.subarray(n,n+s),n+i),this._setQuadToArray(t,e),this.dirty=!0},insertQuads:function(t,e,i){i=i||t.length,cc.assert(e+i<=this._capacity,cc._LogInfos.TextureAtlas.insertQuads);var r=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads+=i,this._totalQuads>this._capacity)return void cc.log(cc._LogInfos.TextureAtlas.insertQuad);var n,s=this._totalQuads-1-e-i,o=e*r,a=s*r,c=this._totalQuads-1-i;for(n=0;n<i;n++)this._quads[c+n]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*r);for(this._quadsReader.set(this._quadsReader.subarray(o,o+a),o+r*i),n=0;n<i;n++)this._setQuadToArray(t[n],e+n);this.dirty=!0},insertQuadFromIndex:function(t,e){if(t!==e){cc.assert(e>=0||e<this._totalQuads,cc._LogInfos.TextureAtlas.insertQuadFromIndex),cc.assert(t>=0||t<this._totalQuads,cc._LogInfos.TextureAtlas.insertQuadFromIndex_2);var i,r,n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=this._quadsReader,o=s.subarray(t*n,n);t>e?(i=e*n,r=(t-e)*n,s.set(s.subarray(i,i+r),i+n),s.set(o,i)):(i=(t+1)*n,r=(e-t)*n,s.set(s.subarray(i,i+r),i-n),s.set(o,e*n)),this.dirty=!0}},removeQuadAtIndex:function(t){
cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas.removeQuadAtIndex);var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads--,this._quads.length=this._totalQuads,t!==this._totalQuads){var i=(t+1)*e,r=(this._totalQuads-t)*e;this._quadsReader.set(this._quadsReader.subarray(i,i+r),i-e)}this.dirty=!0},removeQuadsAtIndex:function(t,e){if(cc.assert(t+e<=this._totalQuads,cc._LogInfos.TextureAtlas.removeQuadsAtIndex),this._totalQuads-=e,t!==this._totalQuads){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=(t+e)*i,n=(this._totalQuads-t)*i,s=t*i;this._quadsReader.set(this._quadsReader.subarray(r,r+n),s)}this.dirty=!0},removeAllQuads:function(){this._quads.length=0,this._totalQuads=0},_setDirty:function(t){this.dirty=t},resizeCapacity:function(t){if(t===this._capacity)return!0;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=this._capacity;this._totalQuads=Math.min(this._totalQuads,t),this._capacity=0|t;var r,n=this._capacity,s=this._totalQuads;if(null===this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(e*n),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),r=0;r<n;r++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,r*e);else{var o,a,c=this._quads;if(n>i){for(o=[],a=new ArrayBuffer(e*n),r=0;r<s;r++)o[r]=new cc.V3F_C4B_T2F_Quad(c[r].tl,c[r].bl,c[r].tr,c[r].br,a,r*e);for(;r<n;r++)o[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,a,r*e);this._quadsReader=new Uint8Array(a),this._quads=o,this._quadsArrayBuffer=a}else{var h=Math.max(s,n);for(o=[],a=new ArrayBuffer(e*n),r=0;r<h;r++)o[r]=new cc.V3F_C4B_T2F_Quad(c[r].tl,c[r].bl,c[r].tr,c[r].br,a,r*e);this._quadsReader=new Uint8Array(a),this._quads=o,this._quadsArrayBuffer=a}}if(null===this._indices)this._indices=new Uint16Array(6*n);else if(n>i){var l=new Uint16Array(6*n);l.set(this._indices,0),this._indices=l}else this._indices=this._indices.subarray(0,6*n);return this._setupIndices(),this._mapBuffers(),this.dirty=!0,!0},increaseTotalQuadsWith:function(t){this._totalQuads+=t},moveQuadsFromIndex:function(t,e,i){if(void 0===i){if(i=e,e=this._totalQuads-t,cc.assert(i+(this._totalQuads-t)<=this._capacity,cc._LogInfos.TextureAtlas.moveQuadsFromIndex),0===e)return}else if(cc.assert(i+e<=this._totalQuads,cc._LogInfos.TextureAtlas.moveQuadsFromIndex_2),cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas.moveQuadsFromIndex_3),t===i)return;var r,n,s=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,o=t*s,a=e*s,c=this._quadsReader,h=c.subarray(o,o+a),l=i*s;i<t?(r=(t-i)*s,n=i*s,c.set(c.subarray(n,n+r),n+a)):(r=(i-t)*s,n=(t+e)*s,c.set(c.subarray(n,n+r),o)),c.set(h,l),this.dirty=!0},fillWithEmptyQuadsFromIndex:function(t,e){for(var i=e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=new Uint8Array(this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i),n=0;n<i;n++)r[n]=0},_setupVBO:function(){},_mapBuffers:function(){},drawQuads:function(){},drawNumberOfQuads:null,_releaseBuffer:function(){var t=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&t.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&t.deleteBuffer(this._buffersVBO[1])),this._quadsWebBuffer&&t.deleteBuffer(this._quadsWebBuffer)}}),a=o.prototype;a.totalQuads,cc.defineGetterSetter(a,"totalQuads",a.getTotalQuads),a.capacity,cc.defineGetterSetter(a,"capacity",a.getCapacity),a.quads,cc.defineGetterSetter(a,"quads",a.getQuads,a.setQuads),s.once(s.EVENT_RENDERER_INITED,function(){cc._renderType===s.RENDER_TYPE_WEBGL&&n.mixin(o.prototype,{_setupVBO:function(){var t=this,e=cc._renderContext;t._buffersVBO[0]=e.createBuffer(),t._buffersVBO[1]=e.createBuffer(),t._quadsWebBuffer=e.createBuffer(),t._mapBuffers()},_mapBuffers:function(){var t=this,e=cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,t._quadsWebBuffer),e.bufferData(e.ARRAY_BUFFER,t._quadsArrayBuffer,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._buffersVBO[1]),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t._indices,e.STATIC_DRAW)},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},drawNumberOfQuads:function(t,e){var i=this;if(e=e||0,0!==t&&i.texture&&i.texture.isLoaded()){var r=cc._renderContext;cc.gl.bindTexture2D(i.texture),r.bindBuffer(r.ARRAY_BUFFER,i._quadsWebBuffer),r.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),r.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),r.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),i.dirty&&(r.bufferData(r.ARRAY_BUFFER,i._quadsArrayBuffer,r.DYNAMIC_DRAW),i.dirty=!1),r.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,r.FLOAT,!1,24,0),r.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,r.UNSIGNED_BYTE,!0,24,12),r.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,r.FLOAT,!1,24,16),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i._buffersVBO[1]),cc.macro.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?r.drawElements(r.TRIANGLE_STRIP,6*t,r.UNSIGNED_SHORT,6*e*i._indices.BYTES_PER_ELEMENT):r.drawElements(r.TRIANGLES,6*t,r.UNSIGNED_SHORT,6*e*i._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++}}})}),cc.TextureAtlas=e.exports=o},{"../CCGame":27,"../platform/_CCClass":91,"../platform/js":98}],113:[function(t,e,i){var r=(t("../platform/js"),t("../CCGame")),n=t("./CCTexture2D"),s={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),_loadedTexturesBefore:{},handleLoadedTexture:null,_initializingRenderer:function(){var t,e=this._loadedTexturesBefore,i=this._textures;for(t in e){var r=e[t];r.handleLoadedTexture(),i[t]=r}this._loadedTexturesBefore={}},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.log(cc._LogInfos.textureCache.textureForKey),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._htmlElementObj,i=this.getKeyByTexture(e);return i||(i=e instanceof HTMLImageElement?e.src:this._generalTextureKey(t.__instanceId)),this._textureColorsCache[i]||(this._textureColorsCache[i]=t._generateTextureCacheForColor()),this._textureColorsCache[i]},removeAllTextures:function(){var t=this._textures;for(var e in t)t[e]&&t[e].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e=this._textures;for(var i in e)e[i]===t&&(e[i].releaseTexture(),delete e[i])}},removeTextureForKey:function(t){if("string"==typeof t){var e=this._textures;e[t]&&(e[t].releaseTexture(),delete e[t])}},addImage:null,addImageAsync:null,cacheImage:function(t,e){if(cc.assert(t,cc._LogInfos.textureCache.invalidKey),e instanceof n)return void(this._textures[t]=e);var i=new n;i.initWithElement(e),i.handleLoadedTexture(),this._textures[t]=i},addUIImage:function(t,e){if(cc.assert(t,cc._LogInfos.textureCache.addUIImage_2),e&&this._textures[e])return this._textures[e];var i=new n;return i.initWithImage(t),null!=e?this._textures[e]=i:cc.log(cc._LogInfos.textureCache.addUIImage),i},dumpCachedTextureInfo:function(){var t=0,e=0,i=this._textures;for(var r in i){var n=i[r];t++,n.getHtmlElementObj()instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo,r,n.getHtmlElementObj().src,n.getPixelWidth(),n.getPixelHeight()):cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_2,r,n.getPixelWidth(),n.getPixelHeight()),e+=n.getPixelWidth()*n.getPixelHeight()*4}var s=this._textureColorsCache;for(r in s){var o=s[r];for(var a in o){var c=o[a];t++,cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_2,r,c.width,c.height),e+=c.width*c.height*4}}cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_3,t,e/1024,(e/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random(),this._loadedTexturesBefore={}}};r.once(r.EVENT_RENDERER_INITED,function(){var t=s;cc._renderType===r.RENDER_TYPE_CANVAS?(t.handleLoadedTexture=function(t){var e=this._textures,i=e[t];i||(cc.assert(t,cc._LogInfos.textureCache.invalidKey),i=e[t]=new n,i.url=t),i.handleLoadedTexture()},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D.addImage);var r=this._textures,o=r[t];return o?o.isLoaded()?(e&&e.call(i,o),o):(o.once("load",function(){e&&e.call(i,o)},i),o):(o=r[t]=new n,o.url=t,cc.loader.load(t,function(r,n){return r?e&&e.call(i,r||new Error("Unknown error")):(s.handleLoadedTexture(t),void(e&&e.call(i,o)))}),o)},t.addImageAsync=t.addImage):cc._renderType===r.RENDER_TYPE_WEBGL&&(t.handleLoadedTexture=function(t){var e,i,r=this._textures;cc.game._rendererInitialized||(r=this._loadedTexturesBefore),e=r[t],e||(cc.assert(t,cc._LogInfos.textureCache.invalidKey),e=r[t]=new n,e.url=t),i=cc.macro.AUTO_PREMULTIPLIED_ALPHA_FOR_PNG&&".png"===cc.path.extname(t),e.handleLoadedTexture(i)},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D.addImage_2);var r=this._textures;cc.game._rendererInitialized||(r=this._loadedTexturesBefore);var o=r[t];return o?o.isLoaded()?(e&&e.call(i,o),o):(o.once("load",function(){e&&e.call(i,o)},i),o):(o=r[t]=new n,o.url=t,cc.loader.load(t,function(r,n){return r?e&&e.call(i,r||new Error("Unknown error")):(s.handleLoadedTexture(t),void(e&&e.call(i,o)))}),o)},t.addImageAsync=t.addImage)}),cc.textureCache=e.exports=s},{"../CCGame":27,"../platform/js":98,"./CCTexture2D":111}],114:[function(t,e,i){t("./CCTexture2D"),t("./CCTextureAtlas"),t("./CCTextureCache")},{"./CCTexture2D":111,"./CCTextureAtlas":112,"./CCTextureCache":113}],115:[function(t,e,i){t("../platform/CCSys");var r=/(\.[^\.\/\?\\]*)(\?.*)?$/,n=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,e="",i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=r.exec(t);return e?e[1]:""},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(e!==-1)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");i>0&&(t=t.substring(0,i));var r=/(\/|\\\\)([^(\/|\\\\)]+)$/g,n=r.exec(t.replace(/(\/|\\\\)$/,""));if(!n)return null;var s=n[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?s.substring(0,s.length-e.length):s},dirname:function(t){return t.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),r="";return i>0&&(r=t.substring(i),t=t.substring(0,i)),i=t.lastIndexOf("."),i<0?t+e+r:t.substring(0,i)+e+r},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var r=t.indexOf("?"),n="",s=i?this.extname(t):"";return r>0&&(n=t.substring(r),t=t.substring(0,r)),r=t.lastIndexOf("/"),r=r<=0?0:r+1,t.substring(0,r)+e+s+n},_normalize:function(t){var e=t=String(t);do e=t,t=t.replace(n,"");while(e.length!==t.length);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",_setEndWithSep:function(t,e){var i=cc.path.sep;"undefined"==typeof e?e=!0:"string"==typeof e&&(i=e,e=!!e);var r=t[t.length-1],n="\\"===r||"/"===r;return!n&&e?t+=i:n&&!e&&(t=t.slice(0,-1)),t}},e.exports=cc.path},{"../platform/CCSys":88}],116:[function(t,e,i){cc.profiler=function(){var t=!1,e=!1,i=0,r=0,n=0,s=0,o=null,a=null,c=null,h=null,l=.6,u=10,d=[0,10,20,30],_=[0,0,0,0],f=3,p=0,g=0,m=function(){o=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),h=document.createElement("div"),h.id="fps",h.style.position="absolute",h.style.padding="3px",h.style.textAlign="left",h.style.backgroundColor="rgb(0, 0, 34)",h.style.bottom=cc.macro.DIRECTOR_STATS_POSITION.y+"0px",h.style.left=cc.macro.DIRECTOR_STATS_POSITION.x+"px",h.style.width="45px",h.style.height="60px";for(var t=[c,a,o],e=0;e<3;++e){var i=t[e].style;i.color="rgb(0, 255, 255)",i.font="bold 12px Helvetica, Arial",i.lineHeight="20px",i.width="100%",h.appendChild(t[e])}},v=function(t){var e,i=d.length-1,r=i,n=0;for(p++,g+=t;r>=0;r--)if(t>=d[r]){_[r]++;break}if(p>=u){for(n=g/u,r=i;r>0;r--)if(e=_[r]/u,e>=l&&n>=d[r]){r!==f&&(f=r,C.onFrameRateChange&&C.onFrameRateChange(n.toFixed(2)));break}for(p=0,g=0,r=i;r>0;r--)_[r]=0}},y=function(){n=cc.director.getSecondsPerFrame(),i++,s+=cc.director.getDeltaTime(),s>cc.macro.DIRECTOR_FPS_INTERVAL&&(r=i/s,i=0,s=0,C.onFrameRateChange&&v(r),e&&(a.innerText=n.toFixed(3),o.innerText=r.toFixed(1),c.innerText=(0|cc.g_NumberOfDraws).toString()))},C={onFrameRateChange:null,getSecondsPerFrame:function(){return n},getFrameRate:function(){return r},setProfileDuration:function(t){!isNaN(t)&&t>0&&(u=t/cc.macro.DIRECTOR_FPS_INTERVAL)},resumeProfiling:function(){cc.director.on(cc.Director.EVENT_AFTER_VISIT,y)},stopProfiling:function(){cc.director.off(cc.Director.EVENT_AFTER_VISIT,y)},isShowingStats:function(){return e},showStats:function(){t||this.init(),null===h.parentElement&&cc.container.appendChild(h),e=!0},hideStats:function(){e=!1,h&&h.parentElement===cc.container&&cc.container.removeChild(h)},init:function(){t||(m(),this.resumeProfiling(),t=!0)}};return C}(),e.exports=cc.profiler},{}],117:[function(t,e,i){function r(t){var e=t._parent;e._reorderChildDirty=!0,e._delaySort(),cc.eventManager._setDirtyForNode(t)}var n=t("./scene-graph-helper"),s=t("../platform/CCObject").Flags.Destroying,o=t("./misc"),a=(o.DirtyFlags,t("../platform/id-generater")),c="position-changed",h="size-changed",l="anchor-changed",u="child-added",d="child-removed",_="child-reorder",f=new a("Node"),p=cc.Class({"extends":cc.Object,mixins:[cc.EventTarget],properties:{_opacity:255,_color:cc.Color.WHITE,_cascadeOpacityEnabled:!0,_parent:null,_anchorPoint:cc.p(.5,.5),_contentSize:cc.size(0,0),_children:[],_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_localZOrder:0,_globalZOrder:0,_tag:cc.macro.NODE_TAG_INVALID,_opacityModifyRGB:!1,name:{get:function(){return this._name},set:function(t){this._name=t}},parent:{get:function(){return this._parent},set:function(t){if(this._parent!==t){var e=this._sgNode;e.parent&&e.parent.removeChild(e,!1);var i=this._parent;if(this._parent=t||null,t){var n=t._sgNode;n.addChild(e),r(this),t._children.push(this),t.emit(u,this)}if(i){if(!(i._objFlags&s)){var o=i._children.indexOf(this);i._children.splice(o,1),i.emit(d,this),this._onHierarchyChanged(i)}}else t&&this._onHierarchyChanged(null)}}},_id:{"default":"",editorOnly:!0},uuid:{get:function(){var t=this._id;return t||(t=this._id=f.getNewId()),t}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX=t,this._sgNode.skewX=t}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY=t,this._sgNode.skewY=t}},zIndex:{get:function(){return this._localZOrder},set:function(t){this._localZOrder!==t&&(this._localZOrder=t,this._sgNode.zIndex=t,this._parent&&r(this))}},rotation:{get:function(){return this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node.getRotation),this._rotationX},set:function(t){this._rotationX===t&&this._rotationY===t||(this._rotationX=this._rotationY=t,this._sgNode.rotation=t)}},rotationX:{get:function(){return this._rotationX},set:function(t){this._rotationX!==t&&(this._rotationX=t,this._sgNode.rotationX=t)}},rotationY:{get:function(){return this._rotationY},set:function(t){this._rotationY!==t&&(this._rotationY=t,this._sgNode.rotationY=t)}},scaleX:{get:function(){return this._scaleX},set:function(t){this._scaleX!==t&&(this._scaleX=t,this._sgNode.scaleX=t)}},scaleY:{get:function(){return this._scaleY},set:function(t){this._scaleY!==t&&(this._scaleY=t,this._sgNode.scaleY=t)}},x:{get:function(){return this._position.x},set:function(t){var e=this._position;if(t!==e.x){e.x=t,this._sgNode.setPositionX(t);var i=this._capturingListeners&&this._capturingListeners._callbackTable[c],r=this._bubblingListeners&&this._bubblingListeners._callbackTable[c];(i&&i.length>0||r&&r.length>0)&&this.emit(c)}}},y:{get:function(){return this._position.y},set:function(t){var e=this._position;if(t!==e.y){e.y=t,this._sgNode.setPositionY(t);var i=this._capturingListeners&&this._capturingListeners._callbackTable[c],r=this._bubblingListeners&&this._bubblingListeners._callbackTable[c];(i&&i.length>0||r&&r.length>0)&&this.emit(c)}}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){var e=this._anchorPoint;if(e.x!==t){e.x=t;var i=this._sizeProvider;i instanceof _ccsg.Node&&i.setAnchorPoint(e),this.emit(l)}}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){var e=this._anchorPoint;if(e.y!==t){e.y=t;var i=this._sizeProvider;i instanceof _ccsg.Node&&i.setAnchorPoint(e),this.emit(l)}}},width:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getWidth();return this._contentSize.width=t,t}return this._contentSize.width},set:function(t){if(t!==this._contentSize.width){var e=this._sizeProvider;e&&e.setContentSize(t,e._getHeight());this._contentSize.width=t,this.emit(h)}}},height:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getHeight();return this._contentSize.height=t,t}return this._contentSize.height},set:function(t){if(t!==this._contentSize.height){var e=this._sizeProvider;e&&e.setContentSize(e._getWidth(),t);this._contentSize.height=t,this.emit(h)}}},_ignoreAnchor:{get:function(){return this.__ignoreAnchor},set:function(t){if(this.__ignoreAnchor!==t){this.__ignoreAnchor=t,this._sgNode.ignoreAnchor=t;var e=this._sizeProvider;e instanceof _ccsg.Node&&e!==this._sgNode&&(e.ignoreAnchor=t),this.emit(l)}}},tag:{get:function(){return this._tag},set:function(t){this._tag=t,this._sgNode.tag=t}},opacity:{get:function(){return this._opacity},set:function(t){if(this._opacity!==t&&(this._opacity=t,this._sgNode.setOpacity(t),!this._cascadeOpacityEnabled)){var e=this._sizeProvider;e instanceof _ccsg.Node&&e!==this._sgNode&&e.setOpacity(t)}},range:[0,255]},cascadeOpacity:{get:function(){return this._cascadeOpacityEnabled},set:function(t){if(this._cascadeOpacityEnabled!==t){this._cascadeOpacityEnabled=t,this._sgNode.cascadeOpacity=t;var e=t?255:this._opacity,i=this._sizeProvider;i instanceof _ccsg.Node&&i.setOpacity(e)}}},color:{get:function(){var t=this._color;return new cc.Color(t.r,t.g,t.b,t.a)},set:function(t){if(!this._color.equals(t)){var e=this._color;e.r=t.r,e.g=t.g,e.b=t.b,this._sizeProvider instanceof _ccsg.Node&&this._sizeProvider.setColor(t)}}}},ctor:function(){var t=this._sgNode=new _ccsg.Node;cc.game._isCloning||(t.cascadeOpacity=!0),this._sizeProvider=null,this.__ignoreAnchor=!1,this._reorderChildDirty=!1,this.__instanceId=this._id||cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},_onPreDestroy:function(){cc.eventManager.removeListeners(this);for(var t=0,e=this.__eventTargets.length;t<e;++t){var i=this.__eventTargets[t];i&&i.targetOff(this)}cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_destruct:o.destructIgnoreId,_onHierarchyChanged:null,init:function(){return!0},attr:function(t){for(var e in t)this[e]=t[e]},setGlobalZOrder:function(t){this._globalZOrder=t,this._sgNode.setGlobalZOrder(t)},getGlobalZOrder:function(){return this._globalZOrder=this._sgNode.getGlobalZOrder(),this._globalZOrder},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node.getScale),this._scaleX},setScale:function(t,e){"object"==typeof t?(e=t.y,t=t.x):e=e||0===e?e:t,this._scaleX===t&&this._scaleY===e||(this._scaleX=t,this._scaleY=e,this._sgNode.setScale(t,e))},getPosition:function(){return cc.p(this._position)},setPosition:function(t,e){var i;"undefined"==typeof e?(i=t.x,e=t.y):(i=t,e=e);var r=this._position;if(r.x!==i||r.y!==e){r.x=i,r.y=e,this._sgNode.setPosition(i,e);var n=this._capturingListeners&&this._capturingListeners._callbackTable[c],s=this._bubblingListeners&&this._bubblingListeners._callbackTable[c];(n&&n.length>0||s&&s.length>0)&&this.emit(c)}},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}var r=this._sizeProvider;r instanceof _ccsg.Node&&r.setAnchorPoint(i),this.emit(l)},getAnchorPointInPoints:function(){return this._sgNode.getAnchorPointInPoints()},getContentSize:function(t){if(this._sizeProvider&&!t){var e=this._sizeProvider.getContentSize();return this._contentSize=e,e}return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._sizeProvider&&this._sizeProvider.setContentSize(i),this.emit(h)},getBoundingBox:function(){var t=this.getContentSize(),e=cc.rect(0,0,t.width,t.height);return cc._rectApplyAffineTransformIn(e,this.getNodeToParentTransform())},cleanup:function(){cc.director.getActionManager().removeAllActionsFromTarget(this),cc.eventManager.removeListeners(this);var t,e,i=this._children.length;for(t=0;t<i;++t)e=this._children[t],e&&e.cleanup()},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.tag===t)return r}return null},getChildByUuid:function(t){if(!t)return cc.log("Invalid uuid"),null;for(var e=this._children,i=0,r=e.length;i<r;i++)if(e[i]._id===t)return e[i];return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,r=e.length;i<r;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var r,n=!1;"undefined"==typeof i?(i=void 0,r=t._name):cc.js.isString(i)?(r=i,i=void 0):cc.js.isNumber(i)&&(n=!0,r=""),cc.assert(t,cc._LogInfos.Node.addChild_3),cc.assert(null===t._parent,"child already added. It can't be added again"),t.parent=this,t.zIndex=e,n?t.setTag(i):t.setName(r)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeChild:function(t,e){this._children.indexOf(t)>-1&&((e||void 0===e)&&t.cleanup(),t.parent=null)},removeChildByTag:function(t,e){t===cc.macro.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node.removeChildByTag);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.log(cc._LogInfos.Node.removeChildByTag_2,t)},removeAllChildren:function(t){var e=this._children;void 0===t&&(t=!0);for(var i=e.length-1;i>=0;i--){var r=e[i];r&&(t&&r.cleanup(),r.parent=null)}this._children.length=0},setNodeDirty:function(){this._sgNode.setNodeDirty()},getParentToNodeTransform:function(){return this._sgNode.getParentToNodeTransform()},_isSgTransformArToMe:function(t){var e=this._sgNode.getContentSize();return 0===e.width&&0===e.height&&(0!==t.width||0!==t.height)||!!this._sgNode.isIgnoreAnchorPointForPosition()},getNodeToWorldTransform:function(){var t=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.getNodeToWorldTransform();if(this._isSgTransformArToMe(t)){var i=-this._anchorPoint.x*t.width,r=-this._anchorPoint.y*t.height,n=cc.affineTransformMake(1,0,0,1,i,r);e=cc.affineTransformConcatIn(n,e)}return e},getNodeToWorldTransformAR:function(){var t=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.getNodeToWorldTransform();if(!this._isSgTransformArToMe(t)){var i=this._anchorPoint.x*t.width,r=this._anchorPoint.y*t.height,n=cc.affineTransformMake(1,0,0,1,i,r);e=cc.affineTransformConcatIn(n,e)}return e},getWorldToNodeTransform:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.getWorldToNodeTransform()},convertToNodeSpace:function(t){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.convertToNodeSpace(t);return cc.pAdd(e,cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},convertToWorldSpace:function(t){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.convertToWorldSpace(t);return cc.pSub(e,cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},convertToNodeSpaceAR:function(t){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToNodeSpace(t)):this._sgNode.convertToNodeSpaceAR(t)},convertToWorldSpaceAR:function(t){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToWorldSpace(t)):cc.v2(this._sgNode.convertToWorldSpaceAR(t))},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation())},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation())},getNodeToParentTransform:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToParentTransform();if(this._isSgTransformArToMe(t)){var i=-this._anchorPoint.x*t.width,r=-this._anchorPoint.y*t.height,n=cc.affineTransformMake(1,0,0,1,i,r);e=cc.affineTransformConcatIn(n,e)}return e},getNodeToParentTransformAR:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToParentTransform();if(!this._isSgTransformArToMe(t)){var i=this._anchorPoint.x*t.width,r=this._anchorPoint.y*t.height,n=cc.affineTransformMake(1,0,0,1,i,r);e=cc.affineTransformConcatIn(n,e)}return e},getBoundingBoxToWorld:function(){var t;return this.parent&&(t=this.parent.getNodeToWorldTransformAR()),this._getBoundingBoxTo(t)},_getBoundingBoxTo:function(t){var e=this.getContentSize(),i=e.width,r=e.height,n=cc.rect(-this._anchorPoint.x*i,-this._anchorPoint.y*r,i,r),s=cc.affineTransformConcat(this.getNodeToParentTransformAR(),t);if(cc._rectApplyAffineTransformIn(n,s),!this._children)return n;for(var o=this._children,a=0;a<o.length;a++){var c=o[a];if(c&&c.active){var h=c._getBoundingBoxTo(s);h&&(n=cc.rectUnion(n,h))}}return n},getDisplayedOpacity:function(){return this._sgNode.getDisplayedOpacity()},_updateDisplayedOpacity:function(t){this._sgNode.updateDisplayedOpacity(t)},getDisplayedColor:function(){return this._sgNode.getDisplayedColor()},setOpacityModifyRGB:function(t){if(this._opacityModifyRGB!==t){this._opacityModifyRGB=t,this._sgNode.setOpacityModifyRGB(t);var e=this._sizeProvider;e instanceof _ccsg.Node&&e!==this._sgNode&&e.setOpacityModifyRGB(t)}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(t){if(this._parent){var e=this._parent._children;t=t!==-1?t:e.length-1;var i=e.indexOf(this);if(t!==i){e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this);for(var r=this._parent,n=r._children,s=0,o=n.length;s<o;s++){var a=n[s]._sgNode;a.arrivalOrder=s,cc.eventManager._setDirtyForNode(n[s])}cc.renderer.childrenOrderDirty=!0,r._sgNode._reorderChildDirty=!0,r._reorderChildDirty=!0,r._delaySort()}}},isChildOf:function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var t=this._children;if(t.length>1){var e,i,r,n=t.length;for(e=1;e<n;e++){for(r=t[e],i=e-1;i>=0;){if(r._localZOrder<t[i]._localZOrder)t[i+1]=t[i];else{if(!(r._localZOrder===t[i]._localZOrder&&r._sgNode.arrivalOrder<t[i]._sgNode.arrivalOrder))break;t[i+1]=t[i]}i--}t[i+1]=r}this.emit(_)}}cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_delaySort:function(){cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_updateDummySgNode:function(){var t=this,e=t._sgNode;e.setPosition(t._position),e.setRotationX(t._rotationX),e.setRotationY(t._rotationY),e.setScale(t._scaleX,t._scaleY),e.setSkewX(t._skewX),e.setSkewY(t._skewY),e.ignoreAnchorPointForPosition(t.__ignoreAnchor);var i=e.arrivalOrder;e.setLocalZOrder(t._localZOrder),e.arrivalOrder=i,e.setGlobalZOrder(t._globalZOrder),e.setOpacity(t._opacity),e.setOpacityModifyRGB(t._opacityModifyRGB),e.setCascadeOpacityEnabled(t._cascadeOpacityEnabled),e.setTag(t._tag)},_updateSgNode:function(){this._updateDummySgNode();var t=this._sgNode;t.setAnchorPoint(this._anchorPoint),t.setVisible(this._active),t.setColor(this._color),this._activeInHierarchy?(cc.director.getActionManager().resumeTarget(this),cc.eventManager.resumeTarget(this)):(cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this))},_onBatchCreated:function(){this._updateDummySgNode(),this._parent&&this._parent._sgNode.addChild(this._sgNode),this._activeInHierarchy||(cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this));for(var t=this._children,e=0,i=t.length;e<i;e++)t[e]._onBatchCreated()},onRestore:!1,_removeSgNode:n.removeSgNode}),g=["name","skewX","skewY","position","rotation","rotationX","rotationY","scale","scaleX","scaleY","children","childrenCount","parent","running","scheduler","opacity","color","tag"],m={x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],zIndex:["getLocalZOrder","setLocalZOrder"],opacityModifyRGB:["isOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"],cascadeColor:["isCascadeColorEnabled","setCascadeColorEnabled"]};o.propertyDefine(p,g,m),cc._BaseNode=e.exports=p},{"../platform/CCObject":85,"../platform/id-generater":95,"./misc":120,"./scene-graph-helper":121}],118:[function(t,e,i){cc.find=e.exports=function(t,e){if(null==t)return cc.error("Argument must be non-nil"),null;if(!e){var i=cc.director.getScene();if(!i)return null;e=i}for(var r=e,n="/"!==t[0]?0:1,s=t.split("/"),o=n;o<s.length;o++){var a=s[o],c=r._children;r=null;for(var h=0,l=c.length;h<l;++h){var u=c[h];if(u.name===a){r=u;break}}if(!r)return null}return r}},{}],119:[function(t,e,i){t("./CCPath"),t("./CCProfiler"),t("./find")},{"./CCPath":115,"./CCProfiler":116,"./find":118}],120:[function(t,e,i){var r=cc.js,n={};n.propertyDefine=function(t,e,i){for(var n,s=t.prototype,o=0;o<e.length;o++){n=e[o];var a=n[0].toUpperCase()+n.slice(1),c=Object.getOwnPropertyDescriptor(s,n);c?(c.get&&(s["get"+a]=c.get),c.set&&(s["set"+a]=c.set)):r.getset(s,n,s["get"+a],s["set"+a])}for(n in i){var h=i[n],c=Object.getOwnPropertyDescriptor(s,n);c?(s[h[0]]=c.get,h[1]&&(s[h[1]]=c.set)):r.getset(s,n,s[h[0]],s[h[1]])}},n.NextPOT=function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t+1},n.destructIgnoreId=function(){for(var t in this)if(this.hasOwnProperty(t)&&"_id"!==t)switch(typeof this[t]){case"string":this[t]="";break;case"object":case"function":this[t]=null}},e.exports=n},{}],121:[function(t,e,i){var r={removeSgNode:function(){var t=this._sgNode;if(t){var e=t._parent;e&&e.removeChild(t),t.release(),this._sgNode._entity&&(this._sgNode._entity=null)}}};e.exports=r},{}],122:[function(t,e,i){cc.AffineTransform=function(t,e,i,r,n,s){this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=s},cc.affineTransformMake=function(t,e,i,r,n,s){return{a:t,b:e,c:i,d:r,tx:n,ty:s}},cc.affineTransformClone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},cc.pointApplyAffineTransform=function(t,e,i){var r,n;return void 0===i?(i=e,r=t.x,n=t.y):(r=t,n=e),{x:i.a*r+i.c*n+i.tx,y:i.b*r+i.d*n+i.ty}},cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)},cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,e){var i=t.x,r=t.y,n=i+t.width,s=r+t.height,o=e.a*i+e.c*r+e.tx,a=e.b*i+e.d*r+e.ty,c=e.a*n+e.c*r+e.tx,h=e.b*n+e.d*r+e.ty,l=e.a*i+e.c*s+e.tx,u=e.b*i+e.d*s+e.ty,d=e.a*n+e.c*s+e.tx,_=e.b*n+e.d*s+e.ty,f=Math.min(o,c,l,d),p=Math.max(o,c,l,d),g=Math.min(a,h,u,_),m=Math.max(a,h,u,_);return cc.rect(f,g,p-f,m-g)},cc._rectApplyAffineTransformIn=function(t,e){var i=t.x,r=t.y,n=i+t.width,s=r+t.height,o=e.a*i+e.c*r+e.tx,a=e.b*i+e.d*r+e.ty,c=e.a*n+e.c*r+e.tx,h=e.b*n+e.d*r+e.ty,l=e.a*i+e.c*s+e.tx,u=e.b*i+e.d*s+e.ty,d=e.a*n+e.c*s+e.tx,_=e.b*n+e.d*s+e.ty,f=Math.min(o,c,l,d),p=Math.max(o,c,l,d),g=Math.min(a,h,u,_),m=Math.max(a,h,u,_);return t.x=f,t.y=g,t.width=p-f,
t.height=m-g,t},cc.obbApplyAffineTransform=function(t,e,i,r,n,s){var o=t.x,a=t.y,c=t.width,h=t.height,l=e.a*o+e.c*a+e.tx,u=e.b*o+e.d*a+e.ty,d=e.a*c,_=e.b*c,f=e.c*h,p=e.d*h;r.x=l,r.y=u,n.x=d+l,n.y=_+u,i.x=f+l,i.y=p+u,s.x=d+f+l,s.y=_+p+u},cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}},cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,e){var i=Math.sin(e),r=Math.cos(e);return{a:t.a*r+t.c*i,b:t.b*r+t.d*i,c:t.c*r-t.a*i,d:t.d*r-t.b*i,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}},cc.affineTransformConcatIn=function(t,e){var i=t.a,r=t.b,n=t.c,s=t.d,o=t.tx,a=t.ty;return t.a=i*e.a+r*e.c,t.b=i*e.b+r*e.d,t.c=n*e.a+s*e.c,t.d=n*e.b+s*e.d,t.tx=o*e.a+a*e.c+e.tx,t.ty=o*e.b+a*e.d+e.ty,t},cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty},cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}}},{}],123:[function(t,e,i){var r=t("./CCValueType"),n=t("../platform/js"),s=function(){function e(t,e,i,r){"object"==typeof t&&(e=t.g,i=t.b,r=t.a,t=t.r),this.r=t||0,this.g=e||0,this.b=i||0,this.a="number"==typeof r?r:255}n.extend(e,r),t("../platform/CCClass").fastDefine("cc.Color",e,{r:0,g:0,b:0,a:255});var i={WHITE:[255,255,255,255],BLACK:[0,0,0,255],TRANSPARENT:[0,0,0,0],GRAY:[127.5,127.5,127.5],RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,235,4],ORANGE:[255,127,0],CYAN:[0,255,255],MAGENTA:[255,0,255]};for(var s in i){var o=function(t,i,r,n){return function(){return new e(t,i,r,n)}}.apply(null,i[s]);Object.defineProperty(e,s,{get:o})}return e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},e.prototype.lerp=function(t,i,r){r=r||new e;var n=this.r,s=this.g,o=this.b,a=this.a;return r.r=n+(t.r-n)*i,r.g=s+(t.g-s)*i,r.b=o+(t.b-o)*i,r.a=a+(t.a-a)*i,r},e.prototype.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},e.prototype.setR=function(t){return this.r=t,this},e.prototype.setG=function(t){return this.g=t,this},e.prototype.setB=function(t){return this.b=t,this},e.prototype.setA=function(t){return this.a=t,this},e.prototype.toCSS=function(t){return"rgba"===t?"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")":"rgb"===t?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(t)},e.prototype.clamp=function(){this.r=cc.clampf(this.r,0,255),this.g=cc.clampf(this.g,0,255),this.b=cc.clampf(this.b,0,255),this.a=cc.clampf(this.a,0,255)},e.prototype.fromHEX=function(t){var e=parseInt(t.indexOf("#")>-1?t.substring(1):t,16);return this.r=e>>16,this.g=(65280&e)>>8,this.b=255&e,this},e.prototype.toHEX=function(t){var e=[(0|this.r).toString(16),(0|this.g).toString(16),(0|this.b).toString(16)],i=-1;if("#rgb"===t)for(i=0;i<e.length;++i)e[i].length>1&&(e[i]=e[i][0]);else if("#rrggbb"===t)for(i=0;i<e.length;++i)1===e[i].length&&(e[i]="0"+e[i]);return e.join("")},e.prototype.toRGBValue=function(){return(cc.clampf(this.r,0,255)<<16)+(cc.clampf(this.g,0,255)<<8)+cc.clampf(this.b,0,255)},e.prototype.fromHSV=function(t,i,r){var n=e.hsv2rgb(t,i,r);return this.r=n.r,this.g=n.g,this.b=n.b,this},e.prototype.toHSV=function(){return e.rgb2hsv(this.r,this.g,this.b)},e}();s.rgb2hsv=function(t,e,i){t/=255,e/=255,i/=255;var r={h:0,s:0,v:0},n=Math.max(t,e,i),s=Math.min(t,e,i),o=0;return r.v=n,r.s=n?(n-s)/n:0,r.s?(o=n-s,t===n?r.h=(e-i)/o:e===n?r.h=2+(i-t)/o:r.h=4+(t-e)/o,r.h/=6,r.h<0&&(r.h+=1)):r.h=0,r},s.hsv2rgb=function(t,e,i){var r={r:0,g:0,b:0};if(0===e)r.r=r.g=r.b=i;else if(0===i)r.r=r.g=r.b=0;else{1===t&&(t=0),t*=6,e=e,i=i;var n=Math.floor(t),s=t-n,o=i*(1-e),a=i*(1-e*s),c=i*(1-e*(1-s));switch(n){case 0:r.r=i,r.g=c,r.b=o;break;case 1:r.r=a,r.g=i,r.b=o;break;case 2:r.r=o,r.g=i,r.b=c;break;case 3:r.r=o,r.g=a,r.b=i;break;case 4:r.r=c,r.g=o,r.b=i;break;case 5:r.r=i,r.g=o,r.b=a}}return r.r*=255,r.g*=255,r.b*=255,r},cc.Color=s,cc.color=function(t,e,i,r){if("string"==typeof t){var n=new cc.Color;return n.fromHEX(t)}return"object"==typeof t?new cc.Color(t.r,t.g,t.b,t.a):new cc.Color(t,e,i,r)},cc.colorEqual=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b},cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var e=parseInt(t),i=e>>16,r=(65280&e)>>8,n=255&e;return cc.color(i,r,n)},cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),r=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+i:i)+(t.b<16?"0"+r:r)},e.exports=cc.Color},{"../platform/CCClass":81,"../platform/js":98,"./CCValueType":130}],124:[function(t,e,i){cc.Enum=function(t){var e={};Object.defineProperty(e,"__enums__",{value:void 0,writable:!0});var i=-1;for(var r in t){var n=t[r];n===-1?n=++i:i=n,e[r]=n;var s=""+n;if(r!==s){if(e.hasOwnProperty(s),!1){cc.error("%s already defined in Enum.",s);continue}Object.defineProperty(e,s,{value:r})}}return e},cc.Enum.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},cc.Enum.getList=function(t){if(void 0!==t.__enums__)return t.__enums__;var e=[];for(var i in t)if(t.hasOwnProperty(i)){var r=t[i],n="number"==typeof r&&(0|r)===r;n&&e.push({name:i,value:r})}return e.sort(function(t,e){return t.value-e.value}),t.__enums__=e,e};e.exports=cc.Enum},{}],125:[function(t,e,i){var r=parseFloat("1.192092896e-07F");cc.pNeg=function(t){return cc.p(-t.x,-t.y)},cc.pAdd=function(t,e){return cc.p(t.x+e.x,t.y+e.y)},cc.pSub=function(t,e){return cc.p(t.x-e.x,t.y-e.y)},cc.pMult=function(t,e){return cc.p(t.x*e,t.y*e)},cc.pMidpoint=function(t,e){return cc.pMult(cc.pAdd(t,e),.5)},cc.pDot=function(t,e){return t.x*e.x+t.y*e.y},cc.pCross=function(t,e){return t.x*e.y-t.y*e.x},cc.pPerp=function(t){return cc.p(-t.y,t.x)},cc.pRPerp=function(t){return cc.p(t.y,-t.x)},cc.pProject=function(t,e){return cc.pMult(e,cc.pDot(t,e)/cc.pDot(e,e))},cc.pLengthSQ=function(t){return cc.pDot(t,t)},cc.pDistanceSQ=function(t,e){return cc.pLengthSQ(cc.pSub(t,e))},cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))},cc.pDistance=function(t,e){return cc.pLength(cc.pSub(t,e))},cc.pNormalize=function(t){var e=cc.pLength(t);return 0===e?cc.p(t):cc.pMult(t,1/e)},cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))},cc.pToAngle=function(t){return Math.atan2(t.y,t.x)},cc.clampf=function(t,e,i){if(e>i){var r=e;e=i,i=r}return t<e?e:t<i?t:i},cc.clamp01=function(t){return t<0?0:t<1?t:1},cc.pClamp=function(t,e,i){return cc.p(cc.clampf(t.x,e.x,i.x),cc.clampf(t.y,e.y,i.y))},cc.pFromSize=function(t){return cc.p(t.width,t.height)},cc.pCompOp=function(t,e){return cc.p(e(t.x),e(t.y))},cc.pLerp=function(t,e,i){return cc.pAdd(cc.pMult(t,1-i),cc.pMult(e,i))},cc.pFuzzyEqual=function(t,e,i){return t.x-i<=e.x&&e.x<=t.x+i&&t.y-i<=e.y&&e.y<=t.y+i},cc.pCompMult=function(t,e){return cc.p(t.x*e.x,t.y*e.y)},cc.pAngleSigned=function(t,e){var i=cc.pNormalize(t),n=cc.pNormalize(e),s=Math.atan2(i.x*n.y-i.y*n.x,cc.pDot(i,n));return Math.abs(s)<r?0:s},cc.pAngle=function(t,e){var i=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(e)));return Math.abs(i)<r?0:i},cc.pRotateByAngle=function(t,e,i){var r=cc.pSub(t,e),n=Math.cos(i),s=Math.sin(i),o=r.x;return r.x=o*n-r.y*s+e.x,r.y=o*s+r.y*n+e.y,r},cc.pLineIntersect=function(t,e,i,r,n){if(t.x===e.x&&t.y===e.y||i.x===r.x&&i.y===r.y)return!1;var s=e.x-t.x,o=e.y-t.y,a=r.x-i.x,c=r.y-i.y,h=t.x-i.x,l=t.y-i.y,u=c*s-a*o;return n.x=a*l-c*h,n.y=s*l-o*h,0===u?0===n.x||0===n.y:(n.x=n.x/u,n.y=n.y/u,!0)},cc.pSegmentIntersect=function(t,e,i,r){var n=cc.p(0,0);return!!(cc.pLineIntersect(t,e,i,r,n)&&n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1)},cc.pIntersectPoint=function(t,e,i,r){var n=cc.p(0,0);if(cc.pLineIntersect(t,e,i,r,n)){var s=cc.p(0,0);return s.x=t.x+n.x*(e.x-t.x),s.y=t.y+n.x*(e.y-t.y),s}return cc.p(0,0)},cc.pSameAs=function(t,e){return null!=t&&null!=e&&(t.x===e.x&&t.y===e.y)},cc.pZeroIn=function(t){t.x=0,t.y=0},cc.pIn=function(t,e){t.x=e.x,t.y=e.y},cc.pMultIn=function(t,e){t.x*=e,t.y*=e},cc.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y},cc.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y},cc.pNormalizeIn=function(t){cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))}},{}],126:[function(t,e,i){function r(t,e,i,r){t&&"object"==typeof t&&(e=t.y,i=t.width,r=t.height,t=t.x),this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0}var n=t("./CCValueType"),s=t("../platform/js");s.extend(r,n),t("../platform/CCClass").fastDefine("cc.Rect",r,{x:0,y:0,width:0,height:0}),r.fromMinMax=function(t,e){var i=Math.min(t.x,e.x),n=Math.min(t.y,e.y),s=Math.max(t.x,e.x),o=Math.max(t.y,e.y);return new r(i,n,s-i,o-n)},r.contain=function(t,e){return t.x<e.x&&t.x+t.width>e.x+e.width&&t.y<e.y&&t.y+t.height>e.y+e.height?1:e.x<t.x&&e.x+e.width>t.x+t.width&&e.y<t.y&&e.y+e.height>t.y+t.height?-1:0};var o=r.prototype;o.clone=function(){return new r(this.x,this.y,this.width,this.height)},o.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new r;var n=this.x,s=this.y,o=this.width,a=this.height;return i.x=n+(t.x-n)*e,i.y=s+(t.y-s)*e,i.width=o+(t.width-o)*e,i.height=a+(t.height-a)*e,i},o.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},Object.defineProperty(o,"xMin",{get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}}),Object.defineProperty(o,"yMin",{get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}}),Object.defineProperty(o,"xMax",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}}),Object.defineProperty(o,"yMax",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}}),Object.defineProperty(o,"center",{get:function(){return new cc.Vec2(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}}),Object.defineProperty(o,"size",{get:function(){return new cc.Size(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}}),o.intersects=function(t){return cc.rectIntersectsRect(this,t)},o.contains=function(t){return this.x<t.x&&this.x+this.width>t.x&&this.y<t.y&&this.y+this.height>t.y},o.containsRect=function(t){return this.x<t.x&&this.x+this.width>t.x+t.width&&this.y<t.y&&this.y+this.height>t.y+t.height},cc.Rect=r,cc.rect=function(t,e,i,n){return new r(t,e,i,n)},cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,e){return!(!t||!e)&&!(t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height)},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,e){var i=t.x+t.width,r=t.y+t.height,n=e.x+e.width,s=e.y+e.height;return!(i<e.x||n<t.x||r<e.y||s<t.y)},cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)},cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i},cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);return i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i),i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i),i},e.exports=cc.Rect},{"../platform/CCClass":81,"../platform/js":98,"./CCValueType":130}],127:[function(t,e,i){function r(t,e){t&&"object"==typeof t&&(e=t.height,t=t.width),this.width=t||0,this.height=e||0}var n=t("./CCValueType"),s=t("../platform/js");s.extend(r,n),t("../platform/CCClass").fastDefine("cc.Size",r,{width:0,height:0}),s.get(r,"ZERO",function(){return new r(0,0)});var o=r.prototype;o.clone=function(){return new r(this.width,this.height)},o.equals=function(t){return t&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new r;var n=this.width,s=this.height;return i.width=n+(t.width-n)*e,i.height=s+(t.height-s)*e,i},o.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},cc.size=function(t,e){return new r(t,e)},cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height},cc.Size=e.exports=r},{"../platform/CCClass":81,"../platform/js":98,"./CCValueType":130}],128:[function(t,e,i){cc.Acceleration=function(t,e,i,r){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=r||0},cc.BlendFunc=function(t,e){this.src=t,this.dst=e};var r=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775});cc.BlendFunc._disable=function(){return new cc.BlendFunc(r.ONE,r.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(r.SRC_ALPHA,r.ONE)},cc.BlendFunc.BlendFactor=r,cc.BlendFunc.DISABLE,cc.js.get(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.js.get(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive),cc.blendFuncDisable=cc.BlendFunc._disable,cc.FontDefinition=function(t){var e=this;if(e.fontName="Arial",e.fontSize=12,e.textAlign=cc.TextAlignment.CENTER,e.verticalAlign=cc.VerticalTextAlignment.TOP,e.fillStyle=cc.color(255,255,255,255),e.boundingWidth=0,e.boundingHeight=0,e.strokeEnabled=!1,e.strokeStyle=cc.color(255,255,255,255),e.lineWidth=1,e.lineHeight="normal",e.fontStyle="normal",e.fontWeight="normal",e.shadowEnabled=!1,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowOpacity=1,t&&t instanceof Object)for(var i in t)e[i]=t[i]},cc.FontDefinition.prototype._getCanvasFontStr=function(){var t=this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px";return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+t+" '"+this.fontName+"'"},cc.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),cc._Dictionary=cc.Class({ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|10*Math.random())},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(t,e){if(null!=e){var i=this.__getKey();this._keyMapTb[i]=e,this._valueMapTb[i]=t}},objectForKey:function(t){if(null==t)return null;var e=this._keyMapTb;for(var i in e)if(e[i]===t)return this._valueMapTb[i];return null},valueForKey:function(t){return this.objectForKey(t)},removeObjectForKey:function(t){if(null!=t){var e=this._keyMapTb;for(var i in e)if(e[i]===t)return delete this._valueMapTb[i],void delete e[i]}},removeObjectsForKeys:function(t){if(null!=t)for(var e=0;e<t.length;e++)this.removeObjectForKey(t[e])},allKeys:function(){var t=[],e=this._keyMapTb;for(var i in e)t.push(e[i]);return t},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}})},{}],129:[function(t,e,i){cc.WebGLColor=function(t,e,i,r,n,s){this._arrayBuffer=n||new ArrayBuffer(cc.WebGLColor.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset;this._view=new Uint8Array(o,a,4),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0,"number"==typeof r?this._view[3]=r:(this._view[3]=255,this.a_undefined=!0)},cc.WebGLColor.BYTES_PER_ELEMENT=4;var r=cc.WebGLColor.prototype;r._getR=function(){return this._view[0]},r._setR=function(t){this._view[0]=t<0?0:t},r._getG=function(){return this._view[1]},r._setG=function(t){this._view[1]=t<0?0:t},r._getB=function(){return this._view[2]},r._setB=function(t){this._view[2]=t<0?0:t},r._getA=function(){return this._view[3]},r._setA=function(t){this._view[3]=t<0?0:t},r.r,cc.js.getset(r,"r",r._getR,r._setR),r.g,cc.js.getset(r,"g",r._getG,r._setG),r.b,cc.js.getset(r,"b",r._getB,r._setB),r.a,cc.js.getset(r,"a",r._getA,r._setA),cc.Vertex2F=function(t,e,i,r){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=r||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Vertex2F.BYTES_PER_ELEMENT=8;var r=cc.Vertex2F.prototype;r._getX=function(){return this._view[0]},r._setX=function(t){this._view[0]=t},r._getY=function(){return this._view[1]},r._setY=function(t){this._view[1]=t},cc.js.getset(r,"x",r._getX,r._setX),cc.js.getset(r,"y",r._getY,r._setY),cc.Vertex3F=function(t,e,i,r,n){this._arrayBuffer=r||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=n||0;var s=this._arrayBuffer,o=this._offset;this._view=new Float32Array(s,o,3),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,r=cc.Vertex3F.prototype,r._getX=function(){return this._view[0]},r._setX=function(t){this._view[0]=t},r._getY=function(){return this._view[1]},r._setY=function(t){this._view[1]=t},r._getZ=function(){return this._view[2]},r._setZ=function(t){this._view[2]=t},cc.js.getset(r,"x",r._getX,r._setX),cc.js.getset(r,"y",r._getY,r._setY),cc.js.getset(r,"z",r._getZ,r._setZ),cc.Tex2F=function(t,e,i,r){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=r||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Tex2F.BYTES_PER_ELEMENT=8,r=cc.Tex2F.prototype,r._getU=function(){return this._view[0]},r._setU=function(t){this._view[0]=t},r._getV=function(){return this._view[1]},r._setV=function(t){this._view[1]=t},cc.js.getset(r,"u",r._getU,r._setU),cc.js.getset(r,"v",r._getV,r._setV),cc.Quad2=function(t,e,i,r,n,s){this._arrayBuffer=n||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,o,a):new cc.Vertex2F(0,0,o,a),a+=c,this._tr=e?new cc.Vertex2F(e.x,e.y,o,a):new cc.Vertex2F(0,0,o,a),a+=c,this._bl=i?new cc.Vertex2F(i.x,i.y,o,a):new cc.Vertex2F(0,0,o,a),a+=c,this._br=r?new cc.Vertex2F(r.x,r.y,o,a):new cc.Vertex2F(0,0,o,a)},cc.Quad2.BYTES_PER_ELEMENT=32,r=cc.Quad2.prototype,r._getTL=function(){return this._tl},r._setTL=function(t){this._tl._view[0]=t.x,this._tl._view[1]=t.y},r._getTR=function(){return this._tr},r._setTR=function(t){this._tr._view[0]=t.x,this._tr._view[1]=t.y},r._getBL=function(){return this._bl},r._setBL=function(t){this._bl._view[0]=t.x,this._bl._view[1]=t.y},r._getBR=function(){return this._br},r._setBR=function(t){this._br._view[0]=t.x,this._br._view[1]=t.y},cc.js.getset(r,"tl",r._getTL,r._setTL),cc.js.getset(r,"tr",r._getTR,r._setTR),cc.js.getset(r,"bl",r._getBL,r._setBL),cc.js.getset(r,"br",r._getBR,r._setBR),cc.Quad3=function(t,e,i,r,n,s){this._arrayBuffer=n||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=bl?new cc.Vertex3F(bl.x,bl.y,bl.z,o,a):new cc.Vertex3F(0,0,0,o,a),a+=c,this.br=br?new cc.Vertex3F(br.x,br.y,br.z,o,a):new cc.Vertex3F(0,0,0,o,a),a+=c,this.tl=tl?new cc.Vertex3F(tl.x,tl.y,tl.z,o,a):new cc.Vertex3F(0,0,0,o,a),a+=c,this.tr=tr?new cc.Vertex3F(tr.x,tr.y,tr.z,o,a):new cc.Vertex3F(0,0,0,o,a)},cc.Quad3.BYTES_PER_ELEMENT=48,cc.V3F_C4B_T2F=function(t,e,i,r,n){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=n||0;var s=this._arrayBuffer,o=this._offset;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,s,o):new cc.Vertex3F(0,0,0,s,o),o+=cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,s,o):new cc.WebGLColor(0,0,0,0,s,o),o+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,s,o):new cc.Tex2F(0,0,s,o)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,r=cc.V3F_C4B_T2F.prototype,r._getVertices=function(){return this._vertices},r._setVertices=function(t){var e=this._vertices;e._view[0]=t.x,e._view[1]=t.y,e._view[2]=t.z},r._getColor=function(){return this._colors},r._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},r._getTexCoords=function(){return this._texCoords},r._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.js.getset(r,"vertices",r._getVertices,r._setVertices),cc.js.getset(r,"colors",r._getColor,r._setColor),cc.js.getset(r,"texCoords",r._getTexCoords,r._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,e,i,r,n,s){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),a+=c,this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),a+=c,this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),a+=c,this._br=r?new cc.V3F_C4B_T2F(r.vertices,r.colors,r.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,r=cc.V3F_C4B_T2F_Quad.prototype,r._getTL=function(){return this._tl},r._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},r._getBL=function(){return this._bl},r._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},r._getTR=function(){return this._tr},r._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},r._getBR=function(){return this._br},r._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},r._getArrayBuffer=function(){return this._arrayBuffer},cc.js.getset(r,"tl",r._getTL,r._setTL),cc.js.getset(r,"tr",r._getTR,r._setTR),cc.js.getset(r,"bl",r._getBL,r._setBL),cc.js.getset(r,"br",r._getBR,r._setBR),cc.js.get(r,"arrayBuffer",r._getArrayBuffer),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var e=t.tl,i=t.bl,r=t.tr,n=t.br;return{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}},br:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]));return e},cc.V2F_C4B_T2F=function(t,e,i,r,n){this._arrayBuffer=r||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=n||0;var s=this._arrayBuffer,o=this._offset;this._vertices=t?new cc.Vertex2F(t.x,t.y,s,o):new cc.Vertex2F(0,0,s,o),o+=cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,s,o):new cc.WebGLColor(0,0,0,0,s,o),o+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,s,o):new cc.Tex2F(0,0,s,o)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,r=cc.V2F_C4B_T2F.prototype,r._getVertices=function(){return this._vertices},r._setVertices=function(t){this._vertices._view[0]=t.x,this._vertices._view[1]=t.y},r._getColor=function(){return this._colors},r._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},r._getTexCoords=function(){return this._texCoords},r._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.js.getset(r,"vertices",r._getVertices,r._setVertices),cc.js.getset(r,"colors",r._getColor,r._setColor),cc.js.getset(r,"texCoords",r._getTexCoords,r._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,e,i,r,n){this._arrayBuffer=r||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=n||0;var s=this._arrayBuffer,o=this._offset,a=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o),o+=a,this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o),o+=a,this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,r=cc.V2F_C4B_T2F_Triangle.prototype,r._getA=function(){return this._a},r._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},r._getB=function(){return this._b},r._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},r._getC=function(){return this._c},r._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},cc.js.getset(r,"a",r._getA,r._setA),cc.js.getset(r,"b",r._getB,r._setB),cc.js.getset(r,"c",r._getC,r._setC)},{}],130:[function(t,e,i){function r(){}var n=t("../platform/js");n.setClassName("cc.ValueType",r),n.mixin(r.prototype,{clone:!1,equals:!1,toString:function(){return""+{}},lerp:!1}),cc.ValueType=r,e.exports=r},{"../platform/js":98}],131:[function(t,e,i){function r(t,e){t&&"object"==typeof t&&(e=t.y,t=t.x),this.x=t||0,this.y=e||0}var n=t("./CCValueType"),s=t("../platform/js"),o=t("../platform/CCClass");s.extend(r,n),o.fastDefine("cc.Vec2",r,{x:0,y:0}),s.mixin(r.prototype,{clone:function(){return new r(this.x,this.y)},set:function(t){return this.x=t.x,this.y=t.y,this},equals:function(t){return t&&this.x===t.x&&this.y===t.y},toString:function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},lerp:function(t,e,i){i=i||new r;var n=this.x,s=this.y;return i.x=n+(t.x-n)*e,i.y=s+(t.y-s)*e,i},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},add:function(t,e){return e=e||new r,e.x=this.x+t.x,e.y=this.y+t.y,e},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},sub:function(t,e){return e=e||new r,e.x=this.x-t.x,e.y=this.y-t.y,e},mulSelf:function(t){return this.x*=t,this.y*=t,this},mul:function(t,e){return e=e||new r,e.x=this.x*t,e.y=this.y*t,e},scaleSelf:function(t){return this.x*=t.x,this.y*=t.y,this},scale:function(t,e){return e=e||new r,e.x=this.x*t.x,e.y=this.y*t.y,e},divSelf:function(t){return this.x/=t,this.y/=t,this},div:function(t,e){return e=e||new r,e.x=this.x/t,e.y=this.y/t,e},negSelf:function(){return this.x=-this.x,this.y=-this.y,this},neg:function(t){return t=t||new r,t.x=-this.x,t.y=-this.y,t},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.y*t.x-this.x*t.y},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magSqr:function(){return this.x*this.x+this.y*this.y},normalizeSelf:function(){var t=this.x*this.x+this.y*this.y;if(1===t)return this;if(0===t)return console.warn("Can't normalize zero vector"),this;var e=1/Math.sqrt(t);return this.x*=e,this.y*=e,this},normalize:function(t){return t=t||new r,t.x=this.x,t.y=this.y,t.normalizeSelf(),t},angle:function(t){var e=this.magSqr(),i=t.magSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;var r=this.dot(t),n=r/Math.sqrt(e*i);return n=cc.clampf(n,-1,1),Math.acos(n)},signAngle:function(t){return Math.atan2(this.y,this.x)-Math.atan2(t.y,t.x)},rotate:function(t,e){return e=e||new r,e.x=this.x,e.y=this.y,e.rotateSelf(t)},rotateSelf:function(t){var e=Math.sin(t),i=Math.cos(t),r=this.x;return this.x=i*r-e*this.y,this.y=e*r+i*this.y,this}}),s.get(r,"ONE",function(){return new r(1,1)}),s.get(r,"ZERO",function(){return new r(0,0)}),s.get(r,"UP",function(){return new r(0,1)}),s.get(r,"RIGHT",function(){return new r(1,0)}),cc.Vec2=r,cc.v2=function(t,e){return new r(t,e)},cc.p=cc.v2,cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},e.exports=cc.Vec2},{"../platform/CCClass":81,"../platform/js":98,"./CCValueType":130}],132:[function(t,e,i){t("./CCValueType"),t("./CCEnum"),t("./CCVec2"),t("./CCPointExtension"),t("./CCSize"),t("./CCRect"),t("./CCColor"),t("./CCTypes"),t("./CCAffineTransform"),t("./CCTypesWebGL")},{"./CCAffineTransform":122,"./CCColor":123,"./CCEnum":124,"./CCPointExtension":125,"./CCRect":126,"./CCSize":127,"./CCTypes":128,"./CCTypesWebGL":129,"./CCValueType":130,"./CCVec2":131}],133:[function(require,module,exports){function deprecateEnum(obj,oldPath,newPath,hasTypePrefixBefore){hasTypePrefixBefore=hasTypePrefixBefore!==!1;for(var enumDef=eval(newPath),entries=cc.Enum.getList(enumDef),delimiter=hasTypePrefixBefore?"_":".",i=0;i<entries.length;i++){var entry=entries[i].name,oldPropName;if(hasTypePrefixBefore){var oldTypeName=oldPath.split(".").slice(-1)[0];oldPropName=oldTypeName+"_"+entry}else oldPropName=entry;js.get(obj,oldPropName,function(t){return cc.warn(INFO,oldPath+delimiter+t,newPath+"."+t),enumDef[t]}.bind(null,entry))}}function markAsRemoved(t,e,i){i=i||js.getClassName(t),e.forEach(function(e){function r(){cc.error("Sorry, %s.%s is removed.",i,e)}js.getset(t.prototype,e,r,r)})}function provideClearError(t,e,i){function r(e,i){function r(t){cc.error(s,e,t)}Array.isArray(i)||(i=i.split(",").map(function(t){return t.trim()})),js.getset(t,e,r.bind(null,i[0]),i[1]&&r.bind(null,i[1]))}var n=i||cc.js.getClassName(t),s="Sorry, "+n+".%s is removed, please use %s instead.";for(var o in e){var a=e[o];if("*"===o[0]){var c=o.slice(1);r("g"+c,a),r("s"+c,a)}else o.split(",").map(function(t){return t.trim()}).forEach(function(t){r(t,a)})}}function shouldNotUseNodeProp(t){var e=t.prototype;for(var i in cc.Node.prototype)!function(t){t in e||"_"===t[0]||Object.defineProperty(e,t,{get:function(){var e=cc.js.getClassName(this),i="Sorry, "+e+".%s is undefined, please use cc.Node.%s instead.";cc.error(i,t,t)},enumerable:!1,configurable:!0})}(i)}var js=cc.js;cc.Label&&js.obsolete(cc.Label.prototype,"cc.Label.file","font",!0);var INFO},{}],134:[function(t,e,i){cc.math.AABB=function(t,e){this.min=t||new cc.math.Vec3,this.max=e||new cc.math.Vec3},cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},cc.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z},cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)},cc.math.AABB.assign=function(t,e){return t.min.assignFrom(e.min),t.max.assignFrom(e.max),t}},{}],135:[function(t,e,i){cc.math.Matrix4Stack=function(t,e){this.top=t,this.stack=e||[]};var r=cc.math.Matrix4Stack.prototype;r.initialize=function(){this.stack.length=0,this.top=null},r.push=function(t){t=t||this.top,this.stack.push(this.top),this.top=new cc.math.Matrix4(t)},r.pop=function(){this.top=this.stack.pop()},r.release=function(){this.stack=null,this.top=null,this._matrixPool=null},r._getFromPool=function(t){var e=this._matrixPool;if(0===e.length)return new cc.math.Matrix4(t);var i=e.pop();return i.assignFrom(t),
i},r._putInPool=function(t){this._matrixPool.push(t)}},{}],136:[function(t,e,i){var r=cc.math;r.KM_GL_MODELVIEW=5888,r.KM_GL_PROJECTION=5889,r.KM_GL_TEXTURE=5890,r.modelview_matrix_stack=new r.Matrix4Stack,r.projection_matrix_stack=new r.Matrix4Stack,r.texture_matrix_stack=new r.Matrix4Stack,cc.current_stack=null;var n=!1,s=function(){if(!n){var t=new r.Matrix4;r.modelview_matrix_stack.initialize(),r.projection_matrix_stack.initialize(),r.texture_matrix_stack.initialize(),cc.current_stack=r.modelview_matrix_stack,n=!0,t.identity(),r.modelview_matrix_stack.push(t),r.projection_matrix_stack.push(t),r.texture_matrix_stack.push(t)}};s(),r.glFreeAll=function(){r.modelview_matrix_stack.release(),r.modelview_matrix_stack=null,r.projection_matrix_stack.release(),r.projection_matrix_stack=null,r.texture_matrix_stack.release(),r.texture_matrix_stack=null,n=!1,cc.current_stack=null},r.glPushMatrix=function(){cc.current_stack.push(cc.current_stack.top)},r.glPushMatrixWitMat4=function(t){cc.current_stack.stack.push(cc.current_stack.top),t.assignFrom(cc.current_stack.top),cc.current_stack.top=t},r.glPopMatrix=function(){cc.current_stack.top=cc.current_stack.stack.pop()},r.glMatrixMode=function(t){switch(t){case r.KM_GL_MODELVIEW:cc.current_stack=r.modelview_matrix_stack;break;case r.KM_GL_PROJECTION:cc.current_stack=r.projection_matrix_stack;break;case r.KM_GL_TEXTURE:cc.current_stack=r.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},r.glLoadIdentity=function(){cc.current_stack.top.identity()},r.glLoadMatrix=function(t){cc.current_stack.top.assignFrom(t)},r.glMultMatrix=function(t){cc.current_stack.top.multiply(t)};var o=new r.Matrix4;r.glTranslatef=function(t,e,i){var n=r.Matrix4.createByTranslation(t,e,i,o);cc.current_stack.top.multiply(n)};var a=new r.Vec3;r.glRotatef=function(t,e,i,n){a.fill(e,i,n);var s=r.Matrix4.createByAxisAndAngle(a,cc.degreesToRadians(t),o);cc.current_stack.top.multiply(s)},r.glScalef=function(t,e,i){var n=r.Matrix4.createByScale(t,e,i,o);cc.current_stack.top.multiply(n)},r.glGetMatrix=function(t,e){switch(t){case r.KM_GL_MODELVIEW:e.assignFrom(r.modelview_matrix_stack.top);break;case r.KM_GL_PROJECTION:e.assignFrom(r.projection_matrix_stack.top);break;case r.KM_GL_TEXTURE:e.assignFrom(r.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}},{}],137:[function(t,e,i){t("./utility"),t("./vec2"),t("./vec3"),t("./vec4"),t("./ray2"),t("./mat3"),t("./mat4"),t("./plane"),t("./quaternion"),t("./aabb"),t("./gl/mat4stack"),t("./gl/matrix")},{"./aabb":134,"./gl/mat4stack":135,"./gl/matrix":136,"./mat3":138,"./mat4":139,"./plane":140,"./quaternion":141,"./ray2":142,"./utility":143,"./vec2":144,"./vec3":145,"./vec4":146}],138:[function(t,e,i){window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array,cc.math.Matrix3=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(9)};var r=cc.math.Matrix3.prototype;r.fill=function(t){var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},r.adjugate=function(){var t=this.mat,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],c=t[7],h=t[8];return t[0]=s*h-o*c,t[1]=r*c-i*h,t[2]=i*o-r*s,t[3]=o*a-n*h,t[4]=e*h-r*a,t[5]=r*n-e*o,t[6]=n*c-s*a,t[8]=e*s-i*n,this},r.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,this};var n=new cc.math.Matrix3;r.inverse=function(t){if(0===t)return this;n.assignFrom(this);var e=1/t;return this.adjugate(),this.multiplyScalar(e),this},r.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]},r.transpose=function(){var t=this.mat,e=t[1],i=t[2],r=t[3],n=t[5],s=t[6],o=t[7];return t[1]=r,t[2]=s,t[3]=e,t[5]=o,t[6]=i,t[7]=n,this},r.determinant=function(){var t=this.mat,e=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7];return e-=t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8]},r.multiply=function(t){var e=this.mat,i=t.mat,r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=i[0],_=i[1],f=i[2],p=i[3],g=i[4],m=i[5],v=i[6],y=i[7],C=i[8];return e[0]=r*d+o*_+h*f,e[1]=n*d+a*_+l*f,e[2]=s*d+c*_+u*f,e[3]=s*d+c*_+u*f,e[4]=n*p+a*g+l*m,e[5]=s*p+c*g+u*m,e[6]=r*v+o*y+h*C,e[7]=n*v+a*y+l*C,e[8]=s*v+c*y+u*C,this},r.multiplyScalar=function(t){var e=this.mat;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},cc.math.Matrix3.rotationAxisAngle=function(t,e){var i=Math.cos(e),r=Math.sin(e),n=new cc.math.Matrix3,s=n.mat;return s[0]=i+t.x*t.x*(1-i),s[1]=t.z*r+t.y*t.x*(1-i),s[2]=-t.y*r+t.z*t.x*(1-i),s[3]=-t.z*r+t.x*t.y*(1-i),s[4]=i+t.y*t.y*(1-i),s[5]=t.x*r+t.z*t.y*(1-i),s[6]=t.y*r+t.x*t.z*(1-i),s[7]=-t.x*r+t.y*t.z*(1-i),s[8]=i+t.z*t.z*(1-i),n},r.assignFrom=function(t){if(this===t)return cc.log("cc.math.Matrix3.assign(): current matrix equals matIn"),this;var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},r.equals=function(t){if(this===t)return!0;for(var e=cc.math.EPSILON,i=this.mat,r=t.mat,n=0;n<9;++n)if(!(i[n]+e>r[n]&&i[n]-e<r[n]))return!1;return!0},cc.math.Matrix3.createByRotationX=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=Math.cos(t),i[5]=Math.sin(t),i[6]=0,i[7]=-Math.sin(t),i[8]=Math.cos(t),e},cc.math.Matrix3.createByRotationY=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[4]=1,i[5]=0,i[6]=Math.sin(t),i[7]=0,i[8]=Math.cos(t),e},cc.math.Matrix3.createByRotationZ=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=-Math.sin(t),i[2]=0,i[3]=Math.sin(t),i[4]=Math.cos(t),i[5]=0,i[6]=0,i[7]=0,i[8]=1,e},cc.math.Matrix3.createByRotation=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[2]=0,i[3]=-Math.sin(t),i[4]=Math.cos(t),i[5]=0,i[6]=0,i[7]=0,i[8]=1,e},cc.math.Matrix3.createByScale=function(t,e){var i=new cc.math.Matrix3;return i.identity(),i.mat[0]=t,i.mat[4]=e,i},cc.math.Matrix3.createByTranslation=function(t,e){var i=new cc.math.Matrix3;return i.identity(),i.mat[6]=t,i.mat[7]=e,i},cc.math.Matrix3.createByQuaternion=function(t){if(!t)return null;var e=new cc.math.Matrix3,i=e.mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y-t.w*t.z),i[2]=2*(t.x*t.z+t.w*t.y),i[3]=2*(t.x*t.y+t.w*t.z),i[4]=1-2*(t.x*t.x+t.z*t.z),i[5]=2*(t.y*t.z-t.w*t.x),i[6]=2*(t.x*t.z-t.w*t.y),i[7]=2*(t.y*t.z+t.w*t.x),i[8]=1-2*(t.x*t.x+t.y*t.y),e},r.rotationToAxisAngle=function(){return cc.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}},{}],139:[function(t,e,i){cc.math.Matrix4=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(16)};var r=cc.math.Matrix4.prototype;r.fill=function(t){for(var e=this.mat,i=0;i<16;i++)e[i]=t[i];return this},cc.math.mat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},r.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},r.get=function(t,e){return this.mat[t+4*e]},r.set=function(t,e,i){this.mat[t+4*e]=i},r.swap=function(t,e,i,r){var n=this.mat,s=n[t+4*e];n[t+4*e]=n[i+4*r],n[i+4*r]=s},cc.math.Matrix4._gaussj=function(t,e){var i,r,n,s,o,a,c,h,l,u=0,d=0,_=4,f=4,p=[0,0,0,0],g=[0,0,0,0],m=[0,0,0,0];for(i=0;i<_;i++){for(c=0,r=0;r<_;r++)if(1!==m[r])for(n=0;n<_;n++)0===m[n]&&(a=Math.abs(t.get(r,n)),a>=c&&(c=a,d=r,u=n));if(++m[u],d!==u){for(s=0;s<_;s++)t.swap(d,s,u,s);for(s=0;s<f;s++)e.swap(d,s,u,s)}if(g[i]=d,p[i]=u,0===t.get(u,u))return!1;for(l=1/t.get(u,u),t.set(u,u,1),s=0;s<_;s++)t.set(u,s,t.get(u,s)*l);for(s=0;s<f;s++)e.set(u,s,e.get(u,s)*l);for(o=0;o<_;o++)if(o!==u){for(h=t.get(o,u),t.set(o,u,0),s=0;s<_;s++)t.set(o,s,t.get(o,s)-t.get(u,s)*h);for(s=0;s<f;s++)e.set(o,s,t.get(o,s)-e.get(u,s)*h)}}for(s=_-1;s>=0;s--)if(g[s]!==p[s])for(n=0;n<_;n++)t.swap(n,g[s],n,p[s]);return!0};var n=(new cc.math.Matrix4).identity();cc.math.mat4Inverse=function(t,e){var i=new cc.math.Matrix4(e),r=new cc.math.Matrix4(n);return cc.math.Matrix4._gaussj(i,r)===!1?null:(t.assignFrom(i),t)},r.inverse=function(){var t=new cc.math.Matrix4(this),e=new cc.math.Matrix4(n);return cc.math.Matrix4._gaussj(t,e)===!1?null:t},r.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},r.transpose=function(){var t=this.mat,e=t[1],i=t[2],r=t[3],n=t[4],s=t[6],o=t[7],a=t[8],c=t[9],h=t[11],l=t[12],u=t[13],d=t[14];return t[1]=n,t[2]=a,t[3]=l,t[4]=e,t[6]=c,t[7]=u,t[8]=i,t[9]=s,t[11]=d,t[12]=r,t[13]=o,t[14]=h,this},cc.math.mat4Multiply=function(t,e,i){var r=t.mat,n=e.mat,s=i.mat,o=n[0],a=n[1],c=n[2],h=n[3],l=n[4],u=n[5],d=n[6],_=n[7],f=n[8],p=n[9],g=n[10],m=n[11],v=n[12],y=n[13],C=n[14],T=n[15],E=s[0],x=s[1],b=s[2],S=s[3],A=s[4],R=s[5],O=s[6],I=s[7],w=s[8],P=s[9],L=s[10],N=s[11],F=s[12],D=s[13],M=s[14],B=s[15];return r[0]=E*o+x*l+b*f+S*v,r[1]=E*a+x*u+b*p+S*y,r[2]=E*c+x*d+b*g+S*C,r[3]=E*h+x*_+b*m+S*T,r[4]=A*o+R*l+O*f+I*v,r[5]=A*a+R*u+O*p+I*y,r[6]=A*c+R*d+O*g+I*C,r[7]=A*h+R*_+O*m+I*T,r[8]=w*o+P*l+L*f+N*v,r[9]=w*a+P*u+L*p+N*y,r[10]=w*c+P*d+L*g+N*C,r[11]=w*h+P*_+L*m+N*T,r[12]=F*o+D*l+M*f+B*v,r[13]=F*a+D*u+M*p+B*y,r[14]=F*c+D*d+M*g+B*C,r[15]=F*h+D*_+M*m+B*T,t},r.multiply=function(t){var e=this.mat,i=t.mat,r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=e[9],_=e[10],f=e[11],p=e[12],g=e[13],m=e[14],v=e[15],y=i[0],C=i[1],T=i[2],E=i[3],x=i[4],b=i[5],S=i[6],A=i[7],R=i[8],O=i[9],I=i[10],w=i[11],P=i[12],L=i[13],N=i[14],F=i[15];return e[0]=y*r+C*a+T*u+E*p,e[1]=y*n+C*c+T*d+E*g,e[2]=y*s+C*h+T*_+E*m,e[3]=y*o+C*l+T*f+E*v,e[4]=x*r+b*a+S*u+A*p,e[5]=x*n+b*c+S*d+A*g,e[6]=x*s+b*h+S*_+A*m,e[7]=x*o+b*l+S*f+A*v,e[8]=R*r+O*a+I*u+w*p,e[9]=R*n+O*c+I*d+w*g,e[10]=R*s+O*h+I*_+w*m,e[11]=R*o+O*l+I*f+w*v,e[12]=P*r+L*a+N*u+F*p,e[13]=P*n+L*c+N*d+F*g,e[14]=P*s+L*h+N*_+F*m,e[15]=P*o+L*l+N*f+F*v,this},cc.math.getMat4MultiplyValue=function(t,e){var i=t.mat,r=e.mat,n=new Float32Array(16);return n[0]=i[0]*r[0]+i[4]*r[1]+i[8]*r[2]+i[12]*r[3],n[1]=i[1]*r[0]+i[5]*r[1]+i[9]*r[2]+i[13]*r[3],n[2]=i[2]*r[0]+i[6]*r[1]+i[10]*r[2]+i[14]*r[3],n[3]=i[3]*r[0]+i[7]*r[1]+i[11]*r[2]+i[15]*r[3],n[4]=i[0]*r[4]+i[4]*r[5]+i[8]*r[6]+i[12]*r[7],n[5]=i[1]*r[4]+i[5]*r[5]+i[9]*r[6]+i[13]*r[7],n[6]=i[2]*r[4]+i[6]*r[5]+i[10]*r[6]+i[14]*r[7],n[7]=i[3]*r[4]+i[7]*r[5]+i[11]*r[6]+i[15]*r[7],n[8]=i[0]*r[8]+i[4]*r[9]+i[8]*r[10]+i[12]*r[11],n[9]=i[1]*r[8]+i[5]*r[9]+i[9]*r[10]+i[13]*r[11],n[10]=i[2]*r[8]+i[6]*r[9]+i[10]*r[10]+i[14]*r[11],n[11]=i[3]*r[8]+i[7]*r[9]+i[11]*r[10]+i[15]*r[11],n[12]=i[0]*r[12]+i[4]*r[13]+i[8]*r[14]+i[12]*r[15],n[13]=i[1]*r[12]+i[5]*r[13]+i[9]*r[14]+i[13]*r[15],n[14]=i[2]*r[12]+i[6]*r[13]+i[10]*r[14]+i[14]*r[15],n[15]=i[3]*r[12]+i[7]*r[13]+i[11]*r[14]+i[15]*r[15],n},cc.math.mat4Assign=function(t,e){if(t===e)return cc.log("cc.math.mat4Assign(): pOut equals pIn"),t;var i=t.mat,r=e.mat;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],t},r.assignFrom=function(t){if(this===t)return cc.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix"),this;var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},r.equals=function(t){if(this===t)return cc.log("cc.math.Matrix4 equal: pMat1 and pMat2 are same object."),!0;for(var e=this.mat,i=t.mat,r=cc.math.EPSILON,n=0;n<16;n++)if(!(e[n]+r>i[n]&&e[n]-r<i[n]))return!1;return!0},cc.math.Matrix4.createByRotationX=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=1,i[3]=i[2]=i[1]=0,i[4]=0,i[5]=Math.cos(t),i[6]=Math.sin(t),i[7]=0,i[8]=0,i[9]=-Math.sin(t),i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationY=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[7]=i[6]=i[4]=0,i[5]=1,i[8]=Math.sin(t),i[9]=0,i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationZ=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[3]=i[2]=0,i[4]=-Math.sin(t),i[5]=Math.cos(t),i[7]=i[6]=0,i[11]=i[9]=i[8]=0,i[10]=1,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByPitchYawRoll=function(t,e,i,r){r=r||new cc.math.Matrix4;var n=Math.cos(t),s=Math.sin(t),o=Math.cos(e),a=Math.sin(e),c=Math.cos(i),h=Math.sin(i),l=s*a,u=n*a,d=r.mat;return d[0]=o*c,d[4]=o*h,d[8]=-a,d[1]=l*c-n*h,d[5]=l*h+n*c,d[9]=s*o,d[2]=u*c+s*h,d[6]=u*h-s*c,d[10]=n*o,d[3]=d[7]=d[11]=0,d[15]=1,r},cc.math.Matrix4.createByQuaternion=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y+t.z*t.w),i[2]=2*(t.x*t.z-t.y*t.w),i[3]=0,i[4]=2*(t.x*t.y-t.z*t.w),i[5]=1-2*(t.x*t.x+t.z*t.z),i[6]=2*(t.z*t.y+t.x*t.w),i[7]=0,i[8]=2*(t.x*t.z+t.y*t.w),i[9]=2*(t.y*t.z-t.x*t.w),i[10]=1-2*(t.x*t.x+t.y*t.y),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationTranslation=function(t,e,i){i=i||new cc.math.Matrix4;var r=i.mat,n=t.mat;return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=n[3],r[5]=n[4],r[6]=n[5],r[7]=0,r[8]=n[6],r[9]=n[7],r[10]=n[8],r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,i},cc.math.Matrix4.createByScale=function(t,e,i,r){r=r||new cc.math.Matrix4;var n=r.mat;return n[0]=t,n[5]=e,n[10]=i,n[15]=1,n[1]=n[2]=n[3]=n[4]=n[6]=n[7]=n[8]=n[9]=n[11]=n[12]=n[13]=n[14]=0,r},cc.math.mat4Translation=function(t,e,i,r){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=i,t.mat[14]=r,t},cc.math.Matrix4.createByTranslation=function(t,e,i,r){return r=r||new cc.math.Matrix4,r.identity(),r.mat[12]=t,r.mat[13]=e,r.mat[14]=i,r},r.getUpVec3=function(){var t=this.mat,e=new cc.math.Vec3(t[4],t[5],t[6]);return e.normalize()},r.getRightVec3=function(){var t=this.mat,e=new cc.math.Vec3(t[0],t[1],t[2]);return e.normalize()},r.getForwardVec3=function(){var t=this.mat,e=new cc.math.Vec3(t[8],t[9],t[10]);return e.normalize()},cc.math.mat4PerspectiveProjection=function(t,e,i,r,n){var s=cc.degreesToRadians(e/2),o=n-r,a=Math.sin(s);if(0===o||0===a||0===i)return null;var c=Math.cos(s)/a;return t.identity(),t.mat[0]=c/i,t.mat[5]=c,t.mat[10]=-(n+r)/o,t.mat[11]=-1,t.mat[14]=-2*r*n/o,t.mat[15]=0,t},cc.math.Matrix4.createPerspectiveProjection=function(t,e,i,r){var n=cc.degreesToRadians(t/2),s=r-i,o=Math.sin(n);if(0===s||0===o||0===e)return null;var a=Math.cos(n)/o,c=new cc.math.Matrix4,h=c.mat;return c.identity(),h[0]=a/e,h[5]=a,h[10]=-(r+i)/s,h[11]=-1,h[14]=-2*i*r/s,h[15]=0,c},cc.math.mat4OrthographicProjection=function(t,e,i,r,n,s,o){return t.identity(),t.mat[0]=2/(i-e),t.mat[5]=2/(n-r),t.mat[10]=-2/(o-s),t.mat[12]=-((i+e)/(i-e)),t.mat[13]=-((n+r)/(n-r)),t.mat[14]=-((o+s)/(o-s)),t},cc.math.Matrix4.createOrthographicProjection=function(t,e,i,r,n,s){var o=new cc.math.Matrix4,a=o.mat;return o.identity(),a[0]=2/(e-t),a[5]=2/(r-i),a[10]=-2/(s-n),a[12]=-((e+t)/(e-t)),a[13]=-((r+i)/(r-i)),a[14]=-((s+n)/(s-n)),o},cc.math.mat4LookAt=function(t,e,i,r){var n=new cc.math.Vec3(i),s=new cc.math.Vec3(r);n.subtract(e),n.normalize(),s.normalize();var o=new cc.math.Vec3(n);o.cross(s),o.normalize();var a=new cc.math.Vec3(o);a.cross(n),o.normalize(),t.identity(),t.mat[0]=o.x,t.mat[4]=o.y,t.mat[8]=o.z,t.mat[1]=a.x,t.mat[5]=a.y,t.mat[9]=a.z,t.mat[2]=-n.x,t.mat[6]=-n.y,t.mat[10]=-n.z;var c=cc.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z);return t.multiply(c),t};var s=new cc.math.Matrix4;r.lookAt=function(t,e,i){var r=new cc.math.Vec3(e),n=new cc.math.Vec3(i),o=this.mat;r.subtract(t),r.normalize(),n.normalize();var a=new cc.math.Vec3(r);a.cross(n),a.normalize();var c=new cc.math.Vec3(a);return c.cross(r),a.normalize(),this.identity(),o[0]=a.x,o[4]=a.y,o[8]=a.z,o[1]=c.x,o[5]=c.y,o[9]=c.z,o[2]=-r.x,o[6]=-r.y,o[10]=-r.z,s=cc.math.Matrix4.createByTranslation(-t.x,-t.y,-t.z,s),this.multiply(s),this},cc.math.mat4RotationAxisAngle=function(t,e,i){var r=Math.cos(i),n=Math.sin(i),s=new cc.math.Vec3(e);return s.normalize(),t.mat[0]=r+s.x*s.x*(1-r),t.mat[1]=s.z*n+s.y*s.x*(1-r),t.mat[2]=-s.y*n+s.z*s.x*(1-r),t.mat[3]=0,t.mat[4]=-s.z*n+s.x*s.y*(1-r),t.mat[5]=r+s.y*s.y*(1-r),t.mat[6]=s.x*n+s.z*s.y*(1-r),t.mat[7]=0,t.mat[8]=s.y*n+s.x*s.z*(1-r),t.mat[9]=-s.x*n+s.y*s.z*(1-r),t.mat[10]=r+s.z*s.z*(1-r),t.mat[11]=0,t.mat[12]=0,t.mat[13]=0,t.mat[14]=0,t.mat[15]=1,t},cc.math.Matrix4.createByAxisAndAngle=function(t,e,i){i=i||new cc.math.Matrix4;var r=this.mat,n=Math.cos(e),s=Math.sin(e),o=new cc.math.Vec3(t);return o.normalize(),r[0]=n+o.x*o.x*(1-n),r[1]=o.z*s+o.y*o.x*(1-n),r[2]=-o.y*s+o.z*o.x*(1-n),r[3]=0,r[4]=-o.z*s+o.x*o.y*(1-n),r[5]=n+o.y*o.y*(1-n),r[6]=o.x*s+o.z*o.y*(1-n),r[7]=0,r[8]=o.y*s+o.x*o.z*(1-n),r[9]=-o.x*s+o.y*o.z*(1-n),r[10]=n+o.z*o.z*(1-n),r[11]=0,r[12]=r[13]=r[14]=0,r[15]=1,i},r.extractRotation=function(){var t=new cc.math.Matrix3,e=this.mat,i=t.mat;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],t},r.extractPlane=function(t){var e=new cc.math.Plane,i=this.mat;switch(t){case cc.math.Plane.RIGHT:e.a=i[3]-i[0],e.b=i[7]-i[4],e.c=i[11]-i[8],e.d=i[15]-i[12];break;case cc.math.Plane.LEFT:e.a=i[3]+i[0],e.b=i[7]+i[4],e.c=i[11]+i[8],e.d=i[15]+i[12];break;case cc.math.Plane.BOTTOM:e.a=i[3]+i[1],e.b=i[7]+i[5],e.c=i[11]+i[9],e.d=i[15]+i[13];break;case cc.math.Plane.TOP:e.a=i[3]-i[1],e.b=i[7]-i[5],e.c=i[11]-i[9],e.d=i[15]-i[13];break;case cc.math.Plane.FAR:e.a=i[3]-i[2],e.b=i[7]-i[6],e.c=i[11]-i[10],e.d=i[15]-i[14];break;case cc.math.Plane.NEAR:e.a=i[3]+i[2],e.b=i[7]+i[6],e.c=i[11]+i[10],e.d=i[15]+i[14];break;default:cc.log("cc.math.Matrix4.extractPlane: Invalid plane index")}var r=Math.sqrt(e.a*e.a+e.b*e.b+e.c*e.c);return e.a/=r,e.b/=r,e.c/=r,e.d/=r,e},r.toAxisAndAngle=function(){var t=this.extractRotation(),e=cc.math.Quaternion.rotationMatrix(t);return e.toAxisAndAngle()}},{}],140:[function(t,e,i){cc.math.Plane=function(t,e,i,r){t&&void 0===e?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d):(this.a=t||0,this.b=e||0,this.c=i||0,this.d=r||0)};var r=cc.math.Plane.prototype;cc.math.Plane.LEFT=0,cc.math.Plane.RIGHT=1,cc.math.Plane.BOTTOM=2,cc.math.Plane.TOP=3,cc.math.Plane.NEAR=4,cc.math.Plane.FAR=5,cc.math.Plane.POINT_INFRONT_OF_PLANE=0,cc.math.Plane.POINT_BEHIND_PLANE=1,cc.math.Plane.POINT_ON_PLANE=2,r.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w},r.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},r.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z},cc.math.Plane.fromPointNormal=function(t,e){return new cc.math.Plane(e.x,e.y,e.z,(-e.dot(t)))},cc.math.Plane.fromPoints=function(t,e,i){var r=new cc.math.Vec3(e),n=new cc.math.Vec3(i),s=new cc.math.Plane;return r.subtract(t),n.subtract(t),r.cross(n),r.normalize(),s.a=r.x,s.b=r.y,s.c=r.z,s.d=r.scale(-1).dot(t),s},r.normalize=function(){var t=new cc.math.Vec3(this.a,this.b,this.c),e=1/t.length();return t.normalize(),this.a=t.x,this.b=t.y,this.c=t.z,this.d=this.d*e,this},r.classifyPoint=function(t){var e=this.a*t.x+this.b*t.y+this.c*t.z+this.d;return e>.001?cc.math.Plane.POINT_INFRONT_OF_PLANE:e<-.001?cc.math.Plane.POINT_BEHIND_PLANE:cc.math.Plane.POINT_ON_PLANE}},{}],141:[function(t,e,i){cc.math.Quaternion=function(t,e,i,r){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=r||0)};var r=cc.math.Quaternion.prototype;r.conjugate=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this},r.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},r.exponential=function(){return this},r.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},r.inverse=function(){var t=this.length();return Math.abs(t)>cc.math.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0,this):(this.conjugate(this).scale(1/t),this)},r.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w},r.length=function(){return Math.sqrt(this.lengthSq())},r.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},r.multiply=function(t){var e=this.x,i=this.y,r=this.z,n=this.w;return this.w=n*t.w-e*t.x-i*t.y-r*t.z,this.x=n*t.x+e*t.w+i*t.z-r*t.y,this.y=n*t.y+i*t.w+r*t.x-e*t.z,this.z=n*t.z+r*t.w+e*t.y-i*t.x,this},r.normalize=function(){var t=this.length();if(Math.abs(t)<=cc.math.EPSILON)throw new Error("current quaternion is an invalid value");return this.scale(1/t),this},r.rotationAxis=function(t,e){var i=.5*e,r=Math.sin(i);return this.w=Math.cos(i),this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this},cc.math.Quaternion.rotationMatrix=function(t){if(!t)return null;var e,i,r,n,s=[],o=t.mat,a=0;s[0]=o[0],s[1]=o[3],s[2]=o[6],s[4]=o[1],s[5]=o[4],s[6]=o[7],s[8]=o[2],s[9]=o[5],s[10]=o[8],s[15]=1;var c=s[0],h=c[0]+c[5]+c[10]+1;return h>cc.math.EPSILON?(a=2*Math.sqrt(h),e=(c[9]-c[6])/a,i=(c[2]-c[8])/a,r=(c[4]-c[1])/a,n=.25*a):c[0]>c[5]&&c[0]>c[10]?(a=2*Math.sqrt(1+c[0]-c[5]-c[10]),e=.25*a,i=(c[4]+c[1])/a,r=(c[2]+c[8])/a,n=(c[9]-c[6])/a):c[5]>c[10]?(a=2*Math.sqrt(1+c[5]-c[0]-c[10]),e=(c[4]+c[1])/a,i=.25*a,r=(c[9]+c[6])/a,n=(c[2]-c[8])/a):(a=2*Math.sqrt(1+c[10]-c[0]-c[5]),e=(c[2]+c[8])/a,i=(c[9]+c[6])/a,r=.25*a,n=(c[4]-c[1])/a),new cc.math.Quaternion(e,i,r,n)},cc.math.Quaternion.rotationYawPitchRoll=function(t,e,i){var r,n,s,o,a,c,h,l,u,d,_;r=cc.degreesToRadians(e)/2,n=cc.degreesToRadians(t)/2,s=cc.degreesToRadians(i)/2,o=Math.cos(r),a=Math.cos(n),c=Math.cos(s),h=Math.sin(r),l=Math.sin(n),u=Math.sin(s),d=a*c,_=l*u;var f=new cc.math.Quaternion;return f.w=o*d+h*_,f.x=h*d-o*_,f.y=o*l*c+h*a*u,f.z=o*a*u-h*l*c,f.normalize(),f},r.slerp=function(t,e){if(this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w)return this;var i=this.dot(t),r=Math.acos(i),n=Math.sqrt(1-cc.math.square(i)),s=Math.sin(e*r)/n,o=Math.sin((1-e)*r)/n,a=new cc.math.Quaternion(t);return this.scale(o),a.scale(s),this.add(a),this},r.toAxisAndAngle=function(){var t,e,i,r=new cc.math.Vec3;return t=Math.acos(this.w),e=Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)),e>-cc.math.EPSILON&&e<cc.math.EPSILON||e<2*Math.PI+cc.math.EPSILON&&e>2*Math.PI-cc.math.EPSILON?(i=0,r.x=0,r.y=0,r.z=1):(i=2*t,r.x=this.x/e,r.y=this.y/e,r.z=this.z/e,r.normalize()),{axis:r,angle:i}},r.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},r.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},r.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},cc.math.Quaternion.rotationBetweenVec3=function(t,e,i){var r=new cc.math.Vec3(t),n=new cc.math.Vec3(e);r.normalize(),n.normalize();var s=r.dot(n),o=new cc.math.Quaternion;if(s>=1)return o.identity(),o;if(s<1e-6-1)if(Math.abs(i.lengthSq())<cc.math.EPSILON)o.rotationAxis(i,Math.PI);else{var a=new cc.math.Vec3(1,0,0);a.cross(t),Math.abs(a.lengthSq())<cc.math.EPSILON&&(a.fill(0,1,0),a.cross(t)),a.normalize(),o.rotationAxis(a,Math.PI)}else{var c=Math.sqrt(2*(1+s)),h=1/c;r.cross(n),o.x=r.x*h,o.y=r.y*h,o.z=r.z*h,o.w=.5*c,o.normalize()}return o},r.multiplyVec3=function(t){var e=this.x,i=this.y,r=this.z,n=new cc.math.Vec3(t),s=new cc.math.Vec3(e,i,r),o=new cc.math.Vec3(e,i,r);return s.cross(t),o.cross(s),s.scale(2*q.w),o.scale(2),n.add(s),n.add(o),n}},{}],142:[function(t,e,i){function r(t,e,i){var r=new cc.math.Vec2(e);r.subtract(t),i.x=-r.y,i.y=r.x,i.normalize()}cc.math.Ray2=function(t,e){this.start=t||new cc.math.Vec2,this.dir=e||new cc.math.Vec2},cc.math.Ray2.prototype.fill=function(t,e,i,r){this.start.x=t,this.start.y=e,this.dir.x=i,this.dir.y=r},cc.math.Ray2.prototype.intersectLineSegment=function(t,e,i){var r,n,s,o=this.start.x,a=this.start.y,c=this.start.x+this.dir.x,h=this.start.y+this.dir.y,l=t.x,u=t.y,d=e.x,_=e.y,f=(_-u)*(c-o)-(d-l)*(h-a);return!(f>-cc.math.EPSILON&&f<cc.math.EPSILON)&&(r=((d-l)*(a-u)-(_-u)*(o-l))/f,n=o+r*(c-o),s=a+r*(h-a),!(n<Math.min(t.x,e.x)-cc.math.EPSILON||n>Math.max(t.x,e.x)+cc.math.EPSILON||s<Math.min(t.y,e.y)-cc.math.EPSILON||s>Math.max(t.y,e.y)+cc.math.EPSILON)&&(!(n<Math.min(o,c)-cc.math.EPSILON||n>Math.max(o,c)+cc.math.EPSILON||s<Math.min(a,h)-cc.math.EPSILON||s>Math.max(a,h)+cc.math.EPSILON)&&(i.x=n,i.y=s,!0)))},cc.math.Ray2.prototype.intersectTriangle=function(t,e,i,n,s){var o,a=new cc.math.Vec2,c=new cc.math.Vec2,h=new cc.math.Vec2,l=1e4,u=!1;return this.intersectLineSegment(t,e,a)&&(u=!0,o=a.subtract(this.start).length(),o<l&&(c.x=a.x,c.y=a.y,l=o,r(t,e,h))),this.intersectLineSegment(e,i,a)&&(u=!0,o=a.subtract(this.start).length(),o<l&&(c.x=a.x,c.y=a.y,l=o,r(e,i,h))),this.intersectLineSegment(i,t,a)&&(u=!0,o=a.subtract(this.start).length(),o<l&&(c.x=a.x,c.y=a.y,l=o,r(i,t,h))),u&&(n.x=c.x,n.y=c.y,s&&(s.x=h.x,s.y=h.y)),u}},{}],143:[function(t,e,i){cc.math=cc.math||{},cc.math.EPSILON=1/64,cc.math.square=function(t){return t*t},cc.math.almostEqual=function(t,e){return t+cc.math.EPSILON>e&&t-cc.math.EPSILON<e}},{}],144:[function(t,e,i){cc.math.Vec2=function(t,e){void 0===e?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)};var r=cc.math.Vec2.prototype;r.fill=function(t,e){this.x=t,this.y=e},r.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y))},r.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)},r.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},cc.math.Vec2.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},r.add=function(t){return this.x+=t.x,this.y+=t.y,this},r.dot=function(t){return this.x*t.x+this.y*t.y},cc.math.Vec2.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},r.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},r.transform=function(t){var e=this.x,i=this.y;return this.x=e*t.mat[0]+i*t.mat[3]+t.mat[6],this.y=e*t.mat[1]+i*t.mat[4]+t.mat[7],this},cc.math.Vec2.scale=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},r.scale=function(t){return this.x*=t,this.y*=t,this},r.equals=function(t){return this.x<t.x+cc.math.EPSILON&&this.x>t.x-cc.math.EPSILON&&this.y<t.y+cc.math.EPSILON&&this.y>t.y-cc.math.EPSILON}},{}],145:[function(t,e,i){cc.math.Vec3=cc.math.Vec3=function(t,e,i){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)},cc.math.vec3=function(t,e,i){return new cc.math.Vec3(t,e,i)};var r=cc.math.Vec3.prototype;r.fill=function(t,e,i){return t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),this},r.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z))},r.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)},r.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},r.cross=function(t){var e=this.x,i=this.y,r=this.z;return this.x=i*t.z-r*t.y,this.y=r*t.x-e*t.z,this.z=e*t.y-i*t.x,this},r.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},r.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},r.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},r.transform=function(t){var e=this.x,i=this.y,r=this.z,n=t.mat;return this.x=e*n[0]+i*n[4]+r*n[8]+n[12],this.y=e*n[1]+i*n[5]+r*n[9]+n[13],this.z=e*n[2]+i*n[6]+r*n[10]+n[14],this},r.transformNormal=function(t){var e=this.x,i=this.y,r=this.z,n=t.mat;return this.x=e*n[0]+i*n[4]+r*n[8],this.y=e*n[1]+i*n[5]+r*n[9],this.z=e*n[2]+i*n[6]+r*n[10],this},r.transformCoord=function(t){var e=new cc.math.Vec4(this.x,this.y,this.z,1);return e.transform(t),this.x=e.x/e.w,this.y=e.y/e.w,this.z=e.z/e.w,this},r.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},r.equals=function(t){var e=cc.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e},r.inverseTransform=function(t){var e=t.mat,i=new cc.math.Vec3(this.x-e[12],this.y-e[13],this.z-e[14]);return this.x=i.x*e[0]+i.y*e[1]+i.z*e[2],this.y=i.x*e[4]+i.y*e[5]+i.z*e[6],this.z=i.x*e[8]+i.y*e[9]+i.z*e[10],this},r.inverseTransformNormal=function(t){var e=this.x,i=this.y,r=this.z,n=t.mat;return this.x=e*n[0]+i*n[1]+r*n[2],this.y=e*n[4]+i*n[5]+r*n[6],this.z=e*n[8]+i*n[9]+r*n[10],this},r.assignFrom=function(t){return t?(this.x=t.x,this.y=t.y,this.z=t.z,this):this},cc.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},r.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}},{}],146:[function(t,e,i){cc.math.Vec4=function(t,e,i,r){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=r||0)};var r=cc.math.Vec4.prototype;r.fill=function(t,e,i,r){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t,this.y=e,this.z=i,this.w=r)},r.add=function(t){return t?(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this):this},r.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},r.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w))},r.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w)},r.lerp=function(t,e){return this},r.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},r.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},r.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},r.transform=function(t){var e=this.x,i=this.y,r=this.z,n=this.w,s=t.mat;return this.x=e*s[0]+i*s[4]+r*s[8]+n*s[12],this.y=e*s[1]+i*s[5]+r*s[9]+n*s[13],this.z=e*s[2]+i*s[6]+r*s[10]+n*s[14],this.w=e*s[3]+i*s[7]+r*s[11]+n*s[15],this},cc.math.Vec4.transformArray=function(t,e){for(var i=[],r=0;r<t.length;r++){var n=new cc.math.Vec4(t[r]);n.transform(e),i.push(n)}return i},r.equals=function(t){var e=cc.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e&&this.w<t.w+e&&this.w>t.w-e},r.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},r.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}},{}],147:[function(t,e,i){var r=cc.Class({name:"cc.ParticleAsset","extends":cc.RawAsset});cc.ParticleAsset=e.exports=r},{}],148:[function(t,e,i){var r=cc.BlendFunc.BlendFactor,n=cc.Enum({GRAVITY:0,RADIUS:1}),s=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2}),o={preview:{"default":!0,editorOnly:!0,notify:!1,animatable:!1},_custom:!1,custom:{get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,t?this._applyCustoms():this._applyFile())},animatable:!1},_file:{"default":"",url:cc.ParticleAsset},file:{get:function(){return this._file},set:function(t,e){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)},animatable:!1,url:cc.ParticleAsset},_texture:{"default":"",url:cc.Texture2D},texture:{get:function(){return this._texture},set:function(t){this._texture=t,this._sgNode.texture=t?cc.textureCache.addImage(t):null},url:cc.Texture2D},particleCount:{get:function(){return this._sgNode.particleCount},set:function(t){this._sgNode.particleCount=t},visible:!1},_srcBlendFactor:r.SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t,this._blendFunc.src=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:r},_dstBlendFactor:r.ONE_MINUS_SRC_ALPHA,dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor=t,this._blendFunc.dst=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:r},playOnLoad:!0,_autoRemoveOnFinish:!1,autoRemoveOnFinish:{get:function(){return this._autoRemoveOnFinish},set:function(t){this._autoRemoveOnFinish!==t&&(this._autoRemoveOnFinish=t,this._applyAutoRemove())},animatable:!1},active:{get:function(){return!!this._sgNode&&this._sgNode.isActive()},visible:!1}},a=function(){
for(var t={totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,startColor:cc.Color.WHITE,startColorVar:cc.Color.BLACK,endColor:cc.color(255,255,255,0),endColorVar:cc.color(0,0,0,0),angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.p(0,0),posVar:cc.p(0,0),positionType:s.FREE,emitterMode:n.GRAVITY,gravity:cc.p(0,0),speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0},e=Object.keys(t),i=0;i<e.length;++i){var r=e[i];!function(t,e){var i="_"+t;o[i]=e;var r=e.constructor,n=o[t]={};cc.isChildClassOf(r,cc.ValueType)?(n.get=function(){return new r(this[i])},n.type=r):n.get=function(){return this[i]},cc.isChildClassOf(r,cc.ValueType)?n.set=function(e){this[i]=new r(e),this._sgNode[t]=e}:n.set=function(e){this[i]=e,this._sgNode[t]=e}}(r,t[r])}return e}();o.positionType.type=s,o.emitterMode.type=n;var c=cc.Class({name:"cc.ParticleSystem","extends":cc._RendererUnderSG,editor:!1,ctor:function(){this._previewTimer=null,this._focused=!1,this._willStart=!1,this._blendFunc=new cc.BlendFunc(0,0)},properties:o,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:n,PositionType:s},__preload:function(){this._super(),this.playOnLoad&&this.resetSystem(),this._applyAutoRemove()},onDestroy:function(){this._autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._super()},onFocusInEditor:!1,onLostFocusInEditor:!1,_createSgNode:function(){return new _ccsg.ParticleSystem},_initSgNode:function(){var t=this._sgNode;if(this._file)if(this._custom){var e=!this._texture;e?this._applyFile():this._applyCustoms()}else this._applyFile();else this._custom&&this._applyCustoms();t.stopSystem()},addParticle:function(){return this._sgNode.addParticle()},stopSystem:function(){this._sgNode.stopSystem()},resetSystem:function(){this._sgNode.resetSystem()},isFull:function(){return this.particleCount>=this._totalParticles},setDisplayFrame:function(t){if(t){var e=t.getTexture();e&&(this._texture=e.url),this._sgNode.setDisplayFrame(t)}},setTextureWithRect:function(t,e){t instanceof cc.Texture2D&&(this._texture=t.url),this._sgNode.setTextureWithRect(t,e)},_applyFile:function(){var t=this._sgNode,e=this._file;if(e){var i=this;cc.loader.load(e,function(r,n){if(r||!n)throw r||new Error("Unkown error");t.particleCount=0;var s=t.isActive();t.initWithFile(e),n.textureUuid&&cc.AssetLibrary.queryAssetInfo(n.textureUuid,function(t,e,r){i.texture=e}),n.emissionRate&&(i.emissionRate=n.emissionRate),t.setPosition(0,0),s||t.stopSystem(),i._applyAutoRemove(),i._custom&&i._applyCustoms()})}},_applyCustoms:function(){for(var t=this._sgNode,e=t.isActive(),i=0;i<a.length;i++){var r=a[i];t[r]=this["_"+r]}this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,t.setBlendFunc(this._blendFunc),this._texture&&(t.texture=cc.textureCache.addImage(this._texture)),e||t.stopSystem(),this._applyAutoRemove()},_applyAutoRemove:function(){var t=this._sgNode,e=this._autoRemoveOnFinish;if(t.autoRemoveOnFinish=e,e){cc.assert(!t.onExit);var i=this;t.onExit=function(){_ccsg.Node.prototype.onExit.call(this),i.node.destroy()}}else t.hasOwnProperty("onExit")&&(t.onExit=_ccsg.Node.prototype.onExit)}});cc.ParticleSystem=e.exports=c},{}],149:[function(t,e,i){var r=cc.macro,n=cc.math;cc.GLProgram=cc._Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(t){if(!t)return!1;var e,i=this._hashForUniforms[t];if(i){e=!1;for(var r=arguments.length-1,n=0;n<r;++n)arguments[n+1]!==i[n]&&(i[n]=arguments[n+1],e=!0)}else i=[arguments[1],arguments[2],arguments[3],arguments[4]],this._hashForUniforms[t]=i,e=!0;return e},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){if(!i||!t)return!1;var r=cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n";i=r+"uniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \nuniform sampler2D CC_Texture0;   \n//CC INCLUDES END                \n"+i,this._glContext.shaderSource(t,i),this._glContext.compileShader(t);var n=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS);return n||(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(t)),e===this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog())),n===!0},ctor:function(t,e,i){this._uniforms={},this._hashForUniforms={},this._glContext=i||cc._renderContext,t&&e&&this.init(t,e)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var i=this._glContext;this._programObj=i.createProgram(),this._vertShader=null,this._fragShader=null,t&&(this._vertShader=i.createShader(i.VERTEX_SHADER),this._compileShader(this._vertShader,i.VERTEX_SHADER,t)||cc.log("cocos2d: ERROR: Failed to compile vertex shader")),e&&(this._fragShader=i.createShader(i.FRAGMENT_SHADER),this._compileShader(this._fragShader,i.FRAGMENT_SHADER,e)||cc.log("cocos2d: ERROR: Failed to compile fragment shader")),this._vertShader&&i.attachShader(this._programObj,this._vertShader),cc.checkGLErrorDebug(),this._fragShader&&i.attachShader(this._programObj,this._fragShader);for(var r in this._hashForUniforms)delete this._hashForUniforms[r];return cc.checkGLErrorDebug(),!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=cc.loader.getRes(t);if(!i)throw new Error("Please load the resource firset : "+t);var r=cc.loader.getRes(e);if(!r)throw new Error("Please load the resource firset : "+e);return this.initWithVertexShaderByteArray(i,r)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){if(!this._programObj)return cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1;if(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null,cc.game.config[cc.game.CONFIG_KEY.debugMode]){var t=this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS);if(!t)return cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),cc.gl.deleteProgram(this._programObj),this._programObj=null,!1}return!0},use:function(){cc.gl.useProgram(this._programObj)},updateUniforms:function(){this._uniforms[r.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,r.UNIFORM_PMATRIX_S),this._uniforms[r.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,r.UNIFORM_MVMATRIX_S),this._uniforms[r.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,r.UNIFORM_MVPMATRIX_S),this._uniforms[r.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,r.UNIFORM_TIME_S),this._uniforms[r.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,r.UNIFORM_SINTIME_S),this._uniforms[r.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,r.UNIFORM_COSTIME_S),this._usesTime=null!=this._uniforms[r.UNIFORM_TIME]||null!=this._uniforms[r.UNIFORM_SINTIME]||null!=this._uniforms[r.UNIFORM_COSTIME],this._uniforms[r.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,r.UNIFORM_RANDOM01_S),this._uniforms[r.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,r.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[r.UNIFORM_SAMPLER],0)},_addUniformLocation:function(t){var e=this._glContext.getUniformLocation(this._programObj,t);this._uniforms[t]=e},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");var e=this._uniforms[t]||this._glContext.getUniformLocation(this._programObj,t);return e},getUniformMVPMatrix:function(){return this._uniforms[r.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[r.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(t,e){var i=this._glContext;if("string"==typeof t){var r=this._updateUniformLocation(t,e);if(r){var n=this.getUniformLocationForName(t);i.uniform1i(n,e)}}else i.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){var r=this._glContext;if("string"==typeof t){var n=this._updateUniformLocation(t,e,i);if(n){var s=this.getUniformLocationForName(t);r.uniform2i(s,e,i)}}else r.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,r){var n=this._glContext;if("string"==typeof t){var s=this._updateUniformLocation(t,e,i,r);if(s){var o=this.getUniformLocationForName(t);n.uniform3i(o,e,i,r)}}else n.uniform3i(t,e,i,r)},setUniformLocationWith4i:function(t,e,i,r,n){var s=this._glContext;if("string"==typeof t){var o=this._updateUniformLocation(t,e,i,r,n);if(o){var a=this.getUniformLocationForName(t);s.uniform4i(a,e,i,r,n)}}else s.uniform4i(t,e,i,r,n)},setUniformLocationWith2iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2iv(i,e)},setUniformLocationWith3iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3iv(i,e)},setUniformLocationWith4iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4iv(i,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(t,e)},setUniformLocationWith1f:function(t,e){var i=this._glContext;if("string"==typeof t){var r=this._updateUniformLocation(t,e);if(r){var n=this.getUniformLocationForName(t);i.uniform1f(n,e)}}else i.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){var r=this._glContext;if("string"==typeof t){var n=this._updateUniformLocation(t,e,i);if(n){var s=this.getUniformLocationForName(t);r.uniform2f(s,e,i)}}else r.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,r){var n=this._glContext;if("string"==typeof t){var s=this._updateUniformLocation(t,e,i,r);if(s){var o=this.getUniformLocationForName(t);n.uniform3f(o,e,i,r)}}else n.uniform3f(t,e,i,r)},setUniformLocationWith4f:function(t,e,i,r,n){var s=this._glContext;if("string"==typeof t){var o=this._updateUniformLocation(t,e,i,r,n);if(o){var a=this.getUniformLocationForName(t);s.uniform4f(a,e,i,r,n)}}else s.uniform4f(t,e,i,r,n)},setUniformLocationWith2fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2fv(i,e)},setUniformLocationWith3fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3fv(i,e)},setUniformLocationWith4fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4fv(i,e)},setUniformLocationWithMatrix4fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix4fv(i,!1,e)},setUniformLocationF32:function(){if(!(arguments.length<2))switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},setUniformsForBuiltins:function(){var t=new n.Matrix4,e=new n.Matrix4,i=new n.Matrix4;if(n.glGetMatrix(n.KM_GL_PROJECTION,t),n.glGetMatrix(n.KM_GL_MODELVIEW,e),n.mat4Multiply(i,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[r.UNIFORM_PMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[r.UNIFORM_MVMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[r.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var s=cc.director,o=s.getTotalFrames()*s.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[r.UNIFORM_TIME],o/10,o,2*o,4*o),this.setUniformLocationWith4f(this._uniforms[r.UNIFORM_SINTIME],o/8,o/4,o/2,Math.sin(o)),this.setUniformLocationWith4f(this._uniforms[r.UNIFORM_COSTIME],o/8,o/4,o/2,Math.cos(o))}this._uniforms[r.UNIFORM_RANDOM01]!==-1&&this.setUniformLocationWith4f(this._uniforms[r.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(t&&t._renderCmd){var e=new n.Matrix4,i=new n.Matrix4;if(n.glGetMatrix(n.KM_GL_PROJECTION,e),n.mat4Multiply(i,e,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[r.UNIFORM_PMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[r.UNIFORM_MVMATRIX],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[r.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var s=cc.director,o=s.getTotalFrames()*s.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[r.UNIFORM_TIME],o/10,o,2*o,4*o),this.setUniformLocationWith4f(this._uniforms[r.UNIFORM_SINTIME],o/8,o/4,o/2,Math.sin(o)),this.setUniformLocationWith4f(this._uniforms[r.UNIFORM_COSTIME],o/8,o/4,o/2,Math.cos(o))}this._uniforms[r.UNIFORM_RANDOM01]!==-1&&this.setUniformLocationWith4f(this._uniforms[r.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[r.UNIFORM_MVPMATRIX],!1,n.getMat4MultiplyValue(n.projection_matrix_stack.top,n.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){n.mat4Multiply(t,n.projection_matrix_stack.top,n.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[r.UNIFORM_MVPMATRIX],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[r.UNIFORM_MVMATRIX],!1,n.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[r.UNIFORM_PMATRIX],!1,n.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[r.UNIFORM_MVMATRIX],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[r.UNIFORM_PMATRIX],!1,n.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){this._glContext.uniformMatrix4fv(this._uniforms[r.UNIFORM_PMATRIX],!1,n.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var t in this._hashForUniforms)this._hashForUniforms[t].length=0,delete this._hashForUniforms[t]},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){if(null==cc.GLProgram._highpSupported){var t=cc._renderContext,e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);cc.GLProgram._highpSupported=0!==e.precision}return cc.GLProgram._highpSupported}},{}],150:[function(t,e,i){var r=-1,n=cc.macro,s=n.ENABLE_GL_STATE_CACHE,o=0,a=0,c=null,h=0,l=0,u=0,d=0;if(s){o=16,a=-1,c=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],h=-1,l=-1,u=0,n.TEXTURE_ATLAS_USE_VAO&&(d=0);var _={};if(!window.WebGLRenderingContext)return;WebGLRenderingContext.prototype.glBindBuffer=WebGLRenderingContext.prototype.bindBuffer,WebGLRenderingContext.prototype.bindBuffer=function(t,e){return _[t]===e||(this.glBindBuffer(t,e),_[t]=e,!1)},WebGLRenderingContext.prototype.glEnableVertexAttribArray=WebGLRenderingContext.prototype.enableVertexAttribArray,WebGLRenderingContext.prototype.enableVertexAttribArray=function(t){t===n.VERTEX_ATTRIB_FLAG_POSITION?this._vertexAttribPosition||(this.glEnableVertexAttribArray(t),this._vertexAttribPosition=!0):t===n.VERTEX_ATTRIB_FLAG_COLOR?this._vertexAttribColor||(this.glEnableVertexAttribArray(t),this._vertexAttribColor=!0):t===n.VERTEX_ATTRIB_FLAG_TEX_COORDS?this._vertexAttribTexCoords||(this.glEnableVertexAttribArray(t),this._vertexAttribTexCoords=!0):this.glEnableVertexAttribArray(t)},WebGLRenderingContext.prototype.glDisableVertexAttribArray=WebGLRenderingContext.prototype.disableVertexAttribArray,WebGLRenderingContext.prototype.disableVertexAttribArray=function(t){t===n.VERTEX_ATTRIB_FLAG_COLOR?this._vertexAttribColor&&(this.glDisableVertexAttribArray(t),this._vertexAttribColor=!1):t===n.VERTEX_ATTRIB_FLAG_TEX_COORDS?this._vertexAttribTexCoords&&(this.glDisableVertexAttribArray(t),this._vertexAttribTexCoords=!1):0!==t&&this.glDisableVertexAttribArray(t)}}cc.gl={},cc.gl.invalidateStateCache=function(){if(cc.math.glFreeAll(),r=-1,s){a=-1;for(var t=0;t<o;t++)c[t]=-1;h=-1,l=-1,u=0}},cc.gl.useProgram=s?function(t){t!==a&&(a=t,cc._renderContext.useProgram(t))}:function(t){cc._renderContext.useProgram(t)},cc.gl.deleteProgram=function(t){s&&t===a&&(a=-1),gl.deleteProgram(t)},cc.gl.setBlending=function(t,e){var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),cc._renderContext.blendFunc(t,e))},cc.gl.blendFunc=s?function(t,e){t===h&&e===l||(h=t,l=e,cc.gl.setBlending(t,e))}:cc.gl.setBlending,cc.gl.blendFuncForParticle=function(t,e){if(t!==h||e!==l){h=t,l=e;var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,e,t,e))}},cc.gl.blendResetToCache=function(){var t=cc._renderContext;t.blendEquation(t.FUNC_ADD),s?cc.gl.setBlending(h,l):cc.gl.setBlending(t.BLEND_SRC,t.BLEND_DST)},cc.gl.setProjectionMatrixDirty=function(){r=-1},cc.gl.bindTexture2D=function(t){cc.gl.bindTexture2DN(0,t)},cc.gl.bindTexture2DN=s?function(t,e){if(c[t]!==e){c[t]=e;var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)}}:function(t,e){var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)},cc.gl.deleteTexture2D=function(t){cc.gl.deleteTexture2DN(0,t)},cc.gl.deleteTexture2DN=function(t,e){s&&e===c[t]&&(c[t]=-1),cc._renderContext.deleteTexture(e._webTextureObj)},cc.gl.bindVAO=function(t){n.TEXTURE_ATLAS_USE_VAO&&s&&d!==t&&(d=t)},cc.gl.enable=function(t){}},{}],151:[function(t,e,i){var r=cc.PresetShaders,n=cc.macro;cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_MAX:10,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case this.TYPE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(r.POSITION_TEXTURE_COLOR_VERT,r.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_SPRITE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(r.SPRITE_POSITION_TEXTURE_COLOR_VERT,r.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(r.POSITION_TEXTURE_COLOR_VERT,r.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(r.SPRITE_POSITION_TEXTURE_COLOR_VERT,r.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_COLOR:t.initWithVertexShaderByteArray(r.POSITION_COLOR_VERT,r.POSITION_COLOR_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR);break;case this.TYPE_SPRITE_POSITION_COLOR:t.initWithVertexShaderByteArray(r.SPRITE_POSITION_COLOR_VERT,r.POSITION_COLOR_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR);break;case this.TYPE_POSITION_TEXTURE:t.initWithVertexShaderByteArray(r.POSITION_TEXTURE_VERT,r.POSITION_TEXTURE_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(r.POSITION_TEXTURE_UCOLOR_VERT,r.POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_A8COLOR:t.initWithVertexShaderByteArray(r.POSITION_TEXTURE_A8COLOR_VERT,r.POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_UCOLOR:t.initWithVertexShaderByteArray(r.POSITION_UCOLOR_VERT,r.POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",n.VERTEX_ATTRIB_POSITION);break;case this.TYPE_POSITION_LENGTH_TEXTURECOLOR:t.initWithVertexShaderByteArray(r.POSITION_COLOR_LENGTH_TEXTURE_VERT,r.POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(n.ATTRIBUTE_NAME_POSITION,n.VERTEX_ATTRIB_POSITION),t.addAttribute(n.ATTRIBUTE_NAME_TEX_COORD,n.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(n.ATTRIBUTE_NAME_COLOR,n.VERTEX_ATTRIB_COLOR);break;default:return void cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type")}t.link(),t.updateUniforms()},loadDefaultShaders:function(){var t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),this._programs[n.SHADER_POSITION_TEXTURECOLOR]=t,this._programs.ShaderPositionTextureColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR),this._programs[n.SHADER_SPRITE_POSITION_TEXTURECOLOR]=t,this._programs.ShaderSpritePositionTextureColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[n.SHADER_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderPositionTextureColorAlphaTest=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[n.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderSpritePositionTextureColorAlphaTest=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),this._programs[n.SHADER_POSITION_COLOR]=t,this._programs.ShaderPositionColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_COLOR),this._programs[n.SHADER_SPRITE_POSITION_COLOR]=t,this._programs.ShaderSpritePositionColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),this._programs[n.SHADER_POSITION_TEXTURE]=t,this._programs.ShaderPositionTexture=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),this._programs[n.SHADER_POSITION_TEXTURE_UCOLOR]=t,this._programs.ShaderPositionTextureUColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),this._programs[n.SHADER_POSITION_TEXTUREA8COLOR]=t,this._programs.ShaderPositionTextureA8Color=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR),this._programs[n.SHADER_POSITION_UCOLOR]=t,this._programs.ShaderPositionUColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_LENGTH_TEXTURECOLOR),this._programs[n.SHADER_POSITION_LENGTHTEXTURECOLOR]=t,this._programs.ShaderPositionLengthTextureColor=t},reloadDefaultShaders:function(){var t=this.programForKey(n.SHADER_POSITION_TEXTURECOLOR);t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),t=this.programForKey(n.SHADER_SPRITE_POSITION_TEXTURECOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR),t=this.programForKey(n.SHADER_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(n.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(n.SHADER_POSITION_COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),t=this.programForKey(n.SHADER_POSITION_TEXTURE),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),t=this.programForKey(n.SHADER_POSITION_TEXTURE_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),t=this.programForKey(n.SHADER_POSITION_TEXTUREA8COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),t=this.programForKey(n.SHADER_POSITION_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR)},programForKey:function(t){return this._programs[t]},getProgram:function(t){return this._programs[t]},addProgram:function(t,e){this._programs[e]=t}}},{}],152:[function(t,e,i){cc.PresetShaders={POSITION_UCOLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()                              \n{ \n    gl_FragColor = v_fragmentColor;      \n}\n",POSITION_UCOLOR_VERT:"attribute vec4 a_position;\nuniform    vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor; \nvoid main(void)   \n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize = u_pointSize;          \n    v_fragmentColor = u_color;           \n}",POSITION_COLOR_FRAG:"precision lowp float; \nvarying vec4 v_fragmentColor; \nvoid main() \n{ \n     gl_FragColor = v_fragmentColor; \n} ",POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;             \n}",SPRITE_POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color;             \n}",POSITION_COLOR_LENGTH_TEXTURE_FRAG:"// #extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\t\n{ \n// #if defined GL_OES_standard_derivatives\t\n// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n// #else\t\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord)); \n// #endif \n}",POSITION_COLOR_LENGTH_TEXTURE_VERT:"attribute mediump vec4 a_position; \nattribute mediump vec2 a_texcoord; \nattribute mediump vec4 a_color;\t\nvarying mediump vec4 v_color; \nvarying mediump vec2 v_texcoord;\t\nvoid main() \n{ \n     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n     v_texcoord = a_texcoord; \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n}",POSITION_TEXTURE_FRAG:"precision lowp float;   \nvarying vec2 v_texCoord;  \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n}",POSITION_TEXTURE_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;               \n}",POSITION_TEXTURE_UCOLOR_FRAG:"precision lowp float;  \nuniform vec4 u_color; \nvarying vec2 v_texCoord; \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}",POSITION_TEXTURE_UCOLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;                 \n}",POSITION_TEXTURE_A8COLOR_FRAG:"precision lowp float;  \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    ); \n}",POSITION_TEXTURE_A8COLOR_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",POSITION_TEXTURE_COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n}",POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",SPRITE_POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",POSITION_TEXTURE_COLOR_ALPHATEST_FRAG:"precision lowp float;   \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord;   \nuniform float CC_alpha_value; \nvoid main() \n{  \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);  \n    if ( texColor.a <= CC_alpha_value )          \n        discard; \n    gl_FragColor = texColor * v_fragmentColor;  \n}",EX_SWITCHMASK_FRAG:"precision lowp float; \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform sampler2D u_texture;  \nuniform sampler2D   u_mask;   \nvoid main()  \n{  \n    vec4 texColor   = texture2D(u_texture, v_texCoord);  \n    vec4 maskColor  = texture2D(u_mask, v_texCoord); \n    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    = v_fragmentColor * finalColor; \n}"}},{}],153:[function(t,e,i){t("./CCShaders"),t("./CCShaderCache"),t("./CCGLProgram"),t("./CCGLStateCache")},{"./CCGLProgram":149,"./CCGLStateCache":150,
"./CCShaderCache":151,"./CCShaders":152}],154:[function(t,e,i){var r=cc.Class({name:"cc.TiledLayer","extends":cc._SGComponent,onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null)},_initSgNode:function(){var t=this._sgNode;if(t){this.enabledInHierarchy||t.setVisible(!1),this._registSizeProvider();var e=this.node;t.setAnchorPoint(e.getAnchorPoint())}},_replaceSgNode:function(t){t!==this._sgNode&&(this._removeSgNode(),this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),t&&t instanceof _ccsg.TMXLayer?(this._sgNode=t,this._initSgNode()):this._sgNode=null)},getLayerName:function(){return this._sgNode?this._sgNode.getLayerName():""},setLayerName:function(t){this._sgNode&&this._sgNode.setLayerName(t)},getProperty:function(t){return this._sgNode?this._sgNode.getProperty(t):null},getPositionAt:function(t,e){return this._sgNode?(void 0!==e&&(t=cc.p(t,e)),this._sgNode.getPositionAt(t)):null},removeTileAt:function(t,e){this._sgNode&&(void 0!==e&&(t=cc.p(t,e)),this._sgNode.removeTileAt(t))},setTileGID:function(t,e,i,r){if(this._sgNode){if(!e)throw new Error("_ccsg.TMXLayer.setTileGID(): pos should be non-null");var n;void 0!==r?n=cc.p(e,i):(n=e,r=i),this._sgNode.setTileGID(t,n,r)}},getTileGIDAt:function(t,e){return this._sgNode?(void 0!==e&&(t=cc.p(t,e)),this._sgNode.getTileGIDAt(t)):0},getTileAt:function(t,e){return this._sgNode?(void 0!==e&&(t=cc.p(t,e)),this._sgNode.getTileAt(t)):null},releaseMap:function(){this._sgNode&&this._sgNode.releaseMap()},setContentSize:function(t,e){this._sgNode&&(void 0!==e&&(t=cc.size(t,e)),this._sgNode.setContentSize(t))},getTexture:function(){return this._sgNode?this._sgNode.getTexture():null},setTexture:function(t){this._sgNode&&this._sgNode.setTexture(t)},setTileOpacity:function(t){this._sgNode&&(this._sgNode._opacity=t)},getLayerSize:function(){return this._sgNode?this._sgNode.getLayerSize():cc.size(0,0)},setLayerSize:function(t){this._sgNode&&this._sgNode.setLayerSize(t)},getMapTileSize:function(){return this._sgNode?this._sgNode.getMapTileSize():cc.size(0,0)},setMapTileSize:function(t){this._sgNode&&this._sgNode.setMapTileSize(t)},getTiles:function(){return this._sgNode?this._sgNode.getTiles():null},setTiles:function(t){this._sgNode&&this._sgNode.setTiles(t)},getTileSet:function(){return this._sgNode?this._sgNode.getTileSet():null},setTileSet:function(t){this._sgNode&&this._sgNode.setTileSet(t)},getLayerOrientation:function(){return this._sgNode?this._sgNode.getLayerOrientation():0},setLayerOrientation:function(t){this._sgNode&&this._sgNode.setLayerOrientation(t)},getProperties:function(){return this._sgNode?this._sgNode.getProperties():null},setProperties:function(t){this._sgNode&&this._sgNode.setProperties(t)}});cc.TiledLayer=e.exports=r},{}],155:[function(t,e,i){var r=cc.Class({name:"cc.TiledMapAsset","extends":cc.Asset,properties:{tmxXmlStr:{"default":""},tmxFolderPath:{"default":""},textures:{"default":[],url:[cc.Texture2D]},tsxFiles:{"default":[],url:[cc.RawAsset]}},statics:{preventDeferredLoadDependents:!0},createNode:!1});cc.TiledMapAsset=r,e.exports=r},{}],156:[function(t,e,i){t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle/CCParticleAsset"),t("./cocos2d/particle/CCParticleSystem"),t("./cocos2d/motion-streak/CCMotionStreak"),t("./cocos2d/tilemap/CCTiledMapAsset"),t("./cocos2d/tilemap/CCTiledMap"),t("./cocos2d/tilemap/CCTiledLayer"),t("./extensions/cocostudio/CCStudioComponent"),t("./extensions/spine"),t("./cocos2d/actions"),t("./external/chipmunk/chipmunk.js"),t("./extensions/ccpool/CCNodePool.js"),t("./extensions/ccpool/CCPool.js")},{"./cocos2d/actions":165,"./cocos2d/animation":13,"./cocos2d/core":66,"./cocos2d/motion-streak/CCMotionStreak":165,"./cocos2d/particle/CCParticleAsset":147,"./cocos2d/particle/CCParticleSystem":148,"./cocos2d/tilemap/CCTiledLayer":154,"./cocos2d/tilemap/CCTiledMap":165,"./cocos2d/tilemap/CCTiledMapAsset":155,"./extensions/ccpool/CCNodePool.js":157,"./extensions/ccpool/CCPool.js":158,"./extensions/cocostudio/CCStudioComponent":159,"./extensions/spine":165,"./external/chipmunk/chipmunk.js":160}],157:[function(t,e,i){cc.NodePool=function(t){this.poolHandlerComp=t,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},put:function(t){if(t&&this._pool.indexOf(t)===-1){t.removeFromParent(!1);var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t];this._pool.length=t;var i=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;return i&&i.reuse&&i.reuse.apply(i,arguments),e}},e.exports=cc.NodePool},{}],158:[function(t,e,i){cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var e=void 0!==t._running&&!t._running;cc.director.getScheduler().schedule(this._releaseCB,t,0,0,0,e)},putInPool:function(t){var e=cc.js._getClassId(t.constructor);e&&(this._pool[e]||(this._pool[e]=[]),t.unuse&&t.unuse(),this._pool[e].push(t))},hasObject:function(t){var e=cc.js._getClassId(t),i=this._pool[e];return!(!i||0===i.length)},removeObject:function(t){var e=cc.js._getClassId(t.constructor);if(e){var i=this._pool[e];if(i)for(var r=0;r<i.length;r++)t===i[r]&&i.splice(r,1)}},getFromPool:function(t){if(this.hasObject(t)){var e=cc.js._getClassId(t),i=this._pool[e],r=Array.prototype.slice.call(arguments);r.shift();var n=i.pop();return n.reuse&&n.reuse.apply(n,r),n}},drainAllPools:function(){this._pool={}}}},{}],159:[function(t,e,i){var r=cc.Enum({NONE:0,CHECKBOX:1,TEXT_ATLAS:2,SLIDER_BAR:3,LIST_VIEW:4,PAGE_VIEW:5}),n=cc.Enum({VERTICAL:0,HORIZONTAL:1}),s=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),o=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),a=cc.Class({name:"cc.StudioComponent","extends":cc.Component,editor:!1,properties:!1,statics:{ComponentType:r,ListDirection:n,VerticalAlign:s,HorizontalAlign:o}});cc.StudioComponent=e.exports=a},{}],160:[function(t,e,i){Object.create=Object.create||function(t){function e(){}return e.prototype=t,new e};var r,n,s=function(t,e){if(!t)throw new Error("Assertion failed: "+e)},o=function(t,e){!t&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+e),console.trace&&console.trace())},a=function(t,e){return t<e?t:e},c=function(t,e){return t>e?t:e};"object"==typeof window&&window.navigator.userAgent.indexOf("Firefox")>-1?(r=Math.min,n=Math.max):(r=a,n=c);var h=function(t,e){return t<e?t+" "+e:e+" "+t},l=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return t[i]=t[t.length-1],void t.length--},u=function(t,e,i){var r=A(e,i),n=v(T(r,A(t,i))/D(r));return S(i,O(r,n))},d=function(t,e,i,r,n,s){var o=i-n,a=r-s,c=v(E(o,a,t-n,e-s)/M(o,a));return new y(n+o*c,s+a*c)};cp.momentForCircle=function(t,e,i,r){return t*(.5*(e*e+i*i)+D(r))},cp.areaForCircle=function(t,e){return Math.PI*Math.abs(t*t-e*e)},cp.momentForSegment=function(t,e,i){var r=O(S(e,i),.5);return t*(G(i,e)/12+D(r))},cp.areaForSegment=function(t,e,i){return i*(Math.PI*i+2*k(t,e))},cp.momentForPoly=function(t,e,i){for(var r=0,n=0,s=e.length,o=0;o<s;o+=2){var a=e[o]+i.x,c=e[o+1]+i.y,h=e[(o+2)%s]+i.x,l=e[(o+3)%s]+i.y,u=w(h,l,a,c),d=E(a,c,a,c)+E(a,c,h,l)+E(h,l,h,l);r+=u*d,n+=u}return t*r/(6*n)},cp.areaForPoly=function(t){for(var e=0,i=0,r=t.length;i<r;i+=2)e+=I(new y(t[i],t[i+1]),new y(t[(i+2)%r],t[(i+3)%r]));return-e/2},cp.centroidForPoly=function(t){for(var e=0,i=new y(0,0),r=0,n=t.length;r<n;r+=2){var s=new y(t[r],t[r+1]),o=new y(t[(r+2)%n],t[(r+3)%n]),a=I(s,o);e+=a,i=S(i,O(S(s,o),a))}return O(i,1/(3*e))},cp.recenterPoly=function(t){for(var e=cp.centroidForPoly(t),i=0;i<t.length;i+=2)t[i]-=e.x,t[i+1]-=e.y},cp.momentForBox=function(t,e,i){return t*(e*e+i*i)/12},cp.momentForBox2=function(t,e){var i=e.r-e.l,r=e.t-e.b,n=O([e.l+e.r,e.b+e.t],.5);return cp.momentForBox(t,i,r)+t*D(n)};var _=cp.loopIndexes=function(t){var e,i,r,n,s=0,o=0;e=r=t[0],i=n=t[1];for(var a=t.length>>1,c=1;c<a;c++){var h=t[2*c],l=t[2*c+1];h<e||h==e&&l<i?(e=h,i=l,s=c):(h>r||h==r&&l>n)&&(r=h,n=l,o=c)}return[s,o]},f=function(t,e,i){var r=t[2*e];t[2*e]=t[2*i],t[2*i]=r,r=t[2*e+1],t[2*e+1]=t[2*i+1],t[2*i+1]=r},p=function(t,e,i,r,n,s){if(0===i)return 0;for(var o=0,a=e,c=A(n,r),h=s*x(c),l=e,u=e+i-1;l<=u;){var d=new y(t[2*l],t[2*l+1]),_=I(c,A(d,r));_>h?(_>o&&(o=_,a=l),l++):(f(t,l,u),u--)}return a!=e&&f(t,e,a),l-e},g=function(t,e,i,r,n,s,o,a){if(r<0)return 0;if(0==r)return e[2*a]=s.x,e[2*a+1]=s.y,1;var c=p(e,i,r,n,s,t),h=new y(e[2*i],e[2*i+1]),l=g(t,e,i+1,c-1,n,h,s,a),u=a+l++;e[2*u]=s.x,e[2*u+1]=s.y;var d=p(e,i+c,r-c,s,o,t),_=new y(e[2*(i+c)],e[2*(i+c)+1]);return l+g(t,e,i+c+1,d-1,s,_,o,a+l)};cp.convexHull=function(t,e,i){if(e)for(var r=0;r<t.length;r++)e[r]=t[r];else e=t;var n=_(t),s=n[0],a=n[1];if(s==a)return e.length=2,e;f(e,0,s),f(e,1,0==a?s:a);var c=new y(e[0],e[1]),h=new y(e[2],e[3]),l=t.length>>1,u=g(i,e,2,l-2,c,h,c,1)+1;return e.length=2*u,o(it(e),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),e};var m=function(t,e,i){return r(n(t,e),i)},v=function(t){return n(0,r(t,1))},y=cp.Vect=function(t,e){this.x=t,this.y=e};cp.v=function(t,e){return new y(t,e)};var C=cp.vzero=new y(0,0),T=cp.v.dot=function(t,e){return t.x*e.x+t.y*e.y},E=function(t,e,i,r){return t*i+e*r},x=cp.v.len=function(t){return Math.sqrt(T(t,t))},b=cp.v.len2=function(t,e){return Math.sqrt(t*t+e*e)},S=(cp.v.eql=function(t,e){return t.x===e.x&&t.y===e.y},cp.v.add=function(t,e){return new y(t.x+e.x,t.y+e.y)});y.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};var A=cp.v.sub=function(t,e){return new y(t.x-e.x,t.y-e.y)};y.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};var R=cp.v.neg=function(t){return new y((-t.x),(-t.y))};y.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var O=cp.v.mult=function(t,e){return new y(t.x*e,t.y*e)};y.prototype.mult=function(t){return this.x*=t,this.y*=t,this};var I=cp.v.cross=function(t,e){return t.x*e.y-t.y*e.x},w=function(t,e,i,r){return t*r-e*i},P=cp.v.perp=function(t){return new y((-t.y),t.x)},L=(cp.v.pvrperp=function(t){return new y(t.y,(-t.x))},cp.v.project=function(t,e){return O(e,T(t,e)/D(e))});y.prototype.project=function(t){return this.mult(T(this,t)/D(t)),this};var N=cp.v.rotate=function(t,e){return new y(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};y.prototype.rotate=function(t){return this.x=this.x*t.x-this.y*t.y,this.y=this.x*t.y+this.y*t.x,this};var F=cp.v.unrotate=function(t,e){return new y(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},D=cp.v.lengthsq=function(t){return T(t,t)},M=cp.v.lengthsq2=function(t,e){return t*t+e*e},B=cp.v.lerp=function(t,e,i){return S(O(t,1-i),O(e,i))},U=cp.v.normalize=function(t){return O(t,1/x(t))},V=cp.v.normalize_safe=function(t){return 0===t.x&&0===t.y?C:U(t)},z=cp.v.clamp=function(t,e){return T(t,t)>e*e?O(U(t),e):t},k=(cp.v.lerpconst=function(t,e,i){return S(t,z(A(e,t),i))},cp.v.dist=function(t,e){return x(A(t,e))}),G=cp.v.distsq=function(t,e){return D(A(t,e))},W=(cp.v.near=function(t,e,i){return G(t,e)<i*i},cp.v.slerp=function(t,e,i){var r=Math.acos(T(t,e));if(r){var n=1/Math.sin(r);return S(O(t,Math.sin((1-i)*r)*n),O(e,Math.sin(i*r)*n))}return t}),j=(cp.v.slerpconst=function(t,e,i){var n=Math.acos(T(t,e));return W(t,e,r(i,n)/n)},cp.v.forangle=function(t){return new y(Math.cos(t),Math.sin(t))},cp.v.toangle=function(t){return Math.atan2(t.y,t.x)},cp.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"},0),X=cp.BB=function(t,e,i,r){this.l=t,this.b=e,this.r=i,this.t=r,j++};cp.bb=function(t,e,i,r){return new X(t,e,i,r)};var Y=function(t,e){return new X(t.x-e,t.y-e,t.x+e,t.y+e)},H=function(t,e,i,r,n){return t.l<=r&&e<=t.r&&t.b<=n&&i<=t.t},q=0,Q=(cp.NO_GROUP=0,cp.ALL_LAYERS=-1);cp.resetShapeIdCounter=function(){q=0};var Z=cp.Shape=function(t){this.body=t,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=q++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=C,this.collision_type=0,this.group=0,this.layers=Q,this.space=null,this.collisionCode=this.collisionCode};Z.prototype.setElasticity=function(t){this.e=t},Z.prototype.setFriction=function(t){this.body.activate(),this.u=t},Z.prototype.setLayers=function(t){this.body.activate(),this.layers=t},Z.prototype.setSensor=function(t){this.body.activate(),this.sensor=t},Z.prototype.setCollisionType=function(t){this.body.activate(),this.collision_type=t},Z.prototype.getBody=function(){return this.body},Z.prototype.active=function(){return this.body&&this.body.shapeList.indexOf(this)!==-1},Z.prototype.setBody=function(t){s(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=t},Z.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},Z.prototype.update=function(t,e){s(!isNaN(e.x),"Rotation is NaN"),s(!isNaN(t.x),"Position is NaN"),this.cacheData(t,e)},Z.prototype.pointQuery=function(t){var e=this.nearestPointQuery(t);if(e.d<0)return e},Z.prototype.getBB=function(){return new X(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var K=function(t,e,i){this.shape=t,this.p=e,this.d=i},J=function(t,e,i){this.shape=t,this.t=e,this.n=i};J.prototype.hitPoint=function(t,e){return B(t,e,this.t)},J.prototype.hitDist=function(t,e){return k(t,e)*this.t};var $=cp.CircleShape=function(t,e,i){this.c=this.tc=i,this.r=e,this.type="circle",Z.call(this,t)};$.prototype=Object.create(Z.prototype),$.prototype.cacheData=function(t,e){var i=this.tc=N(this.c,e).add(t),r=this.r;this.bb_l=i.x-r,this.bb_b=i.y-r,this.bb_r=i.x+r,this.bb_t=i.y+r},$.prototype.nearestPointQuery=function(t){var e=t.x-this.tc.x,i=t.y-this.tc.y,r=b(e,i),n=this.r,s=new y(this.tc.x+e*n/r,this.tc.y+i*n/r);return new K(this,s,r-n)};var tt=function(t,e,i,r,n,s){r=A(r,e),n=A(n,e);var o=T(r,r)-2*T(r,n)+T(n,n),a=-2*T(r,r)+2*T(r,n),c=T(r,r)-i*i,h=a*a-4*o*c;if(h>=0){var l=(-a-Math.sqrt(h))/(2*o);if(0<=l&&l<=1)return new J(t,l,U(B(r,n,l)))}};$.prototype.segmentQuery=function(t,e){return tt(this,this.tc,this.r,t,e)};var et=cp.SegmentShape=function(t,e,i,r){this.a=e,this.b=i,this.n=P(U(A(i,e))),this.ta=this.tb=this.tn=null,this.r=r,this.a_tangent=C,this.b_tangent=C,this.type="segment",Z.call(this,t)};et.prototype=Object.create(Z.prototype),et.prototype.cacheData=function(t,e){this.ta=S(t,N(this.a,e)),this.tb=S(t,N(this.b,e)),this.tn=N(this.n,e);var i,r,n,s;this.ta.x<this.tb.x?(i=this.ta.x,r=this.tb.x):(i=this.tb.x,r=this.ta.x),this.ta.y<this.tb.y?(n=this.ta.y,s=this.tb.y):(n=this.tb.y,s=this.ta.y);var o=this.r;this.bb_l=i-o,this.bb_b=n-o,this.bb_r=r+o,this.bb_t=s+o},et.prototype.nearestPointQuery=function(t){var e=u(t,this.ta,this.tb),i=t.x-e.x,r=t.y-e.y,n=b(i,r),s=this.r,o=n?S(e,O(new y(i,r),s/n)):e;return new K(this,o,n-s)},et.prototype.segmentQuery=function(t,e){var i=this.tn,r=T(A(this.ta,t),i),n=this.r,s=r>0?R(i):i,o=A(O(s,n),t),a=S(this.ta,o),c=S(this.tb,o),h=A(e,t);if(I(h,a)*I(h,c)<=0){var l=r+(r>0?-n:n),u=-l,d=T(h,i)-l;if(u*d<0)return new J(this,u/(u-d),s)}else if(0!==n){var _=tt(this,this.ta,this.r,t,e),f=tt(this,this.tb,this.r,t,e);return _?f&&f.t<_.t?f:_:f}},et.prototype.setNeighbors=function(t,e){this.a_tangent=A(t,this.a),this.b_tangent=A(e,this.b)},et.prototype.setEndpoints=function(t,e){this.a=t,this.b=e,this.n=P(U(A(e,t)))};var it=function(t){for(var e=t.length,i=0;i<e;i+=2){var r=t[i],n=t[i+1],s=t[(i+2)%e],o=t[(i+3)%e],a=t[(i+4)%e],c=t[(i+5)%e];if(w(s-r,o-n,a-s,c-o)>0)return!1}return!0},rt=cp.PolyShape=function(t,e,i){this.setVerts(e,i),this.type="poly",Z.call(this,t)};rt.prototype=Object.create(Z.prototype);var nt=function(t,e){this.n=t,this.d=e};nt.prototype.compare=function(t){return T(this.n,t)-this.d},rt.prototype.setVerts=function(t,e){s(t.length>=4,"Polygons require some verts"),s("number"==typeof t[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),s(it(t),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var i=t.length,r=i>>1;this.verts=new Array(i),this.tVerts=new Array(i),this.planes=new Array(r),this.tPlanes=new Array(r);for(var n=0;n<i;n+=2){var o=t[n]+e.x,a=t[n+1]+e.y,c=t[(n+2)%i]+e.x,h=t[(n+3)%i]+e.y,l=U(P(new y(c-o,h-a)));this.verts[n]=o,this.verts[n+1]=a,this.planes[n>>1]=new nt(l,E(l.x,l.y,o,a)),this.tPlanes[n>>1]=new nt(new y(0,0),0)}};var st=(cp.BoxShape=function(t,e,i){var r=e/2,n=i/2;return st(t,new X((-r),(-n),r,n))},cp.BoxShape2=function(t,e){var i=[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b];return new rt(t,i,C)});rt.prototype.transformVerts=function(t,e){for(var i=this.verts,s=this.tVerts,o=1/0,a=-(1/0),c=1/0,h=-(1/0),l=0;l<i.length;l+=2){var u=i[l],d=i[l+1],_=t.x+u*e.x-d*e.y,f=t.y+u*e.y+d*e.x;s[l]=_,s[l+1]=f,o=r(o,_),a=n(a,_),c=r(c,f),h=n(h,f)}this.bb_l=o,this.bb_b=c,this.bb_r=a,this.bb_t=h},rt.prototype.transformAxes=function(t,e){for(var i=this.planes,r=this.tPlanes,n=0;n<i.length;n++){var s=N(i[n].n,e);r[n].n=s,r[n].d=T(t,s)+i[n].d}},rt.prototype.cacheData=function(t,e){this.transformAxes(t,e),this.transformVerts(t,e)},rt.prototype.nearestPointQuery=function(t){for(var e=this.tPlanes,i=this.tVerts,r=i[i.length-2],n=i[i.length-1],s=1/0,o=C,a=!1,c=0;c<e.length;c++){e[c].compare(t)>0&&(a=!0);var h=i[2*c],l=i[2*c+1],u=d(t.x,t.y,r,n,h,l),_=k(t,u);_<s&&(s=_,o=u),r=h,n=l}return new K(this,o,a?s:-s)},rt.prototype.segmentQuery=function(t,e){for(var i=this.tPlanes,r=this.tVerts,n=i.length,s=2*n,o=0;o<n;o++){var a=i[o].n,c=T(t,a);if(!(i[o].d>c)){var h=T(e,a),l=(i[o].d-c)/(h-c);if(!(l<0||1<l)){var u=B(t,e,l),d=-I(a,u),_=-w(a.x,a.y,r[2*o],r[2*o+1]),f=-w(a.x,a.y,r[(2*o+2)%s],r[(2*o+3)%s]);if(_<=d&&d<=f)return new J(this,l,a)}}}},rt.prototype.valueOnAxis=function(t,e){for(var i=this.tVerts,n=E(t.x,t.y,i[0],i[1]),s=2;s<i.length;s+=2)n=r(n,E(t.x,t.y,i[s],i[s+1]));return n-e},rt.prototype.containsVert=function(t,e){for(var i=this.tPlanes,r=0;r<i.length;r++){var n=i[r].n,s=E(n.x,n.y,t,e)-i[r].d;if(s>0)return!1}return!0},rt.prototype.containsVertPartial=function(t,e,i){for(var r=this.tPlanes,n=0;n<r.length;n++){var s=r[n].n;if(!(T(s,i)<0)){var o=E(s.x,s.y,t,e)-r[n].d;if(o>0)return!1}}return!0},rt.prototype.getNumVerts=function(){return this.verts.length/2},rt.prototype.getVert=function(t){return new y(this.verts[2*t],this.verts[2*t+1])};var ot=cp.Body=function(t,e){this.p=new y(0,0),this.vx=this.vy=0,this.f=new y(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(t),this.setMoment(e),this.rot=new y(0,0),this.setAngle(0)},at=function(){var t=new ot(1/0,1/0);return t.nodeIdleTime=1/0,t};if(cp.StaticBody=at,"undefined"!=typeof DEBUG&&DEBUG){var ct=function(t,e){s(t.x==t.x&&t.y==t.y,e)},ht=function(t,e){s(Math.abs(t.x)!==1/0&&Math.abs(t.y)!==1/0,e)},lt=function(t,e){ct(t,e),ht(t,e)};ot.prototype.sanityCheck=function(){s(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),s(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid."),lt(this.p,"Body's position is invalid."),lt(this.f,"Body's force is invalid."),s(this.vx===this.vx&&Math.abs(this.vx)!==1/0,"Body's velocity is invalid."),s(this.vy===this.vy&&Math.abs(this.vy)!==1/0,"Body's velocity is invalid."),s(this.a===this.a&&Math.abs(this.a)!==1/0,"Body's angle is invalid."),s(this.w===this.w&&Math.abs(this.w)!==1/0,"Body's angular velocity is invalid."),s(this.t===this.t&&Math.abs(this.t)!==1/0,"Body's torque is invalid."),lt(this.rot,"Body's rotation vector is invalid."),s(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),s(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else ot.prototype.sanityCheck=function(){};ot.prototype.getPos=function(){return this.p},ot.prototype.getVel=function(){return new y(this.vx,this.vy)},ot.prototype.getAngVel=function(){return this.w},ot.prototype.isSleeping=function(){return null!==this.nodeRoot},ot.prototype.isStatic=function(){return this.nodeIdleTime===1/0},ot.prototype.isRogue=function(){return null===this.space},ot.prototype.setMass=function(t){s(t>0,"Mass must be positive and non-zero."),this.activate(),this.m=t,this.m_inv=1/t},ot.prototype.setMoment=function(t){s(t>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=t,this.i_inv=1/t},ot.prototype.addShape=function(t){this.shapeList.push(t)},ot.prototype.removeShape=function(t){l(this.shapeList,t)};var ut=function(t,e,i){return t===i?t.next(e):(t.a===e?t.next_a=ut(t.next_a,e,i):t.next_b=ut(t.next_b,e,i),t)};ot.prototype.removeConstraint=function(t){this.constraintList=ut(this.constraintList,this,t)},ot.prototype.setPos=function(t){this.activate(),this.sanityCheck(),t===C&&(t=cp.v(0,0)),this.p=t},ot.prototype.setVel=function(t){this.activate(),this.vx=t.x,this.vy=t.y},ot.prototype.setAngVel=function(t){this.activate(),this.w=t},ot.prototype.setAngleInternal=function(t){s(!isNaN(t),"Internal Error: Attempting to set body's angle to NaN"),this.a=t,this.rot.x=Math.cos(t),this.rot.y=Math.sin(t)},ot.prototype.setAngle=function(t){this.activate(),this.sanityCheck(),this.setAngleInternal(t)},ot.prototype.velocity_func=function(t,e,i){var r=this.vx*e+(t.x+this.f.x*this.m_inv)*i,n=this.vy*e+(t.y+this.f.y*this.m_inv)*i,s=this.v_limit,o=r*r+n*n,a=o>s*s?s/Math.sqrt(o):1;this.vx=r*a,this.vy=n*a;var c=this.w_limit;this.w=m(this.w*e+this.t*this.i_inv*i,-c,c),this.sanityCheck()},ot.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t,this.p.y+=(this.vy+this.v_biasy)*t,this.setAngleInternal(this.a+(this.w+this.w_bias)*t),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},ot.prototype.resetForces=function(){this.activate(),this.f=new y(0,0),this.t=0},ot.prototype.applyForce=function(t,e){this.activate(),this.f=S(this.f,t),this.t+=I(e,t)},ot.prototype.applyImpulse=function(t,e){this.activate(),_e(this,t.x,t.y,e)},ot.prototype.getVelAtPoint=function(t){return S(new y(this.vx,this.vy),O(P(t),this.w))},ot.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(A(t,this.p))},ot.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(N(t,this.rot))},ot.prototype.eachShape=function(t){for(var e=0,i=this.shapeList.length;e<i;e++)t(this.shapeList[e])},ot.prototype.eachConstraint=function(t){for(var e=this.constraintList;e;){var i=e.next(this);t(e),e=i}},ot.prototype.eachArbiter=function(t){for(var e=this.arbiterList;e;){var i=e.next(this);e.swappedColl=this===e.body_b,t(e),e=i}},ot.prototype.local2World=function(t){return S(this.p,N(t,this.rot))},ot.prototype.world2Local=function(t){return F(A(t,this.p),this.rot)},ot.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy,e=this.w*this.w;return(t?t*this.m:0)+(e?e*this.i:0)};var dt=cp.SpatialIndex=function(t){if(this.staticIndex=t,t){if(t.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");t.dynamicIndex=this}};dt.prototype.collideStatic=function(t,e){if(t.count>0){var i=t.query;this.each(function(t){i(t,new X(t.bb_l,t.bb_b,t.bb_r,t.bb_t),e)})}};var _t=cp.BBTree=function(t){dt.call(this,t),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};_t.prototype=Object.create(dt.prototype);var ft=0,pt=function(t,e,i){this.obj=null,this.bb_l=r(e.bb_l,i.bb_l),this.bb_b=r(e.bb_b,i.bb_b),this.bb_r=n(e.bb_r,i.bb_r),this.bb_t=n(e.bb_t,i.bb_t),this.parent=null,this.setA(e),this.setB(i)};_t.prototype.makeNode=function(t,e){var i=this.pooledNodes;return i?(this.pooledNodes=i.parent,i.constructor(this,t,e),i):(ft++,new pt(this,t,e))};var gt=0,mt=function(t,e){this.obj=e,t.getBB(e,this),this.parent=null,this.stamp=1,this.pairs=null,gt++};_t.prototype.getBB=function(t,e){var i=this.velocityFunc;if(i){var s=.1,o=(t.bb_r-t.bb_l)*s,a=(t.bb_t-t.bb_b)*s,c=O(i(t),.1);e.bb_l=t.bb_l+r(-o,c.x),e.bb_b=t.bb_b+r(-a,c.y),e.bb_r=t.bb_r+n(o,c.x),e.bb_t=t.bb_t+n(a,c.y)}else e.bb_l=t.bb_l,e.bb_b=t.bb_b,e.bb_r=t.bb_r,e.bb_t=t.bb_t},_t.prototype.getStamp=function(){var t=this.dynamicIndex;return t&&t.stamp?t.stamp:this.stamp},_t.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var vt=0,yt=function(t,e,i,r){this.prevA=null,this.leafA=t,this.nextA=e,this.prevB=null,this.leafB=i,this.nextB=r};_t.prototype.makePair=function(t,e,i,r){var n=this.pooledPairs;return n?(this.pooledPairs=n.prevA,n.prevA=null,n.leafA=t,n.nextA=e,n.prevB=null,n.leafB=i,n.nextB=r,n):(vt++,new yt(t,e,i,r))},yt.prototype.recycle=function(t){this.prevA=t.pooledPairs,t.pooledPairs=this};var Ct=function(t,e,i){i&&(i.leafA===e?i.prevA=t:i.prevB=t),t?t.leafA===e?t.nextA=i:t.nextB=i:e.pairs=i};mt.prototype.clearPairs=function(t){var e,i=this.pairs;for(this.pairs=null;i;)i.leafA===this?(e=i.nextA,Ct(i.prevB,i.leafB,i.nextB)):(e=i.nextB,Ct(i.prevA,i.leafA,i.nextA)),i.recycle(t),i=e};var Tt=function(t,e,i){var r=t.pairs,n=e.pairs,s=i.makePair(t,r,e,n);t.pairs=e.pairs=s,r&&(r.leafA===t?r.prevA=s:r.prevB=s),n&&(n.leafA===e?n.prevA=s:n.prevB=s)};pt.prototype.recycle=function(t){this.parent=t.pooledNodes,t.pooledNodes=this},mt.prototype.recycle=function(t){},pt.prototype.setA=function(t){this.A=t,t.parent=this},pt.prototype.setB=function(t){this.B=t,t.parent=this},mt.prototype.isLeaf=!0,pt.prototype.isLeaf=!1,pt.prototype.otherChild=function(t){return this.A==t?this.B:this.A},pt.prototype.replaceChild=function(t,e,i){o(t==this.A||t==this.B,"Node is not a child of parent."),this.A==t?(this.A.recycle(i),this.setA(e)):(this.B.recycle(i),this.setB(e));for(var s=this;s;s=s.parent){var a=s.A,c=s.B;s.bb_l=r(a.bb_l,c.bb_l),s.bb_b=r(a.bb_b,c.bb_b),s.bb_r=n(a.bb_r,c.bb_r),s.bb_t=n(a.bb_t,c.bb_t)}},pt.prototype.bbArea=mt.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var Et=function(t,e){return(n(t.bb_r,e.bb_r)-r(t.bb_l,e.bb_l))*(n(t.bb_t,e.bb_t)-r(t.bb_b,e.bb_b))},xt=function(t,e){return Math.abs(t.bb_l+t.bb_r-e.bb_l-e.bb_r)+Math.abs(t.bb_b+t.bb_t-e.bb_b-e.bb_t)},bt=function(t,e,i){if(null==t)return e;if(t.isLeaf)return i.makeNode(e,t);var s=t.B.bbArea()+Et(t.A,e),o=t.A.bbArea()+Et(t.B,e);return s===o&&(s=xt(t.A,e),o=xt(t.B,e)),o<s?t.setB(bt(t.B,e,i)):t.setA(bt(t.A,e,i)),t.bb_l=r(t.bb_l,e.bb_l),t.bb_b=r(t.bb_b,e.bb_b),t.bb_r=n(t.bb_r,e.bb_r),t.bb_t=n(t.bb_t,e.bb_t),t};pt.prototype.intersectsBB=mt.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var St=function(t,e,i){t.intersectsBB(e)&&(t.isLeaf?i(t.obj):(St(t.A,e,i),St(t.B,e,i)))},At=function(t,e,i){var s=1/(i.x-e.x),o=t.bb_l==e.x?-(1/0):(t.bb_l-e.x)*s,a=t.bb_r==e.x?1/0:(t.bb_r-e.x)*s,c=r(o,a),h=n(o,a),l=1/(i.y-e.y),u=t.bb_b==e.y?-(1/0):(t.bb_b-e.y)*l,d=t.bb_t==e.y?1/0:(t.bb_t-e.y)*l,_=r(u,d),f=n(u,d);if(_<=h&&c<=f){var p=n(c,_),g=r(h,f);if(0<=g&&p<=1)return n(p,0)}return 1/0},Rt=function(t,e,i,n,s){if(t.isLeaf)return s(t.obj);var o=At(t.A,e,i),a=At(t.B,e,i);return o<a?(o<n&&(n=r(n,Rt(t.A,e,i,n,s))),a<n&&(n=r(n,Rt(t.B,e,i,n,s)))):(a<n&&(n=r(n,Rt(t.B,e,i,n,s))),o<n&&(n=r(n,Rt(t.A,e,i,n,s)))),n};_t.prototype.subtreeRecycle=function(t){t.isLeaf&&(this.subtreeRecycle(t.A),this.subtreeRecycle(t.B),t.recycle(this))};var Ot=function(t,e,i){if(e==t)return null;var r=e.parent;if(r==t){var n=t.otherChild(e);return n.parent=t.parent,t.recycle(i),n}return r.parent.replaceChild(r,r.otherChild(e),i),t},It=function(t,e){return t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t};mt.prototype.markLeafQuery=function(t,e,i,r){It(t,this)&&(e?Tt(t,this,i):(this.stamp<t.stamp&&Tt(this,t,i),r&&r(t.obj,this.obj)))},pt.prototype.markLeafQuery=function(t,e,i,r){It(t,this)&&(this.A.markLeafQuery(t,e,i,r),this.B.markLeafQuery(t,e,i,r))},mt.prototype.markSubtree=function(t,e,i){if(this.stamp==t.getStamp()){e&&e.markLeafQuery(this,!1,t,i);for(var r=this;r.parent;r=r.parent)r==r.parent.A?r.parent.B.markLeafQuery(this,!0,t,i):r.parent.A.markLeafQuery(this,!1,t,i)}else for(var n=this.pairs;n;)this===n.leafB?(i&&i(n.leafA.obj,this.obj),n=n.nextB):n=n.nextA},pt.prototype.markSubtree=function(t,e,i){this.A.markSubtree(t,e,i),this.B.markSubtree(t,e,i)},mt.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t},mt.prototype.update=function(t){var e=t.root,i=this.obj;return!this.containsObj(i)&&(t.getBB(this.obj,this),e=Ot(e,this,t),t.root=bt(e,this,t),this.clearPairs(t),this.stamp=t.getStamp(),!0)},mt.prototype.addPairs=function(t){var e=t.dynamicIndex;if(e){var i=e.root;i&&i.markLeafQuery(this,!0,e,null)}else{var r=t.staticIndex.root;this.markSubtree(t,r,null)}},_t.prototype.insert=function(t,e){var i=new mt(this,t);this.leaves[e]=i,this.root=bt(this.root,i,this),this.count++,i.stamp=this.getStamp(),i.addPairs(this),this.incrementStamp()},_t.prototype.remove=function(t,e){var i=this.leaves[e];delete this.leaves[e],this.root=Ot(this.root,i,this),this.count--,i.clearPairs(this),i.recycle(this)},_t.prototype.contains=function(t,e){return null!=this.leaves[e]};var wt=function(t,e){};_t.prototype.reindexQuery=function(t){if(this.root){var e,i=this.leaves;for(e in i)i[e].update(this);var r=this.staticIndex,n=r&&r.root;this.root.markSubtree(this,n,t),r&&!n&&this.collideStatic(this,r,t),this.incrementStamp()}},_t.prototype.reindex=function(){this.reindexQuery(wt)},_t.prototype.reindexObject=function(t,e){var i=this.leaves[e];i&&(i.update(this)&&i.addPairs(this),this.incrementStamp())},_t.prototype.pointQuery=function(t,e){this.query(new X(t.x,t.y,t.x,t.y),e)},_t.prototype.segmentQuery=function(t,e,i,r){this.root&&Rt(this.root,t,e,i,r)},_t.prototype.query=function(t,e){this.root&&St(this.root,t,e)},_t.prototype.count=function(){return this.count},_t.prototype.each=function(t){var e;for(e in this.leaves)t(this.leaves[e].obj)};var Pt=function(t,e,i,s,o){return(n(t.bb_r,s)-r(t.bb_l,e))*(n(t.bb_t,o)-r(t.bb_b,i))},Lt=function(t,e,i,s){if(1==s)return e[i];if(2==s)return t.makeNode(e[i],e[i+1]);for(var o=e[i],a=o.bb_l,c=o.bb_b,h=o.bb_r,l=o.bb_t,u=i+s,d=i+1;d<u;d++)o=e[d],a=r(a,o.bb_l),c=r(c,o.bb_b),h=n(h,o.bb_r),l=n(l,o.bb_t);var _=h-a>l-c,f=new Array(2*s);if(_)for(var d=i;d<u;d++)f[2*d+0]=e[d].bb_l,f[2*d+1]=e[d].bb_r;else for(var d=i;d<u;d++)f[2*d+0]=e[d].bb_b,f[2*d+1]=e[d].bb_t;f.sort(function(t,e){return t-e});var p=.5*(f[s-1]+f[s]),g=a,m=c,v=h,y=l,C=a,T=c,E=h,x=l;_?v=C=p:y=T=p;for(var b=u,S=i;S<b;){var o=e[S];Pt(o,C,T,E,x)<Pt(o,g,m,v,y)?(b--,e[S]=e[b],e[b]=o):S++}if(b==s){for(var o=null,d=i;d<u;d++)o=bt(o,e[d],t);return o}return NodeNew(t,Lt(t,e,i,b-i),Lt(t,e,b,u-b))};_t.prototype.optimize=function(){var t=new Array(this.count),e=0;for(var i in this.leaves)t[e++]=this.nodes[i];tree.subtreeRecycle(root),this.root=Lt(tree,t,t.length)};var Nt=function(t,e){!t.isLeaf&&e<=10&&(Nt(t.A,e+1),Nt(t.B,e+1));for(var i="",r=0;r<e;r++)i+=" ";console.log(i+t.bb_b+" "+t.bb_t)};_t.prototype.log=function(){this.root&&Nt(this.root,0)};var Ft=cp.CollisionHandler=function(){this.a=this.b=0};Ft.prototype.begin=function(t,e){return!0},Ft.prototype.preSolve=function(t,e){return!0},Ft.prototype.postSolve=function(t,e){},Ft.prototype.separate=function(t,e){};var Dt=function(t,e){this.e=0,this.u=0,this.surface_vr=C,this.a=t,this.body_a=t.body,this.b=e,this.body_b=e.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};Dt.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},Dt.prototype.totalImpulse=function(){for(var t=this.contacts,e=new y(0,0),i=0,r=t.length;i<r;i++){var n=t[i];e.add(O(n.n,n.jnAcc))}return this.swappedColl?e:e.neg()},Dt.prototype.totalImpulseWithFriction=function(){for(var t=this.contacts,e=new y(0,0),i=0,r=t.length;i<r;i++){var n=t[i];e.add(new y(n.jnAcc,n.jtAcc).rotate(n.n))}return this.swappedColl?e:e.neg();
},Dt.prototype.totalKE=function(){for(var t=(1-this.e)/(1+this.e),e=0,i=this.contacts,r=0,n=i.length;r<n;r++){var s=i[r],o=s.jnAcc,a=s.jtAcc;e+=t*o*o/s.nMass+a*a/s.tMass}return e},Dt.prototype.ignore=function(){this.state="ignore"},Dt.prototype.getA=function(){return this.swappedColl?this.b:this.a},Dt.prototype.getB=function(){return this.swappedColl?this.a:this.b},Dt.prototype.isFirstContact=function(){return"first coll"===this.state};var Mt=function(t,e,i){this.point=t,this.normal=e,this.dist=i};Dt.prototype.getContactPointSet=function(){var t,e=new Array(this.contacts.length);for(t=0;t<e.length;t++)e[t]=new Mt(this.contacts[t].p,this.contacts[t].n,this.contacts[t].dist);return e},Dt.prototype.getNormal=function(t){var e=this.contacts[t].n;return this.swappedColl?R(e):e},Dt.prototype.getPoint=function(t){return this.contacts[t].p},Dt.prototype.getDepth=function(t){return this.contacts[t].dist};var Bt=function(t,e,i,r){i?i.body_a===e?i.thread_a_next=r:i.thread_b_next=r:e.arbiterList=r,r&&(r.body_a===e?r.thread_a_prev=i:r.thread_b_prev=i)};Dt.prototype.unthread=function(){Bt(this,this.body_a,this.thread_a_prev,this.thread_a_next),Bt(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},Dt.prototype.update=function(t,e,i,r){if(this.contacts)for(var n=0;n<this.contacts.length;n++)for(var s=this.contacts[n],o=0;o<t.length;o++){var a=t[o];a.hash===s.hash&&(a.jnAcc=s.jnAcc,a.jtAcc=s.jtAcc)}this.contacts=t,this.handler=e,this.swappedColl=i.collision_type!==e.a,this.e=i.e*r.e,this.u=i.u*r.u,this.surface_vr=A(i.surface_v,r.surface_v),this.a=i,this.body_a=i.body,this.b=r,this.body_b=r.body,"cached"==this.state&&(this.state="first coll")},Dt.prototype.preStep=function(t,e,i){for(var n=this.body_a,s=this.body_b,o=0;o<this.contacts.length;o++){var a=this.contacts[o];a.r1=A(a.p,n.p),a.r2=A(a.p,s.p),a.nMass=1/me(n,s,a.r1,a.r2,a.n),a.tMass=1/me(n,s,a.r1,a.r2,P(a.n)),a.bias=-i*r(0,a.dist+e)/t,a.jBias=0,a.bounce=de(n,s,a.r1,a.r2,a.n)*this.e}},Dt.prototype.applyCachedImpulse=function(t){if(!this.isFirstContact())for(var e=this.body_a,i=this.body_b,r=0;r<this.contacts.length;r++){var n=this.contacts[r],s=n.n.x,o=n.n.y,a=s*n.jnAcc-o*n.jtAcc,c=s*n.jtAcc+o*n.jnAcc;fe(e,i,n.r1,n.r2,a*t,c*t)}};var Ut=0,Vt=0;Dt.prototype.applyImpulse=function(){Ut++;for(var t=this.body_a,e=this.body_b,i=this.surface_vr,r=this.u,s=0;s<this.contacts.length;s++){Vt++;var o=this.contacts[s],a=o.nMass,c=o.n,h=o.r1,l=o.r2,u=e.vx-l.y*e.w-(t.vx-h.y*t.w),d=e.vy+l.x*e.w-(t.vy+h.x*t.w),_=c.x*(e.v_biasx-l.y*e.w_bias-t.v_biasx+h.y*t.w_bias)+c.y*(l.x*e.w_bias+e.v_biasy-h.x*t.w_bias-t.v_biasy),f=E(u,d,c.x,c.y),p=E(u+i.x,d+i.y,-c.y,c.x),g=(o.bias-_)*a,v=o.jBias;o.jBias=n(v+g,0);var y=-(o.bounce+f)*a,C=o.jnAcc;o.jnAcc=n(C+y,0);var T=r*o.jnAcc,x=-p*o.tMass,b=o.jtAcc;o.jtAcc=m(b+x,-T,T);var S=c.x*(o.jBias-v),A=c.y*(o.jBias-v);pe(t,-S,-A,h),pe(e,S,A,l);var R=o.jnAcc-C,O=o.jtAcc-b;fe(t,e,h,l,c.x*R-c.y*O,c.x*O+c.y*R)}},Dt.prototype.callSeparate=function(t){var e=t.lookupHandler(this.a.collision_type,this.b.collision_type);e.separate(this,t)},Dt.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var zt=0,kt=function(t,e,i,r){this.p=t,this.n=e,this.dist=i,this.r1=this.r2=C,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=r,zt++},Gt=[],Wt=function(t,e,i,r){var n=i+r,s=A(e,t),o=D(s);if(!(o>=n*n)){var a=Math.sqrt(o);return new kt(S(t,O(s,.5+(i-.5*n)/(a?a:1/0))),a?O(s,1/a):new y(1,0),a-n,0)}},jt=function(t,e){var i=Wt(t.tc,e.tc,t.r,e.r);return i?[i]:Gt},Xt=function(t,e){var i=e.ta,r=e.tb,n=t.tc,s=A(r,i),o=v(T(s,A(n,i))/D(s)),a=S(i,O(s,o)),c=Wt(n,a,t.r,e.r);if(c){var h=c.n;return 0===o&&T(h,e.a_tangent)<0||1===o&&T(h,e.b_tangent)<0?Gt:[c]}return Gt},Yt=0,Ht=function(t,e){var i=0,r=t.valueOnAxis(e[0].n,e[0].d);if(r>0)return-1;for(var n=1;n<e.length;n++){var s=t.valueOnAxis(e[n].n,e[n].d);if(s>0)return-1;s>r&&(r=s,i=n)}return Yt=r,i},qt=function(t,e,i,r){for(var n=[],s=t.tVerts,o=0;o<s.length;o+=2){var a=s[o],c=s[o+1];e.containsVertPartial(a,c,R(i))&&n.push(new kt(new y(a,c),i,r,h(t.hashid,o)))}for(var l=e.tVerts,o=0;o<l.length;o+=2){var a=l[o],c=l[o+1];t.containsVertPartial(a,c,i)&&n.push(new kt(new y(a,c),i,r,h(e.hashid,o)))}return n},Qt=function(t,e,i,r){for(var n=[],s=t.tVerts,o=0;o<s.length;o+=2){var a=s[o],c=s[o+1];e.containsVert(a,c)&&n.push(new kt(new y(a,c),i,r,h(t.hashid,o>>1)))}for(var l=e.tVerts,o=0;o<l.length;o+=2){var a=l[o],c=l[o+1];t.containsVert(a,c)&&n.push(new kt(new y(a,c),i,r,h(e.hashid,o>>1)))}return n.length?n:qt(t,e,i,r)},Zt=function(t,e){var i=Ht(e,t.tPlanes);if(i==-1)return Gt;var r=Yt,n=Ht(t,e.tPlanes);if(n==-1)return Gt;var s=Yt;return r>s?Qt(t,e,t.tPlanes[i].n,r):Qt(t,e,R(e.tPlanes[n].n),s)},Kt=function(t,e,i){var n=T(e,t.ta)-t.r,s=T(e,t.tb)-t.r;return r(n,s)-i},Jt=function(t,e,i,r,n){for(var s=I(e.tn,e.ta),o=I(e.tn,e.tb),a=O(e.tn,n),c=i.tVerts,l=0;l<c.length;l+=2){var u=c[l],d=c[l+1];if(E(u,d,a.x,a.y)<T(e.tn,e.ta)*n+e.r){var _=w(e.tn.x,e.tn.y,u,d);s>=_&&_>=o&&t.push(new kt(new y(u,d),a,r,h(i.hashid,l)))}}},$t=function(t,e){var i=[],r=e.tPlanes,n=r.length,s=T(t.tn,t.ta),o=e.valueOnAxis(t.tn,s)-t.r,a=e.valueOnAxis(R(t.tn),-s)-t.r;if(a>0||o>0)return Gt;var c=0,l=Kt(t,r[0].n,r[0].d);if(l>0)return Gt;for(var u=0;u<n;u++){var d=Kt(t,r[u].n,r[u].d);if(d>0)return Gt;d>l&&(l=d,c=u)}var _=R(r[c].n),f=S(t.ta,O(_,t.r)),p=S(t.tb,O(_,t.r));if(e.containsVert(f.x,f.y)&&i.push(new kt(f,_,l,h(t.hashid,0))),e.containsVert(p.x,p.y)&&i.push(new kt(p,_,l,h(t.hashid,1))),(o>=l||a>=l)&&(o>a?Jt(i,t,e,o,1):Jt(i,t,e,a,-1)),0===i.length){var g,m=2*c,v=e.tVerts,C=new y(v[m],v[m+1]);if(g=Wt(t.ta,C,t.r,0,i))return[g];if(g=Wt(t.tb,C,t.r,0,i))return[g];var E=2*n,x=new y(v[(m+2)%E],v[(m+3)%E]);if(g=Wt(t.ta,x,t.r,0,i))return[g];if(g=Wt(t.tb,x,t.r,0,i))return[g]}return i},te=function(t,e){for(var i=e.tPlanes,r=0,n=T(i[0].n,t.tc)-i[0].d-t.r,s=0;s<i.length;s++){var o=T(i[s].n,t.tc)-i[s].d-t.r;if(o>0)return Gt;o>n&&(n=o,r=s)}var a=i[r].n,c=e.tVerts,h=c.length,l=r<<1,u=c[l],d=c[l+1],_=c[(l+2)%h],f=c[(l+3)%h],p=w(a.x,a.y,u,d),g=w(a.x,a.y,_,f),m=I(a,t.tc);if(m<g){var v=Wt(t.tc,new y(_,f),t.r,0,v);return v?[v]:Gt}if(m<p)return[new kt(A(t.tc,O(a,t.r+n/2)),R(a),n,0)];var v=Wt(t.tc,new y(u,d),t.r,0,v);return v?[v]:Gt};$.prototype.collisionCode=0,et.prototype.collisionCode=1,rt.prototype.collisionCode=2,$.prototype.collisionTable=[jt,Xt,te],et.prototype.collisionTable=[null,function(t,e){return Gt},$t],rt.prototype.collisionTable=[null,null,Zt];var ee=cp.collideShapes=function(t,e){return s(t.collisionCode<=e.collisionCode,"Collided shapes must be sorted by type"),t.collisionTable[e.collisionCode](t,e)},ie=new Ft,re=cp.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new _t(null),this.activeShapes=new _t(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=ie,this.postStepCallbacks=[],this.iterations=10,this.gravity=C,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new ot(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};re.prototype.getCurrentTimeStep=function(){return this.curr_dt},re.prototype.setIterations=function(t){this.iterations=t},re.prototype.isLocked=function(){return this.locked};var ne=function(t){s(!t.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};re.prototype.addCollisionHandler=function(t,e,i,r,n,s){ne(this),this.removeCollisionHandler(t,e);var o=new Ft;o.a=t,o.b=e,i&&(o.begin=i),r&&(o.preSolve=r),n&&(o.postSolve=n),s&&(o.separate=s),this.collisionHandlers[h(t,e)]=o},re.prototype.removeCollisionHandler=function(t,e){ne(this),delete this.collisionHandlers[h(t,e)]},re.prototype.setDefaultCollisionHandler=function(t,e,i,r){ne(this);var n=new Ft;t&&(n.begin=t),e&&(n.preSolve=e),i&&(n.postSolve=i),r&&(n.separate=r),this.defaultHandler=n},re.prototype.lookupHandler=function(t,e){return this.collisionHandlers[h(t,e)]||this.defaultHandler},re.prototype.addShape=function(t){var e=t.body;return e.isStatic()?this.addStaticShape(t):(s(!t.space,"This shape is already added to a space and cannot be added to another."),ne(this),e.activate(),e.addShape(t),t.update(e.p,e.rot),this.activeShapes.insert(t,t.hashid),t.space=this,t)},re.prototype.addStaticShape=function(t){s(!t.space,"This shape is already added to a space and cannot be added to another."),ne(this);var e=t.body;return e.addShape(t),t.update(e.p,e.rot),this.staticShapes.insert(t,t.hashid),t.space=this,t},re.prototype.addBody=function(t){return s(!t.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),s(!t.space,"This body is already added to a space and cannot be added to another."),ne(this),this.bodies.push(t),t.space=this,t},re.prototype.addConstraint=function(t){s(!t.space,"This shape is already added to a space and cannot be added to another."),ne(this);var e=t.a,i=t.b;return e.activate(),i.activate(),this.constraints.push(t),t.next_a=e.constraintList,e.constraintList=t,t.next_b=i.constraintList,i.constraintList=t,t.space=this,t},re.prototype.filterArbiters=function(t,e){for(var i in this.cachedArbiters){var r=this.cachedArbiters[i];(t!==r.body_a||e!==r.a&&null!==e)&&(t!==r.body_b||e!==r.b&&null!==e)||(e&&"cached"!==r.state&&r.callSeparate(this),r.unthread(),l(this.arbiters,r),delete this.cachedArbiters[i])}},re.prototype.removeShape=function(t){var e=t.body;e.isStatic()?this.removeStaticShape(t):(s(this.containsShape(t),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),ne(this),e.activate(),e.removeShape(t),this.filterArbiters(e,t),this.activeShapes.remove(t,t.hashid),t.space=null)},re.prototype.removeStaticShape=function(t){s(this.containsShape(t),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),ne(this);var e=t.body;e.isStatic()&&e.activateStatic(t),e.removeShape(t),this.filterArbiters(e,t),this.staticShapes.remove(t,t.hashid),t.space=null},re.prototype.removeBody=function(t){s(this.containsBody(t),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),ne(this),t.activate(),l(this.bodies,t),t.space=null},re.prototype.removeConstraint=function(t){s(this.containsConstraint(t),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),ne(this),t.a.activate(),t.b.activate(),l(this.constraints,t),t.a.removeConstraint(t),t.b.removeConstraint(t),t.space=null},re.prototype.containsShape=function(t){return t.space===this},re.prototype.containsBody=function(t){return t.space==this},re.prototype.containsConstraint=function(t){return t.space==this},re.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[h(t.a.hashid,t.b.hashid)],l(this.arbiters,t)},re.prototype.eachBody=function(t){this.lock();for(var e=this.bodies,i=0;i<e.length;i++)t(e[i]);for(var r=this.sleepingComponents,i=0;i<r.length;i++)for(var n=r[i],s=n;s;){var o=s.nodeNext;t(s),s=o}this.unlock(!0)},re.prototype.eachShape=function(t){this.lock(),this.activeShapes.each(t),this.staticShapes.each(t),this.unlock(!0)},re.prototype.eachConstraint=function(t){this.lock();for(var e=this.constraints,i=0;i<e.length;i++)t(e[i]);this.unlock(!0)},re.prototype.reindexStatic=function(){s(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(t){var e=t.body;t.update(e.p,e.rot)}),this.staticShapes.reindex()},re.prototype.reindexShape=function(t){s(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var e=t.body;t.update(e.p,e.rot),this.activeShapes.reindexObject(t,t.hashid),this.staticShapes.reindexObject(t,t.hashid)},re.prototype.reindexShapesForBody=function(t){for(var e=t.shapeList;e;e=e.next)this.reindexShape(e)},re.prototype.useSpatialHash=function(t,e){throw new Error("Spatial Hash not implemented.")},re.prototype.activateBody=function(t){if(s(!t.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked)this.rousedBodies.indexOf(t)===-1&&this.rousedBodies.push(t);else{this.bodies.push(t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.staticShapes.remove(i,i.hashid),this.activeShapes.insert(i,i.hashid)}for(var r=t.arbiterList;r;r=r.next(t)){var n=r.body_a;if(t===n||n.isStatic()){var o=r.a,a=r.b;this.cachedArbiters[h(o.hashid,a.hashid)]=r,r.stamp=this.stamp,r.handler=this.lookupHandler(o.collision_type,a.collision_type),this.arbiters.push(r)}}for(var c=t.constraintList;c;c=c.nodeNext){var n=c.a;(t===n||n.isStatic())&&this.constraints.push(c)}}},re.prototype.deactivateBody=function(t){s(!t.isRogue(),"Internal error: Attempting to deactivate a rogue body."),l(this.bodies,t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.activeShapes.remove(i,i.hashid),this.staticShapes.insert(i,i.hashid)}for(var r=t.arbiterList;r;r=r.next(t)){var n=r.body_a;(t===n||n.isStatic())&&this.uncacheArbiter(r)}for(var o=t.constraintList;o;o=o.nodeNext){var n=o.a;(t===n||n.isStatic())&&l(this.constraints,o)}};var se=function(t){return t?t.nodeRoot:null},oe=function(t){if(t&&t.isSleeping(t)){s(!t.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var e=t.space,i=t;i;){var r=i.nodeNext;i.nodeIdleTime=0,i.nodeRoot=null,i.nodeNext=null,e.activateBody(i),i=r}l(e.sleepingComponents,t)}};ot.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,oe(se(this)))},ot.prototype.activateStatic=function(t){s(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var e=this.arbiterList;e;e=e.next(this))t&&t!=e.a&&t!=e.b||(e.body_a==this?e.body_b:e.body_a).activate()},ot.prototype.pushArbiter=function(t){o(null===(t.body_a===this?t.thread_a_next:t.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),o(null===(t.body_a===this?t.thread_a_prev:t.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;o(null===e||null===(e.body_a===this?e.thread_a_prev:e.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),t.body_a===this?t.thread_a_next=e:t.thread_b_next=e,e&&(e.body_a===this?e.thread_a_prev=t:e.thread_b_prev=t),this.arbiterList=t};var ae=function(t,e){e.nodeRoot=t,e!==t&&(e.nodeNext=t.nodeNext,t.nodeNext=e)},ce=function(t,e){if(!e.isRogue()){var i=se(e);if(null==i){ae(t,e);for(var r=e.arbiterList;r;r=r.next(e))ce(t,e==r.body_a?r.body_b:r.body_a);for(var n=e.constraintList;n;n=n.next(e))ce(t,e==n.a?n.b:n.a)}else o(i===t,"Internal Error: Inconsistency detected in the contact graph.")}},he=function(t,e){for(var i=t;i;i=i.nodeNext)if(i.nodeIdleTime<e)return!0;return!1};re.prototype.processComponents=function(t){for(var e=this.sleepTimeThreshold!==1/0,i=this.bodies,r=0;r<i.length;r++){var n=i[r];o(null===n.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),o(null===n.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(e)for(var s=this.idleSpeedThreshold,a=s?s*s:D(this.gravity)*t*t,r=0;r<i.length;r++){var n=i[r],c=a?n.m*a:0;n.nodeIdleTime=n.kineticEnergy()>c?0:n.nodeIdleTime+t}for(var h=this.arbiters,r=0,l=h.length;r<l;r++){var u=h[r],d=u.body_a,_=u.body_b;e&&((_.isRogue()&&!_.isStatic()||d.isSleeping())&&d.activate(),(d.isRogue()&&!d.isStatic()||_.isSleeping())&&_.activate()),d.pushArbiter(u),_.pushArbiter(u)}if(e){for(var f=this.constraints,r=0;r<f.length;r++){var p=f[r],d=p.a,_=p.b;_.isRogue()&&!_.isStatic()&&d.activate(),d.isRogue()&&!d.isStatic()&&_.activate()}for(var r=0;r<i.length;){var n=i[r];if(null!==se(n)||(ce(n,n),he(n,this.sleepTimeThreshold)))r++,n.nodeRoot=null,n.nodeNext=null;else{this.sleepingComponents.push(n);for(var g=n;g;g=g.nodeNext)this.deactivateBody(g)}}}},ot.prototype.sleep=function(){this.sleepWithGroup(null)},ot.prototype.sleepWithGroup=function(t){s(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var e=this.space;if(s(e,"Cannot put a rogue body to sleep."),s(!e.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),s(null===t||t.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping())return void s(se(this)===se(t),"The body is already sleeping and it's group cannot be reassigned.");for(var i=0;i<this.shapeList.length;i++)this.shapeList[i].update(this.p,this.rot);if(e.deactivateBody(this),t){var r=se(t);this.nodeRoot=r,this.nodeNext=r.nodeNext,this.nodeIdleTime=0,r.nodeNext=this}else this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,e.sleepingComponents.push(this);l(e.bodies,this)},re.prototype.activateShapesTouchingShape=function(t){this.sleepTimeThreshold!==1/0&&this.shapeQuery(t,function(t,e){t.body.activate()})},re.prototype.pointQuery=function(t,e,i,r){var n=function(n){(!n.group||i!==n.group)&&e&n.layers&&n.pointQuery(t)&&r(n)},s=new X(t.x,t.y,t.x,t.y);this.lock(),this.activeShapes.query(s,n),this.staticShapes.query(s,n),this.unlock(!0)},re.prototype.pointQueryFirst=function(t,e,i){var r=null;return this.pointQuery(t,e,i,function(t){t.sensor||(r=t)}),r},re.prototype.nearestPointQuery=function(t,e,i,r,n){var s=function(s){if((!s.group||r!==s.group)&&i&s.layers){var o=s.nearestPointQuery(t);o.d<e&&n(s,o.d,o.p)}},o=Y(t,e);this.lock(),this.activeShapes.query(o,s),this.staticShapes.query(o,s),this.unlock(!0)},re.prototype.nearestPointQueryNearest=function(t,e,i,r){var n,s=function(s){if((!s.group||r!==s.group)&&i&s.layers&&!s.sensor){var o=s.nearestPointQuery(t);o.d<e&&(!n||o.d<n.d)&&(n=o)}},o=Y(t,e);return this.activeShapes.query(o,s),this.staticShapes.query(o,s),n},re.prototype.segmentQuery=function(t,e,i,r,n){var s=function(s){var o;return(!s.group||r!==s.group)&&i&s.layers&&(o=s.segmentQuery(t,e))&&n(s,o.t,o.n),1};this.lock(),this.staticShapes.segmentQuery(t,e,1,s),this.activeShapes.segmentQuery(t,e,1,s),this.unlock(!0)},re.prototype.segmentQueryFirst=function(t,e,i,r){var n=null,s=function(s){var o;return(!s.group||r!==s.group)&&i&s.layers&&!s.sensor&&(o=s.segmentQuery(t,e))&&(null===n||o.t<n.t)&&(n=o),n?n.t:1};return this.staticShapes.segmentQuery(t,e,1,s),this.activeShapes.segmentQuery(t,e,n?n.t:1,s),n},re.prototype.bbQuery=function(t,e,i,r){var n=function(n){(!n.group||i!==n.group)&&e&n.layers&&H(t,n.bb_l,n.bb_b,n.bb_r,n.bb_t)&&r(n)};this.lock(),this.activeShapes.query(t,n),this.staticShapes.query(t,n),this.unlock(!0)},re.prototype.shapeQuery=function(t,e){var i=t.body;i&&t.update(i.p,i.rot);var r=new X(t.bb_l,t.bb_b,t.bb_r,t.bb_t),n=!1,s=function(i){var r=t;if((!r.group||r.group!==i.group)&&r.layers&i.layers&&r!==i){var s;if(r.collisionCode<=i.collisionCode)s=ee(r,i);else{s=ee(i,r);for(var o=0;o<s.length;o++)s[o].n=R(s[o].n)}if(s.length&&(n=!(r.sensor||i.sensor),e)){for(var a=new Array(s.length),o=0;o<s.length;o++)a[o]=new Mt(s[o].p,s[o].n,s[o].dist);e(i,a)}}};return this.lock(),this.activeShapes.query(r,s),this.staticShapes.query(r,s),this.unlock(!0),n},re.prototype.addPostStepCallback=function(t){o(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(t)},re.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++)this.postStepCallbacks[t]();this.postStepCallbacks=[]},re.prototype.lock=function(){this.locked++},re.prototype.unlock=function(t){if(this.locked--,s(this.locked>=0,"Internal Error: Space lock underflow."),0===this.locked&&t){for(var e=this.rousedBodies,i=0;i<e.length;i++)this.activateBody(e[i]);e.length=0,this.runPostStepCallbacks()}},re.prototype.makeCollideShapes=function(){var t=this;return function(e,i){var r=t;if(e.bb_l<=i.bb_r&&i.bb_l<=e.bb_r&&e.bb_b<=i.bb_t&&i.bb_b<=e.bb_t&&e.body!==i.body&&(!e.group||e.group!==i.group)&&e.layers&i.layers){var n=r.lookupHandler(e.collision_type,i.collision_type),s=e.sensor||i.sensor;if(!s||n!==ie){if(e.collisionCode>i.collisionCode){var o=e;e=i,i=o}var a=ee(e,i);if(0!==a.length){var c=h(e.hashid,i.hashid),l=r.cachedArbiters[c];l||(l=r.cachedArbiters[c]=new Dt(e,i)),l.update(a,n,e,i),"first coll"!=l.state||n.begin(l,r)||l.ignore(),"ignore"!==l.state&&n.preSolve(l,r)&&!s?r.arbiters.push(l):(l.contacts=null,"ignore"!==l.state&&(l.state="normal")),l.stamp=r.stamp}}}}},re.prototype.arbiterSetFilter=function(t){var e=this.stamp-t.stamp,i=t.body_a,r=t.body_b;return!(!i.isStatic()&&!i.isSleeping()||!r.isStatic()&&!r.isSleeping())||(e>=1&&"cached"!=t.state&&(t.callSeparate(this),t.state="cached"),!(e>=this.collisionPersistence)||(t.contacts=null,!1))};var le=function(t){var e=t.body;t.update(e.p,e.rot)};re.prototype.step=function(t){if(0!==t){s(0===C.x&&0===C.y,"vzero is invalid"),this.stamp++;var e=this.curr_dt;this.curr_dt=t;var i,r,n,o=this.bodies,a=this.constraints,c=this.arbiters;for(i=0;i<c.length;i++){var h=c[i];h.state="normal",h.body_a.isSleeping()||h.body_b.isSleeping()||h.unthread()}for(c.length=0,this.lock(),i=0;i<o.length;i++)o[i].position_func(t);this.activeShapes.each(le),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(t),this.lock();for(n in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[n])||delete this.cachedArbiters[n];var l=this.collisionSlop,u=1-Math.pow(this.collisionBias,t);for(i=0;i<c.length;i++)c[i].preStep(t,l,u);for(i=0;i<a.length;i++){var d=a[i];d.preSolve(this),d.preStep(t)}var _=Math.pow(this.damping,t),f=this.gravity;for(i=0;i<o.length;i++)o[i].velocity_func(f,_,t);var p=0===e?0:t/e;for(i=0;i<c.length;i++)c[i].applyCachedImpulse(p);for(i=0;i<a.length;i++)a[i].applyCachedImpulse(p);for(i=0;i<this.iterations;i++){for(r=0;r<c.length;r++)c[r].applyImpulse();for(r=0;r<a.length;r++)a[r].applyImpulse()}for(i=0;i<a.length;i++)a[i].postSolve(this);for(i=0;i<c.length;i++)c[i].handler.postSolve(c[i],this);this.unlock(!0)}};var ue=function(t,e,i,r){var n=t.vx+-i.y*t.w,s=t.vy+i.x*t.w,o=e.vx+-r.y*e.w,a=e.vy+r.x*e.w;return new y(o-n,a-s)},de=function(t,e,i,r,n){var s=t.vx+-i.y*t.w,o=t.vy+i.x*t.w,a=e.vx+-r.y*e.w,c=e.vy+r.x*e.w;return E(a-s,c-o,n.x,n.y)},_e=function(t,e,i,r){t.vx+=e*t.m_inv,t.vy+=i*t.m_inv,t.w+=t.i_inv*(r.x*i-r.y*e)},fe=function(t,e,i,r,n,s){_e(t,-n,-s,i),_e(e,n,s,r)},pe=function(t,e,i,r){t.v_biasx+=e*t.m_inv,t.v_biasy+=i*t.m_inv,t.w_bias+=t.i_inv*w(r.x,r.y,e,i)},ge=function(t,e,i){var r=I(e,i);return t.m_inv+t.i_inv*r*r},me=function(t,e,i,r,n){var s=ge(t,i,n)+ge(e,r,n);return o(0!==s,"Unsolvable collision or constraint."),s},ve=function(t,e,i,r,n,s){var a,c,h,l,u=t.m_inv+e.m_inv;a=u,c=0,h=0,l=u;var d=t.i_inv,_=i.x*i.x*d,f=i.y*i.y*d,p=-i.x*i.y*d;a+=f,c+=p,h+=p,l+=_;var g=e.i_inv,m=r.x*r.x*g,v=r.y*r.y*g,y=-r.x*r.y*g;a+=v,c+=y,h+=y,l+=m;var C=a*l-c*h;o(0!==C,"Unsolvable constraint.");var T=1/C;n.x=l*T,n.y=-c*T,s.x=-h*T,s.y=a*T},ye=function(t,e,i){return new y(T(t,e),T(t,i))},Ce=function(t,e){return 1-Math.pow(t,e)},Te=cp.Constraint=function(t,e){this.a=t,this.b=e,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};Te.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},Te.prototype.preStep=function(t){},Te.prototype.applyCachedImpulse=function(t){},Te.prototype.applyImpulse=function(){},Te.prototype.getImpulse=function(){return 0},Te.prototype.preSolve=function(t){},Te.prototype.postSolve=function(t){},Te.prototype.next=function(t){return this.a===t?this.next_a:this.next_b};var Ee=cp.PinJoint=function(t,e,i,r){Te.call(this,t,e),this.anchr1=i,this.anchr2=r;var n=t?S(t.p,N(i,t.rot)):i,s=e?S(e.p,N(r,e.rot)):r;this.dist=x(A(s,n)),o(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Ee.prototype=Object.create(Te.prototype),Ee.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=N(this.anchr1,e.rot),this.r2=N(this.anchr2,i.rot);var r=A(S(i.p,this.r2),S(e.p,this.r1)),n=x(r);this.n=O(r,1/(n?n:1/0)),this.nMass=1/me(e,i,this.r1,this.r2,this.n);var s=this.maxBias;this.bias=m(-Ce(this.errorBias,t)*(n-this.dist)/t,-s,s),this.jnMax=this.maxForce*t},Ee.prototype.applyCachedImpulse=function(t){var e=O(this.n,this.jnAcc*t);fe(this.a,this.b,this.r1,this.r2,e.x,e.y)},Ee.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,r=de(t,e,this.r1,this.r2,i),n=(this.bias-r)*this.nMass,s=this.jnAcc;this.jnAcc=m(s+n,-this.jnMax,this.jnMax),n=this.jnAcc-s,fe(t,e,this.r1,this.r2,i.x*n,i.y*n)},Ee.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var xe=cp.SlideJoint=function(t,e,i,r,n,s){Te.call(this,t,e),this.anchr1=i,this.anchr2=r,this.min=n,this.max=s,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};xe.prototype=Object.create(Te.prototype),xe.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=N(this.anchr1,e.rot),this.r2=N(this.anchr2,i.rot);var r=A(S(i.p,this.r2),S(e.p,this.r1)),n=x(r),s=0;n>this.max?(s=n-this.max,this.n=V(r)):n<this.min?(s=this.min-n,this.n=R(V(r))):(this.n=C,this.jnAcc=0),this.nMass=1/me(e,i,this.r1,this.r2,this.n);var o=this.maxBias;this.bias=m(-Ce(this.errorBias,t)*s/t,-o,o),this.jnMax=this.maxForce*t},xe.prototype.applyCachedImpulse=function(t){var e=this.jnAcc*t;fe(this.a,this.b,this.r1,this.r2,this.n.x*e,this.n.y*e)},xe.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var t=this.a,e=this.b,i=this.n,r=this.r1,n=this.r2,s=ue(t,e,r,n),o=T(s,i),a=(this.bias-o)*this.nMass,c=this.jnAcc;this.jnAcc=m(c+a,-this.jnMax,0),a=this.jnAcc-c,fe(t,e,this.r1,this.r2,i.x*a,i.y*a)}},xe.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var be=cp.PivotJoint=function(t,e,i,r){if(Te.call(this,t,e),"undefined"==typeof r){var n=i;i=t?t.world2Local(n):n,r=e?e.world2Local(n):n}this.anchr1=i,this.anchr2=r,this.r1=this.r2=C,this.k1=new y(0,0),this.k2=new y(0,0),this.jAcc=C,this.jMaxLen=0,this.bias=C};be.prototype=Object.create(Te.prototype),be.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=N(this.anchr1,e.rot),this.r2=N(this.anchr2,i.rot),ve(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var r=A(S(i.p,this.r2),S(e.p,this.r1));this.bias=z(O(r,-Ce(this.errorBias,t)/t),this.maxBias)},be.prototype.applyCachedImpulse=function(t){fe(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},be.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,r=this.r2,n=ue(t,e,i,r),s=ye(A(this.bias,n),this.k1,this.k2),o=this.jAcc;this.jAcc=z(S(this.jAcc,s),this.jMaxLen),fe(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},be.prototype.getImpulse=function(){return x(this.jAcc)};var Se=cp.GrooveJoint=function(t,e,i,r,n){Te.call(this,t,e),this.grv_a=i,this.grv_b=r,this.grv_n=P(U(A(r,i))),this.anchr2=n,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new y(0,0),this.k2=new y(0,0),this.jAcc=C,this.jMaxLen=0,this.bias=null};Se.prototype=Object.create(Te.prototype),Se.prototype.preStep=function(t){var e=this.a,i=this.b,r=e.local2World(this.grv_a),n=e.local2World(this.grv_b),s=N(this.grv_n,e.rot),o=T(r,s);this.grv_tn=s,this.r2=N(this.anchr2,i.rot);var a=I(S(i.p,this.r2),s);a<=I(r,s)?(this.clamp=1,this.r1=A(r,e.p)):a>=I(n,s)?(this.clamp=-1,this.r1=A(n,e.p)):(this.clamp=0,this.r1=A(S(O(P(s),-a),O(s,o)),e.p)),ve(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var c=A(S(i.p,this.r2),S(e.p,this.r1));this.bias=z(O(c,-Ce(this.errorBias,t)/t),this.maxBias)},Se.prototype.applyCachedImpulse=function(t){fe(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Se.prototype.grooveConstrain=function(t){var e=this.grv_tn,i=this.clamp*I(t,e)>0?t:L(t,e);return z(i,this.jMaxLen)},Se.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,r=this.r2,n=ue(t,e,i,r),s=ye(A(this.bias,n),this.k1,this.k2),o=this.jAcc;this.jAcc=this.grooveConstrain(S(o,s)),fe(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Se.prototype.getImpulse=function(){return x(this.jAcc)},Se.prototype.setGrooveA=function(t){this.grv_a=t,this.grv_n=P(U(A(this.grv_b,t))),this.activateBodies()},Se.prototype.setGrooveB=function(t){this.grv_b=t,this.grv_n=P(U(A(t,this.grv_a))),this.activateBodies()};var Ae=function(t,e){return(t.restLength-e)*t.stiffness},Re=cp.DampedSpring=function(t,e,i,r,n,s,o){Te.call(this,t,e),this.anchr1=i,this.anchr2=r,this.restLength=n,this.stiffness=s,this.damping=o,this.springForceFunc=Ae,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};Re.prototype=Object.create(Te.prototype),Re.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=N(this.anchr1,e.rot),this.r2=N(this.anchr2,i.rot);var r=A(S(i.p,this.r2),S(e.p,this.r1)),n=x(r);this.n=O(r,1/(n?n:1/0));var s=me(e,i,this.r1,this.r2,this.n);o(0!==s,"Unsolvable this."),this.nMass=1/s,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*t*s);var a=this.springForceFunc(this,n);fe(e,i,this.r1,this.r2,this.n.x*a*t,this.n.y*a*t)},Re.prototype.applyCachedImpulse=function(t){},Re.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,r=this.r1,n=this.r2,s=de(t,e,r,n,i),o=(this.target_vrn-s)*this.v_coef;this.target_vrn=s+o,o*=this.nMass,fe(t,e,this.r1,this.r2,this.n.x*o,this.n.y*o)},Re.prototype.getImpulse=function(){return 0};var Oe=function(t,e){return(e-t.restAngle)*t.stiffness},Ie=cp.DampedRotarySpring=function(t,e,i,r,n){Te.call(this,t,e),this.restAngle=i,this.stiffness=r,this.damping=n,this.springTorqueFunc=Oe,this.target_wrn=0,this.w_coef=0,this.iSum=0};Ie.prototype=Object.create(Te.prototype),Ie.prototype.preStep=function(t){var e=this.a,i=this.b,r=e.i_inv+i.i_inv;o(0!==r,"Unsolvable spring."),this.iSum=1/r,this.w_coef=1-Math.exp(-this.damping*t*r),this.target_wrn=0;var n=this.springTorqueFunc(this,e.a-i.a)*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Ie.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=t.w-e.w,r=(this.target_wrn-i)*this.w_coef;this.target_wrn=i+r;var n=r*this.iSum;t.w+=n*t.i_inv,e.w-=n*e.i_inv};var we=cp.RotaryLimitJoint=function(t,e,i,r){Te.call(this,t,e),this.min=i,this.max=r,this.jAcc=0,this.iSum=this.bias=this.jMax=0};we.prototype=Object.create(Te.prototype),we.prototype.preStep=function(t){var e=this.a,i=this.b,r=i.a-e.a,n=0;r>this.max?n=this.max-r:r<this.min&&(n=this.min-r),this.iSum=1/(1/e.i+1/i.i);var s=this.maxBias;this.bias=m(-Ce(this.errorBias,t)*n/t,-s,s),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},we.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,r=this.jAcc*t;e.w-=r*e.i_inv,i.w+=r*i.i_inv},we.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,r=-(this.bias+i)*this.iSum,n=this.jAcc;this.bias<0?this.jAcc=m(n+r,0,this.jMax):this.jAcc=m(n+r,-this.jMax,0),r=this.jAcc-n,t.w-=r*t.i_inv,e.w+=r*e.i_inv}},we.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var Pe=cp.RatchetJoint=function(t,e,i,r){Te.call(this,t,e),this.angle=0,this.phase=i,this.ratchet=r,this.angle=(e?e.a:0)-(t?t.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};Pe.prototype=Object.create(Te.prototype),Pe.prototype.preStep=function(t){var e=this.a,i=this.b,r=this.angle,n=this.phase,s=this.ratchet,o=i.a-e.a,a=r-o,c=0;a*s>0?c=a:this.angle=Math.floor((o-n)/s)*s+n,this.iSum=1/(e.i_inv+i.i_inv);var h=this.maxBias;this.bias=m(-Ce(this.errorBias,t)*c/t,-h,h),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},Pe.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,r=this.jAcc*t;e.w-=r*e.i_inv,i.w+=r*i.i_inv},Pe.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,r=this.ratchet,n=-(this.bias+i)*this.iSum,s=this.jAcc;
this.jAcc=m((s+n)*r,0,this.jMax*Math.abs(r))/r,n=this.jAcc-s,t.w-=n*t.i_inv,e.w+=n*e.i_inv}},Pe.prototype.getImpulse=function(t){return Math.abs(t.jAcc)};var Le=cp.GearJoint=function(t,e,i,r){Te.call(this,t,e),this.phase=i,this.ratio=r,this.ratio_inv=1/r,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Le.prototype=Object.create(Te.prototype),Le.prototype.preStep=function(t){var e=this.a,i=this.b;this.iSum=1/(e.i_inv*this.ratio_inv+this.ratio*i.i_inv);var r=this.maxBias;this.bias=m(-Ce(this.errorBias,t)*(i.a*this.ratio-e.a-this.phase)/t,-r,r),this.jMax=this.maxForce*t},Le.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,r=this.jAcc*t;e.w-=r*e.i_inv*this.ratio_inv,i.w+=r*i.i_inv},Le.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w*this.ratio-t.w,r=(this.bias-i)*this.iSum,n=this.jAcc;this.jAcc=m(n+r,-this.jMax,this.jMax),r=this.jAcc-n,t.w-=r*t.i_inv*this.ratio_inv,e.w+=r*e.i_inv},Le.prototype.getImpulse=function(){return Math.abs(this.jAcc)},Le.prototype.setRatio=function(t){this.ratio=t,this.ratio_inv=1/t,this.activateBodies()};var Ne=cp.SimpleMotor=function(t,e,i){Te.call(this,t,e),this.rate=i,this.jAcc=0,this.iSum=this.jMax=0};Ne.prototype=Object.create(Te.prototype),Ne.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*t},Ne.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,r=this.jAcc*t;e.w-=r*e.i_inv,i.w+=r*i.i_inv},Ne.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w-t.w+this.rate,r=-i*this.iSum,n=this.jAcc;this.jAcc=m(n+r,-this.jMax,this.jMax),r=this.jAcc-n,t.w-=r*t.i_inv,e.w+=r*e.i_inv},Ne.prototype.getImpulse=function(){return Math.abs(this.jAcc)}},{}],161:[function(require,module,exports){eval('if(typeof CC_TEST=="undefined")CC_TEST=typeof tap=="object"||typeof QUnit=="object";if(typeof CC_EDITOR=="undefined")CC_EDITOR=typeof Editor=="object"&&typeof process=="object"&&"electron" in process.versions;if(typeof CC_DEV=="undefined")CC_DEV=CC_EDITOR||CC_TEST;if(typeof CC_JSB=="undefined")CC_JSB=false;'),require("./predefine");var isMainProcess=!1;isMainProcess?cc._initDebugSetting(1):(require("./bin/modular-cocos2d"),require("./bin/modular-cocos2d-cut")),require("./extends"),isMainProcess?Editor.versions.cocos2d=require("./package.json").version:require("./cocos2d/deprecated"),module.exports=cc},{"./bin/modular-cocos2d":165,"./bin/modular-cocos2d-cut":3,"./cocos2d/deprecated":133,"./extends":156,"./package.json":void 0,"./predefine":164}],162:[function(t,e,i){Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1}},{}],163:[function(t,e,i){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.lastIndexOf(t,e)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){("undefined"==typeof e||e>this.length)&&(e=this.length),e-=t.length;var i=this.indexOf(t,e);return i!==-1&&i===e})},{}],164:[function(t,e,i){cc={},_ccsg={},t("./CCDebugger"),cc._initDebugSetting(cc.DebugMode.INFO),t("./polyfill/string"),t("./polyfill/math"),t("./cocos2d/core/platform/js"),t("./cocos2d/core/value-types"),t("./cocos2d/core/utils"),t("./cocos2d/core/platform/CCInputManager"),t("./cocos2d/core/platform/CCInputExtension"),t("./cocos2d/core/event"),t("./cocos2d/core/platform/CCSys"),t("./cocos2d/core/platform/CCMacro"),t("./cocos2d/core/load-pipeline"),t("./cocos2d/core/textures"),t("./cocos2d/kazmath"),t("./cocos2d/core/CCDirector"),t("./cocos2d/core/CCDirectorWebGL"),t("./cocos2d/core/CCDirectorCanvas"),t("./cocos2d/core/platform/CCSAXParser"),t("./cocos2d/core/platform/CCView"),t("./cocos2d/core/platform/CCScreen"),t("./cocos2d/core/CCActionManager"),t("./cocos2d/core/CCScheduler"),t("./cocos2d/core/event-manager"),t("./cocos2d/core/renderer"),t("./cocos2d/shaders"),t("./cocos2d/compression"),t("./CCBoot.js"),t("./cocos2d/core/CCGame"),ccui={},ccs={},cp={}},{"./CCBoot.js":1,"./CCDebugger":2,"./cocos2d/compression":21,"./cocos2d/core/CCActionManager":23,"./cocos2d/core/CCDirector":24,"./cocos2d/core/CCDirectorCanvas":25,"./cocos2d/core/CCDirectorWebGL":26,"./cocos2d/core/CCGame":27,"./cocos2d/core/CCScheduler":30,"./cocos2d/core/event":65,"./cocos2d/core/event-manager":61,"./cocos2d/core/load-pipeline":71,"./cocos2d/core/platform/CCInputExtension":82,"./cocos2d/core/platform/CCInputManager":83,"./cocos2d/core/platform/CCMacro":84,"./cocos2d/core/platform/CCSAXParser":86,"./cocos2d/core/platform/CCScreen":87,"./cocos2d/core/platform/CCSys":88,"./cocos2d/core/platform/CCView":89,"./cocos2d/core/platform/js":98,"./cocos2d/core/renderer":108,"./cocos2d/core/textures":114,"./cocos2d/core/utils":119,"./cocos2d/core/value-types":132,"./cocos2d/kazmath":137,"./cocos2d/shaders":153,"./polyfill/math":162,"./polyfill/string":163}],165:[function(t,e,i){},{}]},{},[161]);
//# sourceMappingURL=cocos2d-js-min.js.map